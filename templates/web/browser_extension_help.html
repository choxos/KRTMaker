{% extends 'web/base.html' %}

{% block title %}Browser Extension - KRT Maker{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0"><i class="fas fa-puzzle-piece me-2"></i>KRT Maker Browser Extension</h2>
                </div>
                <div class="card-body">
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Browser Extension Files Available!</strong><br>
                        The browser extension files are accessible via the following URLs:
                    </div>

                    <h4><i class="fas fa-download me-2"></i>Download Extension Files</h4>
                    <p>Right-click and "Save As" to download each file:</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-group">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-file-code text-primary me-2"></i>manifest.json</span>
                                    <a href="/static/browser_extension/manifest.json" class="btn btn-sm btn-primary" target="_blank">Download</a>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-file-code text-warning me-2"></i>background.js</span>
                                    <a href="/static/browser_extension/background.js" class="btn btn-sm btn-primary" target="_blank">Download</a>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-file-code text-warning me-2"></i>content.js</span>
                                    <a href="/static/browser_extension/content.js" class="btn btn-sm btn-primary" target="_blank">Download</a>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-group">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-file-code text-info me-2"></i>popup.html</span>
                                    <a href="/static/browser_extension/popup.html" class="btn btn-sm btn-primary" target="_blank">Download</a>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-file-code text-warning me-2"></i>popup.js</span>
                                    <a href="/static/browser_extension/popup.js" class="btn btn-sm btn-primary" target="_blank">Download</a>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-file-code text-success me-2"></i>styles.css</span>
                                    <a href="/static/browser_extension/styles.css" class="btn btn-sm btn-primary" target="_blank">Download</a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h4><i class="fas fa-wrench me-2"></i>Installation Instructions</h4>
                        
                        <div class="accordion" id="installAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="chromeHeading">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#chromeCollapse">
                                        <i class="fab fa-chrome me-2"></i>Chrome Installation
                                    </button>
                                </h2>
                                <div id="chromeCollapse" class="accordion-collapse collapse show" data-bs-parent="#installAccordion">
                                    <div class="accordion-body">
                                        <ol>
                                            <li>Download all extension files to a new folder on your computer</li>
                                            <li>Open Chrome and go to <code>chrome://extensions/</code></li>
                                            <li>Enable "Developer mode" (toggle in top-right corner)</li>
                                            <li>Click "Load unpacked" button</li>
                                            <li>Select the folder containing the extension files</li>
                                            <li>The KRT Helper extension should now appear in your browser!</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="firefoxHeading">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#firefoxCollapse">
                                        <i class="fab fa-firefox me-2"></i>Firefox Installation
                                    </button>
                                </h2>
                                <div id="firefoxCollapse" class="accordion-collapse collapse" data-bs-parent="#installAccordion">
                                    <div class="accordion-body">
                                        <ol>
                                            <li>Download all extension files to a new folder on your computer</li>
                                            <li>Open Firefox and go to <code>about:debugging</code></li>
                                            <li>Click "This Firefox" in the left sidebar</li>
                                            <li>Click "Load Temporary Add-on" button</li>
                                            <li>Navigate to your extension folder and select <code>manifest.json</code></li>
                                            <li>The extension will be loaded temporarily until Firefox restarts</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-success mt-4">
                        <h5><i class="fas fa-star me-2"></i>Extension Features</h5>
                        <ul class="mb-0">
                            <li>Real-time RRID suggestions as you type</li>
                            <li>Works on Overleaf, Google Docs, Notion, and more</li>
                            <li>One-click RRID insertion</li>
                            <li>Cross-database validation</li>
                        </ul>
                    </div>

                    <div class="text-center mt-4">
                        <a href="{% url 'web:ai_features' %}" class="btn btn-primary btn-lg me-3">
                            <i class="fas fa-globe me-2"></i>Try Web Version
                        </a>
                        <a href="{% url 'web:api_docs' %}" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-book me-2"></i>API Documentation
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Test if files are accessible
document.addEventListener('DOMContentLoaded', function() {
    const testUrls = [
        '/static/browser_extension/manifest.json',
        '/static/browser_extension/background.js',
        '/static/browser_extension/content.js'
    ];
    
    testUrls.forEach(url => {
        fetch(url)
            .then(response => {
                const button = document.querySelector(`a[href="${url}"]`);
                if (button) {
                    if (response.ok) {
                        button.classList.remove('btn-secondary');
                        button.classList.add('btn-primary');
                        button.textContent = 'Download';
                    } else {
                        button.classList.remove('btn-primary');
                        button.classList.add('btn-secondary');
                        button.textContent = 'Not Available';
                    }
                }
            })
            .catch(() => {
                const button = document.querySelector(`a[href="${url}"]`);
                if (button) {
                    button.classList.remove('btn-primary');
                    button.classList.add('btn-secondary');
                    button.textContent = 'Error';
                }
            });
    });
});
</script>
{% endblock %}
