{% extends 'web/base.html' %}
{% load static %}

{% block title %}AI Enhancement Features - KRT Maker{% endblock %}

{% block content %}
<div class="container">
    <div class="hero-section">
        <h1 class="hero-title">ðŸ¤– AI Enhancement Features</h1>
        <p class="hero-subtitle">
            Revolutionizing biomedical research infrastructure with advanced AI and machine learning
        </p>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-chart-line me-2"></i>AI Enhancement Statistics
                    </h5>
                    <div class="row">
                        {% for stats in recent_usage %}
                        <div class="col-md-4 mb-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h6 class="card-title">{{ stats.feature_type|title }}</h6>
                                    <h3 class="text-primary">{{ stats.total_requests }}</h3>
                                    <small class="text-muted">
                                        {{ stats.success_rate_percent }}% success rate
                                    </small>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12">
                            <p class="text-muted">No usage data available yet. Try out the features below!</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        {% for feature in features %}
        <div class="col-md-6 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">
                        {{ feature.icon }} {{ feature.name }}
                    </h5>
                    <p class="card-text">{{ feature.description }}</p>
                    
                    {% if feature.name == "RRID Suggestions" %}
                        <button class="btn btn-primary" onclick="testRRIDSuggestion()">
                            <i class="fas fa-play"></i> Test Feature
                        </button>
                        <div class="mt-3">
                            <h6>How it works:</h6>
                            <ul class="small">
                                <li>Enter resource details (name, type, vendor)</li>
                                <li>AI analyzes multiple databases for matches</li>
                                <li>Returns ranked RRID suggestions with confidence scores</li>
                                <li>Cross-validates against SciCrunch and Antibody Registry</li>
                            </ul>
                        </div>
                    {% elif feature.name == "Resource Recommendations" %}
                        <button class="btn btn-primary" onclick="testResourceRecommendation()">
                            <i class="fas fa-play"></i> Test Feature
                        </button>
                        <div class="mt-3">
                            <h6>How it works:</h6>
                            <ul class="small">
                                <li>Uses semantic similarity to find alternatives</li>
                                <li>Analyzes functional equivalence</li>
                                <li>Checks availability and pricing</li>
                                <li>Provides scientific evidence for recommendations</li>
                            </ul>
                        </div>
                    {% elif feature.name == "Conversational KRT" %}
                        <a href="{% url 'web:conversational_krt' %}" class="btn btn-primary">
                            <i class="fas fa-comments"></i> Try Chat Interface
                        </a>
                        <div class="mt-3">
                            <h6>How it works:</h6>
                            <ul class="small">
                                <li>Natural language processing of resource descriptions</li>
                                <li>Intent classification and entity recognition</li>
                                <li>Multi-turn conversation with context awareness</li>
                                <li>Automatic KRT table generation</li>
                            </ul>
                        </div>
                    {% elif feature.name == "Cross-Reference Validation" %}
                        <button class="btn btn-primary" onclick="validateSampleRRID()">
                            <i class="fas fa-play"></i> Test Validation
                        </button>
                        <div class="mt-3">
                            <h6>How it works:</h6>
                            <ul class="small">
                                <li>Validates RRIDs across multiple databases</li>
                                <li>Detects discrepancies and inconsistencies</li>
                                <li>Provides confidence scoring</li>
                                <li>Learns from error patterns</li>
                            </ul>
                        </div>
                    {% elif feature.name == "Browser Extension" %}
                        <a href="/static/browser_extension/" class="btn btn-primary" target="_blank">
                            <i class="fas fa-download"></i> Download Extension
                        </a>
                        <div class="mt-3">
                            <h6>Supported platforms:</h6>
                            <ul class="small">
                                <li>Overleaf & ShareLaTeX</li>
                                <li>Google Docs</li>
                                <li>Notion</li>
                                <li>Editorial Manager</li>
                            </ul>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-graduation-cap me-2"></i>Research Impact
                    </h5>
                    <div class="row">
                        <div class="col-md-3 text-center">
                            <div class="bg-light p-3 rounded">
                                <h3 class="text-success">54%</h3>
                                <small>Resource identification failure rate addressed</small>
                            </div>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="bg-light p-3 rounded">
                                <h3 class="text-info">90%+</h3>
                                <small>Expected accuracy improvement</small>
                            </div>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="bg-light p-3 rounded">
                                <h3 class="text-warning">3-5x</h3>
                                <small>Faster processing vs manual</small>
                            </div>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="bg-light p-3 rounded">
                                <h3 class="text-primary">200+</h3>
                                <small>Languages supported</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <p class="text-muted">
                            Our AI enhancement features are based on cutting-edge research addressing the 
                            <strong>54% resource identification failure rate</strong> in biomedical literature. 
                            Using advanced multimodal AI, cross-reference validation, and intelligent 
                            recommendation systems, we're transforming how researchers document and 
                            identify scientific resources.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Additional test function for validation
async function validateSampleRRID() {
    const testData = {
        rrid: "RRID:AB_2138153"
    };
    
    try {
        const response = await fetch('/api/ai/validate-rrid/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify(testData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            const validation = result.validation;
            alert(`RRID Validation Result:\n\n` +
                  `RRID: ${validation.rrid}\n` +
                  `Status: ${validation.status.toUpperCase()}\n` +
                  `Valid: ${validation.is_valid ? 'Yes' : 'No'}\n` +
                  `Confidence: ${(validation.confidence_score * 100).toFixed(0)}%\n` +
                  `Last Checked: ${new Date(validation.last_checked).toLocaleString()}\n` +
                  `Source: ${validation.source}`);
        } else {
            alert('Error: ' + result.error);
        }
    } catch (error) {
        alert('Network error: ' + error.message);
    }
}
</script>
{% endblock %}
