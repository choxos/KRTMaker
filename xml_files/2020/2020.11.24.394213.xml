<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS144148</article-id><article-id pub-id-type="doi">10.1101/2020.11.24.394213</article-id><article-id pub-id-type="archive">PPR245065</article-id><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title><italic>distinct</italic>: a novel approach to differential distribution analyses</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Tiberi</surname><given-names>Simone</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib><contrib contrib-type="author"><name><surname>Crowell</surname><given-names>Helena L</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Samartsidis</surname><given-names>Pantelis</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Weber</surname><given-names>Lukas M</given-names></name><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Robinson</surname><given-names>Mark D</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib></contrib-group><aff id="A1"><label>1</label>Department of Molecular Life Sciences and Swiss Institute of Bioinformatics, University of Zurich, Zurich, Switzerland</aff><aff id="A2"><label>2</label>MRC Biostatistics Unit, School of Clinical Medicine, University of Cambridge, Cambridge, UK</aff><aff id="A3"><label>3</label>Department of Biostatistics, Johns Hopkins Bloomberg School of Public Health, Baltimore, MD, USA</aff><author-notes><corresp id="CR1">
<label>*</label>
<email>Simone.Tiberi@uzh.ch</email>
</corresp></author-notes><pub-date pub-type="nihms-submitted"><day>05</day><month>04</month><year>2022</year></pub-date><pub-date pub-type="preprint"><day>04</day><month>04</month><year>2022</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">We present <italic>distinct</italic>, a general method for differential analysis of full distributions that is well suited to applications on single-cell data, such as single-cell RNA sequencing and high-dimensional flow or mass cytometry data. High-throughput single-cell data reveal an unprecedented view of cell identity and allow complex variations between conditions to be discovered; nonetheless, most methods for differential expression target differences in the mean and struggle to identify changes where the mean is only marginally affected. <italic>distinct</italic> is based on a hierarchical non-parametric permutation approach and, by comparing empirical cumulative distribution functions, identifies both differential patterns involving changes in the mean, as well as more subtle variations that do not involve the mean. We performed extensive bench-marks across both simulated and experimental datasets from single-cell RNA sequencing and mass cytometry data, where <italic>distinct</italic> shows favourable performance, identifies more differential patterns than competitors, and displays good control of false positive and false discovery rates. <italic>distinct</italic> is available as a Bioconductor R package.</p></abstract><kwd-group><title>Keywords</title><kwd>Differential distribution</kwd><kwd>Differential analyses</kwd><kwd>Differential state</kwd><kwd>High-throughput single-cell data</kwd><kwd>Single-cell RNA-seq</kwd><kwd>Single-cell flow and mass cytometry</kwd><kwd>Permutation tests</kwd></kwd-group></article-meta></front><body><sec id="S1" sec-type="intro"><title>Background</title><p id="P2">Technology developments in the last decade have led to an explosion of high-throughput single-cell data, such as single-cell RNA sequencing (scRNA-seq) and high-dimensional flow or mass cytometry data, allowing researchers to investigate biological mechanisms at single-cell resolution. Single-cell data have also extended the canonical definition of differential expression by displaying cell-type specific responses across conditions, known as differential state (DS) [<xref ref-type="bibr" rid="R31">31</xref>], where genes or proteins vary in specific sub-populations of cells (e.g., a cytokine response in myeloid cells but not in other leukocytes [<xref ref-type="bibr" rid="R12">12</xref>]). Classical bulk differential expression methods have been shown to perform well when used on single-cell measurements [<xref ref-type="bibr" rid="R24">24</xref>, <xref ref-type="bibr" rid="R25">25</xref>, <xref ref-type="bibr" rid="R30">30</xref>] and on aggregated data (i.e., averages or sums across cells), also referred to as pseudo-bulk (PB) [<xref ref-type="bibr" rid="R6">6</xref>, <xref ref-type="bibr" rid="R31">31</xref>]. However, most bulk and PB tools focus on shifts in the means, and may conceal information about cell-to-cell heterogeneity. Indeed, single-cell data can show more complex variations (<xref ref-type="fig" rid="F1">Figure 1</xref> and <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 1</xref>); such patterns can arise due to increased stochasticity and heterogeneity, for example owing to oscillatory and unsynchronized gene expression between cells, or when some cells respond differently to a treatment than others [<xref ref-type="bibr" rid="R14">14</xref>, <xref ref-type="bibr" rid="R30">30</xref>]. In addition to bulk and PB tools, other methods were specifically proposed to perform differential analyses on single-cell data (notably: <italic>scDD</italic> [<xref ref-type="bibr" rid="R14">14</xref>], <italic>SCDE</italic> [<xref ref-type="bibr" rid="R13">13</xref>], <italic>MAST</italic> [<xref ref-type="bibr" rid="R10">10</xref>], <italic>BASiCS</italic> [<xref ref-type="bibr" rid="R9">9</xref>, <xref ref-type="bibr" rid="R28">28</xref>, <xref ref-type="bibr" rid="R29">29</xref>] and mixed models [<xref ref-type="bibr" rid="R26">26</xref>]). Nevertheless, they all present significant limitations: BASiCS does not perform cell-type specific differential testing between conditions, scDD does not directly handle covariates and biological replicates, while PB, SCDE, MAST and mixed models performed poorly in previous benchmarks when detecting differential patterns that do not involve the mean [<xref ref-type="bibr" rid="R6">6</xref>, <xref ref-type="bibr" rid="R14">14</xref>].</p></sec><sec id="S2" sec-type="results"><title>Results</title><sec id="S3"><title><italic>distinct</italic>’s full distribution approach</title><p id="P3">To overcome these challenges, we developed <italic>distinct</italic>, a flexible and general statistical methodology to perform differential analyses between groups of distributions. <italic>distinct</italic> is particularly suitable to compare groups of samples (i.e., biological replicates) on single-cell data.</p><p id="P4">Our approach computes the empirical cumulative distribution function (ECDF) from the individual (e.g., single-cell) measurements of each sample, and compares ECDFs to identify changes between full distributions, even when the mean is unchanged or marginally involved (<xref ref-type="fig" rid="F1">Figure 1</xref> and <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 1</xref>). First, we compute the ECDF of each individual sample; then, we build a fine grid and, at each cut-off, we average the ECDFs within each group, and compute the absolute difference between such averages. A test statistic, <italic>s</italic><sup><italic>obs</italic></sup>, is obtained by adding these absolute differences.</p><p id="P5">More formally, assume we are interested in comparing two groups, that we call <italic>A</italic> and <italic>B</italic>, for which <italic>N</italic><sub><italic>A</italic></sub> and <italic>N</italic><sub><italic>B</italic></sub> samples are available, respectively. The ECDF for the <italic>i</italic>-th sample in the <italic>j</italic>-th group, is denoted by <inline-formula><mml:math id="M1"><mml:mrow><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>d</mml:mi><mml:msubsup><mml:mi>f</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mo>.</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, for <italic>j</italic> ∈ {<italic>A, B</italic>} and <italic>i</italic> = 1, …, <italic>N</italic><sub><italic>j</italic></sub>. We then define <italic>K</italic> equally spaced cut-offs between the minimum, <italic>min</italic>, and maximum, <italic>max</italic>, values observed across all samples: <italic>b</italic><sub>1</sub>, …, <italic>b</italic><sub><italic>K</italic></sub>, where <italic>b</italic><sub><italic>k</italic></sub> = <italic>min</italic> + <italic>k l</italic>, for <italic>k</italic> = 1, …, <italic>K</italic>, with <italic>l</italic> = (<italic>max − min</italic>)<italic>/</italic>(<italic>K</italic> + 1) being the distance between two consecutive cut-offs. We exclude <italic>min</italic> and <italic>max</italic> from the cut-offs because, trivially, <inline-formula><mml:math id="M2"><mml:mrow><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>d</mml:mi><mml:msubsup><mml:mi>f</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M3"><mml:mrow><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>d</mml:mi><mml:msubsup><mml:mi>f</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mspace width="0.2em"/><mml:mo>∀</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></inline-formula>. At every cut-off, we compute the absolute difference between the mean ECDF in the two groups; our test statistic, <italic>s</italic><sup><italic>obs</italic></sup>, is obtained by adding these differences across all cut-offs: <disp-formula id="FD1"><label>(1)</label><mml:math id="M4"><mml:mrow><mml:msup><mml:mi>s</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>Σ</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:mrow></mml:msubsup><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>d</mml:mi><mml:msubsup><mml:mi>f</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>A</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>A</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>Σ</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:msubsup><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>d</mml:mi><mml:msubsup><mml:mi>f</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>B</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>b</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>B</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow></mml:mstyle><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P6">Note that in differential state analyses, these operations are repeated for every gene-cluster combination.</p><p id="P7">Intuitively, <italic>s</italic><sup><italic>obs</italic></sup>, which ranges in [0, ∞), approximates the area between the average ECDFs, and represents a measure of distance between two groups of densities: the bigger <italic>s</italic><sup><italic>obs</italic></sup>, the greater the distance between groups. The number of cut-offs <italic>K</italic>, which can be defined by users, is set to 25 by default, because no detectable difference in performance was observed when further increasing it (data not shown). Note that, although at each cut-off we compute the average across each group’s curves, ECDFs are computed separately for each individual sample, therefore our approach still accounts for the within-group variability; indeed, at a given thresh-old, the average of the sample-specific ECDFs differs from the group-level ECDF (i.e., the curve based on all individual measurements from the group). The null distribution of <italic>s</italic><sup><italic>obs</italic></sup> is then estimated via a hierarchical non-parametric permutation approach (see <xref ref-type="sec" rid="S7">Methods</xref>). A major disadvantage of permutation tests, which often restricts its usage on biological data, is that too few permutations are available from small samples. We overcome this by permuting cells, which is still possible in small samples, because there are many more cells than samples. In principle, this may lead to an inflation of false positives due to lack of exchangability (see <xref ref-type="sec" rid="S7">Methods</xref>); nonetheless, in our analyses, <italic>distinct</italic> provides good control of both false positive and false discovery rates.</p><p id="P8">Importantly, <italic>distinct</italic> is general and flexible: it targets complex changes between groups, explicitly models biological replicates within a hierarchical framework, does not rely on asymptotic theory, avoids parametric assumptions, and can be applied to arbitrary types of data. Additionally, <italic>distinct</italic> can also adjust for sample-level cell-cluster specific covariates (i.e., whose effect varies across cell clusters), such as batch effects. In particular, <italic>distinct</italic> fits a linear mixed effects model with the input data (e.g., normalized counts) as response variable, nuisance covariates as fixed effects, and samples as random effects. The method then removes the estimated impact of fixed effect covariates, and performs differential testing on these normalized values (see <xref ref-type="sec" rid="S7">Methods</xref>).</p><p id="P9">Furthermore, to enhance the interpretability of differential results, <italic>distinct</italic> provides functionalities to compute (log) fold changes between conditions, and to plot densities and ECDFs, both for individual samples and at the group-level.</p><p id="P10">Note that, although <italic>distinct</italic> and the Kolmogorov-Smirnov [<xref ref-type="bibr" rid="R17">17</xref>] (KS) test share similarities (they both compare distributions via non-parametric tests), the two approaches present several conceptual differences. Firstly, the KS considers the maximum distance between two ECDFs, while our approach estimates the overall distance between ECDFs, which in our view is a more appropriate way to measure the difference between distributions. Secondly, the KS test only compares two individual densities, while our framework compares groups of distributions. Thirdly, while the KS statistic relies on asymptotic theory, our framework uses a permutation test. Finally, a comparison between <italic>distinct</italic> and <italic>scDD</italic> [<xref ref-type="bibr" rid="R14">14</xref>] based on the KS test (labelled <italic>scDD-KS</italic>) shows that our method, compared to the KS test, has greater statistical power to detect differential effects and leads to fewer false discoveries (see <xref ref-type="sec" rid="S4">Simulation studies</xref>).</p></sec><sec id="S4"><title>Simulation studies</title><p id="P11">We conducted an extensive benchmark, based on scRNA-seq and mass cytometry simulated and experimental datasets to investigate <italic>distinct</italic>’s ability to identify differential patterns in sub-populations of cells.</p><p id="P12">First, we simulated droplet scRNA-seq data via <italic>muscat</italic> [<xref ref-type="bibr" rid="R6">6</xref>] (see <xref ref-type="sec" rid="S7">Methods</xref>). We ran five simulation replicates for each of the differential profiles in <xref ref-type="fig" rid="F1">Figure 1</xref>, with 10% of the genes being differential in each cluster, where DE (differential expression) indicates a shift in the entire distribution, DP (differential proportion) implies two mixture distributions with different proportions of the two components, DM (differential modality) assumes a unimodal and a bimodal distribution, DB (both differential modality and different component means) compares a unimodal and a bimodal distribution with the same overall mean, and DV (differential variability) refers to two unimodal distributions with the same mean but different variance (<xref ref-type="fig" rid="F1">Figure 1</xref> and <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 1</xref>). Each individual simulation consists of 4,000 genes, 3,600 cells, separated into 3 clusters, and two groups of 3 samples each, corresponding to an average of 200 cells per sample in each cluster.</p><p id="P13">We considered five different normalization approaches: counts per million (CPMs), <italic>scater</italic>’s logcounts [<xref ref-type="bibr" rid="R18">18</xref>], <italic>linnorm</italic> [<xref ref-type="bibr" rid="R33">33</xref>], <italic>BASiCS</italic> [<xref ref-type="bibr" rid="R9">9</xref>, <xref ref-type="bibr" rid="R28">28</xref>, <xref ref-type="bibr" rid="R29">29</xref>], and residuals from variance stabilizing normalization from <italic>sctransform</italic> (vstresiduals) [<xref ref-type="bibr" rid="R11">11</xref>]. We compared <italic>distinct</italic> to several PB approaches from <italic>muscat</italic>, based on <italic>edgeR</italic> [<xref ref-type="bibr" rid="R23">23</xref>], <italic>limma-voom</italic> and <italic>limma-trend</italic> [<xref ref-type="bibr" rid="R22">22</xref>], which emerged among the best performing methods for differential analyses from scRNA-seq data [<xref ref-type="bibr" rid="R6">6</xref>, <xref ref-type="bibr" rid="R25">25</xref>]. We further considered three methods from <italic>muscat</italic> based on mixed models (MM), namely <italic>MM-dream2, MM-vstresiduals</italic> and <italic>MM-nbinom</italic> (see <xref ref-type="sec" rid="S7">Methods</xref>). Finally, we included <italic>scDD</italic> [<xref ref-type="bibr" rid="R14">14</xref>], which is conceptually similar to our approach: <italic>scDD</italic> implements a non-parametric method to detect changes between individual distributions from scRNA-seq, based on the Kolmogorov-Smirnov test, <italic>scDD-KS</italic>, and on a permutation approach, <italic>scDD-perm</italic>. For <italic>scDD-perm</italic> we used 100 permutations to reduce the computational burden.</p><p id="P14">In all scenarios and on all five input data, <italic>distinct</italic> shows favourable performance: it has good statistical power while controlling for the false discovery rate (FDR) (<xref ref-type="fig" rid="F2">Figure 2</xref>). In particular, for DE, DP and DM, <italic>distinct</italic> has similar performance to the best performing competitors (<italic>edgeR</italic>.<italic>linnorm</italic> and <italic>limma-trend</italic>.<italic>logcounts</italic>), while for DB and DV, it achieves significantly higher true positive rate (TPR), especially when using <italic>log-counts</italic>. PB methods in general perform well for differential patterns involving changes in the mean (DE, DP and DM), but struggle to identify DB and DV patterns. <italic>scDD</italic> provides good TPR across all patterns when using the KS test on vstresiduals (<italic>scDD-KS</italic>.<italic>vstresiduals</italic>), while the TPR is significantly reduced when using other inputs and with the permutation approach(<italic>scDD-perm</italic>); however, <italic>scDD</italic> methods (in particular, <italic>scDD-KS</italic>.<italic>vstresiduals</italic>) also show a significant inflation of the FDR. In contrast, MM methods provide good control of the FDR but have low statistical power in all differential scenarios. We also investigated how normalization influences each method’s results (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2</xref>): <italic>distinct</italic> appears to be the least affected method and displays the smallest variation across normalization inputs, possibly due to its non-parametric structure, which can more flexibly accommodate various inputs.</p><p id="P15">We further simulated five null simulation replicates with no differential patterns; again with each simulation having 4,000 genes, 3,600 cells, 3 cell clusters and two groups of 3 samples each. In the null simulated data, only <italic>limma-trend</italic>.<italic>basics</italic> and <italic>limma-trend</italic>.<italic>cpm</italic> present a mild inflation of false positives, while MM and, particularly, <italic>edgeR</italic>.<italic>basics</italic> lead to overly conservative p-values; instead, <italic>distinct</italic> and <italic>scDD</italic> show approximately uniform p-values for all types of input data (<xref ref-type="fig" rid="F3">Figure 3</xref>).</p><p id="P16">We also extended previous simulations to add a cell-type specific batch effect (i.e., a batch effect that affects differently each cell-type) [<xref ref-type="bibr" rid="R6">6</xref>, <xref ref-type="bibr" rid="R16">16</xref>]. In particular, we simulated 2 batches, that we call <italic>b</italic><sub>1</sub> and <italic>b</italic><sub>2</sub>, with one group of samples having two samples associated to <italic>b</italic><sub>1</sub> and one to <italic>b</italic><sub>2</sub>, and the other group of samples having two samples from batch <italic>b</italic><sub>2</sub> and one from <italic>b</italic><sub>1</sub>. Differential results are substantially unchanged (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3</xref>), which shows <italic>distinct</italic> can effectively remove nuisance confounders.</p><p id="P17">Furthermore, we performed various sensitivity analyses and investigated how results are affected when varying: i) the number of cells, ii) the library size, iii) the dispersion parameter, iv) the fraction of significant genes, and v) the sample sizes in each group. In particular, we simulated 50, 100, 200 (as in the original simulation) and 400 cells per sample in each cluster. We further modified the library size and dispersion parameters of the negative binomial model used by <italic>muscat</italic> to simulate scRNA-seq data, influencing the mean expression and cell-to-cell variability respectively, by considering values 1/5, 1/2, 2 and 5 times as big as those used in the original simulation. In addition, we varied the percentage of simulated differential genes as 1, 5, 10 (as in the original simulation) and 20%, and considered various unbalanced designs by comparing two groups of different sample sizes: 3 <italic>vs</italic>. 2, 4 <italic>vs</italic>. 3, and 5 <italic>vs</italic>. 3. Overall, increasing the number of cells or the library size and decreasing the dispersion have a positive impact on the performance of all methods, by improving their ability to detect differential effects (i.e., true positive rate); nonetheless, none of these factors seem to affect the relative ranking of methods, which remains globally stable (<xref ref-type="fig" rid="F4">Figure 4</xref> and <xref ref-type="supplementary-material" rid="SD1">Supplementary Figures 4-5</xref>). In addition, changing the fraction of significant genes and considering unbalanced designs does not appear to introduce systematic changes in performance (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figures 6-7</xref>). Note that, in these sensitivity analyses, we excluded MM models due to the high computational cost and low statistical power displayed in the previous analyses.</p><p id="P18">From a computational perspective, <italic>distinct</italic> required an average time of 3.2 to 4.5 minutes per simulation, which is higher than PB methods (0.1 to 0.2 minutes) and <italic>scDD-KS</italic> (0.5 to 0.7 minutes), but significantly lower than MM approaches (29.4 to 297.3 minutes) and <italic>scDD-perm</italic> (544.7 to 2085.6 minutes) (<xref ref-type="fig" rid="F5">Figure 5</xref> and <xref ref-type="supplementary-material" rid="SD1">Supplementary Table 1</xref>). All methods were run on 3 cores, except PB approaches, which used a single core, because they do not allow for parellel computing.</p><p id="P19">We also considered an alternative popular droplet scRNA-seq data simulator, <italic>SplatPOP</italic> [<xref ref-type="bibr" rid="R2">2</xref>], which represents a generalization of <italic>Splatter</italic> [<xref ref-type="bibr" rid="R34">34</xref>], that allows multi-sample multi-group synthetic data to be generated. In particular, we simulated 20,345 genes from a human genome with two groups of 4 samples each, and 100 cells per sample, belonging to the same cluster of cells, for a total of 800 cells across all samples. We ran 8 differential simulations, with 10% of genes truly differential between groups, by varying the location (<italic>de</italic>.<italic>facLoc</italic>) and scale (<italic>de</italic>.<italic>facScale</italic>) differential parameters, mainly affecting the mean and variance, respectively (see <xref ref-type="sec" rid="S7">Methods</xref>). We considered the same normalization and differential methods as in the <italic>muscat</italic> simulation (except MM and <italic>scDD-perm</italic>, which were not considered due to the high computational cost and low statistical power displayed above). As expected, for all methods, differential patterns are easier to detect as the magnitude of the difference increases, with differential location patterns having a higher true positive rate than differential scale patterns. While all methods control the FDR, in all simulations, <italic>distinct</italic> achieves substantially higher TPR than competitors (<xref ref-type="fig" rid="F6">Figure 6</xref>). We also repeated the same simulations including a batch effect, with two batches, with the same scale and location differential parameters for the batch and group differences (i.e., increasing together from 0.2 to 1.5). Again, we excluded <italic>scDD</italic> from these analyses because it cannot handle covariates directly. Results agree with those from the <italic>muscat</italic> batch effect simulation study: FDR and TPRs are mostly unchanged when introducing nuisance covariates, with only a minor decrease in the TPR in stronger batch effects, i.e., when de.facLoc and de.facScale are 1 and 1.5 (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 8</xref>), which again indicates that <italic>distinct</italic> can effectively control for nuisance covariates.</p><p id="P20">We further considered the semi-simulated mass cytometry data from Weber <italic>et al</italic>. [<xref ref-type="bibr" rid="R31">31</xref>] (labelled <italic>diffcyt</italic> simulation), where spike-in signals were computationally introduced in experimental data [<xref ref-type="bibr" rid="R4">4</xref>], hence maintaining the properties of real biological data while also embedding a known ground truth signal. We evaluated <italic>distinct</italic> and two methods from <italic>diffcyt</italic>, based on <italic>limma</italic> [<xref ref-type="bibr" rid="R22">22</xref>] and linear mixed models (LMM), which out-performed competitors on these same data [<xref ref-type="bibr" rid="R31">31</xref>]. In particular, we considered three datasets from Weber <italic>et al</italic>. [<xref ref-type="bibr" rid="R31">31</xref>]: the main DS dataset and two more where differential effects were diluted by 50 and 75%. Each dataset consists of 24 protein markers, 88,435 cells, and two groups (with and without spike-in signal) of 8 samples each. Measurements were first transformed, and then cells were grouped into sub-populations with two separate approaches (see <xref ref-type="sec" rid="S7">Methods</xref>): i) similarly to the <italic>muscat</italic> simulation study, cell labels were defined based on 8 manually annotated cell types [<xref ref-type="bibr" rid="R31">31</xref>] (<xref ref-type="fig" rid="F7">Figure 7a</xref>), and ii) as in the original <italic>diffcyt</italic> study from Weber <italic>et al</italic>. [<xref ref-type="bibr" rid="R31">31</xref>], cells were grouped into 100 high-resolution clusters (based on 10 cell-type markers, see <xref ref-type="sec" rid="S7">Methods</xref>) via unsupervised clustering (<xref ref-type="fig" rid="F7">Figure 7b</xref>). In the main simulation, <italic>distinct</italic> achieves higher TPR when considering cell-type labels (<xref ref-type="fig" rid="F7">Figure 7a</xref>, ‘main’), while all methods exhibit substantially overlapping performance when using unsupervised clustering (<xref ref-type="fig" rid="F7">Figure 7b</xref>, ‘main’). In both clustering approaches, as the magnitude of the differential effect decreases, the distance between methods increases: <italic>diffcyt</italic> tools show a significant drop in the true positive rate whereas <italic>distinct</italic> maintains a higher TPR while effectively controlling for the false discovery rate (FDR) (<xref ref-type="fig" rid="F7">Figures 7a-b</xref> and <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 9</xref>). This indicates that <italic>distinct</italic> has good statistical power to detect even small changes between conditions. We also considered the three replicate null datasets from</p><p id="P21">Weber <italic>et al</italic>. [<xref ref-type="bibr" rid="R31">31</xref>] (i.e., with no differential effect), containing 24 protein markers and 88,438 cells across 8 cell types, and found that all methods display approximately uniform p-values (<xref ref-type="fig" rid="F7">Figure 7c</xref>).</p></sec><sec id="S5"><title>Experimental data analyses</title><p id="P22">In order to investigate false positive rates (FPRs) in real data, we considered two experimental scRNA-seq datasets where no differential signals were expected, by comparing samples from the same experimental condition. Given the high computational cost and low power of MM, and the high FDR of <italic>scDD</italic> models, for the real data analyses, we only included <italic>distinct</italic> and PB methods. We considered gene-cluster combinations with at least 20 non-zero cells across all samples. The first dataset (labelled <italic>T-cells</italic>) consists of a Smart-seq2 scRNA-seq dataset of 19,875 genes and 11,138 T cells isolated from peripheral blood from 12 colorectal cancer patients [<xref ref-type="bibr" rid="R35">35</xref>]. We automatically separated cells in 11 clusters (via <italic>igraph</italic> [<xref ref-type="bibr" rid="R1">1</xref>, <xref ref-type="bibr" rid="R7">7</xref>]), and generated replicate datasets, by randomly separating, three times, the 12 patients to two groups of size 6. The second dataset (labelled <italic>Kang</italic>) contains 10x droplet-based scRNA-seq peripheral blood mononuclear cell data from 8 Lupus patients, before (controls) and after (stimulated) 6h-treatment with interferon-<italic>β</italic> (INF-<italic>β</italic>), a cytokine known to alter the transcriptional profile of immune cells [<xref ref-type="bibr" rid="R12">12</xref>]. The full dataset contains 35,635 genes and 29,065 cells, which are separated (via manual annotation [<xref ref-type="bibr" rid="R12">12</xref>]) into 8 cell types. One of the 8 patients was removed as it appears to be a potential outlier (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figures 10-12</xref>). Here we only included singlet cells and cells assigned to a cell population, and considered control samples only, resulting in 11,854 cells and 10,891 genes. Again, we artificially created three replicate datasets by randomly assigning the 7 retained control samples in two groups of size 3 and 4. In both null analyses, we found that <italic>limma-trend</italic>, particularly when using CPMs, leads to an increase of FPRs, <italic>distinct</italic>’s p-values are only marginally inflated towards 0, while <italic>edgeR</italic> and <italic>limmavoom</italic> are the most conservative methods and provide the best control of FPRs (<xref ref-type="fig" rid="F8">Figure 8</xref> and <xref ref-type="supplementary-material" rid="SD1">Supplementary Tables 2-3</xref>). Regarding normalization, <italic>linnorm</italic> and <italic>BASiCS</italic> lead to the most conservative p-values and smallest false positive rates.</p><p id="P23">We then considered again the <italic>Kang</italic> dataset, and performed a DS analysis between controls and stimulated samples. Again, we removed one potential outlier patient, and only considered singlet cells and cells assigned to a cell population; we further filtered genecluster combinations with less than 20 non-zero cells across all samples, resulting in 12,045 genes and 23,571 cells across 8 cell types and 14 samples. We found that <italic>distinct</italic> identifies more differential patterns than PB methods, with <italic>edgeR</italic> and <italic>limma-voom</italic> being the most conservative methods, and that its results are very coherent across different input data (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 13</xref>). When visually investigating the gene-cluster combinations detected by <italic>distinct</italic> (adjusted p-value &lt; 0.1), on all five input data (CPMs, logcounts, linnorm, BASiCS and vstresiduals), and not detected by any of the ten PB approaches (adjusted p-value &gt; 0.1), we found several interesting non-canonical differential patterns (<xref ref-type="fig" rid="F9">Figure 9</xref> and <xref ref-type="supplementary-material" rid="SD1">Supplementary Figures 14-25</xref>). In particular, gene MARCKSL1 displays a DB pattern, with stimulated samples having higher density on the tails and lower in the centre of the distribution, gene RPL13 mirrors classical DE, while the other genes seem to emulate DP profiles. Interestingly, ten out of eleven of these genes are known tumor prognostic markers: H2AZ2 for cervical and renal cancer, SRSF9 for liver cancer and melanoma, RPL24 for renal and thyroid cancer, HNRNPA0 for renal and pancreatic cancer, MARCKSL1 for liver and renal cancer, GTF3C6 for liver cancer, RPL13 for endometrial and renal cancer, PGK1 for breast, head and neck, cervical, liver, and pancreatic cancer, KDELR2 for renal, head and neck and glioma cancer, and RPL11 for renal and breast cancer [<xref ref-type="bibr" rid="R27">27</xref>]. This is an interesting association, considering that INF-<italic>β</italic> stimulation is known to inhibit and interfere with tumor progression [<xref ref-type="bibr" rid="R8">8</xref>,<xref ref-type="bibr" rid="R21">21</xref>]. Additionally, <xref ref-type="supplementary-material" rid="SD1">Supplementary Figures 9-17</xref> show how <italic>distinct</italic> can identify differences between groups of distributions even when only a portion of the ECDF varies between conditions. Finally, we computed the fraction of detected genes that are unique by each method. Given that a ground truth is absent, we speculate that gene-cluster combinations detected by multiple methods are more likely to be truly differential, while those detected by a single method are more likely to be false positive detections. Since methods return widely different number of significant genes, for each method, we considered the top (i.e., smallest p-value) 1,000 genes per cell-type. We then computed the percentage of results that are unique to each method (<xref rid="T1" ref-type="table">Table 1</xref>), i.e., not in common with the top 1,000 results returned by any other method. Overall, <italic>distinct</italic> displays a lower fraction of unique results (1.4% on average across all input data) compared to <italic>edgeR</italic> (4%) and <italic>limma</italic> (6.7%). It is also interesting to note that <italic>scater</italic>’s logcounts normalization lead to the 2 smallest fractions of unique values (i.e., <italic>distinct</italic>.<italic>logcounts</italic> and <italic>limma-trend</italic>.<italic>logcounts</italic>).</p></sec></sec><sec id="S6" sec-type="discussion"><title>Discussion</title><p id="P24">High-throughput single-cell data can display complex differential patterns; nonetheless, most methods for differential expression fail to identify changes where the mean is not affected. To overcome the limitations of present differential tools, we have developed <italic>distinct</italic>, a novel method to identify differential patterns between groups of distributions, which is particularly well suited to perform differential analyses on high-throughput single-cell data. <italic>distinct</italic> is based on a flexible hierarchical multi-sample full-distribution non-parametric approach. In order to compare it to state-of-the-art differential methods, we ran extensive benchmarks on both simulated and experimental datasets from scRNA-seq and mass cytometry data, where our approach exhibits favourable performance, provides good control of the FNR and FDR, and is able to identify more patterns of differential expression compared to canonical tools, even when the overall mean is unchanged. In particular, our approach displays a higher statistical power (i.e., TPR) not only than PB methods, but also compared to other non-parametric frameworks from <italic>scDD</italic>, based on the Kolmogorov-Smirnov test statistic (<italic>scDD-KS</italic>) and on permutation tests (<italic>scDD-perm</italic>). <italic>distinct</italic> also allows for biological replicates, does not rely on asymptotic theory, which could be inaccurate in small sample sizes (typical of biological data), and avoids parametric assumptions, that may be challenging to meet in single-cell data. Additionally, <italic>distinct</italic> can also effectively adjust for sample-level cell-cluster specific covariates (i.e., whose effect varies across cell clusters), such as batch effects (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3</xref>). Importantly, <italic>distinct</italic> is a very general test that, due to its non-parametric nature, can be applied to various types of data, even beyond the single-cell applications shown here. Furthermore, thanks to its flexible form, we have shown in our simulations that <italic>distinct</italic> has the most consistent performance across normalization approaches (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2</xref>).</p><p id="P25">However, these advantages come at the expense of a higher computational burden, particularly when compared to PB methods or KS approaches (<xref ref-type="fig" rid="F5">Figure 5</xref>). Nonetheless, by employing clever computational techniques (i.e., parallel computing and C++ coding within R), the method runs within minutes on a laptop, even for large datasets. Overall, we believe that <italic>distinct</italic> represents a valid alternative for differential detections from single-cell data, particularly when interest lies beyond canonical differences in means, as it allows to enhance statistical power at the cost of a reasonable increase in the computational time.</p><p id="P26">Finally, although we have focused here on comparing two groups of samples, several future extensions are possible to allow our framework to be applied to different scenarios. For instance, by suitably modifying the test statistics in <xref ref-type="disp-formula" rid="FD1">(1)</xref>, one may ideally extend our approach to perform a joint differential test between three of more groups of samples. Although, it is worth noting that, in the presence of three or more experimental conditions, at present, it is still possible to run pairwise comparisons between pairs of conditions. While a joint test across all groups may certainly be of interest in some cases, from our experience, comparisons between pairs of groups are usually more used among scientists. In addition, as we were suggested by a user, <italic>distinct</italic> could be employed to compare cell clusters instead of experimental conditions, hence discovering differential genes between cell clusters (e.g., cell types), even from individual samples.</p></sec><sec id="S7" sec-type="methods" specific-use="web-only"><title>Methods</title><sec id="S8"><title>Permutation test</title><p id="P27">In order to test for differences between groups, we employ a hierarchical permutation approach: to estimate the null distribution of <italic>s</italic><sup><italic>obs</italic></sup>, we permute the individual observations (e.g., single-cell measurements) instead of the samples. Note that this violates the exchangeability assumption of permutation tests and, hence, p-values are not guaranteed to be uniformly distributed under the null hypothesis; nonetheless, in our simulated and experimental analyses, we empirically show that <italic>distinct</italic> provides good control of both false positive and false discovery rates. We randomly permute individual observations <italic>P</italic> times across all samples and groups, by retaining the original sample sizes. We denote by <italic>s</italic><sub><italic>p</italic></sub> the test statistic computed at the <italic>p</italic>-th permutation, <italic>p</italic> = 1, …, <italic>P</italic>. A p-value, <inline-formula><mml:math id="M5"><mml:mrow><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula>, is obtained as [<xref ref-type="bibr" rid="R20">20</xref>]: <disp-formula id="FD2"><label>(2)</label><mml:math id="M6"><mml:mrow><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mo>Σ</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>P</mml:mi></mml:msubsup><mml:mn>1</mml:mn><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mo>≥</mml:mo><mml:msup><mml:mi>s</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <bold>1</bold>(<italic>cond</italic>) is 1 if <italic>cond</italic> is true, and 0 otherwise. In order to accurately infer small p-values, when <inline-formula><mml:math id="M7"><mml:mrow><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> is below some pre-defined thresholds, the number of permutations are automatically increased and <inline-formula><mml:math id="M8"><mml:mrow><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> is re-computed. By default, <italic>distinct</italic> initially computes 100 permutations; when <inline-formula><mml:math id="M9"><mml:mrow><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo>≤</mml:mo><mml:mn>0.1</mml:mn></mml:mrow></mml:math></inline-formula> these are increased to 500; when the new <inline-formula><mml:math id="M10"><mml:mrow><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo>≤</mml:mo><mml:mn>0.01</mml:mn></mml:mrow></mml:math></inline-formula> we use 2, 000 permutations, which are further increased to 10, 000 if <inline-formula><mml:math id="M11"><mml:mrow><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo>≤</mml:mo><mml:mn>0.001</mml:mn></mml:mrow></mml:math></inline-formula>. Note that the number of permutations (i.e., 100, 500, 2,000 and 10,000) can be specified by the user.</p></sec><sec id="S9"><title>Covariates</title><p id="P28">Assume we observe <italic>Z</italic> nuisance covariates, and that <italic>N</italic> samples are available across all groups, where for the <italic>i</italic>-th sample we observe <italic>C</italic><sub><italic>i</italic></sub> values (e.g., single-cell measurements). We fit the following linear mixed effects model: <disp-formula id="FD3"><label>(3)</label><mml:math id="M12"><mml:mrow><mml:msubsup><mml:mi>y</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>z</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>Z</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>β</mml:mi><mml:mi>z</mml:mi></mml:msub><mml:msubsup><mml:mi>X</mml:mi><mml:mi>z</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle><mml:mo>+</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msubsup><mml:mo>ϵ</mml:mo><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mspace width="0.2em"/><mml:mtext>for</mml:mtext><mml:mspace width="0.2em"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.2em"/><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.2em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.2em"/><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.2em"/><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M13"><mml:mrow><mml:msubsup><mml:mi>y</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> represents the <italic>c</italic>-th observation for the <italic>i</italic>-th sample, <italic>β</italic><sub>0</sub> is the intercept of the model, <inline-formula><mml:math id="M14"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>z</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> indicates the <italic>z</italic>-th covariate in the <italic>i</italic>-th sample, <italic>β</italic><sub><italic>z</italic></sub> denotes the fixed effect coefficient for the <italic>z</italic>-th covariate, <italic>α</italic><sub><italic>i</italic></sub> represents the random effect term for the <italic>i</italic>-th sample, and <inline-formula><mml:math id="M15"><mml:mrow><mml:msubsup><mml:mo>ϵ</mml:mo><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> is the (zero-mean) residual for the <italic>c</italic>-th observation in the <italic>i</italic>-th sample. We assume that random terms are normally distributed as <inline-formula><mml:math id="M16"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where – (<italic>a, b</italic>) denotes the normal distribution with mean <italic>a</italic> and variance <italic>b</italic>. Note that, due to the random effect terms, observations from the same sample are positively correlated while, observations between different samples are independent. We infer model parameters via maximum likelihood, with the estimated values for the fixed effect terms denoted by <inline-formula><mml:math id="M17"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>Z</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. We then remove the estimated effect of nuisance covariates as <inline-formula><mml:math id="M18"><mml:mrow><mml:msubsup><mml:mi>y</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>Σ</mml:mi><mml:mrow><mml:mi>z</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>Z</mml:mi></mml:msubsup><mml:msub><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>Z</mml:mi></mml:msub><mml:msubsup><mml:mi>X</mml:mi><mml:mi>z</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>; differential testing is performed, as described above, on these normalized values. In DS analyses, model <xref ref-type="disp-formula" rid="FD3">(3)</xref> is fit, separately, for every genecluster combination, hence accommodating for cell-type specific effects of covariates.</p></sec><sec id="S10"><title>Normalization</title><p id="P29">In scRNA-seq datasets, CPMs and logcounts were computed via <italic>scater</italic> Bioconductor R package [<xref ref-type="bibr" rid="R18">18</xref>], vstresiduals were calculated via <italic>sctransform</italic> R package [<xref ref-type="bibr" rid="R11">11</xref>] (except for the <italic>T-cells</italic> data, where, due to a failure of <italic>sctransform</italic>’s variance stabilizing normalization, we used <italic>DESeq2</italic>’s vst transformation [<xref ref-type="bibr" rid="R15">15</xref>]), while <italic>linnorm</italic> and <italic>BASiCS</italic> normalized data were calculated with the respective Bioconductor R packages [<xref ref-type="bibr" rid="R9">9</xref>, <xref ref-type="bibr" rid="R28">28</xref>, <xref ref-type="bibr" rid="R29">29</xref>, <xref ref-type="bibr" rid="R33">33</xref>].</p><p id="P30">In mass cytometry datasets, measurements were transformed via <italic>diffcyt</italic>’s <italic>transformData</italic> function, which applies an <italic>arcsinh</italic> transformation.</p></sec><sec id="S11"><title><italic>muscat</italic> simulation and <italic>Kang</italic> data</title><p id="P31">In all <italic>muscat</italic> simulations, we used the control samples of the <italic>Kang</italic> dataset as a anchor data; as in the real data analyses, we excluded one sample as it emerged as a potential outlier (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figures 5-7</xref>), and only considered singlet cells and cells assigned to a cell population. In <italic>muscat</italic>’s simulation studies, we considered gene-cluster combinations with simulated expression mean greater than 0.2; for DB patterns, we increased this threshold to 1 because with low expression values differences are not visible by eye. In the simulation when varying the library size (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 4</xref>), we filtered gene-clusters combinations with at least 50 non-zero cells. For every simulations, five replicates were simulated, and results were averaged across replicates. In the main simulation (<xref ref-type="fig" rid="F2">Figure 2</xref>) and the batch effect simulation (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3</xref>), we simulated from a paired design 2 groups of 3 samples each, with 4,000 genes, and 3,600 cells distributed in 3 clusters (corresponding to an average of 200 cells per sample in each cluster). For the simulation study when varying the number of cells (<xref ref-type="fig" rid="F4">Figure 4</xref> and <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3</xref>), the total numbers of available cells were 900, 1,800, 3,600 and 7,200, corresponding to an average of 50, 100, 200 and 400 cells per sample in every cluster. For the differential simulations, we used log2-FC values of 1 for DE, 1.5 for DP and DM, and 3 for DB and DV. For the batch effect simulation study we used a modified version of <italic>muscat</italic>, developed by Almut Luetge at the Robinson lab (available at: <ext-link ext-link-type="uri" xlink:href="https://github.com/SimoneTiberi/distinct_manuscript">https://github.com/SimoneTiberi/distinct_manuscript</ext-link>), which allows simulating cluster-specific batch effects [<xref ref-type="bibr" rid="R6">6</xref>, <xref ref-type="bibr" rid="R16">16</xref>]. All <italic>muscat</italic> simulation studies, as well as the <italic>Kang</italic> non-null data analysis, were performed by editing the original snakemake workflow from Crowell <italic>et al</italic>. [<xref ref-type="bibr" rid="R6">6</xref>]. PB methods were applied on aggregated data by summing cell-level measurements; for differential testing, we used <italic>muscat</italic>’s <italic>pbDS</italic> function [<xref ref-type="bibr" rid="R6">6</xref>]. Mixed model methods were implemented, via <italic>muscat</italic>’s <italic>mmDS</italic> function, using the same approaches as in Crowell <italic>et al</italic>. [<xref ref-type="bibr" rid="R6">6</xref>]: in <italic>MM-dream2</italic> and <italic>MM-vstresiduals</italic> linear mixed models were applied to log-normalized data with observational weights and variance-stabilized data, respectively, while in <italic>MM-nbinom</italic> generalized linear mixed models were fitted directly to raw counts. In the <italic>muscat</italic> simulations and in the <italic>Kang</italic> non-null data analysis, we accounted for the paired design by modelling the patient id as a covariate in all methods that allow for covariates (i.e., <italic>distinct</italic>, PB and MM).</p></sec><sec id="S12"><title><italic>splatPop</italic> simulation</title><p id="P32">In <italic>SplatPOP</italic> simulated data, we used a human genome, version 19, downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.gencodegenes.org/human/release_19.html">https://www.gencodegenes.org/human/release_19.html</ext-link>. We ran a total of 16 simulations: 8 with and 8 without batch effects as nuisance covariate. In each case, we ran 4 differential location (“de.facLoc” parameter) and 4 differential scale (“de.facScale” parameter) simulations, with differential parameters equals to 0.2, 0.5, 1 and 1.5. In every simulation, 10% of genes were differential between groups, and a total of 20,345 genes and 800 cells were simulated (100 per sample). In the simulation with batch effects, the 8 samples were randomly assigned to 2 batches, and the differential location and scale parameters between batches (“batch.facLoc” and “batch.facScale”, respectively) matched those between groups of samples (“de.facLoc” and “de.facScale”). For more details on how <italic>SplatPOP</italic>’s data is simulated, please refer to the original manuscript [<xref ref-type="bibr" rid="R2">2</xref>] and vignettes.</p></sec><sec id="S13"><title><italic>diffcyt</italic> simulation</title><p id="P33">The <italic>diffcyt</italic> semi-simulated data originates from a real mass cytometry dataset of healthy peripheral blood mononuclear cells from two paired groups of 8 samples each [<xref ref-type="bibr" rid="R4">4</xref>]; one group contains unstimulated cells, while the other was stimulated with B cell receptor/Fc receptor cross-linker. The original dataset contains a total of 172,791 cells and 24 protein markers: 10 of these are cell-type markers used for cell clustering, while 14 are cell state markers used for differential state analyses; the distinction between cell state and cell-type markers is based on prior biological knowledge [<xref ref-type="bibr" rid="R31">31</xref>]. In Weber <italic>et al</italic>. [<xref ref-type="bibr" rid="R31">31</xref>], semi-simulated data were generated by separating the cells of each unstimulated sample in two artificial samples; a differential signal was then computationally introduced by replacing, in one group, unstimulated B cells with B cells from stimulated samples. Measurements were transformed and cells clustered via <italic>diffcyt</italic>’s <italic>transformData</italic> (which applies an <italic>arcsinh</italic> transformation) and <italic>generateClusters</italic> functions, respectively. For the DS simulation in <xref ref-type="fig" rid="F7">Figure 7b</xref>, as in Weber <italic>et al</italic>. [<xref ref-type="bibr" rid="R31">31</xref>], we evaluated methods’ performance in terms of detecting DS for phosphorylated ribosomal protein S6 (pS6) in B cells, which is the strongest differential signal across the cell types in this dataset [<xref ref-type="bibr" rid="R19">19</xref>, <xref ref-type="bibr" rid="R31">31</xref>]. For the DS simulation in <xref ref-type="fig" rid="F7">Figure 7a</xref>, we considered previously manually annotated cell types [<xref ref-type="bibr" rid="R31">31</xref>] and included all 14 cell state markers. <italic>diffcyt</italic>’s <italic>limma</italic> and LMM methods were applied via <italic>diffcyt</italic>’s <italic>testDS_limma</italic> and <italic>testDS_LMM</italic> functions, respectively [<xref ref-type="bibr" rid="R31">31</xref>]. We accounted for the paired design by modelling the patient id as a covariate.</p></sec><sec id="S14"><title>P-values adjustment</title><p id="P34">All p-values were adjusted via Benjamini-Hochberg correction [<xref ref-type="bibr" rid="R3">3</xref>]. In <italic>diffcyt</italic> simulations we used globally adjusted p-values for all methods, i.e., p-values from all clusters are jointly adjusted once. However, since PB methods were found to be over-conservative when globally adjusting p-values [<xref ref-type="bibr" rid="R6">6</xref>], in <italic>muscat</italic> simulations and <italic>Kang</italic> discovery analyses, we used locally adjusted p-values for all methods.</p></sec><sec id="S15"><title>Software versions</title><p id="P35">All analyses were performed via R software version 4.0.0, with Bioconductor packages from release 3.11.</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary material</label><media xlink:href="EMS144148-supplement-Supplementary_material.pdf" mimetype="application" mime-subtype="pdf" id="d26aAeEbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S16"><title>Acknowledgements</title><p>We acknowledge Almut Luetge, Brian D M Tom, Christina Azodi, Davis McCarthy, Reinhard Furrer, and the entire Robinson lab for precious comments and suggestions. This work was supported by Forschungskredit to ST (grant number FK-19-113) as well as by the Swiss National Science Foundation to MDR (grants 310030_175841, CRSII5_177208). MDR acknowledges support from the University Research Priority Program Evolution in Action at the University of Zurich.</p></ack><sec id="S17" sec-type="data-availability"><title>Availability</title><p id="P36"><italic>distinct</italic> is freely available as a Bioconductor R package at: <ext-link ext-link-type="uri" xlink:href="https://bioconductor.org/packages/distinct">https://bioconductor.org/packages/distinct</ext-link>. The scripts used to run all analyses are available on GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/SimoneTiberi/distinct_manuscript">https://github.com/SimoneTiberi/distinct_manuscript</ext-link>, version v3) and Zenodo (DOI: 10.5281/zenodo.6397114). The <italic>diffcyt</italic> simulated data is available via FlowRepository (accession ID FR-FCM-ZYL8 [<xref ref-type="bibr" rid="R31">31</xref>]) and <italic>HDCytoData</italic> R Bioconductor package [<xref ref-type="bibr" rid="R32">32</xref>]; the <italic>Kang</italic> dataset can be accessed via <italic>musc-Data</italic> R Bioconductor package [<xref ref-type="bibr" rid="R5">5</xref>]; the <italic>T-cells</italic> dataset is deposited on the European Genome-phenome (accession id EGAD00001003910 [<xref ref-type="bibr" rid="R35">35</xref>]).</p></sec><fn-group><fn id="FN1" fn-type="con"><p id="P37"><bold>Author contributions</bold></p><p id="P38">ST conceived the method, implemented it, performed all analyses and wrote the manuscript. ST and MDR designed the study. HLC and LMW contributed to <italic>muscat</italic> and <italic>diffcyt</italic> simulation studies, respectively. PS contributed to the computational development of <italic>distinct</italic> and to the revision process. All authors read, contributed to, and approved the final article.</p></fn><fn id="FN2" fn-type="conflict"><p id="P39"><bold>Competing interests</bold></p><p id="P40">The authors declare no competing interests.</p></fn></fn-group><ref-list><ref id="R1"><label>[1]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Amezquita</surname><given-names>RA</given-names></name><name><surname>Lun</surname><given-names>AT</given-names></name><name><surname>Becht</surname><given-names>E</given-names></name><name><surname>Carey</surname><given-names>VJ</given-names></name><name><surname>Carpp</surname><given-names>LN</given-names></name><name><surname>Geistlinger</surname><given-names>L</given-names></name><name><surname>Marini</surname><given-names>F</given-names></name><name><surname>Rue-Albrecht</surname><given-names>K</given-names></name><name><surname>Risso</surname><given-names>D</given-names></name><name><surname>Soneson</surname><given-names>C</given-names></name><etal/></person-group><article-title>Orchestrating single-cell analysis with bioconductor</article-title><source>Nature methods</source><year>2020</year><volume>17</volume><issue>2</issue><fpage>137</fpage><lpage>145</lpage></element-citation></ref><ref id="R2"><label>[2]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Azodi</surname><given-names>CB</given-names></name><name><surname>Zappia</surname><given-names>L</given-names></name><name><surname>Oshlack</surname><given-names>A</given-names></name><name><surname>McCarthy</surname><given-names>DJ</given-names></name></person-group><article-title>splatPop: simulating population scale single-cell RNA sequencing data</article-title><source>Genome biology</source><year>2021</year><volume>22</volume><issue>1</issue><fpage>1</fpage><lpage>16</lpage></element-citation></ref><ref id="R3"><label>[3]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Benjamini</surname><given-names>Y</given-names></name><name><surname>Hochberg</surname><given-names>Y</given-names></name></person-group><article-title>Controlling the false discovery rate: a practical and powerful approach to multiple testing</article-title><source>Journal of the Royal statistical society: series B (Methodological)</source><year>1995</year><volume>57</volume><issue>1</issue><fpage>289</fpage><lpage>300</lpage></element-citation></ref><ref id="R4"><label>[4]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bodenmiller</surname><given-names>B</given-names></name><name><surname>Zunder</surname><given-names>ER</given-names></name><name><surname>Finck</surname><given-names>R</given-names></name><name><surname>Chen</surname><given-names>TJ</given-names></name><name><surname>Savig</surname><given-names>ES</given-names></name><name><surname>Bruggner</surname><given-names>RV</given-names></name><name><surname>Simonds</surname><given-names>EF</given-names></name><name><surname>Bendall</surname><given-names>SC</given-names></name><name><surname>Sachs</surname><given-names>K</given-names></name><name><surname>Krutzik</surname><given-names>PO</given-names></name><etal/></person-group><article-title>Multiplexed mass cytometry profiling of cellular states perturbed by small-molecule regulators</article-title><source>Nature biotechnology</source><year>2012</year><volume>30</volume><issue>9</issue><fpage>858</fpage><lpage>867</lpage></element-citation></ref><ref id="R5"><label>[5]</label><element-citation publication-type="other"><person-group person-group-type="author"><name><surname>Crowell</surname><given-names>HL</given-names></name></person-group><article-title>muscData: Multi-sample multi-group scRNA-seq data</article-title><source>R package version 112</source><year>2020</year></element-citation></ref><ref id="R6"><label>[6]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Crowell</surname><given-names>HL</given-names></name><name><surname>Soneson</surname><given-names>C</given-names></name><name><surname>Germain</surname><given-names>P-L</given-names></name><name><surname>Calini</surname><given-names>D</given-names></name><name><surname>Collin</surname><given-names>L</given-names></name><name><surname>Raposo</surname><given-names>C</given-names></name><name><surname>Malhotra</surname><given-names>D</given-names></name><name><surname>Robinson</surname><given-names>MD</given-names></name></person-group><article-title>muscat detects subpopulation-specific state transitions from multi-sample multi-condition single-cell tran-scriptomics data</article-title><source>Nature Communications</source><year>2020</year><volume>11</volume><issue>1</issue><fpage>1</fpage><lpage>12</lpage></element-citation></ref><ref id="R7"><label>[7]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Csardi</surname><given-names>G</given-names></name><name><surname>Nepusz</surname><given-names>T</given-names></name></person-group><article-title>The igraph software package for complex network research</article-title><source>InterJournal Complex Systems</source><year>2006</year><volume>1695</volume></element-citation></ref><ref id="R8"><label>[8]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Doherty</surname><given-names>MR</given-names></name><name><surname>Cheon</surname><given-names>H</given-names></name><name><surname>Junk</surname><given-names>DJ</given-names></name><name><surname>Vinayak</surname><given-names>S</given-names></name><name><surname>Varadan</surname><given-names>V</given-names></name><name><surname>Telli</surname><given-names>ML</given-names></name><name><surname>Ford</surname><given-names>JM</given-names></name><name><surname>Stark</surname><given-names>GR</given-names></name><name><surname>Jackson</surname><given-names>MW</given-names></name></person-group><article-title>Interferon-beta represses cancer stem cell properties in triple-negative breast cancer</article-title><source>Proceedings of the National Academy of Sciences</source><year>2017</year><volume>114</volume><issue>52</issue><fpage>13792</fpage><lpage>13797</lpage></element-citation></ref><ref id="R9"><label>[9]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eling</surname><given-names>N</given-names></name><name><surname>Richard</surname><given-names>AC</given-names></name><name><surname>Richardson</surname><given-names>S</given-names></name><name><surname>Marioni</surname><given-names>JC</given-names></name><name><surname>Vallejos</surname><given-names>CA</given-names></name></person-group><article-title>Correcting the mean-variance dependency for differential variability testing using single-cell RNA sequencing data</article-title><source>Cell systems</source><year>2018</year><volume>7</volume><issue>3</issue><fpage>284</fpage><lpage>294</lpage></element-citation></ref><ref id="R10"><label>[10]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Finak</surname><given-names>G</given-names></name><name><surname>McDavid</surname><given-names>A</given-names></name><name><surname>Yajima</surname><given-names>M</given-names></name><name><surname>Deng</surname><given-names>J</given-names></name><name><surname>Gersuk</surname><given-names>V</given-names></name><name><surname>Shalek</surname><given-names>AK</given-names></name><name><surname>Slichter</surname><given-names>CK</given-names></name><name><surname>Miller</surname><given-names>HW</given-names></name><name><surname>McElrath</surname><given-names>MJ</given-names></name><name><surname>Prlic</surname><given-names>M</given-names></name><etal/></person-group><article-title>MAST: a flexible statistical framework for assessing transcriptional changes and characterizing heterogeneity in single-cell RNA sequencing data</article-title><source>Genome biology</source><year>2015</year><volume>16</volume><issue>1</issue><fpage>1</fpage><lpage>13</lpage></element-citation></ref><ref id="R11"><label>[11]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hafemeister</surname><given-names>C</given-names></name><name><surname>Satija</surname><given-names>R</given-names></name></person-group><article-title>Normalization and variance stabilization of single-cell RNA-seq data using regularized negative binomial regression</article-title><source>Genome biology</source><year>2019</year><volume>20</volume><issue>1</issue><fpage>1</fpage><lpage>15</lpage></element-citation></ref><ref id="R12"><label>[12]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kang</surname><given-names>HM</given-names></name><name><surname>Subramaniam</surname><given-names>M</given-names></name><name><surname>Targ</surname><given-names>S</given-names></name><name><surname>Nguyen</surname><given-names>M</given-names></name><name><surname>Maliskova</surname><given-names>L</given-names></name><name><surname>McCarthy</surname><given-names>E</given-names></name><name><surname>Wan</surname><given-names>E</given-names></name><name><surname>Wong</surname><given-names>S</given-names></name><name><surname>Byrnes</surname><given-names>L</given-names></name><name><surname>Lanata</surname><given-names>CM</given-names></name><etal/></person-group><article-title>Multiplexed droplet single-cell RNA-sequencing using natural genetic variation</article-title><source>Nature biotechnology</source><year>2018</year><volume>36</volume><issue>1</issue><fpage>89</fpage></element-citation></ref><ref id="R13"><label>[13]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kharchenko</surname><given-names>PV</given-names></name><name><surname>Silberstein</surname><given-names>L</given-names></name><name><surname>Scadden</surname><given-names>DT</given-names></name></person-group><article-title>Bayesian approach to single-cell differential expression analysis</article-title><source>Nature methods</source><year>2014</year><volume>11</volume><issue>7</issue><fpage>740</fpage><lpage>742</lpage></element-citation></ref><ref id="R14"><label>[14]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Korthauer</surname><given-names>KD</given-names></name><name><surname>Chu</surname><given-names>L-F</given-names></name><name><surname>Newton</surname><given-names>MA</given-names></name><name><surname>Li</surname><given-names>Y</given-names></name><name><surname>Thomson</surname><given-names>J</given-names></name><name><surname>Stewart</surname><given-names>R</given-names></name><name><surname>Kendziorski</surname><given-names>C</given-names></name></person-group><article-title>A statistical approach for identifying differential distributions in single-cell RNA-seq experiments</article-title><source>Genome biology</source><year>2016</year><volume>17</volume><issue>1</issue><elocation-id>222</elocation-id></element-citation></ref><ref id="R15"><label>[15]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Love</surname><given-names>MI</given-names></name><name><surname>Huber</surname><given-names>W</given-names></name><name><surname>Anders</surname><given-names>S</given-names></name></person-group><article-title>Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2</article-title><source>Genome biology</source><year>2014</year><volume>15</volume><issue>12</issue><elocation-id>550</elocation-id></element-citation></ref><ref id="R16"><label>[16]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lütge</surname><given-names>A</given-names></name><name><surname>Zyprych-Walczak</surname><given-names>J</given-names></name><name><surname>Kunzmann</surname><given-names>UB</given-names></name><name><surname>Crowell</surname><given-names>HL</given-names></name><name><surname>Calini</surname><given-names>D</given-names></name><name><surname>Malhotra</surname><given-names>D</given-names></name><name><surname>Soneson</surname><given-names>C</given-names></name><name><surname>Robinson</surname><given-names>MD</given-names></name></person-group><article-title>Cellmixs: quantifying and visualizing batch effects in single-cell rna-seq data</article-title><source>Life science alliance</source><year>2021</year><volume>4</volume><issue>6</issue></element-citation></ref><ref id="R17"><label>[17]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Massey</surname><given-names>FJ</given-names></name></person-group><article-title>The kolmogorov-smirnov test for goodness of fit</article-title><source>Journal of the American statistical Association</source><year>1951</year><volume>46</volume><issue>253</issue><fpage>68</fpage><lpage>78</lpage></element-citation></ref><ref id="R18"><label>[18]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McCarthy</surname><given-names>DJ</given-names></name><name><surname>Campbell</surname><given-names>KR</given-names></name><name><surname>Lun</surname><given-names>AT</given-names></name><name><surname>Wills</surname><given-names>QF</given-names></name></person-group><article-title>Scater: pre-processing, quality control, normalization and visualization of single-cell RNA-seq data in R</article-title><source>Bioinformatics</source><year>2017</year><volume>33</volume><issue>8</issue><fpage>1179</fpage><lpage>1186</lpage></element-citation></ref><ref id="R19"><label>[19]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nowicka</surname><given-names>M</given-names></name><name><surname>Krieg</surname><given-names>C</given-names></name><name><surname>Weber</surname><given-names>LM</given-names></name><name><surname>Hartmann</surname><given-names>FJ</given-names></name><name><surname>Guglietta</surname><given-names>S</given-names></name><name><surname>Becher</surname><given-names>B</given-names></name><name><surname>Levesque</surname><given-names>MP</given-names></name><name><surname>Robinson</surname><given-names>MD</given-names></name></person-group><article-title>CyTOF workflow: differential discovery in high-throughput high-dimensional cytometry datasets</article-title><source>F1000Research</source><year>2017</year><volume>6</volume></element-citation></ref><ref id="R20"><label>[20]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Phipson</surname><given-names>B</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group><article-title>Permutation p-values should never be zero: Calculating exact p-values when permutations are randomly drawn</article-title><source>Statistical applications in genetics and molecular biology</source><year>2010</year><volume>9</volume><elocation-id>39</elocation-id></element-citation></ref><ref id="R21"><label>[21]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Qin</surname><given-names>X-Q</given-names></name><name><surname>Tao</surname><given-names>N</given-names></name><name><surname>Dergay</surname><given-names>A</given-names></name><name><surname>Moy</surname><given-names>P</given-names></name><name><surname>Fawell</surname><given-names>S</given-names></name><name><surname>Davis</surname><given-names>A</given-names></name><name><surname>Wilson</surname><given-names>JM</given-names></name><name><surname>Barsoum</surname><given-names>J</given-names></name></person-group><article-title>Interferon-β gene therapy inhibits tumor formation and causes regression of established tumors in immune-deficient mice</article-title><source>Proceedings of the National Academy of Sciences</source><year>1998</year><volume>95</volume><issue>24</issue><fpage>14411</fpage><lpage>14416</lpage></element-citation></ref><ref id="R22"><label>[22]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ritchie</surname><given-names>ME</given-names></name><name><surname>Phipson</surname><given-names>B</given-names></name><name><surname>Wu</surname><given-names>D</given-names></name><name><surname>Hu</surname><given-names>Y</given-names></name><name><surname>Law</surname><given-names>CW</given-names></name><name><surname>Shi</surname><given-names>W</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group><article-title>limma powers differential expression analyses for RNA-sequencing and microarray studies</article-title><source>Nucleic acids research</source><year>2015</year><volume>43</volume><issue>7</issue><fpage>e47</fpage></element-citation></ref><ref id="R23"><label>[23]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robinson</surname><given-names>MD</given-names></name><name><surname>McCarthy</surname><given-names>DJ</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group><article-title>edgeR: a Bioconductor package for differential expression analysis of digital gene expression data</article-title><source>Bioinformatics</source><year>2010</year><volume>26</volume><issue>1</issue><fpage>139</fpage><lpage>140</lpage></element-citation></ref><ref id="R24"><label>[24]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Soneson</surname><given-names>C</given-names></name><name><surname>Robinson</surname><given-names>MD</given-names></name></person-group><article-title>Bias, robustness and scalability in single-cell differential expression analysis</article-title><source>Nature methods</source><year>2018</year><volume>15</volume><issue>4</issue><fpage>255</fpage></element-citation></ref><ref id="R25"><label>[25]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Squair</surname><given-names>JW</given-names></name><name><surname>Gautier</surname><given-names>M</given-names></name><name><surname>Kathe</surname><given-names>C</given-names></name><name><surname>Anderson</surname><given-names>MA</given-names></name><name><surname>James</surname><given-names>ND</given-names></name><name><surname>Hutson</surname><given-names>TH</given-names></name><name><surname>Hudelle</surname><given-names>R</given-names></name><name><surname>Qaiser</surname><given-names>T</given-names></name><name><surname>Matson</surname><given-names>KJ</given-names></name><name><surname>Barraud</surname><given-names>Q</given-names></name><etal/></person-group><article-title>Confronting false discoveries in single-cell differential expression</article-title><source>bioRxiv</source><year>2021</year></element-citation></ref><ref id="R26"><label>[26]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tung</surname><given-names>P-Y</given-names></name><name><surname>Blischak</surname><given-names>JD</given-names></name><name><surname>Hsiao</surname><given-names>CJ</given-names></name><name><surname>Knowles</surname><given-names>DA</given-names></name><name><surname>Burnett</surname><given-names>JE</given-names></name><name><surname>Pritchard</surname><given-names>JK</given-names></name><name><surname>Gilad</surname><given-names>Y</given-names></name></person-group><article-title>Batch effects and the effective design of single-cell gene expression studies</article-title><source>Scientific reports</source><year>2017</year><volume>7</volume><elocation-id>39921</elocation-id></element-citation></ref><ref id="R27"><label>[27]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Uhlén</surname><given-names>M</given-names></name><name><surname>Fagerberg</surname><given-names>L</given-names></name><name><surname>Hallström</surname><given-names>BM</given-names></name><name><surname>Lindskog</surname><given-names>C</given-names></name><name><surname>Oksvold</surname><given-names>P</given-names></name><name><surname>Mardinoglu</surname><given-names>A</given-names></name><name><surname>Sivertsson</surname><given-names>Å</given-names></name><name><surname>Kampf</surname><given-names>C</given-names></name><name><surname>Sjöstedt</surname><given-names>E</given-names></name><name><surname>Asplund</surname><given-names>A</given-names></name><etal/></person-group><article-title>Tissue-based map of the human proteome</article-title><source>Science</source><year>2015</year><volume>347</volume><issue>6220</issue></element-citation></ref><ref id="R28"><label>[28]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vallejos</surname><given-names>CA</given-names></name><name><surname>Marioni</surname><given-names>JC</given-names></name><name><surname>Richardson</surname><given-names>S</given-names></name></person-group><article-title>BASiCS: Bayesian analysis of single-cell sequencing data</article-title><source>PLoS computational biology</source><year>2015</year><volume>11</volume><issue>6</issue><elocation-id>e1004333</elocation-id></element-citation></ref><ref id="R29"><label>[29]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vallejos</surname><given-names>CA</given-names></name><name><surname>Richardson</surname><given-names>S</given-names></name><name><surname>Marioni</surname><given-names>JC</given-names></name></person-group><article-title>Beyond comparisons of means: understanding changes in gene expression at the single-cell level</article-title><source>Genome biology</source><year>2016</year><volume>17</volume><issue>1</issue><fpage>1</fpage><lpage>14</lpage></element-citation></ref><ref id="R30"><label>[30]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>T</given-names></name><name><surname>Li</surname><given-names>B</given-names></name><name><surname>Nelson</surname><given-names>CE</given-names></name><name><surname>Nabavi</surname><given-names>S</given-names></name></person-group><article-title>Comparative analysis of differential gene expression analysis tools for single-cell RNA sequencing data</article-title><source>BMC bioinformatics</source><year>2019</year><volume>20</volume><issue>1</issue><fpage>40</fpage></element-citation></ref><ref id="R31"><label>[31]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weber</surname><given-names>LM</given-names></name><name><surname>Nowicka</surname><given-names>M</given-names></name><name><surname>Soneson</surname><given-names>C</given-names></name><name><surname>Robinson</surname><given-names>MD</given-names></name></person-group><article-title>diffcyt: Differential discovery in high-dimensional cytometry via high-resolution clustering</article-title><source>Communications biology</source><year>2019</year><volume>2</volume><issue>1</issue><fpage>1</fpage><lpage>11</lpage></element-citation></ref><ref id="R32"><label>[32]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weber</surname><given-names>LM</given-names></name><name><surname>Soneson</surname><given-names>C</given-names></name></person-group><article-title>Hdcytodata: Collection of high-dimensional cytometry benchmark datasets in bioconductor object formats</article-title><source>F1000Research</source><year>2019</year><volume>8</volume></element-citation></ref><ref id="R33"><label>[33]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yip</surname><given-names>SH</given-names></name><name><surname>Wang</surname><given-names>P</given-names></name><name><surname>Kocher</surname><given-names>J-PA</given-names></name><name><surname>Sham</surname><given-names>PC</given-names></name><name><surname>Wang</surname><given-names>J</given-names></name></person-group><article-title>Linnorm: improved statistical analysis for single cell RNA-seq expression data</article-title><source>Nucleic acids research</source><year>2017</year><volume>45</volume><issue>22</issue><elocation-id>e179</elocation-id></element-citation></ref><ref id="R34"><label>[34]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zappia</surname><given-names>L</given-names></name><name><surname>Phipson</surname><given-names>B</given-names></name><name><surname>Oshlack</surname><given-names>A</given-names></name></person-group><article-title>Splatter: simulation of single-cell RNA sequencing data</article-title><source>Genome biology</source><year>2017</year><volume>18</volume><issue>1</issue><fpage>1</fpage><lpage>15</lpage></element-citation></ref><ref id="R35"><label>[35]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>Y</given-names></name><name><surname>Zheng</surname><given-names>L</given-names></name><name><surname>Zhang</surname><given-names>L</given-names></name><name><surname>Hu</surname><given-names>X</given-names></name><name><surname>Ren</surname><given-names>X</given-names></name><name><surname>Zhang</surname><given-names>Z</given-names></name></person-group><article-title>Deep single-cell RNA sequencing data of individual T cells from treatment-naive colorectal cancer patients</article-title><source>Scientific data</source><year>2019</year><volume>6</volume><issue>1</issue><fpage>1</fpage><lpage>15</lpage></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>Cumulative distribution functions (CDFs) unravel differences between distributions.</title><p>Density (left panels) and CDF (right panels) of five differential patterns: differential variability (DV), and the four proposed by Korthauer et. al. [<xref ref-type="bibr" rid="R14">14</xref>]: differential expression (DE), differential proportion (DP), differential modality (DM), and both differential modality and different component means (DB).</p></caption><graphic xlink:href="EMS144148-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title><italic>distinct</italic> identifies various differential patterns and controls for the FDR.</title><p>TPR <italic>vs</italic>. FDR in <italic>muscat</italic> simulated data; DE, DP, DM, DB and DV refer to the differential profiles illustrated in <xref ref-type="fig" rid="F1">Figure 1</xref>. Circles indicate observed FDR for 0.01, 0.05, 0.1 and 0.2 significance thresholds. Results are averages across the five simulation replicates. Each individual replicate consists of 4,000 genes, 3,600 cells, separated into 3 clusters, and two groups of 3 samples each, corresponding to an average of 200 cells per sample in each cluster.</p></caption><graphic xlink:href="EMS144148-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title><italic>distinct</italic> has uniform null p-values.</title><p>Density of raw p-values in <italic>muscat</italic> null simulated data; each replicate represents a different null simulation. Each individual replicate consists of 4,000 genes, 3,600 cells, separated into 3 clusters, and two groups of 3 samples each, corresponding to an average of 200 cells per sample in each cluster.</p></caption><graphic xlink:href="EMS144148-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title><italic>distinct</italic> achieves good performance when varying the number of available cells.</title><p>TPR <italic>vs</italic>. FDR in <italic>muscat</italic> simulated data; with 50, 100, 200 and 400 cells per cluster-sample combination, corresponding to a total of 900, 1,800, 3,600 and 7,200 cells, respectively. Results are aggregated over the five replicate simulations of each differential type (DE, DP, DM, DB and DV), contributing in equal fraction. Each individual simulation replicate consists of 4,000 genes, 3 cell clusters and two groups of 3 samples each. Circles indicate observed FDR for 0.01, 0.05, 0.1 and 0.2 significance thresholds. Note that <italic>scDD-perm</italic> and MM were excluded from this analysis due to their computational cost.</p></caption><graphic xlink:href="EMS144148-f004"/></fig><fig id="F5" position="float"><label>Figure 5</label><caption><title><italic>distinct</italic> requires more computational resources than PB and <italic>scDD-KS</italic> methods, but significantly less than MM and <italic>scDD-perm</italic> models.</title><p>Average computing time, expressed in minutes, in <italic>muscat</italic> main simulations (<xref ref-type="fig" rid="F2">Figures 2</xref>-<xref ref-type="fig" rid="F3">3</xref>). For each method, times are averaged across simulation types (DE, DP, DM, DB, DV and null) and, for each type, across the five replicate simulations; in each replicate 3,600 cells are available (200, on average, per cluster-sample combination). <italic>distinct</italic>, MM and <italic>scDD</italic> models were run on 3 cores, while pseudo-bulk methods based on <italic>edgeR</italic> and <italic>limma</italic> used a single core because they do not allow for parellel computing. Note that <italic>scDD-perm</italic> requires much longer on vstresiduals than on the other normalized data, because <italic>scDD</italic> performs differential testing on non-zero values: vstresiduals, (unlike linnorm, cpm and basics normalized data) are not zero-inflated and, therefore, many more cells have to be used for differential testing.</p></caption><graphic xlink:href="EMS144148-f005"/></fig><fig id="F6" position="float"><label>Figure 6</label><caption><title><italic>distinct</italic> displays higher TPR than competitors.</title><p>TPR <italic>vs</italic>. FDR in <italic>SplatPop</italic> simulated data, with various degrees of differential location (left) and scale (right) parameters, primarily affecting the mean and variance, respectively. Circles indicate observed FDR for 0.01, 0.05, 0.1 and 0.2 significance thresholds. Each simulation consists of 20,345 genes genes, 800 cells (belonging to the same cluster), and two groups of 4 samples each, corresponding to an average of 100 cells per sample.</p></caption><graphic xlink:href="EMS144148-f006"/></fig><fig id="F7" position="float"><label>Figure 7</label><caption><title><italic>distinct</italic> shows high power while controlling for false positive and false discovery rates.</title><p><bold>(a-b)</bold> TPR <italic>vs</italic>. FDR in <italic>diffcyt</italic> semi-simulated data. ‘main’, ‘less 50’ and ‘less 75’ indicate the main simulation, and those where differential effects are diluted by 50 and 75%, respectively. Each simulation consists of 88,435 cells and two groups of 8 samples each. Circles indicate observed FDR for 0.01, 0.05, 0.1 and 0.2 significance thresholds. <bold>(a)</bold> As in the <italic>muscat</italic> simulation study, cells were clustered into 8 populations based on manually annotated cell types [<xref ref-type="bibr" rid="R31">31</xref>]. <bold>(b)</bold> As in Weber <italic>et al</italic>. [<xref ref-type="bibr" rid="R31">31</xref>], cells were grouped in 100 high-resolution clusters via unsupervised clustering. <bold>(c)</bold> Density of raw p-values in <italic>diffcyt</italic> null semi-simulated data; each replicate represents a different null simulation. Each replicate consists of 88,438 cells and two groups of 8 samples each. As in Weber <italic>et al</italic>. [<xref ref-type="bibr" rid="R31">31</xref>], cells were clustered in an unsupervised manner.</p></caption><graphic xlink:href="EMS144148-f007"/></fig><fig id="F8" position="float"><label>Figure 8</label><caption><title>On experimental scRNA-seq data, <italic>distinct</italic> has almost-uniform null p-values.</title><p>Density of raw p-values in the null <italic>T-cells</italic> (top) and <italic>Kang</italic> (bottom) experimental data. Each replicate represents a random partition of samples in two groups. The <italic>T-cells</italic> data consists of 12 samples and 11,138 cells across 11 clusters. For the <italic>Kang</italic> dataset, we retained 7 samples and 11,854 cells across 8 clusters.</p></caption><graphic xlink:href="EMS144148-f008"/></fig><fig id="F9" position="float"><label>Figure 9</label><caption><title><italic>distinct</italic> discovers non-canonical differential patterns.</title><p>Density of logcounts for nine examples of differential patterns identified by <italic>distinct</italic> on all input data (adjusted p-values &lt; 0.05), and not by any PB tool (adjusted p-values &gt; 0.05), on the <italic>Kang</italic> dataset when comparing controls and stimulated samples. Gene RPL13 was identified in FCGR3A+ Monocytes (third row) and in NK cells (fourth row), while all other genes were detected in Dendritic cells. Each line represents a sample.</p></caption><graphic xlink:href="EMS144148-f009"/></fig><table-wrap id="T1" position="float" orientation="portrait"><label>Table 1</label><caption><p>Percentage of unique gene/cell-type identifications that are unique to each method. Since methods return significantly different number of significant results, for each method, we selected the most significant 1,000 results. For every method, we then compute the fraction of such results that are unique, i.e., not in common with the top 1,000 results returned by any other method.</p></caption><table frame="box" rules="cols"><thead><tr style="border-bottom: solid thin"><th align="left" valign="top">method</th><th align="left" valign="top">% of unique results</th></tr></thead><tbody><tr><td align="left" valign="top">distinct.logcounts</td><td align="right" valign="top">0.3</td></tr><tr><td align="left" valign="top">distinct.basics</td><td align="right" valign="top">0.8</td></tr><tr><td align="left" valign="top">limma-trend.logcounts</td><td align="right" valign="top">0.9</td></tr><tr><td align="left" valign="top">distinct.cpm</td><td align="right" valign="top">1.0</td></tr><tr><td align="left" valign="top">distinct.vstresiduals</td><td align="right" valign="top">1.1</td></tr><tr><td align="left" valign="top">edgeR.linnorm</td><td align="right" valign="top">1.2</td></tr><tr><td align="left" valign="top">limma-trend.vstresiduals</td><td align="right" valign="top">1.5</td></tr><tr><td align="left" valign="top">limma-trend.basics</td><td align="right" valign="top">1.5</td></tr><tr><td align="left" valign="top">edgeR.counts</td><td align="right" valign="top">1.7</td></tr><tr><td align="left" valign="top">edgeR.basics</td><td align="right" valign="top">3.0</td></tr><tr><td align="left" valign="top">distinct.linnorm</td><td align="right" valign="top">3.6</td></tr><tr><td align="left" valign="top">limma-trend.linnorm</td><td align="right" valign="top">3.7</td></tr><tr><td align="left" valign="top">limma-voom.counts</td><td align="right" valign="top">5.6</td></tr><tr><td align="left" valign="top">edgeR.cpm</td><td align="right" valign="top">10.4</td></tr><tr><td align="left" valign="top">limma-trend.cpm</td><td align="right" valign="top">26.8</td></tr></tbody></table></table-wrap></floats-group></article>