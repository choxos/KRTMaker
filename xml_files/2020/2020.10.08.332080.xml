<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ali="http://www.niso.org/schemas/ali/1.0/" article-type="preprint">
<?all-math-mml yes?>
<?use-mml?>
<?origin ukpmcpa?>
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">bioRxiv</journal-id>
<journal-title-group>
<journal-title>bioRxiv : the preprint server for biology</journal-title>
</journal-title-group>
<issn pub-type="ppub"/>
</journal-meta>
<article-meta>
<article-id pub-id-type="manuscript">EMS97940</article-id>
<article-id pub-id-type="doi">10.1101/2020.10.08.332080</article-id>
<article-id pub-id-type="archive">PPR224370</article-id>
<article-version article-version-type="publisher-id">1</article-version>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Article</subject>
</subj-group>
</article-categories>
<title-group>
<article-title>Batch-Corrected Distance Mitigates Temporal and Spatial Variability for Clustering and Visualization of Single-Cell Gene Expression Data</article-title>
</title-group>
<contrib-group>
<contrib contrib-type="author">
<name>
<surname>Liang</surname>
<given-names>Shaoheng</given-names>
</name>
<xref ref-type="aff" rid="A1">1</xref>
<xref ref-type="aff" rid="A2">2</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Dou</surname>
<given-names>Jinzhuang</given-names>
</name>
<xref ref-type="aff" rid="A1">1</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Iqbal</surname>
<given-names>Ramiz</given-names>
</name>
<xref ref-type="aff" rid="A1">1</xref>
</contrib>
<contrib contrib-type="author">
<name>
<surname>Chen</surname>
<given-names>Ken</given-names>
</name>
<xref ref-type="aff" rid="A1">1</xref>
</contrib>
</contrib-group>
<aff id="A1">
<label>1</label>Department of Bioinformatics and Computational Biology, MD Anderson Cancer Center</aff>
<aff id="A2">
<label>2</label>Department of Computer Science, Rice University</aff>
<pub-date pub-type="nihms-submitted">
<day>13</day>
<month>10</month>
<year>2020</year>
</pub-date>
<pub-date pub-type="preprint">
<day>09</day>
<month>10</month>
<year>2020</year>
</pub-date>
<permissions>
<license license-type="open-access" xlink:href="https://creativecommons.org/licenses/by/4.0/">
<license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 International license</ext-link>.</license-p>
</license>
</permissions>
<abstract>
<p id="P1">Clustering and visualization are essential parts of single-cell gene expression data analysis. The Euclidean distance used in most distance-based methods is not optimal. Batch effect, i.e., the variability among samples gathered from different times, tissues, and patients, introduces large between-group distance and obscures the true identities of cells. To solve this problem, we introduce Batch-Corrected Distance (BCD), a metric using temporal/spatial locality of the batch effect to control for such factors. We validate BCD on a simulated data as well as applied it to a mouse retina development dataset and a lung dataset. We also found the utility of our approach in understanding the progression of the Coronavirus Disease 2019 (COVID-19). BCD achieves more accurate clusters and better visualizations than state-of-the-art batch correction methods on longitudinal datasets. BCD can be directly integrated with most clustering and visualization methods to enable more scientific findings.</p>
</abstract>
</article-meta>
</front>
<body>
<sec id="S1" sec-type="intro">
<label>1</label>
<title>Introduction</title>
<p id="P2">Gene expression reflects the identity of a cell. Single-cell RNA sequencing (scRNA-seq) technologies profile thousands of cells simultaneously [<xref ref-type="bibr" rid="R1">1</xref>], enabling trajectory inference to reveal the course of cell development and transformation [<xref ref-type="bibr" rid="R2">2</xref>]. Although large amount of data have been gathered from different tissues among large cohorts of patients [<xref ref-type="bibr" rid="R3">3</xref>], technical variance among separately assayed samples often overshadow the similarity of cells, resulting in a less meaningful disconnected trajectories (<xref ref-type="fig" rid="F1">Figure 1a</xref>). In addition, nuisance differences among individual participants also blur the shared underlying biology. These phenomena, often referred to as batch effects, complicate the analysis of single-cell data. For samples collected from the same condition (i.e., same time and tissue but different participants), all the differences among samples may be deemed as batch effect and get corrected. Nevertheless, over-correction is reported [<xref ref-type="bibr" rid="R4">4</xref>], any can be a greater problem on longitudinal data, where true biological changes and nuisance factors are entwined (<xref ref-type="fig" rid="F1">Figure 1c</xref>).</p>
<p id="P3">As a practical example, researchers have collected data from the developing retina of 13 mice at different ages [<xref ref-type="bibr" rid="R5">5</xref>]. Ideally, the embedding of such data should reveal a fluent trajectory of how pluripotent stem cells differentiate/evolve into multipotent stem cells, and finally to specific cell types. However, a mouse may not survive the tissue extraction, and thus each sample in the dataset is from a unique mouse. Batch effect exists among samples collected from different mice. In addition, there is no bijective (i.e., injective and surjective) mapping for cells from different samples. Thus, existing methods addressing batch effect in longitudinal data assume that the features are measured on the same set of entities (cells) at different time points [<xref ref-type="bibr" rid="R6">6</xref>] are not applicable in this scenario. Besides, because single-cell profiling technologies consume a cell when measuring it, the cells would not be the same or matched even if the samples were collected from the same tissue from the same mouse.</p>
<p id="P4">To date, multiple methods have been published to correct batch effects [<xref ref-type="bibr" rid="R7">7</xref>]. For example, Seurat utilizes mutual nearest neighbor (MNN) to identify similar clusters in different batches and integrates those batches by removing the differences [<xref ref-type="bibr" rid="R8">8</xref>]. Harmony also integrates proximal clusters, but in an iterative way through soft clustering [<xref ref-type="bibr" rid="R9">9</xref>]. Liger uses nonnegative matrix factorization (NMF) to separate common and sample-specific features [<xref ref-type="bibr" rid="R10">10</xref>]. A neural network approach, scVI, combines variational autoencoder and zero-inflated model to visualize and correct the data. Notably, Harmony generates integrated clusters and visualization without giving a corrected expression profile. It is not deemed a significant drawback, however, because corrected datasets are often hard to interpret. Researchers usually only cluster and visualize the data using such methods, and recur to statistical tests that control for the batch effect in the downstream analyses [<xref ref-type="bibr" rid="R11">11</xref>]. These methods have been utilized in a few large-cohort studies and satisfyingly removed the batch effect among samples [<xref ref-type="bibr" rid="R8">8</xref>, <xref ref-type="bibr" rid="R9">9</xref>]. However, none of them are designed for longitudinal data.</p>
<p id="P5">In an effort to address this issue, we noticed the “locality” among the single-cell samples. Specifically, samples gathered in proximal time points are expected to be more alike than from distant times. Similarly, the later two cell types are differentiated in development, the more alike they will be. That means the difference between two samples is more likely to be nuisance if those samples are collected from the same time point or adjacent time points. Here, we define a new distance function, termed Batch-Corrected Distance (BCD) which exploits the locality to precisely remove the batch effect (<xref ref-type="fig" rid="F1">Figure 1b</xref>) but keep biologically meaningful information that forms the trajectory. We show the derivation of BCD in <xref ref-type="sec" rid="S2">section 2</xref>. As a distance metric, it is naturally compatible with all state-of-the-art distance-based clustering and embedding methods. We compare BCD with Euclidean distance, Seurat integration, and Harmony on simulated data and a mouse retina development data, and show applications of BCD on COVID-19 patient data and human fetal lung development data in <xref ref-type="sec" rid="S5">Section 3</xref>. The results clearly show the benefit of BCD to biology studies.</p>
</sec>
<sec id="S2" sec-type="methods">
<label>2</label>
<title>Methods</title>
<sec id="S3">
<label>2.1</label>
<title>The Batch-Corrected Distance</title>
<p id="P6">Trajectory inference, in general, aims to find a graph <italic>G</italic> = (<italic>V, E</italic>) which reflects the hop-by-hop gradual change (<italic>E</italic>) of cells (<italic>V<sub>i</sub>,V<sub>j</sub>
</italic>,… ∈ <italic>V</italic>) by optimizing <disp-formula id="FD1">
<label>(1)</label>
<mml:math id="M1">
<mml:mi>min</mml:mi>
<mml:mstyle displaystyle="true">
<mml:munder>
<mml:mo>∑</mml:mo>
<mml:mrow>
<mml:mfenced>
<mml:mrow>
<mml:msub>
<mml:mi>V</mml:mi>
<mml:mi>i</mml:mi>
</mml:msub>
<mml:mo>,</mml:mo>
<mml:msub>
<mml:mi>V</mml:mi>
<mml:mi>j</mml:mi>
</mml:msub>
</mml:mrow>
</mml:mfenced>
<mml:mo>∈</mml:mo>
<mml:mi>E</mml:mi>
</mml:mrow>
</mml:munder>
<mml:mrow>
<mml:mfenced close="‖" open="‖">
<mml:mrow>
<mml:msub>
<mml:mi>x</mml:mi>
<mml:mi>i</mml:mi>
</mml:msub>
<mml:mo>−</mml:mo>
<mml:msub>
<mml:mi>x</mml:mi>
<mml:mi>j</mml:mi>
</mml:msub>
</mml:mrow>
</mml:mfenced>
</mml:mrow>
</mml:mstyle>
</mml:math>
</disp-formula>subjecting to a set of constraints [<xref ref-type="bibr" rid="R2">2</xref>, <xref ref-type="bibr" rid="R12">12</xref>]. Here, <italic>x<sub>i</sub>
</italic> is the profile of cell <italic>i</italic>, which can be the whole gene expression, or the first few principal components (PCs). Eulidean distance is the most widely used metric, while the Mahalanobis distance <disp-formula id="FD2">
<label>(2)</label>
<mml:math id="M2">
<mml:msub>
<mml:mfenced close="‖" open="‖">
<mml:mrow>
<mml:msub>
<mml:mi>x</mml:mi>
<mml:mi>i</mml:mi>
</mml:msub>
<mml:mo>−</mml:mo>
<mml:msub>
<mml:mi>x</mml:mi>
<mml:mi>j</mml:mi>
</mml:msub>
</mml:mrow>
</mml:mfenced>
<mml:mrow>
<mml:msup>
<mml:mi>Σ</mml:mi>
<mml:mrow>
<mml:mo>−</mml:mo>
<mml:mn>1</mml:mn>
</mml:mrow>
</mml:msup>
</mml:mrow>
</mml:msub>
<mml:mo>=</mml:mo>
<mml:msqrt>
<mml:mrow>
<mml:msup>
<mml:mrow>
<mml:mfenced>
<mml:mrow>
<mml:msub>
<mml:mi>x</mml:mi>
<mml:mi>i</mml:mi>
</mml:msub>
<mml:mo>−</mml:mo>
<mml:msub>
<mml:mi>x</mml:mi>
<mml:mi>j</mml:mi>
</mml:msub>
</mml:mrow>
</mml:mfenced>
</mml:mrow>
<mml:mo>⊤</mml:mo>
</mml:msup>
<mml:msup>
<mml:mi>Σ</mml:mi>
<mml:mrow>
<mml:mo>−</mml:mo>
<mml:mn>1</mml:mn>
</mml:mrow>
</mml:msup>
<mml:mfenced>
<mml:mrow>
<mml:msub>
<mml:mi>x</mml:mi>
<mml:mi>i</mml:mi>
</mml:msub>
<mml:mo>−</mml:mo>
<mml:msub>
<mml:mi>x</mml:mi>
<mml:mi>j</mml:mi>
</mml:msub>
</mml:mrow>
</mml:mfenced>
</mml:mrow>
</mml:msqrt>
<mml:mo>,</mml:mo>
</mml:math>
</disp-formula>where Σ is the covariance matrix calculated from all the samples, may be used to account for different (co)varainces among features. To account for the batch effect, we propose to redefine the Σ as <disp-formula id="FD3">
<label>(3)</label>
<mml:math id="M3">
<mml:mover accent="true">
<mml:mo>Σ</mml:mo>
<mml:mo>˜</mml:mo>
</mml:mover>
<mml:mo>=</mml:mo>
<mml:mstyle displaystyle="true">
<mml:munderover>
<mml:mo>∑</mml:mo>
<mml:mrow>
<mml:mi>i</mml:mi>
<mml:mo>=</mml:mo>
<mml:mn>1</mml:mn>
</mml:mrow>
<mml:mi>n</mml:mi>
</mml:munderover>
<mml:mrow>
<mml:mstyle displaystyle="true">
<mml:munder>
<mml:mo>∑</mml:mo>
<mml:mrow>
<mml:mi>j</mml:mi>
<mml:mo>:</mml:mo>
<mml:mi>i</mml:mi>
<mml:mo>∉</mml:mo>
<mml:msub>
<mml:mi>C</mml:mi>
<mml:mi>j</mml:mi>
</mml:msub>
</mml:mrow>
</mml:munder>
<mml:mrow>
<mml:msub>
<mml:mi>W</mml:mi>
<mml:mrow>
<mml:mi>i</mml:mi>
<mml:mi>j</mml:mi>
</mml:mrow>
</mml:msub>
</mml:mrow>
</mml:mstyle>
</mml:mrow>
</mml:mstyle>
<mml:mfenced>
<mml:mrow>
<mml:msub>
<mml:mi>x</mml:mi>
<mml:mi>i</mml:mi>
</mml:msub>
<mml:mo>−</mml:mo>
<mml:msub>
<mml:mi>m</mml:mi>
<mml:mi>j</mml:mi>
</mml:msub>
</mml:mrow>
</mml:mfenced>
<mml:msup>
<mml:mfenced>
<mml:mrow>
<mml:msub>
<mml:mi>x</mml:mi>
<mml:mi>i</mml:mi>
</mml:msub>
<mml:mo>−</mml:mo>
<mml:msub>
<mml:mi>m</mml:mi>
<mml:mi>j</mml:mi>
</mml:msub>
</mml:mrow>
</mml:mfenced>
<mml:mo>⊤</mml:mo>
</mml:msup>
<mml:mo>,</mml:mo>
</mml:math>
</disp-formula> where <italic>C<sub>j</sub>
</italic> = {<italic>i</italic> | cell <italic>i</italic> is in batch <italic>j</italic>} is the batch information and <italic>m<sub>j</sub>
</italic> is the centroid of each batch. If weight <italic>W<sub>ij</sub>
</italic> ≡ 1, it degrades to the metric defined by Qi and Davidson [<xref ref-type="bibr" rid="R13">13</xref>] for generating an alternative clustering different from the original <italic>C</italic>. In essence, it removes the variances across the batches, while retain the variance within each batch. For a longitudinal dataset, each sample is (and all the cells in the sample are) collected from a time point, denoted as <italic>t<sub>j</sub>
</italic> (and <italic>τ<sub>i</sub>
</italic>). To utilize the temporal/longitudinal locality, we set <italic>W<sub>ij</sub>
</italic> to be <disp-formula id="FD4">
<label>(4)</label>
<mml:math id="M4">
<mml:msub>
<mml:mi>W</mml:mi>
<mml:mrow>
<mml:mi>i</mml:mi>
<mml:mi>j</mml:mi>
</mml:mrow>
</mml:msub>
<mml:mo>=</mml:mo>
<mml:mi>exp</mml:mi>
<mml:mfenced>
<mml:mrow>
<mml:mo>−</mml:mo>
<mml:mfrac>
<mml:mrow>
<mml:msup>
<mml:mrow>
<mml:mfenced close="‖" open="‖">
<mml:mrow>
<mml:msub>
<mml:mi>τ</mml:mi>
<mml:mi>i</mml:mi>
</mml:msub>
<mml:mo>−</mml:mo>
<mml:msub>
<mml:mi>t</mml:mi>
<mml:mi>j</mml:mi>
</mml:msub>
</mml:mrow>
</mml:mfenced>
</mml:mrow>
<mml:mn>2</mml:mn>
</mml:msup>
</mml:mrow>
<mml:mrow>
<mml:mn>2</mml:mn>
<mml:msup>
<mml:mi>l</mml:mi>
<mml:mn>2</mml:mn>
</mml:msup>
</mml:mrow>
</mml:mfrac>
</mml:mrow>
</mml:mfenced>
<mml:mo>,</mml:mo>
</mml:math>
</disp-formula>where <italic>l</italic> (set to 1 in our experiments) is the length scale within which two samples are considered temporally/spatially close. The covariance of proximal time points are weighted more, and thus are suppressed in the refined distance. When the dataset contains both temporal and spatial labels, <italic>τ<sub>i</sub>
</italic> and <italic>t<sub>j</sub>
</italic> can be vectors that include both labels. Inversed Cholesky-decomposed <inline-formula>
<mml:math id="M5">
<mml:mover accent="true">
<mml:mi>Σ</mml:mi>
<mml:mo>˜</mml:mo>
</mml:mover>
</mml:math>
</inline-formula> can be used to transform the data. If first k PCs are used, the computational complexity is <italic>O</italic>(<italic>nk</italic>
<sup>2</sup> + <italic>k</italic>
<sup>3</sup>).</p>
</sec>
<sec id="S4">
<label>2.2</label>
<title>Gene expression data processing</title>
<p id="P7">We use Seurat [<xref ref-type="bibr" rid="R14">14</xref>], an R package, to analyze the gene expression data. The package provides functionalities to normalize data, find highly variable features (i.e., genes) by variance stabilizing transformation, scale the features, perform principal component analysis (PCA), and visualize the result with UMAP (uniform manifold approximation and projection). This is the de facto standard single-cell data analysis protocol. The normalization step, in specific, normalizes the summation of gene expression in each cell to be one. The scaling step standardizes each gene so that the average expression over all cells is zero, and the standard deviation is one. UMAP is a nonlinear embedding method visualize data by their distance [<xref ref-type="bibr" rid="R15">15</xref>].</p>
<p id="P8">Also provided in Seurat is a data integration method that corrects batch effect [<xref ref-type="bibr" rid="R8">8</xref>]. It first projects samples into a common subspace using canonical correlation analysis (CCA), and then finds MNNs in the CCA subspace as “anchors” to correct the data. We refer to it as Seurat integration (not to be confused with the entire Seurat protocol). Harmony first projects the data into a lower-dimensional PCA space, and then iteratively removes batch effects. At each iteration, it clusters cells while maximizing the diversity of batches within each cluster and calculates a correction factor for each cell to remove the batch effect. Tran et al. [<xref ref-type="bibr" rid="R7">7</xref>] show by systematic assessments that both methods are state-of-the-art. Thus, we compare BCD with them. To ensure good comparability, we implemented BCD with an interface to Seurat. This choice also makes BCD easy to use for biology researchers familiar with Seurat.</p>
</sec>
</sec>
<sec id="S5" sec-type="results">
<label>3</label>
<title>Results</title>
<sec id="S6">
<label>3.1</label>
<title>Simulation study</title>
<p id="P9">To validate BCD, we simulated a dataset with seven samples. We assume that all cells are differentiated from an initial state, stem cells named S. S differentiates to two multipotent cell types A and B, which differentiate to terminal types A1, A2 and B1, B2, respectively (<xref ref-type="fig" rid="F2">Figure 2a</xref>). We simulated 200 genes, and assigned a unique ideal gene expression profile for each cell type, denoted as <italic>s, a, b, a</italic>
<sub>1</sub>, <italic>a</italic>
<sub>2</sub>, <italic>b</italic>
<sub>1</sub> and <italic>b</italic>
<sub>2</sub>. Because the development of the cell types is gradual [<xref ref-type="bibr" rid="R16">16</xref>], we used weighted mean to represent the process in the simulated samples. For example, to simulate intermediate states between A and A1, we used (<italic>θa</italic> + (1 – <italic>θ</italic>)<italic>a</italic>
<sub>1</sub>) as its profile, where <italic>θ</italic> is set to be uniformly distributed in a range corresponds to the developing stage of a sample (<xref ref-type="table" rid="T1">Table 1</xref>). The ambiguous cell types (<italic>θ</italic> close to 0.5) are denoted as “A-&gt;A1”, while cells more similar to “A” or “A1” (<italic>θ</italic> close to 0 or 1) are labeled as them each.</p>
<p id="P10">We randomly selected a set of genes to be “susceptible to the batch effect”, and added different additive components on those genes in different samples. For every single cell, we further added random noise into the ideal profile and used a Poisson distribution to generate the gene expression. The number of samples at each time point, and compositions of samples are shown in <xref ref-type="table" rid="T1">Table 1</xref>. It can be seen that the cell types gradually evolve over time.</p>
<p id="P11">We used Seurat to process the data with BCD, Euclidean distance, Seurat integration, and Harmony. In the process, 150 highly variable genes are selected, and 30 PCs are used. The result of BCD are shown in <xref ref-type="fig" rid="F2">Figure 2b and 2c</xref>. Given the prior knowledge that all cell types originate from S, it can be clearly seen that it branches to A and B, and further to A1, A2, and B1, B2, respectively. Small batch effect can still be seen within A1, A2, B1, and B2, but are largely mitigated. The samples are also well organized by their time. Day 1 is at the center, day 4 is separated to A1 and A2 at the top-left and B1 and B2 at the bottom-right corner, while day 2–3 corresponds to the trajectory of which the cells differentiate.</p>
<p id="P12">In contrast, Euclidean distance, the baseline, does not correct for any batch effect (<xref ref-type="fig" rid="F2">Figure 2d and 2e</xref>). Consequently, the terminal types A1, A2, B1, and B2 each splits into two groups, corresponds to different samples. It also fails to illustrate the evolution of the cell types. Seurat integration shows high capacity of removing batch effects, as the cells from multiple days are mixed together (<xref ref-type="fig" rid="F2">Figure 2f</xref>). However, it is an over-correction. For example, S, S-&gt;A and A are mixed together, and so do A-&gt;A1 and A1, and A-&gt;A2 and A2. The same applies to the branch of B. It also leads to incorrect trajectory inferences, as A is now closer to A than A-&gt;A1. Overall, it makes it harder to delineate the cell differentiation (<xref ref-type="fig" rid="F2">Figure 2g</xref>). The result of Harmony is slightly better (<xref ref-type="fig" rid="F2">Figure 2h and 2c</xref>). The two batches are fairly mixed for A1, A2, B1, and B2. The trajectory of S-&gt;A to A, then to A-&gt;A1 and A-&gt;A2, and finally to A1 and A2 can be seen, although the B-&gt;B2 and B2 are misplaced. Besides, the branch of A and branch of B are still in disconnected clusters, leaving their relationship with S undiscovered. Overall, BCD performs the best in the four methods. For time consumption, BCD uses less than 1 second, while Harmony uses 9 seconds and Seurat integration uses 20 seconds.</p>
</sec>
<sec id="S7">
<label>3.2</label>
<title>Mouse retina development dataset</title>
<p id="P13">We applied BCD to a dataset including 13 single-cell specimens collected from developing retina of one sample at E12 (day 12 embryo), two at E14, one at E16, two at E18, one at P0 (postnatal day 0), two at P2, one at P5, two at P8, and one at P14 [<xref ref-type="bibr" rid="R5">5</xref>]. A total of 110,359 cells are collected and process with Seurat, where 2,000 highly variable genes are selected, and 30 PCs are used.</p>
<p id="P14">The development of mouse retina is well-understood by the field. Briefly, retinal progenitor cells (RPCs, including early RPCs and late RPCs) differentiate into Neurogenic cells, which further differentiate into photoreceptor precursors, Amacrine cells, horizontal cells, and retinal ganglion cells [<xref ref-type="bibr" rid="R17">17</xref>]. The photoreceptor precursors differentiate into cone cells, rod cells, and bipolar cells [<xref ref-type="bibr" rid="R18">18</xref>]. These cell types are all neural cells. Late RPCs also differentiate to Müller glia [<xref ref-type="bibr" rid="R17">17</xref>]. These cells form a neural network where each terminal cell type has a unique function. Cone cells and rod cells forming the input layer are photoreceptors that work in light and dark environment, respectively. The signal from cone cells and rod cells propagate through the bipolar cells first and then retinal ganglion cells to go to the brain. Horizontal cells provides horizontal connections between photoreceptors and bipolar cells, while amacrine cells perform similar function between bipolar cells and retinal ganglion cells. These cells form two hidden layers. Müller glia is an auxiliary cell type that supports the aforementioned neural cells.</p>
<p id="P15">The result of BCD is shown in <xref ref-type="fig" rid="F3">Figure 3b and 3c</xref>. There is a clear trajectory of the cells gradually evolving from E11 to P14. The aforementioned evolution trajectory of the cell types can also be seen along the trajectory. The Euclidean distance also performs relatively well on this dataset. However, clear batch effect can be seen in <xref ref-type="fig" rid="F3">Figure 3d</xref>, where cells are clustered by samples. As a result, a cell type is divided into multiple clusters in <xref ref-type="fig" rid="F3">Figure 3d</xref>, making it harder to delineate the differentiation trajectory of the cell types. Both Seurat integration and Harmony over-corrects the batch effect. Although the samples are well mixed (<xref ref-type="fig" rid="F3">Figure 3f and 3h</xref>), many cell types are mixed. For example, early RPC, late RPC, and Müller glia are not distinguishable from the result, and so do horizontal cells, amacrine cells, bipolar cells, and retinal ganglion cells (<xref ref-type="fig" rid="F3">Figure 3g and 3i</xref>). Even worse, the bipolar cells, which should be differentiated from photoreceptor precursors, are misplaced to directly under neurogenic cells. These mistakes are because these methods do not utilize the temporal locality of the samples. For this dataset, BCD uses less than 2 seconds, while Harmony uses 5 minutes. Seurat integration costs more than 3 hours.</p>
</sec>
<sec id="S8">
<label>3.3</label>
<title>COVID-19 immune compartment datasets</title>
<p id="P16">The global pandemic COVID-19 has reportedly infected 6.3 million people worldwide, with the death toll at 380 thousand. Understanding the immune response to the virus is essential to developing treatments. We applied BCD to a recently published dataset including immune compartment samples collected from 13 participants [<xref ref-type="bibr" rid="R19">19</xref>] including 4 health controls (HC1-4), 3 moderate (M1-3) cases, and 6 severe (S1-6) cases. Although these are all different participants, we consider HC, M, and S a time course to reflect the progression of the disease. We used Seurat and BCD to process the data. During the process, 2,000 highly variable genes are selected, and 30 PCs are used.</p>
<p id="P17">The result is shown in <xref ref-type="fig" rid="F4">figure 4</xref>. The largest group is macrophages, which recognize and destroy virus-infected cells. The result shows from top to bottom a gradual change from those in health controls, to moderate cases, and to severe cases. In contrast, Euclidean distance yields disconnected groups of macrophages because of the batch effect, while Seurat integration and Harmony overcorrect the effect and confuse cells from moderate cases with those from health controls (Supplementary Material). The changes in gene expression that drive the differences can be attained by differential expression analysis. Similar trajectories can also be seen on T cells and plasma cells, which kill infected cells and produce antibodies, respectively. Using these pieces of information, researchers can identify the most effective form of immune cells and find ways to transform others into it to treat the disease.</p>
</sec>
<sec id="S9">
<label>3.4</label>
<title>Human Lung datasets</title>
<p id="P18">Besides studies of the immune compartment, knowledge of lung development may also help cure the disease and restore the functionality of the lung [<xref ref-type="bibr" rid="R20">20</xref>]. Miller et al. has produced a single-cell dataset of cells from [<xref ref-type="bibr" rid="R21">21</xref>]. Cells from fetal human lungs are collected at week 11.5 (W11.5), W15, W18, and W21, and are available for trachea, small airways in the lung, and the distal tip of the lung.</p>
<p id="P19">We explored the dataset using BCD. Because both temporal and spatial information of the samples is available, we use a vector [<italic>week, location</italic>] to label each sample, where <italic>week</italic> is the number of weeks mentioned above, and <italic>location</italic> is set to be 0, 2, and 4 for trachea, small airways, and distal lung, respectively. The result is shown in <xref ref-type="fig" rid="F5">Figure 5</xref>. A branching trajectory can be seen from W11.5 to W18 for distal lung and small airways mesenchymal cells. The cells from the two locations are similar at the early stage (W11.5), but become more distinct when they are more developed (W15 and W18). In contrast, affected by the batch effect, Euclidean distance and Harmony show W15 and W18 small airway mesenchymal cells as isolated clusters, with no connection with W11.5, while Seurat mixes all mesenchymal cells across the two locations and all times points, blurring the trajectory (Supplementary Material). Similar trajectories also show for Epithelial cells, endothelial cells, and pericytes. Researchers may use these pieces of information to further study the changes in gene expression in the cell type developments and develop treatments.</p>
</sec>
</sec>
<sec id="S10" sec-type="discussion">
<label>4</label>
<title>Discussion</title>
<p id="P20">In order to build a reliable trajectory of cell type development from a longitudinal dataset, the batch effect should be corrected for. This is a new problem as state-of-the-art batch effect correction methods cannot utilize the time/spacial information, and thus result in over-correction. Our method, BCD, utilizes such information to accurately identify and remove the batch effect, while preserving the correct structure of the data. The results based on the BCD clearly show the evolution of the cell types through time. The discovered trajectory helps researchers make hypotheses of the physiological changes during development or pathological changes as a result of disease infection. The changes can be ascertained by differential gene expression analysis.</p>
<p id="P21">BCD assumes that the batch effect is shared by all the samples. This is a reasonable assumption because many kinds of batch effects have a biological basis. For example, Cellular stress response stimulated by the sample preparation affects certain genes. In the case the set of genes do change, the local linear approximation may be used. Because the sums and products of distances are guaranteed to be valid distances, multiple BCDs each correcting for the batch effect in a specific set of samples can be combined as a consensus distance.</p>
<p id="P22">BCD is intrinsically a linear transformation, which may be insufficient for more complex batch effects including interactions of genes. Nevertheless, it is a proof of concept that the time/spatial locality should be considered in batch correction for longitudinal datasets, which are on the rise. Nonlinear methods may be invented based on the same concept. For example, kernelization can be a direct extension to BCD. Besides, BCD is very fast to run and can be used in the exploration of the dataset with negligible cost.</p>
<p id="P23">Although all the experiments are from a biology background, the scope of BCD is not confined to it. It can be applied to any longitudinal/spatial dataset affected by batch effects where the temporal/spatial locality holds. BCD also illustrates that batch the effect correction problem is related to the alternative clustering problems. Over the past few years, many advanced alternative clustering models have been introduced, and translate them to this context may result in better performance.</p>
</sec>
</body>
<back>
<ack id="S11">
<title>Acknowledgements</title>
<p>This work was supported in part by grant number 2018–182735 to KC, Human Breast Cell Atlas Seed Network Grant (HCA3-0000000147) to KC from the Chan Zuckerberg Initiative DAF, an advised fund of Silicon Valley Community Foundation, grant RP180248 to KC from Cancer Prevention &amp; Research Institute of Texas, The University of Texas MD Anderson Cancer Center Pre-Cancer Atlas Project to KC, and The University of Texas MD Anderson Cancer Center Colorectal Cancer Moonshot and P30 CA016672 (US National Institutes of Health/National Cancer Institute) to the University of Texas Anderson Cancer Center Core Support Grant.</p>
</ack>
<ref-list>
<ref id="R1">
<label>[1]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Lim</surname>
<given-names>B</given-names>
</name>
<name>
<surname>Lin</surname>
<given-names>Y</given-names>
</name>
<name>
<surname>Navin</surname>
<given-names>N</given-names>
</name>
</person-group>
<article-title>Advancing cancer research and medicine with single-cell genomics</article-title>
<source>Cancer Cell</source>
<year>2020</year>
<volume>37</volume>
<issue>4</issue>
<fpage>456</fpage>
<lpage>470</lpage>
</element-citation>
</ref>
<ref id="R2">
<label>[2]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Saelens</surname>
<given-names>W</given-names>
</name>
<name>
<surname>Cannoodt</surname>
<given-names>R</given-names>
</name>
<name>
<surname>Todorov</surname>
<given-names>H</given-names>
</name>
<name>
<surname>Saeys</surname>
<given-names>Y</given-names>
</name>
</person-group>
<article-title>A comparison of single-cell trajectory inference methods</article-title>
<source>Nature biotechnology</source>
<year>2019</year>
<volume>37</volume>
<issue>5</issue>
<fpage>547</fpage>
<lpage>554</lpage>
</element-citation>
</ref>
<ref id="R3">
<label>[3]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Regev</surname>
<given-names>A</given-names>
</name>
<name>
<surname>Teichmann</surname>
<given-names>SA</given-names>
</name>
<name>
<surname>Lander</surname>
<given-names>ES</given-names>
</name>
<name>
<surname>Amit</surname>
<given-names>I</given-names>
</name>
<name>
<surname>Benoist</surname>
<given-names>C</given-names>
</name>
<name>
<surname>Birney</surname>
<given-names>E</given-names>
</name>
<name>
<surname>Bodenmiller</surname>
<given-names>B</given-names>
</name>
<name>
<surname>Campbell</surname>
<given-names>P</given-names>
</name>
<name>
<surname>Carninci</surname>
<given-names>P</given-names>
</name>
<name>
<surname>Clatworthy</surname>
<given-names>M</given-names>
</name>
<etal/>
</person-group>
<article-title>Science forum: the human cell atlas</article-title>
<source>Elife</source>
<year>2017</year>
<volume>6</volume>
<fpage>e27041</fpage>
</element-citation>
</ref>
<ref id="R4">
<label>[4]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Nygaard</surname>
<given-names>V</given-names>
</name>
<name>
<surname>Rødland</surname>
<given-names>EA</given-names>
</name>
<name>
<surname>Hovig</surname>
<given-names>E</given-names>
</name>
</person-group>
<article-title>Methods that remove batch effects while retaining group differences may lead to exaggerated confidence in downstream analyses</article-title>
<source>Biostatistics</source>
<year>2016</year>
<volume>17</volume>
<issue>1</issue>
<fpage>29</fpage>
<lpage>39</lpage>
</element-citation>
</ref>
<ref id="R5">
<label>[5]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Clark</surname>
<given-names>BS</given-names>
</name>
<name>
<surname>Stein-O’Brien</surname>
<given-names>GL</given-names>
</name>
<name>
<surname>Shiau</surname>
<given-names>F</given-names>
</name>
<name>
<surname>Cannon</surname>
<given-names>GH</given-names>
</name>
<name>
<surname>Davis-Marcisak</surname>
<given-names>E</given-names>
</name>
<name>
<surname>Sherman</surname>
<given-names>T</given-names>
</name>
<name>
<surname>Santiago</surname>
<given-names>CP</given-names>
</name>
<name>
<surname>Hoang</surname>
<given-names>TV</given-names>
</name>
<name>
<surname>Rajaii</surname>
<given-names>F</given-names>
</name>
<name>
<surname>James-Esposito</surname>
<given-names>RE</given-names>
</name>
<etal/>
</person-group>
<article-title>Single-cell rna-seq analysis of retinal development identifies nfi factors as regulating mitotic exit and late-born cell specification</article-title>
<source>Neuron</source>
<year>2019</year>
<volume>102</volume>
<issue>6</issue>
<fpage>1111</fpage>
<lpage>1126</lpage>
</element-citation>
</ref>
<ref id="R6">
<label>[6]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Müller</surname>
<given-names>C</given-names>
</name>
<name>
<surname>Schillert</surname>
<given-names>A</given-names>
</name>
<name>
<surname>Röthemeier</surname>
<given-names>C</given-names>
</name>
<name>
<surname>Trégouёt</surname>
<given-names>D-A</given-names>
</name>
<name>
<surname>Proust</surname>
<given-names>C</given-names>
</name>
<name>
<surname>Binder</surname>
<given-names>H</given-names>
</name>
<name>
<surname>Pfeiffer</surname>
<given-names>N</given-names>
</name>
<name>
<surname>Beutel</surname>
<given-names>M</given-names>
</name>
<name>
<surname>Lackner</surname>
<given-names>KJ</given-names>
</name>
<name>
<surname>Schnabel</surname>
<given-names>RB</given-names>
</name>
<etal/>
</person-group>
<article-title>Removing batch effects from longitudinal gene expressionquantile normalization plus combat as best approach for microarray transcriptome data</article-title>
<source>PloS one</source>
<year>2016</year>
<volume>11</volume>
<issue>6</issue>
</element-citation>
</ref>
<ref id="R7">
<label>[7]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Tran</surname>
<given-names>TNH</given-names>
</name>
<name>
<surname>Ang</surname>
<given-names>KS</given-names>
</name>
<name>
<surname>Chevrier</surname>
<given-names>M</given-names>
</name>
<name>
<surname>Zhang</surname>
<given-names>X</given-names>
</name>
<name>
<surname>Lee</surname>
<given-names>YSN</given-names>
</name>
<name>
<surname>Goh</surname>
<given-names>M</given-names>
</name>
<name>
<surname>Chen</surname>
<given-names>J</given-names>
</name>
</person-group>
<article-title>A benchmark of batch-effect correction methods for single-cell rna sequencing data</article-title>
<source>Genome Biology</source>
<year>2020</year>
<volume>21</volume>
<issue>1</issue>
<fpage>1</fpage>
<lpage>32</lpage>
</element-citation>
</ref>
<ref id="R8">
<label>[8]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Stuart</surname>
<given-names>T</given-names>
</name>
<name>
<surname>Butler</surname>
<given-names>A</given-names>
</name>
<name>
<surname>Hoffman</surname>
<given-names>P</given-names>
</name>
<name>
<surname>Hafemeister</surname>
<given-names>C</given-names>
</name>
<name>
<surname>Papalexi</surname>
<given-names>E</given-names>
</name>
<name>
<surname>Mauck</surname>
<given-names>WM</given-names>
<suffix>III</suffix>
</name>
<name>
<surname>Hao</surname>
<given-names>Y</given-names>
</name>
<name>
<surname>Stoeckius</surname>
<given-names>M</given-names>
</name>
<name>
<surname>Smibert</surname>
<given-names>P</given-names>
</name>
<name>
<surname>Satija</surname>
<given-names>R</given-names>
</name>
</person-group>
<article-title>Comprehensive integration of single-cell data</article-title>
<source>Cell</source>
<year>2019</year>
<volume>177</volume>
<issue>7</issue>
<fpage>1888</fpage>
<lpage>1902</lpage>
</element-citation>
</ref>
<ref id="R9">
<label>[9]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Korsunsky</surname>
<given-names>I</given-names>
</name>
<name>
<surname>Millard</surname>
<given-names>N</given-names>
</name>
<name>
<surname>Fan</surname>
<given-names>J</given-names>
</name>
<name>
<surname>Slowikowski</surname>
<given-names>K</given-names>
</name>
<name>
<surname>Zhang</surname>
<given-names>F</given-names>
</name>
<name>
<surname>Wei</surname>
<given-names>K</given-names>
</name>
<name>
<surname>Baglaenko</surname>
<given-names>Y</given-names>
</name>
<name>
<surname>Brenner</surname>
<given-names>M</given-names>
</name>
<name>
<surname>Loh</surname>
<given-names>P-r</given-names>
</name>
<name>
<surname>Raychaudhuri</surname>
<given-names>S</given-names>
</name>
</person-group>
<article-title>Fast, sensitive and accurate integration of single-cell data with harmony</article-title>
<source>Nature methods</source>
<year>2019</year>
<fpage>1</fpage>
<lpage>8</lpage>
</element-citation>
</ref>
<ref id="R10">
<label>[10]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Welch</surname>
<given-names>JD</given-names>
</name>
<name>
<surname>Kozareva</surname>
<given-names>V</given-names>
</name>
<name>
<surname>Ferreira</surname>
<given-names>A</given-names>
</name>
<name>
<surname>Vanderburg</surname>
<given-names>C</given-names>
</name>
<name>
<surname>Martin</surname>
<given-names>C</given-names>
</name>
<name>
<surname>Macosko</surname>
<given-names>EZ</given-names>
</name>
</person-group>
<article-title>Single-cell multi-omic integration compares and contrasts features of brain cell identity</article-title>
<source>Cell</source>
<year>2019</year>
<volume>177</volume>
<issue>7</issue>
<fpage>1873</fpage>
<lpage>1887</lpage>
</element-citation>
</ref>
<ref id="R11">
<label>[11]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Finak</surname>
<given-names>G</given-names>
</name>
<name>
<surname>McDavid</surname>
<given-names>A</given-names>
</name>
<name>
<surname>Yajima</surname>
<given-names>M</given-names>
</name>
<name>
<surname>Deng</surname>
<given-names>J</given-names>
</name>
<name>
<surname>Gersuk</surname>
<given-names>V</given-names>
</name>
<name>
<surname>Shalek</surname>
<given-names>AK</given-names>
</name>
<name>
<surname>Slichter</surname>
<given-names>CK</given-names>
</name>
<name>
<surname>Miller</surname>
<given-names>HW</given-names>
</name>
<name>
<surname>McElrath</surname>
<given-names>MJ</given-names>
</name>
<name>
<surname>Prlic</surname>
<given-names>M</given-names>
</name>
<etal/>
</person-group>
<article-title>Mast: a flexible statistical framework for assessing transcriptional changes and characterizing heterogeneity in single-cell rna sequencing data</article-title>
<source>Genome biology</source>
<year>2015</year>
<volume>16</volume>
<issue>1</issue>
<fpage>278</fpage>
</element-citation>
</ref>
<ref id="R12">
<label>[12]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Qiu</surname>
<given-names>X</given-names>
</name>
<name>
<surname>Mao</surname>
<given-names>Q</given-names>
</name>
<name>
<surname>Tang</surname>
<given-names>Y</given-names>
</name>
<name>
<surname>Wang</surname>
<given-names>L</given-names>
</name>
<name>
<surname>Chawla</surname>
<given-names>R</given-names>
</name>
<name>
<surname>Pliner</surname>
<given-names>HA</given-names>
</name>
<name>
<surname>Trapnell</surname>
<given-names>C</given-names>
</name>
</person-group>
<article-title>Reversed graph embedding resolves complex single-cell trajectories</article-title>
<source>Nature methods</source>
<year>2017</year>
<volume>14</volume>
<issue>10</issue>
<fpage>979</fpage>
</element-citation>
</ref>
<ref id="R13">
<label>[13]</label>
<element-citation publication-type="confproc">
<person-group person-group-type="author">
<name>
<surname>Qi</surname>
<given-names>Z</given-names>
</name>
<name>
<surname>Davidson</surname>
<given-names>I</given-names>
</name>
</person-group>
<article-title>A principled and flexible framework for finding alternative clusterings</article-title>
<conf-name>Proceedings of the 15th ACM SIGKDD international conference on Knowledge discovery and data mining</conf-name>
<year>2009</year>
<fpage>717</fpage>
<lpage>726</lpage>
</element-citation>
</ref>
<ref id="R14">
<label>[14]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Butler</surname>
<given-names>A</given-names>
</name>
<name>
<surname>Hoffman</surname>
<given-names>P</given-names>
</name>
<name>
<surname>Smibert</surname>
<given-names>P</given-names>
</name>
<name>
<surname>Papalexi</surname>
<given-names>E</given-names>
</name>
<name>
<surname>Satija</surname>
<given-names>R</given-names>
</name>
</person-group>
<article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title>
<source>Nature biotechnology</source>
<year>2018</year>
<volume>36</volume>
<issue>5</issue>
<fpage>411</fpage>
<lpage>420</lpage>
</element-citation>
</ref>
<ref id="R15">
<label>[15]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>McInnes</surname>
<given-names>L</given-names>
</name>
<name>
<surname>Healy</surname>
<given-names>J</given-names>
</name>
<name>
<surname>Melville</surname>
<given-names>J</given-names>
</name>
</person-group>
<article-title>Umap: Uniform manifold approximation and projection for dimension reduction</article-title>
<source>arXiv</source>
<year>2018</year>
<comment>preprint arXiv:1802.03f26</comment>
</element-citation>
</ref>
<ref id="R16">
<label>[16]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Schiebinger</surname>
<given-names>G</given-names>
</name>
<name>
<surname>Shu</surname>
<given-names>J</given-names>
</name>
<name>
<surname>Tabaka</surname>
<given-names>M</given-names>
</name>
<name>
<surname>Cleary</surname>
<given-names>B</given-names>
</name>
<name>
<surname>Subramanian</surname>
<given-names>V</given-names>
</name>
<name>
<surname>Solomon</surname>
<given-names>A</given-names>
</name>
<name>
<surname>Gould</surname>
<given-names>J</given-names>
</name>
<name>
<surname>Liu</surname>
<given-names>S</given-names>
</name>
<name>
<surname>Lin</surname>
<given-names>S</given-names>
</name>
<name>
<surname>Berube</surname>
<given-names>P</given-names>
</name>
<etal/>
</person-group>
<article-title>Optimal-transport analysis of single-cell gene expression identifies developmental trajectories in reprogramming</article-title>
<source>Cell</source>
<year>2019</year>
<volume>176</volume>
<issue>4</issue>
<fpage>928</fpage>
<lpage>943</lpage>
</element-citation>
</ref>
<ref id="R17">
<label>[17]</label>
<element-citation publication-type="book">
<person-group person-group-type="author">
<name>
<surname>Stenkamp</surname>
<given-names>DL</given-names>
</name>
</person-group>
<chapter-title>Development of the vertebrate eye and retina</chapter-title>
<source>Progress in molecular biology and translational science</source>
<publisher-name>Elsevier</publisher-name>
<year>2015</year>
<volume>134</volume>
<fpage>397</fpage>
<lpage>414</lpage>
</element-citation>
</ref>
<ref id="R18">
<label>[18]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Brzezinski</surname>
<given-names>JA</given-names>
</name>
<name>
<surname>Reh</surname>
<given-names>TA</given-names>
</name>
</person-group>
<article-title>Photoreceptor cell fate specification in vertebrates</article-title>
<source>Development</source>
<year>2015</year>
<volume>142</volume>
<issue>19</issue>
<fpage>3263</fpage>
<lpage>3273</lpage>
</element-citation>
</ref>
<ref id="R19">
<label>[19]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Liao</surname>
<given-names>M</given-names>
</name>
<name>
<surname>Liu</surname>
<given-names>Y</given-names>
</name>
<name>
<surname>Yuan</surname>
<given-names>J</given-names>
</name>
<name>
<surname>Wen</surname>
<given-names>Y</given-names>
</name>
<name>
<surname>Xu</surname>
<given-names>G</given-names>
</name>
<name>
<surname>Zhao</surname>
<given-names>J</given-names>
</name>
<name>
<surname>Cheng</surname>
<given-names>L</given-names>
</name>
<name>
<surname>Li</surname>
<given-names>J</given-names>
</name>
<name>
<surname>Wang</surname>
<given-names>X</given-names>
</name>
<name>
<surname>Wang</surname>
<given-names>F</given-names>
</name>
<etal/>
</person-group>
<article-title>Single-cell landscape of bronchoalveolar immune cells in patients with covid-19</article-title>
<source>Nature Medicine</source>
<year>2020</year>
<fpage>1</fpage>
<lpage>3</lpage>
</element-citation>
</ref>
<ref id="R20">
<label>[20]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Golchin</surname>
<given-names>A</given-names>
</name>
<name>
<surname>Seyedjafari</surname>
<given-names>E</given-names>
</name>
<name>
<surname>Ardeshirylajimi</surname>
<given-names>A</given-names>
</name>
</person-group>
<article-title>Mesenchymal stem cell therapy for covid-19: present or future</article-title>
<source>Stem Cell Reviews and Reports</source>
<year>2020</year>
<fpage>1</fpage>
<lpage>7</lpage>
</element-citation>
</ref>
<ref id="R21">
<label>[21]</label>
<element-citation publication-type="journal">
<person-group person-group-type="author">
<name>
<surname>Miller</surname>
<given-names>AJ</given-names>
</name>
<name>
<surname>Yu</surname>
<given-names>Q</given-names>
</name>
<name>
<surname>Czerwinski</surname>
<given-names>M</given-names>
</name>
<name>
<surname>Tsai</surname>
<given-names>Y-H</given-names>
</name>
<name>
<surname>Conway</surname>
<given-names>RF</given-names>
</name>
<name>
<surname>Wu</surname>
<given-names>A</given-names>
</name>
<name>
<surname>Holloway</surname>
<given-names>EM</given-names>
</name>
<name>
<surname>Walker</surname>
<given-names>T</given-names>
</name>
<name>
<surname>Glass</surname>
<given-names>IA</given-names>
</name>
<name>
<surname>Treutlein</surname>
<given-names>B</given-names>
</name>
<etal/>
</person-group>
<article-title>In vitro and in vivo development of the human airway at single-cell resolution</article-title>
<source>Developmental Cell</source>
<year>2020</year>
</element-citation>
</ref>
</ref-list>
</back>
<floats-group>
<boxed-text id="BX1" position="float" orientation="portrait">
<caption>
<title>Summary</title>
</caption>
<p>We defined a novel pairwise distance of the cells, namely Batch-Corrected Distance (BCD), where the effect of the unwanted clustering is controlled. Results show our method achieves more accurate clusters and better visualizations than state-of-the-art methods on longitudinal datasets. The BCD can be directly integrated into most clustering and visualization methods to enable more scientific findings.</p>
</boxed-text>
<fig id="F1" position="float">
<label>Figure 1</label>
<caption>
<p>Illustration of how BCD handles batch effect differently.</p>
</caption>
<graphic xlink:href="EMS97940-f001"/>
</fig>
<fig id="F2" position="float">
<label>Figure 2</label>
<caption>
<p>Results for the simulated data. Left panels are colored by samples. Right panels are colored by cell types. Each row represents a method.</p>
</caption>
<graphic xlink:href="EMS97940-f002"/>
</fig>
<fig id="F3" position="float">
<label>Figure 3</label>
<caption>
<p>Results for the retina development dataset. ERPC: early retinal progenitor cell, ERPC: late retinal progenitor cell, MG: Müller glia, NG: neurogenic cell, Ph: photoreceptor precursors, Am: Amacrine cell, HC: horizontal cells, RGC: retinal ganglion cells.</p>
</caption>
<graphic xlink:href="EMS97940-f003"/>
</fig>
<fig id="F4" position="float">
<label>Figure 4</label>
<caption>
<p>Results for the COVID-19 dataset. Results of other methods are in Supplementary Material.</p>
</caption>
<graphic xlink:href="EMS97940-f004"/>
</fig>
<fig id="F5" position="float">
<label>Figure 5</label>
<caption>
<p>Results for the human fetal lung development dataset. Arrows are added for visual reference.</p>
</caption>
<graphic xlink:href="EMS97940-f005"/>
</fig>
<table-wrap id="T1" position="float" orientation="portrait">
<label>Table 1</label>
<caption>
<title>Simulated dataset</title>
</caption>
<table frame="hsides" rules="groups">
<thead>
<tr>
<th align="right" valign="bottom" rowspan="2">Day</th>
<th align="right" valign="bottom" rowspan="2">Samples</th>
<th align="center" valign="middle" colspan="5" style="border-bottom: solid thin">Composition</th>
</tr>
<tr>
<th align="center" valign="middle">S</th>
<th align="center" valign="middle">S-&gt;A S-&gt;B</th>
<th align="center" valign="middle">AB</th>
<th align="center" valign="middle">A-&gt;A1 A-&gt;A2 B-&gt;B1 B-&gt;B2</th>
<th align="center" valign="middle">A1 A2 B1 B2</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right" valign="middle">1</td>
<td align="right" valign="middle">1</td>
<td align="center" valign="middle">.8</td>
<td align="center" valign="middle">.2</td>
<td align="center" valign="middle"/>
<td align="center" valign="middle"/>
<td align="center" valign="middle"/>
</tr>
<tr>
<td align="right" valign="middle">2</td>
<td align="right" valign="middle">2</td>
<td align="center" valign="middle"/>
<td align="center" valign="middle">.5</td>
<td align="center" valign="middle">.5</td>
<td align="center" valign="middle"/>
<td align="center" valign="middle"/>
</tr>
<tr>
<td align="right" valign="middle">3</td>
<td align="right" valign="middle">2</td>
<td align="center" valign="middle"/>
<td align="center" valign="middle"/>
<td align="center" valign="middle">.5</td>
<td align="center" valign="middle">.5</td>
<td align="center" valign="middle"/>
</tr>
<tr>
<td align="right" valign="middle">4</td>
<td align="right" valign="middle">2</td>
<td align="center" valign="middle"/>
<td align="center" valign="middle"/>
<td align="center" valign="middle"/>
<td align="center" valign="middle">.5</td>
<td align="center" valign="middle">.5</td>
</tr>
</tbody>
</table>
</table-wrap>
</floats-group>
</article>
