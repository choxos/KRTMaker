<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="epub">2692-8205</issn></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS199652</article-id><article-id pub-id-type="doi">10.1101/2024.10.21.619394</article-id><article-id pub-id-type="archive">PPR929953</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">2</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Kernel Filter-Based Adaptive Controllers For Cybergenetics Applications</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Smart</surname><given-names>Benjamin</given-names></name><email>b.smart21@imperial.ac.uk</email><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Marucci</surname><given-names>Lucia</given-names></name><xref ref-type="aff" rid="A2">2</xref><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref><xref ref-type="corresp" rid="CR1">∗</xref></contrib><contrib contrib-type="author"><name><surname>Renson</surname><given-names>Ludovic</given-names></name><email>l.renson@imperial.ac.uk</email><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">¶∗</xref><xref ref-type="aff" rid="A2">†</xref><xref ref-type="aff" rid="A3">‡</xref><xref ref-type="aff" rid="A4">§</xref></contrib></contrib-group><aff id="A1"><label>*1</label>Department of Mechanical Engineering, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/041kmwe10</institution-id><institution>Imperial College London</institution></institution-wrap>, <city>London</city><postal-code>SW7 1AY</postal-code>, <country country="GB">U.K.</country></aff><aff id="A2"><label>†2</label>School of Engineering Mathematics and Technology, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/0524sp257</institution-id><institution>University of Bristol</institution></institution-wrap>, <addr-line>Ada Lovelace Building, University Walk</addr-line>, <city>Bristol</city><postal-code>BS81TW</postal-code>, <country country="GB">U.K.</country></aff><aff id="A3"><label>‡3</label>BrisSynBio, Life Sciences Building, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/0524sp257</institution-id><institution>University of Bristol</institution></institution-wrap>, <addr-line>Tyndall Avenue</addr-line>, <city>Bristol</city><postal-code>BS8 1TQ</postal-code>, <country country="GB">U.K.</country></aff><aff id="A4"><label>§4</label>School of Cellular and Molecular Medicine, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/0524sp257</institution-id><institution>University of Bristol</institution></institution-wrap>, <addr-line>University Walk</addr-line>, <city>Bristol</city><postal-code>BS8 1TD</postal-code>, <country country="GB">U.K.</country></aff><author-notes><corresp id="CR1"><label>¶∗</label>L.M. and L.R. are co-senior and co-corresponding authors.</corresp></author-notes><pub-date pub-type="nihms-submitted"><day>26</day><month>10</month><year>2024</year></pub-date><pub-date pub-type="preprint"><day>24</day><month>10</month><year>2024</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Cybergenetics is an advancing field that seeks to implement control theory within biological systems. When applying feedback control for the regulation of gene expression or cell proliferation, model-based control strategies can be applied; in this context, online adaptive mathematical models can be used to keep models in tune with the current behaviour of the biological system. Controllers are often constrained by their sampling rate, which is usually relatively low when using microfluidics/microscopy platforms. Current adaptive filters can lead to an inaccurate predictive model when operating with a low sampling rate, leading to sub-optimal control. Here, we propose a kernel filter that can fit model parameters online to produce a more accurate predictive model that can be included within an adaptive model predictive control scheme. The use of the kernel filter is demonstrated in <italic>in silico</italic> and <italic>in vitro</italic> experiments, where we control a synthetic gene oscillator and a P53 oscillator, and observe a synthetic toggle switch. Our results show that the kernel filter outperforms a particle filter when used for parameter estimation in both the predictive model accuracy and when included within an adaptive model-based controller.</p></abstract></article-meta></front><body><sec id="S1" sec-type="intro"><label>1</label><title>Introduction</title><p id="P2">Cybergenetics is a recent field coming out of synthetic biology, which applies principles and techniques from control engineering to forward engineer complex phenotypes in living cells, such as gene expression and cell proliferation [<xref ref-type="bibr" rid="R1">1</xref>, <xref ref-type="bibr" rid="R2">2</xref>]. Model-based controllers can be used in cybergenetics [<xref ref-type="bibr" rid="R3">3</xref>, <xref ref-type="bibr" rid="R4">4</xref>], often offering better performance than model-free strategies.</p><p id="P3">Parameter estimation is vital for all systems engineering problems that require a mathematical model [<xref ref-type="bibr" rid="R5">5</xref>]. Most biological control applications are mainly based on models with fixed parameters, i.e. parameters estimated offline using calibration data sets [<xref ref-type="bibr" rid="R6">6</xref>, <xref ref-type="bibr" rid="R7">7</xref>]. However, when conducting closed-loop experiments, the system of interest may be pushed into a new area of the problem space where the identified parameters cannot describe its behaviour [<xref ref-type="bibr" rid="R8">8</xref>]. It is well known that mathematical models of biological systems can suffer from identifiability issues [<xref ref-type="bibr" rid="R9">9</xref>] due to the impossibility to directly measure most of the parameters and noisy behaviors, in addition to possible uncertainties in the structure of the model [<xref ref-type="bibr" rid="R10">10</xref>, <xref ref-type="bibr" rid="R11">11</xref>]. Therefore, it is beneficial that online parameter estimation is included within cellular model-based feedback control schemes.</p><p id="P4">Online parameter estimation combines the benefits of physics-based and data-driven control, utilising some of the stability guarantees and robustness of the model-based controllers whilst avoiding sensitivity problems due to the uncertainties in fixed model parameters and any noise/variance in observations, [<xref ref-type="bibr" rid="R12">12</xref>, <xref ref-type="bibr" rid="R13">13</xref>].</p><p id="P5">Regarding the experimental implementation, cybergenetics mainly relies on the use of microscopy/microfluidics platforms, where time-lapse imaging is combined with image segmentation [<xref ref-type="bibr" rid="R14">14</xref>] to quantify real-time outputs (for example, gene expression), compute the control error by comparing the output to the target behaviour, and finally apply control algorithms which can provide, to cells, control inputs to minimise the control error [<xref ref-type="bibr" rid="R15">15</xref>, <xref ref-type="bibr" rid="R16">16</xref>, <xref ref-type="bibr" rid="R17">17</xref>, <xref ref-type="bibr" rid="R18">18</xref>, <xref ref-type="bibr" rid="R19">19</xref>, <xref ref-type="bibr" rid="R20">20</xref>]. The control algorithms can include the online fitting of models, often using particle filters [<xref ref-type="bibr" rid="R21">21</xref>]. The sampling rate at which images are collected and analyzed is usually limited due to the physical constraints of the microscope and, most importantly, issues related to phototoxicity when performing long experiments. Therefore, there is a need for adaptive models that can be fitted at a lower sampling rate. Particle filters are frequently used to extract biological system state and parameter information offline, [<xref ref-type="bibr" rid="R22">22</xref>, <xref ref-type="bibr" rid="R23">23</xref>] and online [<xref ref-type="bibr" rid="R7">7</xref>, <xref ref-type="bibr" rid="R24">24</xref>]. Recently, particle filters are also being used within feedback controllers working on biological systems[<xref ref-type="bibr" rid="R25">25</xref>, <xref ref-type="bibr" rid="R21">21</xref>].</p><p id="P6">Here, we propose a kernel filter that can fit model parameters at low sampling rates and be included within an adaptive model predictive controller (MPC). The kernel filter proposed here is adapted from [<xref ref-type="bibr" rid="R26">26</xref>], where parameter estimation was performed offline on a mechanical system. In this paper, we extend this to use the kernel filter online, using a shifting kernel window and a shifting sampling grid to solve the nonlinear optimisation problem online, updating the system parameters and kernel hyperparameters each sampling period.</p><p id="P7">Many biological systems present nonlinear dynamics such as temporal oscillations and hysteresis, occurring across different temporal and spatial scales [<xref ref-type="bibr" rid="R27">27</xref>]. The first example considered here is a synthetic gene oscillator implemented in bacterial cells [<xref ref-type="bibr" rid="R28">28</xref>]; we used the mathematical model of the system reported in the original publication to simulate its dynamics, so we will refer to it as an <italic>in silico</italic> oscillator. The second example is the P53 biological oscillator [<xref ref-type="bibr" rid="R29">29</xref>]; it is a natural oscillator found in mammalian cells, which controls several critical cellular processes, including cellular senescence, apoptosis, cell cycle arrest, and DNA repair; also, here we used a model of the system to reproduce its dynamics. The third example is a synthetic toggle switch [<xref ref-type="bibr" rid="R30">30</xref>], that allows engineered bacteria cells to exhibit two stable steady states of gene expression. In this case, we checked our newly proposed kernel filter for parameter fitting on experimental data. Of note, the bacterial vs mammalian systems we used as test beds present very different dynamics (the bacterial systems are an order of magnitude faster than the mammalian one). We observed that the kernel filter outperforms a particle filter when a low sampling rate (less than forty samples per period for the bacterial systems and three samples per period for the mammalian system) is used. We also show that, for the bacterial systems, the kernel filter is better over all sampling rates.</p><p id="P8">The structure of this paper is as follows. <xref ref-type="sec" rid="S2">Section 2</xref> describes the kernel and particle filters, including an overview of the filters used within a feedback controller using MPC. <xref ref-type="sec" rid="S8">Section 3</xref> compares the performance of the two filters in predicting the future behaviour of the states and compares the performance within an MPC controller for the three genetic networks. <xref ref-type="sec" rid="S20">Section 4</xref> presents the conclusions of this study.</p></sec><sec id="S2" sec-type="methods"><label>2</label><title>Methods</title><sec id="S3"><label>2.1</label><title>Kernel Filter</title><p id="P9">Consider the dynamic system <disp-formula id="FD1"><label>(1)</label><mml:math id="M1"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>˙</mml:mo></mml:mover></mml:mstyle><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>x</mml:mi></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.2em"/><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>x</mml:mi></mml:mstyle><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ξ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <bold>x</bold> are the states of the system, <italic>f</italic> is a known nonlinear vector field and <italic>ϕ</italic> are the unknown model parameters. <italic>y</italic> represents the measurement of the states, which is assumed to be perturbed by additive Gaussian noise, <italic>d</italic>, of covariance, <italic>ξ</italic>. The state estimate at time <italic>t</italic>, <inline-formula><mml:math id="M2"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, is given by solving <disp-formula id="FD2"><label>(2)</label><mml:math id="M3"><mml:mrow><mml:mover><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mstyle><mml:mo>˙</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M4"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> are the estimated model parameters.</p><p id="P10">Kernels are frequently used to predict a future state [<xref ref-type="bibr" rid="R31">31</xref>], by lifting lower dimensional nonlinear problem space measurements, <italic>y</italic>, to infinite dimensional linear feature spaces. The kernel is then used to describe the cross product of two measurements in this Hilbert space, meaning that the infinite transformation dictionary never has to be evaluated. Rather than comparing a single measurement to a model prediction, the kernel can be used to relate all previous measurements and indicate whether the prediction from a candidate model seems reasonable when compared to all the past measurements. In Ref. [<xref ref-type="bibr" rid="R26">26</xref>], the authors estimate the nominal parameter set, <italic>ϕ</italic>, by maximising the similarity between a kernel containing the outputs of a candidate model and a kernel containing just the measurements, using the Hilbert Schmidt Independence Criterion (HSIC) [<xref ref-type="bibr" rid="R32">32</xref>]. Here, we adapt this method to work online, to be part of an adaptive MPC re-estimating the system parameters within each time step and using a sliding kernel window and an adaptive grid search.</p><p id="P11">We define the measurement vector, <italic>Y</italic><sub><italic>t</italic>−<italic>W</italic>:<italic>t</italic></sub> = [<italic>y</italic><sup><italic>T</italic></sup> (<italic>t</italic> −<italic>W</italic>), <italic>y</italic><sup><italic>T</italic></sup> (<italic>t</italic>− <italic>W</italic> + 1),…, <italic>y</italic><sup><italic>T</italic></sup> (<italic>t</italic>)] and a state vector, <italic>X</italic><sub><italic>t</italic> − <italic>W</italic>:<italic>t</italic></sub> = [<bold>x</bold><sup><italic>T</italic></sup> (<italic>t</italic> −<italic>W</italic>), <bold>x</bold><sup><italic>T</italic></sup> (<italic>t</italic> −<italic>W</italic> + 1), …, <bold>x</bold><sup><italic>T</italic></sup> (<italic>t</italic>)], where <italic>W</italic> represents the kernel’s sliding window size. <italic>W</italic> prevents the kernel from growing in size as more measurements are taken.</p><p id="P12">The prediction kernel, <inline-formula><mml:math id="M5"><mml:mrow><mml:msup><mml:mi>κ</mml:mi><mml:mi>x</mml:mi></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, uses a mixed vector, <inline-formula><mml:math id="M6"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mi>W</mml:mi><mml:mo>:</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mi>W</mml:mi><mml:mo>:</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mspace width="0.2em"/><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> containing past measurements and one predictive step, <inline-formula><mml:math id="M7"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, where <italic>υ</italic> is the step number within the prediction horizon used. Following investigations, a Periodic kernel is used in all simulations as discussed in <xref ref-type="supplementary-material" rid="SD1">Section S1</xref>. Each element of the kernel is calculated as <disp-formula id="FD3"><label>(3)</label><mml:math id="M8"><mml:mrow><mml:msubsup><mml:mi>κ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mi>x</mml:mi></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mn>4</mml:mn><mml:mi>ℓ</mml:mi></mml:mfrac><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>p</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
</p><p id="P13">The measurement kernel, <italic>κ</italic><sup><italic>y</italic></sup>, is calculated using only the measurements <italic>Y</italic><sub><italic>t</italic>−<italic>W</italic>:<italic>t</italic></sub> as <disp-formula id="FD4"><label>(4)</label><mml:math id="M9"><mml:mrow><mml:msubsup><mml:mi>κ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mi>y</mml:mi></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mi>W</mml:mi><mml:mo>:</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mn>4</mml:mn><mml:mi>ℓ</mml:mi></mml:mfrac><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>p</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>p</italic> is the periodic hyperparameter, <italic>ℓ</italic> dictates the exponential length scale of the kernel and <italic>σ</italic><sub><italic>n</italic></sub> weighs the expected noise. The hyperparameters are initially chosen by the method described in [<xref ref-type="bibr" rid="R26">26</xref>], and then optimised, online, using Marginal Likelihood, [<xref ref-type="bibr" rid="R33">33</xref>], throughout the first kernel window. Hyperparameter optimisation is further discussed in <xref ref-type="supplementary-material" rid="SD1">Section S2</xref>.</p><p id="P14">The similarity between the predicted kernel and measured kernel spaces is compared using the Hilbert Schmidt Independence Criterion (HSIC) [<xref ref-type="bibr" rid="R32">32</xref>], <disp-formula id="FD5"><label>(5)</label><mml:math id="M10"><mml:mrow><mml:mi>H</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mi>C</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>κ</mml:mi><mml:mi>x</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>κ</mml:mi><mml:mi>y</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>T</mml:mtext><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>κ</mml:mi><mml:mi>x</mml:mi></mml:msup><mml:mi>H</mml:mi><mml:msup><mml:mi>κ</mml:mi><mml:mi>y</mml:mi></mml:msup><mml:mi>H</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:msup><mml:mi>κ</mml:mi><mml:mi>x</mml:mi></mml:msup><mml:mi>H</mml:mi><mml:mo>|</mml:mo><mml:msubsup><mml:mo>|</mml:mo><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:msup><mml:mi>κ</mml:mi><mml:mi>y</mml:mi></mml:msup><mml:mi>H</mml:mi><mml:mo>|</mml:mo><mml:msubsup><mml:mo>|</mml:mo><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M11"><mml:mrow><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mtext>Δ</mml:mtext><mml:mi>t</mml:mi></mml:mrow><mml:mi>W</mml:mi></mml:mfrac><mml:mo>,</mml:mo><mml:mi>ξ</mml:mi></mml:mrow></mml:math></inline-formula> is the covariance of the noise present (assumed to be white noise, ξ is a diagonal matrix) and Δ<italic>t</italic> is the time difference between samples. The score tends to one if the two kernels are identical and tends to zero as the difference increases. The global maximum of the HSIC would correspond to the nominal parameter set, <italic>ϕ</italic>.</p><p id="P15">To find <inline-formula><mml:math id="M12"><mml:mrow><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>ϕ</mml:mi></mml:mrow></mml:math></inline-formula>, Ref. [<xref ref-type="bibr" rid="R26">26</xref>] implements both a grid search and a nonlinear optimiser algorithm. Their grid search is a static offline random sample search. Here, we implement a moving sample window around the operating point, as outlined in <xref ref-type="boxed-text" rid="BX1">Algorithm 1</xref>, so the filter can operate online. Gradient-decent-based nonlinear solvers (MATLAB’s® fmincon, IPA, and NOMAD [<xref ref-type="bibr" rid="R34">34</xref>]) were not used as it was found that they often settle on local minima near their initiation point, not improving the predictive states.</p><p id="P16">A grid search requires some knowledge of the initial parameter values to define the finite grid and is otherwise very computationally heavy. The grid used here trials three different values for each parameter, one at the previous optimal parameter value, <inline-formula><mml:math id="M13"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, and another two at ±<italic>ρ</italic>%. The possible parameter change between any two samples depends on the sampling rate. Therefore, the search grid intervals, <italic>ρ</italic>, should depend on this sampling rate. This relationship is discussed in <xref ref-type="supplementary-material" rid="SD1">Section S3</xref>. For a system containing <italic>n</italic> parameters, the discrete set, Φ<sub><italic>t</italic></sub>, contains all 3<sup><italic>n</italic></sup> possible combinations of <inline-formula><mml:math id="M14"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> where each element of <inline-formula><mml:math id="M15"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> has been multiplied by an element of ([1 − <italic>ρ</italic>, 1, 1 + <italic>ρ</italic>]) to create a 3<sup><italic>n</italic></sup> unique trial <inline-formula><mml:math id="M16"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. Whichever sample set, <inline-formula><mml:math id="M17"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, produces the highest HSIC will be chosen as the kernel filter’s parameter estimate, <inline-formula><mml:math id="M18"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. The grid size is defined relative to the parameter values to follow the observed parameter changes. A finer grid can be used, resulting in higher computational costs.</p><boxed-text id="BX1" position="anchor"><label>Algorithm 1</label><caption><title>Kernel Filter</title></caption><p id="P17">1: <bold>for</bold> each sample, at time, <italic>t</italic> <bold>do</bold></p><p id="P18">2: Create the Measurement kernel for the window, <italic>W</italic></p><p id="P19">3: <bold>if</bold> <italic>t &lt; W</italic> <bold>then</bold></p><p id="P20">4:   Optimise kernel hyperparamters, <italic>p, ℓ</italic> and <italic>σ</italic><sub><italic>n</italic></sub></p><p id="P21">5:   Evaluate <italic>κ</italic><sup><italic>y</italic></sup>(<italic>Y</italic><sub>0:<italic>t</italic></sub>) in <xref ref-type="disp-formula" rid="FD4">Eq.(4)</xref></p><p id="P22">6: <bold>else</bold></p><p id="P23">7:   Evaluate <italic>κ</italic><sup><italic>y</italic></sup>(<italic>Y</italic><sub><italic>t</italic>−<italic>W</italic>:<italic>t</italic></sub>) in <xref ref-type="disp-formula" rid="FD4">Eq.(4)</xref></p><p id="P24">8: <bold>end if</bold></p><p id="P25">9: Try all 3<sup><italic>n</italic></sup> trial parameter sets, <inline-formula><mml:math id="M19"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula></p><p id="P26">10: <bold>for</bold> each <inline-formula><mml:math id="M20"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> ∈ Φ<sub><italic>t</italic></sub>, <bold>do</bold></p><p id="P27">11:   Predict <inline-formula><mml:math id="M21"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="FD2">Eq.(2)</xref></p><p id="P28">12:   Create the Prediction kernel for the window, <italic>W</italic></p><p id="P29">13:   <bold>if</bold> <italic>t &lt; W</italic> <bold>then</bold></p><p id="P30">14:   Evaluate <inline-formula><mml:math id="M22"><mml:mrow><mml:msup><mml:mi>κ</mml:mi><mml:mi>x</mml:mi></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>:</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="FD3">Eq.(3)</xref></p><p id="P31">15:   <bold>else</bold></p><p id="P32">16:   Evaluate <inline-formula><mml:math id="M23"><mml:mrow><mml:msup><mml:mi>κ</mml:mi><mml:mi>x</mml:mi></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mi>W</mml:mi><mml:mo>:</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="FD3">Eq.(3)</xref></p><p id="P33">17:   <bold>end if</bold></p><p id="P34">18:   Evaluate and Store <italic>HSIC</italic>(<italic>κ</italic><sup><italic>x</italic></sup>, <italic>κ</italic><sup><italic>y</italic></sup>) in <xref ref-type="disp-formula" rid="FD5">Eq.(5)</xref></p><p id="P35">19:   <bold>end for</bold></p><p id="P36">20:   <inline-formula><mml:math id="M24"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mstyle displaystyle="true"><mml:mrow><mml:mi>arg</mml:mi><mml:mi>max</mml:mi></mml:mrow></mml:mstyle><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mi>H</mml:mi><mml:mi>S</mml:mi><mml:mi>I</mml:mi><mml:mi>C</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>κ</mml:mi><mml:mi>x</mml:mi></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>κ</mml:mi><mml:mi>y</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula></p><p id="P37">21: <bold>end for</bold></p></boxed-text></sec><sec id="S4"><label>2.2</label><title>Particle Filter</title><p id="P38">Particle Filters are a Bayesian filter class that estimates the parameter distributions based on output observations [<xref ref-type="bibr" rid="R35">35</xref>]. It is a well-established method for fitting models and is included here for comparison. The particle filter aims to find <italic>P</italic>(<italic>ϕ</italic>| <italic>Y</italic><sub>0:<italic>t</italic></sub>), the probability of the parameter set given the past measurements. The first two are the basis of all Bayesian filters, using Bayes’ theorem to state an a priori about the distribution of the parameters, <italic>P</italic>(<italic>ϕ</italic>), and the observations of the output to measure, <italic>P</italic>(<italic>Y</italic><sub>0:<italic>t</italic></sub> |<italic>ϕ</italic>). Marginalisation along-side marginal likelihood is used to approximate the probability of the output, regardless of the parameter set, <italic>P</italic>(<italic>Y</italic><sub>0:<italic>t</italic></sub>), by propagating <italic>M</italic> sample parameter sets, <inline-formula><mml:math id="M25"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:math></inline-formula>, through the system, <inline-formula><mml:math id="M26"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>:</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. The distribution of the output, <italic>P</italic>(<italic>Y</italic><sub>0:<italic>t</italic></sub>|<italic>ϕ</italic>), can be approximated as the distribution of these samples, <inline-formula><mml:math id="M27"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mn>0</mml:mn><mml:mo>:</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Each parameter set, <inline-formula><mml:math id="M28"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, is weighted by <italic>ω</italic><sub><italic>i</italic></sub>, an estimate of how likely its output, <inline-formula><mml:math id="M29"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mn>0</mml:mn><mml:mo>:</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> would be to occur for the given output distribution, <italic>P</italic>(<italic>Y</italic><sub>0:<italic>t</italic></sub>|<italic>ϕ</italic>). Each <italic>ω</italic> is summed to form an a posteriori parameter distribution, <disp-formula id="FD6"><label>(6)</label><mml:math id="M30"><mml:mrow><mml:mi>P</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>∣</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>:</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>≈</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mi>δ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:mstyle><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>δ</italic> is the Dirac distribution. With the estimated parameter set as the expected value of this distribution, <inline-formula><mml:math id="M31"><mml:mrow><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>ϕ</mml:mi><mml:mo>∣</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>:</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p><p id="P39">The final step of a particle filter utilises an importance distribution, scaling the weighting, <italic>ω</italic>, by how accurate our model is perceived to be, knowing that it is not an exact representation of the system. After each iteration, the particles can be resampled. The particle filter simulation parameters are discussed in <xref ref-type="supplementary-material" rid="SD1">Section S4</xref>.</p></sec><sec id="S5"><label>2.3</label><title>State Error Index</title><p id="P40">To assess the error of the predictive model fitted by the filters, we define the identification Mean Absolute Error, <italic>MAE</italic> [<xref ref-type="bibr" rid="R36">36</xref>], as <disp-formula id="FD7"><label>(7)</label><mml:math id="M32"><mml:mrow><mml:mi>M</mml:mi><mml:mi>A</mml:mi><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>T</mml:mi><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow></mml:mfrac><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mrow><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msup><mml:mo>|</mml:mo><mml:mn>1</mml:mn></mml:msup></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> calculating the sum over the total simulated time, <italic>T</italic>, of the normalised absolute difference between the predictive states, <inline-formula><mml:math id="M33"><mml:mrow><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula>, and the actual states <italic>X</italic>, over an <italic>N</italic> step prediction horizon. <inline-formula><mml:math id="M34"><mml:mrow><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mi>N</mml:mi><mml:mrow><mml:mtext>Δ</mml:mtext><mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>, the total number of samples within the N-step horizon.</p></sec><sec id="S6"><label>2.4</label><title>Feedback Control Method - Adaptive Model Predictive Control (MPC)</title><p id="P41">MPC uses a model of the plant (system to be controlled) in a feedback loop to estimate the effect of future control inputs on the states, <italic>N</italic> time steps into the future. Prediction horizon steps, <italic>N</italic>, are discrete time steps in the unit of the model (minutes for the bacterial systems in <xref ref-type="sec" rid="S9">Sections 3.1</xref> and <xref ref-type="sec" rid="S17">3.3</xref> and hours for the mammalian system in <xref ref-type="sec" rid="S13">Section 3.2</xref>), evaluating the predicted state at each step. These control inputs are chosen to minimise a cost function, <italic>J</italic>(<bold>E, U</bold>), along with any control input or state constraints [<xref ref-type="bibr" rid="R37">37</xref>], <disp-formula id="FD8"><label>(8)</label><mml:math id="M35"><mml:mrow><mml:mtable columnalign="right"><mml:mtr columnalign="right"><mml:mtd columnalign="right"><mml:mrow><mml:munder><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>U</mml:mi></mml:mstyle></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>J</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>E</mml:mi></mml:mstyle><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>U</mml:mi></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>E</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>Q</mml:mi><mml:mi>E</mml:mi></mml:mstyle><mml:mo>+</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>U</mml:mi></mml:mstyle><mml:mi>T</mml:mi></mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>R</mml:mi><mml:mi>U</mml:mi></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="right"><mml:mtd columnalign="right"><mml:mrow><mml:mspace width="0.2em"/><mml:mi>s</mml:mi><mml:mi>t</mml:mi><mml:mo>.</mml:mo><mml:mspace width="0.2em"/><mml:mspace width="0.2em"/><mml:mo>−</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>U</mml:mi></mml:mstyle><mml:mo>≤</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>U</mml:mi></mml:mstyle><mml:mi>L</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.2em"/><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>U</mml:mi></mml:mstyle><mml:mo>≤</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>U</mml:mi></mml:mstyle><mml:mi>U</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula>
</p><p id="P42">MATLAB’s® nonlinear solver, ’fmincon‘, solves the nonlinear optimisation problem with its interior point algorithm, limited to ten iterations. <bold>E</bold> = [<bold>e</bold>(0), <bold>e</bold>(1),…, <bold>e</bold>(<italic>N</italic>)]<sup><italic>T</italic></sup> describes the future predicted state errors using control inputs, <bold>U</bold> = [<bold>u</bold>(1), <bold>u</bold>(2),…, <bold>u</bold>(<italic>N</italic>)]<sup><italic>T</italic></sup> in the estimate model of the system. The updated model parameters are provided by either the kernel filter or the particle filter in each iteration (outlined in <xref ref-type="sec" rid="S1">Section 1</xref>). Therefore, the model within the MPC is fitted online to the observations being made.</p><p id="P43">The weight of each cost function term can vary the optimal control input. In the examples described here, the control inputs have to stay within their bounds, and only the tracking error is costed (<bold>R</bold> = 0, and <bold>Q</bold> = 1). In all examples, up to the first ten future control inputs are applied to the system to reduce the computation cost and increase the effect of the model on control performance.</p></sec><sec id="S7"><label>2.5</label><title>Control Error Index</title><p id="P44">The performance of the controller is taken as the error between the output state and its reference; we define the control Root Mean Squared Error, <italic>RMSE</italic>, as <disp-formula id="FD9"><label>(9)</label><mml:math id="M36"><mml:mrow><mml:mi>R</mml:mi><mml:mi>M</mml:mi><mml:mi>S</mml:mi><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:mfrac><mml:msqrt><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mstyle></mml:mrow></mml:msqrt><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> calculating the sum over all time, <italic>T</italic>, of the difference between the actual output <italic>Y</italic> and reference, <italic>r</italic><sub><italic>i</italic></sub> = <italic>r</italic>(<italic>t</italic> = <italic>i</italic>Δ<italic>t</italic>).</p></sec></sec><sec id="S8" sec-type="results"><label>3</label><title>Results</title><sec id="S9"><label>3.1</label><title>Synthetic Gene Oscillator</title><p id="P45">The model of synthetic gene oscillator found in [<xref ref-type="bibr" rid="R28">28</xref>] has been used here, describing the interactions between a CI protein (<italic>X</italic><sub>1</sub>) and a LAC protein (<italic>X</italic><sub>2</sub>). A four-state kinetics model, containing both the proteins and their corresponding dimers, is reduced to a two-state model containing a dimensionless representation of the CI protein (<italic>x</italic><sub>1</sub>) and the LAC protein as (<italic>x</italic><sub>2</sub>), <disp-formula id="FD10"><label>(10)</label><mml:math id="M37"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>˙</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:mi>σ</mml:mi><mml:msubsup><mml:mi>x</mml:mi><mml:mn>1</mml:mn><mml:mn>4</mml:mn></mml:msubsup></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mi>σ</mml:mi><mml:msubsup><mml:mi>x</mml:mi><mml:mn>1</mml:mn><mml:mn>4</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mn>2</mml:mn><mml:mn>4</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD11"><label>(11)</label><mml:math id="M38"><mml:mrow><mml:mi>τ</mml:mi><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>˙</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:mi>σ</mml:mi><mml:msubsup><mml:mi>x</mml:mi><mml:mn>1</mml:mn><mml:mn>4</mml:mn></mml:msubsup></mml:mrow><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mi>σ</mml:mi><mml:msubsup><mml:mi>x</mml:mi><mml:mn>1</mml:mn><mml:mn>4</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mn>2</mml:mn><mml:mn>4</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></disp-formula> <disp-formula id="FD12"><label>(12)</label><mml:math id="M39"><mml:mrow><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ξ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P46">The CI protein promotes both the CI and LAC dimers, whereas the LAC protein inhibits both dimers, as shown in <xref ref-type="fig" rid="F2">Fig. 2</xref>. The system parameters are discussed in <xref ref-type="supplementary-material" rid="SD1">Section S5</xref>. For all time varying parameter simulations, <italic>ϕ</italic><sub>0</sub> = [<italic>α, σ</italic>] = [<xref ref-type="bibr" rid="R11">11</xref>, <xref ref-type="bibr" rid="R2">2</xref>].</p><sec id="S10"><label>3.1.1</label><title>Low sampling rate filtering</title><p id="P47">To compare the error of the kernel filter to the commonly used particle filter, [<xref ref-type="bibr" rid="R38">38</xref>], <italic>α</italic> and σ within the nominal parameter set, <italic>ϕ</italic>, have been changed throughout a simulation. This change can be seen by the black lines in <xref ref-type="fig" rid="F3">Fig. 3B</xref>, with an increase in <italic>α</italic> to 2.25 times its initial value, then an equivalent decrease, followed by an increase of <italic>σ</italic> to 2.25 times its initial value, then an equivalent decrease. Within the nominal parameter set, <italic>ϕ</italic>, all other parameters remain at their initial values throughout the simulation. The filters attempt to fit the parameter set, <inline-formula><mml:math id="M40"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, such that state predictions, <inline-formula><mml:math id="M41"><mml:mrow><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, follow the actual states, <italic>X</italic> (<italic>ϕ</italic>). The prediction trajectories show the state trajectories that are predicted using the state and estimated parameters. Predictions are made at each output sample.</p><p id="P48"><xref ref-type="fig" rid="F3">Fig. 3A</xref> displays the predicted trajectories when the system is sampled every 12.5 minutes. The kernel filter manages to change the amplitude and period of the oscillations between 300 and 900 minutes to almost no oscillations. In contrast, the particle filter struggles to remain close to the system’s response simulated with nominal parameter values. The identification <italic>MAE</italic> reflects this as 0.0884 <italic>&lt;</italic> 0.2850 for the kernel and particle filter, respectively.</p><p id="P49"><xref ref-type="fig" rid="F3">Fig. 3B</xref> shows the parameter variation. It can be seen that the kernel filter makes up for the decrease in <italic>α</italic> by initially increasing <italic>σ</italic>, still achieving a reasonable state estimation. It is also shown that the particle filter does not significantly change either parameter from the initial estimation. The model is over-parameterised, resulting in parameter non-identifiability [<xref ref-type="bibr" rid="R39">39</xref>], meaning that there are several parameter sets, <inline-formula><mml:math id="M42"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:math></inline-formula>, that lead to near identical state predictions and therefore, the filter could choose any of these sets as <inline-formula><mml:math id="M43"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> and still achieve good state tracking. <xref ref-type="supplementary-material" rid="SD1">Section S6</xref> includes simulations with measurement noise of covariance <italic>ξ</italic> = 10<sup>−2.5</sup>.</p></sec><sec id="S11"><label>3.1.2</label><title>Low sampling rate control</title><p id="P50">As discussed in <xref ref-type="sec" rid="S6">Section 2.4</xref>, either filter can be used to fit the model within an MPC scheme. The synthetic gene oscillator has been synthetically designed to oscillate in its free response [<xref ref-type="bibr" rid="R40">40</xref>]; the controller discussed here can be used to steer the amplitude and period of the oscillations. A sine wave with a frequency of roughly ten times slower than the free response is used as the reference, <bold>r</bold>(<italic>t</italic>). These slow reference dynamics can highlight any errors within the MPC’s model.</p><p id="P51">Identical to <xref ref-type="sec" rid="S10">Section 3.1.1</xref>, the temporal evolution of <italic>α</italic> and <italic>σ</italic> within the nominal parameter set, <italic>ϕ</italic>, has been changed throughout a simulation, shown by the black lines in <xref ref-type="fig" rid="F4">Fig. 4B</xref>. The filters attempt to fit the parameters, <inline-formula><mml:math id="M44"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, such that state predictions, <inline-formula><mml:math id="M45"><mml:mrow><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, follow the actual states, <italic>X</italic> (<italic>ϕ</italic>) and therefore give the MPC algorithm a more accurate model.</p><p id="P52"><xref ref-type="fig" rid="F4">Fig. 4A</xref> shows the synthetic gene oscillator control response sampling every 12.5 minutes (8.8 samples per period). It can be seen that when the free response amplitude and centre of oscillation change between 400 and 1000 minutes, the kernel filter has a smaller control error than the particle filter. The particle filter’s MPC believes the system would naturally oscillate with larger amplitudes between these times, causing the controller to miss the reference. The control <italic>RMSE</italic> of the synthetic gene oscillator is 0.1529 for the kernel filter and 0.2330 for the particle filter.</p><p id="P53"><xref ref-type="fig" rid="F4">Fig. 4B</xref> shows the parameter variation of the synthetic gene oscillator sampling every 12.5 minutes. The particle filter rarely changes the parameters, whereas the kernel filter increases <italic>α</italic> and <italic>σ</italic> when <italic>α</italic> increases in the nominal set. These parameter changes lead to the smaller control error seen in <xref ref-type="fig" rid="F4">Fig. 4A</xref>.</p></sec><sec id="S12"><label>3.1.3</label><title>Varied sampling rate identification and control</title><p id="P54">The identification Mean Absolute Error <italic>MAE</italic> Eq.(7) of the two filters is compared over a range of sampling rates in <xref ref-type="fig" rid="F5">Fig. 5A</xref>, looking at the prediction trajectories (as in <xref ref-type="fig" rid="F3">Fig. 3</xref>). The control Root Mean Squared Error, <italic>RMSE</italic> <xref ref-type="disp-formula" rid="FD9">Eq.(9)</xref> of the two filters is compared over a range of sampling rates in <xref ref-type="fig" rid="F5">Fig. 5B</xref> comparing the control performance of the two filters following the same reference as described in <xref ref-type="sec" rid="S11">Section 3.1.2</xref>, used within MPC controllers (as in <xref ref-type="fig" rid="F4">Fig. 4</xref>). It can be seen that the kernel filter outperforms the standard particle filter over all sampling rates up until 80 minutes (1.57 samples per period), where both filters follow the identification <italic>MAE</italic> of the static model.</p><p id="P55">Similarly to the identification MAE in <xref ref-type="fig" rid="F5">Fig. 5A</xref>, the control <italic>RMSE</italic> in <xref ref-type="fig" rid="F5">Fig. 5B</xref> shows the kernel filter outperforming the particle filter over all sampling rates.</p><p id="P56">For fast sampling rates, it is expected that the identification <italic>MAE</italic> and control <italic>RMSE</italic> would be reduced as the filters are observing the system more frequently. This can be seen for both the particle and the kernel filter. Once the filter is used in a rapid sampling regime, the best filter will depend on the filter setup and the underlying system itself. Depending on the relative size of the parameters and the output’s sensitivity to each parameter.</p><p id="P57">The control <italic>RMSE</italic> can be seen in <xref ref-type="fig" rid="F5">Fig. 5C and D</xref> over varied sampling rates and prediction horizons, <italic>N</italic>. For both the particle and kernel filters, it can be seen that as the prediction horizon gets longer, the control error increases. We expect that there will be a decrease in tracking error with longer prediction horizons as the controller gains more information about the future consequences of the inputs. However, for nonlinear systems with time-varying parameters, longer predictions with fixed parameters, <inline-formula><mml:math id="M46"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, can mislead the MPC [<xref ref-type="bibr" rid="R41">41</xref>]. Model prediction trajectories consider fixed parameters, <inline-formula><mml:math id="M47"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, which are only locally accurate. A significant decrease in control <italic>RMSE</italic> can be seen when including a second time step in the prediction horizon for slower sampling times. This is explained by the fact that each prediction step represents a significant jump in time for each state at such a low sampling rate. For instance, for 80 minutes between samples, one prediction step represents almost 0.75 times the oscillation period of the system.</p><p id="P58">As the sampling rate decreases, the control error increases. Therefore, we expect the bottom left corner of the plot to be the darkest region, with the lowest control error and the top right corner to be the brightest, with the highest control error. For the kernel filter in <xref ref-type="fig" rid="F5">Fig. 5C</xref>, for all prediction horizons, the offset of the darker region persists until larger sampling rates are compared to the particle filter in <xref ref-type="fig" rid="F5">Fig. 5D</xref>. There is a significantly darker region for the kernel filter compared to the particle filter between sampling times of 2.5-60 minutes (44−1.83 samples per period) and any prediction horizon, showing that the kernel filter outperforms the particle filter, not only at <italic>N</italic> = 10 (as in <xref ref-type="fig" rid="F5">Fig. 5B</xref>) but for all prediction horizons shown.</p></sec></sec><sec id="S13"><label>3.2</label><title>P53 Oscillator</title><p id="P59">The model of a P53 oscillator describes the interactions between the p53 protein and the Mdm2 protein. Model 4 from [<xref ref-type="bibr" rid="R29">29</xref>] is used here, containing three states: P53 protein as <italic>x</italic><sub>1</sub>; the Mdm2 precursor as <italic>x</italic><sub>2</sub> and the Mdm2 protein as <italic>x</italic><sub>3</sub>. <disp-formula id="FD13"><label>(13)</label><mml:math id="M48"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>˙</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mfrac><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD14"><label>(14)</label><mml:math id="M49"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>˙</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD15"><label>(15)</label><mml:math id="M50"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>˙</mml:mo></mml:mover><mml:mn>3</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mi>u</mml:mi><mml:msub><mml:mi>x</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD16"><label>(16)</label><mml:math id="M51"><mml:mrow><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>ξ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P60">A schematic of the P53-Mdm2 interaction is shown in <xref ref-type="fig" rid="F6">Fig. 6</xref>, displaying this cascade system’s feedback through an inhibition of P53 from Mdm2. The input to the system, <italic>u</italic>, is an extra degradation of Mdm2 [<xref ref-type="bibr" rid="R42">42</xref>].</p><p id="P61">The system parameters are discussed in <xref ref-type="supplementary-material" rid="SD1">Section S7</xref>. For all time varying parameter simulations, <italic>ϕ</italic><sub>0</sub> = [<italic>α</italic><sub><italic>y</italic></sub>, <italic>α</italic><sub>0</sub>, <italic>α</italic><sub><italic>k</italic></sub>, <italic>k, β</italic><sub><italic>x</italic></sub>, <italic>β</italic><sub><italic>y</italic></sub>] = [0.8, 0.9, 1.7, 0.001, 0.9, 1.2]. The system has six kinematic constants, and three have been selected to be fitted within the filters. <italic>α</italic><sub>0</sub>, <italic>α</italic><sub><italic>k</italic></sub> and <italic>β</italic><sub><italic>y</italic></sub> have been chosen as they characterise the speed of the two cascade reactions, <italic>x</italic><sub>1</sub> → <italic>x</italic><sub>2</sub> and <italic>x</italic><sub>2</sub> → <italic>x</italic><sub>3</sub> as well as the feedback inhibition, <italic>x</italic><sub>3</sub> ⊣ <italic>x</italic><sub>1</sub>.</p><sec id="S14"><label>3.2.1</label><title>Low sampling rate filtering</title><p id="P62">We compare the state trajectory error of the filters as discussed in <xref ref-type="sec" rid="S10">Section 3.1.1</xref>. This change in <italic>α</italic><sub>0</sub> and <italic>α</italic><sub><italic>k</italic></sub> can be seen by the black lines in <xref ref-type="fig" rid="F7">Fig. 7B</xref>, with the increase in <italic>α</italic><sub>0</sub> to 1.5 times its initial value then an equivalent decrease, followed by a decrease of <italic>α</italic><sub><italic>k</italic></sub> to 0.5 times its initial value, then an equivalent increase. The prediction trajectories are the future predictions using the current model, taken from the point where every fourth measurement is taken. The trajectories are 10 hours long.</p><p id="P63">The predicted states of the P53 system, sampled every 2 hours (3 samples per period) in <xref ref-type="fig" rid="F7">Fig. 7A</xref>, demonstrate that the kernel filter outperforms the particle filter. The trajectory length is 10 hours (every fifth measurement), to increase the filter error and make a clear, visible distinction between the two filters’ performances. This can be seen between 25 and 100 hours with the decrease and then increase in amplitude of <italic>x</italic><sub>2</sub> and between 125 and 225 hours, where neither filter perfectly matches the changes in the centre of the oscillation for all three states, but the kernel filter does qualitatively and quantitatively better. It can later be seen that this difference is significant in the control simulations between these times. The identification <italic>MAE</italic> (<xref ref-type="disp-formula" rid="FD7">Eq.(7)</xref>) of the kernel filter, 0.0685, is significantly less than the identification <italic>MAE</italic> of the particle filter, 0.1760. <xref ref-type="supplementary-material" rid="SD1">Section S8</xref> includes simulated measurement noise.</p><p id="P64">The corresponding parameter variations are shown in <xref ref-type="fig" rid="F7">Fig. 7B</xref>. It can be seen that the kernel filter has minimal variation in <italic>β</italic><sub><italic>y</italic></sub> whilst following the overall trend of <italic>α</italic><sub>0</sub> and <italic>α</italic><sub><italic>k</italic></sub>. The particle filter fails to track these parameter changes, veering all three parameters away from the initial estimate without following the trend of the nominal varying parameters, <italic>ϕ</italic>.</p></sec><sec id="S15"><label>3.2.2</label><title>Low sampling rate control</title><p id="P65">The P53 system is said to synchronise the cellular clock [<xref ref-type="bibr" rid="R43">43</xref>], controlling the proliferation cycle. Even in the presence of genetic mutations, this controller could control the amplitude and period of these oscillations to steer cellular senescence, apoptosis, cell cycle arrest and DNA repair [<xref ref-type="bibr" rid="R44">44</xref>], leading to effective personalised cancer treatments and regulation of cellular stress. A sine wave with a frequency of roughly ten times slower than the system’s free response is used again as the reference, <bold>r</bold>(<italic>t</italic>). The changes in <italic>α</italic><sub>0</sub> and <italic>α</italic><sub><italic>k</italic></sub> are identical to those discussed in <xref ref-type="sec" rid="S10">Section 3.2.1</xref>.</p><p id="P66">The control performance of both filters can be seen in <xref ref-type="fig" rid="F8">Fig. 8A</xref>, sampling every 2 hours (3 samples per period). Between 125 and 225 hours, the parameter changes cause the free response to change its centre of oscillation and amplitude. Both filters fit their models to keep up with this, but it can be seen that the particle filter does not keep up with these changes, causing a large error from the reference between these times. The kernel’s control <italic>RMSE</italic> of 0.2297 is less than the particle filter’s control <italic>RMSE</italic> of 0.3255.</p><p id="P67">The parameter changes within <xref ref-type="fig" rid="F8">Fig. 8B</xref> for the P53 system show the kernel filter roughly follows the nominal parameter changes, <italic>ϕ</italic>. Initiating changes in <italic>α</italic><sub>0</sub> and <italic>α</italic><sub><italic>k</italic></sub> to match the time-varying <italic>ϕ</italic>. The particle filter does not have an informed variation from the initial estimation at this sampling rate and remains close to the initial estimation throughout the simulation.</p></sec><sec id="S16"><label>3.2.3</label><title>Varied sampling rate identification and control</title><p id="P68">The identification Mean Absolute Error, <italic>MAE</italic> <xref ref-type="disp-formula" rid="FD7">Eq.(7)</xref>, indexing the error in the prediction trajectories (as in <xref ref-type="fig" rid="F7">Fig. 7</xref>) and the control Root Mean Squared Error, <italic>RMSE</italic> <xref ref-type="disp-formula" rid="FD9">Eq.(9)</xref>, indexing the controller performance (as in <xref ref-type="fig" rid="F8">Fig. 8</xref>, using the reference described in <xref ref-type="sec" rid="S12">Section 3.2.2</xref>) are compared over a range of sampling rates in <xref ref-type="fig" rid="F9">Fig. 9</xref>.</p><p id="P69">For the state trajectories in <xref ref-type="fig" rid="F9">Fig. 9A</xref>, there is a separation of the two filter’s identification <italic>MAE</italic> at a sample time of 1.25 hours (5.14 samples per period), where the kernel filter tracking error remains significantly below that of the particle filter, showing that when sampling less than every 1.25 hours, the kernel filter outperforms the particle filter. Sampling less than once every 10 hours (0.6 samples per period), both filters tend to the identification <italic>MAE</italic> of a static model where the parameters are fixed at the initial value. At this point, neither filter varies the parameters, and the initial steady-state oscillation is unaltered by either filter.</p><p id="P70">There is a transition at 2 hours between samples (3 samples per period), where the control <italic>RMSE</italic> of the kernel filter crosses that of the particle filter for the first time, showing that the kernel filter outperforms the particle filter for sampling times slower than every 2 hours. This transition point (sampling 1.25 times an hour) is similar to the filtering simulation shown in <xref ref-type="fig" rid="F9">Fig. 9A</xref>.</p><p id="P71"><xref ref-type="fig" rid="F9">Fig. 9C and D</xref> display the control <italic>RMSE</italic> over varied sampling rates and prediction horizons, <italic>N</italic>. We expect the bottom left corner of the plot to be the darkest region with the lowest control error. There is a darker region for the kernel filter compared to the particle filter between 4 and 7 hour sampling times (1.5-1.17 samples per period) over all prediction horizons, but not between 1 and 3 hours. It can be seen in <xref ref-type="fig" rid="F9">Fig. 9B</xref> that the kernel filter still performs better at slower sampling times, not shown in <xref ref-type="fig" rid="F9">Fig. 9C and D</xref>.</p><p id="P72">The range of sampling times has been chosen to reflect the likely sampling times in-vitro, avoiding phototoxicity of faster sampling times and the slowest sampling times that are well within the device’s capabilities. In-silico, we find that the largest performance advantages of the kernel filter are at longer sampling times, up to 40 hours between samples, as discussed in <xref ref-type="supplementary-material" rid="SD1">Section S9</xref>. This demonstrates the theoretical advantages of the kernel filter within adaptive MPC schemes at even longer sampling times.</p><p id="P73"><xref ref-type="fig" rid="F9">Fig. 9C</xref> is not as smooth as the synthetic gene oscillator in <xref ref-type="fig" rid="F5">Fig. 5C</xref>; multiple ’light spots‘ for both the kernel and particle filters can be seen. This difference is due to P53 system dynamics and the increased number of fitted parameters, as discussed in <xref ref-type="supplementary-material" rid="SD1">Section S10</xref>. The ODE system has six kinematic constants, yet only three have been fitted here. The more parameters added, the lower the average performance error, but the larger the control error variance, as discussed in <xref ref-type="supplementary-material" rid="SD1">Section S11</xref>. The grid search limits the parameter space that the kernel filter can jump between each step. Therefore, the kernel filter can be trapped at a local minimum, which causes performance to degrade progressively. Without a more global optimisation algorithm, the filter cannot leave this neighbourhood to retrieve more optimal solutions, leading to the ’light spots‘. A more extensive grid can reduce a ’light spot’ found in <xref ref-type="fig" rid="F9">Fig. 9C</xref> at <italic>N</italic> = 9, sampling time of 2 hours, from <italic>RMSE</italic> = 0.3473 to <italic>RMSE</italic> = 0.2365 (discussed in <xref ref-type="supplementary-material" rid="SD1">Section S12</xref>).</p></sec></sec><sec id="S17"><label>3.3</label><title>Toggle Switch</title><p id="P74">The toggle switch is one of the most well-studied networks in synthetic biology [<xref ref-type="bibr" rid="R45">45</xref>, <xref ref-type="bibr" rid="R46">46</xref>]. We will focus here on the recent implementation in <italic>E. coli</italic> cells proposed in [<xref ref-type="bibr" rid="R45">45</xref>], where the network is composed of two proteins, TetR and LacI, that inhibit each other. Two external inputs (i.e. drugs IPTG and aTc) can be used to control the system and make it switch from one stable steady state to the other (<xref ref-type="fig" rid="F10">Fig. 10</xref>). The differential equation model of the system [<xref ref-type="bibr" rid="R45">45</xref>] is reported below <xref ref-type="disp-formula" rid="FD17">Eq. (17)</xref> to <xref ref-type="disp-formula" rid="FD22">Eq. (22)</xref>. The first four equations in the model describe the dynamics of TetR and LacI mRNAs and proteins, using mass action kinetics. The final two equations describe the dynamics of the two inputs, differentiating between their extracellular and intracellular concentrations. The system parameters are discussed in <xref ref-type="supplementary-material" rid="SD1">Section S13</xref>. <disp-formula id="FD17"><label>(17)</label><mml:math id="M52"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mtext>mRNA</mml:mtext></mml:mrow><mml:mrow><mml:mi>L</mml:mi><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>I</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msubsup><mml:mi>κ</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mn>0</mml:mn></mml:mrow><mml:mi>L</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>κ</mml:mi><mml:mi>m</mml:mi><mml:mi>L</mml:mi></mml:msubsup><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>TetR</mml:mtext></mml:mrow><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mtext>TetR</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>⋅</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>aTc</mml:mtext></mml:mrow><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mtext>aTc</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>η</mml:mi><mml:mi>a</mml:mi></mml:msub><mml:mtext>Tc</mml:mtext></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>η</mml:mi><mml:mrow><mml:mtext>TetR</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:msubsup><mml:mi>g</mml:mi><mml:mi>m</mml:mi><mml:mi>L</mml:mi></mml:msubsup><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mtext>mRNA</mml:mtext></mml:mrow><mml:mrow><mml:mtext>LacI</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD18"><label>(18)</label><mml:math id="M53"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mtext>mRNA</mml:mtext></mml:mrow><mml:mrow><mml:mtext>TetR</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msubsup><mml:mi>κ</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mn>0</mml:mn></mml:mrow><mml:mi>T</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>κ</mml:mi><mml:mi>m</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>LacI</mml:mtext></mml:mrow><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mtext>LacI</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>⋅</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>IPTG</mml:mtext></mml:mrow><mml:mrow><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mtext>IPTG</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>η</mml:mi><mml:mrow><mml:mtext>IPTG</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>η</mml:mi><mml:mrow><mml:mtext>LacI</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:msubsup><mml:mi>g</mml:mi><mml:mi>m</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mtext>mRNA</mml:mtext></mml:mrow><mml:mrow><mml:mtext>TetR</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD19"><label>(19)</label><mml:math id="M54"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:mtext>LacI</mml:mtext></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msubsup><mml:mi>κ</mml:mi><mml:mi>p</mml:mi><mml:mi>L</mml:mi></mml:msubsup><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mtext>mRNA</mml:mtext></mml:mrow><mml:mrow><mml:mtext>LacI</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mi>g</mml:mi><mml:mi>p</mml:mi><mml:mi>L</mml:mi></mml:msubsup><mml:mo>⋅</mml:mo><mml:mtext>LacI,</mml:mtext></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD20"><label>(20)</label><mml:math id="M55"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:mtext>TetR</mml:mtext></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msubsup><mml:mi>κ</mml:mi><mml:mi>p</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:mo>⋅</mml:mo><mml:msub><mml:mrow><mml:mtext>mRNA</mml:mtext></mml:mrow><mml:mrow><mml:mtext>TetR</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mi>g</mml:mi><mml:mi>p</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:mo>⋅</mml:mo><mml:mtext>TetR,</mml:mtext></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD21"><label>(21)</label><mml:math id="M56"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:mi>a</mml:mi><mml:mtext>Tc</mml:mtext></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>in</mml:mtext></mml:mrow><mml:mrow><mml:mtext>aTc</mml:mtext></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mtext>aTc</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mtext>Tc</mml:mtext></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.1em"/><mml:mspace width="0.2em"/><mml:mi>i</mml:mi><mml:mtext>f</mml:mtext><mml:mspace width="0.2em"/><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mtext>aTc</mml:mtext></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mi>a</mml:mi><mml:mtext>Tc</mml:mtext><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>out</mml:mtext></mml:mrow><mml:mrow><mml:mtext>aTc</mml:mtext></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mtext>aTc</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mtext>Tc</mml:mtext></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.1em"/><mml:mspace width="0.2em"/><mml:mtext>if</mml:mtext><mml:mspace width="0.2em"/><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mtext>aTc</mml:mtext></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mi>a</mml:mi><mml:mtext>Tc</mml:mtext><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD22"><label>(22)</label><mml:math id="M57"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:mtext>IPTG</mml:mtext></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>in</mml:mtext></mml:mrow><mml:mrow><mml:mtext>IPTG</mml:mtext></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mtext>IPTG</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mtext>IPTG</mml:mtext></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.1em"/><mml:mspace width="0.2em"/><mml:mtext>if</mml:mtext><mml:mspace width="0.2em"/><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mtext>IPTG</mml:mtext></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mtext>IPTG</mml:mtext><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>out</mml:mtext></mml:mrow><mml:mrow><mml:mtext>IPTG</mml:mtext></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mtext>IPTG</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mtext>IPTG</mml:mtext></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.1em"/><mml:mtext> if</mml:mtext><mml:mspace width="0.2em"/><mml:msub><mml:mi>u</mml:mi><mml:mrow><mml:mtext>IPTG</mml:mtext></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:mtext>IPTG</mml:mtext><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p><p id="P75">Of the 22 kinematic parameters within the toggle switch system, four have been selected as fitted parameters, <italic>ϕ</italic> = [<italic>η</italic><sub><italic>Lac</italic></sub>, <italic>η</italic><sub><italic>Tet</italic></sub>, <italic>θ</italic><sub><italic>Lac</italic></sub>, <italic>θ</italic><sub><italic>Tet</italic></sub>], as discussed in <xref ref-type="supplementary-material" rid="SD1">Section S13</xref>. These four parameters are the Hill’s parameters of the two mRNA states, describing the effect of the protein-to-protein inhibition. For all time varying parameter simulations, <italic>ϕ</italic><sub>0</sub> = [<italic>η</italic><sub><italic>Lac</italic></sub>, <italic>η</italic><sub><italic>Tet</italic></sub>, <italic>θ</italic><sub><italic>Lac</italic></sub>, <italic>θ</italic><sub><italic>Tet</italic></sub>]= [2.00, 2.00, 31.94, 30.0].</p><sec id="S18"><label>3.3.1</label><title>Low sampling rate filtering</title><p id="P76">The above results used simulated, <italic>in silico</italic> data to compare the performance of the two filters for model fitting, and then used within MPC. Here, we aimed at testing our method on experimental data: we compared the state predictions of the two filters to experimental <italic>in vitro</italic> data from a toggle switch that has been forced to oscillate.</p><p id="P77">The data is taken from [<xref ref-type="bibr" rid="R30">30</xref>], where fourteen experiments, referred to as Exp1 to Exp14, were conducted. The data used can be seen in <xref ref-type="supplementary-material" rid="SD1">Section S14</xref>. As described in [<xref ref-type="bibr" rid="R30">30</xref>], <italic>E. coli</italic> cells embedding the toggle switch gene network were grown in a microfluidic device, allowing for single cell measurement and dynamic provision of media with/without the inducers IPTG and TetR.</p><p id="P78">We now have an <italic>in vitro</italic> plant system with parameters that change over time. Contrary to the previous <italic>in silico</italic> results, in <xref ref-type="sec" rid="S10">Sections 3.1.1</xref> and <xref ref-type="sec" rid="S14">3.2.1</xref>, the controller model is now imperfect/uncertain and the data is corrupted by noise.</p><p id="P79">In <xref ref-type="fig" rid="F11">Fig. 11</xref>, we compare the state trajectory error of the filters to that of the average cell response within Exp5 (<xref ref-type="supplementary-material" rid="SD1">Fig. S18</xref>). The predicted states of the toggle switch system, sampled every 25 minutes (8.4 samples within each of the forcing period of Exp5) in <xref ref-type="fig" rid="F11">Fig. 11A</xref>, demonstrate that the kernel filter outperforms the particle filter. The trajectory length is 50 minutes (every second measurement), to increase the filter error and make a clear distinction between the two filters’ performances. This can be seen at each increase of LacI; the kernel filter has fitted the model parameters sufficiently, such that its LacI trajectories also increase. Whereas the particle filter trajectories immediately descend on all three examples. It can also be seen that at 300 minutes, the particle filter trajectory of LacI rapidly increases away from that of the experimental LacI concentration. The identification <italic>MAE</italic> (<xref ref-type="disp-formula" rid="FD7">Eq.(7)</xref>) of the kernel filter, 0.3080, is less than the identification <italic>MAE</italic> of the particle filter, 0.3880.</p><p id="P80">The corresponding parameter variations are shown in <xref ref-type="fig" rid="F11">Fig. 11B</xref>. It can be seen that the particle filter changes the response of the model by altering both hills coefficients <italic>η</italic><sub><italic>Tet</italic></sub> and <italic>η</italic><sub><italic>Lac</italic></sub>, with minimal changes in either <italic>θ</italic><sub><italic>Tet</italic></sub> or <italic>θ</italic><sub><italic>Lac</italic></sub>. The kernel filter does the opposite, varying dissociation constants (<italic>θ</italic>s) more than the hills coefficients (<italic>η</italic>s). The Hill coefficients approximate the number of bound ligands between the two reactant states, whereas the dissociation constants are the rate of reaction. Therefore, the Hill coefficient usually tends towards integer values, showing that the Kernel filter parameter fittings make more biological sense, as the rate of reaction varies between cells and sample times, but the effect of the number of reactions within the system is fixed.</p></sec><sec id="S19"><label>3.3.2</label><title>Varied sampling rate identification</title><p id="P81">The identification Mean Absolute Error, <italic>MAE</italic> <xref ref-type="disp-formula" rid="FD7">Eq.(7)</xref>, indexing the error in the prediction trajectories (as in <xref ref-type="fig" rid="F11">Fig. 11</xref>) is compared over a range of sampling rates in <xref ref-type="fig" rid="F12">Fig. 12</xref>, matching the simulations in <xref ref-type="fig" rid="F5">Fig. 5A</xref> and <xref ref-type="fig" rid="F9">Fig. 9A</xref>. The experimental data collects samples every five minutes, therefore this is the fastest sampling rate used within these simulations, as this is the region of sample rates used within microfluidic devices. Various samples were not given to the filters to simulate slower sampling rates. For example, at a sampling rate of 10 minutes, every other sample is given to the filters.</p><p id="P82">Each cell within a microfluidics chip will have different rates of reaction, and therefore differ from the <italic>in silico</italic> model in <xref ref-type="disp-formula" rid="FD17">Eq.(17)</xref> to <xref ref-type="disp-formula" rid="FD22">Eq.(22)</xref>, as can be seen in <xref ref-type="supplementary-material" rid="SD1">Fig. S14</xref> to <xref ref-type="supplementary-material" rid="SD1">Fig. S27</xref>. Therefore, the static line in <xref ref-type="fig" rid="F12">Fig. 12</xref>, is the mean of 100 simulations of the toggle switch model (<xref ref-type="disp-formula" rid="FD17">Eq.(17)</xref> to <xref ref-type="disp-formula" rid="FD22">Eq.(22)</xref>) where the parameters are selected from the random distributions described in [<xref ref-type="bibr" rid="R47">47</xref>], similarly based off the mean parameter values in [<xref ref-type="bibr" rid="R30">30</xref>], displaying the expected performance of a static model when used for state trajectories.</p><p id="P83">For the state trajectories plots of the synthetic gene oscillator and P53 oscillator in <xref ref-type="fig" rid="F5">Fig. 5A</xref> and <xref ref-type="fig" rid="F9">Fig. 9A</xref>, we describe three regions of the figure: a fast sampling region where both filters have a low identification MAE; a transition region, where the kernel filter retains a lower identification MAE than the particle filter; and finally a third region where both filter’s identification MAE tends to that of the static model. Due to the sample time limitations in the experimental data used in <xref ref-type="fig" rid="F12">Fig. 12</xref>, we cannot see the first region, as the particle filter’s identification MAE has already tended to that of the static model. Therefore <xref ref-type="fig" rid="F12">Fig. 12</xref> starts within the transition region, where it can be seen that up until a sample time of 30 minutes (7 samples per period), the kernel filter tracking error remains significantly below that of the particle filter, showing that when sampling less than every 30 minutes, the kernel filter outperforms the particle filter. This transition region will be referred to as a low sample rate regime. In contrast, long sampling time, where neither filter outperforms the static parameters, is referred to as a very low sample rate regime. At sample times greater than every 30 minutes, the identification <italic>MAE</italic> of both filters tends to a random fluctuation near the static model line.</p></sec></sec></sec><sec id="S20" sec-type="conclusions"><label>4</label><title>Conclusion</title><p id="P84">In this work, we demonstrated that kernel filters are valid for fitting model parameters according to online measurements at low sampling rates through simulations of three genetic networks. Particle filters are preferable for some plant systems at faster sampling rates, yet at reduced sampling rates, a kernel filter should be used (sampling less than once a minute for the synthetic gene oscillator, less than an hour for the P53 system and all experimentally viable sample rates of the toggle switch). Fitted mathematical models can then be added to a model-based controller to significantly increase controller performance at lower sampling rates.</p><p id="P85">The performance of the kernel filter could be improved in several ways. First, gradient-descent-based optimisers settle on local minima within the landscape of the <italic>HSIC</italic> cost function. A grid search algorithm has been used here, increasing the computational burden significantly with the number of parameters in the model and limiting the selected parameter values to defined discrete groups. A nonlinear solver that could find an acceptable minimum would drastically reduce the computational burden of adapting models with more fitted parameters. The kernel filter could also use Bayesian inference to find the optimal parameter set in the feature space (rather than the particle filter that uses Bayesian inference in the problem space).</p><p id="P86">Our results will facilitate the implementation of cybergenetics for multiple applications across biological systems, where practical considerations can significantly limit the sampling rate used for control.</p></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary Information</label><media xlink:href="EMS199652-supplement-Supplementary_Information.pdf" mimetype="application" mime-subtype="pdf" id="d2aAcEbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S21"><title>Acknowledgement</title><p>An EPSRC DTP Scholarship supports B.S. L.M. is supported by an EPSRC fellowship (grant EP/S01876X/1) and a BBSRC transition award (grant BB/W013959/1).</p></ack><ref-list><ref id="R1"><label>[1]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Del Vecchio</surname><given-names>Domitilla</given-names></name><name><surname>Dy</surname><given-names>Aaron J</given-names></name><name><surname>Qian</surname><given-names>Yili</given-names></name></person-group><article-title>Control theory meets synthetic biology</article-title><source>Journal of The Royal Society Interface</source><year>2016</year><day>7</day><volume>13</volume><issue>120</issue><pub-id pub-id-type="pmcid">PMC4971224</pub-id><pub-id pub-id-type="pmid">27440256</pub-id><pub-id pub-id-type="doi">10.1098/rsif.2016.0380</pub-id></element-citation></ref><ref id="R2"><label>[2]</label><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Khammash</surname><given-names>M</given-names></name><name><surname>Di Bernardo</surname><given-names>M</given-names></name><name><surname>Di Bernardo</surname><given-names>D</given-names></name></person-group><source>Cybergenetics: Theory and Methods for Genetic Control System</source><conf-name>Proceedings of the IEEE Conference on Decision and Control 2019-December</conf-name><conf-date>12 2019</conf-date><fpage>916</fpage><lpage>926</lpage></element-citation></ref><ref id="R3"><label>[3]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Caringella</surname><given-names>Gianpio</given-names></name><name><surname>Bandiera</surname><given-names>Lucia</given-names></name><name><surname>Menolascina</surname><given-names>Filippo</given-names></name></person-group><article-title>Recent advances, opportunities and challenges in cybergenetic identification and control of biomolecular networks</article-title><source>Current Opinion in Biotechnology</source><year>2023</year><day>4</day><volume>80</volume><elocation-id>102893</elocation-id><pub-id pub-id-type="pmid">36706519</pub-id></element-citation></ref><ref id="R4"><label>[4]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smart</surname><given-names>Benjamin</given-names></name><etal/></person-group><article-title>Model predictive control of cancer cellular dynamics: a new strategy for therapy design</article-title><source>Frontiers in Control Engineering</source><year>2022</year><day>9</day><volume>3</volume><elocation-id>935018</elocation-id></element-citation></ref><ref id="R5"><label>[5]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Simpkins</surname><given-names>Alex</given-names></name></person-group><article-title>System Identification: Theory for the User, 2nd Edition (Ljung, L.; 1999) [On the Shelf]</article-title><source>IEEE Robotics &amp; Automation Magazine</source><year>2012</year><day>6</day><volume>19</volume><issue>2</issue><fpage>95</fpage><lpage>96</lpage></element-citation></ref><ref id="R6"><label>[6]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nordh</surname><given-names>Jerker</given-names></name><etal/></person-group><article-title>Particle filtering based identification for autonomous nonlinear ODE models</article-title><source>IFAC-PapersOnLine</source><year>2015</year><day>1</day><volume>48</volume><issue>28</issue><fpage>415</fpage><lpage>420</lpage></element-citation></ref><ref id="R7"><label>[7]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>Xin</given-names></name><name><surname>Niranjan</surname><given-names>Mahesan</given-names></name></person-group><article-title>State and parameter estimation of the heat shock response system using Kalman and particle filters</article-title><source>Bioinformatics</source><year>2012</year><day>6</day><volume>28</volume><issue>11</issue><fpage>1501</fpage><lpage>1507</lpage><pub-id pub-id-type="pmid">22539674</pub-id></element-citation></ref><ref id="R8"><label>[8]</label><element-citation publication-type="journal"><collab>By Erdal and J Associate Member</collab><article-title>Adaptive Modeling, Identification, and control of dynamic structural Systems. I: Theory</article-title><source>Journal of Engineering Mechanics</source><year>1989</year><day>11</day><volume>115</volume><issue>11</issue><fpage>2386</fpage><lpage>2405</lpage></element-citation></ref><ref id="R9"><label>[9]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Transtrum</surname><given-names>Mark K</given-names></name><etal/></person-group><article-title>Perspective: Sloppiness and emergent theories in physics, biology, and beyond</article-title><source>Journal of Chemical Physics</source><year>2015</year><day>7</day><volume>143</volume><issue>1</issue><pub-id pub-id-type="pmid">26156455</pub-id></element-citation></ref><ref id="R10"><label>[10]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marucci</surname><given-names>L</given-names></name></person-group><article-title>Nanog Dynamics in Mouse Embryonic Stem Cells: Results from Systems Biology Approaches</article-title><source>Stem cells international</source><year>2017</year><volume>2017</volume><pub-id pub-id-type="pmcid">PMC5480057</pub-id><pub-id pub-id-type="pmid">28684962</pub-id><pub-id pub-id-type="doi">10.1155/2017/7160419</pub-id></element-citation></ref><ref id="R11"><label>[11]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marucci</surname><given-names>L</given-names></name><etal/></person-group><article-title>Derivation, identification and validation of a computational model of a novel synthetic regulatory network in yeast</article-title><source>Journal of mathematical biology</source><year>2011</year><day>5</day><volume>62</volume><issue>5</issue><fpage>685</fpage><lpage>706</lpage><pub-id pub-id-type="pmid">20549211</pub-id></element-citation></ref><ref id="R12"><label>[12]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Benosman</surname><given-names>Mouhacine</given-names></name></person-group><article-title>Model-based vs data-driven adaptive control: An overview</article-title><source>International Journal of Adaptive Control and Signal Processing</source><year>2018</year><day>5</day><volume>32</volume><issue>5</issue><fpage>753</fpage><lpage>776</lpage></element-citation></ref><ref id="R13"><label>[13]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barkana</surname><given-names>Itzhak</given-names></name></person-group><article-title>Simple adaptive control - a stable direct model reference adaptive control methodology - brief survey</article-title><source>International Journal of Adaptive Control and Signal Processing</source><year>2014</year><day>7</day><volume>28</volume><issue>7-8</issue><fpage>567</fpage><lpage>603</lpage></element-citation></ref><ref id="R14"><label>[14]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>De Cesare</surname><given-names>I</given-names></name><etal/></person-group><article-title>ChipSeg: An Automatic Tool to Segment Bacterial and Mammalian Cells Cultured in Microfluidic Devices</article-title><source>ACS Omega</source><year>2021</year><day>2</day><volume>6</volume><issue>4</issue><fpage>2473</fpage><lpage>2476</lpage><pub-id pub-id-type="pmcid">PMC7859942</pub-id><pub-id pub-id-type="pmid">33553865</pub-id><pub-id pub-id-type="doi">10.1021/acsomega.0c03906</pub-id></element-citation></ref><ref id="R15"><label>[15]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pedone</surname><given-names>E</given-names></name><etal/></person-group><article-title>A tunable dual-input system for on-demand dynamic gene expression regulation</article-title><source>Nature communications</source><year>2019</year><pub-id pub-id-type="pmcid">PMC6775159</pub-id><pub-id pub-id-type="pmid">31578371</pub-id><pub-id pub-id-type="doi">10.1038/s41467-019-12329-9</pub-id></element-citation></ref><ref id="R16"><label>[16]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Postiglione</surname><given-names>L</given-names></name><etal/></person-group><article-title>Regulation of Gene Expression and Signaling Pathway Activity in Mammalian Cells by Automated Microfluidics Feed-back Control</article-title><source>ACS Synthetic Biology</source><year>2018</year><day>11</day><volume>7</volume><issue>11</issue><fpage>2558</fpage><lpage>2565</lpage><pub-id pub-id-type="pmid">30346742</pub-id></element-citation></ref><ref id="R17"><label>[17]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pedone</surname><given-names>E</given-names></name><etal/></person-group><article-title>Cheetah: A Computational Toolkit for Cybergenetic Control</article-title><source>ACS Synthetic Biology</source><year>2021</year><day>5</day><volume>10</volume><issue>5</issue><fpage>979</fpage><lpage>989</lpage><pub-id pub-id-type="pmid">33904719</pub-id></element-citation></ref><ref id="R18"><label>[18]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shannon</surname><given-names>B</given-names></name><etal/></person-group><article-title>In Vivo Feedback Control of an Antithetic Molecular-Titration Motif in Escherichia coli Using Microfluidics</article-title><source>ACS Synthetic Biology</source><year>2020</year><day>10</day><volume>9</volume><issue>10</issue><fpage>2617</fpage><lpage>2624</lpage><pub-id pub-id-type="pmid">32966743</pub-id></element-citation></ref><ref id="R19"><label>[19]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Menolascina</surname><given-names>F</given-names></name><etal/></person-group><article-title>In-Vivo Real-Time Control of Protein Expression from Endogenous and Synthetic Gene Networks</article-title><source>PLoS Comput Biol</source><year>2014</year><volume>10</volume><issue>5</issue><elocation-id>1003625</elocation-id><pub-id pub-id-type="pmcid">PMC4022480</pub-id><pub-id pub-id-type="pmid">24831205</pub-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1003625</pub-id></element-citation></ref><ref id="R20"><label>[20]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Khazim</surname><given-names>M</given-names></name><etal/></person-group><article-title>Towards automated control of embryonic stem cell pluripotency</article-title><source>IFAC-PapersOnLine</source><year>2019</year><day>1</day><volume>52</volume><issue>26</issue><fpage>82</fpage><lpage>87</lpage></element-citation></ref><ref id="R21"><label>[21]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Milias-Argeitis</surname><given-names>Andreas</given-names></name><etal/></person-group><article-title>Automated optogenetic feedback control for precise and robust regulation of gene expression and cell growth</article-title><source>Nature Communications</source><year>2016</year><day>8</day><volume>7</volume><issue>1</issue><fpage>1</fpage><lpage>11</lpage><comment>2016 7:1</comment><pub-id pub-id-type="pmcid">PMC5007438</pub-id><pub-id pub-id-type="pmid">27562138</pub-id><pub-id pub-id-type="doi">10.1038/ncomms12546</pub-id></element-citation></ref><ref id="R22"><label>[22]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ramesh</surname><given-names>Nisha</given-names></name><name><surname>Tasdizen</surname><given-names>Tolga</given-names></name></person-group><article-title>CELL TRACKING USING PARTICLE FILTERS WITH IMPLICIT CONVEX SHAPE MODEL IN 4D CONFOCAL MICROSCOPY IMAGES</article-title><source>Proceedings / ICIP … International Conference on Image Processing</source><year>2014</year><day>1</day><volume>2014</volume><fpage>446</fpage><pub-id pub-id-type="pmcid">PMC4939086</pub-id><pub-id pub-id-type="pmid">27403085</pub-id><pub-id pub-id-type="doi">10.1109/ICIP.2014.7025089</pub-id></element-citation></ref><ref id="R23"><label>[23]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nounou</surname><given-names>MN</given-names></name><name><surname>Nounou</surname><given-names>HN</given-names></name><name><surname>Mansouri</surname><given-names>M</given-names></name></person-group><article-title>Model-based and model-free filtering of genomic data</article-title><source>Network Modeling and Analysis in Health Informatics and Bioinformatics</source><year>2013</year><day>3</day><volume>2</volume><issue>3</issue><fpage>109</fpage><lpage>121</lpage></element-citation></ref><ref id="R24"><label>[24]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fang</surname><given-names>Zhou</given-names></name><name><surname>Gupta</surname><given-names>Ankit</given-names></name><name><surname>Khammash</surname><given-names>Mustafa</given-names></name></person-group><article-title>Convergence of regularized particle filters for stochastic reaction networks</article-title><year>2021</year><day>10</day></element-citation></ref><ref id="R25"><label>[25]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Medvedev</surname><given-names>Alexander</given-names></name><etal/></person-group><article-title>Oscillations-free PID control of anesthetic drug delivery in neuromuscular blockade</article-title><source>Computer Methods and Programs in Biomedicine</source><year>2019</year><day>4</day><volume>171</volume><fpage>119</fpage><lpage>131</lpage><pub-id pub-id-type="pmid">27481776</pub-id></element-citation></ref><ref id="R26"><label>[26]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lindenbaum</surname><given-names>Ofir</given-names></name><etal/></person-group><article-title>Kernel-based parameter estimation of dynamical systems with unknown observation functions</article-title><source>Chaos</source><year>2021</year><day>4</day><volume>31</volume><issue>4</issue><pub-id pub-id-type="pmid">34251227</pub-id></element-citation></ref><ref id="R27"><label>[27]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rapp</surname><given-names>P</given-names></name></person-group><article-title>Why are so many biological systems periodic?</article-title><source>Progress in Neurobiology</source><year>1987</year><day>1</day><volume>29</volume><issue>3</issue><fpage>261</fpage><lpage>273</lpage><pub-id pub-id-type="pmid">3299493</pub-id></element-citation></ref><ref id="R28"><label>[28]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hasty</surname><given-names>J</given-names></name><etal/></person-group><article-title>Synthetic Gene Network for Entraining and Amplifying Cellular Oscillations</article-title><source>Physical Review Letters</source><year>2002</year><day>3</day><volume>88</volume><issue>14</issue><elocation-id>148101</elocation-id><pub-id pub-id-type="pmid">11955179</pub-id></element-citation></ref><ref id="R29"><label>[29]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Geva-Zatorsky</surname><given-names>Naama</given-names></name><etal/></person-group><article-title>Oscillations and variability in the p53 system</article-title><source>Molecular systems biology</source><year>2006</year><day>5</day><volume>2</volume><pub-id pub-id-type="pmcid">PMC1681500</pub-id><pub-id pub-id-type="pmid">16773083</pub-id><pub-id pub-id-type="doi">10.1038/msb4100068</pub-id></element-citation></ref><ref id="R30"><label>[30]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lugagne</surname><given-names>J</given-names></name><etal/></person-group><article-title>Balancing a genetic toggle switch by real-time feedback control and periodic forcing</article-title><source>Nature Communications</source><year>2017</year><pub-id pub-id-type="pmcid">PMC5693866</pub-id><pub-id pub-id-type="pmid">29150615</pub-id><pub-id pub-id-type="doi">10.1038/s41467-017-01498-0</pub-id></element-citation></ref><ref id="R31"><label>[31]</label><element-citation publication-type="other"><person-group person-group-type="author"><name><surname>Priéncipe</surname><given-names>JC Joseé C</given-names></name><name><surname>Liu</surname><given-names>Weifeng</given-names></name><name><surname>Haykin</surname><given-names>Simon S</given-names></name></person-group><source>Kernel adaptive filtering : a comprehensive introduction</source><year>2010</year><fpage>209</fpage></element-citation></ref><ref id="R32"><label>[32]</label><element-citation publication-type="other"><person-group person-group-type="author"><name><surname>Gretton</surname><given-names>Arthur</given-names></name><etal/></person-group><source>Measuring Statistical Dependence with Hilbert-Schmidt Norms</source><year>2005</year><fpage>63</fpage><lpage>77</lpage></element-citation></ref><ref id="R33"><label>[33]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rasmussen</surname><given-names>Carl Edward</given-names></name><name><surname>Williams</surname><given-names>Christopher KI</given-names></name></person-group><article-title>Gaussian Processes for Machine Learning</article-title><source>Gaussian Processes for Machine Learning</source><year>2018</year><day>12</day></element-citation></ref><ref id="R34"><label>[34]</label><element-citation publication-type="others"><collab>NOMAD - A Blackbox Optimization Software : GERAD</collab></element-citation></ref><ref id="R35"><label>[35]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Simo</surname><given-names>Särkkä</given-names></name></person-group><article-title>Bayesian Filtering and Smoothing</article-title><source>Bayesian Filtering and Smoothing, pages</source><year>2013</year><day>1</day><fpage>1</fpage><lpage>232</lpage></element-citation></ref><ref id="R36"><label>[36]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Elmaz</surname><given-names>Furkan</given-names></name><etal/></person-group><article-title>CNN-LSTM architecture for predictive indoor temperature modeling</article-title><source>Building and Environment</source><year>2021</year><day>12</day><volume>206</volume><elocation-id>108327</elocation-id></element-citation></ref><ref id="R37"><label>[37]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Rawlings</surname><given-names>James</given-names></name><name><surname>Mayne</surname><given-names>David Q</given-names></name><name><surname>Diehl</surname><given-names>Moritz M</given-names></name></person-group><source>Model predictive control : theory, computation, and design</source><publisher-name>Nob Hill Publishing</publisher-name><edition>2nd edition</edition><year>2020</year></element-citation></ref><ref id="R38"><label>[38]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chatzi</surname><given-names>Eleni N</given-names></name><name><surname>Smyth</surname><given-names>Andrew W</given-names></name></person-group><article-title>The unscented Kalman filter and particle filter methods for nonlinear structural system identification with non-collocated heterogeneous sensing</article-title><source>Structural Control and Health Monitoring</source><year>2009</year><day>2</day><volume>16</volume><issue>1</issue><fpage>99</fpage><lpage>123</lpage></element-citation></ref><ref id="R39"><label>[39]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Guillaume</surname><given-names>Joseph HA</given-names></name><etal/></person-group><article-title>Introductory overview of identifiability analysis: A guide to evaluating whether you have the right type of data for your modeling purpose</article-title><source>Environmental Modelling &amp; Software</source><year>2019</year><day>9</day><volume>119</volume><fpage>418</fpage><lpage>432</lpage></element-citation></ref><ref id="R40"><label>[40]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bray</surname><given-names>Dennis</given-names></name></person-group><article-title>Protein molecules as computational elements in living cells</article-title><source>Nature</source><year>1995</year><day>7</day><volume>376</volume><issue>6538</issue><fpage>307</fpage><lpage>312</lpage><comment>1995 376:6538</comment><pub-id pub-id-type="pmid">7630396</pub-id></element-citation></ref><ref id="R41"><label>[41]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gunay</surname><given-names>H Burak</given-names></name><etal/></person-group><article-title>Shortest-prediction-horizon model-based predictive control for individual offices</article-title><source>Building and Environment</source><year>2014</year><day>12</day><volume>82</volume><fpage>408</fpage><lpage>419</lpage></element-citation></ref><ref id="R42"><label>[42]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Azam</surname><given-names>Muhammad Rizwan</given-names></name><etal/></person-group><article-title>Sliding mode controller–observer pair for p53 pathway</article-title><source>IET Systems Biology</source><year>2019</year><day>8</day><volume>13</volume><issue>4</issue><fpage>204</fpage><lpage>211</lpage><pub-id pub-id-type="pmcid">PMC8687316</pub-id><pub-id pub-id-type="pmid">31318338</pub-id><pub-id pub-id-type="doi">10.1049/iet-syb.2018.5121</pub-id></element-citation></ref><ref id="R43"><label>[43]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kawamura</surname><given-names>Genki</given-names></name><etal/></person-group><article-title>Cooperative interaction among BMAL1, HSF1, and p53 protects mammalian cells from UV stress</article-title><source>Communications Biology</source><year>2018</year><day>11</day><volume>1</volume><issue>1</issue><fpage>1</fpage><lpage>13</lpage><comment>2018 1:1</comment><pub-id pub-id-type="pmcid">PMC6250677</pub-id><pub-id pub-id-type="pmid">30480104</pub-id><pub-id pub-id-type="doi">10.1038/s42003-018-0209-1</pub-id></element-citation></ref><ref id="R44"><label>[44]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hussain</surname><given-names>SPerwez</given-names></name><name><surname>Harris</surname><given-names>Cutis C</given-names></name></person-group><article-title>p53 Biological Network: At the Crossroads of the Cellular-Stress Response Pathway and Molecular Carcinogenesis</article-title><source>Journal of Nippon Medical School</source><year>2006</year><volume>73</volume><issue>2</issue><fpage>54</fpage><lpage>64</lpage><pub-id pub-id-type="pmid">16641528</pub-id></element-citation></ref><ref id="R45"><label>[45]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lugagne</surname><given-names>J</given-names></name><etal/></person-group><article-title>Balancing a genetic toggle switch by real-time feedback control and periodic forcing</article-title><source>Nature Communications</source><year>2017</year><day>11</day><volume>8</volume><issue>1</issue><fpage>1</fpage><lpage>8</lpage><comment>2017 8:1</comment></element-citation></ref><ref id="R46"><label>[46]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gardner</surname><given-names>Timothy S</given-names></name><name><surname>Cantor</surname><given-names>Charles R</given-names></name><name><surname>Collins</surname><given-names>James J</given-names></name></person-group><article-title>Construction of a genetic toggle switch in Escherichia coli</article-title><source>Nature</source><year>2000</year><day>1</day><volume>403</volume><issue>6767</issue><fpage>339</fpage><lpage>342</lpage><comment>2000 403:6767</comment><pub-id pub-id-type="pmid">10659857</pub-id></element-citation></ref><ref id="R47"><label>[47]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bandiera</surname><given-names>Lucia</given-names></name><name><surname>Gomez-Cabeza</surname><given-names>David</given-names></name><name><surname>Gilman</surname><given-names>James</given-names></name><name><surname>Balsa-Canto</surname><given-names>Eva</given-names></name><name><surname>Menolascina</surname><given-names>Filippo</given-names></name></person-group><article-title>Optimally Designed Model Selection for Synthetic Biology</article-title><source>ACS Synthetic Biology</source><year>2020</year><day>11</day><volume>9</volume><issue>11</issue><fpage>3134</fpage><lpage>3144</lpage><pub-id pub-id-type="pmid">33152239</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>The MPC architecture.</title><p>The biological system to be controlled, the plant, is observed in the output, <italic>y</italic>. The model states, <italic>x</italic>, are assumed to coincide with the plant outputs <italic>y. x</italic> is given to the filter to fit the plant model and compared to the reference, <italic>r</italic>, to be given to the MPC algorithm. The MPC optimally chooses the input, <italic>u</italic>, which acts on the plant system.</p></caption><graphic xlink:href="EMS199652-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>The synthetic gene oscillator in [<xref ref-type="bibr" rid="R28">28</xref>].</title><p>The schematic shows the interactions between a CI protein (<italic>x</italic><sub>1</sub>) and a LAC protein (<italic>x</italic><sub>2</sub>); arrow-ended lines indicate activation, and bar-ended lines indicate inhibition.</p></caption><graphic xlink:href="EMS199652-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>The filters fitting the parameters, online, to match states of the synthetic gene oscillator (<xref ref-type="disp-formula" rid="FD10">Eq.(10)</xref> - <xref ref-type="disp-formula" rid="FD11">Eq.(11)</xref>) in which the nominal parameter value, <italic>ϕ</italic>, changes over time.</title><p>One sample every 12.5 minutes (8.8 samples per period) is used, which is considered a low sampling regime here. Other simulation parameters: <inline-formula><mml:math id="M58"><mml:mrow><mml:mfrac><mml:mi>W</mml:mi><mml:mrow><mml:mtext>Δ</mml:mtext><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mn>500</mml:mn></mml:mrow></mml:math></inline-formula>, <italic>M</italic> = 5000, 0.5 re-sampling threshold, 0.0158 expected variance of parameters. A) Every 50 minutes, the prediction trajectory, <inline-formula><mml:math id="M59"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:mn>50</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> of each filter is compared to the nominal model. B) The parameter fitting of <inline-formula><mml:math id="M60"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, compared to the nominal parameters, <italic>ϕ</italic>. Each parameter has been normalised by the initial parameter defined in <xref ref-type="sec" rid="S9">Section 3.1</xref>.</p></caption><graphic xlink:href="EMS199652-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>The filters fitting the parameters, online, to match the states of the synthetic gene oscillator (<xref ref-type="disp-formula" rid="FD10">Eq.(10)</xref> - <xref ref-type="disp-formula" rid="FD11">Eq.(11)</xref>) in which the nominal parameter value, <italic>ϕ</italic>, changes over time.</title><p>One sample every 12.5 minutes (8.8 samples per period) is used, which is considered a low sampling regime here. Other simulation parameters: the control input is actuated once a minute; <italic>N</italic> = 10 minutes, containing ten input steps <inline-formula><mml:math id="M61"><mml:mrow><mml:mfrac><mml:mi>W</mml:mi><mml:mrow><mml:mtext>Δ</mml:mtext><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mn>50</mml:mn><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> 0.1 is the expected variance of parameters, <italic>M</italic> = 5000, 0.5 resampling threshold. A) The system’s output qualitatively follows the sine wave reference using the control input shown. B) The parameter fitting of <inline-formula><mml:math id="M62"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, compared to the nominal parameters, <italic>ϕ</italic>. Each parameter has been normalised by the initial parameter defined in <xref ref-type="sec" rid="S9">Section 3.1</xref>.</p></caption><graphic xlink:href="EMS199652-f004"/></fig><fig id="F5" position="float"><label>Figure 5</label><caption><p>A) The identification Mean Absolute Error (<italic>MAE</italic>, <xref ref-type="disp-formula" rid="FD7">Eq.(7)</xref>) of the two filters is compared over a range of sampling rates for the synthetic gene oscillator. <xref ref-type="fig" rid="F3">Fig. 3</xref> notes the simulation parameters for the kernel and particle filters. B) The control Root Mean Squared Error (<italic>RMSE</italic>, <xref ref-type="disp-formula" rid="FD9">Eq.(9)</xref>) of the two filters is compared over a range of sampling rates for the synthetic gene oscillator, with simulation parameters as in <xref ref-type="fig" rid="F4">Fig. 4</xref>. C) and D) The control <italic>RMSE</italic> of the kernel filter(C) and the particle filter(D), compared over a range of sampling rates and prediction horizons, <italic>N</italic>, for the synthetic gene oscillator. Other simulation parameters are in <xref ref-type="fig" rid="F4">Fig. 4</xref>.</p></caption><graphic xlink:href="EMS199652-f005"/></fig><fig id="F6" position="float"><label>Figure 6</label><caption><p>P53 Oscillator formed by negative feedback from an Mdm2 protein (<italic>x</italic><sub>3</sub>) on a P53 protein (<italic>x</italic><sub>1</sub>), including a transcriptional Mdm2 precursor (<italic>x</italic><sub>2</sub>). Arrow-ended lines indicate activation, and bar-ended lines indicate inhibition.</p></caption><graphic xlink:href="EMS199652-f006"/></fig><fig id="F7" position="float"><label>Figure 7</label><caption><title>The filters fitting the parameters, online, to match the states of the P53 system (<xref ref-type="disp-formula" rid="FD13">Eq.(13)</xref> - <xref ref-type="disp-formula" rid="FD15">Eq.(15)</xref>) in which the nominal parameter value, <italic>ϕ</italic>, changes over time.</title><p>A sample every 2 hours (3 samples per period) is used, which is considered a low sampling regime here. Other simulation parameters: <inline-formula><mml:math id="M63"><mml:mrow><mml:mfrac><mml:mi>W</mml:mi><mml:mrow><mml:mtext>Δ</mml:mtext><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mn>50</mml:mn><mml:mo>,</mml:mo><mml:mn>0.0158</mml:mn></mml:mrow></mml:math></inline-formula> is the expected variance of parameters, <italic>M</italic> = 5000, 0.5 re-sampling threshold. A) Every 10 hours, the prediction trajectory, <inline-formula><mml:math id="M64"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> of each filter, is compared to the nominal model. B) The parameter fitting of <inline-formula><mml:math id="M65"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, compared to the nominal parameters, <italic>ϕ</italic>. Each parameter is normalised by the initial parameter defined in <xref ref-type="sec" rid="S13">Section 3.2</xref>.</p></caption><graphic xlink:href="EMS199652-f007"/></fig><fig id="F8" position="float"><label>Figure 8</label><caption><title>The filters fitting the parameters, online, to match the states of the P53 system (<xref ref-type="disp-formula" rid="FD13">Eq.(13)</xref> -<xref ref-type="disp-formula" rid="FD15">Eq.(15)</xref>) in which the nominal parameter value, <italic>ϕ</italic>, changes over time.</title><p>A sample every 2 hours (3 samples per period) is used, which is considered a low sampling regime here. Other simulation parameters: the control input is actuated once an hour; <italic>N</italic> = 10 hours, containing ten input steps; <inline-formula><mml:math id="M66"><mml:mrow><mml:mfrac><mml:mi>W</mml:mi><mml:mrow><mml:mtext>Δ</mml:mtext><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mn>50</mml:mn><mml:mo>;</mml:mo><mml:mn>0.0158</mml:mn></mml:mrow></mml:math></inline-formula> is the expected variance of parameters; <italic>M</italic> = 5000, 0.5 resampling threshold. A) The system’s output qualitatively follows the sine wave reference using the control input shown. B) The parameter fitting of <inline-formula><mml:math id="M67"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, compared to the nominal parameters, <italic>ϕ</italic>. Each parameter has been normalised by the initial parameter defined in <xref ref-type="sec" rid="S13">Section 3.2</xref>.</p></caption><graphic xlink:href="EMS199652-f008"/></fig><fig id="F9" position="float"><label>Figure 9</label><caption><p>A) The identification Mean Absolute Error (<italic>MAE</italic>, <xref ref-type="disp-formula" rid="FD7">Eq.(7)</xref>) of the two filters is compared over a range of sampling rates for the P53 oscillator. The simulation parameters for the kernel and particle filters are noted in <xref ref-type="fig" rid="F7">Fig. 7</xref>. B) The control Root Mean Squared Error (<italic>RMSE</italic>, <xref ref-type="disp-formula" rid="FD9">Eq.(9)</xref>) of the two filters are compared over a range of sampling rates for the P53 oscillator, with simulation parameters as in <xref ref-type="fig" rid="F8">Fig. 8</xref>. C) and D) The control <italic>RMSE</italic> of the kernel filter (C) and particle filter (D), compared over a range of sampling rates and prediction horizons, <italic>N</italic>, for the P53 oscillator. Other simulation parameters as in <xref ref-type="fig" rid="F8">Fig. 8</xref>.</p></caption><graphic xlink:href="EMS199652-f009"/></fig><fig id="F10" position="float"><label>Figure 10</label><caption><p>Toggle switch formed by a feed-back loop containing two inhibitions between the proteins, LacI and TetR. Each inhibition is inhibited by an extracellular input actively transported within the cell.</p></caption><graphic xlink:href="EMS199652-f010"/></fig><fig id="F11" position="float"><label>Figure 11</label><caption><p>The filters fitting the parameters, online, to match the states of the toggle switch system, <xref ref-type="disp-formula" rid="FD17">Eq.(17)</xref> to <xref ref-type="disp-formula" rid="FD22">Eq.(22)</xref>, to the states of the experimental data. A sample every 25 minutes is used, which is considered a low sampling regime here. Other simulation parameters: <inline-formula><mml:math id="M68"><mml:mrow><mml:mfrac><mml:mi>W</mml:mi><mml:mrow><mml:mtext>Δ</mml:mtext><mml:mi>t</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mn>50</mml:mn></mml:mrow></mml:math></inline-formula> is the expected variance of parameters, <italic>M</italic> = 5000, 0.5 re-sampling threshold. A) Every 50 minutes, the prediction trajectory, <inline-formula><mml:math id="M69"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:mn>10</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> of each filter is compared to the experimental cell average (as seen in <xref ref-type="supplementary-material" rid="SD1">Fig. S18</xref>) using Exp5. B) The parameter fitting of <inline-formula><mml:math id="M70"><mml:mover accent="true"><mml:mi>ϕ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, where each parameter has been normalised by <italic>ϕ</italic><sub>0</sub>.</p></caption><graphic xlink:href="EMS199652-f011"/></fig><fig id="F12" position="float"><label>Figure 12</label><caption><p>The identification <italic>MAE</italic>, <xref ref-type="disp-formula" rid="FD7">Eq.(7)</xref>, of the two filters is compared over a range of sampling rates for the toggle switch. The data points are the average identification <italic>MAE</italic> of 10 experiments (Exp2, Exp4, Exp5, Exp7, Exp8, Exp9, Exp10, Exp11, Exp12, Exp13, as discussed in <xref ref-type="supplementary-material" rid="SD1">Section S15</xref>) from [<xref ref-type="bibr" rid="R30">30</xref>]) at each time between samples. The simulation parameters for the kernel and particle filters are noted in <xref ref-type="fig" rid="F11">Fig. 11</xref>.</p></caption><graphic xlink:href="EMS199652-f012"/></fig></floats-group></article>