<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="epub">2692-8205</issn></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS201671</article-id><article-id pub-id-type="doi">10.1101/2024.11.29.626057</article-id><article-id pub-id-type="archive">PPR949124</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">2</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>On feature selection to disentangle cell type and state transcriptional programs</article-title></title-group><contrib-group><contrib contrib-type="author" equal-contrib="yes"><name><surname>Wang</surname><given-names>Jiayi</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author" equal-contrib="yes"><name><surname>Crowell</surname><given-names>Helena L.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref><xref ref-type="corresp" rid="CR1">†</xref></contrib><contrib contrib-type="author"><name><surname>Robinson</surname><given-names>Mark D.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref><xref ref-type="corresp" rid="CR1">†</xref></contrib></contrib-group><aff id="A1"><label>1</label>Department of Molecular Life Sciences, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/02crff812</institution-id><institution>University of Zurich</institution></institution-wrap>, <city>Zurich</city>, <country country="CH">Switzerland</country></aff><aff id="A2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/002n09z45</institution-id><institution>SIB Swiss Institute of Bioinformatics</institution></institution-wrap>, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/02crff812</institution-id><institution>University of Zurich</institution></institution-wrap>,<country country="CH">Switzerland</country></aff><author-notes><corresp id="CR1">
<label>†</label>corresponding authors: <email>helena@crowell.eu</email>, <email>mark.robinson@mls.uzh.ch</email></corresp></author-notes><pub-date pub-type="nihms-submitted"><day>05</day><month>12</month><year>2024</year></pub-date><pub-date pub-type="preprint"><day>03</day><month>12</month><year>2024</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Single-cell omics approaches profile molecular constituents of individual cells. Replicated multi-condition experiments in particular aim at studying how the molecular makeup and composition of cell subpopulations changes at the sample-level. Two main approaches have been proposed for these tasks: firstly, cluster-based methods that group cells into (non-overlapping) subpopulations based on their molecular profiles and, secondly, cluster-free but neighborhood-based methods that identify (overlapping) groups of cells in consideration of cross-condition changes. In either approach, discrete cell groups are subjected to differential testing across conditions; and, a low-dimensional cell embedding, which is in turn derived from a subset of selected features, is required to delineate subpopulations or neighborhoods.</p><p id="P2">We hypothesized that decoupling differences in cell type (i.e., between subpopulations) and cell state (i.e., between conditions) for feature selection would yield an embedding space that captures different aspects of cellular heterogeneity. And, that type-not-state embeddings would arrive at differential testing results that are more comparable between cluster- and neighborhood-based differential testing approaches. Our study leverages a simulation framework with competing type and state effects, as well as an experimental dataset, to evaluate a set of feature scoring and selection strategies, and to compare results from downstream differential analyses.</p></abstract></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P3">Single-cell RNA sequencing (scRNA-seq) and other related single-cell or multi-omics approaches now represent a robust suite of technologies for unraveling molecular phenotypes at cell-level resolution<sup>[<xref ref-type="bibr" rid="R1">1</xref>]</sup>. A now-common experimental design involves the comparison of molecular profiles from multi-subpopulation samples across conditions (e.g., across disease states, or before and after perturbation). If it is straight-forward to assign cells to (discrete) subpopulations (i.e., cell types or subtypes; see Discussion below), some fundamental discovery analyses include differential abundance analysis (DAA) to identify a change in subpopulation composition between conditions, or differential state analysis (DSA) to investigate changes in gene expression for a specific subpopulation across conditions; for the latter, pseudobulking the scRNA-seq data and leveraging classical differential expression (DE) frameworks<sup>[<xref ref-type="bibr" rid="R2">2</xref>,<xref ref-type="bibr" rid="R3">3</xref>,<xref ref-type="bibr" rid="R4">4</xref>]</sup> in a way that accounts for sample-to-sample variability has been argued to result in good performance in terms of sensitivity and error control<sup>[<xref ref-type="bibr" rid="R5">5</xref>,<xref ref-type="bibr" rid="R6">6</xref>,<xref ref-type="bibr" rid="R7">7</xref>]</sup>.</p><p id="P4">Returning to the thorny issue of assigning cells to cell types, one can think of a cell type as a relatively permanent aspect (i.e., a set of stably expressed genes), whereas the cell state represents a more transient phenotype (i.e., another set of genes expressed temporarily)<sup>[<xref ref-type="bibr" rid="R8">8</xref>,<xref ref-type="bibr" rid="R9">9</xref>]</sup>. In a recent review that proposed to separate cell types from cell states, Xia &amp; Yanai<sup>[<xref ref-type="bibr" rid="R10">10</xref>]</sup> “view a cell state as a secondary module operating in addition to the general cell type regulatory program”. This statement is in tune with standard single-cell analysis pipelines, which generate low-dimensional embeddings from a set of highly variable genes<sup>[<xref ref-type="bibr" rid="R11">11</xref>,<xref ref-type="bibr" rid="R12">12</xref>,<xref ref-type="bibr" rid="R13">13</xref>]</sup>; such embeddings are thus influenced by transcriptional programs characteristic to both cell type and cell state, although the dominant signal is usually assumed to stem from the type program<sup>[<xref ref-type="bibr" rid="R10">10</xref>]</sup>.</p><p id="P5">Discretization into cell subpopulations itself has advantages and disadvantages. On the one hand, discretization makes for relatively clear interpretation, assuming the subpopulations are decorated with markers. However, an immediate tension is the appropriate resolution of the subpopulations, which is often subjectively specified. Furthermore, DE at broad resolution could simply reflect compositional changes of cell subtypes, whereas a too finely-grained resolution could lead to limits on statistical power. A few possibilities have now emerged to address the resolution problem. Our own work, <italic>treeclimb</italic>R, proposed to over-cluster into a higher resolution and, using a tree of relationships between clusters, aggregate the differential statistics in a data-driven fashion<sup>[<xref ref-type="bibr" rid="R14">14</xref>]</sup>; challenges remain to specify what set of features to over-cluster on and how to build a tree to aggregate results from. Related work looks at DE via dimension reduction (e.g., eSVD-DE <sup>[<xref ref-type="bibr" rid="R15">15</xref>]</sup>) or the change in percentage of cells expressed<sup>[<xref ref-type="bibr" rid="R16">16</xref>]</sup>, but the starting point is still a set of clusters or annotated cell types. Meanwhile, a handful of “cluster-free” approaches have now been proposed for DSA. For example, <italic>milo</italic>DE <sup>[<xref ref-type="bibr" rid="R17">17</xref>]</sup> extends <italic>milo</italic>R’s strategy (for DAA<sup>[<xref ref-type="bibr" rid="R18">18</xref>]</sup>) to compute DE at local neighborhoods instead of clusters; neighborhoods are retained according to a minimum size to increase statistical power, while standard DE models can be used to correct for covariates. MELD <sup>[<xref ref-type="bibr" rid="R19">19</xref>]</sup> and C<italic>acoa</italic> <sup>[<xref ref-type="bibr" rid="R20">20</xref>]</sup> compute DE at the single-cell level (or rather in a neighborhood around each cell), but are unable to adjust for covariates. However, all these strategies typically use a low-dimensional embedding that mixes cell type and cell state effects. LEMUR <sup>[<xref ref-type="bibr" rid="R21">21</xref>]</sup> presents a unified approach that uses a common low-dimensional latent space from all cells and all conditions to select neighborhoods (for each gene) that exhibit DE between conditions.</p><p id="P6">In this work, we investigated feature selection as a means to separate cell type and cell state programs; this strategy mimics somewhat the case of targeted single-cell omics (e.g., flow and mass cytometry), where markers are typically selected in advance to represent cell types or states<sup>[<xref ref-type="bibr" rid="R22">22</xref>]</sup>. We hypothesized that focusing gene selection on features predominantly contributing to cell type regulatory programs would yield embeddings less affected by cell state effects; and by doing this, results from downstream DSA would be more comparable between cluster-based and cluster-free approaches.</p></sec><sec id="S2" sec-type="results"><title>Results</title><sec id="S3"><title>Simulation setup</title><p id="P7">To investigate the entanglement of type and state effects in scRNA-seq data, we first relied on synthetic data to explore feature scoring and selection strategies, data properties post processing, and downstream DSA results (<xref ref-type="fig" rid="F1">Fig. 1a</xref>). Specifically, we used S<italic>platter</italic> <sup>[<xref ref-type="bibr" rid="R23">23</xref>]</sup> to simulate data across a grid of two competing simulation parameters, <italic>t</italic> and <italic>s</italic>, that control the similarity between cells according to clusters (types) and conditions (states), respectively (simplified schematic in <xref ref-type="fig" rid="F1">Fig. 1b</xref>, full grid in <xref ref-type="supplementary-material" rid="SD1">Fig.S1</xref>). These parameters control the location parameter of log-normal distributions from which pair-wise fold-changes between clusters (<italic>t</italic>) and conditions (<italic>s</italic>) are sampled (<xref ref-type="fig" rid="F1">Fig. 1c</xref>, <xref ref-type="supplementary-material" rid="SD1">Fig.S2</xref>). Because genes are selected randomly for each effect, they may exhibit changes in type or state, or both. For every pair of parameters, data for three clusters and three replicates from two conditions were simulated; each simulation was processed in a standardized manner, i.e., removal of low-quality genes and cells, library-size normalization, highly variable feature selection, principal component analysis (PCA), low- and high-resolution clustering.</p></sec><sec id="S4"><title>Feature scoring</title><p id="P8">To quantify variation in gene expression attributable to types and states, respectively, we implemented a number of feature-wise scores (<xref ref-type="supplementary-material" rid="SD1">Table S1</xref>). These scores aim to measure either “typeness” (i.e., expression limited to one or a small number of subpopulations, and stable expression across conditions) or “stateness” (i.e., subpopulation-specific expression changes across conditions). Such scores can then be combined to select for type features and select against state features.</p><p id="P9">For type scores, we considered moderated F-statistics (tF) that score whether gene expression deviates across clusters, and the percent variance explained by cluster assignments (tPVE). For state scores, we considered the PVE by condition (sPVE) as well as DSA adjusted p-values from pseudobulks (sPBDS; e.g., Crowell <italic>et al</italic>.<sup>[<xref ref-type="bibr" rid="R5">5</xref>]</sup>). Lastly, we used a standard gene selection: highly variable genes (HVG)<sup>[<xref ref-type="bibr" rid="R24">24</xref>]</sup>. Notably, tF and PVE-based scores use high-resolution, while sPBDS is calculated on low-resolution cluster assignments. For reference, a random score was also included.</p><p id="P10">To judge how well these feature scores capture typeness and stateness, we correlated them against ground truth measures from the simulation (<xref ref-type="fig" rid="F1">Fig. 1d</xref>). Here, “true” typeness is an average of the cluster-wise fold-changes (a reflection of changes in the mean between clusters), and “true” stateness is an average of condition-specific fold-changes (a reflection of changes in the mean between conditions within clusters); see <xref ref-type="fig" rid="F1">Fig. 1c</xref> and <xref ref-type="supplementary-material" rid="SD1">Eq. S1</xref>. Correlations of true typeness with HVG and type scores (tF, tPVE) all increase with <italic>t</italic>, but are mostly invariant to changes in <italic>s</italic>. Vice versa, correlations of true stateness with state scores (sPVE, sPBDS) increased with <italic>s</italic> and are much less affected by <italic>t</italic>. However, tPVE and sPVE are not entirely robust to changes in <italic>s</italic> and <italic>t</italic>, respectively. Random scores do not correlate with either type of effect at any magnitude.</p></sec><sec id="S5"><title>Feature selection</title><p id="P11">In addition to random, HVG and tF score-based selection, we implemented three strategies to select for type-specific features that explicitly account for changes in state (<xref ref-type="supplementary-material" rid="SD1">Table S2</xref>). For example, tF-sPBDS selects features based on difference in ranks of tF and sPBDS scores, thereby prioritizing genes with high type and low state scores; tF-sPVE and tPVE-sPVE use analogous strategies. Finally, we processed simulations independently for each feature selection strategy (PCA on a fixed number of selected features, graph-based clustering, and DSA).</p></sec><sec id="S6"><title>Evaluation statistics</title><p id="P12">To evaluate feature selection, we computed metrics that assess retrieval of the simulated clusters or of type/state genes, as well as the global data structure (see <xref ref-type="supplementary-material" rid="SD1">Table S3</xref> for verbose descriptions); for example, we used: adjusted rand index (ARI) between simulated and clusters retrieved from data processing after gene selection; F1 scores of selected features according to various definitions of ground truth (e.g., DEnotDS denotes the set of genes that are DE between clusters but not across conditions; further definitions are given in <xref ref-type="supplementary-material" rid="SD1">Table S3</xref>); the local inverse Simpson index<sup>[<xref ref-type="bibr" rid="R25">25</xref>]</sup> considering <italic>g</italic>/<italic>k</italic> as variables (LISI_g, LISI_k) to quantify mixing of cells from different labels; the explained variance-weighted sum of coefficients of determination from principal component regression using <italic>g</italic>/<italic>k</italic> as predictor (PCR_g, PCR_k) to quantify the amount of variability attributable to each; and, the PVE<sup>[<xref ref-type="bibr" rid="R26">26</xref>]</sup> by <italic>g</italic>/<italic>k</italic> (PVE_g, PVE_k). Here, LISI and PCR are computed on PCs of selected features, while PVE is based on their expression values.</p><p id="P13">First, we evaluated feature selections that are based on simulated effects between types and states; specifically: DE/DS (type/state effect is present), DEgtDS/DSgtDE (on average, type/state effect exceeds state/type effect), and DEnotDS/DSnotDE (type/state effect, but <italic>no</italic> state/type effects) (<xref ref-type="supplementary-material" rid="SD1">Table S2</xref>). Overall, DEnotDS performed best across all evaluation criteria; specifically, cluster-based statistics (ARI, PCR_k, PVE_k, LISI_k) improved with the type effect (<italic>t</italic>) but are invariant to state changes (<italic>s</italic>), while condition-based statistics (PCR_g, PVE_g, LISI_g) are at an optimum for most simulations (<xref ref-type="supplementary-material" rid="SD1">Fig. S4a, Fig. S5</xref>); hence, we selected the top-<italic>n</italic> ranked features for all strategies, where <italic>n</italic> corresponds to the number of DEnotDS genes in a given simulation.</p><p id="P14">Random and HVG selections were worst overall and most sensitive to state changes (<italic>s</italic>); for example, F1 DEnotDS is ≈ 0.5 for most simulations, PVE_k decreases and PCR_g/PVE_g increase with <italic>s</italic> (<xref ref-type="fig" rid="F1">Fig. 1e</xref>, <xref ref-type="supplementary-material" rid="SD1">Fig. S4</xref>). Owing to its exclusive consideration of type effects, tF performs well in cluster-based metrics (ARI, PCR_k, PVE_k), but it shows poorer performance in group-based metrics (PCR_g, PVE_g). Methods considering both type and state effects (tF-sPBDS, tF-sPVE and tPVE-sPVE) gave results most similar to those obtained for ground truth-based selection (DEnotDS). When <italic>t</italic> is sufficiently large, these selections were able to resolve clusters based on the first couple of PCs while keeping cells from different conditions together (<xref ref-type="supplementary-material" rid="SD1">Fig. S6</xref>). In contrast, HVG selection separated cells by condition in many cases.</p></sec><sec id="S7"><title>Differential discovery</title><p id="P15">Next, we subjected data processed through various feature selections to DSA using <italic>muscat</italic> (i.e., at pseudobulk-level) and two recent cluster-free approaches, <italic>milo</italic>DE <sup>[<xref ref-type="bibr" rid="R17">17</xref>]</sup> and <italic>lemur</italic> <sup>[<xref ref-type="bibr" rid="R21">21</xref>]</sup>; notably, <italic>lemur</italic> is unaffected by gene selection and instead learns a latent space representation of cell type and state. In any DSA, each gene undergoes testing across a set of ‘instances’. For cluster-based methods, these are <italic>disjoint</italic> subpopulations; for cluster-free methods, they may <italic>overlap</italic> and correspond to groups of cells with similar state changes. Consequently, it is challenging to directly compare their results. Here, we extracted the minimum adjusted p-values (denoted p*) for each gene across clusters (<italic>muscat</italic>) or neighborhoods (<italic>lemur</italic>, <italic>miloDE</italic>); genes with p* &lt; 0.05 in any comparison were considered ‘hits’. <italic>milo</italic>DE gave more accurate results than <italic>muscat</italic>, and was largely robust to changes in simulation parameters; <italic>lemur</italic> was notably less sensitive and unable to identify DS genes when <italic>s</italic> &lt; 0.6 (short list of selections in <xref ref-type="fig" rid="F1">Fig. 1f</xref>; full list in <xref ref-type="supplementary-material" rid="SD1">Fig. S7, Fig. S8</xref>). Correlating p* between DSA methods yields reasonable concordance between <italic>muscat</italic> and <italic>milo</italic>DE, but not <italic>lemur</italic> against other methods (<xref ref-type="supplementary-material" rid="SD1">Fig. S9</xref>).</p></sec><sec id="S8"><title>Experimental data</title><p id="P16">To see how these findings manifest in a real dataset, we analyzed the scRNA-seq data from Kang <italic>et al</italic>.<sup>[<xref ref-type="bibr" rid="R27">27</xref>]</sup>, which profiles PBMCs from Lupus patients before and after a 6-hour IFN-<italic>β</italic> treatment. We selected the top 2,000 genes for each gene selection strategy and processed the data in a standard way (PCA, graph-based clustering, and DSA). Low-dimensional projections of cells using random, HVG and tF show clear separation of cells between conditions, even when they belong to the same cell type (<xref ref-type="fig" rid="F2">Fig. 2a</xref>, <xref ref-type="supplementary-material" rid="SD1">Fig. S10</xref>), thus highlighting the mix of type and state programs within the embedding. However, a type-not-state feature selection strategy (tF-sPBDS) retained primarily the cell type structure. This is a reflection of PC2 capturing cell state rather than cell type differences for random, HVG, and tF selection, but not for tF-sPBDS (see <xref ref-type="fig" rid="F2">Fig. 2b</xref>; full list in <xref ref-type="supplementary-material" rid="SD1">Fig. S11</xref>). Quantitative evaluations (based on ARI, PCR and PVE, which do not require a feature-level ground truth) showed that type-not-state gene selection better recovered the annotated cell types as clusters (ARI, LISI_g, LISI_k; see <xref ref-type="fig" rid="F2">Fig. 2c</xref>). Additionally, these selections attribute more variation to cell type than to condition (PCR g, PCR_k and PVE_g, PVE_k). Notably, many of the evaluation metrics are affected by the number of features selected (<xref ref-type="supplementary-material" rid="SD1">Fig. S12</xref>) and factors such as the number of PCs and clustering resolution will affect the number of recovered clusters and the performance of different selections.</p><p id="P17">Lacking ground truth, we compared the number and concordance of genes deemed differential by DSA methods for a given feature selection (<xref ref-type="fig" rid="F2">Fig. 2d; c.f</xref>. <xref ref-type="supplementary-material" rid="SD1">Fig. S13</xref>). tF-based selection and HVGs resulted in &lt; 500 common DEGs, whereas selections based on type-not-state scores resulted in &gt; 500 − 1000 common DEGs (i.e., DSA methods have higher concordance); random selection ranked similar to HVGs. <italic>milo</italic>DE returned the most DEGs for <italic>any</italic> selection (followed by <italic>lemur</italic>, then <italic>muscat</italic>), i.e., the methods results are most robust to the features selected for. DSA methods differed greatly in the number of tested instances. Being cluster-based, <italic>muscat</italic> was closest to the ‘true’ number of subpopulations (8); <italic>milo</italic>DE detected 10s of neighborhoods, and <italic>lemur</italic> considered a unique neighborhood for most genes (<xref ref-type="fig" rid="F2">Fig. 2e</xref>). The correspondence of these instances to cell ‘types’, however, will arguably depend on the chosen resolution (e.g., subpopulation definitions are rather broad in these data). Similar to simulated data, the DSA results of the Kang dataset followed our hypothesis that cell embeddings based primarily on type (and not state) programs lead to more concordant DSA results. This can be observed through the higher correlation between different DSA methods, especially <italic>muscat</italic> and <italic>milo</italic>DE, when using feature selections that combine type and state scores (<xref ref-type="fig" rid="F2">Fig. 2f</xref>).</p><p id="P18">Lastly, we quantified the mixing of clusters and groups across feature selections, as well as before and after Harmony<sup>[<xref ref-type="bibr" rid="R25">25</xref>]</sup> integration to correct for batch effects between samples (<xref ref-type="fig" rid="F2">Fig. 2g</xref>). While HVGs give the best separation of clusters, they also separate groups, which is suboptimal. Integration markedly improves group mixing but also increases mixing of clusters. Combining integration with type-not-state selection gives the best result overall. Thus, feature selection and integration represent complementary steps.</p></sec></sec><sec id="S9" sec-type="discussion"><title>Discussion</title><p id="P19">There is arguably an interplay between not only the type and state transcriptional programs governing cells, but also between the various types of differential analysis that are applied. While the readily-available DAA and DSA tools can in principle be considered orthogonal, they are often linked by how DE drives subpopulation definition<sup>[<xref ref-type="bibr" rid="R17">17</xref>]</sup>. As a toy example, consider a substance that strongly increases the expression of a gene <italic>γ</italic> in all treated (but not control) cells. If <italic>γ</italic> were used for clustering (or neighborhood generation), <italic>γ</italic><sup>−</sup> and <italic>γ</italic><sup>+</sup> subpopulations should be obtained for each cell type; and, DAA analysis would detect <italic>γ</italic><sup>+</sup> and <italic>γ</italic><sup>−</sup> populations as differentially abundant. In contrast, if <italic>γ</italic> were <italic>not</italic> contributing to the subpopulation definition, <italic>γ</italic><sup>+</sup> and <italic>γ</italic><sup>−</sup> cells should be present in every cluster (whose markers are expressed independently from <italic>γ</italic>), and a DSA analysis should detect <italic>γ</italic> as higher expressed in treated cells (i.e., a differential state) for each cell type.</p><p id="P20">Ultimately, both DAA and DSA could detect a defined biological effect (e.g., inflammation), regardless of how embeddings (and therefore subpopulations) are defined. However, we highlighted here that a key factor influencing interpretation, regardless of whether cluster- or neighborhood-based approaches are used, is the set of features contributing to the input embeddings. By separating type and state patterns for feature selection, we can not only simplify interpretation, but also derive results where cluster- and neighborhood-based approaches are more concordant. This separation also provides a clearer input embedding for integration and could serve as a complementary component to existing integration methods. In place of highly variable genes, we suggest to isolate variation that is indicative of cell type programs to start downstream analyses with “clean” (type-not-state) embeddings.</p><p id="P21">Of course, further experience needs to be gained across various datasets and designs to understand how to best fine tune such feature selection, especially across the spectrum of discrete to continuous cell types<sup>[<xref ref-type="bibr" rid="R28">28</xref>]</sup>. Furthermore, the effect of type-not-state feature selection on integration across datasets needs to be investigated and in particular, when mapping datasets to reference atlases spanning multiple disease states.</p><p id="P22">The type/state models we tested are highly simplified: type features are those that are highly expressed in a small number of subpopulations across samples; state features are differentially expressed across conditions within subpopulations. The conundrum here is that we need cell type definitions in order to quantify cell state variation. Thus, a concrete next step would be to investigate whether iterative selection can reveal more stable features and thus more refined embeddings and subpopulation definitions.</p><p id="P23">In summary, whether cluster- or neighborhood-based approaches are used for differential discovery in the multi-sample multi-condition multi-subpopulation single cell datasets, a key consideration for interpretable data analysis is feature selection. We propose that isolating type-not-state variation directly into cell embeddings and subpopulation definitions will be a promising approach to unravel complex but interpretable subpopulation-specific effects<sup>[<xref ref-type="bibr" rid="R29">29</xref>]</sup>.</p></sec><sec id="S10" sec-type="methods" specific-use="web-only"><title>Methods</title><sec id="S11"><title>Feature scoring</title><sec id="S12"><title>Highly variable genes (HVG)</title><p id="P24">We used <italic>model</italic>G<italic>ene</italic>V<italic>ar</italic> (<italic>scran</italic> <sup>[<xref ref-type="bibr" rid="R24">24</xref>]</sup>) to model the variance of gene expression profiles, which returns estimates for technical and biological variance components based on a fitted mean-variance trend; the latter were used as HVG scores.</p></sec><sec id="S13"><title>Cluster-based F-statistic (tF)</title><p id="P25">The F-statistic of a gene is calculated by the ratio of between-cluster variance to within-cluster variance. Rather than implementing the traditional F-statistics, we fitted a linear model (LM) using <italic>limma</italic> on sample-level pseudobulks, and empirical Bayes moderated F-statistics to summarize the gene expression variation between clusters, while accounting for sample-level effects. Here, high-resolution cluster assignments were used as input (i.e., from Louvain clustering with resolution parameter 2).</p></sec><sec id="S14"><title>Percent variance explained by type/state (tPVE/sPVE)</title><p id="P26">To estimate the fraction of variance attributable to sample, group and cluster variables, respectively, we used <italic>fit</italic>E<italic>xtract</italic>V<italic>ar</italic>P<italic>art</italic>M<italic>odel</italic> (<italic>variance</italic>P<italic>artition</italic> <sup>[<xref ref-type="bibr" rid="R26">26</xref>]</sup>) to fit a linear mixed model (LMM) according to <italic>Y</italic> ∼ (1|<italic>s</italic>) + (1|<italic>g</italic>) + (1|<italic>k</italic>), where <italic>Y</italic> denotes gene expression (log-library size normalized counts), and <italic>s/g/k</italic> denote sample/group/cluster assignments. Again, high-resolution cluster assignments were used to fit the model. The PVE by clusters and groups are used as type scores (tPVE) and state scores (sPVE), respectively.</p></sec><sec id="S15"><title>Pseudobulk-based DSA (sPBDS)</title><p id="P27">Pseudobulk-based DSA was performed as proposed in previous work of ours<sup>[<xref ref-type="bibr" rid="R5">5</xref>]</sup>. Briefly, for every (low-resolution) cluster, sample-level pseudobulks (sum of counts) were subjected to cross-group comparison using <italic>edge</italic>R <sup>[<xref ref-type="bibr" rid="R2">2</xref>]</sup> with <italic>glm</italic>QLF<italic>it</italic> and <italic>glm</italic>QLFTest <sup>[<xref ref-type="bibr" rid="R34">34</xref>]</sup>. Because genes can undergo multiple comparisons (when there are multiple clusters), we used −<italic>log</italic>(p*) as sPBDS scores, where p* denotes the smallest adjusted p-value across clusters.</p></sec><sec id="S16"><title>Feature selection</title><p id="P28">We ranked genes based on different scores and selected the top-<italic>n</italic> ranked genes for reprocessing, where <italic>n</italic> is the number of the ground truth <italic>type</italic> genes (DEnotDS; c.f. Table S2). For individual scores, such as tF, the rank is defined as the decreasing order of score values. For combined scores, such as tF-sPVE, the rank is defined by the decreasing order of the rank difference between the type and state score, i.e., <italic>rank</italic> (tF)-<italic>rank</italic> (sPVE).</p></sec></sec><sec id="S17"><title>Evaluation statistics</title><sec id="S18"><title>Adjusted rand index (ARI)</title><p id="P29">The ARI was computed between simulated (true) and reprocessed (predicted) cluster labels. Here, low values (close to 0) indicate random agreement, while high values (close to 1) indicate perfect concordance between true and predicted labels; for visualization, negative values were set to N/A.</p></sec><sec id="S19"><title>F1_DEnotDS/F1_DSnotDE</title><p id="P30">The F1 score is a classification accuracy metric, computed as the harmonic mean of precision and recall, i.e., <inline-formula><mml:math id="M1"><mml:mrow><mml:mi>T</mml:mi><mml:mi>P</mml:mi><mml:mo>/</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>T</mml:mi><mml:mi>P</mml:mi><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mo stretchy="false">(</mml:mo><mml:mi>F</mml:mi><mml:mi>P</mml:mi><mml:mo>+</mml:mo><mml:mi>F</mml:mi><mml:mi>N</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where TP, FP, and FN are the number of true positives, false positives, and false negatives, respectively. Here, F1 scores were computed between features selected by a given method, and features defined as “true” (e.g., <italic>type</italic> genes according to DEnotDS or <italic>state</italic> genes according to DSnotDE).</p></sec><sec id="S20"><title>Local inverse Simpson’s index (LISI)</title><p id="P31">The LISI <sup>[<xref ref-type="bibr" rid="R25">25</xref>]</sup> assesses the extent of mixing among clusters of cells across clusters (types) or conditions (states), denoted LISI_g and LISI_k. LISI assigns a cell-level diversity score, indicating the effective number of different cell types (LISI_k) or conditions (LISI_g) represented in the local neighborhood of each cell. For example, a well-mixed scenario is indicated by a LISI score close to 2 for a binary categorical variable, while a well-separated case is indicated by a LISI score close to 1 regardless of the number of categorical variables.</p><p id="P32">For visualization, LISI-based scores <italic>L</italic> are scaled between 0 and 1 via (<italic>L</italic> − 1)<italic>/</italic>(<italic>n</italic> − 1), where <italic>n</italic> is the number of categorical variables, i.e., the number of clusters/conditions for LISI_k/LISI_g.</p></sec><sec id="S21"><title>Percent variance explained by group/cluster (PVE_g/PVE_k)</title><p id="P33"><italic>fit</italic>E<italic>xtract</italic>V<italic>ar</italic>P<italic>art</italic>M<italic>odel</italic> (<italic>variance</italic>P<italic>artition</italic> <sup>[<xref ref-type="bibr" rid="R26">26</xref>]</sup>) was again used for evaluating the fraction of gene expression variance attributable to a gene’s cluster (type) and group (state), denoted PVE_k/PVE_g, by fitting a LMM according to <italic>Y</italic> ∼ (1|<italic>g</italic>) + (1|<italic>k</italic>), where <italic>Y</italic> denotes log-library size normalized counts, and <italic>k/g</italic> denotes cluster/group assignment. Estimates were then re-scaled such that they sum to 1 disregarding residuals.</p></sec><sec id="S22"><title>Principal component regression against groups/clusters (PCR_g/PCR_k)</title><p id="P34">We regressed each principal component <italic>PC</italic> = {<italic>pc</italic><sub>1</sub>, …, <italic>pc</italic><sub><italic>N</italic></sub> } against a cell-level variable <italic>j</italic> of interest; here, group and cluster assignments, respectively. The resulting coefficients of determination R<sup>2</sup> were then weighted by the variance in gene expression <italic>Y</italic> (log-library size normalized counts) attributable to the corresponding PC, summed across PCs, and scaled by the overall variance, i.e.: <disp-formula id="FD1"><mml:math id="M2"><mml:mrow><mml:msub><mml:mrow><mml:mtext>pcr</mml:mtext></mml:mrow><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mstyle displaystyle="true"><mml:mo>Σ</mml:mo></mml:mstyle><mml:mi>i</mml:mi></mml:msub><mml:mtext>Var</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>Y</mml:mi><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mtext>PC</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:msup><mml:mtext>R</mml:mtext><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mtext>PC</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mstyle displaystyle="true"><mml:mo>Σ</mml:mo></mml:mstyle><mml:mi>i</mml:mi></mml:msub><mml:mtext>Var</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>Y</mml:mi><mml:mo>∣</mml:mo><mml:msub><mml:mrow><mml:mtext>PC</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p></sec></sec><sec id="S23"><title>Differential state analyses</title><p id="P35"><italic>lemur</italic> <sup>[<xref ref-type="bibr" rid="R21">21</xref>]</sup> and <italic>milo</italic>DE <sup>[<xref ref-type="bibr" rid="R17">17</xref>]</sup> present neighborhood-based approaches to DSA, while <italic>muscat</italic> <sup>[<xref ref-type="bibr" rid="R5">5</xref>]</sup> relies on clustering of cells from which to derive sample-level pseudobulks that are subjected to differential testing; both types of methods rely on a prior low-dimensional embedding of cells. In order to compare these methods’ results despite their methodological differences, we passed the same set of PCs to both <italic>milo</italic>DE and <italic>muscat</italic>; these, in turn, depend on the upstream feature selection strategy. For <italic>milo</italic>DE, PCs were used as the embedding for graph construction; for <italic>muscat</italic>, pseudobulks subjected to differential testing with <italic>edgeR</italic> were based on clusters obtain from the same PCs. By contrast, the expression-level data was passed to <italic>lemur</italic> and corrected across groups via <italic>align_harmony</italic> ; latent embeddings (representing cell type and state heterogeneity) and cellular neighborhoods (potentially unique for every gene) are identified independently from previously selected features. All methods were run using default parameters.</p></sec><sec id="S24"><title>Experimental data</title><p id="P36">The Kang dataset is available through Bioconductor’s E<italic>xperiment</italic>H<italic>ub</italic> with the accession ID EH2259 and contains 35,635 genes and 29,065 cells. We removed unassigned and multiplet cells according to authors’ annotation and filtered lowly expressed genes, i.e., genes detected in fewer than 20 cells. After filtering, we obtained 4,180 genes and 12,516 cells with 5,836 and 6,680 cells before and after treatment, respectively, annotated into eight subpopulations. Next, we preprocessed the data and scored each feature using the same strategy as for simulated data (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Methods</xref>).</p></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary Information</label><media xlink:href="EMS201671-supplement-Supplementary_Information.pdf" mimetype="application" mime-subtype="pdf" id="d11aAcDfBb" position="anchor"/></supplementary-material></sec></sec></body><back><ack id="S27"><title>Acknowledgements</title><p>The authors thank members of the Robinson Lab at the University of Zurich for valuable feedback on methodology and exposition, as well as Dr. Constantin Ahlmann-Eltze, author of <italic>lemur</italic>, for support regarding its usage. This work was supported by Swiss National Science Foundation (SNSF) project grant 310030_204869 to MDR. HLC acknowledges support by SNSF grant number 222136. MDR acknowledges support from the University Research Priority Program Evolution in Action at the University of Zurich.</p></ack><sec id="S25" sec-type="data-availability"><title>Data availability</title><p id="P37">The original Kang <italic>et al</italic>.<sup>[<xref ref-type="bibr" rid="R27">27</xref>]</sup> scRNA-seq data is deposited in the Gene Expression Omnibus (accession GSE96583). A corresponding S<italic>ingle</italic>C<italic>ell</italic>E<italic>xperiment</italic> object is available in R through Bioconductor’s E<italic>xperiment</italic>H<italic>ub</italic><sup>[<xref ref-type="bibr" rid="R30">30</xref>]</sup> (identifier K<italic>ang</italic>18_8<italic>vs</italic>8).</p></sec><sec id="S26" sec-type="data-availability"><title>Code availability</title><p id="P38">All analyses were run in R v4.4.1 <sup>[<xref ref-type="bibr" rid="R31">31</xref>]</sup> with Bioconductor v3.20 <sup>[<xref ref-type="bibr" rid="R32">32</xref>]</sup>. The computational workflow was implemented using S<italic>nakemake</italic> v7.26.0 <sup>[<xref ref-type="bibr" rid="R33">33</xref>]</sup>, with Python v3.11.3. S<italic>nakemake</italic> workflow and underlying R code are accessible at <ext-link ext-link-type="uri" xlink:href="https://github.com/HelenaLC/type-state">https://github.com/HelenaLC/type-state</ext-link>, as well as Zenodo (<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.14191289">https://doi.org/10.5281/zenodo.14191289</ext-link>).</p></sec><fn-group><fn fn-type="con" id="FN1"><p id="P39"><bold>Authors’ contributions</bold></p><p id="P40">HLC conceived the study design and the computational workflow. JW and HLC implemented methods, with assistance from MDR regarding methodology. All authors contributed to drafting the paper, and have read and approved its final version.</p></fn><fn fn-type="conflict" id="FN2"><p id="P41"><bold>Competing interests</bold></p><p id="P42">The authors declare no competing interests.</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rood</surname><given-names>JE</given-names></name><name><surname>Maartens</surname><given-names>A</given-names></name><name><surname>Hupalowska</surname><given-names>A</given-names></name><name><surname>Teichmann</surname><given-names>SA</given-names></name><name><surname>Regev</surname><given-names>A</given-names></name></person-group><article-title>Impact of the Human Cell Atlas on medicine</article-title><source>Nature Medicine</source><year>2022</year><volume>28</volume><fpage>2486</fpage><lpage>2496</lpage><pub-id pub-id-type="pmid">36482102</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robinson</surname><given-names>MD</given-names></name><name><surname>McCarthy</surname><given-names>DJ</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group><article-title>edgeR: a Bioconductor package for differential expression analysis of digital gene expression data</article-title><source>Bioinformatics</source><year>2010</year><volume>26</volume><fpage>139</fpage><lpage>140</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btp616</pub-id><pub-id pub-id-type="pmcid">PMC2796818</pub-id><pub-id pub-id-type="pmid">19910308</pub-id></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Love</surname><given-names>MI</given-names></name><name><surname>Huber</surname><given-names>W</given-names></name><name><surname>Anders</surname><given-names>S</given-names></name></person-group><article-title>Moderated estimation of fold change and dispersion for RNA-seq data with DESeq2</article-title><source>Genome Biology</source><year>2014</year><volume>15</volume><fpage>550</fpage><pub-id pub-id-type="doi">10.1186/s13059-014-0550-8</pub-id><pub-id pub-id-type="pmcid">PMC4302049</pub-id><pub-id pub-id-type="pmid">25516281</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ritchie</surname><given-names>ME</given-names></name><etal/></person-group><article-title>limma powers differential expression analyses for RNA-sequencing and microarray studies</article-title><source>Nucleic Acids Research</source><year>2015</year><volume>43</volume><elocation-id>e47</elocation-id><pub-id pub-id-type="doi">10.1093/nar/gkv007</pub-id><pub-id pub-id-type="pmcid">PMC4402510</pub-id><pub-id pub-id-type="pmid">25605792</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Crowell</surname><given-names>HL</given-names></name><etal/></person-group><article-title>muscat detects subpopulation-specific state transitions from multi-sample multi-condition single-cell transcriptomics data</article-title><source>Nature Communications</source><year>2020</year><volume>11</volume><elocation-id>6077</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-020-19894-4</pub-id><pub-id pub-id-type="pmcid">PMC7705760</pub-id><pub-id pub-id-type="pmid">33257685</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Squair</surname><given-names>JW</given-names></name><etal/></person-group><article-title>Confronting false discoveries in single-cell differential expression</article-title><source>Nature Communications</source><year>2021</year><volume>12</volume><elocation-id>5692</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-021-25960-2</pub-id><pub-id pub-id-type="pmcid">PMC8479118</pub-id><pub-id pub-id-type="pmid">34584091</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zimmerman</surname><given-names>KD</given-names></name><name><surname>Espeland</surname><given-names>MA</given-names></name><name><surname>Langefeld</surname><given-names>CD</given-names></name></person-group><article-title>A practical solution to pseudoreplication bias in single-cell studies</article-title><source>Nature Communications</source><year>2021</year><volume>12</volume><fpage>738</fpage><pub-id pub-id-type="doi">10.1038/s41467-021-21038-1</pub-id><pub-id pub-id-type="pmcid">PMC7854630</pub-id><pub-id pub-id-type="pmid">33531494</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Trapnell</surname><given-names>C</given-names></name></person-group><article-title>Defining cell types and states with single-cell genomics</article-title><source>Genome Research</source><year>2015</year><volume>25</volume><fpage>1491</fpage><lpage>1498</lpage><pub-id pub-id-type="doi">10.1101/gr.190595.115</pub-id><pub-id pub-id-type="pmcid">PMC4579334</pub-id><pub-id pub-id-type="pmid">26430159</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wagner</surname><given-names>A</given-names></name><name><surname>Regev</surname><given-names>A</given-names></name><name><surname>Yosef</surname><given-names>N</given-names></name></person-group><article-title>Revealing the vectors of cellular identity with single-cell genomics</article-title><source>Nature Biotechnology</source><year>2016</year><volume>34</volume><fpage>1145</fpage><lpage>1160</lpage><pub-id pub-id-type="doi">10.1038/nbt.3711</pub-id><pub-id pub-id-type="pmcid">PMC5465644</pub-id><pub-id pub-id-type="pmid">27824854</pub-id></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xia</surname><given-names>B</given-names></name><name><surname>Yanai</surname><given-names>I</given-names></name></person-group><article-title>A periodic table of cell types</article-title><source>Development</source><year>2019</year><volume>146</volume><elocation-id>dev169854</elocation-id><pub-id pub-id-type="doi">10.1242/dev.169854</pub-id><pub-id pub-id-type="pmcid">PMC6602355</pub-id><pub-id pub-id-type="pmid">31249003</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Butler</surname><given-names>A</given-names></name><name><surname>Hoffman</surname><given-names>P</given-names></name><name><surname>Smibert</surname><given-names>P</given-names></name><name><surname>Papalexi</surname><given-names>E</given-names></name><name><surname>Satija</surname><given-names>R</given-names></name></person-group><article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title><source>Nature Biotechnology</source><year>2018</year><volume>36</volume><fpage>411</fpage><lpage>420</lpage><pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id><pub-id pub-id-type="pmcid">PMC6700744</pub-id><pub-id pub-id-type="pmid">29608179</pub-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Amezquita</surname><given-names>RA</given-names></name><etal/></person-group><article-title>Orchestrating single-cell analysis with Bioconductor</article-title><source>Nature Methods</source><year>2019</year><volume>17</volume><fpage>137</fpage><lpage>145</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0654-x</pub-id><pub-id pub-id-type="pmcid">PMC7358058</pub-id><pub-id pub-id-type="pmid">31792435</pub-id></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Luecken</surname><given-names>MD</given-names></name><name><surname>Theis</surname><given-names>FJ</given-names></name></person-group><article-title>Current best practices in single-cell RNA-seq analysis: a tutorial</article-title><source>Molecular Systems Biology</source><year>2019</year><volume>15</volume><elocation-id>e8746</elocation-id><pub-id pub-id-type="doi">10.15252/msb.20188746</pub-id><pub-id pub-id-type="pmcid">PMC6582955</pub-id><pub-id pub-id-type="pmid">31217225</pub-id></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huang</surname><given-names>R</given-names></name><etal/></person-group><article-title>treeclimbR pinpoints the data-dependent resolution of hierarchical hypotheses</article-title><source>Genome Biology</source><year>2021</year><volume>22</volume><fpage>157</fpage><pub-id pub-id-type="doi">10.1186/s13059-021-02368-1</pub-id><pub-id pub-id-type="pmcid">PMC8127214</pub-id><pub-id pub-id-type="pmid">34001188</pub-id></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lin</surname><given-names>KZ</given-names></name><name><surname>Qiu</surname><given-names>Y</given-names></name><name><surname>Roeder</surname><given-names>K</given-names></name></person-group><article-title>eSVD-DE: Cohort-wide differential expression in single-cell RNA-seq data using exponential-family embeddings</article-title><source>bioRxiv</source><year>2023</year><pub-id pub-id-type="doi">10.1186/s12859-024-05724-7</pub-id><pub-id pub-id-type="pmcid">PMC10941434</pub-id><pub-id pub-id-type="pmid">38486150</pub-id></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gilis</surname><given-names>J</given-names></name><etal/></person-group><article-title>Differential detection workflows for multi-sample single-cell RNA-seq data</article-title><source>bioRxiv</source><year>2023</year></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Missarova</surname><given-names>A</given-names></name><name><surname>Dann</surname><given-names>E</given-names></name><name><surname>Rosen</surname><given-names>L</given-names></name><name><surname>Satija</surname><given-names>R</given-names></name><name><surname>Marioni</surname><given-names>J</given-names></name></person-group><article-title>Sensitive cluster-free differential expression testing</article-title><source>bioRxiv</source><year>2023</year><elocation-id>2023.03.08.531744</elocation-id></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dann</surname><given-names>E</given-names></name><name><surname>Henderson</surname><given-names>NC</given-names></name><name><surname>Teichmann</surname><given-names>SA</given-names></name><name><surname>Morgan</surname><given-names>MD</given-names></name><name><surname>Marioni</surname><given-names>JC</given-names></name></person-group><article-title>Differential abundance testing on single-cell data using k-nearest neighbor graphs</article-title><source>Nature Biotechnology</source><year>2022</year><volume>40</volume><fpage>245</fpage><lpage>253</lpage><pub-id pub-id-type="doi">10.1038/s41587-021-01033-z</pub-id><pub-id pub-id-type="pmcid">PMC7617075</pub-id><pub-id pub-id-type="pmid">34594043</pub-id></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Burkhardt</surname><given-names>DB</given-names></name><etal/></person-group><article-title>Quantifying the effect of experimental perturbations at single-cell resolution</article-title><source>Nature Biotechnology</source><year>2021</year><volume>39</volume><fpage>619</fpage><lpage>629</lpage><pub-id pub-id-type="doi">10.1038/s41587-020-00803-5</pub-id><pub-id pub-id-type="pmcid">PMC8122059</pub-id><pub-id pub-id-type="pmid">33558698</pub-id></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Petukhov</surname><given-names>V</given-names></name><etal/></person-group><article-title>Case-control analysis of single-cell RNA-seq studies</article-title><source>bioRxiv</source><year>2022</year><elocation-id>2022.03.15.484475</elocation-id></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ahlmann-Eltze</surname><given-names>C</given-names></name><name><surname>Huber</surname><given-names>W</given-names></name></person-group><article-title>Analysis of multi-condition single-cell data with latent embedding multi-variate regression</article-title><source>Nature Genetics</source><year>2025</year><fpage>1</fpage><lpage>9</lpage><pub-id pub-id-type="doi">10.1038/s41588-024-01996-0</pub-id><pub-id pub-id-type="pmcid">PMC11906359</pub-id><pub-id pub-id-type="pmid">39753773</pub-id></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weber</surname><given-names>LM</given-names></name><name><surname>Nowicka</surname><given-names>M</given-names></name><name><surname>Soneson</surname><given-names>C</given-names></name><name><surname>Robinson</surname><given-names>MD</given-names></name></person-group><article-title>diffcyt: Differential discovery in high-dimensional cytometry via high-resolution clustering</article-title><source>Communications Biology</source><year>2019</year><volume>2</volume><fpage>183</fpage><pub-id pub-id-type="doi">10.1038/s42003-019-0415-5</pub-id><pub-id pub-id-type="pmcid">PMC6517415</pub-id><pub-id pub-id-type="pmid">31098416</pub-id></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zappia</surname><given-names>L</given-names></name><name><surname>Phipson</surname><given-names>B</given-names></name><name><surname>Oshlack</surname><given-names>A</given-names></name></person-group><article-title>Splatter: simulation of single-cell RNA sequencing data</article-title><source>Genome Biology</source><year>2017</year><volume>18</volume><fpage>174</fpage><pub-id pub-id-type="doi">10.1186/s13059-017-1305-0</pub-id><pub-id pub-id-type="pmcid">PMC5596896</pub-id><pub-id pub-id-type="pmid">28899397</pub-id></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lun</surname><given-names>ATL</given-names></name><name><surname>McCarthy</surname><given-names>DJ</given-names></name><name><surname>Marioni</surname><given-names>JC</given-names></name></person-group><article-title>A step-by-step workflow for low-level analysis of single-cell RNA-seq data with Bioconductor</article-title><source>F1000Research</source><year>2016</year><volume>5</volume><elocation-id>2122[v2]</elocation-id><pub-id pub-id-type="doi">10.12688/f1000research.9501.2</pub-id><pub-id pub-id-type="pmcid">PMC5112579</pub-id><pub-id pub-id-type="pmid">27909575</pub-id></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Korsunsky</surname><given-names>I</given-names></name><etal/></person-group><article-title>Fast, sensitive and accurate integration of single-cell data with Harmony</article-title><source>Nature Methods</source><year>2019</year><volume>16</volume><fpage>1289</fpage><lpage>1296</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0619-0</pub-id><pub-id pub-id-type="pmcid">PMC6884693</pub-id><pub-id pub-id-type="pmid">31740819</pub-id></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hoffman</surname><given-names>GE</given-names></name><name><surname>Schadt</surname><given-names>EE</given-names></name></person-group><article-title>variancePartition: interpreting drivers of variation in complex gene expression studies</article-title><source>BMC Bioinformatics</source><year>2016</year><volume>17</volume><fpage>483</fpage><pub-id pub-id-type="doi">10.1186/s12859-016-1323-z</pub-id><pub-id pub-id-type="pmcid">PMC5123296</pub-id><pub-id pub-id-type="pmid">27884101</pub-id></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kang</surname><given-names>HM</given-names></name><etal/></person-group><article-title>Multiplexed droplet single-cell RNA-sequencing using natural genetic variation</article-title><source>Nature Biotechnology</source><year>2018</year><volume>36</volume><fpage>89</fpage><lpage>94</lpage><pub-id pub-id-type="doi">10.1038/nbt.4042</pub-id><pub-id pub-id-type="pmcid">PMC5784859</pub-id><pub-id pub-id-type="pmid">29227470</pub-id></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lim</surname><given-names>HS</given-names></name><name><surname>Qiu</surname><given-names>P</given-names></name></person-group><article-title>Quantifying the clusterness and trajectoriness of single-cell RNA-seq data</article-title><source>PLoS Computational Biology</source><year>2024</year><volume>20</volume><elocation-id>e1011866</elocation-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1011866</pub-id><pub-id pub-id-type="pmcid">PMC10927072</pub-id><pub-id pub-id-type="pmid">38416795</pub-id></element-citation></ref><ref id="R29"><label>29</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>Z</given-names></name><name><surname>Wang</surname><given-names>C</given-names></name><name><surname>Huang</surname><given-names>S</given-names></name><name><surname>Shi</surname><given-names>Y</given-names></name><name><surname>Xi</surname><given-names>R</given-names></name></person-group><article-title>Directly selecting cell-type marker genes for single-cell clustering analyses</article-title><source>Cell Reports Methods</source><year>2024</year><volume>4</volume><elocation-id>100810</elocation-id><pub-id pub-id-type="doi">10.1016/j.crmeth.2024.100810</pub-id><pub-id pub-id-type="pmcid">PMC11294843</pub-id><pub-id pub-id-type="pmid">38981475</pub-id></element-citation></ref><ref id="R30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Morgan</surname><given-names>M</given-names></name><name><surname>Shepherd</surname><given-names>L</given-names></name></person-group><article-title>ExperimentHub: Client to access ExperimentHub resources</article-title><source>R package</source><year>2016</year></element-citation></ref><ref id="R31"><label>31</label><element-citation publication-type="book"><collab>R Core Team</collab><source>R: A Language and Environment for Statistical Computing</source><publisher-name>R Foundation for Statistical Computing</publisher-name><year>2019</year></element-citation></ref><ref id="R32"><label>32</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gentleman</surname><given-names>RC</given-names></name><etal/></person-group><article-title>Bioconductor: open software development for computational biology and bioinformatics</article-title><source>Genome Biology</source><year>2004</year><volume>5</volume><elocation-id>R80</elocation-id><pub-id pub-id-type="doi">10.1186/gb-2004-5-10-r80</pub-id><pub-id pub-id-type="pmcid">PMC545600</pub-id><pub-id pub-id-type="pmid">15461798</pub-id></element-citation></ref><ref id="R33"><label>33</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Köster</surname><given-names>J</given-names></name><name><surname>Rahmann</surname><given-names>S</given-names></name></person-group><article-title>Snakemake – a scalable bioinformatics workflow engine</article-title><source>Bioinformatics</source><year>2012</year><volume>28</volume><fpage>2520</fpage><lpage>2522</lpage><pub-id pub-id-type="pmid">22908215</pub-id></element-citation></ref><ref id="R34"><label>34</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lun</surname><given-names>ATL</given-names></name><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Smyth</surname><given-names>GK</given-names></name></person-group><article-title>It’s DE-licious: A Recipe for Differential Expression Analyses of RNA-seq Experiments Using Quasi-Likelihood Methods in edgeR</article-title><source>Methods in Molecular Biology</source><year>2016</year><volume>1418</volume><fpage>391</fpage><lpage>416</lpage><pub-id pub-id-type="pmid">27008025</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Fig. 1</label><caption><title>Simulation study design and results.</title><p>(<bold>a</bold>) Simulation study workflow; methods and metrics employed at each step are highlighted in bold. (<bold>b</bold>) Scatter plots of first and second principal components (PCs) for exemplary simulations with varying type and state effects, i.e., degree of inter-cluster and -group expression dissimilarity. (<bold>c</bold>) Schematic of gene categorizations in a multi-sample and -group single-cell data setting. (<bold>d</bold>) Rank correlation between gene-wise simulated fold changes (FCs) between clusters (top row) or groups (bottom row) and gene-wise feature scores (columns) calculated for the simulated data. (<bold>e</bold>) Evaluation statistics computed against the ground truth (columns) across feature selections (rows) for each simulation; whether a high or low score is desirable is indicated by the color bar avoid the label. (<bold>f</bold>) Number of genes called differential and DS-based F1 scores (adjusted p-value &lt; 0.05 in any comparison) across feature selections (rows) and DS analysis methods (columns). Each cell in a heatmap in <bold>d, e</bold> and <bold>f</bold> corresponds to a level of simulated type and state effects.</p></caption><graphic xlink:href="EMS201671-f001"/></fig><fig id="F2" position="float"><label>Fig. 2</label><caption><title>Experimental data results.</title><p>(<bold>a</bold>) UMAP embeddings of the Kang <italic>et al</italic>.<sup>[<xref ref-type="bibr" rid="R27">27</xref>]</sup> dataset based on PCs computed from different feature selections. Points (= cells) are colored by experimental condition (top) and cell type (bottom), respectively. (<bold>b</bold>) Coefficients of determination (R-squared) from fitting a linear model (LM) against principal components (PCs) with clusters (<italic>cluster</italic>_<italic>re</italic>), annotated subpopulations from Kang <italic>et al</italic>.<sup>[<xref ref-type="bibr" rid="R27">27</xref>]</sup> (<italic>cluster_id</italic>), and experimental condition (<italic>group_id</italic>) as predictor, respectively. (<bold>c</bold>) Comparison of evaluation statistics across feature selections. (<bold>d</bold>) Number of genes with an adjusted <italic>p</italic>-value &lt;sssss 0.05 in any comparison (cluster or neighborhood) called by all DSA methods (stratified by selection), and called for any feature selection method or random selection only (stratified by DSA method). (<bold>e</bold>) Number of groups identified for testing across selections and DSA methods (neighborhoods for <italic>lemur</italic> and <italic>milo</italic>DE, clusters for <italic>muscat</italic>). (<bold>f</bold>) Spearman rank correlation between smallest adjusted <italic>p</italic>-values from different pairs of DSA methods (rows), stratified by feature selections (columns). (<bold>g</bold>) Comparison of PCA-based LISI_k and LISI_g statistics across feature selections, with and without using Harmony to correct for batch effects across samples.</p></caption><graphic xlink:href="EMS201671-f002"/></fig></floats-group></article>