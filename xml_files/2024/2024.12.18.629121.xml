<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="epub">2692-8205</issn></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS202307</article-id><article-id pub-id-type="doi">10.1101/2024.12.18.629121</article-id><article-id pub-id-type="archive">PPR957839</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Flashzoi: An enhanced Borzoi model for accelerated genomic analysis</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Hingerl</surname><given-names>Johannes C.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib><contrib contrib-type="author"><name><surname>Karollus</surname><given-names>Alexander</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Gagneur</surname><given-names>Julien</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib></contrib-group><aff id="A1"><label>1</label>School of Computation, Information and Technology, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/02kkvpp62</institution-id><institution>Technical University of Munich</institution></institution-wrap>, <city>Munich</city>, <country country="DE">Germany</country></aff><aff id="A2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02nfy3535</institution-id><institution>Munich Center for Machine Learning</institution></institution-wrap>, <city>Munich</city>, <country country="DE">Germany</country></aff><aff id="A3"><label>3</label>Institute of Human Genetics, School of Medicine, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/02kkvpp62</institution-id><institution>Technical University of Munich</institution></institution-wrap>, <city>Munich</city>, <country country="DE">Germany</country></aff><aff id="A4"><label>4</label>Computational Health Center, Helmholtz Center Munich, Neuherberg, Germany</aff><author-notes><corresp id="CR1">
<label>*</label>Corresponding author</corresp></author-notes><pub-date pub-type="nihms-submitted"><day>17</day><month>01</month><year>2025</year></pub-date><pub-date pub-type="preprint"><day>21</day><month>12</month><year>2024</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Accurately predicting how DNA sequence drives gene regulation and how genetic variants alter gene expression is a central challenge in genomics. Borzoi, which models over ten thousand genomic assays including RNA-seq coverage from over half a megabase of sequence context alone promises to become an important foundation model in regulatory genomics, both for massively annotating variants and for further model development. However, its reliance on handcrafted, relative positional encodings within the transformer architecture limits its computational efficiency. Here we present Flashzoi, an enhanced Borzoi model that leverages rotary positional encodings and FlashAttention-2. This achieves over 3-fold faster training and inference and up to 2.4-fold reduced memory usage, while maintaining or improving accuracy in modeling various genomic assays including RNA-seq coverage, predicting variant effects, and enhancer-promoter linking. Flashzoi’s improved efficiency facilitates large-scale genomic analyses and opens avenues for exploring more complex regulatory mechanisms and modeling.</p></abstract></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P2">Modeling genomic readouts directly from DNA sequence is a powerful approach to investigate the genetic basis of gene regulation<sup><xref ref-type="bibr" rid="R1">1</xref>–<xref ref-type="bibr" rid="R3">3</xref></sup>. Deep learning models have shown promise in elucidating the sequence determinants underpinning a variety of genomic assays including RNA-seq, DNase-seq, and ChIP-seq<sup><xref ref-type="bibr" rid="R2">2</xref>,<xref ref-type="bibr" rid="R3">3</xref></sup>. For mouse and human genomes, the availability of large compendia of genomic assays notably from the ENCODE<sup><xref ref-type="bibr" rid="R4">4</xref></sup> consortium has enabled the training of models including Enformer<sup><xref ref-type="bibr" rid="R2">2</xref></sup> and its recent successor Borzoi<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. These models consider a sequence context of up to 500 kilobase pairs and jointly model thousands of coverage tracks of genomic assays. Since its release, Enformer has been widely used to predict effects of variants on enhancer and promoter activity, as well as on gene expression<sup><xref ref-type="bibr" rid="R5">5</xref>–<xref ref-type="bibr" rid="R8">8</xref></sup>. Moreover, Enformer and Borzoi have been employed as foundation models, i.e. as models upon which further models can be built for more specific tasks including personal gene expression<sup><xref ref-type="bibr" rid="R9">9</xref></sup> as well as single-cell gene expression and accessibility<sup><xref ref-type="bibr" rid="R10">10</xref>–<xref ref-type="bibr" rid="R12">12</xref></sup>.</p><p id="P3">Enformer and Borzoi employ convolutional layers to capture local regulatory motifs. These condense the input into shorter representations (e.g., 128 bp tokens), which are then processed by transformer layers<sup><xref ref-type="bibr" rid="R13">13</xref></sup>. Transformer layers utilize self-attention to integrate long-range interactions between regulatory elements. A critical component of transformer layers is the incorporation of positional information, allowing the model to discern the relative positions of sequence elements. Both Enformer and Borzoi use relative positional encodings<sup><xref ref-type="bibr" rid="R14">14</xref></sup>. Borzoi uses a so-called central mask positional encoding which effectively results in a step function decaying away from 0. Nonetheless, the quadratic computational complexity of self-attention, where each part of the input sequence attends to every other part, limits the scalability of these models, especially for large datasets and computationally intensive tasks such as genome-wide variant effect prediction and the analysis of distal regulatory elements. The recently introduced FlashAttention-2 algorithm offers a way to faster and more memory-efficient transformer training and inference by improving usage of the fastest memory component of the GPU (SRAM) and computing attention in a tiled fashion<sup><xref ref-type="bibr" rid="R15">15</xref></sup>. However, FlashAttention-2 is incompatible with the handcrafted relative positional encodings used by Borzoi and Enformer.</p><p id="P4">Here, we introduce Flashzoi, a model that addresses these limitations. In Flashzoi, we replaced Borzois relative positional encoding with rotary positional encodings<sup><xref ref-type="bibr" rid="R16">16</xref></sup>, to leverage FlashAttention- 2. We show that this change of the model increases training and inference speed by up to 3-fold while retaining or improving predictive performance.</p></sec><sec id="S2" sec-type="methods"><title>Methods</title><p id="P5">Flashzoi builds upon the U-net architecture of Borzoi<sup><xref ref-type="bibr" rid="R3">3</xref></sup>, a deep-learning model for predicting genomic readouts from DNA sequence. Borzoi processes 524 kilobases (kb) of DNA sequence using convolutional and max-pooling layers, resulting in 4,096 embeddings at 128 base-pair resolution, each with a dimensionality of 1,536. These embeddings are passed through 8 transformer blocks before being upsampled to 32-bp resolution using nearest-neighbor upsampling and convolutions. Separate output heads then generate predictions for human and mouse genomic assays (<xref ref-type="fig" rid="F1">Figure 1a</xref>).</p><p id="P6">The difference between Borzoi and Flashzoi lies in the transformer blocks. Each transformer block consists of a multi-head attention (MHA) module and a multi-layer perceptron (MLP). We modified the MHA module to use rotary positional encodings<sup><xref ref-type="bibr" rid="R16">16</xref></sup>, a widely used technique that allows attention between two tokens to depend on their relative distance. Our implementation uses FlashAttention-2.6.3<sup><xref ref-type="bibr" rid="R15">15</xref></sup> and requires Nvidia GPUs of the Ampere generation or newer. We set the maximal frequency (theta) to 20,000 tokens and applied rotations to the first 128 dimensions of the query and key vectors per attention head. The remaining 64 dimensions were left unrotated which empirically improved performance.</p><p id="P7">While Borzoi’s MHA module projects queries and keys to 64 dimensions and values to 192 dimensions across 8 heads, Flashzoi uses grouped query attention<sup><xref ref-type="bibr" rid="R17">17</xref></sup> (GQA) with 4 groups and 8 heads (192 dimensions each) to maintain a similar parameter count. This configuration allows one key and value head to be shared between two query heads, reducing the overall number of parameters without sacrificing model capacity. We also incorporated bias terms for the query, key, value, and output projections.</p><p id="P8">The training data for Flashzoi was downloaded from <ext-link ext-link-type="uri" xlink:href="https://storage.googleapis.com/borzoi-paper/data/and">https://storage.googleapis.com/borzoi-paper/data/and</ext-link> converted from the TFRecords format into WebDataset-compatible files for more efficient training. The human reference genome hg38 assembly was used for all analyses and training. We used gene annotations from GENCODE release v32<sup><xref ref-type="bibr" rid="R19">19</xref></sup>.</p><p id="P9">Borzoi comprises four independently trained replicates, each with a slightly different parameterization. For each Flashzoi replicate, we initialized all model parameters from the corresponding Borzoi replicate. Only the newly initialized transformer blocks and the mouse output head (absent in the original human-specific Borzoi weights) were trained. We adopted the same training-validation-test split (test fold 3, validation fold 4) as Linder et al.<sup><xref ref-type="bibr" rid="R3">3</xref></sup> (test fold 3, validation fold: 4). We used the AdamW<sup><xref ref-type="bibr" rid="R20">20</xref></sup> optimizer with a weight decay of 10<sup>-8</sup> and a learning rate of 10<sup>-4</sup>, employing a global batch size of 8 across 8 GPUs, and froze the batch norms of all convolutional blocks. The model was trained using the same Poisson-Multinomial loss function as in Linder et al.<sup><xref ref-type="bibr" rid="R3">3</xref></sup> with the same weighting factor (0.2), and batches alternating between human and mouse samples. Training was stopped when the loss plateaued on the validation set. Training Flashzoi from scratch yielded inferior performance compared to initializing from Borzoi weights, a finding requiring further investigation in the future.</p><p id="P10">Borzoi was originally trained and evaluated in float32 precision. For consistency with the original publication, we also ran predictions for Borzoi in float32. However, we had to run Flashzoi in mixed-precision as the FlashAttention-2 floating-point format, which uses tensor cores, is halfprecision (float16). Evaluations used FlashAttention 2.7.0 and PyTorch 2.5.1 (released after initial model training).</p><p id="P11">Genomic profile predictions were assessed using Pearson correlation between predicted and observed readouts on the held-out test set (fold 3). To quantify speedup, we measured the runtime of 10 forward and 10 forward-backward passes for single replicates of Flashzoi (mixed precision), Borzoi (float32), and Borzoi (mixed precision) across various batch sizes, with cuda.matmul.allow_tf32 enabled.</p><p id="P12">We evaluated the ability of Flashzoi and Borzoi to predict the effects of genetic variants on gene expression using fine-mapped GTEx eQTLs<sup><xref ref-type="bibr" rid="R22">22</xref>,<xref ref-type="bibr" rid="R23">23</xref></sup>. Only single nucleotide variants with a posterior inclusion probability greater than 0.9 were further considered. For each variant, the input sequence was centered on the TSS of the target gene (eGene) of the eQTL, and the predicted RNA-seq coverage track for the relevant tissue was obtained for both the reference and alternative alleles. Predicted variant effects were defined as the difference in logarithmic scale of the predicted gene expression of alternative and reference after removing the squashed scale<sup><xref ref-type="bibr" rid="R3">3</xref></sup>, summing across exon-overlapping bins, and adding a pseudocount of 1. The predicted variant effects were compared to observed variant effects (eQTL beta values) using Spearman correlation.</p><p id="P13">Furthermore, we assessed the performance of Flashzoi and Borzoi on eQTL prioritization using the tissue-specific datasets and matched negatives from Linder et al.<sup><xref ref-type="bibr" rid="R3">3</xref></sup> Unlike their approach, which employed a random forest for Enformer comparison, we directly matched GTEx tracks for both Flashzoi and Borzoi. For this analysis, we followed the same variant-centered scoring strategy as Linder et al, in which a variant score was defined as the Euclidean norm across the 16,352 bins of the log2-fold change between the predicted RNA-seq coverage track for the alternative versus the reference after removing the squashed scale and adding a pseudocount of 1 on each bin.</p><p id="P14">Data for the Variant Flowfish<sup><xref ref-type="bibr" rid="R8">8</xref></sup> analysis was downloaded from the supplementary material of the bioRxiv preprint. Indels were removed, and variant positions were lifted from hg19 to hg38. The effect of sequence perturbations on predicted RNA-seq coverage was recorded after removing the squashed-scale normalization for both Borzoi and Flashzoi.</p><p id="P15">To quantify the influence of distal regulatory elements on gene expression prediction, we utilized the CRISPRi benchmark dataset from Encode-E2G<sup><xref ref-type="bibr" rid="R7">7</xref></sup>, downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/EngreitzLab/CRISPR_comparison/blob/main/resources/crispr_data/EPCrisprBenchmark_ensemble_data_GRCh38.tsv.gz">https://github.com/EngreitzLab/CRISPR_comparison/blob/main/resources/crispr_data/EPCrisprBenchmark_ensemble_data_GRCh38.tsv.gz</ext-link>. This dataset provides a set of positive and negative enhancers for 1189 genes. For each enhancer-gene pair, the input sequence was centered on the transcription start site (TSS) of the linked gene. Predicted gene expression was calculated by summing the predicted readouts over all exons of the target gene. Following Gschwind et al., the gradient of the predicted gene expression with respect to the input sequence within 2 kb around the annotated enhancer midpoint was used as a proxy for enhancer importance<sup><xref ref-type="bibr" rid="R7">7</xref></sup>. Gradients were normalized by subtracting the mean nucleotide gradient. We calculated the area under the receiver operating characteristic (AUROC) for both Flashzoi and Borzoi when using the gradient score to predict positive enhancers.</p></sec><sec id="S3" sec-type="results"><title>Results</title><p id="P16">We first evaluated whether Flashzoi maintained the predictive accuracy of Borzoi. Comparisons of genomic profile predictions on held-out sequences (test fold) revealed that an ensemble of four Flashzoi models always slightly yet consistently outperformed the four-model Borzoi ensemble across all data modalities (<xref ref-type="fig" rid="F1">Figure 1b</xref>). Improvement also held when comparing a single instance of Flashzoi against a single instance of Borzoi. Most importantly, Flashzoi demonstrated up to a 3.2-fold speedup in training and inference time compared to Borzoi (<xref ref-type="fig" rid="F1">Figure 1c</xref>). Moreover, Flashzoi exhibited reduced GPU memory consumption during both forward and backward passes (up to 1.4-fold for the forward pass, and 2.4-fold for forward and backward pass), indicating that Flashzoi could be used on servers with lower GPU-memory or with increased batch size. The performance gains are not solely attributable to Flashzoi’s use of mixed precision: even compared to Borzoi running in mixed precision, Flashzoi remains up to 2-fold faster during inference and backpropagation. These results demonstrate that Flashzoi achieves substantial performance gains without sacrificing predictive accuracy, making it a more efficient and practical tool for large- scale genomic analyses.</p><p id="P17">To assess generalizability and mitigate potential train-test set sequence similarity biases, we evaluated variant effect prediction using GTEx eQTLs. Across the 48 GTEx tissues in the eQTL catalogue<sup><xref ref-type="bibr" rid="R23">23</xref></sup>, Flashzoi predictions exhibited a significantly stronger Spearman correlation with observed eQTL effects compared to Borzoi predictions (<italic>P</italic> = 0.01, <xref ref-type="fig" rid="F2">Figure 2a</xref>). We further assessed eQTL prioritization performance using distance-matched negatives from 49 GTEx tissues as previously collected by Linder et al. (2023). By ranking true eQTLs against matched negatives based on model predictions, we found the Flashzoi ensemble to be on par with the Borzoi ensemble in prioritizing eQTLs (<xref ref-type="fig" rid="F2">Figure 2b</xref>).</p><p id="P18">We also evaluated both models on two experimental datasets. Using the Variant Flowfish dataset<sup><xref ref-type="bibr" rid="R8">8</xref></sup> which reports the regulatory impact of CRISPR-engineered variants in enhancers and promoters on expression of the <italic>PFIF</italic> gene, we found that Flashzoi predictions of <italic>PFIF</italic> were consistently on par with Borzoi for enhancer and promoter (<xref ref-type="fig" rid="F2">Figure 2c</xref>). Finally, we analyzed the impact of CRISPR-inhibition of regulatory elements on gene expression using the ENCODE-E2G dataset<sup><xref ref-type="bibr" rid="R7">7</xref></sup>. Here too, Flashzoi was on par with Borzoi across all enhancer-promoter distances at distinguishing significant, experimentally confirmed enhancers from other enhancers (<xref ref-type="fig" rid="F2">Figure 2d</xref>). Altogether, these results show that Flashzoi maintains or slightly improves performance of Borzoi at much lower computational cost.</p></sec><sec id="S4" sec-type="discussion"><title>Discussion</title><p id="P19">We introduced Flashzoi, an enhanced version of the Borzoi<sup><xref ref-type="bibr" rid="R3">3</xref></sup> model for chromatin state and gene expression prediction. By leveraging rotary positional encodings and Flash Attention<sup><xref ref-type="bibr" rid="R15">15</xref></sup>, Flashzoi achieved an over 3-fold speedup and mildly improved predictive performance across various benchmarks. This substantial reduction in runtime and computational cost significantly benefits computationally intensive applications, including biobank-scale variant annotation, <italic>in silico</italic> sequence design, systematic investigation of regulatory elements, and the development of Borzoibased foundation models.</p><p id="P20">We identified Borzoi’s transformer layers, specifically their positional encodings, as a computational bottleneck amenable to acceleration with FlashAttention-2. Further aspects could have been investigated. We considered using <italic>compile,</italic> the just-in-time compilation functionality of PyTorch, for various parts of the Borzoi model, but found it did not improve runtime. A promising future direction could be the use of Flex Attention<sup><xref ref-type="bibr" rid="R24">24</xref></sup>, a recently proposed compiler-driven programming model which allows exploring alternative attention variants. However, the current FlexAttention implementation does not support the exact dimensions of Borzoi.</p><p id="P21">Overall, Flashzoi is an efficient tool for accelerating research in gene regulation and variant interpretation, contributing to a deeper understanding of the noncoding genome. Flashzoi is a modification of Borzoi<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. When using Flashzoi, we recommend citing the original Borzoi publication along with this manuscript.</p></sec></body><back><ack id="S5"><title>Acknowledgments</title><p>We thank Julia Maria Mayer for her cloud credits for downloading the Borzoi training data, and Laura Martens and Daniela Klaproth-Andrade for suggestions and feedback. We thank the authors of Borzoi for allowing us to upload PyTorch-ported Borzoi weights to the huggingface model hub. This study was funded by the European Research Council (ERC) (EPIC, Grant number: 101118521 to J.C.H. and J.G.) funded by the European Union. Views and opinions expressed are however those of the author(s) only and do not necessarily reflect those of the European Union or the European Research Council Executive Agency. Neither the European Union nor the granting authority can be held responsible for them. This study was funded by the Deutsche Forschungsgemeinschaft (DFG, German Research Foundation) via the project TRIUMPH - Tracking and Reconstructing Interactions to Understand the Missing Parts of Heritability (#535971044 to A.K.)</p></ack><fn-group><fn id="FN1"><p id="P22"><bold>Availability and implementation</bold></p><p id="P23">The Flashzoi model architecture is part of the MIT-licensed borzoi-pytorch package, can be found at <ext-link ext-link-type="uri" xlink:href="https://github.com/iohahi/borzoi-pytorchand_installed_via_pip">https://github.com/iohahi/borzoi-pytorchand_installed_via_pip</ext-link>. Model weights for all four Flashzoi and Borzoi replicates are available at <ext-link ext-link-type="uri" xlink:href="https://huggingface.co/iohahiunder_the_MIT_license">https://huggingface.co/iohahiunder_the_MIT_license</ext-link>.</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Avsec</surname><given-names>Ž</given-names></name><etal/></person-group><article-title>Base-resolution models of transcription-factor binding reveal soft motif syntax</article-title><source>Nat Genet</source><year>2021</year><volume>53</volume><fpage>354</fpage><lpage>366</lpage><pub-id pub-id-type="pmcid">PMC8812996</pub-id><pub-id pub-id-type="pmid">33603233</pub-id><pub-id pub-id-type="doi">10.1038/s41588-021-00782-6</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Avsec</surname><given-names>Ž</given-names></name><etal/></person-group><article-title>Effective gene expression prediction from sequence by integrating long-range interactions</article-title><source>Nat Methods</source><year>2021</year><volume>18</volume><fpage>1196</fpage><lpage>1203</lpage><pub-id pub-id-type="pmcid">PMC8490152</pub-id><pub-id pub-id-type="pmid">34608324</pub-id><pub-id pub-id-type="doi">10.1038/s41592-021-01252-x</pub-id></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Linder</surname><given-names>J</given-names></name><name><surname>Srivastava</surname><given-names>D</given-names></name><name><surname>Yuan</surname><given-names>H</given-names></name><name><surname>Agarwal</surname><given-names>V</given-names></name><name><surname>Kelley</surname><given-names>DR</given-names></name></person-group><article-title>Predicting RNA-seq coverage from DNA sequence as a unifying model of gene regulation</article-title><year>2023</year><elocation-id>2023.08.30.555582</elocation-id><pub-id pub-id-type="pmid">39779956</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dunham</surname><given-names>I</given-names></name><etal/></person-group><article-title>An integrated encyclopedia of DNA elements in the human genome</article-title><source>Nature</source><year>2012</year><volume>489</volume><fpage>57</fpage><lpage>74</lpage><pub-id pub-id-type="pmcid">PMC3439153</pub-id><pub-id pub-id-type="pmid">22955616</pub-id><pub-id pub-id-type="doi">10.1038/nature11247</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Karollus</surname><given-names>A</given-names></name><name><surname>Mauermeier</surname><given-names>T</given-names></name><name><surname>Gagneur</surname><given-names>J</given-names></name></person-group><article-title>Current sequence-based models capture gene expression determinants in promoters but mostly ignore distal enhancers</article-title><source>Genome Biol</source><year>2023</year><volume>24</volume><fpage>56</fpage><pub-id pub-id-type="pmcid">PMC10045630</pub-id><pub-id pub-id-type="pmid">36973806</pub-id><pub-id pub-id-type="doi">10.1186/s13059-023-02899-9</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sasse</surname><given-names>A</given-names></name><etal/></person-group><article-title>Benchmarking of deep neural networks for predicting personal gene expression from DNA sequence highlights shortcomings</article-title><source>Nat Genet</source><year>2023</year><volume>55</volume><fpage>2060</fpage><lpage>2064</lpage><pub-id pub-id-type="pmid">38036778</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gschwind</surname><given-names>AR</given-names></name><etal/></person-group><article-title>An encyclopedia of enhancer-gene regulatory interactions in the human genome</article-title><year>2023</year><elocation-id>2023.11.09.563812</elocation-id><pub-id pub-id-type="doi">10.1101/2023.11.09.563812</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Martyn</surname><given-names>GE</given-names></name><etal/></person-group><article-title>Rewriting regulatory DNA to dissect and reprogram gene expression</article-title><year>2023</year><elocation-id>2023.12.20.572268</elocation-id><pub-id pub-id-type="doi">10.1101/2023.12.20.572268</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Drusinsky</surname><given-names>S</given-names></name><name><surname>Whalen</surname><given-names>S</given-names></name><name><surname>Pollard</surname><given-names>KS</given-names></name></person-group><article-title>Deep-learning prediction of gene expression from personal genomes</article-title><year>2024</year><elocation-id>2024.07.27.605449</elocation-id><pub-id pub-id-type="doi">10.1101/2024.07.27.605449</pub-id></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schwessinger</surname><given-names>R</given-names></name><name><surname>Deasy</surname><given-names>J</given-names></name><name><surname>Woodruff</surname><given-names>RT</given-names></name><name><surname>Young</surname><given-names>S</given-names></name><name><surname>Branson</surname><given-names>KM</given-names></name></person-group><article-title>Single-cell gene expression prediction from DNA sequence at large contexts</article-title><year>2023</year><elocation-id>2023.07.26.550634</elocation-id><pub-id pub-id-type="doi">10.1101/2023.07.26.550634</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hingerl</surname><given-names>JC</given-names></name><etal/></person-group><article-title>scooby: Modeling multi-modal genomic profiles from DNA sequence at single-cell resolution</article-title><year>2024</year><elocation-id>2024.09.19.613754</elocation-id><pub-id pub-id-type="doi">10.1101/2024.09.19.613754</pub-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lal</surname><given-names>A</given-names></name><etal/></person-group><article-title>Decoding sequence determinants of gene expression in diverse cellular and disease states</article-title><year>2024</year><elocation-id>2024.10.09.617507</elocation-id><pub-id pub-id-type="doi">10.1101/2024.10.09.617507</pub-id></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vaswani</surname><given-names>A</given-names></name><etal/></person-group><article-title>Attention Is All You Need</article-title><year>2023</year><pub-id pub-id-type="doi">10.48550/arXiv.1706.03762</pub-id></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dai</surname><given-names>Z</given-names></name><etal/></person-group><article-title>Transformer-XL: Attentive Language Models Beyond a Fixed-Length Context</article-title><year>2019</year><pub-id pub-id-type="doi">10.48550/arXiv.1901.02860</pub-id></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dao</surname><given-names>T</given-names></name></person-group><article-title>FlashAttention-2: Faster Attention with Better Parallelism and Work Partitioning</article-title><year>2023</year><pub-id pub-id-type="doi">10.48550/arXiv.2307.08691</pub-id></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Su</surname><given-names>J</given-names></name><etal/></person-group><article-title>RoFormer: Enhanced transformer with Rotary Position Embedding</article-title><source>Neurocomputing</source><year>2024</year><volume>568</volume><elocation-id>127063</elocation-id></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ainslie</surname><given-names>J</given-names></name><etal/></person-group><article-title>GQA: Training Generalized Multi-Query Transformer Models from MultiHead Checkpoints</article-title><year>2023</year><pub-id pub-id-type="doi">10.48550/arXiv.2305.13245</pub-id></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="other"><collab>calico/borzoi</collab><source>Calico</source><year>2024</year></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Frankish</surname><given-names>A</given-names></name><etal/></person-group><article-title>GENCODE: reference annotation for the human and mouse genomes in 2023</article-title><source>Nucleic Acids Res</source><year>2023</year><volume>51</volume><fpage>D942</fpage><lpage>D949</lpage><pub-id pub-id-type="pmcid">PMC9825462</pub-id><pub-id pub-id-type="pmid">36420896</pub-id><pub-id pub-id-type="doi">10.1093/nar/gkac1071</pub-id></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Loshchilov</surname><given-names>I</given-names></name><name><surname>Hutter</surname><given-names>F</given-names></name></person-group><article-title>Decoupled Weight Decay Regularization</article-title><year>2019</year><pub-id pub-id-type="doi">10.48550/arXiv.1711.05101</pub-id></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Paszke</surname><given-names>A</given-names></name><etal/></person-group><article-title>PyTorch: An Imperative Style, High-Performance Deep Learning Library</article-title><year>2019</year><pub-id pub-id-type="doi">10.48550/arXiv.1912.01703</pub-id></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><article-title>The GTEx Consortium atlas of genetic regulatory effects across human tissues</article-title><source>Science</source><pub-id pub-id-type="pmcid">PMC7737656</pub-id><pub-id pub-id-type="pmid">32913098</pub-id><pub-id pub-id-type="doi">10.1126/science.aaz1776</pub-id></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kerimov</surname><given-names>N</given-names></name><etal/></person-group><article-title>A compendium of uniformly processed human gene expression and splicing quantitative trait loci</article-title><source>Nat Genet</source><year>2021</year><volume>53</volume><fpage>1290</fpage><lpage>1299</lpage><pub-id pub-id-type="pmcid">PMC8423625</pub-id><pub-id pub-id-type="pmid">34493866</pub-id><pub-id pub-id-type="doi">10.1038/s41588-021-00924-w</pub-id></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dong</surname><given-names>J</given-names></name><name><surname>Feng</surname><given-names>B</given-names></name><name><surname>Guessous</surname><given-names>D</given-names></name><name><surname>Liang</surname><given-names>Y</given-names></name><name><surname>He</surname><given-names>H</given-names></name></person-group><article-title>Flex Attention: A Programming Model for Generating Optimized Attention Kernels</article-title><year>2024</year><pub-id pub-id-type="doi">10.48550/arXiv.2412.05496</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>Flashzoi slightly improves genomic profile predictions over Borzoi at a 3-fold speedup.</title><p><bold>a,</bold> Flashzoi leverages architecture and pre-trained parameters from Borzoi, and replaces the Borzoi transformer with a FlashAttention-2 compatible one using rotary positional encodings. <bold>b,</bold> Pearson correlation between predicted and observed profiles on test sequences across genomic assays, for Borzoi and Flashzoi ensembles over four replicates. Percentages indicate proportions of tracks where Flashzoi outperforms Borzoi and vice-versa. Dashed line marks the y=x line. <bold>c,</bold> Speedup over Borzoi during forward, and forward and backward pass for a single Borzoi replicate run in mixed-precision, and Flashzoi. Dashed black lines indicate the Borzoi baseline (1.0), error bars indicate standard error (n=10).</p></caption><graphic xlink:href="EMS202307-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>Flashzoi matches or outperforms Borzoi on variant effect prediction and better leverages distal elements for predictions.</title><p><bold>a,</bold> Spearman correlation of predicted effects (log-fold change) with observed GTEx normalized eQTL effects for Flashzoi against Borzoi. Each point indicates a GTEx tissue. Dashed line marks the y=x line. <bold>b,</bold> AUROC when distinguishing fine-mapped eQTLs from distance-matched negatives per GTEx tissue of Flashzoi and Borzoi. Dashed line marks the y=x line. <bold>c,</bold> Pearson correlation of Borzoi or Flashzoi prediction with measured effect of an enhancer or a promoter disruption on <italic>PPIF</italic> gene expression<sup><xref ref-type="bibr" rid="R8">8</xref></sup>. Error bars indicate 95% confidence intervals using bootstrapping. <bold>d,</bold> AUPRCs when using the gradients of Flashzoi or Borzoi to classify regulating cis-regulatory element (CRE) loci across genomic distances to TSS in data from Gschwind et al<sup><xref ref-type="bibr" rid="R7">7</xref></sup>. Error bars indicate 95% confidence intervals using bootstrapping. Proportion of significant CRE loci against the total number of CRE loci is indicated above each bar.</p></caption><graphic xlink:href="EMS202307-f002"/></fig></floats-group></article>