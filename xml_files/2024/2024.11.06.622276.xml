<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="epub">2692-8205</issn></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS199957</article-id><article-id pub-id-type="doi">10.1101/2024.11.06.622276</article-id><article-id pub-id-type="archive">PPR936472</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Denoising Reveals Low-Occupancy Populations in Protein Crystals</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Fadini</surname><given-names>Alisia</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">*</xref><xref ref-type="fn" rid="FN1">+</xref></contrib><contrib contrib-type="author"><name><surname>Apostolopoulou</surname><given-names>Virginia</given-names></name><xref ref-type="aff" rid="A2">2</xref><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Lane</surname><given-names>Thomas J.</given-names></name><xref ref-type="aff" rid="A2">2</xref><xref ref-type="aff" rid="A3">3</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib><contrib contrib-type="author"><name><surname>van Thor</surname><given-names>Jasper J.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib></contrib-group><aff id="A1"><label>1</label>Department of Life Sciences, Faculty of Natural Sciences, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/041kmwe10</institution-id><institution>Imperial College London</institution></institution-wrap>, <city>London</city><postal-code>SW7 2AZ</postal-code>, <country country="GB">United Kingdom</country></aff><aff id="A2"><label>2</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/04fme8709</institution-id><institution>Center for Free-Electron Laser Science CFEL</institution></institution-wrap>, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/01js2sh04</institution-id><institution>Deutsches Elektronen-Synchrotron DESY</institution></institution-wrap>, <addr-line>Notkestr. 85</addr-line>, <postal-code>22607</postal-code><city>Hamburg</city>, <country country="DE">Germany</country></aff><aff id="A3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/0149pv473</institution-id><institution>The Hamburg Centre for Ultrafast Imaging</institution></institution-wrap>, <addr-line>Luruper Chaussee 149</addr-line>, <postal-code>22761</postal-code><city>Hamburg</city>, <country country="DE">Germany</country></aff><author-notes><corresp id="CR1">
<label>*</label>Correspondence</corresp><fn fn-type="present-address" id="FN1"><label>+</label><p id="P1">Current address: Cambridge Institute for Medical Research, University of Cambridge, The Keith Peters Building, Hills Road, Cambridge CB2 0XY, United Kingdom.</p></fn></author-notes><pub-date pub-type="nihms-submitted"><day>09</day><month>11</month><year>2024</year></pub-date><pub-date pub-type="preprint"><day>08</day><month>11</month><year>2024</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P2">Advances in structural biology increasingly focus on uncovering protein dynamics and transient or weak macromolecular complexes. Such studies require modeling of low-occupancy species, for instance time-evolving intermediates and bound ligands. In protein crystallography, difference maps that compare paired perturbed and reference datasets are a powerful way to identify and aid modeling of low-occupancy species. Current methods to generate difference maps, however, rely on manually tuned parameters and, in cases of weak signal due to low occupancy, can fail to extract clear, chemically interpretable signals.</p><p id="P3">We address these issues, first by showing negentropy is an effective metric to assess difference map quality and can therefore be used to automatically determine parameters needed during difference map calculation. Leveraging this, we apply total variation denoising, an image restoration technique that requires a choice of regularization parameter, to crystallographic difference maps. We show that total variation denoising improves map signal-to-noise and enables us to estimate the latent phase contribution of low-occupancy states. This technology opens new possibilities for time-resolved and ligand-screening crystallography in particular, allowing the detection of states that previously could not be resolved due to their inherently low occupancy.</p></abstract></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P4">A growing number of cutting-edge macromolecular crystallography methods aim to resolve weakly populated states rather than the primary protein conformation present in a crystal. Mechanistic time-resolved studies at XFELs<sup><xref ref-type="bibr" rid="R1">1</xref></sup> and synchrotrons<sup><xref ref-type="bibr" rid="R2">2</xref></sup>, high-throughput fragment screens<sup><xref ref-type="bibr" rid="R3">3</xref></sup>, or the study of functional protein conformational changes upon the external perturbation of a crystal (using pH, temperature<sup><xref ref-type="bibr" rid="R4">4</xref></sup>, or an external field<sup><xref ref-type="bibr" rid="R5">5</xref></sup>) are important examples. Because full conversion to a new state through a transient stimulus, like optical excitation<sup><xref ref-type="bibr" rid="R6">6</xref></sup> or substrate and ligand diffusion<sup><xref ref-type="bibr" rid="R7">7</xref>–<xref ref-type="bibr" rid="R10">10</xref></sup>, is difficult to achieve, such techniques rely on the observation of small differences between crystallographic datasets. This complication can limit their application: photoactivated systems with low quantum yields, weakly-bound ligands, and bound small molecules used for hit-to-lead drug discovery all produce signals with strengths comparable to the experimental noise and will benefit from new analysis methods that aid interpretation.</p><p id="P5">Provided that perturbation-driven structural changes are not too large (i.e. the data remain isomorphous<sup><xref ref-type="bibr" rid="R11">11</xref></sup>), the calculation of difference electron density (DED) maps can be used to reveal changes in the electron density between a new dataset, which we refer to here as the derivative dataset, and an unperturbed native dataset. DED maps are used to identify regions of structural change and to extrapolate Fourier coefficients to which new coordinates can be refined<sup><xref ref-type="bibr" rid="R12">12</xref>–<xref ref-type="bibr" rid="R14">14</xref></sup>. Any derivative structure factor <bold>F’</bold> is a superposition of the initial native structure factor (<bold>F</bold>) and the one related to the perturbed state of interest (<bold>F<sup>pr</sup></bold>), where by perturbed state we mean the pure structure of interest, i.e. ligand-bound, time-activated, <italic>etc</italic>.: <disp-formula id="FD1"><mml:math id="M1"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:msup><mml:mi>F</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mstyle><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mo>×</mml:mo><mml:msup><mml:mtext mathvariant="bold">F</mml:mtext><mml:mrow><mml:mtext mathvariant="bold">p</mml:mtext><mml:mi>r</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>f</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>×</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>F</mml:mi></mml:mstyle></mml:math></disp-formula> here <italic>f</italic> is the occupancy of the perturbed state and we indicate complex structure factors in bold. Combined with measurement noise, this partial occupancy (often below 30%) means that dataset-dependent changes can be small, making DED map features difficult to interpret. Specific communities have developed different approaches to tackle this issue: time-resolved crystallographers use weights (<italic>w</italic>) that reduce the amplitudes of difference structure factors (<italic>w</italic> x [F’<sub>obs</sub> - F<sub>obs</sub>]) if they have large experimental error and are deemed to be outliers<sup><xref ref-type="bibr" rid="R12">12</xref>,<xref ref-type="bibr" rid="R15">15</xref>,<xref ref-type="bibr" rid="R16">16</xref></sup>. The Xtrapol8 program<sup><xref ref-type="bibr" rid="R12">12</xref></sup> makes a variety of such weighting schemes available to users, together with occupancy estimation strategies. For crystallographic fragment screening, the PanDDA suite<sup><xref ref-type="bibr" rid="R17">17</xref></sup> has introduced an objective procedure to identify density associated with partially-occupied ligands. PanDDA looks for regions with statistically significant excess density as compared to reference, ligand-free datasets. While both strategies can identify weak signals in DED maps, experimental maps frequently remain dominated by noise (<xref ref-type="fig" rid="F1">Figure 1</xref>). Moreover, while amplitude weighting schemes are powerful, they require the selection of appropriate weighting parameters, and this is left to the user’s discretion. One common example is adjusting the outlier rejection term in k-weighting<sup><xref ref-type="bibr" rid="R12">12</xref></sup>. This manual intervention requires extensive trial-and-error that is based on visual inspection of maps and can introduce user bias.</p><p id="P6">Methods that further automate DED map estimation and increase the interpretability of low-occupancy density in an unbiased way are therefore desirable<sup><xref ref-type="bibr" rid="R18">18</xref>–<xref ref-type="bibr" rid="R20">20</xref></sup>; such tools will reduce user bias, provide faster feedback during time-resolved experiments or ligand screening campaigns, and allow accurate analysis of low-occupancy species where existing methods fail.</p><p id="P7">For this reason, we aim to develop methods that improve the signal-to-noise ratio in DED maps. To do so, we find it essential to establish an objective, quantitative, simple measure of map quality to compare different map generation strategies. Work in this direction is greatly aided by insights from other fields as well as open-source software that enables the development and distribution of new crystallographic analyses<sup><xref ref-type="bibr" rid="R21">21</xref>–<xref ref-type="bibr" rid="R23">23</xref></sup>.</p><p id="P8">We therefore first focus on identifying a suitable and reliable statistic that reports the level of noise present in a difference density map. We evaluate statistics that measure deviations between the distribution of map voxel values and a Gaussian distribution as indicators of DED map quality, ultimately favoring negentropy. Negentropy is routinely applied as a measure of non-Gaussianity in independent component analysis (ICA)<sup><xref ref-type="bibr" rid="R24">24</xref>–<xref ref-type="bibr" rid="R26">26</xref></sup>. We show that maximizing negentropy is an effective approach for selecting parameters in models that aim to denoise DED maps.</p><p id="P9">We use this insight to propose a new way to denoise DED maps through total variation (TV) minimization. In crystallographic DED maps, we expect <italic>a priori</italic> that the signals of interest should consist of local regions of smoothly-varying signal where atoms have moved, appeared, or disappeared. The rest of the map should be empty. When such signal is corrupted by additive white Gaussian noise, the noise contribution dominates at high spatial frequencies. TV minimization is an established technique in image processing<sup><xref ref-type="bibr" rid="R27">27</xref></sup> that aims to clarify the true signal by reducing these fluctuations. The total variation is simply defined as the sum of the changes from each voxel to all neighboring voxels. TV denoising seeks a new map that minimizes these changes while remaining as faithful as possible to the original signal<sup><xref ref-type="bibr" rid="R27">27</xref></sup>. Therefore, TV denoising, applied as a density modification technique to a DED map, will search for a new map that is similar to the given input map but attempts to set noisy, non-signal regions to be a constant, most likely zero.</p><p id="P10">We apply TV denoising<sup><xref ref-type="bibr" rid="R28">28</xref></sup> to DED maps and use negentropy maximization to select a regularization parameter that effectively trades off between fidelity to the original map and a smoother result. For three distinct case studies, we show that a single pass of TV denoising boosts the signal-to-noise ratio of DED maps and improves interpretability. We also find that an iterative application of TV denoising can be used to estimate phases for the derivative <bold>F’</bold> dataset, with corresponding further improvement in map quality.</p><p id="P11">Finally, we demonstrate how TV-denoised maps can be used to obtain extrapolated maps of the perturbed state and also refine multi-state coordinates (combined reference and perturbed state) to an <bold>F’</bold> dataset, revealing protein backbone and sidechain rearrangements in a fragment-bound COVID-19 main protease (M<sup>Pro</sup>) structure<sup><xref ref-type="bibr" rid="R29">29</xref></sup> that were not previously discernible.</p><p id="P12">We compile this analysis as an open source python package, <italic>meteor</italic>: <italic>m</italic>ap <italic>e</italic>nhancement <italic>t</italic>ools for <italic>e</italic>phemeral <italic>o</italic>ccupancy <italic>r</italic>efinement. <italic>meteor</italic> includes code to generate difference maps, select weighting parameters based on map negentropy, and apply an appropriate TV denoising protocol. Importantly, our observations on using of the use of map negentropy and TV denoising to improve difference density signals are compatible and stackable with existing methods and suites that deal with low-occupancy species in crystal datasets.</p></sec><sec id="S2" sec-type="results"><title>Results</title><sec id="S3"><title>Negentropy Reports on the Interpretability of a Difference Map</title><p id="P13">We start by considering the voxel-value distribution for a difference map. In an ideal, error-free DED map where the atoms move large distances, we expect the distribution to be bimodal in nature, with a positive and a negative mode and otherwise zero-valued voxels (<xref ref-type="fig" rid="F1">Figure 1(a)</xref>). In the more realistic case where positive and negative peaks from different motions overlay and partially cancel out, the density distribution may no longer be strictly bimodal but should remain non-Gaussian (<xref ref-type="fig" rid="F1">Figure 1(b-c)</xref>). Noise, by the central limit theorem, can be expected to be an additive Gaussian contribution to the difference map signal. Empirically, we indeed observe that the distribution of voxel values for experimental maps is notably more Gaussian than that of synthetic maps calculated with no errors, suggesting that noise contributions dominate the former (<xref ref-type="fig" rid="F1">Figure 1(d)</xref>). We therefore postulate that looking for deviations from Gaussianity in the voxel-value distribution may enable maximization of DED features that are not noise.</p><p id="P14">Skewness, kurtosis, and negentropy are well-known measures for non-Gaussianity<sup><xref ref-type="bibr" rid="R24">24</xref>,<xref ref-type="bibr" rid="R25">25</xref>,<xref ref-type="bibr" rid="R30">30</xref></sup>. To investigate the suitability of these statistics as indicators of difference map quality, we extend the 1D model from <xref ref-type="fig" rid="F1">Figure 1(a)</xref> by adding Gaussian noise to the bimodal signal (<xref ref-type="supplementary-material" rid="SD1">Supporting Note S1</xref>). We evaluate different signal-to-noise ratios and find that the negentropy decreases monotonically with the addition of noise, while kurtosis and skewness do not (<xref ref-type="supplementary-material" rid="SD1">Figure S1</xref>). On the basis of this test, we proceed with the proposal that negentropy could be a useful metric to evaluate the signal-to-noise ratio in difference density maps.</p><p id="P15"><italic>We</italic> observe, first of all, that by maximizing the negentropy we can maximization can be used to-optimize parameters in the commonly used k-weighting<sup><xref ref-type="bibr" rid="R12">12</xref>,<xref ref-type="bibr" rid="R16">16</xref></sup> amplitude modification scheme (<xref ref-type="supplementary-material" rid="SD1">Figure S2</xref>). We note, however, that, even after k-weighting, the voxel value distribution for experimental difference maps often remains markedly Gaussian (see below) and hypothesize that further denoising could yield important improvements.</p></sec><sec id="S4"><title>Total Variation Denoising Facilitates Interpretation of Weak Signals in Difference Maps</title><p id="P16">One such case where even the amplitude k-weighted DED map is extremely noisy is the 100 ps <italic>trans</italic>-to-<italic>cis</italic> photoisomerization of the Cl-rsEGFP2 protein chromophore reported in Fadini <italic>et al</italic>.<sup><xref ref-type="bibr" rid="R31">31</xref></sup> (PDB ID 8A6G) and shown in <xref ref-type="fig" rid="F1">Figure 1(d)</xref>. This dataset captures a spatially localized, light-induced change where the <italic>cis</italic> photoproduct coordinates are well-known from ground state synchrotron structures<sup><xref ref-type="bibr" rid="R32">32</xref></sup> and is therefore an excellent example for methods development. We use it here to evaluate how TV denoising can assist in the interpretation of noisy maps.</p><p id="P17">Our hypothesis is that total variation denoising should remove unwanted high-frequency noise, while preserving the signal features of difference density that vary more smoothly. A necessary step in TV denoising is to choose the degree of smoothing, dictated by a regularization parameter, λ (<xref ref-type="supplementary-material" rid="SD1">Supporting Note S2</xref>). To gain intuition into the effect of different choices of regularization parameter, we compare the original k-weighted Cl-rsEGFP2 DED map to two denoised maps, where we set λ manually based on visual interpretability of the resulting DED map (<xref ref-type="fig" rid="F2">Figure 2</xref>). TV denoising with a moderate level of regularization (λ = 0.008) produces a map with stronger signals on the protein chromophore and removes much of the noise from the original map. An overly-aggressive denoising (λ = 0.02), leads to a less interpretable, overly smooth map (<xref ref-type="fig" rid="F2">Figure 2(b)</xref>). To support this subjective assessment, we plot the power spectra of the DED maps, which show the amplitude of each spatial frequency component in the map. The power spectra show that the moderate value of λ (0.008) restores signal and recovers the expected resolution-dependent behavior of a noise-free synthetic map, while the higher λ (0.02) leads to a power spectrum that deviates from the “ground truth” spectrum computed from the synthetic example.</p><p id="P18">We conclude that TV denoising is a promising method for suppressing noise in DED maps, but would benefit from a robust, objective, and automated choice of the regularization parameter. To test whether maximizing the negentropy of DED maps as a function of λ could effectively serve this purpose, we simulate a <italic>trans</italic>-to-<italic>cis</italic> difference map that includes additive noise and track map negentropy while screening a range of λ values (<xref ref-type="supplementary-material" rid="SD1">Figure S3</xref>). We observe that the value of λ that maximizes negentropy closely matches the value that maximizes the real-space correlation coefficient between the denoised map and the noise-free synthetic map (<xref ref-type="supplementary-material" rid="SD1">Figure S3(c)</xref>). We therefore propose that the regularization parameter λ can be chosen by finding the value that generates the highest negentropy difference map (<xref ref-type="fig" rid="F2">Figure 2(c)</xref>).</p><p id="P19">While the TV denoising step modifies the Fourier amplitudes of the map, it also alters the Fourier phases (<xref ref-type="supplementary-material" rid="SD1">Figure S4</xref>). This is notable, as the phases traditionally used in DED maps are approximate: the <bold>F’</bold> phases, which have a one-to-one correspondence to the perturbed state phases and are unknown. These phases are usually approximated by the native dataset phases coming from a well-characterized reference model (<italic>ϕ<sub>c</sub></italic>)<sup><xref ref-type="bibr" rid="R11">11</xref></sup>. This assumption, however, approximately halves the signal-to-noise ratio in the corresponding map as compared to what would be obtained if the perturbed state phases were known<sup><xref ref-type="bibr" rid="R33">33</xref></sup>, an undesirable effect, particularly when the perturbed signal is weakened by partial occupancy. Our observations suggest that TV denoising, which modifies the phases, may partially correct for this approximation.</p><p id="P20">This insight points to the potential use of TV denoising for iterative phase improvement, employing a cycle similar to that used for solvent flattening in crystallography<sup><xref ref-type="bibr" rid="R34">34</xref></sup> or phase retrieval in coherent diffractive imaging<sup><xref ref-type="bibr" rid="R35">35</xref>,<xref ref-type="bibr" rid="R36">36</xref></sup>. Inspired by this prior work, we use the set of TV-denoised difference structure factors to better estimate the phases for the derivative dataset, <bold>F’</bold>, through an iterative algorithm that we name iterative-TV (it-TV) (see <xref ref-type="sec" rid="S8">Methods</xref> and <xref ref-type="fig" rid="F3">Figure 3</xref>). We again first validate the it-TV approach on a synthetic noisy map, where the noise-free, ground truth map is known (<xref ref-type="supplementary-material" rid="SD1">Supporting Note S3 and Figure S3</xref>). In <xref ref-type="fig" rid="F3">Figure 3</xref>, we show the experimental Cl-rsEGFP2 map before and after it-TV, together with the cumulative phase change and negentropy values for the difference maps generated at each iteration. Map negentropy reaches a stable positive value, having started below 10<sup>-4</sup> for the original experimental map, and the final it-TV map contains much stronger density on the protein chromophore. This first result indicates that application of TV denoising as a density modification approach could find improved phase estimates for low occupancy states in DED maps.</p></sec><sec id="S5"><title>Test Cases Demonstrate the Power of Negentropy-Guided TV Denoising to Recover Time-Resolved and Ligand-Binding Signals</title><p id="P21">To benchmark the single-pass and iterative TV denoising techniques, we select three distinct science cases: <list list-type="bullet" id="L1"><list-item><p id="P22">the 100 ps time-resolved crystallography Cl-rsEGFP2 dataset from Fadini <italic>et al</italic>.<sup><xref ref-type="bibr" rid="R31">31</xref></sup> (PDB ID 8A6G)</p></list-item><list-item><p id="P23">the example of M<sup>pro</sup> bound to tegafur (fragment SW7-401, PDB ID: 7AWR), identified as a potential binder to an allosteric site with a modeled occupancy of 0.50<sup><xref ref-type="bibr" rid="R29">29</xref></sup></p></list-item><list-item><p id="P24">the example of M<sup>pro</sup> bound to a small electrophilic fragment (U1G, PDB ID: 5RGO) with a modeled occupancy of 0.42<sup><xref ref-type="bibr" rid="R37">37</xref></sup>.</p></list-item></list></p><p id="P25">For Cl-rsEGFP2 and the M<sup>pro</sup>-tegafur complex, we compute difference maps using the sets of observed amplitudes for the available derivative and native datasets (F’<sub>obs</sub> - F<sub>obs</sub>). For the M<sup>pro</sup>-U1G complex, we illustrate the case where the difference map is computed between the observed amplitudes and the ones calculated from the model (F<sub>obs</sub> - F<sub>calc</sub>), when a reference native dataset is not available. Both M<sup>pro</sup> structures score very poorly for ligand goodness of fit to experimental data in their respective PDB depositions<sup><xref ref-type="bibr" rid="R38">38</xref></sup>, suggesting that the ligand density could benefit from further improvement.</p><p id="P26">The first two columns in <xref ref-type="fig" rid="F4">Figure 4</xref> show the effect of TV denoising on DED maps for our three test cases: (a) Cl-rsEGFP2 (b) M<sup>pro</sup>-tegafur complex (c) M<sup>pro</sup>-U1G complex. Features like the outline of the chlorophenolate ring from the Cl-rsEGFP2 <italic>cis</italic> chromophore are more easily identifiable within the protein structure and more chemically interpretable: at ±3 rms, a large negative feature is visible on the imidazolinone ring after TV denoising, and the positive density on the <italic>cis</italic> chlorophenolate ring extends to four carbons and the hydroxyl group. Relevant signals on the chromophore appear significantly stronger following TV denoising. For instance, the positive and negative peaks on the chlorine atom reach ±11 rms in the TV-denoised map, compared to ±5 rms in the original map. For the M<sup>pro</sup>-U1G complex, the denoising removes a large portion of uninterpretable density next to the ligand. In each case, visual improvements in the denoised maps are supported by increased negentropy for the voxel value distributions. In the Cl-rsEGFP2 case, the map negentropy increases from less than 10<sup>-4</sup> to 0.059 (for comparison, the Cl-rsEGFP2 noise-free synthetic map shown in <xref ref-type="fig" rid="F1">Figure 1(c)</xref> is associated with a negentropy value of 0.35). An analysis of the changes introduced by the denoising step reveals that the largest modifications involve high resolution structure factor amplitudes and phases (<xref ref-type="supplementary-material" rid="SD1">Figure S4</xref>). Finally, supporting the statement that the denoising step removes noise from the maps, the histograms and probability plots show that voxel value distributions are less Gaussian after TV denoising (<xref ref-type="supplementary-material" rid="SD1">Figure S5</xref>).</p><p id="P27">The it-TV maps for our three test cases can be found in the third column in <xref ref-type="fig" rid="F4">Figure 4</xref>. These show clear differences that can be explicitly assigned to molecular structure. They are all characterized by an increased negentropy and less Gaussian voxel-value distributions (<xref ref-type="supplementary-material" rid="SD1">Figure S7</xref>) compared to their respective originals and single-pass TV maps. Note, for example, that the Cl-rsEGFP2 it-TV map in <xref ref-type="fig" rid="F4">Figure 4</xref> shows a clear outline of the chlorophenolate ring from the <italic>cis</italic> photoproduct, even though <italic>cis</italic> phases calculated from an atomic model are never introduced. Similarly, in the M<sup>pro</sup>-tegafur complex map, an almost-complete outline of the fragment’s fluorouracil ring can be seen at 3.5 rms without ever using the fragment structure in the analysis. For the M<sup>pro</sup>-U1G F<sub>obs</sub> - F<sub>calc</sub> case, it-TV increases the strength of positive signals on the side chain atoms and ligand. Once more, the strongest modifications by the algorithm occur in higher resolution shells (<xref ref-type="supplementary-material" rid="SD1">Figure S4</xref>), effectively recovering the underlying high resolution signal from the starting map.</p></sec><sec id="S6"><title>Denoised Difference Maps Can Guide the Refinement of New Coordinates</title><p id="P28">Because DED maps do not require a model of the perturbed state, they provide unbiased and immediate information about the structural changes that occur after a perturbation, such as ligand binding or light-induced protein motion. This is invaluable to understand if the experiment has been successful and propose models that explain the results. The ultimate aim of most crystallographic experiments, however, is to interpret these changes chemically i.e. in terms of the positions of atoms and bonds. This requires an atomic model of the perturbed state, which can be refined using an extrapolated map. The extrapolated map should ideally reveal the electron density of the perturbed state without contributions from the reference state, making it easier to identify perturbation-specific structural change<sup><xref ref-type="bibr" rid="R12">12</xref>,<xref ref-type="bibr" rid="R17">17</xref>,<xref ref-type="bibr" rid="R39">39</xref></sup>.</p><p id="P29">To produce an extrapolated map, an accurate estimate of the perturbed state occupancy is essential: once an estimate for the occupancy is known, the extrapolated map can be computed by performing an appropriate addition in real space (between a reference map and a difference map) or in reciprocal space (between reference structure factors and difference structure factors)<sup><xref ref-type="bibr" rid="R40">40</xref></sup>.</p><p id="P30">During this procedure, TV-denoised maps are useful for in identifying the region of the difference signal to focus on for initial occupancy estimation (<xref ref-type="supplementary-material" rid="SD1">Figure S8</xref>). They can also improve the extrapolated map resolution: <xref ref-type="fig" rid="F5">Figure 5(a)</xref> displays the extrapolated map obtained by real-space addition between the reference M<sup>pro</sup> state (PDB ID 7AR6) map and the M<sup>pro</sup>-tegafur it-TV map (see <xref ref-type="sec" rid="S8">Methods</xref>). The map shows a clear shift of the backbone and sidechains in the ligand-binding pocket and can be used to refine new atomic coordinates for the ligand-bound state. This low-occupancy conformation was not observable in the original PanDDA event map (<xref ref-type="supplementary-material" rid="SD1">Figure S10(a)</xref>). We can refine a multi-state model of ligand bound and unbound states directly to the ligand-bound dataset. <xref ref-type="fig" rid="F5">Figure 5(b)</xref> compares the model from this refinement with the deposited structure for the ligand-bound state (PDB ID 7AWR)<sup><xref ref-type="bibr" rid="R29">29</xref></sup>. We note that refining a single model to the ligand-bound dataset results in atomic positions that are effectively an average between the two states in the multi-state model and are less representative of the underlying system.</p><p id="P31">An additional use for it-TV maps in the process of modeling perturbed-state coordinates is to suggest an initial ligand pose for refinement. We use the it-TV denoised map for the M<sup>pro</sup>-U1G complex to manually remodel the ligand binding pose (<xref ref-type="fig" rid="F4">Figure 4</xref>) and improve model fit to the data compared to both the deposited structure and a simple re-refinement of the deposited coordinates (<xref ref-type="supplementary-material" rid="SD1">Figure S11</xref>).</p></sec></sec><sec id="S7" sec-type="discussion"><title>Discussion</title><p id="P32">Exciting applications of crystallography, such as time-resolved mechanistic studies or high-throughput fragment screens<sup><xref ref-type="bibr" rid="R3">3</xref></sup>, struggle with the challenge of analyzing signal from low-occupancy species, which is at the same level as the noise in the data. Therefore, methods to measure and suppress noise in these datasets can unlock new scientific opportunities.</p><p id="P33">To this end, we find negentropy to be an effective reporter of difference map quality when seeking optimal amplitude weighting and denoising parameters. Negentropy maximization alone, however, cannot be used for map denoising without other restrictions to the procedure. Consider a putative DED map with half of the voxels randomly set to +x and half to -x. Such a map will have a very high negentropy, but no information content. Instead, negentropy, which measures how noise-like a signal is, should be thought of as a measure of the signal-to-noise ratio in a map. It can tell if the map contains signal, but not if that signal is faithful to any crystallographic or biological reality. Therefore, negentropy should only be used to evaluate competing DED maps generated by methods that can maintain fidelity to the original crystallographic data. As examples here, we show the need to choose the k parameter in k-weighting or the λ parameter in TV denoising, where negentropy maximization replaces manual selection, improving automation and reducing user bias.</p><p id="P34">We hypothesized that extending a single pass of TV denoising (single-TV) to an iterative density modification algorithm (it-TV) could improve estimates of perturbed-state phases, potentially doubling the signal-to-noise ratio in the difference structure factors set compared to the native-phase approximation used in F<sub>obs</sub>-F<sub>obs</sub> DED maps. Across all three test cases, the it-TV output maps exhibit greater chemical interpretability and higher negentropy than those produced by a single pass of TV denoising, suggesting that iterative refinement adds significant value. Our current it-TV implementation, based on the Gerchberg-Saxton iterative projection algorithm<sup><xref ref-type="bibr" rid="R41">41</xref></sup>, achieves this improvement effectively; however, it may be susceptible to local minima in the presence of experimental noise. To address this, a feedback-based algorithm, such as Feinup’s hybrid-input output or its descendants<sup><xref ref-type="bibr" rid="R35">35</xref></sup>, could potentially enhance it-TV robustness against noise-induced errors.</p><p id="P35">The largest gains from TV denoising occur for F’<sub>obs</sub>-F<sub>obs</sub> maps, which are expected to benefit the most from the replacement of the single-phase approximation in it-TV and also contain weaker signals compared to F<sub>obs</sub>-F<sub>calc</sub> maps. We therefore anticipate that our denoising methods will be the most helpful for interpreting datasets from low-yield time-resolved studies or ligands that are weakly bound. Future versions of DED map denoising could incorporate more sophisticated models for perturbed-state phases or for the errors introduced by the experimental measurement and reference-state coordinates<sup><xref ref-type="bibr" rid="R42">42</xref>,<xref ref-type="bibr" rid="R43">43</xref></sup>; an important additional point is that TV minimization-based techniques will filter high-frequency noise but will not treat scaling errors or other systematic differences between datasets, which difference maps are sensitive to. Deep learning models, such as convolutional neural networks (CNNs), have the capacity to learn more complex patterns and features from data and have been shown to perform better than traditional methods in image restoration and denoising tasks<sup><xref ref-type="bibr" rid="R44">44</xref>–<xref ref-type="bibr" rid="R46">46</xref></sup>, making them potential candidates for future map denoising algorithms. Another advantage of such models is that, once trained, they do not rely on iteration and can therefore quickly process inputs. Nonetheless, it is important to note that the TV denoising tools we present here are fast, computationally cheap, and can be run from most workstations without the need to train an additional set of parameters.</p><p id="P36">The field of macromolecular crystallography is moving towards novel and technically ambitious data collection strategies: cutting-edge experiments are now aimed at capturing transient reaction intermediates, leveraging high-throughput facilities for small molecule screens, and studying the conformational variability that underlies protein dynamics. Analysis methods need to match these advances with increased sensitivity, robustness to noise, and improved automation. The negentropy metric and total variation denoising techniques reduce human bias and noise in the generation of difference density maps, as well as enhance signal by proposing new phase estimates for low-occupancy species. We show that our analysis particularly improves data interpretation in cases that struggle with weaker signals. For these reasons we believe such treatment of difference maps could unlock the study of minorly-populated states that are currently discarded in fragment screens or not attempted in time-resolved studies. The use of negentropy as a way of systematically scoring difference maps should also be useful for quick decision-making during online experiments and for processing large crystallographic datasets from high-throughput beamlines.</p></sec><sec id="S8" sec-type="methods"><title>Methods</title><sec id="S9"><title>Total Variation Denoising</title><p id="P37">To conduct TV denoising on a difference map, we employ Chambolle’s algorithm<sup><xref ref-type="bibr" rid="R28">28</xref></sup> implemented in scikit-image<sup><xref ref-type="bibr" rid="R47">47</xref></sup>. TV denoising is performed in real-space on difference map arrays. To fit the λ parameter, map negentropy is minimized using golden section search<sup><xref ref-type="bibr" rid="R48">48</xref>,<xref ref-type="bibr" rid="R49">49</xref></sup>. For the skimage.restoration.denoise_tv_chambolle function, the tolerance for the stop criterions is set to 5x10<sup>-8</sup> and the maximum number of iterations to 50.</p></sec><sec id="S10"><title>Iterative Total Variation Denoising Algorithm</title><p id="P38">Native (F<sub>obs</sub>) and derivative (F’<sub>obs</sub>) state amplitudes are provided as input, together with a reference model. A difference map is computed using the phases calculated from the reference model and the difference structure factor amplitudes (F’<sub>obs</sub> - F<sub>obs</sub>). This starting difference map is denoised using Chambolle’s TV algorithm as described above after a small λ value optimization. The TV denoised map is then inverse Fourier-transformed to obtain complex difference structure factors. These Fourier differences are projected onto the set of input amplitudes and phases to obtain an updated estimate of the latent perturbed state (<xref ref-type="supplementary-material" rid="SD1">Figure S6</xref>). These in turn are Fourier transformed back to real space for TV denoising, and the procedure is iterated until the average phase change no longer increases by more than 10<sup>-3</sup>. The default in <italic>meteor</italic> is then to k-weight and TV denoise the it-TV map to produce a final output.</p></sec><sec id="S11"><title>Perturbed State Extrapolation</title><p id="P39">To demonstrate how TV-denoised maps can be used in the process of extrapolating perturbed-state density, we generate two different types of extrapolated maps (<xref ref-type="fig" rid="F5">Figure 5</xref> and <xref ref-type="supplementary-material" rid="SD1">Figures S8-S10</xref>), described below. First, to estimate a perturbed state occupancy, we re-implement the background subtraction strategy used by PanDDA<sup><xref ref-type="bibr" rid="R17">17</xref></sup>. This procedure involves identifying a local region of change caused by the perturbation and finding an occupancy value that can produce a map that maximally differs from its reference in such localized region but is similar to the reference elsewhere.</p><p id="P40">Extrapolation for perturbed state structure factors (<bold>F<sup>pr</sup></bold>) or density (ρ<sup>pr</sup>) can be carried out in real or reciprocal space.</p><p id="P41"><disp-formula id="FD2"><mml:math id="M2"><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>Reciprocal:</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:msup><mml:mtext mathvariant="bold">F</mml:mtext><mml:mrow><mml:mtext mathvariant="bold">pr</mml:mtext></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msub><mml:mtext>F</mml:mtext><mml:mrow><mml:mtext>obs</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msup><mml:mo>α</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi>w</mml:mi><mml:mo>Δ</mml:mo><mml:mtext>F</mml:mtext><mml:mo>×</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mtext>i</mml:mtext><mml:mo>ϕ</mml:mo><mml:mtext>c</mml:mtext></mml:mrow></mml:msup></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>Real:</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:msup><mml:mo>ρ</mml:mo><mml:mrow><mml:mtext>pr</mml:mtext></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mo>ρ</mml:mo><mml:mrow><mml:mtext>ref</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mo>α</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>Δ</mml:mo><mml:mo>ρ</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> where ΔF = F’<sub>obs</sub> - F<sub>obs</sub>, <italic>w</italic> represents error-based amplitude weights, <italic>φ<sub>c</sub></italic> are the calculated phases from the reference model, and α is related to the true perturbed state occupancy (<italic>f</italic>) by <italic>f</italic> = 2α when the constant phase approximation is used. To estimate α (with final choice written <inline-formula><mml:math id="M3"><mml:mover accent="true"><mml:mi>α</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>), the strategy from PanDDA<sup><xref ref-type="bibr" rid="R17">17</xref></sup> finds the value that maximizes the difference in Pearson correlation coefficient (calculated from the reference state and the extrapolated map) between the entire protein and a specific local region of change. We showcase this for our photoisomerization example in <xref ref-type="supplementary-material" rid="SD1">Figure S8(a)</xref>, where the local region is set as a sphere of 5 Å centered around the chromophore double bond. The entire protein is defined as a global region after a solvent mask is applied. For a range of values of 0 &lt; α &lt; 1, the Pearson correlation coefficient between the respective <bold>F<sup>pr</sup></bold>/ρ<sup>pr</sup> map and the map obtained from the reference model is computed. The value that maximizes the difference between these two correlation coefficients is chosen as <inline-formula><mml:math id="M4"><mml:mover accent="true"><mml:mi>α</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> and the corresponding map is saved (<xref ref-type="supplementary-material" rid="SD1">Figure S8(b)</xref>).</p><p id="P42">For the M<sup>pro</sup>-tegafur complex, we use the higher-negentropy it-TV map as Δρ for real space extrapolation and show the extrapolated result in <xref ref-type="fig" rid="F5">Figure 5</xref>. We also carry out a reciprocal space extrapolation, which does not use new phases from either single-TV or it-TV but is guided by the denoised maps in the choice of local region. The corresponding map is shown in <xref ref-type="supplementary-material" rid="SD1">Figure S10(b)</xref>. <xref ref-type="supplementary-material" rid="SD1">Figure S9</xref> contains the analysis to estimate <inline-formula><mml:math id="M5"><mml:mover accent="true"><mml:mo>α</mml:mo><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> for these two extrapolation types.</p></sec><sec id="S12"><title>Multi-State Model Refinement</title><p id="P43">As outlined by Pearce <italic>et al</italic>.<sup><xref ref-type="bibr" rid="R50">50</xref></sup>, we combine the models through the use of alternate conformers, we constrain the occupancy of the atoms within each state to be fixed, and we set the sum of the occupancies between states to be equal to 1. As a starting occupancy for the ligand-bound state we choose the value that minimizes R-free (<xref ref-type="fig" rid="F5">Figure 5(b)</xref>), and proceed to refine B-factors and coordinates with phenix.refine<sup><xref ref-type="bibr" rid="R51">51</xref></sup>. For the R-factors reported in the table in <xref ref-type="fig" rid="F5">Figure 5(b)</xref>, the anisotropic B-factors are removed from the originally deposited models (PDB ID 7AR6/7AWR) and the B-factors are re-refined with phenix.refine. This ensures a consistent procedure to compare the metrics obtained with the multi-state model refinement.</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supporting Information</label><media xlink:href="EMS199957-supplement-Supporting_Information.pdf" mimetype="application" mime-subtype="pdf" id="d131aAcEbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S13"><title>Acknowledgements</title><p>AF and JJvT acknowledge funding from the Imperial College President’s PhD Scholarship and the Biotechnology and Biological Sciences Research Council (BBSRC) (BB/P00752X/1). TJL acknowledges the support of the Helmholtz Association through a YIG award. VA and TJL were supported by the Cluster of Excellence “Advanced Imaging of Matter,” Deutsche Forschungsgemeinschaft (DFG), EXC 2056, project ID 390715994. We acknowledge Nick Pearce for discussion on the background subtraction estimation. We would also like to deeply thank Kevin Dalton for scientific exchange and for his help integrating <italic>meteor</italic> into the <italic>Reciprocal Space Station</italic> platform.</p></ack><sec id="S14" sec-type="data-availability"><title>Code Availability</title><p id="P44">Negentropy-driven k-weighting, single pass TV denoising, and the it-TV algorithm are implemented as executables in the <italic>meteor</italic> package, requiring initial MTZ files and a reference model as input. <italic>meteor</italic> is written in python and depends on the GEMMI<sup><xref ref-type="bibr" rid="R22">22</xref></sup>, reciprocalspaceship<sup><xref ref-type="bibr" rid="R23">23</xref></sup>, numpy<sup><xref ref-type="bibr" rid="R52">52</xref></sup>, scikit-learn<sup><xref ref-type="bibr" rid="R53">53</xref></sup>, and panda<sup><xref ref-type="bibr" rid="R54">54</xref></sup> packages. The code is available at: <ext-link ext-link-type="uri" xlink:href="https://github.com/rs-station/meteor">https://github.com/rs-station/meteor</ext-link>.</p></sec><fn-group><fn id="FN2" fn-type="con"><p id="P45"><bold>Author Contributions</bold></p><p id="P46">Conceptualization: AF, TJL; Methodology: AF, TJL; Investigation: AF, TJL, VA; Visualization: AF, TJL, VA, JJvT; Funding acquisition: JJvT; Writing: AF, TJL, VA, JJvT.</p></fn><fn id="FN3" fn-type="conflict"><p id="P47"><bold>Competing Interests</bold></p><p id="P48">TJL is a shareholder of CHARM Therapeutics.</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Orville</surname><given-names>AM</given-names></name></person-group><article-title>Recent results in time resolved serial femtosecond crystallography at XFELs</article-title><source>Curr Opin Struct Biol</source><year>2020</year><volume>65</volume><fpage>193</fpage><lpage>208</lpage><pub-id pub-id-type="pmid">33049498</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pearson</surname><given-names>AR</given-names></name><name><surname>Mehrabi</surname><given-names>P</given-names></name></person-group><article-title>Serial synchrotron crystallography for time-resolved structural biology</article-title><source>Curr Opin Struct Biol</source><year>2020</year><volume>65</volume><fpage>168</fpage><lpage>174</lpage><pub-id pub-id-type="pmid">32846363</pub-id></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Budziszewski</surname><given-names>GR</given-names></name><name><surname>Snell</surname><given-names>ME</given-names></name><name><surname>Wright</surname><given-names>TR</given-names></name><name><surname>Lynch</surname><given-names>ML</given-names></name><name><surname>Bowman</surname><given-names>SEJ</given-names></name></person-group><article-title>High-Throughput Screening to Obtain Crystal Hits for Protein Crystallography</article-title><source>J Vis Exp</source><year>2023</year><elocation-id>e65211</elocation-id><pub-id pub-id-type="pmcid">PMC10259656</pub-id><pub-id pub-id-type="pmid">36971435</pub-id><pub-id pub-id-type="doi">10.3791/65211</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Keedy</surname><given-names>DA</given-names></name><etal/></person-group><article-title>Mapping the conformational landscape of a dynamic enzyme by multitemperature and XFEL crystallography</article-title><source>Elife</source><year>2015</year><volume>4</volume><pub-id pub-id-type="pmcid">PMC4721965</pub-id><pub-id pub-id-type="pmid">26422513</pub-id><pub-id pub-id-type="doi">10.7554/eLife.07574</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hekstra</surname><given-names>DR</given-names></name><etal/></person-group><article-title>Electric-field-stimulated protein mechanics</article-title><source>Nature</source><year>2016</year><volume>540</volume><fpage>400</fpage><lpage>405</lpage><pub-id pub-id-type="pmcid">PMC5730412</pub-id><pub-id pub-id-type="pmid">27926732</pub-id><pub-id pub-id-type="doi">10.1038/nature20571</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moffat</surname><given-names>K</given-names></name></person-group><article-title>Time-resolved crystallography and protein design: signalling photoreceptors and optogenetics</article-title><source>Philos Trans R Soc B Biol Sci</source><year>2014</year><volume>369</volume><elocation-id>20130568</elocation-id><pub-id pub-id-type="pmcid">PMC4052877</pub-id><pub-id pub-id-type="pmid">24914168</pub-id><pub-id pub-id-type="doi">10.1098/rstb.2013.0568</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Käck</surname><given-names>H</given-names></name><name><surname>Gibson</surname><given-names>KJ</given-names></name><name><surname>Lindqvist</surname><given-names>Y</given-names></name><name><surname>Schneider</surname><given-names>G</given-names></name></person-group><article-title>Snapshot of a phosphorylated substrate intermediate by kinetic crystallography</article-title><source>Proc Natl Acad Sci</source><year>1998</year><volume>95</volume><fpage>5495</fpage><lpage>5500</lpage><pub-id pub-id-type="pmcid">PMC20405</pub-id><pub-id pub-id-type="pmid">9576910</pub-id><pub-id pub-id-type="doi">10.1073/pnas.95.10.5495</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Calvey</surname><given-names>GD</given-names></name><name><surname>Katz</surname><given-names>AM</given-names></name><name><surname>Schaffer</surname><given-names>CB</given-names></name><name><surname>Pollack</surname><given-names>L</given-names></name></person-group><article-title>Mixing injector enables time-resolved crystallography with high hit rate at X-ray free electron lasers</article-title><source>Struct Dyn</source><year>2016</year><volume>3</volume><elocation-id>054301</elocation-id><pub-id pub-id-type="pmcid">PMC5010557</pub-id><pub-id pub-id-type="pmid">27679802</pub-id><pub-id pub-id-type="doi">10.1063/1.4961971</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schmidt</surname><given-names>M</given-names></name></person-group><article-title>Reaction Initiation in Enzyme Crystals by Diffusion of Substrate</article-title><source>Crystals</source><year>2020</year><volume>10</volume><fpage>116</fpage></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Olmos</surname><given-names>JL</given-names></name><etal/></person-group><article-title>Enzyme intermediates captured ‘on the fly ’by mix-and-inject serial crystallography</article-title><source>BMC Biol</source><year>2018</year><volume>16</volume><fpage>59</fpage><pub-id pub-id-type="pmcid">PMC5977757</pub-id><pub-id pub-id-type="pmid">29848358</pub-id><pub-id pub-id-type="doi">10.1186/s12915-018-0524-5</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rould</surname><given-names>MA</given-names></name><name><surname>Carter</surname><given-names>CW</given-names></name></person-group><article-title>Isomorphous Difference Methods</article-title><source>Methods Enzymol</source><year>2003</year><volume>374</volume><fpage>145</fpage><lpage>163</lpage><pub-id pub-id-type="pmid">14696372</pub-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>De Zitter</surname><given-names>E</given-names></name><name><surname>Coquelle</surname><given-names>N</given-names></name><name><surname>Oeser</surname><given-names>P</given-names></name><name><surname>Barends</surname><given-names>TRM</given-names></name><name><surname>Colletier</surname><given-names>J-P</given-names></name></person-group><article-title>Xtrapol8 enables automatic elucidation of low-occupancy intermediate-states in crystallographic studies</article-title><source>Commun Biol</source><year>2022</year><volume>5</volume><fpage>640</fpage><pub-id pub-id-type="pmcid">PMC9243118</pub-id><pub-id pub-id-type="pmid">35768542</pub-id><pub-id pub-id-type="doi">10.1038/s42003-022-03575-7</pub-id></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pandey</surname><given-names>S</given-names></name><etal/></person-group><article-title>Time-resolved serial femtosecond crystallography at the European XFEL</article-title><source>Nat Methods</source><year>2020</year><volume>17</volume><fpage>73</fpage><lpage>78</lpage><pub-id pub-id-type="pmcid">PMC9113060</pub-id><pub-id pub-id-type="pmid">31740816</pub-id><pub-id pub-id-type="doi">10.1038/s41592-019-0628-z</pub-id></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pande</surname><given-names>K</given-names></name><etal/></person-group><article-title>Femtosecond structural dynamics drives the trans/cis isomerization in photoactive yellow protein</article-title><source>Science (80-)</source><year>2016</year><volume>352</volume><fpage>725</fpage><lpage>729</lpage><pub-id pub-id-type="pmcid">PMC5291079</pub-id><pub-id pub-id-type="pmid">27151871</pub-id><pub-id pub-id-type="doi">10.1126/science.aad5081</pub-id></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ursby</surname><given-names>T</given-names></name><name><surname>Bourgeois</surname><given-names>D</given-names></name></person-group><article-title>Improved Estimation of Structure-Factor Difference Amplitudesfrom Poorly Accurate Data</article-title><source>Acta Crystallogr Sect A Found Crystallogr</source><year>1997</year><volume>53</volume><fpage>564</fpage><lpage>575</lpage></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ren</surname><given-names>Z</given-names></name><etal/></person-group><article-title>A Molecular Movie at 1.8 Å Resolution Displays the Photocycle of Photoactive Yellow Protein, a Eubacterial Blue-Light Receptor, from Nanoseconds to Seconds †</article-title><source>Biochemistry</source><year>2001</year><volume>40</volume><fpage>13788</fpage><lpage>13801</lpage><pub-id pub-id-type="pmid">11705368</pub-id></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pearce</surname><given-names>NM</given-names></name><etal/></person-group><article-title>A multi-crystal method for extracting obscured crystallographic states from conventionally uninterpretable electron density</article-title><source>Nat Commun</source><year>2017</year><volume>8</volume><elocation-id>15123</elocation-id><pub-id pub-id-type="pmcid">PMC5413968</pub-id><pub-id pub-id-type="pmid">28436492</pub-id><pub-id pub-id-type="doi">10.1038/ncomms15123</pub-id></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carolan</surname><given-names>CG</given-names></name><name><surname>Lamzin</surname><given-names>VS</given-names></name></person-group><article-title>Automated identification of crystallographic ligands using sparse-density representations</article-title><source>Acta Crystallogr Sect D Biol Crystallogr</source><year>2014</year><volume>70</volume><fpage>1844</fpage><lpage>1853</lpage><pub-id pub-id-type="pmcid">PMC4089483</pub-id><pub-id pub-id-type="pmid">25004962</pub-id><pub-id pub-id-type="doi">10.1107/S1399004714008578</pub-id></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smart</surname><given-names>OS</given-names></name><etal/></person-group><article-title>Validation of ligands in macromolecular structures determined by X-ray crystallography</article-title><source>Acta Crystallogr Sect D Struct Biol</source><year>2018</year><volume>74</volume><fpage>228</fpage><lpage>236</lpage><pub-id pub-id-type="pmcid">PMC5947763</pub-id><pub-id pub-id-type="pmid">29533230</pub-id><pub-id pub-id-type="doi">10.1107/S2059798318002541</pub-id></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brändén</surname><given-names>G</given-names></name><name><surname>Neutze</surname><given-names>R</given-names></name></person-group><article-title>Advances and challenges in time-resolved macromolecular crystallography</article-title><source>Science (80-)</source><year>2021</year><volume>373</volume><pub-id pub-id-type="pmid">34446579</pub-id></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Adams</surname><given-names>PD</given-names></name><etal/></person-group><article-title>PHENIX: a comprehensive Python-based system for macromolecular structure solution</article-title><source>Acta Crystallogr Sect D Biol Crystallogr</source><year>2010</year><volume>66</volume><fpage>213</fpage><lpage>221</lpage><pub-id pub-id-type="pmcid">PMC2815670</pub-id><pub-id pub-id-type="pmid">20124702</pub-id><pub-id pub-id-type="doi">10.1107/S0907444909052925</pub-id></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wojdyr</surname><given-names>M</given-names></name></person-group><article-title>GEMMI: A library for structural biology</article-title><source>J Open Source Softw</source><year>2022</year><volume>7</volume><fpage>4200</fpage></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Greisman</surname><given-names>JB</given-names></name><name><surname>Dalton</surname><given-names>KM</given-names></name><name><surname>Hekstra</surname><given-names>DR</given-names></name></person-group><article-title>reciprocalspaceship : a Python library for crystallographic data analysis</article-title><source>J Appl Crystallogr</source><year>2021</year><volume>54</volume><fpage>1521</fpage><lpage>1529</lpage><pub-id pub-id-type="pmcid">PMC8493618</pub-id><pub-id pub-id-type="pmid">34671231</pub-id><pub-id pub-id-type="doi">10.1107/S160057672100755X</pub-id></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jutten</surname><given-names>C</given-names></name><name><surname>Herault</surname><given-names>J</given-names></name></person-group><article-title>Blind separation of sources, part I: An adaptive algorithm based on neuromimetic architecture</article-title><source>Signal Processing</source><year>1991</year><volume>24</volume><fpage>1</fpage><lpage>10</lpage></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Comon</surname><given-names>P</given-names></name></person-group><article-title>Independent component analysis, A new concept?</article-title><source>Signal Processing</source><year>1994</year><volume>36</volume><fpage>287</fpage><lpage>314</lpage></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hyvärinen</surname><given-names>A</given-names></name><name><surname>Oja</surname><given-names>E</given-names></name></person-group><article-title>Independent Component Analysis: Algorithms and Applications</article-title><source>Neural Networks</source><year>2000</year><volume>13</volume><fpage>411</fpage><lpage>430</lpage><pub-id pub-id-type="pmid">10946390</pub-id></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rudin</surname><given-names>LI</given-names></name><name><surname>Osher</surname><given-names>S</given-names></name><name><surname>Fatemi</surname><given-names>E</given-names></name></person-group><article-title>Nonlinear total variation based noise removal algorithms</article-title><source>Phys D Nonlinear Phenom</source><year>1992</year><volume>60</volume><fpage>259</fpage><lpage>268</lpage></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chambolle</surname><given-names>A</given-names></name></person-group><article-title>An Algorithm for Total Variation Minimization and Applications</article-title><source>J Math Imaging Vis</source><year>2004</year><volume>20</volume><fpage>89</fpage><lpage>97</lpage></element-citation></ref><ref id="R29"><label>29</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Günther</surname><given-names>S</given-names></name><etal/></person-group><article-title>X-ray screening identifies active site and allosteric inhibitors of SARS-CoV-2 main protease</article-title><source>Science</source><year>2021</year><volume>372</volume><fpage>642</fpage><lpage>646</lpage><pub-id pub-id-type="pmcid">PMC8224385</pub-id><pub-id pub-id-type="pmid">33811162</pub-id><pub-id pub-id-type="doi">10.1126/science.abf7945</pub-id></element-citation></ref><ref id="R30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ben-David</surname><given-names>A</given-names></name><name><surname>Von Hausegger</surname><given-names>S</given-names></name><name><surname>Jackson</surname><given-names>AD</given-names></name></person-group><article-title>Skewness and kurtosis as indicators of non-Gaussianity in galactic foreground maps</article-title><source>J Cosmol Astropart Phys</source><year>2015</year><volume>2015</volume><fpage>019</fpage></element-citation></ref><ref id="R31"><label>31</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fadini</surname><given-names>A</given-names></name><etal/></person-group><article-title>Serial Femtosecond Crystallography Reveals that Photoactivation in a Fluorescent Protein Proceeds via the Hula Twist Mechanism</article-title><source>J Am Chem Soc</source><year>2023</year><volume>145</volume><fpage>15796</fpage><lpage>15808</lpage><pub-id pub-id-type="pmcid">PMC10375524</pub-id><pub-id pub-id-type="pmid">37418747</pub-id><pub-id pub-id-type="doi">10.1021/jacs.3c02313</pub-id></element-citation></ref><ref id="R32"><label>32</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chang</surname><given-names>J</given-names></name><name><surname>Romei</surname><given-names>MG</given-names></name><name><surname>Boxer</surname><given-names>SG</given-names></name></person-group><article-title>Structural Evidence of Photoisomerization Pathways in Fluorescent Proteins</article-title><source>J Am Chem Soc</source><year>2019</year><volume>141</volume><fpage>15504</fpage><lpage>15508</lpage><pub-id pub-id-type="pmcid">PMC7036281</pub-id><pub-id pub-id-type="pmid">31533429</pub-id><pub-id pub-id-type="doi">10.1021/jacs.9b08356</pub-id></element-citation></ref><ref id="R33"><label>33</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Henderson</surname><given-names>R</given-names></name><name><surname>Moffat</surname><given-names>JK</given-names></name></person-group><article-title>The difference Fourier technique in protein crystallography: errors and their treatment</article-title><source>Acta Crystallogr Sect B Struct Crystallogr Cryst Chem</source><year>1971</year><volume>27</volume><fpage>1414</fpage><lpage>1420</lpage></element-citation></ref><ref id="R34"><label>34</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Terwilliger</surname><given-names>TC</given-names></name></person-group><article-title>Reciprocal-space solvent flattening</article-title><source>Acta Crystallogr Sect D Biol Crystallogr</source><year>1999</year><volume>55</volume><fpage>1863</fpage><lpage>1871</lpage><pub-id pub-id-type="pmcid">PMC2745881</pub-id><pub-id pub-id-type="pmid">10531484</pub-id><pub-id pub-id-type="doi">10.1107/S0907444999010033</pub-id></element-citation></ref><ref id="R35"><label>35</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marchesini</surname><given-names>S</given-names></name></person-group><article-title>Invited Article: A unified evaluation of iterative projection algorithms for phase retrieval</article-title><source>Rev Sci Instrum</source><year>2007</year><volume>78</volume><elocation-id>011301</elocation-id><pub-id pub-id-type="pmid">17503899</pub-id></element-citation></ref><ref id="R36"><label>36</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Butola</surname><given-names>M</given-names></name><name><surname>Rajora</surname><given-names>S</given-names></name><name><surname>Khare</surname><given-names>K</given-names></name></person-group><article-title>Complexity-guided Fourier phase retrieval from noisy data</article-title><source>J Opt Soc Am A</source><year>2021</year><volume>38</volume><fpage>488</fpage><pub-id pub-id-type="pmid">33798177</pub-id></element-citation></ref><ref id="R37"><label>37</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Douangamath</surname><given-names>A</given-names></name><etal/></person-group><article-title>Crystallographic and electrophilic fragment screening of the SARS-CoV-2 main protease</article-title><source>Nat Commun</source><year>2020</year><volume>11</volume><fpage>5047</fpage><pub-id pub-id-type="pmcid">PMC7542442</pub-id><pub-id pub-id-type="pmid">33028810</pub-id><pub-id pub-id-type="doi">10.1038/s41467-020-18709-w</pub-id></element-citation></ref><ref id="R38"><label>38</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shao</surname><given-names>C</given-names></name><etal/></person-group><article-title>Simplified quality assessment for small-molecule ligands in the Protein Data Bank</article-title><source>Structure</source><year>2022</year><volume>30</volume><fpage>252</fpage><lpage>262</lpage><elocation-id>e4</elocation-id><pub-id pub-id-type="pmcid">PMC8849442</pub-id><pub-id pub-id-type="pmid">35026162</pub-id><pub-id pub-id-type="doi">10.1016/j.str.2021.10.003</pub-id></element-citation></ref><ref id="R39"><label>39</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Genick</surname><given-names>UK</given-names></name><name><surname>Soltis</surname><given-names>SM</given-names></name><name><surname>Kuhn</surname><given-names>P</given-names></name><name><surname>Canestrelli</surname><given-names>IL</given-names></name><name><surname>Getzoff</surname><given-names>ED</given-names></name></person-group><article-title>Structure at 0.85 Åresolution of an early protein photocycle intermediate</article-title><source>Nature</source><year>1998</year><volume>392</volume><fpage>206</fpage><lpage>209</lpage><pub-id pub-id-type="pmid">9515969</pub-id></element-citation></ref><ref id="R40"><label>40</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schmidt</surname><given-names>M</given-names></name></person-group><article-title>Practical considerations for the analysis of time-resolved x-ray data</article-title><source>Struct Dyn</source><year>2023</year><volume>10</volume><pub-id pub-id-type="pmcid">PMC10435274</pub-id><pub-id pub-id-type="pmid">37600452</pub-id><pub-id pub-id-type="doi">10.1063/4.0000196</pub-id></element-citation></ref><ref id="R41"><label>41</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gerchberg</surname><given-names>R</given-names></name></person-group><article-title>A practical algorithm for the determination of phase from image and diffraction plane pictures</article-title><source>Optik (Stuttg)</source><year>1972</year></element-citation></ref><ref id="R42"><label>42</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Read</surname><given-names>RJ</given-names></name></person-group><article-title>Improved Fourier coefficients for maps using phases from partial structures with errors</article-title><source>Acta Crystallogr Sect A Found Crystallogr</source><year>1986</year><volume>42</volume><fpage>140</fpage><lpage>149</lpage></element-citation></ref><ref id="R43"><label>43</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Read</surname><given-names>RJ</given-names></name><name><surname>McCoy</surname><given-names>AJ</given-names></name></person-group><article-title>A log-likelihood-gain intensity target for crystallographic phasing that accounts for experimental error</article-title><source>Acta Crystallogr Sect D Struct Biol</source><year>2016</year><volume>72</volume><fpage>375</fpage><lpage>387</lpage><pub-id pub-id-type="pmcid">PMC4784668</pub-id><pub-id pub-id-type="pmid">26960124</pub-id><pub-id pub-id-type="doi">10.1107/S2059798315013236</pub-id></element-citation></ref><ref id="R44"><label>44</label><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Lim</surname><given-names>B</given-names></name><name><surname>Son</surname><given-names>S</given-names></name><name><surname>Kim</surname><given-names>H</given-names></name><name><surname>Nah</surname><given-names>S</given-names></name><name><surname>Lee</surname><given-names>KM</given-names></name></person-group><source>Enhanced Deep Residual Networks for Single Image Super-Resolution</source><conf-name>2017 IEEE Conference on Computer Vision and Pattern Recognition Workshops (CVPRW)</conf-name><conf-date>2017-July</conf-date><conf-sponsor>IEEE</conf-sponsor><year>2017</year><fpage>1132</fpage><lpage>1140</lpage></element-citation></ref><ref id="R45"><label>45</label><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Nah</surname><given-names>S</given-names></name><name><surname>Kim</surname><given-names>TH</given-names></name><name><surname>Lee</surname><given-names>KM</given-names></name></person-group><source>Deep Multi-scale Convolutional Neural Network for Dynamic Scene Deblurring</source><conf-name>2017 IEEE Conference on Computer Vision and Pattern Recognition (CVPR)</conf-name><conf-date>2017-Janua</conf-date><conf-sponsor>IEEE</conf-sponsor><year>2017</year><fpage>257</fpage><lpage>265</lpage></element-citation></ref><ref id="R46"><label>46</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>K</given-names></name><name><surname>Zuo</surname><given-names>W</given-names></name><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Meng</surname><given-names>D</given-names></name><name><surname>Zhang</surname><given-names>L</given-names></name></person-group><article-title>Beyond a Gaussian Denoiser: Residual Learning of Deep CNN for Image Denoising</article-title><source>IEEE Trans Image Process</source><year>2017</year><volume>26</volume><fpage>3142</fpage><lpage>3155</lpage><pub-id pub-id-type="pmid">28166495</pub-id></element-citation></ref><ref id="R47"><label>47</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van der Walt</surname><given-names>S</given-names></name><etal/></person-group><article-title>scikit-image: image processing in Python</article-title><source>PeerJ</source><year>2014</year><volume>2</volume><fpage>e453</fpage><pub-id pub-id-type="pmcid">PMC4081273</pub-id><pub-id pub-id-type="pmid">25024921</pub-id><pub-id pub-id-type="doi">10.7717/peerj.453</pub-id></element-citation></ref><ref id="R48"><label>48</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kiefer</surname><given-names>J</given-names></name></person-group><article-title>Sequential minimax search for a maximum</article-title><source>Proc Am Math Soc</source><year>1953</year><volume>4</volume><fpage>502</fpage><lpage>506</lpage></element-citation></ref><ref id="R49"><label>49</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Virtanen</surname><given-names>P</given-names></name><etal/></person-group><article-title>SciPy 1.0: fundamental algorithms for scientific computing in Python</article-title><source>Nat Methods</source><year>2020</year><volume>17</volume><fpage>261</fpage><lpage>272</lpage><pub-id pub-id-type="pmcid">PMC7056644</pub-id><pub-id pub-id-type="pmid">32015543</pub-id><pub-id pub-id-type="doi">10.1038/s41592-019-0686-2</pub-id></element-citation></ref><ref id="R50"><label>50</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pearce</surname><given-names>NM</given-names></name><name><surname>Krojer</surname><given-names>T</given-names></name><name><surname>von Delft</surname><given-names>F</given-names></name></person-group><article-title>Proper modelling of ligand binding requires an ensemble of bound and unbound states</article-title><source>Acta Crystallogr Sect D Struct Biol</source><year>2017</year><volume>73</volume><fpage>256</fpage><lpage>266</lpage><pub-id pub-id-type="pmcid">PMC5349438</pub-id><pub-id pub-id-type="pmid">28291761</pub-id><pub-id pub-id-type="doi">10.1107/S2059798317003412</pub-id></element-citation></ref><ref id="R51"><label>51</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Afonine</surname><given-names>PV</given-names></name><etal/></person-group><article-title>Towards automated crystallographic structure refinement with phenix.refine</article-title><source>Acta Crystallogr Sect D Biol Crystallogr</source><year>2012</year><volume>68</volume><fpage>352</fpage><lpage>367</lpage><pub-id pub-id-type="pmcid">PMC3322595</pub-id><pub-id pub-id-type="pmid">22505256</pub-id><pub-id pub-id-type="doi">10.1107/S0907444912001308</pub-id></element-citation></ref><ref id="R52"><label>52</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harris</surname><given-names>CR</given-names></name><etal/></person-group><article-title>Array programming with NumPy</article-title><source>Nature</source><year>2020</year><volume>585</volume><fpage>357</fpage><lpage>362</lpage><pub-id pub-id-type="pmcid">PMC7759461</pub-id><pub-id pub-id-type="pmid">32939066</pub-id><pub-id pub-id-type="doi">10.1038/s41586-020-2649-2</pub-id></element-citation></ref><ref id="R53"><label>53</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pedregosa</surname><given-names>F</given-names></name><etal/></person-group><article-title>Scikit-learn: Machine Learning in Python</article-title><source>J Mach Learn Res</source><year>2011</year><volume>12</volume><fpage>2825</fpage><lpage>2830</lpage></element-citation></ref><ref id="R54"><label>54</label><element-citation publication-type="journal"><collab>The pandas development team</collab><article-title>pandas-dev/pandas: Pandas</article-title><year>2023</year><pub-id pub-id-type="doi">10.5281/ZENODO.7658911</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>The voxel distribution of a difference map reflects its signal-to-noise ratio.</title><p><bold>(a)</bold> A 1D signal with positive and negative peaks at positions at X’ and X respectively can serve as a simple model for a difference map where an atom moves from X to X’. The corresponding distribution for the difference map voxel values (Δ<italic>ρ</italic>) is non-Gaussian, with a mode at 0 and two modes at <italic>ρ</italic><sub>max</sub>(X) and <italic>ρ</italic><sub>max</sub>(X’) (the histogram is plotted with a log-scale on the y-axis). On the right column, the normal probability plot compares the map voxel value distribution to a perfect Gaussian: the observed data (sample quantiles) is ordered and plotted against the expected values of the ordered statistics for a sample from a standard normal distribution of the same size as the data (theoretical quantiles). The red line denotes the behavior for a sample that is normally distributed. Deviations from this straight line indicate deviations from a Gaussian distribution. <bold>(b)</bold> A more realistic case is that of a carbon atom translating from X to X’ in three-dimensional space. Here we show the case where the positive and negative electron density signals from the displacement of the atom overlay and partially cancel. The resulting difference map voxel value distribution (Δ<italic>ρ</italic>) is no longer strictly bimodal but remains non-Gaussian. <bold>(c)</bold> Deviation from a Gaussian distribution for the histogram of voxel values is also noticeable for the calculated difference map of a known light-induced protein structural change: we display a noise-free synthetic difference electron density (DED) map for the 100 ps <italic>trans</italic>-to-<italic>cis</italic> photoisomerization of the Cl-rsEGFP2 protein chromophore (PDB ID 8A6G). To match experimental data<sup><xref ref-type="bibr" rid="R31">31</xref></sup>, the map is calculated by converting 13% of the reference dark <italic>trans</italic> population to <italic>cis</italic>. As the dark state already contains 14% of the <italic>cis</italic> species, the final state (in orange here) is at 27% <italic>cis</italic> occupancy. We show the calculated difference map at a contour level that is comparable to the experimental map shown below in <bold>(d)</bold>. In contrast to the calculated map, the experimental map<sup><xref ref-type="bibr" rid="R31">31</xref></sup> is dominated by Gaussian noise, even after error-based amplitude k-weighting. This is apparent from the histogram and probability plot of the map voxel value distribution shown on the right.</p></caption><graphic xlink:href="EMS199957-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>Total variation (TV) minimization can effectively denoise experimental DED maps.</title><p><bold>(a)</bold> TV denoising is used in signal processing to remove spurious noise from data. This is exemplified here by artificially adding white noise (sampled from a normal distribution with a standard deviation ≈10% of the maximum pixel value in the image) to the cameraman image and applying Chambolle’s total variation minimization algorithm to retrieve the underlying signal<sup><xref ref-type="bibr" rid="R28">28</xref></sup>. A regularization parameter λ determines the degree of denoising: a value of λ that is too high will produce an image that is overly “smoothed” compared to the original. On the right, the power spectrum for each image illustrates the effect of the added noise and of subsequent TV denoising to recover signal. <bold>(b)</bold> TV denoising using two different manually chosen values of λ is shown for the weighted Cl-rsEGFP2 <italic>trans</italic>-to-<italic>cis</italic> photoisomerization DED map, along with the original experimental map (λ = 0.0). As for the 2D images in (a), power spectra show that, while the starting experimental map contains little signal, an appropriately regularized denoising yields map coefficients that approach those for the simulated map displayed in <xref ref-type="fig" rid="F1">Figure 1(c)</xref>. <bold>(c)</bold> To refine an appropriate value of λ, we denoise the experimental Cl-rsEGFP2 map for a range of regularization levels (0 ≤ λ ≤ 0.08) and identify the λ value that maximizes map negentropy.</p></caption><graphic xlink:href="EMS199957-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>An iterative TV minimization algorithm estimates the phases of the structure factor contribution from low occupancy states.</title><p><bold>(a)</bold> The unknown perturbed state phases are estimated through an iterative procedure (it-TV, <xref ref-type="supplementary-material" rid="SD1">Figure S6</xref>). The initial difference map is computed from the observed derivative and native amplitudes (F’<sub>obs</sub> and F<sub>obs</sub>) and the phases from the reference state model (<italic>ϕ<sub>c</sub></italic>). A step of difference density (△ρ) TV denoising is followed by an inverse Fourier transform (FT) to reciprocal space. We then project the <bold>△F<sup>TV</sup></bold> set onto the phase circle with magnitude F’<sub>obs</sub> (see also <xref ref-type="supplementary-material" rid="SD1">Figure S6</xref>) as a way of finding a new phase estimate for <bold>F’</bold>. The new phases are used in the next iteration. Iterations are run until convergence (see <xref ref-type="sec" rid="S8">Methods</xref>). <bold>(b)</bold> The experimental Cl-rsEGFP2 map is shown before and after it-TV (in purple and orange for negative and positive density respectively, ±3 rms), together with the cumulative phase change and negentropy values for the difference maps generated at each iteration in <bold>(c)</bold>. The mean phase change at each iteration is plotted in red. The negentropy as a function of iteration is plotted in gray.</p></caption><graphic xlink:href="EMS199957-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>Test cases demonstrate the power of negentropy-guided TV denoising to recover time-resolved and ligand-binding signals.</title><p>We show single-pass TV denoising and iterative-TV maps with their associated negentropy values for our three test datasets: the 100 ps photoisomerization of the OHD chromophore in the Cl-rsEGFP2 protein (PDB ID 8A6G) (a), the example of M<sup>pro</sup> bound to tegafur (PDB ID 7AWR), which was identified as a potential binder to an allosteric site with a modeled occupancy of 0.50 (b), and the example of the M<sup>pro</sup>-U1G complex (PDB ID 5RGO), with a modeled fragment occupancy of 0.42 (c). Reference state structures are shown in gray, while structures that we refined to the perturbed dataset are shown in black. Ligand outlines become stronger and more chemically interpretable for all three test cases. For the M<sup>pro</sup>-tegafur complex, there are strong signals for rearrangements of side chains and backbone atoms near the ligand binding pocket. For the M<sup>pro</sup>-U1G complex, the it-TV map suggests an alternative fragment pose. The largest gains from the denoising step occur when the initial map is close to being normally distributed (as for the signal on the OHD chromophore in Cl-rsEGFP2 or in the M<sup>pro</sup>-tegafur complex). We show maps at ±3.5 rms, which we find is an appropriate rms cutoff to highlight signal for these examples. However, because TV-denoised maps are intentionally non-Gaussian, the second moment (rms) alone does not fully capture the distribution of voxel values. It’s therefore important to keep in mind that common visualization thresholds, like ±3 rms, may not directly relate when trying to compare denoised and standard maps.</p></caption><graphic xlink:href="EMS199957-f004"/></fig><fig id="F5" position="float"><label>Figure 5</label><caption><title>Denoised difference maps can guide the refinement of new coordinates and uncover low-occupancy conformations.</title><p><bold>(a)</bold> Extrapolated map for the M<sup>pro</sup>-tegafur complex. This is obtained through addition of the it-TV map shown in <xref ref-type="fig" rid="F4">Figure 4</xref> to the 2mF<sub>o</sub>-DF<sub>c</sub> map from the reference state (PDB ID 7AR6, black). We highlight the rearrangement of the backbone and Thr98/Tyr101/Phr103 sidechain atoms close to the ligand binding pocket. We refine coordinates for the bound state to this extrapolated map (light blue) and screen R-factor values to initiate the occupancy of the ligand-bound state in a multi-state model, choosing an occupancy of 0.29 for initial refinement. <bold>(b)</bold> Binding pocket coordinates from the deposited ligand bound (PDB ID 7AWR) and unbound (PDB ID 7AR6) models and the multi-state model generated here are shown. The table reports final refinement R-factors for the deposited ligand bound and unbound models and the multi-state model when compared to the ligand-bound dataset. For the refined multi-state model, the reference chain is overlaid with the 7AR6 model.</p></caption><graphic xlink:href="EMS199957-f005"/></fig></floats-group></article>