<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="epub">2692-8205</issn></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS201947</article-id><article-id pub-id-type="doi">10.1101/2024.12.11.627909</article-id><article-id pub-id-type="archive">PPR953233</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Calibration-free estimation of field dependent aberrations for single molecule localization microscopy across large fields of view</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Droste</surname><given-names>Isabel</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Schuitema</surname><given-names>Erik</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Khan</surname><given-names>Sajjad</given-names></name><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Heldens</surname><given-names>Stijn</given-names></name><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>van Werkhoven</surname><given-names>Ben</given-names></name><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Lidke</surname><given-names>Keith A.</given-names></name><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author" equal-contrib="yes"><name><surname>Stallinga</surname><given-names>Sjoerd</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">†</xref></contrib><contrib contrib-type="author" equal-contrib="yes"><name><surname>Rieger</surname><given-names>Bernd</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">†</xref></contrib><aff id="A1"><label>1</label>Department of Imaging Physics, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/02e2c7k09</institution-id><institution>Delft University of Technology</institution></institution-wrap>, <city>Delft</city>, <country country="NL">The Netherlands</country></aff><aff id="A2"><label>2</label>ESSD Software Engineering, Rotterdam, The Netherlands</aff><aff id="A3"><label>3</label>Department of Physics and Astronomy, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/05fs6jp91</institution-id><institution>University of New Mexico</institution></institution-wrap>, <city>Albuquerque</city>, <state>New Mexico</state>, <country country="US">USA</country></aff><aff id="A4"><label>4</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/00rbjv475</institution-id><institution>Netherlands eScience Center</institution></institution-wrap>, <city>Amsterdam</city>, <country country="NL">The Netherlands</country></aff></contrib-group><author-notes><corresp id="CR1">
<label>†</label><bold>For correspondence:</bold> <email>s.stallinga@tudelft.nl</email> (S.S.), <email>b.rieger@tudelft.nl</email> (B.R.)</corresp></author-notes><pub-date pub-type="nihms-submitted"><day>18</day><month>12</month><year>2024</year></pub-date><pub-date pub-type="preprint"><day>11</day><month>12</month><year>2024</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Image quality in single molecule localization microscopy (SMLM) depends largely on the accuracy and precision of the localizations. While under ideal imaging conditions the theoretically obtainable precision and accuracy are achieved, in practice this changes if (field dependent) aberrations are present. Currently there is no simple way to measure and incorporate these aberrations into the Point Spread Function (PSF) fitting, therefore the aberrations are often taken constant or neglected all together. Here we introduce a model-based approach to estimate the field-dependent aberration directly from single molecule data without a calibration step. This is made possible by using nodal aberration theory to incorporate the field-dependency of aberrations into our fully vectorial PSF model. This results in a limited set of aberration fit parameters that can be extracted from the raw frames without a bead calibration measurement, also in retrospect. The software implementation is computationally efficient, enabling fitting of a full 2D or 3D dataset within a few minutes. We demonstrate our method on 2D and 3D localization data of microtubuli and nuclear pore complexes over fields of view (FOV) of up to 180 µm and compare it with spline-based fitting and a deep learning based approach.</p></abstract></article-meta></front><body><p id="P2">Single-molecule localization microscopy (SMLM) [<xref ref-type="bibr" rid="R1">Betzig2006</xref>, <xref ref-type="bibr" rid="R4">Rust2006</xref>, <xref ref-type="bibr" rid="R3">Sharonov2006</xref>, Heilemann2008] enables routine imaging at the nano-scale. The need for high throughput and much data implies that a large Field Of View (FOV) must be imaged, which is enabled by modern sCMOS sensors that have up to 10 Mpixels and advanced illumination schemes [<xref ref-type="bibr" rid="R5">Douglass2016</xref>, <xref ref-type="bibr" rid="R6">Deschamps2016</xref>, <xref ref-type="bibr" rid="R7">Diekmann2017</xref>, <xref ref-type="bibr" rid="R8">Archetti2019</xref>, <xref ref-type="bibr" rid="R9">Mau2021</xref>, Li2022, <xref ref-type="bibr" rid="R11">Ma2024</xref>, <xref ref-type="bibr" rid="R12">Nelson2024</xref>]. A key problem that arises is that aberrations depend on the position in the FOV. This is problematic for both the precision and accuracy of in-plane (<italic>xy</italic>) localization, but even more so for 3D (<italic>xyz</italic>) localization. Up to now aberrations, let alone field dependent aberrations, are rarely considered in SMLM as it is time consuming and cumbersome to i) measure them and ii) include them into the fitting. For that reason, the default method for estimating the positions of the emitters is to fit a simplified Point Spread Function (PSF) model to the recorded data. Typically, this simplified model is a Gaussian [<xref ref-type="bibr" rid="R15">Smith2010</xref>], which reduces the computational load to estimate the positions of millions of emitters to reconstruct a super-resolution image. Known drawbacks, however, are position biases in case of asymmetric aberrations and of emitters with partially fixed orientation [<xref ref-type="bibr" rid="R14">Stallinga2010</xref>], and an underestimation of the photon count [<xref ref-type="bibr" rid="R13">Thorsen2018</xref>]. An actual data driven PSF model is the spline model [Li2019], which requires calibration of the PSF by beads, potentially at various field and depth positions. Advantageously, a physically correct fully vectorial PSF model could be used, so that high NA and polarization effects are properly considered. Moreover, (field dependent) aberrations of the microscope can then automatically be incorporated, and emission dipole orientation as well, if needed. Up to now such a full vectorial model is not used in practice for SMLM due to the computational load [<xref ref-type="bibr" rid="R17">Hullemann2021</xref>].</p><p id="P3">The current practical standard to measure field dependent aberrations is a calibration in the form of an axial scan of many fluorescent beads distributed over the whole FOV [Li2019, <xref ref-type="bibr" rid="R17">Hulleman2021</xref>, <xref ref-type="bibr" rid="R19">Fu2023</xref>]. An alternative is provided by the localization data itself, as millions of localization events are in fact millions of measurements of the microscope’s PSF across the FOV. The localization data itself thus provides a wealth of information on the optical system, and the challenge is to unlock that information. The key obstacle is that each individual localization event does not allow for fitting of aberration parameters next to the position, photon count and background, because the data is much too noisy for a robust estimation of many parameters. Previously, Xu et al. applied pupil phase retrieval to an averaged set of 3D localization data, but only so using an approximate scalar PSF model and for global aberrations independent of the position in the FOV [<xref ref-type="bibr" rid="R29">Xu2020</xref>]. Recently, Liu et al. proposed a framework for inverse PSF modelling, enabled by automatic differentiation, and showed its applicability to vectorial PSF fitting of 3D localization datasets with field dependent aberrations [<xref ref-type="bibr" rid="R30">Liu2024</xref>]. Here, we present an alternative method to estimate the field dependent aberrations from 2D or 3D single molecule images alone, without any calibration measurement. We make this possible by fitting the localization data with a global optical aberration model, with a limited number of fit parameters, instead of fitting the full aberration content for each measured PSF separately. This global aberration model is derived from the so-called Nodal Aberration Theory (NAT) [<xref ref-type="bibr" rid="R21">Shack1980</xref>], which provides explicit relations of the field dependency of the appearing aberration coefficients via low-order polynomials of the field coordinates. This eliminates the need for ad-hoc smoothing of field dependent aberrations as done in the inverse PSF modeling approach and enables application to 2D localization data.</p><p id="P4">Aberrations can be modelled by expressing the phase aberration function in the pupil plane in terms of Zernike modes. Using NAT, the Zernike coefficients <italic>A</italic><sub><italic>nm</italic></sub> can be expressed as low-order polynomials of the field coordinates (<italic>x, y</italic>) (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Note</xref> for theory): <disp-formula id="FD1"><mml:math id="M1"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle></mml:mrow><mml:mrow><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>q</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>q</mml:mi><mml:mi>n</mml:mi><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>q</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>γ</italic><sub><italic>lqnm</italic></sub> are the NAT coefficients, and <italic>Q</italic><sub><italic>lq</italic></sub> (<italic>x, y</italic>) are products of (Legendre) polynomials of order <italic>l</italic> and <italic>q</italic>. We adapted NAT to the square shape of the FOV by using Legendre polynomials to describe the field dependence. For describing the field dependency of the first order aberrations, that is, defocus, and primary astigmatism, coma, and spherical aberration, it turns out that only 13 NAT coefficients are needed. To include second order aberrations (trefoil and secondary astigmatism, coma, and spherical aberration), an additional 43 NAT coefficients are needed. This number of free parameters, though large, is still orders of magnitude less than the number of free parameters in data driven approaches [<xref ref-type="bibr" rid="R16">Li2018</xref>, <xref ref-type="bibr" rid="R46">Bates2022</xref>].</p><p id="P5"><xref ref-type="fig" rid="F1">Figure 1</xref> schematically depicts our method. The raw blinking time series data is segmented into regions of interests (ROI) containing fluorescent emitters as usual for SMLM. From these millions of ROIs, a very small subset of <italic>M</italic><sub><italic>s</italic></sub> ∼ 10<sup>3</sup> ROIs across the FOV is randomly selected to be used as input for the field dependent aberration estimation. The estimation process consists out of an alternation of local and global updates. During a global update, the NAT coefficients are updated while keeping the locations, photon count and local background of the emitters fixed, while during a local update, the locations are updated with fixed NAT coefficients. Subsequently, all ROIs are fitted with a vector PSF model (“Vectorfit”, <ext-link ext-link-type="uri" xlink:href="https://gitlab.tudelft.nl/imphys/ci/vectorfit">https://gitlab.tudelft.nl/imphys/ci/vectorfit</ext-link>) using the found field dependent aberrations as input. We have implemented the vector PSF fitting on GPU for speedup and have devised several algorithmic improvements for additional steps in efficiency. First, we utilize the phasor method to provide a fast, initial estimate of the lateral position that is robust against high background [<xref ref-type="bibr" rid="R22">Martens2018</xref>]. Second, we compute the initial estimate of photon count <italic>N</italic><sub><italic>ph</italic></sub> and background count <italic>bg</italic> with linear regression given the data and the model. Third, pre-computing the Optical Transfer Function (OTF) reduces the number of needed Fourier Transformations per iteration by a factor of 6. These different algorithmic innovations are outlined in the <xref ref-type="sec" rid="S1">Methods</xref> section.</p><p id="P6">We have tested our method on SMLM data of microtubuli acquired over a large 97 x 97 µm FOV (see <xref ref-type="sec" rid="S1">Methods</xref> for experimental details). The same sample was imaged with and without astigmatism to obtain 2D and 3D localization data, respectively (see <xref ref-type="fig" rid="F2">Figure 2</xref>). The aberrations found from the single molecule data via our method give very similar aberration maps across the FOV (orange in <xref ref-type="fig" rid="F2">Fig. 2a,e</xref>) as the aberration maps obtained by interpolating between aberrations retrieved from <italic>z</italic>-stack bead calibration data (light blue in <xref ref-type="fig" rid="F2">Fig. 2a,e</xref>), with the largest difference in the slope of the coma aberration maps. We performed a chi-square goodness of fit test [<xref ref-type="bibr" rid="R18">Siemons2018</xref>] to check if the PSF model with single molecule derived aberrations gives rise to a better fit than the PSF model with bead calibration derived aberrations (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 1</xref>). For both the 2D and 3D data we find on average about 1% smaller chi-square values for the single molecule derived aberrations, up to about 5% and 3% smaller at the edges of the FOV for the 2D and 3D datasets, respectively, indicating a slightly better fit of the single molecule derived aberrations. The overall chi square values are about 20% (2D) and 16% (3D) higher than the theoretical values based on shot noise statistics [<xref ref-type="bibr" rid="R18">Siemons2018</xref>] (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3</xref>), indicating a residual model mismatch, possibly due to higher order aberrations and amplitude aberrations. A further validation of our approach is found by a comparison of the modelled PSF to the measured single molecule spots in 4x4 patches across the FOV, as a function of the axial position (<xref ref-type="supplementary-material" rid="SD1">Supplementary Video 1</xref>). This comparison shows that the modelled PSF matches very well with the measured data.</p><p id="P7">We also found a difference in the estimated bead aberrations between consecutive days of measurement with different bead samples. The beads measured on the second day show a uniform shift in coma coefficient <italic>A</italic><sub>3−1</sub> (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2</xref>). By estimating the <italic>z</italic>-locations of the beads, we found that the tilt of the sample was different between the two measurement instances, most likely caused by remounting of a different bead sample on the stage. We attribute the difference in the estimated coma to this sample tilt, as passing a high NA emission beam through a tilted medium leads to coma that is constant over the FOV. Apparently, the aberration estimation from bead calibration data can be affected by small changes in the imaging conditions, like the sample tilt. Similar differences in imaging conditions can potentially arise between the bead calibration measurement and the actual single molecule data acquisition, implying that estimation of aberrations from the data itself not only makes the bead calibration measurement spurious, but is also inherently more reliable.</p><p id="P8">We also used the chi square goodness of fit test to assess the added value of taking the field dependency of the aberrations into account. We applied Vectorfit with all the aberrations set to zero, except for a constant amount of astigmatism (<italic>A</italic><sub>2−2</sub> = 87 <italic>mλ</italic>, equal to the average amount over the FOV estimated from the bead calibration) for estimating the axial location for the 3D data. <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3</xref> shows that the PSF model with single molecule data derived field dependent aberrations fits the data better than the model without aberrations, especially towards the edges of the FOV. A comparison of the estimated locations using the two models shows that the location difference increases with the distance from the center of the FOV (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 3d</xref>). Moreover, for the 3D data, the shift in location is different for emitters with z &lt; 0 than for emitters with z &gt; 0 (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 3f</xref>), which could lead to a distortion of the imaged structures when field dependent aberrations are not considered.</p><p id="P9">We compared our reconstructions to existing methods, namely Picasso for the 2D data and SMAP for the 3D data. Picasso [Picasso] uses a Gaussian PSF model where the horizontal and vertical standard deviations <italic>σ</italic><sub><italic>x</italic></sub> and <italic>σ</italic><sub><italic>y</italic></sub> are estimated for each ROI [<xref ref-type="bibr" rid="R15">Smith2010</xref>], whereas SMAP [SMAP] uses a spline PSF model that is uniform across the FOV, with parameters estimated from the experimental bead data. <xref ref-type="fig" rid="F2">Figures 2c,d</xref> show that 2D reconstructions with Picasso are very similar to reconstructions with Vectorfit. The average localization precision, estimated by linking localizations in consecutive frames [<xref ref-type="bibr" rid="R25">Cnossen2020</xref>], is 10.0 nm for Vectorfit with a CRLB of 9.3 nm, better than the value of 13.5 nm found for Picasso with a CRLB of 14.2 nm. <xref ref-type="fig" rid="F2">Figures 2g-j</xref> show that 3D reconstructions with SMAP are similar to reconstructions with Vectorfit, where Vectorfit shows a somewhat smaller axial spread of the localizations. The linking analysis gives here an average localization precision of 12.1 nm (<italic>xy</italic>) and 29.9 nm (<italic>z</italic>), with a CRLB of 12.1 nm (xy) and 31.1 nm (z), compared to a precision of 12.1 nm (<italic>xy</italic>) and 35.7 nm (<italic>z</italic>) for SMAP. FRC image resolution [<xref ref-type="bibr" rid="R26">Nieuwenhuizen2013</xref>] estimation (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figs. 4 and 5</xref>) show a comparable performance between Vectorfit and the other used softwares.</p><p id="P10">Next, we applied our method to 3D data of NUP96 in the nuclear pore complex (NPC) in U2OS cells (FOV of about 180x180 µm) of Fu et al. [<xref ref-type="bibr" rid="R19">Fu2023</xref>], where the axial direction was encoded using astigmatism, and compared the outcome to that of their method FD-DeepLoc in <xref ref-type="fig" rid="F3">Figure 3</xref>. The aberrations maps retrieved from the single molecule data matches well with the aberration maps obtained from the bead calibration used in FD-DeepLoc, towards the edges of the FOV, however, the bead calibration derived aberration maps show large and erratic variations, which is unlikely from the optical point of view. <xref ref-type="fig" rid="F3">Figure 3b</xref> shows the experimentally found standard deviation for the estimation of the different aberrations, obtained from 30 estimations for different randomly selected subsets of 5,000 localizations, as well as their Cramer-Rao lower Bound (CRLB) values. The experimental standard deviations are on the small <italic>mλ</italic> scale across the whole FOV, but do not reach the CRLB values in the sub-<italic>mλ</italic> level. We also tested the dependence of the experimental precision on the number of localization events <italic>M</italic><sub><italic>s</italic></sub>, and found a scaling inversely proportional to <italic>M</italic><sub><italic>s</italic></sub><sup>½</sup>, in agreement with expectations (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figs. 6 and 7</xref>). The comparison of the modelled PSF to the measured single molecule spots in 4×4 patches across the FOV, as a function of the axial position (<xref ref-type="supplementary-material" rid="SD1">Supplementary Video 2</xref>) shows a good match between the modelled PSF with the measured data. These validation tests indicate that our approach enables unbiased and precise aberration estimation.</p><p id="P11">We compared the Vectorfit reconstruction with field dependent aberrations retrieved from the single molecule data to a reconstruction with Vectorfit without aberrations, were all the aberrations are set to zero, except for a constant amount of astigmatism (<italic>A</italic><sub>22,</sub> = 103 <italic>mλ</italic>, in accordance with the reported rms value from the cylindrical lens) for estimating the axial location, and to the FD-DeepLoc reconstruction. In the center of the FOV, close to the optical axis, the reconstructions from the three methods are comparable (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 8</xref>). Towards the edges of the FOV, however, the aberrations become larger, leading to sizeable differences in the axial localization (see <xref ref-type="fig" rid="F3">Figure 3c-f</xref>). In one corner of the FOV, the FD-DeepLoc reconstruction shows a large spread of <italic>z</italic>-locations within a single cell nucleus (<xref ref-type="fig" rid="F3">Fig. 3d(iii)</xref>). The <italic>xz</italic> cross-section in <xref ref-type="fig" rid="F3">Fig. 3f(iii)</xref> shows a large variation of <italic>z</italic>-locations in a single NPC, which seems unrealistic. In our reconstructions (<xref ref-type="fig" rid="F3">Fig. 3d(i-ii)</xref> and <xref ref-type="fig" rid="F3">Fig. 3f(i-ii)</xref>), the range of <italic>z</italic>-locations matches much better with the expected thickness of the NPC ring of around 50 nm [<xref ref-type="bibr" rid="R27">Wang2023</xref>, <xref ref-type="bibr" rid="R28">Thevasthasa2019</xref>]. At the top of the FOV we observe that Vectorfit with field dependent aberrations leads to a better reconstruction than without aberrations. (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 9</xref>). A chi-square goodness of fit test (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 10</xref>) shows that the Vectorfit model with field dependent aberrations outperforms Vectorfit with constant aberrations, with a chi-square ratio reaching 1.5 at the edges of the FOV. We also observe a shift in the lateral localizations up to a few tens of nanometres (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 10b</xref>) and a shift in the axial localizations of up to 150 nanometres (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 10c</xref>). The distribution of localization precision values, estimated using the method of linking localizations in consecutive frames, has a mean of 11.7 nm (<italic>xy</italic>) and 23.5 nm (<italic>z</italic>) for Vectorfit with field dependent aberrations, with a CRLB of 10.1 nm (yz) and 20.6 nm (z). For FD-Deeploc we find by the same method a localization precision of 7.9 nm (<italic>xy</italic>) and 23.2 nm (<italic>z</italic>). With Vectorfit, we achieve the CRLB and therefore attain the optimal localization precision based on the signal-to-noise ratio of the data. The axial localization precision of Vectorfit is comparable to FD-Deeploc, but the lateral localization precision is a bit worse. We speculate that the learning-based approach of FD-Deeploc could bias localizations from the same emitter, which would introduce spurious correlations in subsequent time frames, resulting in a lower measured lateral localization precision than the CRLB. Analysis of the image resolution in a grid of 4x4 patches across the FOV with FRC thus shows a slightly better image resolution for FD-DeepLoc than for VectorFit (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 11</xref>).</p><p id="P12">Fully vectorial PSF fitting in a Maximum Likelihood Estimation (MLE) framework has not found its way into the practice of the SMLM field up to now. Software fitting is mostly dominated by fitting of Gaussians or spline-based models. The reason is solely that the fitting speed was too slow for the typical number of localizations (∼10<sup>6</sup>) in a super-resolution acquisition. CPU implementations of 2D Gaussian MLE fitting achieve currently about 10<sup>4</sup> fits/s and GPU implementations even more than 10<sup>6</sup> fits/s (7x7 pixel ROI). Only the phasor-based approach is equally quick on CPU [Martens2018]. Our OTF based algorithmic improvements for the fitting together with a high-end GPU (Nvidia A100) allow now 10<sup>5</sup> fits/s (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Table 1</xref>), while a good desktop GPU (Nvidia RTX A4000) has 6 · 10<sup>4</sup> fits/s and a multi-core CPU still achieves 9 · 10<sup>3</sup> fits/s. This brings vectorial PSF fitting times for a typical data set to less than a minute on a GPU in 2D. In 3D our algorithmic improvements are less effective (for details see <xref ref-type="supplementary-material" rid="SD1">Supplementary Note</xref>) which results in 6.8 · 10<sup>3</sup> fits/s for a 17x17 pixel ROI on our desktop GPU which is about 30x slower than 3D spline-based fitting which achieves 2 · 10<sup>5</sup> fits/s on a desktop GPU for a 17×17 pixel ROI [<xref ref-type="bibr" rid="R20">Li2024</xref>], but better than the less than 1 fit/second reported for a 17×17×41 pixel bead stack [<xref ref-type="bibr" rid="R19">Fu2023</xref>].</p><p id="P13">Our approach of estimating aberrations directly from single molecule data makes taking the inclusion of field dependent aberrations to the localization much more feasible because it saves doing an additional bead calibration experiment, which can also be prone to errors as shown above. The recently proposed method from Liu et al. to estimate aberrations from single molecule data can take more than half an hour on a GPU [<xref ref-type="bibr" rid="R30">Liu2024</xref>], while our model-based approach takes less than a minute on a CPU to estimate aberrations. In addition our work is applicable to 2D localization data while theirs is not. In 2D, however, the effect of field dependent aberrations on the localizations is less impactful than in 3D.</p><p id="P14">In future work, a user interface should be developed to make vectorial PSF fitting accessible for a broader audience. Furthermore, the NAT driven approach of estimating field dependent aberrations directly from single molecule data could be applied to other imaging modalities such as 4Pi SMLM or localization microscopy with fixed dipole emitters, and also for scanning but camera-based localization microscopy [<xref ref-type="bibr" rid="R32">Radmacher2024</xref>].</p><sec id="S1" sec-type="methods" specific-use="web-only"><title>Methods</title><sec id="S2"><title>Processing pipeline</title><p id="P15">First, the set of acquired images were offset and gain corrected to convert ADUs into photon counts [Heintzmann2018, vanVliet1998a]. ROIs of size of 9 × 9 pixels for 2D data and 17 × 17 pixels for 3D data pixels are identified by a two-stage filtering process to reduce photon noise and local background followed by an intensity threshold [Huang2011, Smith2015]. In short, we apply uniform filters to the raw images with filter size 3 and 7 pixels and take the difference. We then compute the local maximum in a 7×7 pixels neighbourhood for all pixels and accept the central pixel as candidate for a single-molecule spot if its value is the local maximum and is higher than a threshold directly above the background noise level (different for each dataset). Now the 9 × 9 or 17 × 17 ROI is segmented out for all candidates and each ROI, labelled with index <italic>s</italic>, is extracted, leading to a total of <italic>N</italic><sub><italic>loc</italic></sub> candidate localization events.</p><p id="P16">A randomly selected subset of <italic>M</italic><sub><italic>s</italic></sub> ≪ <italic>N</italic><sub><italic>loc</italic></sub> of localizations is processed to determine the Legendre NAT coefficients that characterize the variation of the Zernike aberration coefficients across the FOV. To ensure an even distribution over the FOV, the localizations are selected on a 10x10 grid over the FOV where the same number of localizations is selected from each grid cell. The selected localizations are fitted using a Maximum Likelihood Estimation (MLE) algorithm with alternating local and global iteration steps. In the local iteration step the emitter position <inline-formula><mml:math id="M2"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>S</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>S</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> signal photon count <italic>N</italic><sub><italic>ph</italic></sub> and background <italic>bg</italic> of all <italic>M</italic><sub><italic>s</italic></sub> localizations are updated until they no longer improve, given the current set of NAT coefficients. For 2D data, the axial position is fitted as well, ensuring that <italic>z</italic><sub><italic>s</italic></sub> ≥ 0, because this leads to an improved aberration estimation compared to keeping the <italic>z</italic><sub><italic>s</italic></sub> value fixed. In each global update step, 20% of the <italic>M</italic><sub><italic>s</italic></sub> localizations are selected randomly. Then, the NAT coefficients are updated until they no longer improve, given the estimated positions, signal photon counts and background level of this subset of localization events. By using only 20% of the emitters in each step, the process is sped up significantly, while, with high probability, each of the <italic>M</italic><sub><italic>s</italic></sub> localization events will be used at least once in the full optimization process. The process typically converges after 6-10 steps and takes 30-45 seconds with <italic>M</italic><sub><italic>s</italic></sub> = 5,000 on a CPU using 12 cores (Intel Xeon w5-2455X). The NAT coefficients are randomly initialized such that the system aberration value <italic>W</italic><sub><italic>SYS</italic></sub> (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Note</xref>) is equal to 40 <italic>mλ</italic>, because a small value different from zero appeared to result in a faster convergence. In the case of 3D data with astigmatism, an additional amount of 150 <italic>mλ</italic> of constant astigmatism is incorporated in the initial NAT coefficients. For 2D data, the procedure is repeated 10 times with different random initializations for the same emitters, after which the solution with the highest likelihood is selected to rule out convergence to a local maximum. This is needed to mitigate the risk of getting stuck in a local optimum during optimization. The precision of the method is estimated by repeating the process <italic>P</italic><sub><italic>s</italic></sub> = 30 times by taking different randomly selected subsets of <italic>M</italic><sub><italic>s</italic></sub> localization events. We found that several thousands of localization events are typically sufficient to reliably find the NAT coefficients (compare <xref ref-type="supplementary-material" rid="SD1">Supplementary Figures 6 and 7</xref>). Unless indicated otherwise, we use the NAT expansion to first order, giving 13 independent NAT coefficients that we denote by <inline-formula><mml:math id="M3"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>γ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> with <italic>k</italic> = 1,2 …, 13, taking into account the dependencies between the <italic>γ</italic><sub><italic>lqnm</italic></sub> as described in <xref ref-type="supplementary-material" rid="SD1">Supplementary Note</xref>.</p><p id="P17">For each set of NAT coefficients, there is another set of NAT coefficients that leads to the same PSF, in combination with flipping the sign of the axial coordinate <italic>z</italic><sub><italic>s</italic></sub>. This symmetric set of coefficients is obtained by flipping the sign of the NAT coefficients that belong to Zernike coefficients <italic>A</italic><sub><italic>nm</italic></sub> for which <italic>n</italic> is even and keeping the other NAT coefficients the same. This is because flipping the sign of these even Zernike coefficients in combination with flipping the sign of <italic>z</italic><sub><italic>s</italic></sub> leads to the same PSF, while for the Zernike coefficients for which <italic>n</italic> is uneven, only flipping the sign of <italic>z</italic><sub><italic>s</italic></sub> leads to the same PSF. For the first-order Zernike coefficients, the even <italic>n</italic> modes are defocus, astigmatism and spherical aberration (<italic>A</italic><sub>20</sub>, <italic>A</italic><sub>2−2</sub>, <italic>A</italic><sub>22</sub>, <italic>A</italic><sub>40</sub>), while the odd modes are tilt and coma (<italic>A</italic><sub>11</sub>, <italic>A</italic><sub>1−1</sub>, <italic>A</italic><sub>3−1</sub>, <italic>A</italic><sub>31</sub>) where tilt is not fitted in our model because it comes down to a shift in <italic>x</italic><sub><italic>s</italic></sub> or <italic>y</italic><sub><italic>s</italic></sub>. Therefore, the symmetric solution is obtained by flipping the sign of <inline-formula><mml:math id="M4"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>γ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> for all <italic>k</italic> = 1,2, …, 13, except for <italic>k</italic> = 10, 11,12, which are the NAT coefficients that correspond to coma. To make sure our method gives an unambiguous solution, we choose the solution for which <italic>γ</italic><sub>5</sub> is positive, which corresponds to the constant term of <italic>A</italic><sub>22</sub> (vertical astigmatism).</p><p id="P18">In a next step all <italic>N</italic><sub><italic>loc</italic></sub> localization events are fitted with the vectorial PSF model including the found field dependent aberrations. In these fits, as well as for the local update step in the estimation of the aberration field, we achieve major steps in efficiency by execution on GPU, as well as by several algorithmic improvements. The first algorithmic improvement is the application of phasor fitting [<xref ref-type="bibr" rid="R22">Maertens2018</xref>] to provide an initial estimate of the lateral position (<italic>x</italic><sub>0</sub>, <italic>y</italic><sub>0</sub>) of the emitter. In short, the measured photon counts <italic>n</italic><sub><italic>k</italic></sub> (<italic>k</italic> = 1,2, …, <italic>K</italic><sup>2</sup>) of all <italic>a</italic> × <italic>a</italic> sized pixels in the ROI with pixel coordinates (<italic>x</italic><sub><italic>k</italic></sub>, <italic>y</italic><sub><italic>k</italic></sub>) are used to compute the four phasor components: <disp-formula id="FD2"><label>(1)</label><mml:math id="M5"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle></mml:mrow><mml:mi>k</mml:mi></mml:munder><mml:msub><mml:mi>n</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mspace width="0.2em"/><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mi>K</mml:mi></mml:mfrac><mml:mfrac><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mi>a</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD3"><label>(2)</label><mml:math id="M6"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle></mml:mrow><mml:mi>k</mml:mi></mml:munder><mml:msub><mml:mi>n</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mspace width="0.2em"/><mml:mtext>sin</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mi>K</mml:mi></mml:mfrac><mml:mfrac><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mi>a</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD4"><label>(3)</label><mml:math id="M7"><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle></mml:mrow><mml:mi>k</mml:mi></mml:munder><mml:msub><mml:mi>n</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mspace width="0.2em"/><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mi>K</mml:mi></mml:mfrac><mml:mfrac><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mi>a</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD5"><label>(4)</label><mml:math id="M8"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle></mml:mrow><mml:mi>k</mml:mi></mml:munder><mml:msub><mml:mi>n</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mspace width="0.2em"/><mml:mtext>sin</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mi>K</mml:mi></mml:mfrac><mml:mfrac><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mi>a</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> after which we find the emitter position as: <disp-formula id="FD6"><label>(5)</label><mml:math id="M9"><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>K</mml:mi><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mtext>tan</mml:mtext></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD7"><label>(6)</label><mml:math id="M10"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>K</mml:mi><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow></mml:mfrac><mml:msup><mml:mrow><mml:mtext>tan</mml:mtext></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P19">Next, a first estimate is made of the constant background photon count per pixel <inline-formula><mml:math id="M11"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> by taking the median of pixels at the rim of the ROI, and a first estimate is made for the signal photon count by <inline-formula><mml:math id="M12"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mstyle displaystyle="true"><mml:mtext>Σ</mml:mtext></mml:mstyle><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>n</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msup><mml:mi>K</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>. In case of 3D astigmatic fitting an initial estimate of the axial coordinate is found via computing the phasor magnitudes [<xref ref-type="bibr" rid="R22">Martens2018</xref>]: <disp-formula id="FD8"><label>(7)</label><mml:math id="M13"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:msup><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:msqrt><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula><disp-formula id="FD9"><label>(8)</label><mml:math id="M14"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>y</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:msqrt><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> and subsequently fitting two parabolas according to [Rieger2014]: <disp-formula id="FD10"><label>(9)</label><mml:math id="M15"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>±</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mi>d</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>A</italic><sub>0</sub> is an overall constant measuring spot width, <inline-formula><mml:math id="M16"><mml:mrow><mml:mi>d</mml:mi><mml:mo>=</mml:mo><mml:mi>λ</mml:mi><mml:mo>/</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:msqrt><mml:mrow><mml:msup><mml:mi>n</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>−</mml:mo><mml:mi>N</mml:mi><mml:msup><mml:mi>A</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msqrt></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the depth of focus and <inline-formula><mml:math id="M17"><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>n</mml:mi><mml:mi>λ</mml:mi><mml:mo>/</mml:mo><mml:mi>N</mml:mi><mml:msup><mml:mi>A</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msqrt><mml:mn>8</mml:mn></mml:msqrt><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mn>22</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> is half the distance between the two focal lines. Solving for the axial position gives: <disp-formula id="FD11"><label>(10)</label><mml:math id="M18"><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mi>l</mml:mi><mml:mfrac><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mi>d</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>/</mml:mo><mml:msup><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>Δ</mml:mo><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msqrt><mml:mrow><mml:msup><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mi>c</mml:mi></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>−</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msup><mml:mi>d</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>/</mml:mo><mml:msup><mml:mi>l</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>Δ</mml:mo><mml:msup><mml:mi>A</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:msqrt></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> with <italic>A</italic><sub><italic>c</italic></sub> = <italic>A</italic><sub><italic>xx</italic></sub> + <italic>A</italic><sub><italic>yy</italic></sub> and Δ<italic>A</italic> = <italic>A</italic><sub><italic>yy</italic></sub> − <italic>A</italic><sub><italic>xx</italic></sub>. In case the astigmatism is not vertical, we can use the more general formulas <inline-formula><mml:math id="M19"><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mi>n</mml:mi><mml:mi>λ</mml:mi><mml:mo>/</mml:mo><mml:mi>N</mml:mi><mml:msup><mml:mi>A</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msqrt><mml:mn>8</mml:mn></mml:msqrt><mml:msqrt><mml:mrow><mml:msubsup><mml:mi>A</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>A</mml:mi><mml:mrow><mml:mn>22</mml:mn></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:msqrt></mml:mrow></mml:math></inline-formula> and: <disp-formula id="FD12"><label>(11)</label><mml:math id="M20"><mml:mrow><mml:mo>Δ</mml:mo><mml:mi>A</mml:mi><mml:mo>=</mml:mo><mml:mtext>cos</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>⋅</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mtext>astig</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>y</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:mspace width="0.2em"/><mml:mtext>sin</mml:mtext><mml:mspace width="0.2em"/><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>2</mml:mn><mml:mo>⋅</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mtext>astig</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <disp-formula id="FD13"><label>(12)</label><mml:math id="M21"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>x</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle></mml:mrow><mml:mi>k</mml:mi></mml:munder><mml:msub><mml:mi>n</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mspace width="0.2em"/><mml:mtext>sin</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mi>K</mml:mi></mml:mfrac><mml:mfrac><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mi>a</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mtext>sin</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow><mml:mi>K</mml:mi></mml:mfrac><mml:mfrac><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mi>a</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> and where the astigmatism angle <italic>α</italic><sub>astig</sub> is determined by the amplitude of vertical and diagonal astigmatism: <disp-formula id="FD14"><label>(13)</label><mml:math id="M22"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mtext>astig</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msup><mml:mrow><mml:mtext>tan</mml:mtext></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mn>22</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P20">It appears that the accuracy of the initial value estimation of the axial coordinate depends on the magnitude of the astigmatism compared to size of the ROI, i.e. how well the two focal lines fit within the ROI.</p><p id="P21">The second algorithmic improvement is the use of linear regression for an improved initial estimate for signal and background photon count. To that end the vectorial PSF <italic>H</italic><sub><italic>k</italic></sub> = <italic>H</italic>(<italic>x</italic><sub><italic>k</italic></sub> − <italic>x</italic><sub>0</sub>, <italic>y</italic><sub><italic>k</italic></sub> − <italic>y</italic><sub>0</sub>) for 2D fitting or <italic>H</italic><sub><italic>k</italic></sub> = <italic>H</italic>(<italic>x</italic><sub><italic>k</italic></sub> − <italic>x</italic><sub>0</sub>, <italic>y</italic><sub><italic>k</italic></sub> − <italic>y</italic><sub>0</sub>, <italic>z</italic><sub>0</sub>) for 3D fitting is computed (see for details below) at all pixel positions in the ROI. The improved initial values for signal photon count <italic>N</italic><sub>0</sub> and background photon count per pixel <italic>b</italic><sub>0</sub> are then found by weighted linear regression, i.e. by minimizing: <disp-formula id="FD15"><label>(14)</label><mml:math id="M23"><mml:mrow><mml:mi>E</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle></mml:mrow><mml:mi>k</mml:mi></mml:munder><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:msub><mml:mi>H</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msub><mml:msub><mml:mi>H</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p id="P22">The accuracy of the initial value estimation is such that the average number of iterations needed in the final vectorial PSF localization ranges for 2D fitting from 3.7 ± 0.6 at low photon count (500 photons) down to 1.1 ± 0.3 at high photon count (10<sup>5</sup> photons), and for 3D fitting from 7.1 ± 4.2 at low photon count (500 photons) down to 4.4 ± 0.8 at high photon count (10<sup>5</sup> photons), as determined from a simulation study (see below for details).</p><p id="P23">The third algorithmic improvement is the use of precomputation of the Optical Transfer Function (OTF) in order to reduce the number of Fourier Transformations (FTs) per iteration. The vectorial PSF for 2D-fitting can be written as: <disp-formula id="FD16"><label>(15)</label><mml:math id="M24"><mml:mrow><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>3</mml:mn></mml:munderover><mml:mspace width="0.2em"/><mml:mrow><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mi>F</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p id="P24">Where the matrix <italic>F</italic><sub><italic>jk</italic></sub> (<italic>x, y</italic>) can be expressed as the 2D FT over the objective lens pupil: <disp-formula id="FD17"><label>(16)</label><mml:math id="M25"><mml:mrow><mml:msub><mml:mi>F</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:mo>∬</mml:mo></mml:mstyle><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>W</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula> with <italic>W</italic>(<italic>q</italic><sub><italic>x</italic></sub>, <italic>q</italic><sub><italic>y</italic></sub>) the aberration function. The aberration function is computed from the NAT coefficients for the position of the center of the ROI in the FOV. Explicit expressions for the pupil matrix <italic>P</italic><sub><italic>jk</italic></sub> (<italic>q</italic><sub><italic>x</italic></sub>, <italic>q</italic><sub><italic>y</italic></sub>) can be found elsewhere [<xref ref-type="bibr" rid="R14">Stallinga2010</xref>]. The iterative optimization in the localization algorithm requires the computation of the PSF <italic>H</italic><sub><italic>k</italic></sub> = <italic>H</italic>(<italic>x</italic><sub><italic>k</italic></sub> − <italic>x</italic><sub>0</sub>, <italic>y</italic><sub><italic>k</italic></sub> − <italic>y</italic><sub>0</sub>) for all pixels in the ROI, as well as the derivatives of the PSF w.r.t. the emitter coordinates. Applying the chain rule to <xref ref-type="disp-formula" rid="FD11">eq. (10)</xref> implies that the derivatives of the matrix components <italic>F</italic><sub><italic>jk</italic></sub> (<italic>x, y</italic>) are then needed. These derivatives give extra factors 2π<italic>i</italic>(<italic>q</italic><sub><italic>x</italic></sub>, <italic>q</italic><sub><italic>y</italic></sub>) in the integrands for the FT. As a consequence, we need to evaluate 3 × 6 = 18 FTs in each iteration of the localization algorithm, which takes the bulk of the computation time. This can be improved by pre-computing the PSF using <xref ref-type="disp-formula" rid="FD2">eq. (1)</xref>, and then computing the OTF via FT: <disp-formula id="FD18"><label>(17)</label><mml:math id="M26"><mml:mrow><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:mo>∬</mml:mo></mml:mstyle><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:mi>x</mml:mi><mml:mi>d</mml:mi><mml:mi>y</mml:mi></mml:mrow></mml:math></disp-formula> and storing the OTF in memory. For each iteration of the localization algorithm, we only need to compute the PSF and the derivatives w.r.t. <italic>x</italic><sub>0</sub> and <italic>y</italic><sub>0</sub> via the evaluation of 3 inverse FTs: <disp-formula id="FD19"><label>(18)</label><mml:math id="M27"><mml:mrow><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:mo>∬</mml:mo></mml:mstyle><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula> <disp-formula id="FD20"><label>(19)</label><mml:math id="M28"><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mstyle displaystyle="true"><mml:mo>∬</mml:mo></mml:mstyle><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula> <disp-formula id="FD21"><label>(20)</label><mml:math id="M29"><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mstyle displaystyle="true"><mml:mo>∬</mml:mo></mml:mstyle><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula></p><p id="P25">We only need to compute 3 inverse FTs now, i.e. this saves a factor of 6 in number of FTs to execute and about a 2-3x improvement in computation time.</p><p id="P26">For the case of 3D fitting a similar approach can be followed. Now the matrix components <italic>F</italic><sub><italic>jk</italic></sub> depend on <italic>z</italic> as well via: <disp-formula id="FD22"><label>(21)</label><mml:math id="M30"><mml:mrow><mml:msub><mml:mi>F</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:mo>∬</mml:mo></mml:mstyle><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mi>y</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>z</mml:mi></mml:msub><mml:mi>z</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula> with the <italic>z</italic>-component of the spatial frequency vector: <disp-formula id="FD23"><label>(22)</label><mml:math id="M31"><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>z</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>e</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mi>λ</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msqrt></mml:mrow></mml:math></disp-formula> with <italic>n</italic><sub><italic>med</italic></sub> the refractive index of the medium and <italic>λ</italic> the wavelength of the fluorescence emission. Now we need to do a one-time computation of the 3D-PSF <italic>H</italic>(<italic>x, y, z</italic>), and subsequently of the 3D-OTF <italic>Ĥ</italic> (<italic>q</italic><sub><italic>x</italic></sub>, <italic>q</italic><sub><italic>y</italic></sub>, <italic>q</italic><sub><italic>z</italic></sub>) by inverse FT, and store that in memory. Note that after this inverse FT, the <italic>z</italic>-component of the spatial frequency vector is not restricted to be dependent on the two lateral components as in the integration over the objective pupil plane. For each iteration step in the localization algorithm, we compute the 2D-OTFs from the 3D-OTF: <disp-formula id="FD24"><label>(23)</label><mml:math id="M32"><mml:mrow><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:mo>∫</mml:mo></mml:mstyle><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>z</mml:mi></mml:msub><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula> <disp-formula id="FD25"><label>(24)</label><mml:math id="M33"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>z</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mstyle displaystyle="true"><mml:mo>∫</mml:mo></mml:mstyle><mml:msub><mml:mi>q</mml:mi><mml:mi>z</mml:mi></mml:msub><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>z</mml:mi></mml:msub><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>z</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula> and then the PSF and the derivatives w.r.t. all the coordinates via the 4 FTs: <disp-formula id="FD26"><label>(25)</label><mml:math id="M34"><mml:mrow><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:mo>∬</mml:mo></mml:mstyle><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula> <disp-formula id="FD27"><label>(26)</label><mml:math id="M35"><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mstyle displaystyle="true"><mml:mo>∬</mml:mo></mml:mstyle><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula> <disp-formula id="FD28"><label>(27)</label><mml:math id="M36"><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mstyle displaystyle="true"><mml:mo>∬</mml:mo></mml:mstyle><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula> <disp-formula id="FD29"><label>(28)</label><mml:math id="M37"><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mstyle displaystyle="true"><mml:mo>∬</mml:mo></mml:mstyle><mml:msub><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>z</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>q</mml:mi><mml:mi>y</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula></p><p id="P27">Full direct computation of the PSF and the 3 derivatives via computation of the matrix elements <italic>F</italic><sub><italic>jk</italic></sub> (<italic>x, y, z</italic>) and its derivatives needs 4 × 6 = 24 FTs, so that again a factor of 6 is gained in number of FTs. The sixfold reduction of the number of FTs to execute, which make up a substantial portion of the total computational costs, leads to a 2 to 3-fold improvement in the computation time for 2D and 3D CPU and 2D GPU implementations (<xref ref-type="supplementary-material" rid="SD1">Supplementary Table 1</xref>). For 3D fitting on the GPU, however, no improvement is not realized. The exact cause of this remains unclear, but maybe be debit to inefficiencies in our GPU implementation of the 3D OTF computation.</p><p id="P28">In principle, the 2D or 3D OTF needs to be pre-computed for all different ROI positions in the FOV. The Zernike aberration coefficients, however, vary slowly across the FOV. In practice therefore, it is sufficient to pre-compute the OTF for 20x20 patches in the FOV. All FTs are executed with the Chirp Z-Transform (CZT) algorithm [<xref ref-type="bibr" rid="R35">Bakx2002</xref>], which allows for a free choice of number of samples and spacing of samples in both the spatial and the Fourier domain. For direct vectorial PSF fitting we use a pupil plane sampling with 42 × 42 for the 2D data (7 × 7) ROI and 48 × 48 for the 3D data (17 × 17) ROI. In order to perform the Fourier transforms, the pupil size <italic>N</italic><sub><italic>pupil</italic></sub> is chosen such that <italic>N</italic><sub><italic>ROI</italic></sub> + <italic>N</italic><sub><italic>pupil</italic></sub> − 1 is either a power of 2, or 3 times a power of 2.</p><p id="P29">For each ROI, optimization is stopped when the growth rate of the likelihood becomes smaller than a stopping tolerance <italic>ε</italic><sub><italic>stop</italic></sub> When a ROI has not converged after a maximum number of iterations of 10 for 2D data and 20 for 3D data, this ROI is indicated as outlier and is discarded. For experimental data we use <italic>ε</italic><sub><italic>stop</italic></sub> = 5 · 10<sup>−10</sup>, because we found that larger values of <italic>ε</italic><sub><italic>stop</italic></sub> lead to a worse localization precision because the optimization is stopped too early, while for smaller values, too many ROIs are incorrectly indicated as outlier. For simulation data a larger value of <italic>ε</italic><sub><italic>stop</italic></sub> = 10<sup>−6</sup> appeared to be sufficient because with this the CRLB is already reached.</p></sec><sec id="S3"><title>Simulation setup</title><p id="P30">To determine the fitting speed of the vectorial PSF (<xref ref-type="supplementary-material" rid="SD1">Supplementary Table 1</xref>), a total of 1 million emitters were simulated using the vectorial PSF model with 2,500 photons and 10 background photons per pixel using Poisson statistics to generate noisy instances of computed single molecule spots. The wavelength was 550 nm, the numerical aperture 1.33 and the pixel size was set to <italic>λ</italic>/(4 · <italic>NA</italic>). For 2D fitting, the ROIs were fitted in batches 500,000 on a Nvidia A100 GPU, and in batches of 60,000 on other devices. The sizes for the ROIs, pupil, OTF, and the PSF for calculating the OTF were 7 × 7, 42 × 42, 42 × 42, and 129 × 129 pixels, respectively. For 3D fitting, the ROIs were fitted in batches of 20,000, and the used sizes for the ROI, pupil, OTF, and the PSF for calculating the OTF were 17 × 17, 48 × 48, 48 × 48 × 40, and 129 × 129 × 71 pixels, respectively. The simulated lateral location was randomly chosen in the central 2 × 2 pixels of the ROI. For the 3D fitting, 150 mλ of astigmatism was used in both the forward and the fitting PSF model, and the simulated axial location was randomly chosen between -500 and 500 nm. The maximum number of iterations was set to 5 for 2D fitting and 10 for 3D fitting. The computations on the Nvidia A100 GPU were performed using the DelftBlue supercomputer [<xref ref-type="bibr" rid="R40">DHPC 2024</xref>]. To determine the number of iterations for different photon counts as described in the processing pipeline above, the average number of iterations was computed from localizing 10,000 emitters that were simulated using the vectorial PSF model with 500 and 100,000 photons. The ROI size for the 2D fitting was 9 × 9 with a pupil size of 40 × 40 and for 3D fitting the ROI size was 17 × 17 with a pupil size of 48 × 48 pixels. The other parameters were the same as described above.</p></sec><sec id="S4"><title>Post-processing</title><p id="P31">Sample drift was corrected on the localization data following the method of Cnossen et al. [Cnossen2021]. All images are rendered by histogram binning on a grid with super-resolution pixel size set to half the average CRLB of the localization precision, with additional Gaussian blurring with kernel size (standard deviation) equal to 2 super-resolution pixels.</p><p id="P32">For calculating the localization precision by linking of nearby localizations in subsequent frames, first the localization events with an estimated photon count between 500 and 10000 and an estimated precision (CRLB) below 60 nm (<italic>xy</italic>) and 120 nm (<italic>z</italic>) were selected. Histograms of these parameters show that only a few extreme outlier events are filtered in this way. Localizations in subsequent frames closer than 60 nm (<italic>xy</italic>) and 120 nm (<italic>z</italic>), and closer than 2× the smallest estimated precision (CRLB) of the events in all 2 or 3 spatial directions were considered to originate from a single on-event. The unbiased variance over the total run length of linked localizations is considered as the measure for the experimental localization precision. This method can induce a bias for small run lengths, especially if one of the linked localizations is of low quality (e.g. the first or last event where the molecule may be on for only a part of the frame time). For that reason only longer on-events are used in the statistical evaluation (5 ≤ run length ≤ 13).</p><p id="P33">Experimental PSF data (<xref ref-type="supplementary-material" rid="SD1">Supplementary Video 1</xref>) was assembled by binning the localization events over 4×4 patches over the FOV and over 45 bins in the axial direction. The acquired spots for the different ROIs in each bin were 5× upsampled using Fourier space zero padding, centered at the estimated (<italic>x</italic><sub>0</sub>, <italic>y</italic><sub>0</sub>) position and finally summed.</p></sec><sec id="S5"><title>Sample preparation</title><p id="P34">To acquire the data of <xref ref-type="fig" rid="F2">Figure 2</xref>, HeLa cells were plated on 25 mm coverslips in 6-well plate (Warner instruments) and allowed to adhere overnight (12-16 hours). First, cells were briefly washed with warm 1xPBS and then fixed using a solution containing 0.6% paraformaldehyde, 0.1% glutaraldehyde, and 0.25% Triton, all diluted in PBS for 60 seconds. This was followed by a secondary fixation using a buffer made up of 4% paraformaldehyde and 0.2% glutaraldehyde diluted in PBS for two hours. The cells were then washed twice with PBS, treated with 0.1% NaBH<sub>4</sub> for 5 minutes to minimize background fluorescence due to glutaraldehyde, and further washed twice with PBS. To quench any reactive cross-linkers, the samples were incubated in 10 mM Tris for 10 minutes, followed by one PBS wash. Finally, the samples were permeabilized through a 20 minutes incubation in a solution containing 5% BSA and 0.05% Triton X-100 diluted in PBS. At the end, the samples were washed once with PBS and prepared for the labeling procedure. Cells were incubated with 15 µg/ml in volume of 350 uL of Monoclonal Anti-β-Tubulin, Mouse IgG clone AA2 (Sigma #T8328, concentration: 2mg/ml) in 2% BSA + 0.05% Triton X-100 for 5 hours. Then cells were washed once with Massive Photonics DNA-PAINT washing buffer (1×). For secondary antibody labeling, cells were incubated with 15 µg/ml in volume of 350 uL per coverslip of DBCO-DAMIG-DNA Dock-2 (Acronym of DAMIG: Donkey anti-mouse IgG) secondary antibodies (stock concentration is 500 µg/ml) in 2% BSA + 0.05% Triton X-100 for 12 hours. This is followed by 3 times wash with Massive Photonics DNA-PAINT washing buffer (1×). Before imaging, cells were washed once with Massive Photonics imaging buffer. The cell sample was placed in an Attofluor chamber then Atto655 imager-2 strands at concentration of 10 pM diluted in Massive Photonics imaging buffer was added for DNA-PAINT imaging.</p></sec><sec id="S6"><title>Data acquisition</title><p id="P35">To acquire the data of <xref ref-type="fig" rid="F2">Figure 2</xref>, the sample was mounted on a stage of a custom-built sequential microscope [<xref ref-type="bibr" rid="R37">Schodt2023</xref>] controlled by custom-written software (<ext-link ext-link-type="uri" xlink:href="http://github.com/LidkeLab/matlab-instrument-control">github.com/LidkeLab/matlab-instrument-control</ext-link>) in MATLAB (MathWorks Inc.) [<xref ref-type="bibr" rid="R38">Pallikkuth2018</xref>]. A high-power 647 nm laser (2RU-VFL-P-500-647-B1R, MPB Communications) was used as an excitation laser. A 100X silicon oil immersion objective (UPLSAPO100XS, Olympus) was used to collect emitted fluorescent light. A 708/75 nm bandpass filter (FF01-708/75-25-D, Semrock) was placed in the emitted fluorescence light path. A 4f relay system consisting of 175 mm and 125 mm focal lengths lenses was set up in the emission path. To acquire the 3D data, we have set up two cylindrical lenses at the Fourier plane of focal lengths 1 m and -1 m respectively, for introducing astigmatism. The sCMOS camera (C11440-22CU, Hamamatsu) was used to detect emitted fluorescence light. At first, brightfield reference image was taken using 660 nm LED (M660L3, Thorlabs) illumination lamp and saved. During data acquisition, 100 sequences of 800 frames (a total of 80,000) were collected at 10 Hz. The saved brightfield reference image was used to realign each cell after every 4<sup>th</sup> sequence of imaging [<xref ref-type="bibr" rid="R39">Wester2021</xref>]. The experimental settings for the 2D data are identical to those used for the 3D data, except that the pair of cylindrical lenses is removed.</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary Materials</label><media xlink:href="EMS201947-supplement-Supplementary_Materials.pdf" mimetype="application" mime-subtype="pdf" id="d110aAcObB" position="anchor"/></supplementary-material></sec></body><back><ack id="S7"><title>Acknowledgements</title><p>We thank Yutong Wang for assistance with experiments and Sheng Liu for helping with instrument modification. S.S. acknowledges funding from European Research Council (101055013) and B.R. from Nederlandse Organisatie voor Wetenschappelijk Onderzoek (17046) and from the eScience Center (NLESC.SSI.2021b.001). K.A.L and S.K. were supported by NIH grant 1R01GM140284.</p></ack><sec id="S8" sec-type="data-availability"><title>Data and code availability</title><p id="P36">Code and a software demo are available at <ext-link ext-link-type="uri" xlink:href="https://gitlab.tudelft.nl/imphys/ci/vectorfit">https://gitlab.tudelft.nl/imphys/ci/vectorfit</ext-link>.</p></sec><fn-group><fn fn-type="con" id="FN1"><p id="P37"><bold>Author contributions</bold></p><p id="P38">I.D. developed the analysis model and analysed all datasets, E.S., S.H. and B.v.W. developed GPU code, S.K. and K.A.L. performed imaging of biological samples. S.S. and B.R. devised key concepts and supervised the study. S.S., B.R. and I.D. wrote the paper. All authors read and approved the manuscript.</p></fn></fn-group><ref-list><ref id="R1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Betzig</surname><given-names>E</given-names></name><name><surname>Patterson</surname><given-names>GH</given-names></name><name><surname>Sougrat</surname><given-names>R</given-names></name><name><surname>Lindwasser</surname><given-names>OW</given-names></name><name><surname>Olenych</surname><given-names>S</given-names></name><name><surname>Bonifacino</surname><given-names>JS</given-names></name><name><surname>Davidson</surname><given-names>MW</given-names></name><name><surname>Lippincott-Schwartz</surname><given-names>J</given-names></name><name><surname>Hess</surname><given-names>HF</given-names></name></person-group><article-title>Imaging Intracellular Fluorescent Proteins at Nanometer Resolution</article-title><source>Science</source><year>2006</year><volume>313</volume><fpage>1642</fpage><lpage>1645</lpage><pub-id pub-id-type="pmid">16902090</pub-id></element-citation></ref><ref id="R2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heilemann</surname><given-names>M</given-names></name><name><surname>van de Linde</surname><given-names>S</given-names></name><name><surname>Schüttpelz</surname><given-names>M</given-names></name><name><surname>Kasper</surname><given-names>R</given-names></name><name><surname>Seefeldt</surname><given-names>B</given-names></name><name><surname>Mukherjee</surname><given-names>A</given-names></name><name><surname>Tinnefeld</surname><given-names>P</given-names></name><name><surname>Sauer</surname><given-names>M</given-names></name></person-group><article-title>Subdiffraction-resolution fluorescence imaging with conventional fluorescent probes</article-title><source>Angewandte Chemie</source><year>2008</year><volume>47</volume><issue>33</issue><fpage>6172</fpage><lpage>6176</lpage><pub-id pub-id-type="pmid">18646237</pub-id></element-citation></ref><ref id="R3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sharonov</surname></name><name><surname>Hochstrasser</surname><given-names>RM</given-names></name></person-group><article-title>Wide-field subdiffraction imaging by accumulated binding of diffusing probes</article-title><source>Proceedings of the National Academy of Science USA</source><year>2006</year><volume>103</volume><issue>50</issue><fpage>18911</fpage><lpage>18916</lpage><pub-id pub-id-type="pmcid">PMC1748151</pub-id><pub-id pub-id-type="pmid">17142314</pub-id><pub-id pub-id-type="doi">10.1073/pnas.0609643104</pub-id></element-citation></ref><ref id="R4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rust</surname><given-names>MJ</given-names></name><name><surname>Bates</surname><given-names>M</given-names></name><name><surname>Zhuang</surname><given-names>X</given-names></name></person-group><article-title>Sub-diffraction-limit imaging by stochastic optical reconstruction microscopy (STORM)</article-title><source>Nature Methods</source><year>2006</year><volume>3</volume><issue>10</issue><fpage>793</fpage><lpage>795</lpage><pub-id pub-id-type="pmcid">PMC2700296</pub-id><pub-id pub-id-type="pmid">16896339</pub-id><pub-id pub-id-type="doi">10.1038/nmeth929</pub-id></element-citation></ref><ref id="R5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Douglass</surname><given-names>KM</given-names></name><name><surname>Sieben</surname><given-names>CM</given-names></name><name><surname>Archetti</surname><given-names>A</given-names></name><name><surname>Lambert</surname><given-names>A</given-names></name><name><surname>Manley</surname><given-names>S</given-names></name></person-group><article-title>Super-resolution imaging of multiple cells by optimized flat-field epi-illumination</article-title><source>Nature Photonics</source><year>2016</year><volume>10</volume><fpage>705</fpage><lpage>710</lpage><pub-id pub-id-type="pmcid">PMC5089541</pub-id><pub-id pub-id-type="pmid">27818707</pub-id><pub-id pub-id-type="doi">10.1038/nphoton.2016.200</pub-id></element-citation></ref><ref id="R6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Deschamps</surname><given-names>J</given-names></name><name><surname>Rowald</surname><given-names>A</given-names></name><name><surname>Ries</surname><given-names>J</given-names></name></person-group><article-title>Efficient homogeneous illumination and optical sectioning for quantitative single-molecule localization microscopy</article-title><source>Optics Express</source><year>2016</year><volume>24</volume><issue>24</issue><fpage>28080</fpage><lpage>28090</lpage><pub-id pub-id-type="pmid">27906373</pub-id></element-citation></ref><ref id="R7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Diekmann</surname><given-names>R</given-names></name><name><surname>Helle</surname><given-names>ØI</given-names></name><name><surname>Øie</surname><given-names>CI</given-names></name><name><surname>McCourt</surname><given-names>P</given-names></name><name><surname>Huser</surname><given-names>TR</given-names></name><name><surname>Schütpelz</surname><given-names>M</given-names></name><name><surname>Ahluwalia</surname><given-names>BS</given-names></name></person-group><article-title>Chip-based wide field-of-view nanoscopy</article-title><source>Nature Photonics</source><year>2017</year><volume>11</volume><fpage>322</fpage><lpage>328</lpage></element-citation></ref><ref id="R8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Archetti</surname><given-names>A</given-names></name><name><surname>Glushkov</surname><given-names>E</given-names></name><name><surname>Sieben</surname><given-names>C</given-names></name><name><surname>Stronganov</surname><given-names>A</given-names></name><name><surname>Radenovic</surname><given-names>A</given-names></name><name><surname>Manley</surname><given-names>S</given-names></name></person-group><article-title>Waveguide-PAINT offers an open platform for large field-of-view super-resolution imaging</article-title><source>Nature Communications</source><year>2019</year><volume>10</volume><elocation-id>1267</elocation-id><pub-id pub-id-type="pmcid">PMC6427008</pub-id><pub-id pub-id-type="pmid">30894525</pub-id><pub-id pub-id-type="doi">10.1038/s41467-019-09247-1</pub-id></element-citation></ref><ref id="R9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mau</surname><given-names>A</given-names></name><name><surname>Friedl</surname><given-names>K</given-names></name><name><surname>Leterrier</surname><given-names>C</given-names></name><name><surname>Bourg</surname><given-names>N</given-names></name><name><surname>Lévêque-Fort</surname><given-names>S</given-names></name></person-group><article-title>Fast widefield scan provides tunable and uniform illumination optimizing super-resolution microscopy on large fields</article-title><source>Nature Communications</source><year>2021</year><volume>12</volume><elocation-id>3077</elocation-id><pub-id pub-id-type="pmcid">PMC8144377</pub-id><pub-id pub-id-type="pmid">34031402</pub-id><pub-id pub-id-type="doi">10.1038/s41467-021-23405-4</pub-id></element-citation></ref><ref id="R10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>Q</given-names></name><name><surname>Hulleman</surname><given-names>CN</given-names></name><name><surname>Moerland</surname><given-names>RJ</given-names></name><name><surname>Mailvaganam</surname><given-names>E</given-names></name><name><surname>Ganapathy</surname><given-names>S</given-names></name><name><surname>Brinks</surname><given-names>D</given-names></name><name><surname>Stallinga</surname><given-names>S</given-names></name><name><surname>Rieger</surname><given-names>B</given-names></name></person-group><article-title>Waveguide-based total internal reflection fluorescence microscope enabling cellular imaging under cryogenic conditions</article-title><source>Optics Express</source><year>2021</year><volume>29</volume><issue>21</issue><fpage>34097</fpage><lpage>34108</lpage><pub-id pub-id-type="pmid">34809207</pub-id></element-citation></ref><ref id="R11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ma</surname><given-names>H</given-names></name><name><surname>Chen</surname><given-names>M</given-names></name><name><surname>Nguyen</surname><given-names>P</given-names></name><name><surname>Liu</surname><given-names>Y</given-names></name></person-group><article-title>Toward drift-free high-throughput nanoscopy through adaptive intersection maximization</article-title><source>Science Advances</source><year>2024</year><volume>10</volume><issue>21</issue><elocation-id>eadm7765</elocation-id><pub-id pub-id-type="pmcid">PMC11114195</pub-id><pub-id pub-id-type="pmid">38781327</pub-id><pub-id pub-id-type="doi">10.1126/sciadv.adm7765</pub-id></element-citation></ref><ref id="R12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nelson</surname><given-names>T</given-names></name><name><surname>Vargas-Hernández</surname><given-names>S</given-names></name><name><surname>Freire</surname><given-names>M</given-names></name><name><surname>Cheng</surname><given-names>S</given-names></name><name><surname>Gustavsson</surname><given-names>A</given-names></name></person-group><article-title>Multimodal illumination platform for 3D single-molecule super-resolution imaging throughout mammalian cells</article-title><source>Biomedical Optics Express</source><year>2024</year><volume>15</volume><fpage>3050</fpage><lpage>3063</lpage><pub-id pub-id-type="pmcid">PMC11161355</pub-id><pub-id pub-id-type="pmid">38855669</pub-id><pub-id pub-id-type="doi">10.1364/BOE.521362</pub-id></element-citation></ref><ref id="R13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Thorsen</surname><given-names>RØ</given-names></name><name><surname>Hulleman</surname><given-names>CN</given-names></name><name><surname>Hammer</surname><given-names>M</given-names></name><name><surname>Grünwald</surname><given-names>D</given-names></name><name><surname>Stallinga</surname><given-names>S</given-names></name><name><surname>Rieger</surname><given-names>B</given-names></name></person-group><article-title>Impact of optical aberrations on axial position determination by photometry</article-title><source>Nature Methods</source><year>2018</year><volume>15</volume><fpage>989</fpage><lpage>993</lpage><pub-id pub-id-type="pmcid">PMC6588158</pub-id><pub-id pub-id-type="pmid">30504865</pub-id><pub-id pub-id-type="doi">10.1038/s41592-018-0227-4</pub-id></element-citation></ref><ref id="R14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stallinga</surname><given-names>S</given-names></name><name><surname>Rieger</surname><given-names>B</given-names></name></person-group><article-title>Accuracy of the Gaussian point spread function model in 2D localization microscopy</article-title><source>Optics Express</source><year>2010</year><volume>18</volume><issue>24</issue><fpage>24461</fpage><lpage>24476</lpage><pub-id pub-id-type="pmid">21164793</pub-id></element-citation></ref><ref id="R15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smith</surname><given-names>CS</given-names></name><name><surname>Joseph</surname><given-names>N</given-names></name><name><surname>Rieger</surname><given-names>B</given-names></name><name><surname>Lidke</surname><given-names>KA</given-names></name></person-group><article-title>Fast, single-molecule localization that achieves theoretically minimum uncertainty</article-title><source>Nature Methods</source><year>2010</year><volume>7</volume><issue>5</issue><fpage>373</fpage><lpage>375</lpage><pub-id pub-id-type="pmcid">PMC2862147</pub-id><pub-id pub-id-type="pmid">20364146</pub-id><pub-id pub-id-type="doi">10.1038/nmeth.1449</pub-id></element-citation></ref><ref id="R16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>Y</given-names></name><name><surname>Mund</surname><given-names>M</given-names></name><name><surname>Hoess</surname><given-names>P</given-names></name><name><surname>Deschamps</surname><given-names>J</given-names></name><name><surname>Matti</surname><given-names>U</given-names></name><name><surname>Nijmeijer</surname><given-names>B</given-names></name><name><surname>Jimenez Sabinian</surname><given-names>V</given-names></name><name><surname>Ellenberg</surname><given-names>J</given-names></name><name><surname>Schön</surname><given-names>I</given-names></name><name><surname>Ries</surname><given-names>J</given-names></name></person-group><article-title>Real-time 3D single molecule localization using experimental point spread functions</article-title><source>Nature Methods</source><year>2018</year><volume>15</volume><fpage>367</fpage><lpage>369</lpage><pub-id pub-id-type="pmcid">PMC6009849</pub-id><pub-id pub-id-type="pmid">29630062</pub-id><pub-id pub-id-type="doi">10.1038/nmeth.4661</pub-id></element-citation></ref><ref id="R17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hulleman</surname><given-names>CN</given-names></name><name><surname>Thorsen</surname><given-names>RØ</given-names></name><name><surname>Kim</surname><given-names>E</given-names></name><name><surname>Dekker</surname><given-names>C</given-names></name><name><surname>Stallinga</surname><given-names>S</given-names></name><name><surname>Rieger</surname><given-names>B</given-names></name></person-group><article-title>Simultaneous orientation and 3D localization microscopy with a Vortex point spread function</article-title><source>Nature Communications</source><year>2021</year><volume>12</volume><elocation-id>5934</elocation-id><pub-id pub-id-type="pmcid">PMC8505439</pub-id><pub-id pub-id-type="pmid">34635658</pub-id><pub-id pub-id-type="doi">10.1038/s41467-021-26228-5</pub-id></element-citation></ref><ref id="R18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Siemons</surname><given-names>M</given-names></name><name><surname>Hulleman</surname><given-names>CN</given-names></name><name><surname>Thorsen</surname><given-names>RØ</given-names></name><name><surname>Smith</surname><given-names>CS</given-names></name><name><surname>Stallinga</surname><given-names>S</given-names></name></person-group><article-title>High precision wavefront control in point spread function engineering for single emitter localization</article-title><source>Optics Express</source><year>2018</year><volume>26</volume><fpage>8397</fpage><lpage>8416</lpage><pub-id pub-id-type="pmid">29715807</pub-id></element-citation></ref><ref id="R19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fu</surname><given-names>S</given-names></name><name><surname>Shi</surname><given-names>W</given-names></name><name><surname>Luo</surname><given-names>T</given-names></name><name><surname>He</surname><given-names>Y</given-names></name><name><surname>Zhou</surname><given-names>L</given-names></name><name><surname>Yang</surname><given-names>J</given-names></name><name><surname>Yang</surname><given-names>Z</given-names></name><name><surname>Liu</surname><given-names>J</given-names></name><name><surname>Liu</surname><given-names>X</given-names></name><name><surname>Guo</surname><given-names>Z</given-names></name><name><surname>Yang</surname><given-names>C</given-names></name><etal/></person-group><article-title>Field-dependent deep learning enables high-throughput whole-cell 3D super-resolution imaging</article-title><source>Nature Methods</source><year>2023</year><volume>20</volume><fpage>459</fpage><lpage>468</lpage><pub-id pub-id-type="pmid">36823335</pub-id></element-citation></ref><ref id="R20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>M</given-names></name><name><surname>Shi</surname><given-names>W</given-names></name><name><surname>Liu</surname><given-names>S</given-names></name><name><surname>Fu</surname><given-names>S</given-names></name><name><surname>Fei</surname><given-names>Y</given-names></name><name><surname>Zhou</surname><given-names>L</given-names></name><name><surname>Fang</surname><given-names>K</given-names></name><name><surname>Li</surname><given-names>Y</given-names></name></person-group><article-title>Fast and universal single-molecule localization using multi-dimensional point spread functions</article-title><source>Optics Express</source><year>2024</year><volume>32</volume><fpage>42601</fpage><lpage>42615</lpage></element-citation></ref><ref id="R21"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Shack</surname><given-names>RV</given-names></name><name><surname>Thompson</surname><given-names>K</given-names></name></person-group><chapter-title>Influence of alignment errors of a telescope system on its aberration field</chapter-title><source>Optical Alignment I</source><year>1980</year><volume>0251</volume><fpage>146</fpage><lpage>153</lpage><publisher-name>International Society for Optics and Photonics</publisher-name><comment>SPIE</comment></element-citation></ref><ref id="R22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Martens</surname><given-names>K</given-names></name><name><surname>Bader</surname><given-names>AN</given-names></name><name><surname>Baas</surname><given-names>S</given-names></name><name><surname>Rieger</surname><given-names>B</given-names></name><name><surname>Hohlbein</surname><given-names>J</given-names></name></person-group><article-title>Phasor based single-molecule localization microscopy in 3D (pSMLM-3D): an algorithm for MHz localization rates using standard CPUs</article-title><source>Journal of Chemical Physics</source><year>2018</year><volume>148</volume><elocation-id>123311</elocation-id><pub-id pub-id-type="pmid">29604874</pub-id></element-citation></ref><ref id="R23"><element-citation publication-type="web"><collab>[Picasso]</collab><comment><ext-link ext-link-type="uri" xlink:href="https://github.com/jungmannlab/picasso">https://github.com/jungmannlab/picasso</ext-link></comment></element-citation></ref><ref id="R24"><element-citation publication-type="web"><collab>[SMAP]</collab><comment><ext-link ext-link-type="uri" xlink:href="https://github.com/jries/SMAP">https://github.com/jries/SMAP</ext-link></comment></element-citation></ref><ref id="R25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cnossen</surname><given-names>J</given-names></name><name><surname>Hinsdale</surname><given-names>T</given-names></name><name><surname>Thorsen</surname><given-names>RØ</given-names></name><name><surname>Siemons</surname><given-names>M</given-names></name><name><surname>Schueder</surname><given-names>F</given-names></name><name><surname>Jungmann</surname><given-names>R</given-names></name><name><surname>Smith</surname><given-names>CS</given-names></name><name><surname>Rieger</surname><given-names>B</given-names></name><name><surname>Stallinga</surname><given-names>S</given-names></name></person-group><article-title>Localization microscopy at doubled precision with patterned illumination</article-title><source>Nature Methods</source><year>2020</year><volume>17</volume><fpage>59</fpage><lpage>63</lpage><pub-id pub-id-type="pmcid">PMC6989044</pub-id><pub-id pub-id-type="pmid">31819263</pub-id><pub-id pub-id-type="doi">10.1038/s41592-019-0657-7</pub-id></element-citation></ref><ref id="R26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nieuwenhuizen</surname><given-names>RPJ</given-names></name><name><surname>Lidke</surname><given-names>KA</given-names></name><name><surname>Bates</surname><given-names>M</given-names></name><name><surname>Puig</surname><given-names>DL</given-names></name><name><surname>Grünwald</surname><given-names>D</given-names></name><name><surname>Stallinga</surname><given-names>S</given-names></name><name><surname>Rieger</surname><given-names>B</given-names></name></person-group><article-title>Measuring image resolution in optical nanoscopy</article-title><source>Nature Methods</source><year>2013</year><volume>10</volume><fpage>557</fpage><lpage>562</lpage><pub-id pub-id-type="pmcid">PMC4149789</pub-id><pub-id pub-id-type="pmid">23624665</pub-id><pub-id pub-id-type="doi">10.1038/nmeth.2448</pub-id></element-citation></ref><ref id="R27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>W</given-names></name><name><surname>Jakobi</surname><given-names>A</given-names></name><name><surname>Wu</surname><given-names>Y-L</given-names></name><name><surname>Ries</surname><given-names>J</given-names></name><name><surname>Stallinga</surname><given-names>S</given-names></name><name><surname>Rieger</surname><given-names>B</given-names></name></person-group><article-title>Particle fusion of super-resolution data reveals the unit structure of Nup96 in nuclear pore complex</article-title><source>Scientific Reports</source><year>2023</year><volume>13</volume><elocation-id>13327</elocation-id><pub-id pub-id-type="pmcid">PMC10432550</pub-id><pub-id pub-id-type="pmid">37587192</pub-id><pub-id pub-id-type="doi">10.1038/s41598-023-39829-5</pub-id></element-citation></ref><ref id="R28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Thevasthasan</surname><given-names>JV</given-names></name><name><surname>Kahnwald</surname><given-names>M</given-names></name><name><surname>Cieslinski</surname><given-names>K</given-names></name><name><surname>Hoess</surname><given-names>P</given-names></name><name><surname>Kumar Penetie</surname><given-names>S</given-names></name><name><surname>Reitberger</surname><given-names>M</given-names></name><name><surname>Heid</surname><given-names>D</given-names></name><name><surname>Chitanaya Kasuba</surname><given-names>K</given-names></name><name><surname>Janice Hoerner</surname><given-names>S</given-names></name><name><surname>Li</surname><given-names>Y</given-names></name><name><surname>Wu</surname><given-names>Y-L</given-names></name><etal/></person-group><article-title>Nuclear pores as versatile reference standards for quantitative superresolution microscopy</article-title><source>Nature Methods</source><year>2019</year><volume>16</volume><fpage>1045</fpage><lpage>1053</lpage><pub-id pub-id-type="pmcid">PMC6768092</pub-id><pub-id pub-id-type="pmid">31562488</pub-id><pub-id pub-id-type="doi">10.1038/s41592-019-0574-9</pub-id></element-citation></ref><ref id="R29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xu</surname><given-names>F</given-names></name><name><surname>Ma</surname><given-names>D</given-names></name><name><surname>MacPherson</surname><given-names>KP</given-names></name><etal/></person-group><article-title>Three-dimensional nanoscopy of whole cells and tissues with in situ point spread function retrieval</article-title><source>Nature Methods</source><year>2020</year><volume>17</volume><fpage>531</fpage><lpage>540</lpage><pub-id pub-id-type="pmcid">PMC7289454</pub-id><pub-id pub-id-type="pmid">32371980</pub-id><pub-id pub-id-type="doi">10.1038/s41592-020-0816-x</pub-id></element-citation></ref><ref id="R30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>S</given-names></name><name><surname>Chen</surname><given-names>J</given-names></name><name><surname>Hellgoth</surname><given-names>J</given-names></name><etal/></person-group><article-title>Universal inverse modeling of point spread functions for SMLM localization and microscope characterization</article-title><source>Nature Methods</source><year>2024</year><volume>21</volume><fpage>1082</fpage><lpage>1093</lpage><pub-id pub-id-type="pmid">38831208</pub-id></element-citation></ref><ref id="R31"><element-citation publication-type="web"><collab>[Vectorfit]</collab><comment><ext-link ext-link-type="uri" xlink:href="https://gitlab.tudelft.nl/imphys/ci/vectorfit">https://gitlab.tudelft.nl/imphys/ci/vectorfit</ext-link></comment></element-citation></ref><ref id="R32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Radmacher</surname><given-names>N</given-names></name><name><surname>Nevskyi</surname><given-names>O</given-names></name><name><surname>Ignacio Gallea</surname><given-names>J</given-names></name><name><surname>Thiele</surname><given-names>JC</given-names></name><name><surname>Gregor</surname><given-names>I</given-names></name><name><surname>Rizzoli</surname><given-names>SO</given-names></name><name><surname>Enderlein</surname><given-names>J</given-names></name></person-group><article-title>Doubling the resolution of fluorescence-lifetime single-molecule localization microscopy with image scanning microscopy</article-title><source>Nature Photonics</source><year>2024</year><volume>18</volume><issue>10</issue><fpage>1059</fpage><lpage>1066</lpage></element-citation></ref><ref id="R33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Martens</surname><given-names>KJA</given-names></name><name><surname>Bader</surname><given-names>AN</given-names></name><name><surname>Baas</surname><given-names>S</given-names></name><name><surname>Rieger</surname><given-names>B</given-names></name><name><surname>Hohlbein</surname><given-names>J</given-names></name></person-group><article-title>Phasor based single-molecule localization microscopy in 3D (pSMLM-3D): an algorithm for MHz localization rates using standard CPUs</article-title><source>Journal of Chemical Physics</source><year>2018</year><volume>148</volume><elocation-id>123311</elocation-id></element-citation></ref><ref id="R34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stallinga</surname><given-names>S</given-names></name><name><surname>Rieger</surname><given-names>B</given-names></name></person-group><article-title>Accuracy of the Gaussian point spread function model in 2D localization microscopy</article-title><source>Optics Express</source><year>2010</year><volume>18</volume><issue>24</issue><fpage>24461</fpage><lpage>24476</lpage></element-citation></ref><ref id="R35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bakx</surname><given-names>JL</given-names></name></person-group><article-title>Efficient computation of optical disk readout by use of the chirp z transform</article-title><source>Applied Optics</source><year>2002</year><volume>41</volume><fpage>4879</fpage><lpage>4903</lpage><pub-id pub-id-type="pmid">12197659</pub-id></element-citation></ref><ref id="R36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cnossen</surname><given-names>J</given-names></name><name><surname>Ju Cui</surname><given-names>T</given-names></name><name><surname>Joo</surname><given-names>C</given-names></name><name><surname>Smith</surname><given-names>CS</given-names></name></person-group><article-title>Drift correction in localization microscopy using entropy minimization</article-title><source>Optics Express</source><year>2021</year><volume>29</volume><issue>18</issue><fpage>27961</fpage><lpage>27974</lpage><pub-id pub-id-type="pmid">34614938</pub-id></element-citation></ref><ref id="R37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schodt</surname><given-names>DJ</given-names></name><name><surname>Farzam</surname><given-names>F</given-names></name><name><surname>Liu</surname><given-names>S</given-names></name><name><surname>Lidke</surname><given-names>KA</given-names></name></person-group><article-title>Automated multi-target super-resolution microscopy with trust regions</article-title><source>Biomedical Optics Express</source><year>2023</year><volume>14</volume><issue>1</issue><fpage>429</fpage><lpage>440</lpage><pub-id pub-id-type="pmcid">PMC9841995</pub-id><pub-id pub-id-type="pmid">36698655</pub-id><pub-id pub-id-type="doi">10.1364/BOE.477501</pub-id></element-citation></ref><ref id="R38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pallikkuth</surname><given-names>S</given-names></name><name><surname>Meddens</surname><given-names>M</given-names></name><name><surname>Fazel</surname><given-names>M</given-names></name><name><surname>Farsibaf</surname><given-names>H</given-names></name><name><surname>Farzam</surname><given-names>F</given-names></name><name><surname>Wester</surname><given-names>M</given-names></name><name><surname>Lidke</surname><given-names>K</given-names></name></person-group><article-title>A Matlab-based instrument control package for fluorescence imaging</article-title><source>Biophysical Journal</source><year>2018</year><volume>114</volume><fpage>532a</fpage></element-citation></ref><ref id="R39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wester</surname><given-names>MJ</given-names></name><name><surname>Schodt</surname><given-names>DJ</given-names></name><name><surname>Mazloom-Farsibaf</surname><given-names>H</given-names></name><name><surname>Fazel</surname><given-names>M</given-names></name><name><surname>Pallikkuth</surname><given-names>S</given-names></name><name><surname>Lidke</surname><given-names>KA</given-names></name></person-group><article-title>Robust, fiducial-free drift correction for super-resolution imaging</article-title><source>Scientific reports</source><year>2021</year><volume>11</volume><elocation-id>23672</elocation-id><pub-id pub-id-type="pmcid">PMC8655078</pub-id><pub-id pub-id-type="pmid">34880301</pub-id><pub-id pub-id-type="doi">10.1038/s41598-021-02850-7</pub-id></element-citation></ref><ref id="R40"><element-citation publication-type="web"><collab>Delft High Performance Computing Centre (DHPC)</collab><source>DelftBlue Supercomputer (Phase 2)</source><year>2024</year><comment><ext-link ext-link-type="uri" xlink:href="https://www.tudelft.nl/dhpc/ark:/44463/DelftBluePhase2">https://www.tudelft.nl/dhpc/ark:/44463/DelftBluePhase2</ext-link></comment></element-citation></ref><ref id="R41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shack</surname><given-names>RV</given-names></name><name><surname>Thompson</surname><given-names>K</given-names></name></person-group><article-title>Influence of alignment errors of a telescope system on its aberration field</article-title><source>Proc SPIE</source><year>1980</year><volume>251</volume><fpage>146</fpage><lpage>153</lpage></element-citation></ref><ref id="R42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Thompson</surname><given-names>KP</given-names></name></person-group><article-title>Description of the third-order optical aberrations of near-circular pupil optical systems without symmetry</article-title><source>Journal Optical Society of America A</source><year>2005</year><volume>22</volume><fpage>1389</fpage><lpage>1401</lpage><pub-id pub-id-type="pmid">16053160</pub-id></element-citation></ref><ref id="R43"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Tessieres</surname><given-names>R</given-names></name></person-group><source>Analysis for alignment of optical systems</source><year>2003</year><publisher-name>MSc thesis, The University of Arizona</publisher-name></element-citation></ref><ref id="R44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kwee</surname><given-names>IW</given-names></name><name><surname>Braat</surname><given-names>JJM</given-names></name></person-group><article-title>Double Zernike expansion of the optical aberration function</article-title><source>Pure Applied Optics</source><year>1993</year><volume>2</volume><fpage>21</fpage><lpage>32</lpage><pub-id pub-id-type="pmid">24323109</pub-id></element-citation></ref><ref id="R45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>Y</given-names></name><name><surname>Mund</surname><given-names>M</given-names></name><name><surname>Hoess</surname><given-names>P</given-names></name><name><surname>Deschamps</surname><given-names>J</given-names></name><name><surname>Matti</surname><given-names>U</given-names></name><name><surname>Nijmeijer</surname><given-names>B</given-names></name><name><surname>Jimenez Sabinian</surname><given-names>V</given-names></name><name><surname>Ellenberg</surname><given-names>J</given-names></name><name><surname>Schön</surname><given-names>I</given-names></name><name><surname>Ries</surname><given-names>J</given-names></name></person-group><article-title>Real-time 3D single molecule localization using experimental point spread functions</article-title><source>Nature Methods</source><year>2018</year><volume>15</volume><fpage>367</fpage><lpage>369</lpage></element-citation></ref><ref id="R46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bates</surname><given-names>M</given-names></name><name><surname>Keller-Findeisen</surname><given-names>J</given-names></name><name><surname>Przybylski</surname><given-names>A</given-names></name><name><surname>Hüper</surname><given-names>A</given-names></name><name><surname>Stephan</surname><given-names>T</given-names></name><name><surname>Ilgen</surname><given-names>P</given-names></name><name><surname>Cereceda Delgado</surname><given-names>AR</given-names></name><name><surname>D’Este</surname><given-names>E</given-names></name><name><surname>Jakobs</surname><given-names>S</given-names></name><name><surname>Sahl</surname><given-names>S</given-names></name><name><surname>Hell</surname><given-names>SW</given-names></name></person-group><article-title>Optimal precision and accuracy in 4Pi-STORM using dynamic spline PSF models</article-title><source>Nature Methods</source><year>2022</year><volume>19</volume><fpage>603</fpage><lpage>612</lpage><pub-id pub-id-type="pmcid">PMC9119851</pub-id><pub-id pub-id-type="pmid">35577958</pub-id><pub-id pub-id-type="doi">10.1038/s41592-022-01465-8</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Fig. 1</label><caption><title>Schematic of fitting field dependent aberrations from single molecule data.</title><p><bold>a</bold>, The raw single molecule blinking frames are used as input. <bold>b</bold>, After segmentation into ROIs, a subset of ∼10<sup>3</sup> ROIs across the FOV is selected for field dependent aberration estimation. <bold>c</bold>, The estimation of field dependent aberrations uses maximum likelihood estimation and consists of two optimization loops: a local update that updates the locations, photon count and background of each ROI while keeping the NAT coefficients constant, and a global update that updates the Legendre NAT coefficients while keeping the locations, photon count and background constant. By selecting different ROIs in <bold>b</bold> multiple times and repeating the estimation (<bold>c)</bold> an estimation precision for the aberrations can be calculated. <bold>d</bold>, Finally, in all ROIs emitters are localized using the vectorial PSF model (Vectorfit) with the estimated NAT coefficients as input.</p></caption><graphic xlink:href="EMS201947-f001"/></fig><fig id="F2" position="float"><label>Fig. 2</label><caption><title>Aberration estimation from 2D and 3D experimental data of microtubili.</title><p>A sample was imaging in 3D with and in 2D without astigmatism. <bold>a</bold>, Estimated Zernike aberration surfaces from single molecules of the 2D data, compared to interpolated aberrations from bead z-stack calibration. <bold>b</bold>, Full FOV image reconstructed using Vectorfit and fitted aberrations from single molecules. <bold>c</bold>, and <bold>d</bold>, insets of <bold>b</bold> where (i) shows vector fitting and (ii) Gaussian fitting by Picasso [Picassco] <bold>e</bold>, Estimated Zernike aberration surfaces from single molecules of 3D data, compared to interpolated aberrations from bead z-stack calibration. <bold>f</bold>, Full 3D FOV image reconstructed using Vectorfit and fitted aberrations from single molecules. The 3D image is shifted 14 µm to the upper right compared to the 2D image. The false color indicates the axial distance from the nominal focus. In the 3D image, the microtubules that overlay the nucleus are visible in blue, while in the 2D image, these regions appear black, as the emitters are too much out of focus. <bold>g</bold>,<bold>h</bold> insets of <bold>f</bold> where (i) shows the Vectorfit result and (ii) with SMAP [SMAP]. <bold>i</bold>,<bold>j</bold>, xz-cross sections of the regions indicated in <bold>g</bold>,<bold>h</bold>. Scale bars: 10 μm (<bold>b</bold>,<bold>f</bold>), 500 nm (<bold>c</bold>,<bold>d</bold>,<bold>g</bold>,<bold>h</bold>,<bold>i</bold>,<bold>j</bold>)</p></caption><graphic xlink:href="EMS201947-f002"/></fig><fig id="F3" position="float"><label>Fig. 3</label><caption><title>Aberration estimation and reconstructions for experimental 3D astigmatic data of NPCs.</title><p><bold>a</bold>, Estimated Zernike aberration surfaces from single molecules, compared to interpolated aberrations from bead z-stack calibration. <bold>b</bold>, Standard deviation and CRLB for the estimated Zernike coefficients. The standard deviations were calculated by repeating the estimation process 30 times with different randomly selected subsets of 5,000 localizations. <bold>c</bold>(i)-(iii), Full FOV images reconstructed using fitted aberrations from single molecules, without aberrations (<italic>A</italic><sub>22</sub> = 103 <italic>mλ</italic> and other Zernike modes set to zero) and FD-DeepLoc. <bold>d</bold>(i)-(iii), Zoomed views of the regions indicated by the boxes <bold>d</bold>(i)-(iii) in <bold>c. e</bold>(i)-(iii), Zoomed views of the regions indicated by the boxes <bold>e</bold>(i)-(iii) in <bold>d. f</bold>(i)-(iii), xz-cross sections of the regions indicated by the boxes <bold>f</bold>(i)-(iii) in <bold>e</bold>. Scale bars: 50 µm (<bold>c</bold>), 5 µm (<bold>d</bold>), 500 nm (<bold>e</bold>,<bold>f</bold>).</p></caption><graphic xlink:href="EMS201947-f003"/></fig></floats-group></article>