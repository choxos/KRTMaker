<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="epub">2692-8205</issn></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS199826</article-id><article-id pub-id-type="doi">10.1101/2024.10.30.621149</article-id><article-id pub-id-type="archive">PPR933904</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Sequence clustering with PaSiMap in Jalview</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Morell</surname><given-names>Thomas</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Procter</surname><given-names>James</given-names></name><xref ref-type="aff" rid="A2">3</xref></contrib><contrib contrib-type="author"><name><surname>Barton</surname><given-names>Geoffrey J.</given-names></name><xref ref-type="aff" rid="A2">3</xref></contrib><contrib contrib-type="author"><name><surname>Diederichs</surname><given-names>Kay</given-names></name><xref ref-type="fn" rid="FN1">1</xref></contrib><contrib contrib-type="author"><name><surname>Mayans</surname><given-names>Olga</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Fleming</surname><given-names>Jennifer R.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="fn" rid="FN2">2</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib></contrib-group><aff id="A1"><label>1</label>Department of Biology, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/0546hnb39</institution-id><institution>University of Konstanz</institution></institution-wrap>, <city>Konstanz</city>, <postal-code>78457</postal-code>, <country country="DE">Germany</country></aff><aff id="A2"><label>3</label>Division of Computational Biology School of Life Sciences <institution-wrap><institution-id institution-id-type="ror">https://ror.org/03h2bxq36</institution-id><institution>University of Dundee</institution></institution-wrap>, <addr-line>Dow Street Dundee</addr-line>, <postal-code>DD1 5EH</postal-code>, Scotland</aff><author-notes><corresp id="CR1"><label>*</label>Correspondence: <email>jfleming@ebi.ac.uk</email></corresp><fn id="FN1"><label>1</label><p id="P1">Technical contact: <email>Kay.Diederichs@uni-konstanz.de</email></p></fn><fn id="FN2" fn-type="present-address"><label>2</label><p id="P2">Present address: European Bioinformatics Institute (EMBL-EBI), Wellcome Trust Genome Campus, Hinxton, Cambridge, CB10 1SD, UK</p></fn><fn id="FN3"><label>1,2</label><p id="P3">Lead contact</p></fn></author-notes><pub-date pub-type="nihms-submitted"><day>03</day><month>11</month><year>2024</year></pub-date><pub-date pub-type="preprint"><day>31</day><month>10</month><year>2024</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 International license</ext-link>.</license-p></license></permissions><abstract><title>Summary</title><p id="P4">Pairwise similarity mapping, implemented in the software PaSiMap, can be used as an alternative to principal component analysis (PCA) to analyse protein-sequence relationships. It provides the advantage of distinguishing between systematic and random differences in the dataset. Here, we present a protocol to use PaSiMap inside Jalview. You will be guided through the installation and use of the required software. Furthermore, we present an R script to prepare publication-ready graphs of the obtained data and aid in the subsequent data analysis. <fig id="F4" position="anchor"><graphic xlink:href="EMS199826-f004"/></fig></p></abstract></article-meta></front><body><sec id="S1"><title>Before you begin</title><p id="P5">Pairwise Similarity Map (PaSiMap)<sup><xref ref-type="bibr" rid="R1">1</xref></sup> is an algorithm used to class protein or nucleotide sequences within a set according to their relationship to one another. It represents each sequence as a n-dimensional coordinate point based on its pairwise similarity to all other sequences in the set. The coordinates are output as vectors from the origin, where each coordinate point corresponds to one vector. The angles between vectors reflect systematic differences between sequences. This implies that sequences with similar angles have shared features, which are systematically different from features shown by sequences mapped at a different angle. This results in a vector distribution where sequences that share distinct features form a cluster of coordinate points. Another property of the resulting vectors is their length from the origin, which corresponds to the strength of the signal. This means that the more dominant a feature is, the longer the vector and, thus, the more distant the coordinate point is from the origin. The only relevant information is the relative orientation between points (i.e. their angle) and the vector length. Accordingly, PaSiMap coordinate maps are equivalent if they can be superimposed by rotation around the centre or if they are otherwise symmetrically related.</p><p id="P6">PaSiMap clusters the input sequences in many dimensions where each dimension corresponds to a unique systematic difference. Principal Component Analysis (PCA)<sup><xref ref-type="bibr" rid="R2">2</xref></sup> and PaSiMap both use Eigen-analysis and decomposition to reduce the dimensionality of the data. PaSiMap use of a different mathematical approach results in vectors only giving the systematic differences between the datasets and not including the random differences, unlike PCA.<sup><xref ref-type="bibr" rid="R3">3</xref></sup> Both PCA and PaSiMap order the dimensions according to their influence, starting with the most influential feature as the first dimension. Typically, the first two or three dimensions - corresponding to the highest eigenvalues of the PaSiMap or PCA analysis - will sufficiently represent the sequence classes within the set. In some cases, a gap in the eigenvalue spectrum occurs only after more than three dimensions, suggesting the possibility of separately analysing the sequences in a specific sequence class.</p><p id="P7">The application of the new PaSiMap approach to sequence analysis has been demonstrated to be able to reveal new sequence interrelations that were previously undetected. Specifically, PaSiMap has been applied to the reclassification of the immunoglobulin (Ig) domains<sup><xref ref-type="bibr" rid="R1">1</xref></sup> and fibronectinIII-type (FnIII) domains<sup><xref ref-type="bibr" rid="R4">4</xref></sup> from the muscle protein titin. In the case of Ig domains<sup><xref ref-type="bibr" rid="R1">1</xref></sup>, PaSiMap revealed the existence of a previously undetected domain super-repeat in the distal I-band segment of titin, while the study of FnIII domains in the A-band of titin<sup><xref ref-type="bibr" rid="R4">4</xref></sup> showed the existence of three domain subtypes that are organised according to location in the chain. The latter finding allowed revisiting hypotheses on the evolution of the large titin protein. Another example where PaSiMap revealed novel features is the study of dual kinases in obscurin proteins.<sup><xref ref-type="bibr" rid="R5">5</xref></sup> Obscurins contain a tandem of two C-terminal kinase domains, PK1 and PK2, that are separated by a long intrinsically disordered sequence. Using PaSiMap, it was shown that PK1 kinases across vertebrates and invertebrates are as distant from each other as they are from PK2 kinases; the same conclusion was reached for PK2 kinases. This suggests that obscurin kinases might have evolved to support different functions in vertebrates and invertebrates.</p><p id="P8">In this communication, we describe the installation procedure for all software needed to apply PaSiMap to the analysis of protein sequences within Jalview. We provide the set of sequences of Ig domains from titin (as reported in<sup><xref ref-type="bibr" rid="R1">1</xref></sup>) as a test set that can assist in confirming the functionality of the installed software and that can serve here as an example to illustrate the initial analysis process. We also provide R scripts to generate static 2D-plots as well as interactive 3D-plots of the PaSiMap results for publication. Examples of the contribution of these plots to publications can be found in the PaSiMap cases mentioned above<sup><xref ref-type="bibr" rid="R1">1</xref>,<xref ref-type="bibr" rid="R4">4</xref>,<xref ref-type="bibr" rid="R5">5</xref></sup> (interactive 3D-plots are found in the Supplementary Material Sections of those publications). In following the instructions throughout this text, be careful to select the correct architecture for the binary downloads that are suitable for your computer.</p></sec><sec id="S2"><title>Installing a local copy of Jalview</title><sec id="S3"><title>Timing: 5 min</title><p id="P9">This step will guide you through the installation of Jalview<sup><xref ref-type="bibr" rid="R6">6</xref></sup>, an open-source program for the interactive analysis of multiple sequence alignments. <list list-type="order" id="L1"><list-item><p id="P10">Download Jalview using this link (<ext-link ext-link-type="uri" xlink:href="https://www.jalview.org/download/">https://www.jalview.org/download/</ext-link>).</p></list-item><list-item><p id="P11">Detailed instructions for installation on specific platforms are available on the Jalview website.</p></list-item></list></p></sec></sec><sec id="S4"><title>Download and install R and RStudio</title><sec id="S5"><title>Timing: 5 min</title><p id="P12">This step will guide you through the installation of R and RStudio.</p><p id="P13">RStudio is a commonly used integrated development environment (IDE) for the R programming language.</p><p id="P14"><bold>CRITICAL:</bold> Even if you have R and RStudio already installed on your system, it is important to keep it up-to-date to ensure that the code works correctly. Hence, please follow these instructions. <list list-type="simple" id="L2"><list-item><label>3</label><p id="P15">Download and install R from this website <ext-link ext-link-type="uri" xlink:href="https://cran.rstudio.com/">https://cran.rstudio.com/</ext-link>. <list list-type="simple" id="L3"><list-item><label>a</label><p id="P16">A graphical installation package is available for Windows and Mac OS.</p></list-item><list-item><label>b</label><p id="P17">For an installation on GNU/Linux consider checking your distribution's core repository first or check the instructions on the webpage.</p></list-item></list></p></list-item><list-item><label>4</label><p id="P18">Download and install RStudio from the official website (<ext-link ext-link-type="uri" xlink:href="https://posit.co/download/rstudio-desktop/">https://posit.co/download/rstudio-desktop/</ext-link>). <list list-type="simple" id="L4"><list-item><label>a</label><p id="P19">Detailed and platform-specific instructions are available on the website.</p></list-item></list></p></list-item></list></p></sec></sec><sec id="S6"><title>Download the example data and analysis script</title><sec id="S7"><title>Timing: 5 min</title><p id="P20">This step will guide you through the process of downloading an example dataset as well as the code for analysing it. <list list-type="simple" id="L5"><list-item><label>5</label><p id="P21">Download the R code and example data from <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/doi/10.5281/zenodo.12605086">https://zenodo.org/doi/10.5281/zenodo.12605086</ext-link> <list list-type="simple" id="L6"><list-item><label>a</label><p id="P22">Go to the download section and click on <monospace>“Download”</monospace> to download a zip archive containing the code and an example dataset.</p></list-item><list-item><label>b</label><p id="P23">Extract the zip archive if it has not been extracted automatically.</p></list-item></list></p></list-item></list></p><p id="P24"><bold>Note:</bold> The example data can be found in the unzipped folder in “example_data” in a file called “example_data.fa”. This file contains 169 unaligned sequences from immunoglobulin domains of titin. These were previously analysed using PaSiMap<sup><xref ref-type="bibr" rid="R1">1</xref></sup> and can be used as a reference.</p></sec><sec id="S8"><title>Key resources table</title><table-wrap id="T1" position="anchor" orientation="portrait"><table frame="box" rules="all"><thead><tr><th align="left" valign="top">REAGENT or RESOURCE</th><th align="left" valign="top">SOURCE</th><th align="left" valign="top">IDENTIFIER</th></tr></thead><tbody><tr><td align="left" valign="top" colspan="2">Software and Algorithms</td></tr><tr><td align="left" valign="top">Jalview</td><td align="left" valign="top">Waterhouse et al., 2009</td><td align="left" valign="top"><ext-link ext-link-type="uri" xlink:href="https://www.jalview.org/">https://www.jalview.org/</ext-link></td></tr><tr><td align="left" valign="top">RStudio</td><td align="left" valign="top">Posit Software</td><td align="left" valign="top"><ext-link ext-link-type="uri" xlink:href="https://posit.co/download/rstudio-desktop/">https://posit.co/download/rstudio-desktop/</ext-link></td></tr><tr><td align="left" valign="top">R</td><td align="left" valign="top">R foundation</td><td align="left" valign="top"><ext-link ext-link-type="uri" xlink:href="https://cran.rstudio.com/">https://cran.rstudio.com/</ext-link></td></tr><tr><td align="left" valign="top">PaSiMap data analysis code</td><td align="left" valign="top">This article</td><td align="left" valign="top"><ext-link ext-link-type="uri" xlink:href="https://zenodo.org/doi/10.5281/zenodo.12605086">https://zenodo.org/doi/10.5281/zenodo.12605086</ext-link></td></tr></tbody></table></table-wrap></sec></sec><sec id="S9"><title>Step-by-step method details</title><p id="P25">Here we describe a step-by-step method for analysing your sequence data in Jalview and creating custom plots of your data in RStudio. The steps and their results will be illustrated here using the example dataset described above. This set can be also used as a reference by users to confirm the correct installation and performance of the software by comparison to the results here provided.</p></sec><sec id="S10"><title>Import sequences into Jalview and perform a PaSiMap analysis</title><sec id="S11"><title>Timing: 5 min</title><p id="P26">To analyse your sequences of interest, you will load your set of sequences (not aligned) into Jalview and perform a PaSiMap analysis. Then you will export PaSiMap vector coordinates for further analysis. In addition to the text explanation, check <xref ref-type="fig" rid="F1">Figure 1</xref> for more details.</p><p id="P27"><bold>Note:</bold> Prepare a file comprising your set of unaligned sequences in one of the following supported file types: fasta, msf, clustalw, pileup, pir, blc, pfam, stockholm, phylip, embl, GenBank and json. <list list-type="simple" id="L7"><list-item><label>1</label><p id="P28">Open Jalview.</p></list-item></list></p><p id="P29"><bold>Note:</bold> Upon opening Jalview, several boxes containing example sequences and analyses will be launched, these can be closed.</p><p id="P30"><bold>Note:</bold> Operating system specific key combinations are stated in the following way <monospace>&lt;Windows or GNU/Linux&gt;/&lt;Mac OS&gt;</monospace>. Please use the appropriate one. <list list-type="simple" id="L8"><list-item><label>2</label><p id="P31">Load in your or the example sequence file by doing one of the following. <list list-type="simple" id="L9"><list-item><label>º</label><p id="P32">Going to the central <monospace>“File”</monospace> tab of the overall Jalview window &gt;&gt; <monospace>“Input Alignment” &gt;&gt; “From File..”</monospace></p></list-item><list-item><label>º</label><p id="P33">Pressing <monospace>&lt;Ctrl+o&gt;/&lt;Command+o&gt;</monospace></p><list list-type="simple" id="L10"><label>i</label><list-item><p id="P34">Navigate through the file browser window and select your file. Press <monospace>“Open”</monospace>.</p></list-item></list></list-item><list-item><label>º</label><p id="P35">Drag-and-dropping the alignment file in.</p></list-item></list>
</p></list-item><list-item><label>3</label><p id="P36">A new tab will appear containing your sequences- Go to <monospace>“Calculate” &gt;&gt; “Calculate Tree, PCA or PaSiMap”</monospace> to open the chosen calculation panel.</p></list-item><list-item><label>4</label><p id="P37">Select the <monospace>“PaSiMap”</monospace> menu entry and a scoring matrix of your choice. The default is <monospace>“BLOSUM62”</monospace>.</p></list-item><list-item><label>5</label><p id="P38">Press <monospace>“Calculate”</monospace> to start the PaSiMap calculation.</p><p id="P39">Once completed, a graphical window will appear showing a 3D plot of your data points, where each point represents a sequence. These coordinate points are an illustration of vectors from the origin in multidimensional space. Similar to PCA, the dimensions of PaSiMap are ordered hierarchically according to their description of sequence features. The first dimension represents the most influential feature, while the second dimension represents a smaller orthogonal feature, the third one an even smaller orthogonal feature and so on. For ease of visualisation, the output is usually shown in either 2D or 3D dimensions. The sequences are related by the position of their corresponding coordinate points in space. Position correlates with sequence identity, thus the closer two sequences are in space, the higher their pairwise identity. The angle between vectors corresponds to systematic differences between sequences. Sequences whose PaSiMap vectors have a small difference in angle, typically form clusters. Within a cluster, the longest vectors are the best representatives of the cluster’s features, while coordinate points closer to the origin (i.e. having a shorter vector) are less similar to the ‘prototype of the group’ (i.e. the sequence with the longest vector at a similar angle).</p></list-item></list></p><p id="P40"><bold>Note:</bold> You can enable the labels for the data points by going to the graphical window showing the 3D data points and pressing <monospace>“View” &gt;&gt; “Show labels”</monospace>.</p><p id="P41"><bold>Optional:</bold> If you wish to repeat the analysis with a subset of the data, you can go to the 3D plot window that displays the data points and hold &lt;Win+s+MButton&gt;/&lt;Command+s+MButton&gt; (mouse middle button) and drag the mouse to select all points in that area. Now you can run a new PaSiMap analysis that will only analyse the selected sequences. <list list-type="simple" id="L11"><list-item><label>6</label><p id="P42">To output the coordinates go to the 3D viewer and press <monospace>“File” &gt;&gt; “Output points…”</monospace>.</p></list-item><list-item><label>7</label><p id="P43">Save the data by going to the window showing the points in csv format and pressing <monospace>“File” &gt;&gt; “Save”</monospace> or pressing <monospace>&lt;Ctrl+s&gt;/&lt;Command+s&gt;</monospace> and providing a file name. Give your file the <monospace>“.csv”</monospace> extension.</p></list-item></list></p><p id="P44"><bold>Note:</bold> Jalview will not be needed for further steps in this protocol and can be closed. We recommend you save the Jalview session as a project file - Jalview will prompt you to do this if you have not already done so. Saving the Jalview session will allow you to visualise the results of the spectral cluster analysis performed later in this protocol.</p></sec></sec><sec id="S12"><title>Plot PaSiMap data using RStudio</title><sec id="S13"><title>Timing: 20 min (for inexperienced users)</title><p id="P45">This step will guide you through the process of analysing your PaSiMap coordinates in RStudio. You should use the data created through Jalview in the previous step. If you instead choose to work with the example data set, you can find its corresponding PaSiMap output coordinates in the “plot_pasimap_data-master/example_data” directory named “example_data.csv”. You will produce several scatterplots of the data, which should assist you in its interpretation. These are grouped in different ways, ungrouped, by angle around the centre and by spectral clustering. <list list-type="simple" id="L12"><list-item><label>8</label><p id="P46">Open RStudio.</p></list-item><list-item><label>9</label><p id="P47">Go through <monospace>“File” &gt;&gt; “Open File…”</monospace> in the main RStudio menu bar or press <monospace>&lt;Ctrl+o&gt;/&lt;Command+o&gt;</monospace> to load in a code file.</p></list-item><list-item><label>10</label><p id="P48">Find the unzipped “plot_pasimap_data.r” and press “Open”.</p></list-item></list></p><p id="P49"><bold>Note:</bold> The graphical interface of RStudio is separated into four sections: at the top left is the code window; at the bottom left is the console; the environment window is on the top right and a window showing the plots generated is on the bottom left. <list list-type="simple" id="L13"><list-item><label>11</label><p id="P50">Familiarise yourself with the code.</p><list list-type="simple" id="L14"><list-item><label>º</label><p id="P51">Read the instructions in commented lines. You do not need to change anything at this point, there will be further instructions for this during this protocol.</p></list-item></list></list-item></list></p><p id="P52"><bold>Note:</bold> In R, a line commencing with a ‘#’ serves as a comment, ensuring it is excluded from code execution. <list list-type="simple" id="L15"><list-item><label>12</label><p id="P53">Set your project directory by changing the path in the <monospace>“data_path”</monospace> variable to the full path to your project. This directory should contain the csv file created in the prior step. The path has to end with a ‘/’ or a ‘\’. If you have trouble finding the path to your project directory or setting it correctly, see <underline>Troubleshooting - Problem 1</underline>.
<preformat preformat-type="computer code"><styled-content style="font-size:15px;">data_path=“your-path-to/plot_pasimap_data/example_data/”
</styled-content></preformat></p></list-item></list></p><p id="P54"><bold>Note:</bold> Windows employs ‘\’ as path separators, in contrast to ‘/’ used in MacOS and GNU/Linux. Be sure to use the relevant separator for your operating system when specifying your path. <list list-type="simple" id="L16"><list-item><label>13</label><p id="P55">Set the name of the “.csv” file containing your data in the <monospace>“coordinates_file”</monospace> variable by changing “example_data.csv” to your file name.
<preformat preformat-type="computer code"><styled-content style="font-size:15px;">coordinates_file="example_data.csv"</styled-content></preformat>
</p></list-item></list></p><p id="P56"><bold>Optional:</bold> Change the names of output files as described in the code. This guideline also extends to incorporating labels in scatter plots. <list list-type="simple" id="L17"><list-item><label>14</label><p id="P57">Set the name of the Jalview annotations file in the <monospace>“jalview_annotations”</monospace> variable by changing <monospace>“example_data_clusters.annotations”</monospace> to your desired filename. Keep the <monospace>“.annotations”</monospace> extension. If you do not wish to create a Jalview annotations file, comment or delete this line. The annotation file can later be used to visualise the clustering groups in Jalview (see step 20).
<preformat preformat-type="computer code"><styled-content style="font-size:15px;">jalview_annotations="example_data_clusters.annotations"
</styled-content></preformat>
</p></list-item><list-item><label>15</label><p id="P58">Set the filetype for the output graphs by choosing between “svg”, “pdf” or “none”. Exchange “none” to the filetype of your choice. If “none” is selected, the plots are not saved as files but only shown in the plot window.
<preformat preformat-type="computer code"><styled-content style="font-size:15px;">output &lt;- “none”</styled-content></preformat>
</p></list-item><list-item><label>16</label><p id="P59">Run the complete code by pressing <monospace>&lt;Alt + Ctrl + r&gt;/&lt;Option + Command + r&gt;</monospace></p></list-item></list></p><p id="P60"><bold>Critical:</bold> The first execution of the code can take a few minutes as installation of the required packages is often required. If there is a prompt appearing in the console window during this process see <underline>Troubleshooting - Problem 1</underline>. For any errors that might happen during execution of this script see <underline>Troubleshooting - Problems 2 - 5</underline>.</p><p id="P61"><bold>Optional:</bold> To run or re-run a specific piece of code select the region and press <monospace>&lt;Ctrl + Enter&gt;/&lt;Command + Enter&gt;</monospace>. The code can be further extended to suit your needs. <list list-type="simple" id="L18"><list-item><label>17</label><p id="P62">Running the code will produce four separate plots which are saved in the directory provided.</p><list list-type="simple" id="L19"><list-item><label>º</label><p id="P63">The labels for the scatterplots can be toggled by (un)commenting the line with text(...). It is marked by an explanatory comment located above the line of code.</p></list-item></list></list-item><list-item><label>18</label><p id="P64">Each scatterplot can be also created as a 3D interactive plot to help explore the data. The appropriate colouring has to be entered in the command at the bottom of the code surrounded by ““. Possible inputs are “angle”, “spectral” and “default”. Executing this line of code will show you the interactive plot in the plot window and also save it as an “html” file which can be published as Supplementary Material to an accompanying manuscript. Each graph includes a zoomable and rotatable interface and hover tooltip which indicates the corresponding sequence for each data point.
<preformat preformat-type="computer code"><styled-content style="font-size:15px;">show_interactive(“default”)
</styled-content></preformat>
</p></list-item><list-item><label>19</label><p id="P65">To change the dimensions you want to examine, change the number behind the <monospace>“X”</monospace> at for example <monospace>“dim1 &lt; “X2””</monospace> to the dimension number you want to use as that axis.
<preformat preformat-type="computer code"><styled-content style="font-size:15px;">dim1 &lt;- “X2”
dim2 &lt;- “X3”
dim3 &lt;- “X1”
</styled-content></preformat>
</p></list-item><list-item><label>20</label><p id="P66">To visualise the sequence groups created using this R script in Jalview, import the annotation file using the <monospace>“File”</monospace> &gt;&gt; <monospace>“Load Features/Annotations”</monospace> menu option in the Jalview alignment window (<xref ref-type="fig" rid="F1">Figure 1C</xref>). This will colour the sequences in the same way as they were in the interactive R plot.</p></list-item></list></p></sec></sec><sec id="S14"><title>Expected outcomes</title><p id="P67">After this protocol you will have a pipeline at hand to analyse any set of sequences using the PaSiMap similarity mapping pipeline.<sup><xref ref-type="bibr" rid="R1">1</xref></sup> You will also have the tools at hand to analyse your coordinates and interpret groupings of sequences.</p><p id="P68">As described already, the dimensions represent different features starting with the most important. Often it is enough to only explore a 2D plot of the first two dimensions. The eigenvalues of cc_analysis<sup><xref ref-type="bibr" rid="R7">7</xref></sup> have to be examined, to properly judge whether this is sufficient. There often is a gap between two eigenvalues, if this is the case, the lower eigenvalues have a lesser effect in the mapping and usually can be disregarded from the analysis.<sup><xref ref-type="bibr" rid="R8">8</xref></sup> If this is not the case, all dimensions should be checked until there is no significant change in the mapping of the coordinate points. The eigenvalues can be found by going to the 3D plot window in Jalview showing the PaSiMap coordinate points and pressing <monospace>“File”</monospace> &gt;&gt; <monospace>“Output Values...”</monospace>. The popup contains the eigenvalues along with some other data. In case of big clusters, it can be insightful to perform a targeted PaSiMap analysis of each individual cluster to get information on further classification and relationship of the sequences within that group.</p><p id="P69">The R code supplied in this protocol will provide you with four different plots (<xref ref-type="fig" rid="F2">Figure 2</xref>, if you used the example data but your plots do not look like shown here see Troubleshooting - Problem 6). The first scatterplot of the data is coloured by the increasing angle of the data points in the two dimensional view of the map. The histogram shows the angle distribution in 10° intervals. Based on this, a second scatterplot is exported showing the data grouped by the angle distribution. The histogram and its corresponding scatterplot permit identifying sequence clusters. The third scatterplot shows an alternative in which the data are grouped and coloured by spectral clustering.<sup><xref ref-type="bibr" rid="R9">9</xref></sup> Spectral clustering is an automatic clustering method to reduce noise and enhance the similarity between points with common neighbours. It works for Gaussian and non-Gaussian structures. As the data produced by PaSiMap is non-Gaussian this can help you to identify groups in most cases and give you another suggestion in combination with grouping by angle. Either way, the clusters you choose should reflect the angle as that is how PaSiMap separates the data points. The histogram (<xref ref-type="fig" rid="F2">Figure 2 B</xref>) can help to identify clusters and how you can handle outliers. The automatically calculated groups can be manually altered and fit to your interpretation of the data using the R script provided in this protocol. In addition to the 2 dimensional plots, a 3D interactive plot of any of these can be created to assist exploring the data (Supplemental information S1).</p><p id="P70">The R code also produces a jalview annotation file which can be loaded back into Jalview to visualise the groups identified by spectral clustering on the original PaSiMap 3D plot window. To do this, import the annotation file using the <monospace>“File”</monospace> &gt;&gt; <monospace>“Load Features/Annotations”</monospace> menu option in the Jalview alignment window (<xref ref-type="fig" rid="F1">Figure 1C</xref>).</p></sec><sec id="S15"><title>Limitations</title><p id="P71">The set of sequences used for PaSiMap has to consist of at least somewhat related sequences. Otherwise a “No connectivity” error will be output and no plot can be made. Furthermore, the number of different sequences and their size in the alignment that can be analysed is limited by the computer specifications.</p></sec><sec id="S16"><title>Troubleshooting</title><sec id="S17"><title>Problem 1</title><p id="P72">During the initial execution of the code the package installation happens (see Step 15). This might give you a prompt asking for the installation of source packages. Do the following to avoid long installation times and further possible errors.</p><sec id="S18"><title>Potential solution</title><p id="P73">Press on the console window, type “no” and press <monospace>&lt;Enter&gt;</monospace>.</p></sec></sec><sec id="S19"><title>Problem 2</title><p id="P74">If you have trouble finding the path to your project or setting the correct directory, you can use one of the alternative approaches. It will correctly set it up for now, but has to be repeated each time RStudio is reopened.</p><sec id="S20"><title>Potential solution</title><list list-type="bullet" id="L20"><list-item><p id="P75">You can graphically set the working directory by going to the main menu bar of RStudio and pressing <monospace>“Session” &gt;&gt; “Set Working Directory &gt;“ &gt;&gt; “Choose Directory…”</monospace>. Then select your project folder and press <monospace>“Open”</monospace>.</p><p id="P76">or</p></list-item><list-item><p id="P77">You can load it in directly by going to <monospace>“Import Dataset” &gt;&gt; “From Text (base)...”</monospace> in the top bar of the top right window in RStudio. Then open the.csv file and a new dialog will appear. Change the name in the top most textbox to <monospace>“coordinates”</monospace> and press on the <monospace>“Yes”</monospace> button next to <monospace>“Heading”</monospace>. You can now press <monospace>“Import”</monospace>. The data will be loaded and shown. You can switch back to your code by pressing on the <monospace>“plot_pasimap_data.r”</monospace> tab in the top left window.</p></list-item></list><p id="P78">After using either of the two options, the line mentioned in <underline>Step 13</underline> has to be deleted or commented out (by typing a ‘#’ at the beginning of the line). The code should work properly afterwards.</p></sec></sec><sec id="S21"><title>Problem 3</title><p id="P79">An incorrectly set working directory can cause the script to not find the data file. It will output an error stating “cannot change working directory” or “No such file or directory”. In either case it will not be able to produce any plots.</p><sec id="S22"><title>Potential solution</title><list list-type="bullet" id="L21"><list-item><p id="P80">In the first case an invalid directory was set in <underline>Step 13</underline>. Make sure to have the correct path entered here. Beware that Windows uses a different way of giving the path than MacOS and GNU/Linux. If you have trouble finding the path, see <underline>Troubleshooting - Problem 2</underline>.</p></list-item><list-item><p id="P81">In the latter case the file name provided in <underline>Step 14</underline> was incorrect. Check that the correct file name is input here.</p></list-item></list></sec></sec><sec id="S23"><title>Problem 4</title><p id="P82">During the initial execution of the code the package installation happens (<underline>see Step 15</underline>). This can cause errors due to differences in system and version. Errors will be displayed in the console window. You will also notice this as no plots can be produced.</p><sec id="S24"><title>Potential solution</title><list list-type="bullet" id="L22"><list-item><p id="P83">Make sure to have the latest version of both R and RStudio installed. Otherwise update R and RStudio, restart everything and try again.</p></list-item><list-item><p id="P84">Try removing the packages and reinstalling them by typing the following line into the console window (bottom left) and pressing <monospace>&lt;Enter&gt;</monospace>. Afterwards, close RStudio, restart it and try executing the code again. Look out for prompts appearing in the console window, see <underline>Troubleshooting - Problem 1</underline>.
<preformat preformat-type="computer code"><styled-content style="font-size:15px;">remove.packages(packages)
</styled-content></preformat>
</p></list-item></list></sec></sec><sec id="S25"><title>Problem 5</title><p id="P85">If there is an error being thrown that looks like the following, an unsupported string was provided as the dimension to choose for plotting.
<preformat preformat-type="computer code"><styled-content style="font-size:15px;">Error in atan2(x, y) : non-numeric argument to mathematical function Resource availability.
</styled-content></preformat></p><sec id="S26"><title>Potential solution</title><p id="P86">Check your input for the dimensions in Step 18 for the correct formatting. It should read <monospace>“dim1 &lt;- “X1””</monospace> while the number next to <monospace>“X”</monospace> is to be changed to the dimension wanted.</p></sec></sec><sec id="S27"><title>Problem 6</title><p id="P87">If your 2D scatter plots created with the example data do not look like the ones in <xref ref-type="fig" rid="F2">Figure 2</xref>, you might have set different dimensions (see <underline>Step 18</underline>) than those used to create these plots.</p><sec id="S28"><title>Potential solution</title><p id="P88">To replicate the plots shown in <xref ref-type="fig" rid="F2">Figure 2</xref>, the following has to be set as the dimensions.
<preformat preformat-type="computer code"><styled-content style="font-size:15px;">
dim1 &lt;- “X2”
dim2 &lt;- “X3”
dim3 &lt;- “X1”
</styled-content></preformat></p></sec></sec></sec></body><back><ack id="S29"><title>Acknowledgments</title><p>JP and the Jalview project is supported by Wellcome Trust grant 218259Z/19/Z awarded to GJB and JP.</p></ack><sec id="S30" sec-type="data-availability"><title>Data and code availability</title><p id="P89">Example data and code used during this protocol are available at <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/doi/10.5281/zenodo.12605086">https://zenodo.org/doi/10.5281/zenodo.12605086</ext-link>.</p></sec><fn-group><fn id="FN4" fn-type="con"><p id="P90"><bold>Author contributions</bold></p><p id="P91">JRF conceived and designed the project. TM wrote the code and paper; JP, KD and GB consultation and code review; OM wrote paper. All authors reviewed and edited the paper.</p></fn><fn id="FN5" fn-type="conflict"><p id="P92"><bold>Declaration of interests</bold></p><p id="P93">The authors declare no competing interests.</p></fn><fn id="FN6"><p id="P94"><bold>Lead contact</bold></p><p id="P95">Jennifer Fleming; <email>jfleming@ebi.ac.uk</email></p></fn><fn id="FN7"><p id="P96"><bold>Materials availability</bold></p><p id="P97">This study did not generate new unique reagents.</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Su</surname><given-names>K</given-names></name><name><surname>Mayans</surname><given-names>O</given-names></name><name><surname>Diederichs</surname><given-names>K</given-names></name><name><surname>Fleming</surname><given-names>JR</given-names></name></person-group><article-title>Pairwise sequence similarity mapping with PaSiMap: Reclassification of immunoglobulin domains from titin as case study</article-title><source>Computational and Structural Biotechnology Journal</source><year>2022</year><volume>20</volume><fpage>5409</fpage><lpage>5419</lpage><pub-id pub-id-type="pmcid">PMC9529554</pub-id><pub-id pub-id-type="pmid">36212532</pub-id><pub-id pub-id-type="doi">10.1016/j.csbj.2022.09.034</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maćkiewicz</surname><given-names>A</given-names></name><name><surname>Ratajczak</surname><given-names>W</given-names></name></person-group><article-title>Principal component analysis (PCA)</article-title><source>Computers &amp; Geosciences</source><year>1993</year><volume>19</volume><issue>3</issue><fpage>303</fpage><lpage>342</lpage></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Assmann</surname><given-names>G</given-names></name><name><surname>Brehm</surname><given-names>W</given-names></name><name><surname>Diederichs</surname><given-names>K</given-names></name></person-group><article-title>Identification of rogue datasets in serial crystallography</article-title><source>Journal of Applied Crystallography</source><year>2016</year><volume>49</volume><fpage>1021</fpage><lpage>1028</lpage><pub-id pub-id-type="pmcid">PMC4886987</pub-id><pub-id pub-id-type="pmid">27275144</pub-id><pub-id pub-id-type="doi">10.1107/S1600576716005471</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fleming</surname><given-names>JR</given-names></name><name><surname>Müller</surname><given-names>I</given-names></name><name><surname>Zacharchenko</surname><given-names>T</given-names></name><name><surname>Diederichs</surname><given-names>K</given-names></name><name><surname>Mayans</surname><given-names>O</given-names></name></person-group><article-title>Molecular insights into titin’s A-band</article-title><source>Journal of Muscle Research and Cell Motility</source><year>2023</year><volume>44</volume><issue>4</issue><fpage>255</fpage><lpage>270</lpage><pub-id pub-id-type="pmcid">PMC10665226</pub-id><pub-id pub-id-type="pmid">37258982</pub-id><pub-id pub-id-type="doi">10.1007/s10974-023-09649-1</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zacharchenko</surname><given-names>T</given-names></name><name><surname>Dorendorf</surname><given-names>T</given-names></name><name><surname>Locker</surname><given-names>N</given-names></name><name><surname>Van Dijk</surname><given-names>E</given-names></name><name><surname>Katzemich</surname><given-names>A</given-names></name><name><surname>Diederichs</surname><given-names>K</given-names></name><name><surname>Bullard</surname><given-names>B</given-names></name><name><surname>Mayans</surname><given-names>O</given-names></name></person-group><article-title>PK1 from Drosophila obscurin is an inactive pseudokinase with scaffolding properties</article-title><source>Open Biology</source><year>2023</year><volume>13</volume><issue>4</issue><pub-id pub-id-type="pmcid">PMC10129394</pub-id><pub-id pub-id-type="pmid">37121260</pub-id><pub-id pub-id-type="doi">10.1098/rsob.220350</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Waterhouse</surname><given-names>AM</given-names></name><name><surname>Procter</surname><given-names>JB</given-names></name><name><surname>Martin</surname><given-names>DMA</given-names></name><name><surname>Clamp</surname><given-names>M</given-names></name><name><surname>Barton</surname><given-names>GJ</given-names></name></person-group><article-title>Jalview Version 2 -- a multiple sequence alignment editor and analysis workbench</article-title><source>Bioinformatics</source><year>2009</year><volume>25</volume><issue>9</issue><fpage>1189</fpage><lpage>1191</lpage><pub-id pub-id-type="pmcid">PMC2672624</pub-id><pub-id pub-id-type="pmid">19151095</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btp033</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Diederichs</surname><given-names>K</given-names></name></person-group><article-title>Dissecting random and systematic differences between noisy composite data sets</article-title><source>Acta Crystallographica Section D</source><year>2017</year><volume>73</volume><issue>4</issue><fpage>286</fpage><lpage>293</lpage><pub-id pub-id-type="pmcid">PMC5379934</pub-id><pub-id pub-id-type="pmid">28375141</pub-id><pub-id pub-id-type="doi">10.1107/S2059798317000699</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hunkler</surname><given-names>S</given-names></name><name><surname>Diederichs</surname><given-names>K</given-names></name><name><surname>Kukharenko</surname><given-names>O</given-names></name><name><surname>Peter</surname><given-names>C</given-names></name></person-group><article-title>Fast conformational clustering of extensive molecular dynamics simulation data</article-title><source>Journal of Chemical Physics</source><year>2023</year><volume>158</volume><issue>14</issue><pub-id pub-id-type="pmid">37061476</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>John</surname><given-names>CR</given-names></name><name><surname>Watson</surname><given-names>D</given-names></name><name><surname>Barnes</surname><given-names>MR</given-names></name><name><surname>Pitzalis</surname><given-names>C</given-names></name><name><surname>Lewis</surname><given-names>MJ</given-names></name></person-group><article-title>Spectrum: fast density-aware spectral clustering for single and multi-omic data</article-title><source>Bioinformatics</source><year>2019</year><volume>36</volume><issue>4</issue><fpage>1159</fpage><lpage>1166</lpage><pub-id pub-id-type="pmcid">PMC7703791</pub-id><pub-id pub-id-type="pmid">31501851</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btz704</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>Process of performing a PaSiMap analysis in Jalview.</title></caption><graphic xlink:href="EMS199826-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>Plots produced for the example set of sequences.</title><p>A) Data coloured by increasing angle around the coordinate origin (0,0); B) Histogram showing the number of data points per 10° interval, coloured same as A); C) Data points grouped according to B); D) Data grouped by spectral clustering.<sup><xref ref-type="bibr" rid="R5">5</xref></sup></p></caption><graphic xlink:href="EMS199826-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><p>Scatter plot with the example data using dimensions 1, 2 and 3 (“X1”, “X2”, “X3”) as “dim1”, “dim2”, and “dim3”.</p></caption><graphic xlink:href="EMS199826-f003"/></fig></floats-group></article>