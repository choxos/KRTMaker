<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="epub">2692-8205</issn></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS201946</article-id><article-id pub-id-type="doi">10.1101/2024.12.11.627908</article-id><article-id pub-id-type="archive">PPR953232</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Frequency-specific theta states in the hippocampus modulate population activity with respect to behavioural context</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Masaracchia</surname><given-names>Laura</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Fredes</surname><given-names>Felipe</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Vidaurre</surname><given-names>Diego</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A3">3</xref></contrib><aff id="A1"><label>1</label>Center of Functionally Integrative Neuroscience (CFIN), Department of Clinical Medicine, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/01aj84f44</institution-id><institution>Aarhus University</institution></institution-wrap>, <city>Aarhus</city>, <postal-code>8000</postal-code>, <country country="DK">Denmark</country></aff><aff id="A2"><label>2</label>Dandrite, Department of Biomedicine, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/01aj84f44</institution-id><institution>Aarhus University</institution></institution-wrap>, <city>Aarhus</city>, <postal-code>8000</postal-code>, <country country="DK">Denmark</country></aff><aff id="A3"><label>3</label>Oxford Centre for Human Brain Activity (OHBA), Department of Psychiatry, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/052gg0110</institution-id><institution>Oxford University</institution></institution-wrap>, <city>Oxford</city>, <postal-code>OX3 7JX</postal-code>, <country country="GB">United Kingdom</country></aff></contrib-group><pub-date pub-type="nihms-submitted"><day>18</day><month>12</month><year>2024</year></pub-date><pub-date pub-type="preprint"><day>11</day><month>12</month><year>2024</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Neural activity reflects both external stimuli and the brain’s internal state, which shapes how information is processed and perceived. An example of modulation of neural responses by network states is phase-precession in the hippocampus, where the phase of theta oscillations affects the firing of single neurons (place cells) and its relation to the external world. Here, we examine a different form of oscillation-to-neuron modulation, where frequency and power of the oscillation, instead of phase, modulate neural firing patterns at the population level. We refer to this as <italic>ensemble pattern modulation</italic>. To study this effect, we use electrophysiological recordings of rats performing an odour-memory (non-spatial) task. Using a data-driven model, we identified two distinct theta states: low-power-lower-theta (LPLT) and high-power-higher-theta (HPHT). Through decoding analyses, we found that these states differentially modulate hippocampal neural ensemble activity, in this case reflective of the trial outcome. This suggests that amplitude and frequency variations within theta oscillations may reconfigure neural firing at the network level to support distinct cognitive functions.</p></abstract><kwd-group><kwd>network states</kwd><kwd>theta oscillations</kwd><kwd>hippocampus</kwd><kwd>ensemble activity patterns</kwd><kwd>hidden Markov models</kwd><kwd>state-conditioned decoding</kwd></kwd-group></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P2">Even without being engaged in a task, an animal’s brain activity is in perpetual motion to shape its cognitive and physiological state <sup><xref ref-type="bibr" rid="R1">1</xref>,<xref ref-type="bibr" rid="R2">2</xref></sup>. Any sensory stimulus coming from the external world is then met with an ever-changing landscape of neural activity, which inevitably influences the way a stimulus is processed and perceived <sup><xref ref-type="bibr" rid="R3">3</xref>–<xref ref-type="bibr" rid="R5">5</xref></sup>. This means that even identical stimuli are processed differently, depending on the current brain state <sup><xref ref-type="bibr" rid="R6">6</xref>–<xref ref-type="bibr" rid="R13">13</xref></sup>; and that brain states affect information processing at the neural level <sup><xref ref-type="bibr" rid="R14">14</xref>–<xref ref-type="bibr" rid="R20">20</xref></sup>.</p><p id="P3">At a regional level, network states can be identified as coherent patterns of activity of neurons connected as a network. This coherent network activity, often taking the form of oscillations, has been associated to cognitive functions and shown to influence the activity of the neurons embedded in the network <sup><xref ref-type="bibr" rid="R21">21</xref>–<xref ref-type="bibr" rid="R23">23</xref></sup>. An example is theta oscillations in the hippocampus, associated with memory formation and recall, and spatial navigation <sup><xref ref-type="bibr" rid="R21">21</xref>,<xref ref-type="bibr" rid="R24">24</xref>–<xref ref-type="bibr" rid="R27">27</xref></sup>. A well-established example of network-to-neuron modulation is given by the phase precession phenomenon, where hippocampal place cells fire at specific phases of theta oscillations, depending on an animal’s location in space <sup><xref ref-type="bibr" rid="R28">28</xref></sup>.</p><p id="P4">In this study we explore a different kind of network-to-neuron modulation, where frequency and amplitude of theta oscillations in the hippocampus modulate trial information processing at the neural population level. We find two distinct states within the classically defined theta band: low-power-lower-theta (LPLT) and high-power-higher-theta (HPHT). Using methods to target neuron-state interactions and state-dependent neural population activity, we quantify the influence of the two theta states on the neural ensemble patterns reflective of trial outcome. Our results confirm that the two theta states differentially modulate neural population activity reflective of success and failure, suggesting that the hippocampus uses different network configurations to perform different functions, potentially with the same neural population.</p></sec><sec id="S2" sec-type="results"><title>Results</title><p id="P5">In this study, we quantified the influence of mesoscale network states (i.e. oscillations) on how neural firing patterns relate to behaviour. For this, we used previously recorded local field potentials (LFP) and spike data from the dorsal CA1 region of the hippocampus of four rats performing an odour-memory task <sup><xref ref-type="bibr" rid="R29">29</xref></sup>. The task required rats to recognise whether presented odours followed the correct order within a previously learned sequence. Correct responses were rewarded with water after each odour presentation. We investigated whether the CA1 neural population reflected differently trial outcome depending on the local network state (<xref ref-type="fig" rid="F1">Figure 1A</xref>). To do so, we first fitted hidden Markov models (HMM <sup><xref ref-type="bibr" rid="R30">30</xref>–<xref ref-type="bibr" rid="R32">32</xref></sup>, a data-driven method) to detect two hippocampal states from the LFP data. The HMM assigned a state to each time point in the LFP data. We then linked these states activations to the corresponding time points in the spike data (<xref ref-type="fig" rid="F1">Figure 1B</xref>). With this information, first we performed neuron-state interaction analysis, per time point and across trials, to quantify the effect of the network states on the representation of trial outcome (success vs failure) by the neurons (<xref ref-type="fig" rid="F1">Figure 1C</xref>). In this analysis, we used the neural firing as regressors and trial outcome as the independent variable, with the network states as optional regressors. Linear regression was performed for each neuron individually. This way, if the network states influenced neural processing of trial outcome, including the states time courses in the interaction analysis should improve the model’s ability to predict trial outcomes. We then examined the regression coefficients (representative of the brain-behaviour association), to compare the effect of the two network states on the neural representations of trial outcome. Second, we conducted multivariate decoding, where we used the activity of the entire neural ensemble simultaneously to predict the trial outcome. To do so, for each time point we separated the spike data into two sets, according to the assigned state in the LFP; we then performed multivariate decoding separately for each of the two sets and per time point (<italic>state-conditioned decoding</italic>, illustrated in <xref ref-type="fig" rid="F1">Figure 1D</xref>). This allowed us to quantify the effect of network states on the representational properties of the neural population.</p><sec id="S3"><title>Low-power-lower-theta (LPLT) and high-power-higher-theta (HPHT) hippocampal states</title><p id="P6">Instead of prespecifying the definition of network states in terms, for example, of frequency bands, here we used a data-driven, unsupervised model (the HMM, <sup><xref ref-type="bibr" rid="R32">32</xref></sup>) to detect states according to the LFP’s spectral features <sup><xref ref-type="bibr" rid="R33">33</xref></sup>. The HMM, run on the broadband LFP data (<xref ref-type="fig" rid="F2">Figure 2A</xref>), identified one state with low power and a peak in the lower theta (7-8 Hz) frequency band (LPLT), and another with high power (1.2 to 3 times higher than that of LPLT) and a peak in the higher theta (8-9 Hz; HPHT). These results were robust and consistent across all subjects. <xref ref-type="fig" rid="F2">Figure 2B</xref> shows the states’ power spectra; and <xref ref-type="fig" rid="F2">Figure 2C</xref> shows the states fractional occupancy (defined as the proportion of time that a state was active in total) and lifetime (the average duration of each state activation). Both temporal (e.g., most states activations lasting between 0.2 and 0.6 seconds) and spectral (e.g. the theta dominance) features suggest that neither of the two states represents a motion artefact.</p><p id="P7">To investigate whether the states were linked to different phases of theta, we computed the periodicity of their activation. We found that the states reoccurred predominantly with a period of 0.5 to 1.2 seconds, indicating no direct link to the theta phase (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 1</xref>). This is important because the effect we describe here is not related to phase, but to frequency and amplitude.</p><p id="P8">To investigate whether the state activations indexed the activation of distinct neural subpopulations, we inspected the average firing rate of each neuron during both states. Many neurons showed significant differences in firing rate between the two states, with the HPHT state generally associated with higher firing rates. However, most neurons were active during both states (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2</xref>). To further clarify the relation between firing neurons and state activation, we tried to predict the state activation from the neural activity. For this analysis, to be able to assess if there is an effect above and beyond the average neural firing rate, we standardised the signal across neurons, for each trial and time point, such that regardless of which state is active the gross amount of firing is the same for all trials. The prediction accuracy for the states activation was generally close to chance level (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3</xref>), indicating that there is no clear correspondence between an active state and a specific subpopulation of neurons.</p><p id="P9">To explore whether the states were related to experimental variables, we examined their temporal distribution relative to trial outcomes (success vs. failure). We found that the states partially reflected trial outcome, with LPLT state being (in three out of four rats) the most active after response for successful trials. For the failed trials, however, each state was on average active for half of the trials (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 4</xref>).</p><p id="P10">To summarize, our data-driven detected network states showed consistent characteristics across animals, with a LPLT state being generally the most active during rewarded trials, and a HPHT state typically involving higher firing rate from all neurons. Our analyses suggested that the states may not necessarily index distinct subpopulations of neurons.</p></sec><sec id="S4"><title>Theta states modulate neurons’ activity with respect to behaviour</title><p id="P11">We asked whether the two theta network states influenced how the neural population reflected a meaningful behavioural aspect of the task, which in this case is trial success or failure, referred to as <italic>trial outcome</italic>. The brain activity linked to this variable may be associated to different cognitive processes, like attentional (which influences the choosing of the correct answer), or emotional (following reward).</p><p id="P12">We used linear regression to predict, one neuron at a time, trial outcome from three factors: the neural activity, the states activation and their interaction (the product between neural activity and states activation, which is one additional regressor). A schematic of this analysis is in <xref ref-type="fig" rid="F1">Figure 1C</xref>. <xref ref-type="fig" rid="F3">Figure 3A</xref> shows prediction error averaged across neurons, using the HMM states and randomly sampled states for comparison. This shows that including the theta states in the regression analysis significantly improved trial outcome prediction, reducing the absolute mean error by 10% to 20% in the time points after response (suggesting a relation to reward instead of attention), with respect to the randomly sampled states. <xref ref-type="fig" rid="F3">Figure 3B</xref> shows statistical significance for each neuron, assessed using permutation testing with 10,000 random permutations (p-values corrected for multiple comparisons). The state-neuron interaction coefficients show how differently the two states affected each neuron’s representation of trial outcome, for each time point; see <xref ref-type="fig" rid="F3">Figure 3C</xref>. The states show differences that are relatively consistent across neurons. This could hint at state effects manifesting at the level of the whole neural ensemble.</p><p id="P13">To summarize, our interaction analysis showed that the two theta network states significantly affect how single neurons in a population fire in response to trial outcome, suggesting population-level effects.</p></sec><sec id="S5"><title>Modulations in mesoscale network activity relate to behaviourally-relevant changes in microscale network activity</title><p id="P14">Our neuron-state interaction analysis showed that the two theta network states significantly improved the prediction of trial outcome. We next quantified the difference between the multivariate patterns of neural population activity associated with each state’s representation of success and failure, by using multivariate regression on all neurons at once.</p><p id="P15">To achieve this, we developed a decoding method that we called <italic>state-conditioned decoding</italic>, where we used the HMM states time courses to separate, per time point, the neural activity into two sets based on the currently active state from the LFP. This separated the trials into two non-overlapping sets per time point, which we then used to decode trial outcome. We quantified differences in population activity patterns between the two states by comparing the decoding accuracy of models trained and tested within the same state (<italic>within-state</italic>) to that of models trained on one state and tested on the other (<italic>cross-state</italic>). <xref ref-type="fig" rid="F1">Figure 1D</xref> shows a schematic of this analysis. Our reasoning was that if the two HMM states induced different neural activity patterns, the cross-state decoding would perform worse than within-state. In fact, for several time points after response, the within-state decoding accuracy was significantly higher than the cross-state. Significance was assessed by permutation testing (10,000 permutations, p&lt;0.05, cluster-wise corrected for multiple comparisons; see <xref ref-type="sec" rid="S8">Methods</xref>). The results in <xref ref-type="fig" rid="F4">Figure 4</xref> suggest that the two HMM states are linked to distinct patterns of multivariate neural activity with respect to trial outcome. Of note, we performed the decoding analysis on three out of four rats, as in one of them (Barat) the number of failed trials was too low to reliably perform state-conditioned decoding.</p><p id="P16">To summarise, our state-conditioned decoding analysis allowed us to investigate the activity of the neural population per state, so that we could ask whether the states differently affected the <italic>ensemble</italic> representation of success and failure. We found that the two states induced patterns of activity that were significantly different in the representation of trial outcome for some timepoints after response. While the neuron-state interaction analysis focused on the states modulation of the firing of individual neurons, state-conditioned decoding analysis explicitly demonstrated that state-driven modulations occur at the level of neural ensemble patterns.</p></sec><sec id="S6"><title>State-related patterns of trial outcome representation share overlapping characteristics</title><p id="P17">As observed, even when the within-state decoding accuracy was significantly higher than the cross-state, the latter remained relatively high. This is due to similarities between the two states’ neural ensemble activity patterns. If the patterns were entirely distinct, cross-state accuracy would be at chance level, while if they were nearly identical, cross-state accuracy would match that of within-state. To explore this, we simulated datasets with varying degrees of overlap between two data subsets, from fully similar, to fully distinct (see <xref ref-type="sec" rid="S8">Methods</xref>). The simulations indicated that our experimental data was best matched when the subsets had an information overlap between 70% and 80% (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 5</xref>). This suggests that, while the two states are distinct, they still share substantial amount of overlapping information.</p></sec></sec><sec id="S7" sec-type="discussion"><title>Discussion</title><p id="P18">This study explores a form of oscillation-to-neuron modulation in the hippocampus of rats performing an odour-memory task, which we refer to as <italic>ensemble pattern modulation</italic>. Using an unsupervised approach, we identified two distinct theta states, low-power-lower theta (LPLT) and high-power-higher theta (HPHT). These states modulated neural ensemble activity with respect to trial outcome. These states did not recruit different neurons but changed how the same population processed information. This suggests a mechanism of functional multiplexing, where the same neurons represent stimuli differently depending on the network configuration <sup><xref ref-type="bibr" rid="R14">14</xref>,<xref ref-type="bibr" rid="R15">15</xref>,<xref ref-type="bibr" rid="R20">20</xref></sup>.</p><p id="P19">Previous research on oscillation-to-neuron modulations in the hippocampus has primarily focused on phase precession, a phenomenon where the phase of theta oscillations influences the firing of single neurons during navigation <sup><xref ref-type="bibr" rid="R22">22</xref></sup>. Our findings show that amplitude and frequency of theta oscillations can also modulate population-level activity.</p><p id="P20">Even though the HMM that we used to detect network states is a purely data-driven model with no neurobiological assumptions or knowledge of the task, the two distinct state peaks within the theta band are reminiscent of different and independent theta generators from regions projecting to the hippocampus, competing to prevail on the system under different behavioural scenarios <sup><xref ref-type="bibr" rid="R34">34</xref>,<xref ref-type="bibr" rid="R35">35</xref></sup>. In <sup><xref ref-type="bibr" rid="R34">34</xref></sup>, the authors speculated that the ventral dentate gyrus (DG), and in particular the ventral mossy cells (MC), may serve as a local theta generator or pacemaker. This followed the results of an in vitro study showing that, in the developing mouse DG, ventral but not dorsal MC exhibit intrinsic burst firing in the absence of synaptic inputs <sup><xref ref-type="bibr" rid="R36">36</xref></sup>. The ventral MC could drive a medial septum-independent theta rhythm in the dorsal hippocampus through their strong bilateral projection to this region <sup><xref ref-type="bibr" rid="R37">37</xref></sup>. Thus, it is possible that the two theta states presented here have distinct origins: one coming from the medial septum <sup><xref ref-type="bibr" rid="R38">38</xref></sup>, and the other from the ventral MC. The exact biological function of these network states, however, remains purely speculative. Of note, the explanation suggested in <sup><xref ref-type="bibr" rid="R34">34</xref></sup> had to do with changes of locomotion speed and novelty, which are different from the type of behaviour analysed here. But it is not unconceivable that the differential functions associated to these theta modes are more widespread than anticipated previously. Further investigation is needed to explore how these states relate to cognitive processes such as task engagement, decision making or learning <sup><xref ref-type="bibr" rid="R27">27</xref></sup>.</p><p id="P21">Future research may explore whether these findings generalize to other animals, brain regions, or tasks. Furthermore, the choice to use two network states in this study was dictated by the structure of the data, particularly the limited number of failed trials. Exploring models with more states will also be addressed in future research.</p><p id="P22">In conclusion, this study suggests that network oscillations in the hippocampus dynamically modulate neural ensemble activity, challenging static models of neural coding <sup><xref ref-type="bibr" rid="R20">20</xref></sup>; and that the hippocampal circuit might process complex variables such as success and failure in multiple ways. This underscores the role of theta oscillations in creating a flexible neural landscape, enabling the hippocampus to adapt to changing cognitive demands <sup><xref ref-type="bibr" rid="R6">6</xref>,<xref ref-type="bibr" rid="R39">39</xref></sup>.</p></sec><sec id="S8" sec-type="methods"><title>Methods</title><sec id="S9"><title>Dataset</title><p id="P23">The data were collected by Shahbaba and colleagues <sup><xref ref-type="bibr" rid="R29">29</xref></sup> and made publicly available. The dataset consists of local field potential (LFP) and spikes recordings from the dorsal CA1 region of five rats performing an odour-memory task. Rats learned a sequence of five different odours. In the experiment, they were presented with an odour at a time and had to identify it as either “in sequence”, if it was naturally following the learnt sequence, or “out of sequence”, if it was placed in a wrong position within the learnt sequence. Rats would judge the odour in sequence by holding their nose in the response port for at least 1.2 s to receive a water reward, or out of sequence by withdrawing their nose before 1.0 s to receive the reward. The data were recorded when rats had learnt to perform the task very well, so that success rate is above 80%. For each rat, one session was recorded. Across animals, the number of trials varied between 140 and 300 and the number of neurons detected varied between 40 and 80. The original sampling frequency of the data was 1kHz.</p></sec><sec id="S10"><title>Data preprocessing</title><p id="P24">The LFP channels recorded from the animals’ hippocampus varied between 18 and 24 across animals. Activity was very highly correlated across channels. For our analysis, we used principal component analysis (PCA; <sup><xref ref-type="bibr" rid="R40">40</xref></sup>) to extract the first principal component (PC1), which explained from 55% to 75 % of the variance. To remove noisy artifacts at lower frequencies, we high-pass filtered PC1, with a cut-off frequency of 4Hz. The LFP of four of the five animals exhibited similar spectral characteristics, while the fifth animal had a very different power spectrum and was discarded due to potential signal contamination (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 6</xref>). Finally, PC1 was downsampled to 250Hz.</p><p id="P25">We computed the spike density from the raw spike data by means of a Gaussian kernel (10ms width; <sup><xref ref-type="bibr" rid="R41">41</xref></sup>). This way, the raw spike data (originally a binary vector per neuron) was represented in a continuous form for subsequent analyses. The data were then standardised per trial and per timepoint, across neurons, so that the population activity had the same mean and standard deviation for each trial and for each time point. We did this so that the neuron time series were not trivially linked to the states activation (since higher average firing rate occurs when the state HPHT is active). As with the LFP, the spike densities were downsampled to 250 Hz.</p></sec><sec id="S11"><title>Definition of states through the HMM-TDE</title><p id="P26">To detect network states, we used a time-delay embedded hidden Markov model (HMM-TDE; <sup><xref ref-type="bibr" rid="R32">32</xref></sup>) on the preprocessed LFP data (see above). The HMM is a data-driven, unsupervised method that automatically detects recurring patterns of activity in the data, referred to as <italic>states</italic>. Importantly, being data-driven, the HMM estimates the states agnostic of any experimental paradigm or trial information in the data. What defines a state depends on the choice of <italic>observation model</italic> of the HMM. In the case of the time-delay embedded (TDE) HMM, the observation model of the states is defined by the autocovariance of the signal, which encodes the spectral properties of the data. The HMM gives a representation of the time-series data in terms of probabilistic sequences of states. From the data, the inference estimates: the states’ autocovariance, the probability of transitioning to a different state or of remaining in the same state, and the initial probabilities. The HMM also outputs the probability of each data point to pertain to a state. An additional algorithmic procedure returns the Viterbi path <sup><xref ref-type="bibr" rid="R42">42</xref></sup>, a categorical state assignment (instead of a probability) for each time point. Both the probabilities and the Viterbi path are referred to as states time courses.</p><p id="P27">The user-defined hyperparameters of HMM-TDE are: <list list-type="simple" id="L1"><list-item><label>-</label><p id="P28">the number of states <italic>K</italic>;</p></list-item><list-item><label>-</label><p id="P29">the lags <italic>L</italic>: the length of the window in which to estimate the data autocovariance, which affects the spectral scales that the states can capture;</p></list-item><list-item><label>-</label><p id="P30">the prior probability δ of remaining in the same state, which influences the states switching rate.</p></list-item></list></p><p id="P31">Here, because of the high class-imbalance of the data with respect to the decoding variable (i.e., data had few failed trials), we chose only <italic>K</italic>=2 states. The lags <italic>L</italic> and the prior probability δ were chosen such that the states would dwell for at least 500ms on average, forcing the states switching rate to be slow enough, so to be able to capture cognitive or physiological processes (typically, of the order of a second <sup><xref ref-type="bibr" rid="R44">44</xref></sup>). In this specific case, we chose <italic>L</italic>=7. δ=1bn for rats Buchanan, Stella and Barat, and δ=10m for Mitt. See <sup><xref ref-type="bibr" rid="R33">33</xref></sup> for the rationale on the effect of modulating the hyperparameters on HMM-TDE.</p><p id="P32">To characterise the states, we computed their power spectrum, lifetime, and fractional occupancy. To examine the states relation to theta phase, we also computed the periodicity of occurrence of the states.</p><p id="P33">The HMM-TDE model, as well as the functions to estimate the states characteristics, was implemented and made publicly available within the python GLHMM toolbox on Github: <ext-link ext-link-type="uri" xlink:href="https://github.com/vidaurre/glhmm">https://github.com/vidaurre/glhmm</ext-link> <sup><xref ref-type="bibr" rid="R45">45</xref></sup>.</p></sec><sec id="S12"><title>Predicting state activations from neural activity</title><p id="P34">To check whether the states captured the activity of different subpopulations of neurons, we used supervised classification to predict the state activations from the neural activity. As the HPHT state generally involved higher firing rate for most neurons, the spike density was standardised per trial and per time point, across neurons. This way, we were able to capture differences that were above and beyond gross levels of activation. The decoding algorithm used was a ridge classifier with a fixed L2 penalty of 0.001. Because of the imbalanced distribution of the states across trials and time points, we implemented a class-balanced training-test decoding analysis: we bootstrapped sets with the same number of trials for train and testing for each state, per time point. We repeated the procedure 100 times, randomly sampling the trials involved in the analysis for each repetition. This way, we ensured a consistent class balance for all time points. We measured accuracy as an average across all bootstrap repetitions, per time point.</p></sec><sec id="S13"><title>Predicting trial outcome from neural activity and state activations</title><p id="P35">To determine the contribution of network states to the prediction of trial outcome, we used standard ridge regression, and permutation testing. Specifically, we aimed at predicting the trial outcome variable Y from three factors: the neural activity, the states activation and their interaction (i.e., the multiplication between the two terms). For each neuron and each timepoint, we have the following regression equation: <disp-formula id="FD1"><mml:math id="M1"><mml:mrow><mml:mi>Y</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>X</mml:mi></mml:msub><mml:mspace width="0.2em"/><mml:mi>X</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>X</mml:mi><mml:mi>G</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.2em"/><mml:mi>X</mml:mi><mml:mspace width="0.2em"/><mml:mi>G</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>G</mml:mi></mml:msub><mml:mspace width="0.2em"/><mml:mi>G</mml:mi><mml:mo>+</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:math></disp-formula> where X is the neural activity for each trial, G indicates whether state HPHT or LPLT is active (with elements equal either to 1 or -1 to indicate which state is active), <italic>w</italic> are the regression coefficients, and the intercept <italic>b</italic> is related to the class balance. In particular, the <italic>w</italic><sub><italic>XG</italic></sub> coefficients reflected the interaction between the states activation and the neurons activity. We computed the regression coefficients that minimize the prediction error, i.e., the mean absolute error between the predicted and true value of Y. We used a small L2 penalty of 0.001. We then bootstrapped the regression analysis (500 bootstraps with replacement) to estimate the confidence interval of these coefficients.</p><p id="P36">To quantify the significance of the states’ contributions in explaining trial outcome, we used permutation testing. Specifically, we compared the mean absolute error from the original regression model, with the network states identified by the HMM, against models using randomly shuffled states (10,000 random permutations). The shuffling was performed by swapping the probability of each state in randomly selected 50% of trials, for each permutation. This gave a p-value for each neuron and for each time point, that we corrected for multiple comparisons using a Benjamini/Hochberg correction <sup><xref ref-type="bibr" rid="R43">43</xref></sup>.</p></sec><sec id="S14"><title>State-conditioned decoding</title><p id="P37">To investigate the effect of the mesoscale activity (represented by the two spectrally-specific network states) on the patterns of population activity reflective of success and failure, we developed a method to decode trial outcome from neural activity. To do so, we first used the HMM state time courses (indicating which state was active at any given point) to divide, at each time point, the neural activity into two non-overlapping sets of trials, each related to the current active state. We then used a ridge classifier (with a small L2 penalty of 0.001) to decode trial outcome from each of the two state-related sets independently, for each time point.</p><p id="P38">Due to the high class-imbalance of the data (as failed trials were less than 20% of the total data), we implemented a custom class-balanced training-test procedure. The procedure consisted of using only a subset of data for training and testing, the same amount from each class. We repeated this step 500 times, randomly sampling the trials for training and testing from each class at each repetition. This gave us a measure of accuracy and a confidence interval for each state and each time point. For example, if at time point <italic>t</italic> the LPLT state-related set contained 100 successful and only 20 failed trials, we would run the LPLT-related decoder at time point t by using only 16 out of the 20 failed trials for training and 4 trials for testing, and 16 trials for training and 4 for testing from the successful trials pool; we would randomly sample (with no repetition) the trials to use for training or testing for each of the 500 permutations. We called our method <italic>state-conditioned decoding</italic>.</p><p id="P39">To quantify the difference between the two network states-related patterns of activity reflective of trial outcome, we compared the decoding accuracy of models trained and tested within the same state (<italic>within-state</italic>) and the accuracy of models trained on one state and tested on the other (<italic>cross-state</italic>). In all cases the models were tested on unseen data during training.</p><p id="P40">To assess the significance of the difference between the state-related population activity patterns, we performed permutation testing. This consisted of randomly assigning trials at each time point to one or the other state, while respecting the original state- and class-balance, for 10,000 random permutations. For each permutation, we performed state-conditioned decoding on the random sets of trials, and computed within-state and cross-state decoding accuracy.</p><p id="P41">The difference between within-state and cross-state decoding accuracy in randomly assigned states was compared to the original difference (i.e., in the analysis performed with the original HMM states), for each time point. We assessed the significance of this difference (within minus cross-state decoding accuracy) in the HMM versus the random states case, by computing a p-value and correcting for multiple comparisons with a cluster-wise approach. This meant that we computed the average of the difference in accuracy, in the HMM and in the random states cases, within a time window of 25 time points (corresponding to 10ms), with a stride of 12 time points. For each of these windows, we computed a p-value. Finally, we corrected the resulting set of p-values for multiple comparisons, using the Benjamini/Hochberg method <sup><xref ref-type="bibr" rid="R43">43</xref></sup>. This was done to ensure multiple comparisons corrections, avoiding too (unnecessarily) strict corrections due to the high time resolution of the data.</p></sec><sec id="S15"><title>Simulations</title><p id="P42">In order to better understand the results from our state-conditioned decoding, especially why the cross-state decoding accuracy was relatively high, even when significantly lower than the within-state decoding accuracy, we used simulations. We generated two sets of data with varying degrees of similarities, run state-conditioned decoding on the synthetic datasets, and compared the results from the various scenarios to our experimental results. For comparison, we also run standard decoding, i.e. decoding without distinguishing between one or the other set of data.</p><p id="P43">For this analysis, we generated two random sets of points and the encoding weights that would make the data carry information. The various scenarios, depicting various degrees of similarities between the two datasets, were controlled by the encoding weights: the two sets would carry identical information (and simply be part of one bigger dataset) if the encoding weights were identical; the scenario with completely different encoding weights represented the extreme of non-overlapping information between the two sets. Every other scenario in between was generated by using overlapping weights, controlled by the parameter α. Here follow the equations of our generative model: <disp-formula id="FD2"><mml:math id="M2"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mspace width="0.2em"/><mml:msub><mml:mi>B</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.2em"/><mml:msub><mml:mi>y</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi>a</mml:mi><mml:mspace width="0.2em"/><mml:msub><mml:mi>B</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>B</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></disp-formula></p><p id="P44">Where <italic>X</italic><sub>1</sub> and <italic>X</italic><sub>2</sub> are random data generated as ~<italic>N</italic>(0,4); the dimensions of <italic>X</italic><sub>1</sub> and <italic>X</italic><sub>2</sub> were made comparable to our experimental data, so we used N=100 as number of trials and p=50 as number of neurons. <italic>ϵ</italic><sub>1</sub> and <italic>ϵ</italic><sub>2</sub> are random gaussian noise distributed as ~<italic>N</italic>(0,1); <italic>B</italic><sub>1</sub> and <italic>B</italic><sub>2</sub> are the encoding weights both distributed as ~<italic>N</italic>(0,4); and <italic>a</italic>, ranging between 0 and 1, indicates the degree of similarity between the two sets of data.</p><p id="P45">Then, we run the decoding analyses to predict the encoded information (and the encoding weights). Within-set and cross-set decoding were run on the two synthetic sets of data, to decode <italic>y</italic><sub>1</sub> and <italic>y</italic><sub>2</sub>. Standard decoding was run on the concatenated sets to predict an overall y (<italic>y</italic><sub>1</sub> and <italic>y</italic><sub>2</sub>, concatenated). The decoding accuracies obtained were then compared to the experimental results.</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary Figures</label><media xlink:href="EMS201946-supplement-Supplementary_Figures.pdf" mimetype="application" mime-subtype="pdf" id="d125aAcEbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S16"><title>Acknowledgements</title><p>DV is supported by a Novo Nordisk Foundation Emerging Investigator Fellowship (NNF19OC-0054895) and an ERC Starting Grant (ERC-StG-2019-850404). The authors would also like to thank the Wellcome Trust for support (106183/Z/14/Z, 215573/Z/19/Z). Finally, the authors would like to thank Norbert Fortin and Keiland Cooper for providing the raw data, together with task information and insights into the data structure.</p></ack><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stringer</surname><given-names>C</given-names></name><etal/></person-group><article-title>Spontaneous behaviors drive multidimensional, brainwide activity</article-title><source>Science (1979)</source><year>2019</year><volume>364</volume><pub-id pub-id-type="pmcid">PMC6525101</pub-id><pub-id pub-id-type="pmid">31000656</pub-id><pub-id pub-id-type="doi">10.1126/science.aav7893</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Buzaski</surname></name></person-group><source>The Brain from Inside and Out</source><year>2019</year><publisher-loc>Oxford</publisher-loc></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grün</surname><given-names>S</given-names></name><etal/></person-group><article-title>Emerging principles of spacetime in brains: Meeting report on spatial neurodynamics</article-title><source>Neuron</source><year>2022</year><volume>110</volume><pub-id pub-id-type="pmid">35709696</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gutnisky</surname><given-names>DA</given-names></name><name><surname>Beaman</surname><given-names>CB</given-names></name><name><surname>Lew</surname><given-names>SE</given-names></name><name><surname>Dragoi</surname><given-names>V</given-names></name></person-group><article-title>Spontaneous fluctuations in visual cortical responses influence population coding accuracy</article-title><source>Cerebral Cortex</source><year>2017</year><volume>27</volume><pub-id pub-id-type="pmcid">PMC6222251</pub-id><pub-id pub-id-type="pmid">26744543</pub-id><pub-id pub-id-type="doi">10.1093/cercor/bhv312</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mazzucato</surname><given-names>L</given-names></name><name><surname>La Camera</surname><given-names>G</given-names></name><name><surname>Fontanini</surname><given-names>A</given-names></name></person-group><article-title>Expectation-induced modulation of metastable activity underlies faster coding of sensory stimuli</article-title><source>Nat Neurosci</source><year>2019</year><volume>22</volume><pub-id pub-id-type="pmcid">PMC6516078</pub-id><pub-id pub-id-type="pmid">30936557</pub-id><pub-id pub-id-type="doi">10.1038/s41593-019-0364-9</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kennedy</surname><given-names>PJ</given-names></name><name><surname>Shapiro</surname><given-names>ML</given-names></name></person-group><article-title>Motivational states activate distinct hippocampal representations to guide goal-directed behaviors</article-title><source>Proc Natl Acad Sci U S A</source><year>2009</year><volume>106</volume><pub-id pub-id-type="pmcid">PMC2705558</pub-id><pub-id pub-id-type="pmid">19528659</pub-id><pub-id pub-id-type="doi">10.1073/pnas.0903259106</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Staszko</surname><given-names>SM</given-names></name><name><surname>Boughter</surname><given-names>JD</given-names></name><name><surname>Fletcher</surname><given-names>ML</given-names></name></person-group><article-title>The impact of familiarity on cortical taste coding</article-title><source>Current Biology</source><year>2022</year><volume>32</volume><pub-id pub-id-type="pmcid">PMC9691541</pub-id><pub-id pub-id-type="pmid">36261035</pub-id><pub-id pub-id-type="doi">10.1016/j.cub.2022.09.053</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kisley</surname><given-names>MA</given-names></name><name><surname>Gerstein</surname><given-names>GL</given-names></name></person-group><article-title>Trial-to-trial variability and state-dependent modulation of auditory-evoked responses in cortex</article-title><source>Journal of Neuroscience</source><year>1999</year><volume>19</volume><pub-id pub-id-type="pmcid">PMC6782416</pub-id><pub-id pub-id-type="pmid">10575042</pub-id><pub-id pub-id-type="doi">10.1523/JNEUROSCI.19-23-10451.1999</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schölvinck</surname><given-names>ML</given-names></name><name><surname>Saleem</surname><given-names>AB</given-names></name><name><surname>Benucci</surname><given-names>A</given-names></name><name><surname>Harris</surname><given-names>KD</given-names></name><name><surname>Carandini</surname><given-names>M</given-names></name></person-group><article-title>Cortical state determines global variability and correlations in visual cortex</article-title><source>Journal of Neuroscience</source><year>2015</year><volume>35</volume><pub-id pub-id-type="pmcid">PMC4287140</pub-id><pub-id pub-id-type="pmid">25568112</pub-id><pub-id pub-id-type="doi">10.1523/JNEUROSCI.4994-13.2015</pub-id></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jones</surname><given-names>LM</given-names></name><name><surname>Fontanini</surname><given-names>A</given-names></name><name><surname>Sadacca</surname><given-names>BF</given-names></name><name><surname>Miller</surname><given-names>P</given-names></name><name><surname>Katz</surname><given-names>DB</given-names></name></person-group><article-title>Natural stimuli evoke dynamic sequences of states in sensory cortical ensembles</article-title><source>Proc Natl Acad Sci U S A</source><year>2007</year><volume>104</volume><pub-id pub-id-type="pmcid">PMC2141852</pub-id><pub-id pub-id-type="pmid">18000059</pub-id><pub-id pub-id-type="doi">10.1073/pnas.0705546104</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sederberg</surname><given-names>AJ</given-names></name><name><surname>Pala</surname><given-names>A</given-names></name><name><surname>Zheng</surname><given-names>HJV</given-names></name><name><surname>He</surname><given-names>BJ</given-names></name><name><surname>Stanley</surname><given-names>GB</given-names></name></person-group><article-title>State-aware detection of sensory stimuli in the cortex of the awake mouse</article-title><source>PLoS Comput Biol</source><year>2019</year><volume>15</volume><pub-id pub-id-type="pmcid">PMC6561583</pub-id><pub-id pub-id-type="pmid">31150385</pub-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1006716</pub-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Murakami</surname><given-names>M</given-names></name><name><surname>Kashiwadani</surname><given-names>H</given-names></name><name><surname>Kirino</surname><given-names>Y</given-names></name><name><surname>Mori</surname><given-names>K</given-names></name></person-group><article-title>State-dependent sensory gating in olfactory cortex</article-title><source>Neuron</source><year>2005</year><volume>46</volume><pub-id pub-id-type="pmid">15848806</pub-id></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fontanini</surname><given-names>A</given-names></name><name><surname>Katz</surname><given-names>DB</given-names></name></person-group><article-title>State-dependent modulation of time-varying gustatory responses</article-title><source>J Neurophysiol</source><year>2006</year><volume>96</volume><pub-id pub-id-type="pmid">16928791</pub-id></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fontanini</surname><given-names>A</given-names></name><name><surname>Katz</surname><given-names>DB</given-names></name></person-group><article-title>Behavioral states, network states, and sensory response variability</article-title><source>Journal of Neurophysiology</source><year>2008</year><volume>100</volume><comment>Preprint</comment><pub-id pub-id-type="pmcid">PMC2544460</pub-id><pub-id pub-id-type="pmid">18614753</pub-id><pub-id pub-id-type="doi">10.1152/jn.90592.2008</pub-id></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buonomano</surname><given-names>DV</given-names></name><name><surname>Maass</surname><given-names>W</given-names></name></person-group><article-title>State-dependent computations: Spatiotemporal processing in cortical networks</article-title><source>Nature Reviews Neuroscience</source><year>2009</year><volume>10</volume><comment>Preprint</comment><pub-id pub-id-type="pmid">19145235</pub-id></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McCormick</surname><given-names>DA</given-names></name><name><surname>Nestvogel</surname><given-names>DB</given-names></name><name><surname>He</surname><given-names>BJ</given-names></name></person-group><article-title>Neuromodulation of Brain State and Behavior</article-title><source>Annual Review of Neuroscience</source><year>2020</year><volume>43</volume><comment>Preprint</comment><pub-id pub-id-type="pmid">32250724</pub-id></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fazlali</surname><given-names>Z</given-names></name><name><surname>Ranjbar-Slamloo</surname><given-names>Y</given-names></name><name><surname>Adibi</surname><given-names>M</given-names></name><name><surname>Arabzadeh</surname><given-names>E</given-names></name></person-group><article-title>Correlation between cortical state and locus coeruleus activity: Implications for sensory coding in rat barrel cortex</article-title><source>Front Neural Circuits</source><year>2016</year><volume>10</volume><pub-id pub-id-type="pmcid">PMC4805600</pub-id><pub-id pub-id-type="pmid">27047339</pub-id><pub-id pub-id-type="doi">10.3389/fncir.2016.00014</pub-id></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marques</surname><given-names>JC</given-names></name><name><surname>Li</surname><given-names>M</given-names></name><name><surname>Schaak</surname><given-names>D</given-names></name><name><surname>Robson</surname><given-names>DN</given-names></name><name><surname>Li</surname><given-names>JM</given-names></name></person-group><article-title>Internal state dynamics shape brainwide activity and foraging behaviour</article-title><source>Nature</source><year>2020</year><volume>577</volume><pub-id pub-id-type="pmid">31853063</pub-id></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Allen</surname><given-names>WE</given-names></name><etal/></person-group><article-title>Thirst regulates motivated behavior through modulation of brainwide neural population dynamics</article-title><source>Science (1979)</source><year>2019</year><volume>364</volume><pub-id pub-id-type="pmcid">PMC6711472</pub-id><pub-id pub-id-type="pmid">30948440</pub-id><pub-id pub-id-type="doi">10.1126/science.aav3932</pub-id></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lin</surname><given-names>JY</given-names></name><etal/></person-group><article-title>The function of groups of neurons changes from moment to moment</article-title><source>Current Opinion in Physiology</source><year>2021</year><volume>20</volume><comment>Preprint</comment><pub-id pub-id-type="pmcid">PMC8967145</pub-id><pub-id pub-id-type="pmid">35372737</pub-id><pub-id pub-id-type="doi">10.1016/j.cophys.2020.12.002</pub-id></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzsáki</surname><given-names>G</given-names></name></person-group><source>Rhythms of the Brain</source><year>2009</year><comment>Rhythms of the Brain</comment><pub-id pub-id-type="doi">10.1093/acprof:oso/9780195301069.001.0001</pub-id></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Colgin</surname><given-names>LL</given-names></name></person-group><article-title>Rhythms of the hippocampal network</article-title><source>Nature Reviews Neuroscience</source><year>2016</year><volume>17</volume><comment>Preprint</comment><pub-id pub-id-type="pmcid">PMC4890574</pub-id><pub-id pub-id-type="pmid">26961163</pub-id><pub-id pub-id-type="doi">10.1038/nrn.2016.21</pub-id></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lisman</surname><given-names>JE</given-names></name><name><surname>Jensen</surname><given-names>O</given-names></name></person-group><article-title>The Theta-Gamma Neural Code</article-title><source>Neuron</source><year>2013</year><volume>77</volume><comment>Preprint</comment><pub-id pub-id-type="pmcid">PMC3648857</pub-id><pub-id pub-id-type="pmid">23522038</pub-id><pub-id pub-id-type="doi">10.1016/j.neuron.2013.03.007</pub-id></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzsáki</surname><given-names>G</given-names></name></person-group><article-title>Theta rhythm of navigation: Link between path integration and landmark navigation, episodic and semantic memory</article-title><source>Hippocampus</source><year>2005</year><volume>15</volume><comment>Preprint</comment><pub-id pub-id-type="pmid">16149082</pub-id></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Muzzio</surname><given-names>IA</given-names></name><name><surname>Kentros</surname><given-names>C</given-names></name><name><surname>Kandel</surname><given-names>E</given-names></name></person-group><article-title>What is remembered? Role of attention on the encoding and retrieval of hippocampal representations</article-title><source>Journal of Physiology</source><year>2009</year><volume>587</volume><comment>Preprint</comment><pub-id pub-id-type="pmcid">PMC2718243</pub-id><pub-id pub-id-type="pmid">19525568</pub-id><pub-id pub-id-type="doi">10.1113/jphysiol.2009.172445</pub-id></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Muzzio</surname><given-names>IA</given-names></name><etal/></person-group><article-title>Attention enhances the retrieval and stability of visuospatial and olfactory representations in the dorsal hippocampus</article-title><source>PLoS Biol</source><year>2009</year><volume>7</volume><pub-id pub-id-type="pmcid">PMC2696347</pub-id><pub-id pub-id-type="pmid">19564903</pub-id><pub-id pub-id-type="doi">10.1371/journal.pbio.1000140</pub-id></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Korotkova</surname><given-names>T</given-names></name><etal/></person-group><article-title>Reconciling the different faces of hippocampal theta: The role of theta oscillations in cognitive, emotional and innate behaviors</article-title><source>Neuroscience and Biobehavioral Reviews</source><year>2018</year><volume>85</volume><comment>Preprint</comment><pub-id pub-id-type="pmid">28887226</pub-id></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>O’Keefe</surname><given-names>J</given-names></name><name><surname>Recce</surname><given-names>ML</given-names></name></person-group><article-title>Phase relationship between hippocampal place units and the EEG theta rhythm</article-title><source>Hippocampus</source><year>1993</year><volume>3</volume><pub-id pub-id-type="pmid">8353611</pub-id></element-citation></ref><ref id="R29"><label>29</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shahbaba</surname><given-names>B</given-names></name><etal/></person-group><article-title>Hippocampal ensembles represent sequential relationships among an extended sequence of nonspatial events</article-title><source>Nat Commun</source><year>2022</year><volume>13</volume><pub-id pub-id-type="pmcid">PMC8825855</pub-id><pub-id pub-id-type="pmid">35136052</pub-id><pub-id pub-id-type="doi">10.1038/s41467-022-28057-6</pub-id></element-citation></ref><ref id="R30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rabiner</surname><given-names>LR</given-names></name></person-group><article-title>A Tutorial on Hidden Markov Models and Selected Applications in Speech Recognition</article-title><source>Proceedings of the IEEE</source><year>1989</year><volume>77</volume></element-citation></ref><ref id="R31"><label>31</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vidaurre</surname><given-names>D</given-names></name><etal/></person-group><article-title>Spectrally resolved fast transient brain states in electrophysiological data</article-title><source>Neuroimage</source><year>2016</year><volume>126</volume><fpage>81</fpage><lpage>95</lpage><pub-id pub-id-type="pmcid">PMC4739513</pub-id><pub-id pub-id-type="pmid">26631815</pub-id><pub-id pub-id-type="doi">10.1016/j.neuroimage.2015.11.047</pub-id></element-citation></ref><ref id="R32"><label>32</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vidaurre</surname><given-names>D</given-names></name><etal/></person-group><article-title>Spontaneous cortical activity transiently organises into frequency specific phase-coupling networks</article-title><source>Nat Commun</source><year>2018</year><volume>9</volume><pub-id pub-id-type="pmcid">PMC6065434</pub-id><pub-id pub-id-type="pmid">30061566</pub-id><pub-id pub-id-type="doi">10.1038/s41467-018-05316-z</pub-id></element-citation></ref><ref id="R33"><label>33</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Masaracchia</surname><given-names>L</given-names></name><name><surname>Fredes</surname><given-names>F</given-names></name><name><surname>Woolrich</surname><given-names>MW</given-names></name><name><surname>Vidaurre</surname><given-names>D</given-names></name></person-group><article-title>Dissecting unsupervised learning through hidden Markov modeling in electrophysiological data</article-title><source>J Neurophysiol</source><year>2023</year><volume>130</volume><fpage>364</fpage><lpage>379</lpage><pub-id pub-id-type="pmcid">PMC10625837</pub-id><pub-id pub-id-type="pmid">37403598</pub-id><pub-id pub-id-type="doi">10.1152/jn.00054.2023</pub-id></element-citation></ref><ref id="R34"><label>34</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fredes</surname><given-names>F</given-names></name><name><surname>Shigemoto</surname><given-names>R</given-names></name></person-group><article-title>The role of hippocampal mossy cells in novelty detection</article-title><source>Neurobiol Learn Mem</source><year>2021</year><volume>183</volume><pub-id pub-id-type="pmid">34214666</pub-id></element-citation></ref><ref id="R35"><label>35</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>López-Madrona</surname><given-names>VJ</given-names></name><etal/></person-group><article-title>Different theta frameworks coexist in the rat hippocampus and are coordinated during memory-guided and novelty tasks</article-title><source>Elife</source><year>2020</year><volume>9</volume><pub-id pub-id-type="pmcid">PMC7413668</pub-id><pub-id pub-id-type="pmid">32687054</pub-id><pub-id pub-id-type="doi">10.7554/eLife.57313</pub-id></element-citation></ref><ref id="R36"><label>36</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jinno</surname><given-names>S</given-names></name><name><surname>Ishizuka</surname><given-names>S</given-names></name><name><surname>Kosaka</surname><given-names>T</given-names></name></person-group><article-title>Ionic currents underlying rhythmic bursting of ventral mossy cells in the developing mouse dentate gyrus</article-title><source>European Journal of Neuroscience</source><year>2003</year><volume>17</volume><pub-id pub-id-type="pmid">12713637</pub-id></element-citation></ref><ref id="R37"><label>37</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fredes</surname><given-names>F</given-names></name><etal/></person-group><article-title>Ventro-dorsal Hippocampal Pathway Gates Novelty-Induced Contextual Memory Formation</article-title><source>Current Biology</source><year>2021</year><volume>31</volume><pub-id pub-id-type="pmcid">PMC7808756</pub-id><pub-id pub-id-type="pmid">33065009</pub-id><pub-id pub-id-type="doi">10.1016/j.cub.2020.09.074</pub-id></element-citation></ref><ref id="R38"><label>38</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>Y</given-names></name><name><surname>Romani</surname><given-names>S</given-names></name><name><surname>Lustig</surname><given-names>B</given-names></name><name><surname>Leonardo</surname><given-names>A</given-names></name><name><surname>Pastalkova</surname><given-names>E</given-names></name></person-group><article-title>Theta sequences are essential for internally generated hippocampal firing fields</article-title><source>Nat Neurosci</source><year>2015</year><volume>18</volume><pub-id pub-id-type="pmid">25531571</pub-id></element-citation></ref><ref id="R39"><label>39</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Turner</surname><given-names>VS</given-names></name><name><surname>O’Sullivan</surname><given-names>RO</given-names></name><name><surname>Kheirbek</surname><given-names>MA</given-names></name></person-group><article-title>Linking external stimuli with internal drives: A role for the ventral hippocampus</article-title><source>Current Opinion in Neurobiology</source><year>2022</year><volume>76</volume><pub-id pub-id-type="pmcid">PMC9818033</pub-id><pub-id pub-id-type="pmid">35753108</pub-id><pub-id pub-id-type="doi">10.1016/j.conb.2022.102590</pub-id></element-citation></ref><ref id="R40"><label>40</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jollife</surname><given-names>IT</given-names></name><name><surname>Cadima</surname><given-names>J</given-names></name></person-group><article-title>Principal component analysis: A review and recent developments</article-title><source>Philosophical Transactions of the Royal Society A: Mathematical, Physical and Engineering Sciences</source><year>2016</year><volume>374</volume><pub-id pub-id-type="pmcid">PMC4792409</pub-id><pub-id pub-id-type="pmid">26953178</pub-id><pub-id pub-id-type="doi">10.1098/rsta.2015.0202</pub-id></element-citation></ref><ref id="R41"><label>41</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rasmussen</surname><given-names>CE</given-names></name><name><surname>Williams</surname><given-names>CKI</given-names></name></person-group><article-title>Gaussian Processes for Machine Learning</article-title><source>Gaussian Processes for Machine Learning</source><year>2005</year><pub-id pub-id-type="doi">10.7551/mitpress/3206.001.0001</pub-id></element-citation></ref><ref id="R42"><label>42</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Forney</surname><given-names>GD</given-names></name></person-group><article-title>The Viterbi Algorithm</article-title><source>Proceedings of the IEEE</source><year>1973</year><volume>61</volume></element-citation></ref><ref id="R43"><label>43</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Benjamini</surname><given-names>Y</given-names></name><name><surname>Hochberg</surname><given-names>Y</given-names></name></person-group><article-title>Controlling the False Discovery Rate: A Practical and Powerful Approach to Multiple Testing</article-title><source>J R Stat Soc Series B Stat Methodol</source><year>1995</year><volume>57</volume></element-citation></ref><ref id="R44"><label>44</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buonomano</surname><given-names>D</given-names></name></person-group><article-title>The biology of time across different scales</article-title><source>Nat Chem Biol</source><year>2007</year><volume>3</volume><fpage>594</fpage><lpage>597</lpage><pub-id pub-id-type="pmid">17876310</pub-id></element-citation></ref><ref id="R45"><label>45</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vidaurre</surname><given-names>D</given-names></name><name><surname>Masaracchia</surname><given-names>L</given-names></name><name><surname>Larsen</surname><given-names>NY</given-names></name><name><surname>Ruijters</surname><given-names>LRT</given-names></name><name><surname>Alonso</surname><given-names>S</given-names></name><name><surname>Ahrends</surname><given-names>C</given-names></name><name><surname>Woolrich</surname><given-names>MW</given-names></name></person-group><article-title>The Gaussian-Linear Hidden Markov model: a Python package</article-title><source>arXiv preprint</source><year>2023</year><elocation-id>arXiv:2312.07151</elocation-id></element-citation></ref></ref-list></back><floats-group><boxed-text id="BX1" position="float" orientation="portrait"><caption><title>Significance statement</title></caption><p>The brain’s ability to process information flexibly is crucial for adapting to changing environments and cognitive demands. This study sheds light on how brain states, reflected in hippocampal theta oscillations, dynamically influence the activity of neural ensembles. Using a data-driven approach, we identify two distinct theta states—low-power-lower-theta (LPLT) and high-power-higher-theta (HPHT)— and show that these states enable the same neural population to encode different aspects of information, depending on the cognitive context. This mechanism, which we term ensemble pattern modulation, advances our understanding of how brain states enable adaptive information processing to achieve functional flexibility.</p></boxed-text><fig id="F1" position="float"><label>Figure 1</label><caption><title>Basic illustration of the hypothesis and analyses</title><p><bold>A</bold>. <italic>Population representations and network states</italic>. Neural population representation of an input depends on the state of the network in which the neurons are embedded. Here we show a visual example of our underlying hypothesis: dorsal CA1 neurons’ response to an input (for example, reward after a successful trial) varies with the network configuration (e.g., state A or B). Network activity is here represented by the LFP signal. <bold>B</bold>. <italic>Finding network states:</italic> an HMM with K=2 states is run on the continuous LFP data (top row). The HMM assigns a state to each point of the LFP data (state time courses with the signal in middle row). The state time courses are overlied on the spike data, associating the activity of the neural population at each time point to a state. All the data are then epoched into trials. <bold>C</bold>. <italic>Schematic of the neuron-state interaction analysis</italic>: we predict trial outcome from three predictors: neural activity, state activation and their interaction (the product of neural activity and state activation), per neuron and per time point. The states contribution is quantified by means of permutation testing, comparing the prediction error of this model with another using random states (10,000 random permutations). <bold>D</bold>. <italic>Schematic of state-conditioned decoding:</italic> for each time point, trials of neural activity (X) are grouped into two sets, depending on the state activation at that time point (e.g., state A or B). Then, a decoder is used to predict trial outcome (Y) from each state-related set of trials (and for each time point), independently, in a custom train-test, class-balanced decoding procedure. We perform two measures, a within-state prediction (from a decoder trained and tested on the same state), and a cross-state prediction (from a decoder trained on one state and tested on the other). These two measures are then compared to the analogous analysis performed on randomly assigned states, with 10,000 random permutations.</p></caption><graphic xlink:href="EMS201946-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><p><bold>A</bold>. <italic>Example of signal and HMM states</italic>. An example of the HMM state assignment of the LFP data, for each rat. <bold>B</bold>. <italic>Power spectra of the two HMM states</italic>. Frequency and power content of each state for each rat individually. The HMM consistently finds a high-power, higher theta (HPHT, red) and low-power, lower theta (LPLT, yellow) state. <bold>C</bold>. <italic>States lifetime and fractional occupancy</italic>. The count of the time length of each state occurrence, per state and per rat. Fractional occupancy (FO) accounts for the overall presence of a state in the entire dataset. Both FO and states lifetime are comparable across states.</p></caption><graphic xlink:href="EMS201946-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><p><bold>A</bold>. <italic>Trial outcome prediction error</italic>. The plots show, for each animal, the prediction error of trial outcome. The regression analysis was performed per neuron and per time point, including the original HMM states (blue), and then, for comparison, including surrogate states (cyan, 10,000 random permutations). We show the mean absolute error (MAE) and their difference (grey bars), averaged across neurons. <bold>B</bold>. <italic>Significance of the states’ contribution to the prediction of trial outcome</italic>. P-value of permutation testing analysis, showing how significantly lower is the regression error predicting trial outcome from neural activity, HMM states and their interaction, with respect to randomly assigned states (10,000 permutations). The significance (Benjamini/Hochberg corrected) is stronger for p-values smaller than 0.05 (colour lighter than purple). <bold>C</bold>. <italic>Difference in the states’ contribution to the prediction of trial outcome</italic>. The regression coefficients linked to the state-neuron interaction, reflecting the difference in the two states’ contribution to the prediction of trial outcome. Non-zero coefficients are shown (95% CI). Highlighted within the green window are points where the states have a significant effect on the prediction of trial outcome. Positive values mean that the HPHT state’s coefficients are bigger than the LPLT ones. Stripes of the same colour indicate the states have the same relation across neurons at one specific time point (or cluster of points).</p></caption><graphic xlink:href="EMS201946-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>State-conditioned decoding, within-state vs. cross-state accuracy.</title><p>Comparison between within-state (i.e., training and testing on the same state) and cross-state (training on one state and testing on the other) accuracy, for the state-conditioned decoding analysis. Permutation testing (10,000 permutations, p&lt;0.05, cluster-wise Benjamini/Hochberg corrected) is used to assess if the within-state accuracy is significantly higher than the cross-state accuracy, with respect to surrogate states. Grey bars indicate the value of the difference. Green stars indicate which points are significant.</p></caption><graphic xlink:href="EMS201946-f004"/></fig></floats-group></article>