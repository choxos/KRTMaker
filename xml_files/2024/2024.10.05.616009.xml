<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="epub">2692-8205</issn></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS199277</article-id><article-id pub-id-type="doi">10.1101/2024.10.05.616009</article-id><article-id pub-id-type="archive">PPR920565</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Cooperation shapes bacterial niche breadth evolution and patterns of diversification</article-title></title-group><contrib-group><contrib contrib-type="author" equal-contrib="yes"><name><surname>Hao</surname><given-names>Chunhui</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib><contrib contrib-type="author" equal-contrib="yes"><name><surname>Konno</surname><given-names>Naoki</given-names></name><xref ref-type="aff" rid="A3">3</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib><contrib contrib-type="author"><name><surname>Ito</surname><given-names>Makoto</given-names></name><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Belcher</surname><given-names>Laurence J.</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Iwasaki</surname><given-names>Wataru</given-names></name><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>West</surname><given-names>Stuart A.</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib></contrib-group><aff id="A1"><label>1</label>Department of Biology, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/052gg0110</institution-id><institution>University of Oxford</institution></institution-wrap>, <city>Oxford</city>, <postal-code>OX1 3SZ</postal-code>, <country country="GB">United Kingdom</country></aff><aff id="A2"><label>2</label>Department of Ecology, School of Life Science, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/01rxvg760</institution-id><institution>Nanjing University</institution></institution-wrap>, <addr-line>163 Xianlin Avenue</addr-line>, <city>Nanjing</city>, <postal-code>210023</postal-code>, <country country="CN">China</country></aff><aff id="A3"><label>3</label>Department of Biological Sciences, Graduate School of Science, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/057zh3y96</institution-id><institution>The University of Tokyo</institution></institution-wrap>, <city>Bunkyo-ku, Tokyo</city>, <country country="JP">Japan</country></aff><aff id="A4"><label>4</label>Department of Integrated Biosciences, Graduate School of Frontier Sciences, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/057zh3y96</institution-id><institution>The University of Tokyo</institution></institution-wrap>, <city>Kashiwa, Chiba</city>, <country country="JP">Japan</country></aff><author-notes><corresp id="CR1">
<label>*</label>Correspondence should be addressed to C.H. (<email>haochunhui1996@gmail.com</email>) and N.K. (<email>konno-naoki555@g.ecc.u-tokyo.ac.jp</email>).</corresp></author-notes><pub-date pub-type="nihms-submitted"><day>09</day><month>10</month><year>2024</year></pub-date><pub-date pub-type="preprint"><day>06</day><month>10</month><year>2024</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Bacteria exhibit varying niche breadths, with generalists thriving in diverse environments and specialists confined to specific habitats. This variability reflects the adaptability of bacteria to their environment and may influence their speciation and extinction rates. We used phylogenetic causal inference and diversification analysis techniques to investigate the influence of cooperation on bacterial niche breadth evolution and patterns of diversification across 25,785 species. We found: (1) a positive correlation between the proportion of genes for cooperation and niche breadth; (2) a decreased proportion of genes for cooperation promotes niche contraction; and (3) species with a higher proportion of genes for cooperation show increased speciation and extinction rates when their niche breadths are narrower. Our study highlights the role of genes for cooperation in shaping both niche breadth and diversification of bacteria, underscoring their critical function in maintaining the ecological versatility and diversity of bacteria.</p></abstract></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P2">Bacteria exhibit remarkable diversity and adaptability, thriving in a wide range of environments<sup><xref ref-type="bibr" rid="R1">1</xref>–<xref ref-type="bibr" rid="R5">5</xref></sup>. The concept of niche breadth, which refers to the variety of habitats a species can inhabit, can help us understand the global patterns in bacterial diversity. Certain bacterial species are “habitat generalists,” capable of living in a diverse range of environments, while others are “habitat specialists,” restricted to very specific niches<sup><xref ref-type="bibr" rid="R6">6</xref>–<xref ref-type="bibr" rid="R8">8</xref></sup>. Unravelling the mechanisms that can explain this variability in bacterial niche breadth remains a major challenge for evolutionary and ecological research<sup><xref ref-type="bibr" rid="R9">9</xref>–<xref ref-type="bibr" rid="R13">13</xref></sup>.</p><p id="P3">One factor that may play a significant role in bacterial niche breadth evolution is cooperation. Bacteria produce and release a diversity of factors that facilitate growth for the local population of cells, and hence act as cooperative ‘public goods’<sup><xref ref-type="bibr" rid="R14">14</xref>–<xref ref-type="bibr" rid="R17">17</xref></sup> (<xref ref-type="fig" rid="F1">Figure 1a</xref>). These factors play a key role in the ability of bacteria to grow in different environments. For instance, iron scavenging siderophore molecules can increase iron uptake in environments where this mineral is scarce<sup><xref ref-type="bibr" rid="R18">18</xref></sup>. Previous studies proposed that cooperation facilitates niche expansion and found evidence to support this hypothesis, showing that species inhabiting more habitats possess more genes for extracellular proteins<sup><xref ref-type="bibr" rid="R19">19</xref>,<xref ref-type="bibr" rid="R20">20</xref></sup>. These proteins are likely to behave as cooperative ‘public goods’ because they will often diffuse away from the producing cell and so their benefit is shared with neighbouring cells<sup><xref ref-type="bibr" rid="R21">21</xref>–<xref ref-type="bibr" rid="R24">24</xref></sup>.</p><p id="P4">The hypothesis that cooperation favours niche expansion could however be incorrect. An alternative explanation for the data is that causation is in the opposite direction — an initial expansion into new niches could increase the utility of genes for cooperation, making them more prevalent in generalists. In this case, mechanisms such as metabolic flexibility or bacterial motility might actually be the main drivers for niche expansion, with increased cooperation emerging as a by-product of niche expansion<sup><xref ref-type="bibr" rid="R13">13</xref>,<xref ref-type="bibr" rid="R25">25</xref>–<xref ref-type="bibr" rid="R27">27</xref></sup>. Another possibility is that the relationship between bacterial niche breadth and cooperation might not be causal at all, but instead could be influenced by a third, unidentified variable correlated with both<sup><xref ref-type="bibr" rid="R28">28</xref>,<xref ref-type="bibr" rid="R29">29</xref></sup>. These alternative explanations can only be distinguished by testing for different hypotheses about the causal relationship between bacterial cooperation and niche breadth evolution.</p><p id="P5">Niche breadth evolution and cooperation could also play key roles in shaping bacterial diversification<sup><xref ref-type="bibr" rid="R30">30</xref></sup>. Previous studies have suggested that species with broader niche breadths may experience higher diversification rates, likely due to their exposure to diverse environments, each imposing unique selective pressure<sup><xref ref-type="bibr" rid="R9">9</xref>,<xref ref-type="bibr" rid="R31">31</xref></sup>. These studies, however, have primarily focused on niche breadth, leaving open the possibility that the observed relationship between niche breadth and diversification rates is either an artefact or mediated by cooperation (<xref ref-type="fig" rid="F1">Figure 1b</xref>). For instance, a higher rate of cooperation could directly facilitate diversification, resulting in an indirect correlation between niche breadth and diversification.</p><p id="P6">We investigated (1) the role of bacterial cooperation in niche breadth evolution and (2) the influence of both niche breadth and cooperation on bacterial diversification. We used improved ways to characterize the niche breadths and identify genes for cooperative traits in 25,785 bacterial species using their genomic data. Based on these data, we applied phylogeny-based analytical approaches to examine correlations between bacterial cooperation and niche breadth evolution, and to test various causal hypotheses underlying these correlations. Finally, we explored the collective effect of niche breadth and cooperation on shaping bacterial diversification rates and elucidated the taxonomic variations in these patterns.</p></sec><sec id="S2" sec-type="results"><title>Results</title><sec id="S3"><title>Niche breadth assessment</title><p id="P7">We obtained the genomes of 62,291 bacterial species from the Genome Taxonomy Database (GTDB<sup><xref ref-type="bibr" rid="R32">32</xref></sup>). To assess their niche breadth, we first inferred the habitat preferences of species in our dataset possessing full-length 16S rRNA gene sequences. We successfully annotated the habitat preferences for 32,262 species using ProkAtlas, a database containing environmental 16S rRNA gene sequences from 114 distinct habitats like soil, human gut, and seawater<sup><xref ref-type="bibr" rid="R33">33</xref></sup> (<xref ref-type="supplementary-material" rid="SD1">Figure E1</xref>).</p><p id="P8">A potential problem with such habitat classifications is that they could be influenced by human biases. Environments that we classify as distinct could be functionally similar habitats for bacteria<sup><xref ref-type="bibr" rid="R34">34</xref></sup>. To address this, we used a method that grouped similar habitats into “habitat clusters” based on species composition<sup><xref ref-type="bibr" rid="R9">9</xref></sup>. If two habitats, say A and B, are inhabited by mostly the same set of species, they were grouped together as a single habitat cluster. Conversely, if few species are shared between habitats A and B, they were treated as independent habitats. Using this approach, we reorganized the original 114 habitats into 26 habitat clusters (<xref ref-type="fig" rid="F2">Figure 2</xref>; <xref ref-type="supplementary-material" rid="SD1">Table S3</xref>; see in <xref ref-type="sec" rid="S9">Methods</xref>). The habitat clustering confirmed some intuitive groupings, such as clustering chicken gut, human gut, and pig gut into a single habitat cluster. But it also revealed some non-trivial associations. For example, the method grouped paper pulp and insect gut into a single habitat cluster, suggesting similarities between these two environments in terms of microbial adaptation. Some habitats, such as plastic and biofilter, could not be grouped with other habitats, suggesting that these habitats should be considered as independent habitats (<xref ref-type="fig" rid="F2">Figure 2</xref>).</p><p id="P9">We defined the niche breadths of each species as the number of habitat clusters in which they were found. Species found in more habitat clusters are considered to have broader niche breadths (i.e., generalists) than those found in fewer habitat clusters (i.e., specialists; <xref ref-type="supplementary-material" rid="SD1">Figure E2a</xref>).</p></sec><sec id="S4"><title>Species with broader niche breadths carried a higher proportion of genes for cooperative traits</title><p id="P10">Previous studies examined the relationship between niche breadth and the carriage of genes encoding extracellular proteins<sup><xref ref-type="bibr" rid="R19">19</xref>,<xref ref-type="bibr" rid="R20">20</xref></sup>. While this approach captured genes for many cooperative behaviours, it overlooked genes which code for more complex cooperative functions, such as when a protein is intracellular but involved in producing a cooperative molecule<sup><xref ref-type="bibr" rid="R35">35</xref></sup>. We therefore identified genes for cooperative traits with an improved approach. First, genes were designated as “cooperative” if they were tagged with one or more of the following cooperative behaviours commonly found in bacteria: biofilm formation, quorum-sensing, secretion systems, siderophore production and usage, and antibiotic degradation<sup><xref ref-type="bibr" rid="R35">35</xref>,<xref ref-type="bibr" rid="R36">36</xref></sup>. Second, we also counted genes encoding extracellular proteins as genes for cooperative traits. Using this definition, we identified genes for cooperative traits by analysing the protein sequence data of species in our dataset using the KEGG functional annotation database<sup><xref ref-type="bibr" rid="R37">37</xref>,<xref ref-type="bibr" rid="R38">38</xref></sup> (<xref ref-type="supplementary-material" rid="SD1">Figure E1</xref>). 579 KEGG-defined orthologous groups (KOs) were defined as cooperative, and genes assigned to these KOs were considered as encoding cooperative traits (<xref ref-type="supplementary-material" rid="SD1">Table S4</xref>).</p><p id="P11">We successfully identified genes for cooperative traits in 25,785 species of our dataset (<xref ref-type="supplementary-material" rid="SD1">Table S5</xref>). Given that species having broader niche breadths typically have larger genome sizes (<xref ref-type="supplementary-material" rid="SD1">Figure E2c</xref>), we used the proportion of genes for cooperative traits within each species’ representative genome, rather than the number of such genes, as an indicator of the level of cooperative gene carriage for that species while controlling for its genome size. The proportion of genes for cooperation ranged from around 0 to 0.07 across all species (<xref ref-type="supplementary-material" rid="SD1">Figure E2b</xref>).</p><p id="P12">We found a positive correlation between the proportion of genes for cooperative behaviours and niche breadth across species (MCMCglmm<sup><xref ref-type="bibr" rid="R39">39</xref></sup>: n = 25,785 species; pMCMC &lt; 0.001; R<sup>2</sup> of fixed effect = 0.051; <xref ref-type="fig" rid="F3">Figure 3a, b</xref>; <xref ref-type="supplementary-material" rid="SD1">Table S1</xref>). In addition, we also found the same pattern when analysing different types of genes for cooperative traits separately (MCMCglmm: n = 25,785 species; pMCMC &lt; 0.001 for all categories of genes for cooperation; <xref ref-type="fig" rid="F3">Figure 3b, c</xref>; <xref ref-type="supplementary-material" rid="SD1">Table S1</xref>).</p><p id="P13">We conducted several tests to confirm the robustness of our findings. We found the same pattern when examining the relationship between the number of genes for cooperative traits and niche breadth (rather than proportion; <xref ref-type="supplementary-material" rid="SD1">Figure S1</xref>), and when using different methods (or thresholds) for clustering habitats (<xref ref-type="supplementary-material" rid="SD1">Figure S2 &amp; 4</xref>). Finally, we considered the potential confounding effects of genes that may have coevolved with genes for cooperative traits, particularly those sharing the same metabolic pathway, which are prone to simultaneous gains or losses with genes for cooperative traits due to their functional interdependencies<sup><xref ref-type="bibr" rid="R40">40</xref>–<xref ref-type="bibr" rid="R42">42</xref></sup>. We found that including the proportion (or number) of coevolved genes as a covariate did not change the correlation between the proportion (or number) of genes for cooperative traits and niche breadth (<xref ref-type="supplementary-material" rid="SD1">Figure S8</xref>).</p></sec><sec id="S5"><title>Exploring the causal link between cooperation and niche breadth evolution</title><p id="P14">Our observation that habitat generalists possess a higher proportion of genes for cooperative traits is consistent with previous studies<sup><xref ref-type="bibr" rid="R10">10</xref>,<xref ref-type="bibr" rid="R20">20</xref></sup>. This correlation could reflect various causal relationships, for instance, cooperation could have facilitated niche expansion, or niche expansion could have favoured the evolution of cooperation. To test different causal hypotheses, we examined the chronological order of evolutionary events, considering earlier events lead to subsequent ones.</p><p id="P15">To carry out causal inference, we classified species as habitat generalists or specialists based on the number of habitat clusters they occupied. Specialists, by definition, have the narrowest niche breadths, so we defined species found in only one habitat cluster as specialists. To identify generalists, we compared the observed pattern to the expected distribution of niche breadths across species. We generated an expected distribution of niche breadths using a permutation approach (n = 10,000) that involved randomly assigning species to different habitat clusters while preserving the original species count in each cluster (see in <xref ref-type="sec" rid="S9">Methods</xref>). Thresholds for classifying species as generalists were set at points where the observed count of species with a particular level of niche breadth significantly exceeded the expected count (<xref ref-type="fig" rid="F4">Figure 4e</xref>; <xref ref-type="supplementary-material" rid="SD1">Table S2</xref>). Accordingly, species found in 8 or more habitat clusters were classified as generalists, while those in between were classified as having “intermediate” niche breadths (i.e. 2-7 clusters; <xref ref-type="fig" rid="F4">Figure 4e</xref>). Out of the 25,785 species in our dataset, 4,230 were classified as specialists, 12,975 as intermediate species, and 8,580 as generalists (<xref ref-type="supplementary-material" rid="SD1">Table S5</xref>).</p><p id="P16">We formulated four potential causal scenarios based on the chronological order of events, where either the level of cooperation influences the evolution of niche breadth or the reverse (<xref ref-type="fig" rid="F4">Figure 4a-d</xref>). To infer the earlier evolutionary events, we applied ancestral state reconstruction to recreate the gene content profiles and niche breadths for ancestral species (internal node), based on data from extant species (tip) and their known phylogenetic relationships<sup><xref ref-type="bibr" rid="R43">43</xref></sup> (<xref ref-type="supplementary-material" rid="SD1">Figure E3</xref>). We reconstructed the gene profiles and niche breadths for 24,912 ancestral nodes, which included 3,994 specialists, 11,683 species with intermediate niche breadth, and 9,235 generalists. The ancestral niche breadths for 872 nodes were undetermined (<xref ref-type="supplementary-material" rid="SD1">Figure E4a, Table S6</xref>). We only compared the evolutionary transitions between each ancestor (parent) and its direct descendants (children) to maintain analytical clarity (<xref ref-type="supplementary-material" rid="SD1">Figure E3</xref>). Each parent had two children, which could be specialists (quantified as 0), intermediate species (quantified as 0.5), or generalists (quantified as 1). For each parent, we summed niche breadths for both children yielded possible children’s niche breadth scores of 0 (two specialists), 0.5 (one specialist, one intermediate species), 1 (two intermediate species, or one specialist one generalist), 1.5 (one generalist, one intermediate species), or 2 (two generalists).</p><p id="P17">We found support for the causal hypothesis that a lower proportion of genes for cooperative traits facilitated niche contraction (<xref ref-type="fig" rid="F4">Figure 4b</xref>). We classified 927 transition events from generalists to species with narrower niche breadths, comprising 68 events from generalists to specialists, and 859 events from generalists to intermediate species (<xref ref-type="fig" rid="F4">Figure 4f</xref>). We found that generalist parents whose children underwent significant niche contraction had a lower proportion of genes for cooperation (MCMCglmm: n = 9,173 generalist ancestral species; 1 vs. 0.5: pMCMC &lt; 0.001; 1.5 vs 1: pMCMC = 0.663; 2 vs 1.5: pMCMC &lt; 0.001; <xref ref-type="fig" rid="F4">Figure 4h</xref>, <xref ref-type="supplementary-material" rid="SD1">Table S1</xref>).</p><p id="P18">In contrast, we found no support for the hypothesis that a higher proportion of genes for cooperation promote niche expansion (<xref ref-type="fig" rid="F4">Figure 4a</xref>). The total number of transition events from specialists to species with broader niche breadths was 542, comprising 527 events from specialists to intermediate species, and 15 events from specialists to generalists (<xref ref-type="fig" rid="F4">Figure 4f</xref>). We found that the proportion of genes for cooperation in specialist parents did not significantly affect whether their children expanded their niches (MCMCglmm: n = 3,832 specialist ancestral species; pMCMC = 0.637; <xref ref-type="fig" rid="F4">Figure 4g</xref>, <xref ref-type="supplementary-material" rid="SD1">Table S1</xref>).</p><p id="P19">We also did not find support for the hypotheses that niche breadth influenced the level of cooperation (<xref ref-type="fig" rid="F4">Figure 4c</xref>, d). We calculated the change in the proportion of genes for cooperative traits between each ancestral species and the average for its two children. Our analyses showed no significant correlation between the ancestral species’ niche breadth and the change in the proportion of genes for cooperative traits in their descendants (MCMCglmm: n = 24,590 ancestral species; pMCMC = 0.796; <xref ref-type="fig" rid="F4">Figure 4i</xref>, <xref ref-type="supplementary-material" rid="SD1">Table S1</xref>). This suggested that neither becoming a generalist nor becoming a specialist influenced the evolution of the proportion of genes for cooperation in the offspring.</p><p id="P20">To test the robustness of our results we also carried out a transition rate analyses, which allows us to examine whether the evolution of two traits is correlated, as well as the underlying direction. We again found support for the hypothesis that a lower proportion of genes for cooperation facilitated specialization (<xref ref-type="fig" rid="F4">Figure 4b</xref>). First, the transition rate from broader to narrower niche breadths (specialization) was higher than the transition rate from narrower to broader niche breadths (generalization). Second, the transition rate from broader to narrower niche breadths was higher in species with fewer genes for cooperation compared to those with more such genes (<xref ref-type="supplementary-material" rid="SD1">Figure S9</xref>).</p></sec><sec id="S6"><title>Genes for cooperation undergo more frequent intraspecific gains and losses</title><p id="P21">Why would a lower proportion of genes for cooperative traits favour niche contraction? We hypothesized that genes for cooperative behaviours act as a maintenance mechanism for relative generalists, that allows them to maintain broad niches. Losing these genes undermines this ability, pushing the species towards relative specialists. In contrast, for specialists, while the potential benefits of genes for cooperative behaviours, such as enhanced resource utilization, might theoretically facilitate niche expansion, the associated costs, such as the energy expenditure for synthesizing these genes for cooperative behaviours, or the vulnerability to exploitation by ‘cheaters’, also act as selective pressures for their deletion<sup><xref ref-type="bibr" rid="R15">15</xref>,<xref ref-type="bibr" rid="R21">21</xref>,<xref ref-type="bibr" rid="R44">44</xref>,<xref ref-type="bibr" rid="R45">45</xref></sup>. This would lead to a rapid turnover in the acquisition and loss of genes for cooperative traits over relatively shorter-term, such that they do not significantly impact the longer-term evolutionary transition from being a specialist to a generalist.</p><p id="P22">We tested this hypothesis by comparing the rate at which genes for cooperation are gained and lost both across species (interspecific) and within species (intraspecific). The intraspecific rate represents gain and loss over relatively shorter evolutionary timescales, whereas the interspecific rate represents these processes over longer timescales<sup><xref ref-type="bibr" rid="R46">46</xref></sup>. We would expect that genes for cooperation undergo frequent gains and losses within species, but not across species.</p><p id="P23">To estimate the rate at which genes for cooperation are gained and lost within a species (intraspecific), we examined bacterial pangenomes. A pangenome comprises all the genes found across different strains of a species<sup><xref ref-type="bibr" rid="R47">47</xref></sup>. Within this, some genes are ubiquitous across all strains (core genes), and some are only present in a subset of strains (accessory genes), making them more prone to gains and losses compared to core genes<sup><xref ref-type="bibr" rid="R40">40</xref></sup> (<xref ref-type="fig" rid="F5">Figure 5a</xref>). If genes for cooperation are more likely to undergo frequent gains and losses within species, then we would expect them to be more likely to be in the accessory genomes.</p><p id="P24">We reconstructed pangenomes for 171 bacterial species for which at least 100 high-quality genomes were available in GTDB (<xref ref-type="supplementary-material" rid="SD1">Figure E6, Table S9</xref>). To quantify the susceptibility of genes for cooperation to gains and losses, we introduced an index <italic>π</italic>, which measures the propensity of a gene for cooperation being an accessory gene in a pangenome relative to what would be expected by chance. The higher the value of <italic>π</italic> for genes for cooperation, the more they tend to be accessory genes within bacterial pangenomes (see in <xref ref-type="sec" rid="S9">Methods</xref>). In support of our hypothesis, we found that genes for cooperative traits were significantly more likely to be accessory genes (MCMCglmm: n = 171 species; pMCMC &lt; 0.001; <xref ref-type="fig" rid="F5">Figure 5a</xref>; <xref ref-type="supplementary-material" rid="SD1">Figure E6; Table S1</xref>). This trend was notably stronger for genes associated with secretion system and antibiotic degradation (MCMCglmm; secretion systems: pMCMC = 0.037; antibiotic degradation: pMCMC = 0.0132; <xref ref-type="fig" rid="F5">Figure 5a</xref>; <xref ref-type="supplementary-material" rid="SD1">Table S1</xref>), but not for other functional categories of cooperative genes.</p><p id="P25">To measure gene gain and loss rate across species, we estimated the rate of state transitions for each KO per phylogenetic branch by conducting ancestral state reconstruction. Specifically, gene gains were denoted by transitions from absence to presence, while gene losses were denoted by transitions from presence to absence (<xref ref-type="supplementary-material" rid="SD1">Figure E5; Table S7</xref>). We found no significant difference in the state transition rates between cooperative versus non-cooperative KOs (permutated Kruskal-Wallis test; chi-squared = 3.5859, p-value = 0.060; <xref ref-type="fig" rid="F5">Figure 5b</xref>).</p><p id="P26">The pattern did however vary with different types of cooperative trait. Biofilm formation-related KOs had significantly lower rates of state transitions compared to non-cooperative KOs, and those related to the formation of extracellular proteins and siderophores (Dunn’s Test: p-values were adjusted by Bonferroni correction; biofilm vs. private: p-value = 0.015; biofilm vs. extracellular: p-value = 0.0004; biofilm vs. siderophore: p-value = 0.0003; <xref ref-type="fig" rid="F5">Figure 5b</xref>; <xref ref-type="supplementary-material" rid="SD1">Table S2</xref>). In addition, we found that cooperative KOs were more prone to gene loss than to gene gain, as demonstrated by their significantly higher rates of gene loss (permutated Kruskal-Wallis test; chi-squared = 614.39, p-value &lt; 0.001; <xref ref-type="fig" rid="F5">Figure 5c</xref>; <xref ref-type="supplementary-material" rid="SD1">Table S8</xref>).</p><p id="P27">Overall, our results suggested that genes for cooperative traits undergo more frequent gains and losses on a shorter time scale (within species), but not on a longer time scale (across species). These findings are consistent with our hypothesis that the cost of genes for cooperative traits leads to rapid turnover in their acquisition and loss, so that they have a limited impact on the longer-term evolutionary transition from specialists to generalists.</p></sec><sec id="S7"><title>Cooperation shapes speciation and extinction rates</title><p id="P28">Finally, we investigated the impact of niche breadth and cooperation on bacterial diversification rates. We fitted rate parameters of character-dependent speciation (<italic>λ</italic>) and extinction (<italic>μ</italic>) models (SSE models) using the data of two traits (cooperation &amp; niche breadth) and the phylogenetic tree. This approach involved comparing the fit of a null model, where the trait evolves under a continuous-time Markov <italic>k</italic>-state (Mk) model and the tree grows under a constant birth-death process uninfluenced by the traits, to a model where speciation and extinction rates depend on the values of the traits<sup><xref ref-type="bibr" rid="R48">48</xref></sup>.</p><p id="P29">Fitting character-dependent SSE models required binarizing both the proportion of genes for cooperative traits and niche breadth. We classified species with values below the median proportion as having “lower” levels of cooperation and those above as having “higher” levels of cooperation. For niche breadth, species found in fewer than 6 habitat clusters were categorized as having “narrower” niche breadth, while those in 6 or more habitat clusters as having “broader” niche breadth (<xref ref-type="supplementary-material" rid="SD1">Figure E8</xref>). To investigate the collective effect of cooperation and niche breadth on bacterial diversification, we merged these two binary traits into a single trait with four states and applied the multi-state speciation and extinction (MuSSE) model<sup><xref ref-type="bibr" rid="R49">49</xref></sup>. The four states defined are: narrower niche breadth and lower cooperation (1), narrower niche breadth and higher cooperation (2), broader niche breadth and lower cooperation (3), and broader niche breadth and higher cooperation (4).</p><p id="P30">We found that fitting character-dependent SSE models using a phylogenetic tree with too many species can lead to implausible results, such as near-zero extinction rates (<xref ref-type="supplementary-material" rid="SD1">Figure E7</xref>). To address this issue, we fitted the MuSSE model separately for each family containing at least 100 species (<xref ref-type="supplementary-material" rid="SD1">Table S10</xref>). This strategy improved the accuracy of model fittings by reducing tree sizes, and enabled the comparison of diversification patterns across families while controlling for phylogeny, to eliminate the problem of pseudo-replication within lineages<sup><xref ref-type="bibr" rid="R50">50</xref></sup>.</p><p id="P31">Overall, the net diversification rates (speciation – extinction) at the family level did not vary significantly across different states (<xref ref-type="supplementary-material" rid="SD1">Figure S12</xref>, <xref ref-type="supplementary-material" rid="SD1">Table S1</xref>). When examining separately, we observed that species with narrower niche breadth and lower cooperation (state 1) had significantly lower speciation rates compared to those with narrower niche breadth and higher cooperation (state 2). However, there was no significant difference in speciation rates between species with broader niche breadth and lower cooperation (state 3) and those with broader niche breadth and higher cooperation (state 4). This indicated that lower cooperation levels reduce speciation rates only in species with narrower niche breadths (MCMCglmm; n = 34 families; <italic>λ</italic><sub>1</sub> vs. <italic>λ</italic><sub>2</sub>: pMCMC = 0.032; <italic>λ</italic><sub>3</sub> vs. <italic>λ</italic><sub>4</sub>: pMCMC = 0.357; <xref ref-type="fig" rid="F6">Figure 6a</xref>; <xref ref-type="supplementary-material" rid="SD1">Figure E9; Table S1</xref>). Additionally, no significant differences were detected between the speciation rates of states 1 and 3 or between states 2 and 4, suggesting that niche breadth does not independently influence speciation rates (MCMCglmm: n = 34 families; <italic>λ</italic><sub>1</sub> vs. <italic>λ</italic><sub>3</sub> : pMCMC = 0.221; <italic>λ</italic><sub>2</sub> vs. <italic>λ</italic><sub>4</sub> : pMCMC = 0.982; <xref ref-type="fig" rid="F6">Figure 6b</xref>; <xref ref-type="supplementary-material" rid="SD1">Figure E9; Table S1</xref>).</p><p id="P32">For extinction rates, we found that species with narrower niche breadth and lower cooperation (state 1) had significantly lower extinction rates compared to those with narrower niche breadth and higher cooperation (state 2). However, no significant differences were observed between the extinction rates of species with broader niche breadth and lower cooperation (state 3) and those with broader niche breadth and higher cooperation (state 4) (MCMCglmm: n = 34 families; <italic>μ</italic><sub>1</sub> vs. <italic>μ</italic><sub>2</sub>: pMCMC = 0.038; <italic>μ</italic><sub>3</sub> vs. <italic>μ</italic><sub>4</sub>: pMCMC = 0.644; <xref ref-type="fig" rid="F6">Figure 6b</xref>; Figure E9; <xref ref-type="supplementary-material" rid="SD1">Table S1</xref>). This result suggested that species with lower cooperation levels experience lower extinction rates primarily when they have narrower niche breadths. Furthermore, the extinction rate for state 1 was significantly lower than that for state 3, while no significant difference was observed between the extinction rates of states 2 and 4 (MCMCglmm; n = 34 families; <italic>μ</italic><sub>1</sub> vs. <italic>μ</italic><sub>3</sub>: pMCMC = 0.047; <italic>μ</italic><sub>2</sub> vs. <italic>μ</italic><sub>4</sub>: pMCMC = 0.636; <xref ref-type="fig" rid="F6">Figure 6b</xref>; <xref ref-type="supplementary-material" rid="SD1">Figure E9; Table S1</xref>). This indicated a more pronounced effect of niche breadth on increasing extinction rates among species with lower levels of cooperation.</p><p id="P33">We also employed the binary-state speciation (<italic>λ</italic>) and extinction (<italic>μ</italic>) model (BiSSE) to examine the independent effects of cooperation and niche breadth on bacterial diversification<sup><xref ref-type="bibr" rid="R48">48</xref></sup>. When examining independently, we found that species with higher levels of cooperation tend to have higher extinction rates, while species with broader niche breadths tend to have higher speciation rates (<xref ref-type="supplementary-material" rid="SD1">Figure E8, Table S1</xref>). In comparison, the MuSSE models, which analyse the combined effect of cooperation and niche breadth, revealed interactions between these traits on diversification that were not captured when examining each trait independently using BiSSE models.</p></sec></sec><sec id="S8" sec-type="discussion"><title>Discussion</title><p id="P34">We examined the role of cooperation in bacterial niche breadth evolution and diversification. Our findings revealed that habitat generalists possess a higher proportion of genes for cooperative traits (<xref ref-type="fig" rid="F3">Figure 3</xref>). Using phylogenetic causal inference techniques, we demonstrated that this positive correlation between cooperation and niche breadth is due to a causal relationship where a decreased proportion of genes for cooperative traits promotes niche contraction. This suggested that genes for cooperative traits primarily serve to maintain the niche breadth of generalists (<xref ref-type="fig" rid="F4">Figure 4</xref>).</p><p id="P35">Our findings suggested that causality is in the opposite direction to the previous assumption that cooperation facilitates niche expansion, via mechanisms such as bacteria using cooperative secretions to modify the environment and extend the host range<sup><xref ref-type="bibr" rid="R14">14</xref>,<xref ref-type="bibr" rid="R19">19</xref></sup>. To understand the revealed direction of causality, we proposed that the cost of genes for cooperative traits makes them more likely to be deleted, leading to frequent acquisition and loss within species, preventing a significant impact on the long-term evolutionary transition from specialists to generalists. Our examination on the dynamics of genes for cooperation supported this explanation, showing that these genes are more likely to be accessory in pangenomes. As a result, they may undergo more frequent gains and losses within species but not across species (<xref ref-type="fig" rid="F5">Figure 5</xref>).</p><p id="P36">More generally, cooperation has been found to influence the environmental choices of organisms across various taxa. In birds, cooperative breeding has been shown to facilitate the colonization of harsh environments<sup><xref ref-type="bibr" rid="R29">29</xref></sup>. In insects, the evolution of sociality in burying beetles has allowed them to adapt to broader elevational and temperature gradients<sup><xref ref-type="bibr" rid="R51">51</xref></sup>. For marine life, a study has found that eusocial sponge-dwelling shrimp occupy more sponges and have broader host ranges than their non-social sister species<sup><xref ref-type="bibr" rid="R52">52</xref></sup>. The major advancement made by our study, which goes beyond the current understanding of the role of cooperation, is the examination of the genetic mechanisms underlying cooperation in niche breadth evolution, and the elucidation of how a decrease in cooperation, rather than an increase, influences niche breadth evolution.</p><p id="P37">Finally, we assessed the combined effect of cooperation and niche breadth on bacterial diversification at the family level. Contrary to previous studies that found species with broader niche breadth have higher speciation rates<sup><xref ref-type="bibr" rid="R9">9</xref>,<xref ref-type="bibr" rid="R31">31</xref></sup>, our results indicated that niche breadth alone does not directly shape speciation rates. Instead, we found that cooperation increases speciation and extinction rates in species with narrower niche breadths, suggesting that it is the interaction between bacterial cooperation and niche breadth that shapes these rates (<xref ref-type="fig" rid="F6">Figure 6</xref>). Although the overall diversification rates (speciation – extinction) at the family level were found not to be affected by these two traits, this is potentially because these rates were not directly fitted and were therefore prone to biases inherent in the maximum likelihood estimation process<sup><xref ref-type="bibr" rid="R53">53</xref></sup>. Previous research has similarly found that cooperation with symbiotic microbes has influenced diversification across insects by shaping the feeding niche of these insects<sup><xref ref-type="bibr" rid="R54">54</xref></sup>. Our findings, together with those from previous research, underscore the broader significance of cooperation in driving diversification, revealing its pivotal role in shaping evolutionary processes across various taxa.</p></sec><sec id="S9" sec-type="methods"><title>Methods</title><sec id="S10"><title>Species selection and genome collection</title><p id="P38">We obtained a list of 62,291 species and their corresponding genomes from the Genome Taxonomy Database (GTDB<sup><xref ref-type="bibr" rid="R32">32</xref></sup>; release 207) on 1<sup>st</sup> October 2022. At the first step, we selected species with representative genomes in GTDB that enabled the identification of full-length 16S rRNA gene sequences, yielding a list of 38,474 species. To ensure high-quality of genomes, we applied a stricter criterion than a previously proposed Minimum Information about a Metagenome-Assembled Genome (MIMAG) criterion<sup><xref ref-type="bibr" rid="R55">55</xref></sup>, considering genomes with completeness <italic>≥</italic> 95% and contamination ≤ 5% as high-quality genomes. We then used <italic>ncbi-genome-download</italic> scripts (version 0.3.1) to download the nucleotide and amino acid sequences for all available genomes from either GenBank<sup><xref ref-type="bibr" rid="R56">56</xref></sup> or RefSeq<sup><xref ref-type="bibr" rid="R57">57</xref></sup> database using the assembly entries specified in GTDB. This resulted in a dataset of 237,354 genomes with corresponding sequences for subsequent analysis.</p></sec><sec id="S11"><title>Habitat preferences annotation</title><p id="P39">The annotation of habitat preferences followed an approach modified from a previous study<sup><xref ref-type="bibr" rid="R9">9</xref></sup>. The procedure comprised three steps: (a) inferring the preliminary habitat preferences for each species using their 16S rRNA gene sequences; (b) clustering the preliminary habitats based on species compositions; (c) re-annotating the habitat preferences of each species by replacing the preliminary habitats with the newly defined habitat clusters.</p><sec id="S12"><label>a)</label><title>Preliminary habitat estimation</title><p id="P40">To estimate the preliminary habitat preferences for each species, we first retrieved the full-length 16S rRNA gene sequences for their representative genomes from GTDB (<ext-link ext-link-type="uri" xlink:href="https://data.gtdb.ecogenomic.org/releases/release207/207.0/genomic_files_reps/bac120_ssu_reps_r207.tar.gz">https://data.gtdb.ecogenomic.org/releases/release207/207.0/genomic_files_reps/bac120_ssu_reps_r207.tar.gz</ext-link>). We then used BLAST to search these representative full-length 16S rRNA sequences against the 16S rRNA sequences in metagenome datasets containing various environmental information through the ProkAtlas online platform<sup><xref ref-type="bibr" rid="R33">33</xref></sup>. The sequence similarity threshold was set to 97%, and the sequence coverage threshold was set to 150 bp for conducting the ProkAtlas annotation. A species was considered present in an environment if its habitat preference score, reported by ProkAtlas, was greater than zero. We successfully estimated habitat preferences for 32,262 species out of 38,474 species from GTDB (<xref ref-type="supplementary-material" rid="SD1">Table S11</xref>).</p></sec><sec id="S13"><label>b)</label><title>Clustering habitats based on species compositions</title><p id="P41">To avoid potential bias arising from human intuition in the preliminary habitat definitions, we adopted a more objective biological approach by clustering habitats based on their species assemblages<sup><xref ref-type="bibr" rid="R9">9</xref></sup>. This method aimed to identify situations where two habitats, though differently defined by humans, might host the same bacterial species. For instance, if two habitats (A and B) have nearly identical sets of species, they would be clustered together. Conversely, if habitats A and B share almost no species, they would be considered independent habitats.</p><p id="P42">We initially collected a comprehensive dataset of environmental 16S rRNA sequences from the ProkAtlas database<sup><xref ref-type="bibr" rid="R33">33</xref></sup>. This dataset comprises 361,474 sequence fragments derived from 114 distinct habitats. To determine the species-level habitat preferences of these 16S rRNA fragments, we then mapped the fragmental sequences to full-length 16S rRNA sequences available in the SILVA database<sup><xref ref-type="bibr" rid="R58">58</xref></sup> (<ext-link ext-link-type="uri" xlink:href="https://www.arb-silva.de/fileadmin/silva_databases/release_138.1/Exports/SILVA_138.1_SSURef_NR99_tax_silva.fasta.gz">https://www.arb-silva.de/fileadmin/silva_databases/release_138.1/Exports/SILVA_138.1_SSURef_NR99_tax_silva.fasta.gz</ext-link>). For the mapping process, we utilized VSEARCH<sup><xref ref-type="bibr" rid="R59">59</xref></sup> (v2.22.1_linux_x86_64) to perform an all-against-all BLAST search between the ProkAtlas and SILVA sequences, setting the sequence identity threshold at 98%. As a result, we successfully matched 248,295 out of 361,474 ProkAtlas fragmental sequences to 71,574 full-length 16S rRNA sequences present in the SILVA database. Each of these full-length sequences corresponded to a unique bacterial species. This enabled us to create presence/absence profiles of bacterial species associated with every ProkAtlas habitat.</p><p id="P43">To evaluate the similarities between ProkAtlas habitats and prepare for subsequent clustering steps, we calculated environmental similarity scores based on a previous study<sup><xref ref-type="bibr" rid="R9">9</xref></sup>. Specifically, for any pair of habitats <italic>H</italic><sub><italic>1</italic></sub> and <italic>H</italic><sub><italic>2</italic></sub>, and for a sequence identity threshold <italic>T</italic> (ranging from 70% to 98%), the similarity score between <italic>H</italic><sub><italic>1</italic></sub> and <italic>H</italic><sub><italic>2</italic></sub> was calculated as the geometric mean of two proportions: (i) The proportion of full-length 16S rRNA sequences (species) in <italic>H</italic><sub><italic>1</italic></sub> that were similar to any sequence (species) in <italic>H</italic><sub><italic>2</italic></sub> with a sequence identity above the threshold <italic>T</italic>; (ii) The proportion of full-length 16S rRNA sequences in <italic>H</italic><sub><italic>2</italic></sub> that were similar to any sequence in <italic>H</italic><sub><italic>1</italic></sub> with a sequence identity above the threshold <italic>T</italic>. The sequence matching was performed with BLASTn (version 2.13.0) in an all-against-all mode between each pair of sequence sets at the threshold <italic>T</italic>. We allowed <italic>T</italic> to vary because species do not necessarily need to be identical (<italic>T</italic> = 98%) to exhibit similar habitat preferences. Bacterial species from higher taxonomic ranks might possess adaptive traits that enable them to thrive in the same environments, even with some genetic divergence<sup><xref ref-type="bibr" rid="R60">60</xref></sup>. As a result of this process, we obtained matrices of similarity scores between each pair of ProkAtlas habitats, each calculated at different sequence identity thresholds.</p><p id="P44">Finally, we conducted hierarchical clustering to group ProkAtlas habitats using the dissimilarity score (1-similarity score) at different thresholds <italic>T</italic>. To objectively determine the optimal clustering methods (between “ward.D”, “ward.D2”, “single”, “complete”, “UPGMA”, “WPGMA”, “WPGMC”, or “UPGMC”), the numbers of clusters (range from 2 to 113), and the sequence identity thresholds (range from 70% to 98%), we calculated the Silhouette index for various clustering results. The Silhouette index ranges from −1 to +1, with a higher value indicating better clustering performance, where objects are well-matched to their own cluster and poorly matched to neighbouring clusters. We found the optimal Silhouette index was achieved when we using “ward.D2” method with a threshold <italic>T</italic> = 77% and 26 habitat clusters (<xref ref-type="supplementary-material" rid="SD1">Figure E10, Table S13</xref>). The dendrogram of this optimal clustering can be checked in <xref ref-type="fig" rid="F2">Figure 2</xref>. The analyses here was performed in R (version 4.2.1), using package <italic>NbClust</italic> (version 3.0.1)<sup><xref ref-type="bibr" rid="R61">61</xref></sup> and package <italic>Factoextra</italic> (version 1.0.7)<sup><xref ref-type="bibr" rid="R62">62</xref></sup>.</p></sec><sec id="S14"><label>c)</label><title>Re-annotating the habitat preferences</title><p id="P45">Using the 26 newly generated habitat clusters, we replaced the previous 114 habitats, allowing us to re-annotate habitat preferences for species in our dataset. This re-annotation provided a more refined representation of species’ habitat preferences, based on a relatively objective clustering of similar environments. We successfully annotated 32,262 species from our initial species list with 25 habitat clusters (<xref ref-type="supplementary-material" rid="SD1">Table S12</xref>).</p></sec></sec><sec id="S15"><title>Quantifying niche breadth</title><p id="P46">To quantify the niche breadths of every species in our dataset, we calculated the number of habitat clusters in which they were found. Species found in more habitat clusters are considered to have broader niche breadths than those found in fewer habitat clusters (<xref ref-type="supplementary-material" rid="SD1">Figure E2a</xref>).</p><p id="P47">To implement the causal inference, we classified the species as habitat generalists or specialists based on the number of habitat clusters they occupied. According to the definition of specialists, species with numbers of clusters equal to 1 were defined as habitat specialists. To identify habitat generalists, we compared the observed distribution of number of clusters across species to an expected distribution generated through permutations. Based on the observed species–habitat cluster association matrix, we conducted 10,000 random permutations of the species–habitat cluster associations, while preserving the species count in each cluster, to establish the expected distribution of the number of habitat clusters across species. This approach ensures that the null pattern reflects the assumption that species can potentially adapt to any habitat cluster, but each habitat has a limitation on the number of species it can support. Cut-offs for defining generalists were set where the observed species count at a particular number of clusters significantly exceeded the expected count. As a result, species found in 8 or more habitat clusters were classified as generalists. In addition, species with niche breadths between specialists and generalists were defined as intermediate species (<xref ref-type="fig" rid="F4">Figure 4e</xref>).</p></sec><sec id="S16"><title>Identifying genes for cooperative traits</title><p id="P48">We adapted a method from a previous study<sup><xref ref-type="bibr" rid="R36">36</xref></sup> to define genes for cooperative traits based on functional annotations. Specifically, genes were considered “cooperative” if they were annotated with at least one of the five well-known forms of bacterial cooperative behaviours (biofilm formation, quorum-sensing, secretion systems, siderophores production and usage, and antibiotic degradation). We employed the KEGG Orthology (KO) database<sup><xref ref-type="bibr" rid="R37">37</xref></sup> for functional annotations and used KofamScan<sup><xref ref-type="bibr" rid="R38">38</xref></sup> to assign KO identifiers to protein sequences.</p><p id="P49">To create a list of “cooperative KO identifiers”, we first generated a list of cooperative keywords by referring to prior studies<sup><xref ref-type="bibr" rid="R36">36</xref></sup>. We then downloaded the complete KO identifier list (<ext-link ext-link-type="uri" xlink:href="https://www.genome.jp/ftp/db/kofam/ko_list.gz">https://www.genome.jp/ftp/db/kofam/ko_list.gz</ext-link>) and filtered it based on these keywords. This list was then manually curated to ensure specificity and relevance to prokaryotes, resulting in a list of 386 functionally annotated cooperative KOs (<xref ref-type="supplementary-material" rid="SD1">Table S4</xref>).</p><p id="P50">To compare our results with previous studies<sup><xref ref-type="bibr" rid="R19">19</xref>,<xref ref-type="bibr" rid="R20">20</xref></sup>, we also considered genes coding for extracellular proteins as putatively genes for cooperative traits. This is because extracellular proteins often act as public goods, whose benefits are shared with neighbouring cells<sup><xref ref-type="bibr" rid="R21">21</xref>,<xref ref-type="bibr" rid="R36">36</xref></sup>. We first downloaded a dataset of proteins whose subcellular localization (SCL) has been verified by laboratory experimentation<sup><xref ref-type="bibr" rid="R63">63</xref></sup> (<ext-link ext-link-type="uri" xlink:href="http://db.psort.org/static/downloads/Experimental-PSORTdb-v4.00.tsv">http://db.psort.org/static/downloads/Experimental-PSORTdb-v4.00.tsv</ext-link>). We then retrieved extracellular proteins from the dataset and employed KofamScan to assign significant KO identifiers to these proteins, resulting in a list of 193 “extracellular KO identifiers”. This list will be integrated into the previous list of functionally annotated cooperative KO identifiers, and will be used to mine genes for cooperative traits in further steps. The final list included 579 cooperative KO identifiers (extracellular factor, 193; biofilm, 84; quorum sensing, 23; secretion systems, 82; siderophores, 41; and antibiotic degradation, 156; <xref ref-type="supplementary-material" rid="SD1">Table S4</xref>).</p><p id="P51">After assigning KO identifiers to every gene in our dataset and identifying genes for cooperative traits, we calculated the proportion of genes for cooperative traits for each genome. In calculating the proportions, a potential issue arose when some genes lack confident functional annotations, which could influence the accuracy of the estimates. To address this, we directly used KOs to represent gene content, specifically considering only genes that could be matched with at least one significant KO identifier. As a result, the proportion of genes for cooperative traits in each genome was calculated as the ratio of the number of cooperative KOs to the total number of KOs. At this stage, 25,785 species had both niche breadth annotations and calculated proportions of genes for cooperation. Our primary analyses then focused on these species (<xref ref-type="supplementary-material" rid="SD1">Table S5</xref>).</p></sec><sec id="S17"><title>Phylogeny</title><p id="P52">The phylogenetic reference tree of bacterial species was downloaded from GTDB<sup><xref ref-type="bibr" rid="R32">32</xref></sup> (release 207, <ext-link ext-link-type="uri" xlink:href="https://data.gtdb.ecogenomic.org/releases/release207/207.0/bac120_r207.tree">https://data.gtdb.ecogenomic.org/releases/release207/207.0/bac120_r207.tree</ext-link>). To focus on the 25,785 species relevant to our study, we pruned this phylogenetic tree using the “<italic>keep.tip</italic>” function in the R package <italic>ape</italic> (version 5.7.1)<sup><xref ref-type="bibr" rid="R64">64</xref></sup>, resulting a final phylogenetic tree with 25,785 species.</p></sec><sec id="S18"><title>Ancestral state reconstruction for niche breadth and gene content</title><p id="P53">To infer causality and calculate gene gain/loss rates, we estimated ancestral niche breadth and gene content for each species’ representative genome. For niche breadth, extant species had three discrete states: generalist, intermediate, and specialist. We applied an empirical Bayesian method (the marginal posterior probability approximation (MPPA) method with the F81-like model) in PastML<sup><xref ref-type="bibr" rid="R65">65</xref></sup> (version 1.9.15) to reconstruct ancestral states for niche breadths of each internal node in our species’ phylogeny (<xref ref-type="supplementary-material" rid="SD1">Figure E3</xref>). Of the 25,784 internal nodes, 9,235 were estimated as generalists, 3,994 as specialists, and 11,683 as intermediates. Ancestral states for 872 nodes remained undetermined due to uncertainty of the method (<xref ref-type="supplementary-material" rid="SD1">Figure E4</xref>).</p><p id="P54">For gene content, we used a similar approach to estimate the ancestral presence or absence of each ortholog group (OG) (n = 10,060) for every internal node (n = 25,784) in the phylogeny using species’ representative genomes (Figure E3). The extant species’ OG status was determined through KEGG Orthologs (KO). Consequently, the reconstructed “genome” for each internal node (ancestral species) consisted of all KOs marked as “present”. The proportion of genes for cooperative traits for each internal node was then calculated as the ratio of the number of cooperative KOs to the total number of KOs present in that node. These proportions ranged from approximately 0 to 0.07 (<xref ref-type="supplementary-material" rid="SD1">Figure E4b</xref>).</p></sec><sec id="S19"><title>Causality inference</title><p id="P55">To probe the causal relationship between cooperation and niche breadth evolution, we focused on the chronological order in which these traits evolved, inspired by a common causal inference framework, Granger causality<sup><xref ref-type="bibr" rid="R66">66</xref>,<xref ref-type="bibr" rid="R67">67</xref></sup>. Specifically, if events A and B are correlated and event A precedes event B, we would suggest that A “causes” B. For instance, if carrying higher proportion of genes for cooperative traits (Event A) is found to precede becoming a generalist (Event B), we could propose that a higher proportion of genes for cooperation may facilitate the transition to a broader niche breadth (<xref ref-type="supplementary-material" rid="SD1">Figure E3</xref>).</p><p id="P56">To determine the chronological order of these evolutionary events, we compared the states of ancestral nodes (parents) with their immediate descendants (children). For instance, to investigate whether possessing more genes for cooperation promotes the transition to being a generalist, we examined the proportion of genes for cooperation in specialist parents whose descendants broaden their niche versus those whose descendants remain specialists. If the former group displays a higher proportion of genes for cooperation, it would suggest that the increased presence of genes for cooperation likely preceded the transition to a more generalist habitat preference. In such a case, we could propose that having more genes for cooperation facilitates the evolution transition from specialists to generalists (<xref ref-type="supplementary-material" rid="SD1">Figure E3</xref>).</p></sec><sec id="S20"><title>Estimation of gene gain and loss rates</title><p id="P57">We analysed the rate of gene gains and losses over two different evolutionary scales: across-species (relative longer-term) and within-species (relative short-term). On the across-species (interspecific) scale, the rate of gains and losses for each KEGG Orthologs (KO) was calculated as the average rate of state transitions per phylogenetic branch — either presence (coded as 1) to absence (coded as 0) or vice versa<sup><xref ref-type="bibr" rid="R42">42</xref></sup>. Gene gains were indicated by 0-to-1 transitions, while gene losses were signified by 1-to-0 transitions (<xref ref-type="supplementary-material" rid="SD1">Figure E5</xref>). The state transition rates for 10,060 KOs were determined through ancestral state reconstruction using PastML<sup><xref ref-type="bibr" rid="R65">65</xref></sup> (version 1.9.15). In calculating interspecific gene gain and loss rates, we used the representative genomes of each species to create a species—KO presence/absence table for reconstructing ancestral states. It’s important to note that species may have different genomes, and using different genomes could lead to variations in the species—KO presence/absence tables<sup><xref ref-type="bibr" rid="R68">68</xref></sup>. However, a previous study has shown that if a KO was present in the representative genome of a species, it was likely to be present in nearly all other genomes of that species<sup><xref ref-type="bibr" rid="R42">42</xref></sup>. Therefore, using representative genomes to calculate these rates is considered reliable for our analyses.</p><p id="P58">To assess whether genes for cooperative traits experienced more frequent gains and losses compared to genes for private traits, we examined the difference in average rates of state transitions per branch between cooperative and non-cooperative KOs (<xref ref-type="supplementary-material" rid="SD1">Table S7</xref>). Additionally, the net gain or loss rates for each cooperative KO were estimated using the “<italic>asr_mk_model</italic>” function in the R package <italic>castor</italic> (version 1.7.10), employing an “<italic>ARD (all rates different)</italic>” rate model<sup><xref ref-type="bibr" rid="R69">69</xref></sup> (<xref ref-type="supplementary-material" rid="SD1">Figure E5</xref>).</p><p id="P59">On the within-species (intraspecific) scale, direct estimation of gene gain or loss rates is unfeasible without strain-level phylogeny<sup><xref ref-type="bibr" rid="R70">70</xref></sup>. We thus used the extent to which a gene is categorized as accessory in a pangenome to serve as an indirect indicator of the intraspecific rate of gene gains or losses. This is because accessory genes are more prone to being gained or lost compared to core genes<sup><xref ref-type="bibr" rid="R47">47</xref></sup>. We reconstructed pangenomes for species that had at least 100 high-quality genomes in GTDB, resulted in a list comprising 171 species with 155,554 genomes (<xref ref-type="supplementary-material" rid="SD1">Figure E6, Table S9</xref>). The typical process of pangenome reconstruction can be broken down into three primary steps: 1) gene prediction and annotation, 2) homologous genes identification, 3) categorizing genes as core or accessory based on their presence or absence across different genomes<sup><xref ref-type="bibr" rid="R71">71</xref>,<xref ref-type="bibr" rid="R72">72</xref></sup>. In our study, we employed the protocol outlined in the KO database for gene prediction and ortholog identification<sup><xref ref-type="bibr" rid="R37">37</xref></sup>. KofamScan<sup><xref ref-type="bibr" rid="R38">38</xref></sup> was used to assign KO identifiers to protein sequences, thereby grouping genes with identical KO identifiers into gene families. Consequently, the presence or absence profile of each gene family across the genomes of each species was represented by the presence or absence of each KO.</p><p id="P60">To assess whether genes for cooperative traits are more likely to be accessory genes in pangenomes, we introduced an index <italic>π</italic> to gauge the extent to which these genes are accessory. For each species, we randomly selected two strains to create a minimum pangenome based on these pairwise genomes. We then estimated Π, which represents the difference between the observed and expected proportions of accessory genes for cooperative traits. The Π is, <disp-formula id="FD1"><mml:math id="M1"><mml:mrow><mml:mtext>Π</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>s</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>y</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.2em"/><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>o</mml:mi><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>o</mml:mi><mml:mi>p</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>a</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>v</mml:mi><mml:mi>e</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mi>c</mml:mi><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi><mml:mi>s</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mi>l</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p id="P61">Here, <italic>N</italic>(<italic>accessory, cooperative</italic>) refers to the number of cooperative KOs that are accessory, <italic>N</italic>(<italic>cooperative</italic>) is the total number of cooperative KOs, <italic>N</italic>(<italic>accessory</italic>) is the number of accessory KOs, and <italic>N</italic>(<italic>total</italic>) is the total number of KOs in this minimum pangenome. This index allows us to quantify how much more (or less) likely a gene for cooperative traits is to be an accessory gene compared to what would be expected by chance in the minimum pangenome.</p><p id="P62">The index <italic>π</italic> is then denoted as the average Π calculated across all possible minimum pangenomes consisting of two genomes:<disp-formula id="FD2"><mml:math id="M2"><mml:mrow><mml:mi>π</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mstyle displaystyle="true"><mml:mtext>Σ</mml:mtext></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>η</mml:mi></mml:msubsup><mml:mtext>Π</mml:mtext></mml:mrow><mml:mi>η</mml:mi></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M3"><mml:mrow><mml:mi>η</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:mi>N</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>2</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:math></inline-formula>, which is the total number of unique combinations of two genomes that can be chosen from <italic>N</italic> available strains for a species. The higher the value of <italic>π</italic> for genes for cooperative traits, the more they tend to be accessory genes within bacterial pangenomes, indicating a greater frequency of gains and losses.</p><p id="P63">For species with an extensive number of genomes, such as <italic>Escherichia coli</italic> which has 26,573 genomes in our dataset, the computation of Π for all selected genome pairs would be resource-intensive. To address this, we applied Central Limit Theorem (CLT) to estimate <italic>π</italic> for these species. This approach involved three steps: 1) randomly sample 20 genomes of a species for 10,000 times, 2) calculating the <italic>π</italic> for each sample, and 3) using the mean value of all the sample <italic>π</italic> as an estimation for <italic>π</italic> of the species. According to the CLT, the average of sample means will converge to the population mean when the sample size is sufficiently large.</p></sec><sec id="S21"><title>Diversification analysis</title><p id="P64">To explore the independent impact of cooperation or niche breadth on bacterial diversification, we utilized the binary-state speciation and extinction (BiSSE) model available in the R package <italic>diversitree</italic> (version 0.9.20) to fit our data<sup><xref ref-type="bibr" rid="R49">49</xref></sup>. The BiSSE model is used to assess the effect of binary traits (0 or 1) on speciation and extinction rates. We thus binarized two traits in our dataset: (i) the proportion of genes for cooperation, using the median proportion as a cut-off. Values below this cut-off were categorized as “lower” cooperation (0), and values above as “higher” cooperation (1; Figure E8a). (ii) For niche breadth, species found in less than 6 habitat clusters were classified as having “narrower” niche breadth (0), and those in 6 or more habitat clusters as having “broader” niche breadth (1), based on the distribution of niche breadths across all species (<xref ref-type="supplementary-material" rid="SD1">Figure E8d</xref>). The BiSSE model outputs six parameters for each input phylogenetic tree and trait data: two speciation rates (<italic>λ</italic><sub>0</sub> <italic>and λ</italic><sub>1</sub>), two extinction rates (<italic>μ</italic><sub>0</sub> <italic>and μ</italic><sub>1</sub>), and two state-transition rates (from state 1 to 0 as <italic>q</italic><sub>10</sub>, and from state 0 to 1 as <italic>q</italic><sub>01</sub>).</p><p id="P65">We identified two potential issues with fitting the BiSSE model and other character-dependent SSE models. First, using a phylogenetic tree with a large number of species can lead to implausible results, such as near-zero extinction rates (<xref ref-type="supplementary-material" rid="SD1">Figure E7</xref>). Second, fitting too many parameters can increase the risk of overfitting, complicating the interpretation of the results. To address these concerns, we implemented two strategies. First, instead of using a single phylogenetic tree for all species, we fitted the BiSSE models (and all other character-dependent SSE models) separately for each family containing at least 100 species (<xref ref-type="supplementary-material" rid="SD1">Table S10</xref>). This approach reduces the likelihood of errors associated with large tree sizes and allows for comparisons of diversification patterns across different taxa. Second, to simplify the model and further mitigate the risk of overfitting, we set the two state-transition rates to be equal (<italic>q</italic><sub>10</sub> = <italic>q</italic><sub>01</sub>).</p><p id="P66">To explore the collective effect of cooperation and niche breadth on bacterial diversification, we integrated these two binary traits into a single trait with four states. We then applied the multi-state speciation and extinction (MuSSE) model, implemented in the <italic>diversitree</italic> package, to study the impact of this newly integrated trait on diversification. The four states are: 1 (narrower niche breadth and lower cooperation), 2 (narrower niche breadth and higher cooperation), 3 (broader niche breadth and lower cooperation), and 4 (broader niche breadth and higher cooperation). To simplify the MuSSE model, we set all state-transition rates equal to the rate between state 1 and 2 (<italic>q</italic><sub>12</sub>). The model thus outputs 9 parameters: four speciation rates (<italic>λ</italic><sub>1</sub>, <italic>λ</italic><sub>2</sub>, <italic>λ</italic><sub>3</sub>, <italic>λ</italic><sub>4</sub>), four extinction rates (<italic>μ</italic><sub>1</sub>, <italic>μ</italic><sub>2</sub>, <italic>μ</italic><sub>3</sub>, <italic>μ</italic><sub>4</sub>), and one state-transition rate (<italic>q</italic><sub>12</sub>).</p><p id="P67">The R package <italic>diversitree</italic> includes a built-in model specifically designed to investigate the impact of continuous traits on diversification, i.e., the quantitative-state speciation and extinction (QuaSSE) model<sup><xref ref-type="bibr" rid="R49">49</xref></sup>. While QuaSSE is theoretically more appropriate for examining the role of the proportion of genes for cooperation in shaping diversification, we found that implementing the QuaSSE model is impractical for complex phylogenetic trees with more than about 100 species. Consequently, we opted to use models for discrete traits, such as the BiSSE and MuSSE models, to examine the role of cooperation in diversification.</p></sec><sec id="S22"><title>Statistics</title><p id="P68">R package <italic>MCMCglmm</italic> (version 2.35) allows us to fit generalized linear mixed-effects models (GLMMs) to study the relationships between variables while controlling for phylogenetic relationships of species, using a Markov chain Monte Carlo approach with a Bayesian statistical framework<sup><xref ref-type="bibr" rid="R39">39</xref></sup>. To account for potential phylogenetic nonindependence among the species in our dataset, we incorporated the phylogeny as a random effect in the model. To ensure that the phylogenetic tree used in the MCMCglmm fitting had an ultrametric structure, we applied the “<italic>force.ultrametric</italic>” function in the R package “<italic>phytools</italic>” (with an option <italic>“method = extend”</italic>) to transfer our tree into an ultrametric form<sup><xref ref-type="bibr" rid="R73">73</xref></sup>. To assess the goodness of fit for each model, we reported the <italic>pMCMC</italic> value (referred to as “p-value”). When conducting causal inference, it’s necessary to control for phylogenetic relationships between ancestral species (nodes) rather than extant species (tips). This can be achieved by using the “<italic>inverseA</italic>” function in the R package “<italic>MCMCglmm</italic>” to invert phylogenetic covariance matrices that include nodes. For diversification analyses, the most recent common ancestor of all species within a family is identified as the family node. Thus, the phylogenetic relationships between families can be represented through the phylogenetic relationships of these family nodes. This approach allows the application of similar strategies used in causal inference to control for the relationships between families while performing diversification analyses.</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary materials (without tables)</label><media xlink:href="EMS199277-supplement-Supplementary_materials__without_tables_.pdf" mimetype="application" mime-subtype="pdf" id="d8aAcEbB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD2"><label>Supplmentary tables</label><media xlink:href="EMS199277-supplement-Supplmentary_tables.zip" mimetype="application" mime-subtype="zip" id="d8aAcEcB" position="anchor"/></supplementary-material></sec></body><back><ack id="S23"><title>Acknowledgements</title><p>We thank Thomas Richards, Sira Sriswasdi, Anna Dewar, Zheren Zhang, Xiaotong Zhang and Jordi Bascompte for helpful discussions. We thank the National Science Foundation of China (31530007: C.H.), the Japan Society for the Promotion of Science (KAKENHI 22J20318: N.K.; KAKENHI 22H04925: W.I.), the Japan Science and Technology Agency (JPMJGX23B2, JPMJCR19S2: W.I.), European Research Council (834164: C.H., L.J.B. and S.A.W.) for funding.</p></ack><fn-group><fn id="FN1" fn-type="con"><p id="P69"><bold>Contributions</bold></p><p id="P70">Conceptualization: C.H., N.K. and S.A.W.; Data collection: C.H. and N.K.; Methodology: C.H., N.K., M.I., L.J.B., W.I. and S.A.W.; Investigation: C.H. and N.K.; Visualization: C.H. and N.K.; Funding acquisition: W.I. and S.A.W.; Supervision: W.I. and S.A.W.; Writing—original draft: C.H.; Writing—review and editing: C.H., N.K., M.I., W.I. and S.A.W.</p></fn><fn id="FN2" fn-type="conflict"><p id="P71"><bold>Competing interests</bold></p><p id="P72">The authors declare that they have no competing interests.</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lozupone</surname><given-names>CA</given-names></name><name><surname>Knight</surname><given-names>R</given-names></name></person-group><article-title>Global patterns in bacterial diversity</article-title><source>Proceedings of the National Academy of Sciences</source><year>2007</year><volume>104</volume><fpage>11436</fpage><lpage>11440</lpage><pub-id pub-id-type="pmcid">PMC2040916</pub-id><pub-id pub-id-type="pmid">17592124</pub-id><pub-id pub-id-type="doi">10.1073/pnas.0611525104</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Thompson</surname><given-names>LR</given-names></name><etal/></person-group><article-title>A communal catalogue reveals Earth’s multiscale microbial diversity</article-title><source>Nature</source><year>2017</year><volume>551</volume><fpage>457</fpage><lpage>463</lpage><pub-id pub-id-type="pmcid">PMC6192678</pub-id><pub-id pub-id-type="pmid">29088705</pub-id><pub-id pub-id-type="doi">10.1038/nature24621</pub-id></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Delgado-Baquerizo</surname><given-names>M</given-names></name><etal/></person-group><article-title>A global atlas of the dominant bacteria found in soil</article-title><source>Science</source><year>2018</year><volume>359</volume><fpage>320</fpage><lpage>325</lpage><pub-id pub-id-type="pmid">29348236</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lima-Mendez</surname><given-names>G</given-names></name><etal/></person-group><article-title>Determinants of community structure in the global plankton interactome</article-title><source>Science</source><year>2015</year><volume>348</volume><elocation-id>1262073</elocation-id><pub-id pub-id-type="pmid">25999517</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wu</surname><given-names>L</given-names></name><etal/></person-group><article-title>Global diversity and biogeography of bacterial communities in wastewater treatment plants</article-title><source>Nat Microbiol</source><year>2019</year><volume>4</volume><fpage>1183</fpage><lpage>1195</lpage><pub-id pub-id-type="pmid">31086312</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sexton</surname><given-names>JP</given-names></name><name><surname>McIntyre</surname><given-names>PJ</given-names></name><name><surname>Angert</surname><given-names>AL</given-names></name><name><surname>Rice</surname><given-names>KJ</given-names></name></person-group><article-title>Evolution and Ecology of Species Range Limits</article-title><source>Annual Review of Ecology, Evolution, and Systematics</source><year>2009</year><volume>40</volume><fpage>415</fpage><lpage>436</lpage></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sexton</surname><given-names>JP</given-names></name><name><surname>Montiel</surname><given-names>J</given-names></name><name><surname>Shay</surname><given-names>JE</given-names></name><name><surname>Stephens</surname><given-names>MR</given-names></name><name><surname>Slatyer</surname><given-names>RA</given-names></name></person-group><article-title>Evolution of Ecological Niche Breadth</article-title><source>Annual Review of Ecology, Evolution, and Systematics</source><year>2017</year><volume>48</volume><fpage>183</fpage><lpage>206</lpage></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Muller</surname><given-names>EEL</given-names></name></person-group><article-title>Determining Microbial Niche Breadth in the Environment for Better Ecosystem Fate Predictions</article-title><source>mSystems</source><year>2019</year><volume>4</volume><pub-id pub-id-type="pmcid">PMC6584867</pub-id><pub-id pub-id-type="pmid">31186307</pub-id><pub-id pub-id-type="doi">10.1128/mSystems.00080-19</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sriswasdi</surname><given-names>S</given-names></name><name><surname>Yang</surname><given-names>C</given-names></name><name><surname>Iwasaki</surname><given-names>W</given-names></name></person-group><article-title>Generalist species drive microbial dispersion and evolution</article-title><source>Nat Commun</source><year>2017</year><volume>8</volume><elocation-id>1162</elocation-id><pub-id pub-id-type="pmcid">PMC5660117</pub-id><pub-id pub-id-type="pmid">29079803</pub-id><pub-id pub-id-type="doi">10.1038/s41467-017-01265-1</pub-id></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>von Meijenfeldt</surname><given-names>FAB</given-names></name><name><surname>Hogeweg</surname><given-names>P</given-names></name><name><surname>Dutilh</surname><given-names>BE</given-names></name></person-group><article-title>A social niche breadth score reveals niche range strategies of generalists and specialists</article-title><source>Nat Ecol Evol</source><year>2023</year><volume>7</volume><fpage>768</fpage><lpage>781</lpage><pub-id pub-id-type="pmcid">PMC10172124</pub-id><pub-id pub-id-type="pmid">37012375</pub-id><pub-id pub-id-type="doi">10.1038/s41559-023-02027-7</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hernandez</surname><given-names>DJ</given-names></name><name><surname>Kiesewetter</surname><given-names>KN</given-names></name><name><surname>Almeida</surname><given-names>BK</given-names></name><name><surname>Revillini</surname><given-names>D</given-names></name><name><surname>Afkhami</surname><given-names>ME</given-names></name></person-group><article-title>Multidimensional specialization and generalization are pervasive in soil prokaryotes</article-title><source>Nat Ecol Evol</source><year>2023</year><volume>7</volume><fpage>1408</fpage><lpage>1418</lpage><pub-id pub-id-type="pmid">37550510</pub-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carscadden</surname><given-names>KA</given-names></name><etal/></person-group><article-title>Niche Breadth: Causes and Consequences for Ecology, Evolution, and Conservation</article-title><source>The Quarterly Review of Biology</source><year>2020</year><volume>95</volume><fpage>179</fpage><lpage>214</lpage></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jaffe</surname><given-names>AL</given-names></name><name><surname>Castelle</surname><given-names>CJ</given-names></name><name><surname>Banfield</surname><given-names>JF</given-names></name></person-group><article-title>Habitat Transition in the Evolution of Bacteria and Archaea</article-title><source>Annual Review of Microbiology</source><year>2023</year><volume>77</volume><comment>null</comment><pub-id pub-id-type="pmid">37100405</pub-id></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hall-Stoodley</surname><given-names>L</given-names></name><name><surname>Costerton</surname><given-names>JW</given-names></name><name><surname>Stoodley</surname><given-names>P</given-names></name></person-group><article-title>Bacterial biofilms: from the Natural environment to infectious diseases</article-title><source>Nat Rev Microbiol</source><year>2004</year><volume>2</volume><fpage>95</fpage><lpage>108</lpage><pub-id pub-id-type="pmid">15040259</pub-id></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>West</surname><given-names>SA</given-names></name><name><surname>Griffin</surname><given-names>AS</given-names></name><name><surname>Gardner</surname><given-names>A</given-names></name><name><surname>Diggle</surname><given-names>SP</given-names></name></person-group><article-title>Social evolution theory for microorganisms</article-title><source>Nat Rev Microbiol</source><year>2006</year><volume>4</volume><fpage>597</fpage><lpage>607</lpage><pub-id pub-id-type="pmid">16845430</pub-id></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>West</surname><given-names>SA</given-names></name><name><surname>Cooper</surname><given-names>GA</given-names></name></person-group><article-title>Division of labour in microorganisms: an evolutionary perspective</article-title><source>Nat Rev Microbiol</source><year>2016</year><volume>14</volume><fpage>716</fpage><lpage>723</lpage><pub-id pub-id-type="pmid">27640757</pub-id></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>West</surname><given-names>SA</given-names></name><name><surname>Cooper</surname><given-names>GA</given-names></name><name><surname>Ghoul</surname><given-names>MB</given-names></name><name><surname>Griffin</surname><given-names>AS</given-names></name></person-group><article-title>Ten recent insights for our understanding of cooperation</article-title><source>Nat Ecol Evol</source><year>2021</year><volume>5</volume><fpage>419</fpage><lpage>430</lpage><pub-id pub-id-type="pmcid">PMC7612052</pub-id><pub-id pub-id-type="pmid">33510431</pub-id><pub-id pub-id-type="doi">10.1038/s41559-020-01384-x</pub-id></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Griffin</surname><given-names>AS</given-names></name><name><surname>West</surname><given-names>SA</given-names></name><name><surname>Buckling</surname><given-names>A</given-names></name></person-group><article-title>Cooperation and competition in pathogenic bacteria</article-title><source>Nature</source><year>2004</year><volume>430</volume><fpage>1024</fpage><lpage>1027</lpage><pub-id pub-id-type="pmid">15329720</pub-id></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McNally</surname><given-names>L</given-names></name><name><surname>Viana</surname><given-names>M</given-names></name><name><surname>Brown</surname><given-names>SP</given-names></name></person-group><article-title>Cooperative secretions facilitate host range expansion in bacteria</article-title><source>Nat Commun</source><year>2014</year><volume>5</volume><elocation-id>4594</elocation-id><pub-id pub-id-type="pmcid">PMC4143932</pub-id><pub-id pub-id-type="pmid">25091146</pub-id><pub-id pub-id-type="doi">10.1038/ncomms5594</pub-id></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Garcia-Garcera</surname><given-names>M</given-names></name><name><surname>Rocha</surname><given-names>EPC</given-names></name></person-group><article-title>Community diversity and habitat structure shape the repertoire of extracellular proteins in bacteria</article-title><source>Nat Commun</source><year>2020</year><volume>11</volume><fpage>758</fpage><pub-id pub-id-type="pmcid">PMC7005277</pub-id><pub-id pub-id-type="pmid">32029728</pub-id><pub-id pub-id-type="doi">10.1038/s41467-020-14572-x</pub-id></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nogueira</surname><given-names>T</given-names></name><etal/></person-group><article-title>Horizontal Gene Transfer of the Secretome Drives the Evolution of Bacterial Cooperation and Virulence</article-title><source>Current Biology</source><year>2009</year><volume>19</volume><fpage>1683</fpage><lpage>1691</lpage><pub-id pub-id-type="pmcid">PMC2773837</pub-id><pub-id pub-id-type="pmid">19800234</pub-id><pub-id pub-id-type="doi">10.1016/j.cub.2009.08.056</pub-id></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nogueira</surname><given-names>T</given-names></name><name><surname>Touchon</surname><given-names>M</given-names></name><name><surname>Rocha</surname><given-names>EPC</given-names></name></person-group><article-title>Rapid Evolution of the Sequences and Gene Repertoires of Secreted Proteins in Bacteria</article-title><source>PLOS ONE</source><year>2012</year><volume>7</volume><elocation-id>e49403</elocation-id><pub-id pub-id-type="pmcid">PMC3506625</pub-id><pub-id pub-id-type="pmid">23189144</pub-id><pub-id pub-id-type="doi">10.1371/journal.pone.0049403</pub-id></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dewar</surname><given-names>AE</given-names></name><etal/></person-group><article-title>Plasmids do not consistently stabilize cooperation across bacteria but may promote broad pathogen host-range</article-title><source>Nat Ecol Evol</source><year>2021</year><volume>5</volume><fpage>1624</fpage><lpage>1636</lpage><pub-id pub-id-type="pmcid">PMC7612097</pub-id><pub-id pub-id-type="pmid">34750532</pub-id><pub-id pub-id-type="doi">10.1038/s41559-021-01573-2</pub-id></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hao</surname><given-names>C</given-names></name><name><surname>Dewar</surname><given-names>AE</given-names></name><name><surname>West</surname><given-names>SA</given-names></name><name><surname>Ghoul</surname><given-names>M</given-names></name></person-group><article-title>Gene transferability and sociality do not correlate with gene connectivity</article-title><source>Proceedings of the Royal Society B: Biological Sciences</source><year>2022</year><volume>289</volume><elocation-id>20221819</elocation-id><pub-id pub-id-type="pmcid">PMC9709509</pub-id><pub-id pub-id-type="pmid">36448285</pub-id><pub-id pub-id-type="doi">10.1098/rspb.2022.1819</pub-id></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>Y-J</given-names></name><etal/></person-group><article-title>Metabolic flexibility allows bacterial habitat generalists to become dominant in a frequently disturbed ecosystem</article-title><source>ISME J</source><year>2021</year><volume>15</volume><fpage>2986</fpage><lpage>3004</lpage><pub-id pub-id-type="pmcid">PMC8443593</pub-id><pub-id pub-id-type="pmid">33941890</pub-id><pub-id pub-id-type="doi">10.1038/s41396-021-00988-w</pub-id></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Di Rienzi</surname><given-names>SC</given-names></name><etal/></person-group><article-title>The human gut and groundwater harbor non-photosynthetic bacteria belonging to a new candidate phylum sibling to Cyanobacteria</article-title><source>eLife</source><year>2013</year><volume>2</volume><elocation-id>e01102</elocation-id><pub-id pub-id-type="pmcid">PMC3787301</pub-id><pub-id pub-id-type="pmid">24137540</pub-id><pub-id pub-id-type="doi">10.7554/eLife.01102</pub-id></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Niehus</surname><given-names>R</given-names></name><name><surname>Mitri</surname><given-names>S</given-names></name><name><surname>Fletcher</surname><given-names>AG</given-names></name><name><surname>Foster</surname><given-names>KR</given-names></name></person-group><article-title>Migration and horizontal gene transfer divide microbial genomes into multiple niches</article-title><source>Nat Commun</source><year>2015</year><volume>6</volume><elocation-id>8924</elocation-id><pub-id pub-id-type="pmcid">PMC4673824</pub-id><pub-id pub-id-type="pmid">26592443</pub-id><pub-id pub-id-type="doi">10.1038/ncomms9924</pub-id></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dillard</surname><given-names>JR</given-names></name><name><surname>Westneat</surname><given-names>DF</given-names></name></person-group><article-title>Disentangling the Correlated Evolution of Monogamy and Cooperation</article-title><source>Trends in Ecology &amp; Evolution</source><year>2016</year><volume>31</volume><fpage>503</fpage><lpage>513</lpage><pub-id pub-id-type="pmid">27156754</pub-id></element-citation></ref><ref id="R29"><label>29</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cornwallis</surname><given-names>CK</given-names></name><etal/></person-group><article-title>Cooperation facilitates the colonization of harsh environments</article-title><source>Nat Ecol Evol</source><year>2017</year><volume>1</volume><fpage>1</fpage><lpage>10</lpage><pub-id pub-id-type="pmid">28812731</pub-id></element-citation></ref><ref id="R30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Morlon</surname><given-names>H</given-names></name><etal/></person-group><article-title>Phylogenetic Insights into Diversification</article-title><year>2024</year><pub-id pub-id-type="doi">10.1146/annurev-ecolsys-102722-020508</pub-id></element-citation></ref><ref id="R31"><label>31</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xu</surname><given-names>Q</given-names></name><etal/></person-group><article-title>Microbial generalists and specialists differently contribute to the community diversity in farmland soils</article-title><source>Journal of Advanced Research</source><year>2022</year><volume>40</volume><fpage>17</fpage><lpage>27</lpage><pub-id pub-id-type="pmcid">PMC9481938</pub-id><pub-id pub-id-type="pmid">36100325</pub-id><pub-id pub-id-type="doi">10.1016/j.jare.2021.12.003</pub-id></element-citation></ref><ref id="R32"><label>32</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Parks</surname><given-names>DH</given-names></name><etal/></person-group><article-title>GTDB: an ongoing census of bacterial and archaeal diversity through a phylogenetically consistent, rank normalized and complete genome-based taxonomy</article-title><source>Nucleic Acids Research</source><year>2022</year><volume>50</volume><fpage>D785</fpage><lpage>D794</lpage><pub-id pub-id-type="pmcid">PMC8728215</pub-id><pub-id pub-id-type="pmid">34520557</pub-id><pub-id pub-id-type="doi">10.1093/nar/gkab776</pub-id></element-citation></ref><ref id="R33"><label>33</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mise</surname><given-names>K</given-names></name><name><surname>Iwasaki</surname><given-names>W</given-names></name></person-group><article-title>Environmental Atlas of Prokaryotes Enables Powerful and Intuitive Habitat-Based Analysis of Community Structures</article-title><source>iScience</source><year>2020</year><volume>23</volume><elocation-id>101624</elocation-id><pub-id pub-id-type="pmcid">PMC7581931</pub-id><pub-id pub-id-type="pmid">33117966</pub-id><pub-id pub-id-type="doi">10.1016/j.isci.2020.101624</pub-id></element-citation></ref><ref id="R34"><label>34</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Coelho</surname><given-names>LP</given-names></name><etal/></person-group><article-title>Towards the biogeography of prokaryotic genes</article-title><source>Nature</source><year>2022</year><volume>601</volume><fpage>252</fpage><lpage>256</lpage><pub-id pub-id-type="pmcid">PMC7613196</pub-id><pub-id pub-id-type="pmid">34912116</pub-id><pub-id pub-id-type="doi">10.1038/s41586-021-04233-4</pub-id></element-citation></ref><ref id="R35"><label>35</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Belcher</surname><given-names>LJ</given-names></name><etal/></person-group><article-title>SOCfinder: a genomic tool for identifying cooperative genes in bacteria</article-title><year>2023</year><elocation-id>2023.10.16.562460</elocation-id><pub-id pub-id-type="pmcid">PMC10763506</pub-id><pub-id pub-id-type="pmid">38117204</pub-id><pub-id pub-id-type="doi">10.1099/mgen.0.001171</pub-id></element-citation></ref><ref id="R36"><label>36</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Simonet</surname><given-names>C</given-names></name><name><surname>McNally</surname><given-names>L</given-names></name></person-group><article-title>Kin selection explains the evolution of cooperation in the gut microbiota</article-title><source>PNAS</source><year>2021</year><volume>118</volume><pub-id pub-id-type="pmcid">PMC8017935</pub-id><pub-id pub-id-type="pmid">33526674</pub-id><pub-id pub-id-type="doi">10.1073/pnas.2016046118</pub-id></element-citation></ref><ref id="R37"><label>37</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kanehisa</surname><given-names>M</given-names></name><name><surname>Sato</surname><given-names>Y</given-names></name><name><surname>Kawashima</surname><given-names>M</given-names></name><name><surname>Furumichi</surname><given-names>M</given-names></name><name><surname>Tanabe</surname><given-names>M</given-names></name></person-group><article-title>KEGG as a reference resource for gene and protein annotation</article-title><source>Nucleic Acids Research</source><year>2016</year><volume>44</volume><fpage>D457</fpage><lpage>D462</lpage><pub-id pub-id-type="pmcid">PMC4702792</pub-id><pub-id pub-id-type="pmid">26476454</pub-id><pub-id pub-id-type="doi">10.1093/nar/gkv1070</pub-id></element-citation></ref><ref id="R38"><label>38</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aramaki</surname><given-names>T</given-names></name><etal/></person-group><article-title>KofamKOALA: KEGG Ortholog assignment based on profile HMM and adaptive score threshold</article-title><source>Bioinformatics</source><year>2020</year><volume>36</volume><fpage>2251</fpage><lpage>2252</lpage><pub-id pub-id-type="pmcid">PMC7141845</pub-id><pub-id pub-id-type="pmid">31742321</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btz859</pub-id></element-citation></ref><ref id="R39"><label>39</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hadfield</surname><given-names>JD</given-names></name></person-group><article-title>MCMC Methods for Multi-Response Generalized Linear Mixed Models: The MCMCglmm R Package</article-title><source>Journal of Statistical Software</source><year>2010</year><volume>33</volume><fpage>1</fpage><lpage>22</lpage></element-citation></ref><ref id="R40"><label>40</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Domingo-Sananes</surname><given-names>MR</given-names></name><name><surname>McInerney</surname><given-names>JO</given-names></name></person-group><article-title>Mechanisms That Shape Microbial Pangenomes</article-title><source>Trends in Microbiology</source><year>2021</year><volume>29</volume><fpage>493</fpage><lpage>503</lpage><pub-id pub-id-type="pmid">33423895</pub-id></element-citation></ref><ref id="R41"><label>41</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hall</surname><given-names>RJ</given-names></name><etal/></person-group><article-title>Gene-Gene Relationships in an Escherichia Coli Accessory Genome Are Linked to Function and Mobility</article-title><year>2021</year><elocation-id>2021.03.26.437181</elocation-id><comment><ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/2021.03.26.437181v1">https://www.biorxiv.org/content/10.1101/2021.03.26.437181v1</ext-link></comment><pub-id pub-id-type="pmcid">PMC8715431</pub-id><pub-id pub-id-type="pmid">34499026</pub-id><pub-id pub-id-type="doi">10.1099/mgen.0.000650</pub-id></element-citation></ref><ref id="R42"><label>42</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Konno</surname><given-names>N</given-names></name><name><surname>Iwasaki</surname><given-names>W</given-names></name></person-group><article-title>Machine learning enables prediction of metabolic system evolution in bacteria</article-title><source>Science Advances</source><year>2023</year><volume>9</volume><elocation-id>eadc9130</elocation-id><pub-id pub-id-type="pmcid">PMC9833677</pub-id><pub-id pub-id-type="pmid">36630500</pub-id><pub-id pub-id-type="doi">10.1126/sciadv.adc9130</pub-id></element-citation></ref><ref id="R43"><label>43</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Revell</surname><given-names>LJ</given-names></name><name><surname>Harmon</surname><given-names>LJ</given-names></name></person-group><source>Phylogenetic Comparative Methods in R</source><publisher-name>Princeton University Press</publisher-name><year>2022</year></element-citation></ref><ref id="R44"><label>44</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kramer</surname><given-names>J</given-names></name><name><surname>Özkaya</surname><given-names>Ö</given-names></name><name><surname>Kümmerli</surname><given-names>R</given-names></name></person-group><article-title>Bacterial siderophores in community and host interactions</article-title><source>Nat Rev Microbiol</source><year>2020</year><volume>18</volume><fpage>152</fpage><lpage>163</lpage><pub-id pub-id-type="pmcid">PMC7116523</pub-id><pub-id pub-id-type="pmid">31748738</pub-id><pub-id pub-id-type="doi">10.1038/s41579-019-0284-4</pub-id></element-citation></ref><ref id="R45"><label>45</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McCutcheon</surname><given-names>JP</given-names></name><name><surname>Moran</surname><given-names>NA</given-names></name></person-group><article-title>Extreme genome reduction in symbiotic bacteria</article-title><source>Nat Rev Microbiol</source><year>2012</year><volume>10</volume><fpage>13</fpage><lpage>26</lpage><pub-id pub-id-type="pmid">22064560</pub-id></element-citation></ref><ref id="R46"><label>46</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rolland</surname><given-names>J</given-names></name><etal/></person-group><article-title>Conceptual and empirical bridges between micro- and macroevolution</article-title><source>Nat Ecol Evol</source><year>2023</year><volume>7</volume><fpage>1181</fpage><lpage>1193</lpage><pub-id pub-id-type="pmid">37429904</pub-id></element-citation></ref><ref id="R47"><label>47</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McInerney</surname><given-names>JO</given-names></name><name><surname>McNally</surname><given-names>A</given-names></name><name><surname>O’Connell</surname><given-names>MJ</given-names></name></person-group><article-title>Why prokaryotes have pangenomes</article-title><source>Nat Microbiol</source><year>2017</year><volume>2</volume><fpage>1</fpage><lpage>5</lpage><pub-id pub-id-type="pmid">28350002</pub-id></element-citation></ref><ref id="R48"><label>48</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maddison</surname><given-names>WP</given-names></name><name><surname>Midford</surname><given-names>PE</given-names></name><name><surname>Otto</surname><given-names>SP</given-names></name></person-group><article-title>Estimating a Binary Character’s Effect on Speciation and Extinction</article-title><source>Systematic Biology</source><year>2007</year><volume>56</volume><fpage>701</fpage><lpage>710</lpage><pub-id pub-id-type="pmid">17849325</pub-id></element-citation></ref><ref id="R49"><label>49</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>FitzJohn</surname><given-names>RG</given-names></name></person-group><article-title>Diversitree: comparative phylogenetic analyses of diversification in R</article-title><source>Methods in Ecology and Evolution</source><year>2012</year><volume>3</volume><fpage>1084</fpage><lpage>1092</lpage></element-citation></ref><ref id="R50"><label>50</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maddison</surname><given-names>WP</given-names></name><name><surname>FitzJohn</surname><given-names>RG</given-names></name></person-group><article-title>The unsolved challenge to phylogenetic correlation tests for categorical characters</article-title><source>Syst Biol</source><year>2015</year><volume>64</volume><fpage>127</fpage><lpage>136</lpage><pub-id pub-id-type="pmid">25209222</pub-id></element-citation></ref><ref id="R51"><label>51</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sun</surname><given-names>S-J</given-names></name><etal/></person-group><article-title>Climate-mediated cooperation promotes niche expansion in burying beetles</article-title><source>eLife</source><year>2014</year><volume>3</volume><elocation-id>e02440</elocation-id><pub-id pub-id-type="pmcid">PMC4042004</pub-id><pub-id pub-id-type="pmid">24842999</pub-id><pub-id pub-id-type="doi">10.7554/eLife.02440</pub-id></element-citation></ref><ref id="R52"><label>52</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Duffy</surname><given-names>JE</given-names></name><name><surname>Macdonald</surname><given-names>KS</given-names></name></person-group><article-title>Kin structure, ecology and the evolution of social organization in shrimp: a comparative analysis</article-title><source>Proceedings of the Royal Society B: Biological Sciences</source><year>2009</year><volume>277</volume><fpage>575</fpage><lpage>584</lpage><pub-id pub-id-type="pmcid">PMC2842683</pub-id><pub-id pub-id-type="pmid">19889706</pub-id><pub-id pub-id-type="doi">10.1098/rspb.2009.1483</pub-id></element-citation></ref><ref id="R53"><label>53</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rabosky</surname><given-names>DL</given-names></name></person-group><article-title>Likelihood Methods for Detecting Temporal Shifts in Diversification Rates</article-title><source>Evolution</source><year>2006</year><volume>60</volume><fpage>1152</fpage><lpage>1164</lpage><pub-id pub-id-type="pmid">16892966</pub-id></element-citation></ref><ref id="R54"><label>54</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cornwallis</surname><given-names>CK</given-names></name><etal/></person-group><article-title>Symbioses shape feeding niches and diversification across insects</article-title><source>Nat Ecol Evol</source><year>2023</year><volume>7</volume><fpage>1022</fpage><lpage>1044</lpage><pub-id pub-id-type="pmcid">PMC10333129</pub-id><pub-id pub-id-type="pmid">37202501</pub-id><pub-id pub-id-type="doi">10.1038/s41559-023-02058-0</pub-id></element-citation></ref><ref id="R55"><label>55</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bowers</surname><given-names>RM</given-names></name><etal/></person-group><article-title>Minimum information about a single amplified genome (MISAG) and a metagenome-assembled genome (MIMAG) of bacteria and archaea</article-title><source>Nat Biotechnol</source><year>2017</year><volume>35</volume><fpage>725</fpage><lpage>731</lpage><pub-id pub-id-type="pmcid">PMC6436528</pub-id><pub-id pub-id-type="pmid">28787424</pub-id><pub-id pub-id-type="doi">10.1038/nbt.3893</pub-id></element-citation></ref><ref id="R56"><label>56</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Benson</surname><given-names>DA</given-names></name><etal/></person-group><article-title>GenBank</article-title><source>Nucleic Acids Research</source><year>2013</year><volume>41</volume><fpage>D36</fpage><lpage>D42</lpage><pub-id pub-id-type="pmcid">PMC3531190</pub-id><pub-id pub-id-type="pmid">23193287</pub-id><pub-id pub-id-type="doi">10.1093/nar/gks1195</pub-id></element-citation></ref><ref id="R57"><label>57</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>O’Leary</surname><given-names>NA</given-names></name><etal/></person-group><article-title>Reference sequence (RefSeq) database at NCBI: current status, taxonomic expansion, and functional annotation</article-title><source>Nucleic Acids Research</source><year>2016</year><volume>44</volume><fpage>D733</fpage><lpage>D745</lpage><pub-id pub-id-type="pmcid">PMC4702849</pub-id><pub-id pub-id-type="pmid">26553804</pub-id><pub-id pub-id-type="doi">10.1093/nar/gkv1189</pub-id></element-citation></ref><ref id="R58"><label>58</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Quast</surname><given-names>C</given-names></name><etal/></person-group><article-title>The SILVA ribosomal RNA gene database project: improved data processing and web-based tools</article-title><source>Nucleic Acids Research</source><year>2013</year><volume>41</volume><fpage>D590</fpage><lpage>D596</lpage><pub-id pub-id-type="pmcid">PMC3531112</pub-id><pub-id pub-id-type="pmid">23193283</pub-id><pub-id pub-id-type="doi">10.1093/nar/gks1219</pub-id></element-citation></ref><ref id="R59"><label>59</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rognes</surname><given-names>T</given-names></name><name><surname>Flouri</surname><given-names>T</given-names></name><name><surname>Nichols</surname><given-names>B</given-names></name><name><surname>Quince</surname><given-names>C</given-names></name><name><surname>Mahé</surname><given-names>F</given-names></name></person-group><article-title>VSEARCH: a versatile open source tool for metagenomics</article-title><source>PeerJ</source><year>2016</year><volume>4</volume><elocation-id>e2584</elocation-id><pub-id pub-id-type="pmcid">PMC5075697</pub-id><pub-id pub-id-type="pmid">27781170</pub-id><pub-id pub-id-type="doi">10.7717/peerj.2584</pub-id></element-citation></ref><ref id="R60"><label>60</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Silby</surname><given-names>MW</given-names></name><name><surname>Winstanley</surname><given-names>C</given-names></name><name><surname>Godfrey</surname><given-names>SAC</given-names></name><name><surname>Levy</surname><given-names>SB</given-names></name><name><surname>Jackson</surname><given-names>RW</given-names></name></person-group><article-title>Pseudomonas genomes: diverse and adaptable</article-title><source>FEMS Microbiology Reviews</source><year>2011</year><volume>35</volume><fpage>652</fpage><lpage>680</lpage><pub-id pub-id-type="pmid">21361996</pub-id></element-citation></ref><ref id="R61"><label>61</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Charrad</surname><given-names>M</given-names></name><name><surname>Ghazzali</surname><given-names>N</given-names></name><name><surname>Boiteau</surname><given-names>V</given-names></name><name><surname>Niknafs</surname><given-names>A</given-names></name></person-group><article-title>NbClust: An R Package for Determining the Relevant Number of Clusters in a Data Set</article-title><source>Journal of Statistical Software</source><year>2014</year><volume>61</volume><fpage>1</fpage><lpage>36</lpage></element-citation></ref><ref id="R62"><label>62</label><element-citation publication-type="other"><person-group person-group-type="author"><name><surname>A</surname><given-names>K</given-names></name></person-group><source>Factoextra: extract and visualize the results of multivariate data analyses R Package Version</source><year>2016</year><volume>1</volume></element-citation></ref><ref id="R63"><label>63</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lau</surname><given-names>WYV</given-names></name><etal/></person-group><article-title>PSORTdb 4.0: expanded and redesigned bacterial and archaeal protein subcellular localization database incorporating new secondary localizations</article-title><source>Nucleic Acids Research</source><year>2021</year><volume>49</volume><fpage>D803</fpage><lpage>D808</lpage><pub-id pub-id-type="pmcid">PMC7778896</pub-id><pub-id pub-id-type="pmid">33313828</pub-id><pub-id pub-id-type="doi">10.1093/nar/gkaa1095</pub-id></element-citation></ref><ref id="R64"><label>64</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Paradis</surname><given-names>E</given-names></name><name><surname>Schliep</surname><given-names>K</given-names></name></person-group><article-title>ape 5.0: an environment for modern phylogenetics and evolutionary analyses in R</article-title><source>Bioinformatics</source><year>2019</year><volume>35</volume><fpage>526</fpage><lpage>528</lpage><pub-id pub-id-type="pmid">30016406</pub-id></element-citation></ref><ref id="R65"><label>65</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ishikawa</surname><given-names>SA</given-names></name><name><surname>Zhukova</surname><given-names>A</given-names></name><name><surname>Iwasaki</surname><given-names>W</given-names></name><name><surname>Gascuel</surname><given-names>O</given-names></name></person-group><article-title>A Fast Likelihood Method to Reconstruct and Visualize Ancestral Scenarios</article-title><source>Molecular Biology and Evolution</source><year>2019</year><volume>36</volume><fpage>2069</fpage><lpage>2085</lpage><pub-id pub-id-type="pmcid">PMC6735705</pub-id><pub-id pub-id-type="pmid">31127303</pub-id><pub-id pub-id-type="doi">10.1093/molbev/msz131</pub-id></element-citation></ref><ref id="R66"><label>66</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Granger</surname><given-names>CWJ</given-names></name></person-group><article-title>Investigating Causal Relations by Econometric Models and Cross-spectral Methods</article-title><source>Econometrica</source><year>1969</year><volume>37</volume><fpage>424</fpage><lpage>438</lpage></element-citation></ref><ref id="R67"><label>67</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Detto</surname><given-names>M</given-names></name><etal/></person-group><article-title>Causality and Persistence in Ecological Systems: A Nonparametric Spectral Granger Causality Approach</article-title><source>The American Naturalist</source><year>2012</year><volume>179</volume><fpage>524</fpage><lpage>535</lpage><pub-id pub-id-type="pmid">22437181</pub-id></element-citation></ref><ref id="R68"><label>68</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Beavan</surname><given-names>AJS</given-names></name><name><surname>Domingo-Sananes</surname><given-names>MR</given-names></name><name><surname>McInerney</surname><given-names>JO</given-names></name></person-group><article-title>Contingency, repeatability, and predictability in the evolution of a prokaryotic pangenome</article-title><source>Proceedings of the National Academy of Sciences</source><year>2024</year><volume>121</volume><elocation-id>e2304934120</elocation-id><pub-id pub-id-type="pmcid">PMC10769857</pub-id><pub-id pub-id-type="pmid">38147560</pub-id><pub-id pub-id-type="doi">10.1073/pnas.2304934120</pub-id></element-citation></ref><ref id="R69"><label>69</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Louca</surname><given-names>S</given-names></name><name><surname>Doebeli</surname><given-names>M</given-names></name></person-group><article-title>Efficient comparative phylogenetics on large trees</article-title><source>Bioinformatics</source><year>2018</year><volume>34</volume><fpage>1053</fpage><lpage>1055</lpage><pub-id pub-id-type="pmid">29091997</pub-id></element-citation></ref><ref id="R70"><label>70</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gamblin</surname><given-names>J</given-names></name><name><surname>Lambert</surname><given-names>A</given-names></name><name><surname>Blanquart</surname><given-names>F</given-names></name></person-group><article-title>Persistent, Private and Mobile genes: a model for gene dynamics in evolving pangenomes</article-title><year>2024</year><elocation-id>2024.07.15.603572</elocation-id><pub-id pub-id-type="doi">10.1101/2024.07.15.603572</pub-id></element-citation></ref><ref id="R71"><label>71</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Page</surname><given-names>AJ</given-names></name><etal/></person-group><article-title>Roary: rapid large-scale prokaryote pan genome analysis</article-title><source>Bioinformatics</source><year>2015</year><volume>31</volume><fpage>3691</fpage><lpage>3693</lpage><pub-id pub-id-type="pmcid">PMC4817141</pub-id><pub-id pub-id-type="pmid">26198102</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btv421</pub-id></element-citation></ref><ref id="R72"><label>72</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tonkin-Hill</surname><given-names>G</given-names></name><etal/></person-group><article-title>Producing polished prokaryotic pangenomes with the Panaroo pipeline</article-title><source>Genome Biol</source><year>2020</year><volume>21</volume><fpage>180</fpage><pub-id pub-id-type="pmcid">PMC7376924</pub-id><pub-id pub-id-type="pmid">32698896</pub-id><pub-id pub-id-type="doi">10.1186/s13059-020-02090-4</pub-id></element-citation></ref><ref id="R73"><label>73</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Revell</surname><given-names>LJ</given-names></name></person-group><article-title>phytools: an R package for phylogenetic comparative biology (and other things)</article-title><source>Methods in Ecology and Evolution</source><year>2012</year><volume>3</volume><fpage>217</fpage><lpage>223</lpage></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>(a) Cooperative bacteria might have broader niche breadths because the production of cooperative public goods (blue cells secreting golden molecules) facilitates adaptation to different habitats.</title><p>In contrast, non-cooperative bacteria (orange cells) might only adapt to specific habitats. (b) Generalists may have higher diversification rates compared to specialists. This is because generalists are exposed to diverse environments, each imposing unique selective pressure that facilitates the emergence of new species, and are better at surviving in those environments. Consequently, the diversity (number of species within a clade of the tree) of generalists might be higher than that of specialists. However, since generalists were proposed to carry more genes for cooperative traits, it is also possible that bacterial species with more such genes might have higher diversification rates. It remains unclear whether cooperation influences bacterial diversification rates directly or indirectly through its effect on niche breadth evolution.</p></caption><graphic xlink:href="EMS199277-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>Assessment of bacterial niche breadths.</title><p>Habitat preferences for each of the 32,262 species in our dataset were inferred using ProkAtlas, which contains 16S rRNA gene sequences from 114 distinct habitats. These habitats were subsequently grouped into “habitat clusters” based on similarities in species composition. Species’ habitat preference annotations were then updated accordingly. The 114 original habitats from the ProkAtlas database were clustered into 26 habitat clusters. The branches and labels of different clusters in this dendrogram were coloured differently. Niche breadth for each species was quantified by the number of habitat clusters in which they were found.</p></caption><graphic xlink:href="EMS199277-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>Correlation between bacterial cooperation and niche breadth.</title><p>(a) Using MCMCglmm, we found a positive correlation between the proportion of genes for cooperative traits and niche breadth, defined as the number of habitat clusters a species is found in. The asterisk denotes significant correlation. (b) The mean values (dot) and 95% credible intervals (horizontal bar) of posterior regression coefficients for these correlations. (c) A consistent positive correlation between the proportion of genes for cooperation and bacterial niche breadth was observed across various functional categories of genes for cooperation. Asterisks denote significant correlations.</p></caption><graphic xlink:href="EMS199277-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>Testing causal hypotheses for the relationship between bacterial cooperation and niche breadth evolution.</title><p>(a-d) Illustration of four potential causal relationships between changes in cooperative gene carriage and changes in niche breadth. Orange cells signify specialists, while blue cells represent generalists. Cells secreting golden molecules represent those carrying genes for cooperative traits. Solid arrows depict observed transition scenarios, while dashed arrows suggest the possible order of evolutionary events. For instance, panel (a) illustrates a scenario where a specialist first acquires genes for cooperation, then transits to a generalist carrying such genes. This signifies the direction of causation where having a higher proportion of genes for cooperation facilitates generalization. (e) Specialists were defined as species found in only one habitat cluster. Afterwards, the observed distribution of niche breadths was then compared against an expected distribution from 10,000 permutations to found generalist species. Those in 8 or more habitat clusters were identified as generalists, and species found in between were classified as having intermediate niche breadth. (f) Number of niche breadth transition events. Arrows indicate the direction of transition, with line widths proportional to the number of transition events. Only the transition events that occurred between each ancestral species (parent) and its two direct descendants (children) were counted to simplify the analysis. (g-i) Results of causal inference. (g) The prevalence of genes for cooperation in specialist ancestors did not significantly influence the niche expansion of their descendants, indicating that higher levels of cooperation are not a driving force for becoming generalists. (h) Generalist ancestors with descendants experiencing substantial niche contraction had lower proportions of genes for cooperation, suggesting that a reduced prevalence of genes for cooperation might facilitate specialization. (i) No significant relationship was observed between the niche breadth of ancestral species and the change in the proportion of genes for cooperation among their descendants, suggesting that transitions to either generalist or specialist do not affect the carriage of genes for cooperation in the offspring.</p></caption><graphic xlink:href="EMS199277-f004"/></fig><fig id="F5" position="float"><label>Figure 5</label><caption><title>Gain and loss dynamics of genes for cooperative traits.</title><p>(a) At the intraspecific level, the gain and loss rates of genes for cooperation are indicated by the propensity of a given gene for cooperation to be an accessory gene in a pangenome, meaning these genes are present only in a subset of strains of a species. The metric π is used to quantify the propensity of a gene being an accessory gene in a pangenome compared to random expectation. Each dot represents π for a specific gene type within a species, with red lines indicating the average π for each gene type across all species. Genes for cooperation were significantly more likely to be accessory genes, suggesting a higher intraspecific gain and loss rate for these genes, especially pronounced in genes related to secretion systems and antibiotic degradation. (b) The gene gain and loss rate across species (interspecific) is measured by the rate of state transitions for each KO. Ridgeline plots visualize the interspecific gene gain and loss rates, displaying the distribution of these rates for each gene type. The central line in each plot indicates the mean state transition rate for each gene type. No significant differences were observed between cooperative and non-cooperative KOs. However, biofilm formation-related KOs displayed significantly lower transition rates compared to non-cooperative KOs. (c) The gain rates are plotted against the loss rates for each cooperative KO on a log-log scale. Each dot represents the rate of a cooperative KO. The dashed line indicates where gain and loss rates are equal. The upper-left region shows where loss rates exceed gain rates, while the bottom-right region shows where gain rates exceed loss rates. For the majority of cooperative KOs, loss rates were found to be larger than gain rates.</p></caption><graphic xlink:href="EMS199277-f005"/></fig><fig id="F6" position="float"><label>Figure 6</label><caption><title>Family-wise bacterial diversification analyses.</title><p>Both the proportion of genes for cooperation and the niche breadth were binarized to meet the requirement of fitting character-dependent SSE models. To assess if diversification patterns of one variable might be influenced by another, we combined the two binary variables into one with four states and explored the role of this new variable in bacterial diversification. (a) Regarding speciation rates, the rate for state 1 was significantly lower than that for state 2, indicating that species with lower cooperation levels have reduced speciation rates compared to those with higher cooperation levels when they also have narrower niche breadths. Each dot represents the rate parameter of a specific state of a trait for a given family. (b) For extinction rates, the rate for state 1 was significantly lower than that for state 2, indicating that species with lower cooperation levels have lower extinction rates compared to those with higher cooperation levels when they also have narrower niche breadths. Additionally, the extinction rate for state 1 was significantly lower than that for state 3, indicating that species with narrower niche breadths have reduced extinction rates compared to those with broader niche breadths when they also carry fewer genes for cooperative traits.</p></caption><graphic xlink:href="EMS199277-f006"/></fig></floats-group></article>