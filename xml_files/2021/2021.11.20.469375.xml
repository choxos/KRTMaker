<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS147796</article-id><article-id pub-id-type="doi">10.1101/2021.11.20.469375</article-id><article-id pub-id-type="archive">PPR423665</article-id><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Balancing selection and the crossing of fitness valleys in structured populations: diversification in the gametophytic self-incompatibility system</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Stetsenko</surname><given-names>Roman</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Brom</surname><given-names>Thomas</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Castric</surname><given-names>Vincent</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Billiard</surname><given-names>Sylvain</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib></contrib-group><aff id="A1"><label>1</label>Univ. Lille, CNRS, UMR 8198 - Evo-Eco-Paleo, F-59000 Lille, France</aff><aff id="A2"><label>2</label>International Research Laboratory 3614, CNRS, 29680 Roscoff, France</aff><aff id="A3"><label>3</label>Station Biologique de Roscoff, Sorbonne Universite, Roscoff 29680, France</aff><author-notes><corresp id="CR1"><label>*</label>corresponding author: <email>sylvain.billiard@univ-lille.fr</email></corresp></author-notes><pub-date pub-type="nihms-submitted"><day>06</day><month>07</month><year>2022</year></pub-date><pub-date pub-type="preprint"><day>05</day><month>07</month><year>2022</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">The self-incompatibility locus (<italic>S</italic>-locus) of flowering plants displays a striking allelic diversity. How such a diversity has emerged remains unclear. In this paper, we performed numerical simulations in a finite island population genetics model to investigate how population subdivision affects the diversification process at a <italic>S</italic>-locus, given that the two-genes architecture typical of <italic>S</italic>-loci involves the crossing of a fitness valley. We show that population structure slightly reduces the parameter range allowing for the diversification of self-incompatibility haplotypes (<italic>S</italic>-haplotypes), but at the same time also increases the number of these haplotypes maintained in the whole metapopulation. This increase is partly due to a higher rate of diversification and replacement of <italic>S</italic>-haplotypes within and among demes. We also show that the two-genes architecture leads to a higher diversity in structured populations compared with a simpler genetic architecture where new <italic>S</italic>-haplotypes appear in a single mutation step. Overall, our results suggest that population subdivision can act in two opposite directions: it renders <italic>S</italic>-haplotypes diversification easier, although it also increases the risk that the self-incompatibility system is lost.</p></abstract><kwd-group><kwd>fitness landscape</kwd><kwd>negative frequency dependent selection</kwd><kwd>metapopulation</kwd><kwd>genetic architecture</kwd><kwd>two genes epistasis</kwd></kwd-group></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P2">Adaptation often occurs on rugged fitness landscapes with multiple peaks and valleys (<italic>e.g</italic>. <xref ref-type="bibr" rid="R22">Korona et al. 1994</xref>; <xref ref-type="bibr" rid="R8">Burch and Chao 2000</xref>; <xref ref-type="bibr" rid="R36">Weinreich et al. 2006</xref>; <xref ref-type="bibr" rid="R23">Kvitek and Sherlock 2011</xref>; <xref ref-type="bibr" rid="R29">Salverda et al. 2011</xref>; <xref ref-type="bibr" rid="R35">Vos et al. 2015</xref>, for a review see <xref ref-type="bibr" rid="R11">de Visser and Krug 2014</xref>). This is especially true when the trait is genetically complex and the emergence of evolutionary novelties is conditioned on the beneficial combination of epistatic mutations in a single genome (<xref ref-type="bibr" rid="R39">Whitlock et al., 1995</xref>). In many cases, attaining a higher fitness peak can require a succession of mutations where some are deleterious on their own. Under the “shifting balance theory” popularized by <xref ref-type="bibr" rid="R40">Wright (1932)</xref> this process is referred to as the crossing of fitness valleys. The rate at which populations move across the fitness landscape and eventually cross fitness valleys depends on a subtle balance between mutation rate, population size and the distribution of mutational effects (<italic>e.g</italic>. <xref ref-type="bibr" rid="R37">Weissman et al. 2009</xref>; <xref ref-type="bibr" rid="R5">Bovier et al. 2019</xref> in asexual panmictic populations), in combination with genetic exchange across space (<italic>e.g</italic>. <xref ref-type="bibr" rid="R3">Bitbol and Schwab 2014</xref>; <xref ref-type="bibr" rid="R21">Komarova et al. 2014</xref>; McLaren 2016 in asexual spatially divided populations) or between genomes (the recombination rate in sexual populations, <italic>e.g</italic>. <xref ref-type="bibr" rid="R38">Weissman et al. 2010</xref>). Overall, the rate at which fitness valleys are crossed depends on the time taken for the epistatic mutations to occur in the same genome, and the probability of fixation and time of residence of mutations in the population.</p><p id="P3">Theoretical studies investigating the conditions under which fitness valleys can be crossed have mostly assumed directional selection, so their predictions do not apply to all traits. Many complex genetic systems, in particular, evolve under balancing selection, including in particular pathogens escaping the immune system of their host (<xref ref-type="bibr" rid="R6">Bowen and Walker, 2005</xref>; <xref ref-type="bibr" rid="R13">Fernandez et al., 2005</xref>; <xref ref-type="bibr" rid="R32">Shih et al., 2007</xref>), or the genes involved in avoidance of self-fertilization in fungi, plants or ciliates (<xref ref-type="bibr" rid="R2">Billiard et al., 2011</xref>). Studying how fitness valleys are crossed in such systems is particularly relevant because they are often characterized by a very large allelic diversity at superloci, suggesting a high rate of emergence of evolutionary novelties and thus frequent fitness valley crossing.</p><p id="P4">The self-incompatibility (SI) system in Angiosperms is particularly relevant to address this question. SI is present in about 40% of Angiosperm families, where it allows recognition between pollen and pistils for selfing avoidance (<xref ref-type="bibr" rid="R20">Igic et al., 2008</xref>; <xref ref-type="bibr" rid="R25">McCubbin and Kao, 2000</xref>; <xref ref-type="bibr" rid="R1">Barrett, 2002</xref>). SI is often determined by a single locus, called the <italic>S</italic>-locus. The <italic>S</italic>-locus is characterized by high haplotypic diversity which is maintained by a particular type of balancing selection called negative frequency-dependent selection, whereby individuals expressing rare haplotypes can mate with more individuals than the ones carrying frequent haplotypes (<xref ref-type="bibr" rid="R41">Wright, 1939</xref>). A series of early theoretical works approximated the number of alleles that can be maintained at the <italic>S</italic>-locus (<italic>S</italic>-alleles) in a population under various conditions (<italic>e.g</italic>. population size, mutation rate, deleterious mutations) assuming that <italic>S</italic>-alleles are generated by mutations occurring at the <italic>S</italic>-locus at a given rate (<xref ref-type="bibr" rid="R41">Wright, 1939</xref>, <xref ref-type="bibr" rid="R42">1964</xref>; <xref ref-type="bibr" rid="R43">Yokoyama and Hetherington, 1982</xref>; Muir-head, 2001; <xref ref-type="bibr" rid="R33">Uyenoyama, 2003</xref>). However, these models ignored the mechanisms by which new <italic>S</italic>-alleles can emerge, and more recent works focused on the conditions of emergence of new <italic>S</italic>-haplotypes under a variety of more realistic assumptions (<xref ref-type="bibr" rid="R34">Uyenoyama et al., 2001</xref>; <xref ref-type="bibr" rid="R16">Gervais et al., 2011</xref>; <xref ref-type="bibr" rid="R28">Sakai, 2016</xref>; <xref ref-type="bibr" rid="R4">Bod’ova et al., 2018</xref>; <xref ref-type="bibr" rid="R19">Harkness et al., 2019</xref>), in particular through an evolutionary step implying the crossing of a fitness valley.</p><p id="P5">In this study we focused on gametophytic SI (GSI), in which the pollen specificity is determined by its own haploid genome and <italic>S</italic>-alleles are codominant in pistils. The genetic architecture of the <italic>S</italic>-locus is typically relatively simple, with male and female specificities encoded by distinct but tightly linked genes (often one each, <xref ref-type="bibr" rid="R14">Fujii et al., 2016</xref>, but see non-self recognition systems, <italic>e.g</italic>. <xref ref-type="bibr" rid="R4">Bod’ova et al., 2018</xref>). <xref ref-type="bibr" rid="R34">Uyenoyama et al. (2001)</xref> studied the conditions of emergence of a new <italic>S</italic>-haplotype by mutations on both genes. They considered that new <italic>S</italic>-haplotypes are formed first by a mutation on the male or the female determinant, creating an intermediate haplotype with a new pollen or pistil specificity, but no matching recognition at the other gene. This haplotype is thus self-compatible (SC) and its selfed offspring will suffer from inbreeding depression. This intermediate haplotype thus represents a fitness valley that needs to be crossed in order to create a new <italic>S</italic>-haplotype. This happens when the first mutation is followed by a compensatory mutation on the female or on the male determinant (depending on the nature of the first mutation), restoring a fully functional new <italic>S</italic>-haplotype in which the pistil specificity matches that of the pollen. <xref ref-type="bibr" rid="R34">Uyenoyama et al. (2001)</xref> showed that in an infinite population, new <italic>S</italic>-haplotypes can emerge for high values of inbreeding depression and low to intermediate values of the rate of self-pollination. In these conditions, the intermediate SC haplotype invades when it is rare, but it does not go to fixation, allowing the second mutation to arise and create the new <italic>S</italic>-haplotype. However, they also showed that in the course of this process, the ancestral <italic>S</italic>-haplotype was most often lost by competitive exclusion by its mutated SC haplotype. Thus, this model predicted that even though new <italic>S</italic>-haplotypes can emerge, the new derived <italic>S</italic>-haplotypes tend to replace their ancestral copies along the process, such that in the end the overall number of <italic>S</italic>-haplotypes is expected to remain constant. The conditions under which diversification of <italic>S</italic>-haplotypes is possible are thus restricted either because the SC intermediate haplotype cannot invade at all or because its ancestor is lost. In this model, crossing fitness valleys thus results in <italic>S</italic>-haplotypes turnover rather than diversification (<xref ref-type="boxed-text" rid="BX1">Box 1</xref>, <xref ref-type="supplementary-material" rid="SD1">Fig. S1</xref>).</p><p id="P6"><xref ref-type="bibr" rid="R16">Gervais et al. (2011)</xref> further analyzed <xref ref-type="bibr" rid="R34">Uyenoyama et al. (2001)</xref>’s model, but in a finite population with recurrent mutations. They showed that the rate at which new <italic>S</italic>-haplotypes emerge depends on a balance between population size, mutation rates and selection strength (inbreeding depression cost <italic>vs</italic>. negative frequency-dependent selection). More importantly, <italic>S</italic>-haplotype diversification occurred under a relatively wide range of parameters because the residence time of SC haplotypes can be long in finite populations. They further showed that diversification is a self-attenuating process, whereby the increase in the number of <italic>S</italic>-haplotypes in the population renders the emergence of novel <italic>S</italic>-haplotypes in turn less likely. As a result, regardless of the parameter values considered, the maximal number of <italic>S</italic>-haplotypes maintained at stationary state is predicted to rarely go beyond a dozen, almost an order of magnitude lower than the observed haplotypic diversity in natural populations (from a few dozens to &gt; 100 observed <italic>S</italic>-haplotypes (<xref ref-type="bibr" rid="R24">Lawrence, 2000</xref>; <xref ref-type="bibr" rid="R9">Castric and Vekemans, 2004</xref>)). Hence, current models in finite or in infinite isolated populations fall short in explaining the entire diversity encountered at the <italic>S</italic>-locus in natural populations (but see <xref ref-type="bibr" rid="R28">Sakai, 2016</xref>).</p><p id="P7"><xref ref-type="bibr" rid="R41">Wright (1939)</xref> was the first to propose that population subdivision might contribute to the large diversity of <italic>S</italic>-haplotypes, but he did not account for the particular two-genes genetic architecture underlying SI. <xref ref-type="bibr" rid="R34">Uyenoyama et al. (2001)</xref> and <xref ref-type="bibr" rid="R16">Gervais et al. (2011)</xref> latter studied diversification of <italic>S</italic>-haplotypes with the two-genes genetic architecture but they did not explore the effect of population subdivision. Predicting the effect of population subdivision on the diversification process is not straightforward as population subdivision can have opposite effects on the maintenance of <italic>S</italic>-haplotypes at the global (metapopulation) or local (deme) scale because: 1) <italic>S</italic>-alleles can be lost by chance in isolated demes (genetic drift), 2) balancing selection increases the invasion probability of new <italic>S</italic>-alleles when the local <italic>S</italic>-allele diversity is low, and 3) dispersal homogenizes <italic>S</italic>-allele diversity among demes (<xref ref-type="bibr" rid="R30">Schierup, 1998</xref>; <xref ref-type="bibr" rid="R31">Schierup et al., 2000</xref>; <xref ref-type="bibr" rid="R27">Muirhead, 2001</xref>). In addition, population subdivision facilitates the breakdown of SI because it decreases the local effective number of <italic>S</italic>-haplotypes helping the invasion of SC haplotypes in the metapopulation (<xref ref-type="bibr" rid="R7">Brom et al., 2020</xref>). How population subdivision would globally affect diversification thus remains unclear.</p><p id="P8">In this paper, we used population genetics simulations to evaluate the effect of population structure on the dynamics of <italic>S</italic>-haplotypes diversification. First, we compared the parameter range allowing <italic>S</italic>-haplotypes to diversify in structured populations with that in unstructured populations. Second, we determined how the number of <italic>S</italic>-haplotypes maintained at steady state varies with the degree of population structure. Third, we disentangled the mechanisms underlying the effect of population structure on <italic>S</italic>-haplotypes diversification. Finally, in order to study the more general issue of fitness valley crossing in structured populations, we investigated the interaction between population structure and the underlying genetic architecture of the <italic>S</italic>-locus.</p></sec><sec id="S2"><title>Models and Methods</title><sec id="S3"><title>Genetic and demographic model</title><p id="P9">A subdivided population of diploid hermaphroditic plants is assumed with a gametophytic SI mating system. The SI phenotype, <italic>i.e</italic>. the expressed specificities in pollen and pistils, is determined by the <italic>S</italic>-haplotypes of the individuals. Mating can only occur between individuals expressing different pollen and pistil specificities. Pollen specificity is determined by the haploid genome of the gametophyte (the pollen grain), and the pistil specificity is codominantly determined by the diploid genome of the sporophyte (the adult plant). <italic>S</italic>-haplotypes are composed of two completely linked genes: the pistil-part gene, denoted <italic>A</italic>, determines the female specificity; the pollenpart gene, denoted <italic>B</italic>, determines the male specificity. We denote <italic>S<sub>i</sub></italic> an haplotype expressing specificity <italic>i</italic> at the pollen and pistil genes, and <italic>A<sub>i</sub></italic> and <italic>B<sub>i</sub></italic> the alleles present at genes A and B, respectively. Hence, an individual with genotype <italic>S<sub>i</sub>S<sub>j</sub></italic> (carrying haplotypes <italic>A<sub>i</sub>B<sub>i</sub></italic>/<italic>A<sub>j</sub>B<sub>j</sub></italic>) is self-incompatible since its individual pollen grains express either the specificity <italic>i</italic> or <italic>j</italic>, and its pistils express both specificities <italic>i</italic> and <italic>j</italic>.</p><p id="P10">An analytical model taking into account diversification of <italic>S</italic>-haplotypes with the two-genes genetic architecture and population subdivision was not possible to build. Indeed, the rate of diversification of <italic>S</italic>-haplotypes depends on the probability that a compensatory mutation arises in a population of SC haplotypes. Evaluating this probability would have implied the construction of a stochastic model to compute the average residence time of those SC haplotypes in the population, taking into account the effect of drift, inbreeding depression and compatibility between haplotypes. Because, to our knowledge, such a model is not mathematically tractable we resorted to individual-based simulations of a finite island model with non-overlapping generations. Initially, the population was composed of self-incompatible individuals with heterozygous <italic>S</italic>-genotypes randomly drawn among the <italic>n</italic> possible S haplotypes. The metapopulation was divided into <italic>p</italic> equally-sized demes of <italic>N</italic> individuals. Pollen dispersed at rate <italic>d<sub>p</sub></italic> between demes (we neglected seed dispersal). During the life cycle, events occurred in the following order: 1) Mutations at genes <italic>A</italic> and <italic>B</italic>; 2) Pollen migration between demes; 3) Pollination and fertilization; 4) Demographic events: reproduction, adults death and recruitment.</p></sec><sec id="S4"><title>Mutation</title><p id="P11">We assumed a maximum of <italic>k</italic> possible specificities in the population (1 ≤ <italic>i</italic> ≤ <italic>k</italic>). In other words, we considered a <italic>k</italic>-alleles mutation model at both the pollen and the pistil genes. Mutations are recurrently introduced into the population at the <italic>S</italic>-locus. Under the 2-steps mutation model (<xref ref-type="fig" rid="F1">Fig. 1B</xref>), mutations occur with probability <italic>μ</italic><sub>2</sub>, on the pollen gene (<italic>B<sub>i</sub></italic> → <italic>B<sub>j</sub></italic>) or on the pistil gene (<italic>A<sub>i</sub></italic> → <italic>A<sub>j</sub></italic>), independently. A mutation randomly changes a specificity <italic>i</italic> into a specificity <italic>j</italic> ≠ <italic>i</italic> (1 ≤ <italic>j</italic> ≤ <italic>k</italic>), drawn from a uniform distribution. In line with the notation of <xref ref-type="bibr" rid="R34">Uyenoyama et al. (2001)</xref>, a mutation can thus give rise to four different haplotypes, depending on the ancestral haplotype and the modified gene: 1) a pollen-part mutant self-compatible (SC) haplotype, denoted <italic>S<sub>b</sub></italic>; 2) a pistil-part mutant SC haplotype, denoted <italic>S<sub>a</sub></italic>; 3) an already existing <italic>S</italic>-haplotype, denoted <italic>S<sub>n</sub></italic>; 4) a new <italic>S</italic>-haplotype, denoted <italic>S</italic><sub><italic>n</italic>+1</sub> (1 ≤ <italic>n</italic> + 1 ≤ <italic>k</italic>).</p><p id="P12">The pistil- and pollen-part mutant haplotypes <italic>S<sub>a</sub></italic> and <italic>S<sub>b</sub></italic> are self-compatible because their pollen and pistils express different specificities. Note that haplotypes <italic>S<sub>a</sub></italic> and <italic>S<sub>b</sub></italic> can express a specificity <italic>n</italic> + 1 which is not already present in the population. A new <italic>S</italic>-haplotype <italic>S</italic><sub><italic>n</italic>+1</sub> is formed when an ancestral haplotype has undergone two mutations: a first mutation giving a SC haplotype (<italic>S<sub>b</sub></italic> or <italic>S<sub>a</sub></italic>) and a second compensatory mutation restoring the <italic>S</italic>-haplotype function.</p><p id="P13">In order to compare the impact of the genetic architecture of <italic>S</italic>-haplotypes on the diversification dynamics, we also considered a 1-step mutation model. In this model, haplotype <italic>S<sub>j</sub></italic> mutates in a single step to <italic>S<sub>j</sub></italic> at rate <italic>μ</italic><sub>1</sub> per haploid genome per generation (<italic>i.e</italic>. both alleles <italic>A<sub>i</sub></italic> and <italic>B<sub>i</sub></italic> simultaneously mutate to alleles <italic>A<sub>j</sub></italic> and <italic>B<sub>j</sub></italic>). <italic>j</italic> is randomly and uniformly chosen such that <italic>j</italic> ≠ <italic>i</italic> and 1 ≤ <italic>j</italic> ≤ <italic>k</italic>. This 1-step model, where the <italic>S</italic>-locus is not split into a female and a male genes and mutations do not generate self-compatible haplotypes, is the one classically considered in models on the evolution and maintenance of GSI (<italic>e.g</italic>. <xref ref-type="bibr" rid="R41">Wright, 1939</xref>; <xref ref-type="bibr" rid="R30">Schierup, 1998</xref>; <xref ref-type="bibr" rid="R15">Gervais et al., 2014</xref>; <xref ref-type="bibr" rid="R7">Brom et al., 2020</xref>).</p></sec><sec id="S5"><title>Pollination</title><p id="P14">Each individual of the next generation is formed by randomly drawing a female and a male gamete. Firstly, a female is drawn in the local deme (no seed dispersion) according to its relative fitness in the population, which differs between selfed and outcrossed individuals because of inbreeding depression <italic>δ</italic>. The fitness of selfed <italic>vs</italic>. outcrossed individuals is <italic>W<sub>self</sub></italic> = 1 – <italic>δ</italic> and <italic>W<sub>out</sub></italic> = 1 respectively (the probability that an individual is chosen as a mother is thus weighted by its own fitness relative to all the other individuals). Once a mother is chosen, an ovule is produced by randomly choosing one of the two chromosomes of the mother, with equal probability. Secondly, a father is drawn from the same deme as the mother with probability 1 – <italic>d<sub>p</sub></italic> or from a different deme with probability <italic>d<sub>p</sub></italic>. The probability for a plant to be chosen as a father is also weighted by its own fitness because of inbreeding depression (<italic>W<sub>self</sub></italic> = 1 – <italic>δ</italic> if inbred, <italic>W<sub>out</sub></italic> = 1 if outcrossed). If the pollen grain is not compatible with the pistil of the chosen mother, another pollen is randomly drawn until fertilization can occur (hence all chosen ovules eventually find a compatible pollen, precluding pollen limitation). In SC individuals, compatible pollen can come either from their own pollen or from other individuals and the probability that an SC individual reproduces by selfing corresponds to the ratio of its own compatible pollen over the compatible pollen present in the total pollen pool. The effective selfing rate of an individual <italic>i</italic> is thus given by <disp-formula id="FD1"><label>(1)</label><mml:math id="M1"><mml:mrow><mml:msub><mml:mi>a</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>α</mml:mi><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>W</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>α</mml:mi><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>W</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>α</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>p</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mfrac><mml:mrow><mml:msup><mml:mi>∑</mml:mi><mml:mrow><mml:mfrac><mml:mi>N</mml:mi><mml:mi>p</mml:mi></mml:mfrac><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>W</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mfrac><mml:mi>N</mml:mi><mml:mi>p</mml:mi></mml:mfrac><mml:mo>-</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>α</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mi>p</mml:mi></mml:msub><mml:mfrac><mml:mrow><mml:msup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>N</mml:mi><mml:mo>-</mml:mo><mml:mfrac><mml:mi>N</mml:mi><mml:mi>p</mml:mi></mml:mfrac></mml:mrow></mml:msup><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>W</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>-</mml:mo><mml:mfrac><mml:mi>N</mml:mi><mml:mi>p</mml:mi></mml:mfrac></mml:mrow></mml:mfrac></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P15">where <italic>α</italic> is the proportion of self-pollen, <italic>γ<sub>ii</sub></italic> the number of SC haplotypes carried by individual <italic>i</italic>, <italic>γ<sub>ij</sub></italic> the number of compatible haplotype an individual <italic>j</italic> has with an individual <italic>i</italic> (<italic>γ<sub>ii</sub></italic> and <italic>γ<sub>ij</sub></italic> can thus be 0, 1 or 2), <italic>W<sub>i</sub></italic> the pollen production of individual <italic>i</italic> and <italic>W<sub>j</sub></italic> the pollen production of individual <italic>j</italic> (<italic>W<sub>i</sub></italic>, <italic>W<sub>j</sub></italic> = <italic>W<sub>self</sub></italic> or <italic>W<sub>out</sub></italic> depending on whether individuals <italic>i</italic> and <italic>j</italic> are selfed or outcrossed). The numerator and first term of the denominator correspond to compatible self pollen of individual <italic>i</italic>, the second term of the denominator corresponds to compatible pollen of other individuals from the same deme and the third term of the denominator corresponds to compatible pollen of individuals from other demes. The outcrossing rate of an individual <italic>i</italic> is thus 1 – <italic>a<sub>i</sub></italic>.</p></sec><sec id="S6"><title>Verification of the simulations</title><p id="P16">We first verified the validity of our simulation program by comparing its outcomes with previous results from <xref ref-type="bibr" rid="R16">Gervais et al. (2011)</xref> and <xref ref-type="bibr" rid="R34">Uyenoyama et al. (2001)</xref> for the 2-steps mutation model in a panmictic population, and from <xref ref-type="bibr" rid="R30">Schierup (1998)</xref> for the 1-step mutation model in a subdivided population with the same parameter values. We recovered results similar to <xref ref-type="bibr" rid="R16">Gervais et al. (2011)</xref> and <xref ref-type="bibr" rid="R34">Uyenoyama et al. (2001</xref>) (<xref ref-type="supplementary-material" rid="SD1">Figure S2</xref> and <xref ref-type="supplementary-material" rid="SD1">Figure S3</xref>) when comparing (i) the range of parameters values where allelic diversification occurrs in a panmictic population of size <italic>N</italic> = 5000; (ii) the probability of diversification in 100 replicated runs; and (iii) the dynamics of SI and SC haplotypes. We also recovered results similar to <xref ref-type="bibr" rid="R30">Schierup (1998)</xref> with our 1-step mutation model when comparing the average number of haplotypes at the scale of the whole metapopulation or of a single deme (&lt; 3% differences, <xref ref-type="supplementary-material" rid="SD1">Figure S4</xref>), for identical parameter values and the same estimation method.</p></sec><sec id="S7"><title>Diversification probability</title><p id="P17">We first studied how dispersal affects the probability of diversification. Simulations were repeated a hundred times for each parameter set (inbreeding depression <italic>δ</italic>, self-pollination rate <italic>α</italic>, pollen dispersal rate <italic>d<sub>p</sub></italic>, mutation rate <italic>μ</italic><sub>2</sub>, number of demes <italic>p</italic> and size of the demes <italic>N</italic>). Simulations were started with <italic>n</italic> = 5 functional <italic>S</italic>-alleles and no self-compatible haplotypes. The number of possible haplotypes was set to <italic>k</italic> = 20. Simulations were run until one of the three following events occurred (note that since haplotypes could appear by mutation and be lost by drift when rare, we arbitrarily took into account only haplotypes with a frequency higher than 0.01): i) <italic>loss of SI</italic>: when SC mutant haplotypes had invaded the population and all <italic>S</italic>-haplotypes were lost; ii) <italic>diversification</italic>: when the number of <italic>S</italic>-haplotypes reached <italic>n</italic> + 1 = 6 and the frequency of SC haplotypes was lower than 0.1; iii) <italic>undecided</italic>: When none of the two previously described events happened before 5.10<sup>5</sup> generations. We estimated the probability of diversification by the number of runs where the event <italic>diversification</italic> occurred among the one hundred runs performed for a given parameter set.</p></sec><sec id="S8"><title>Number of <italic>S</italic>-haplotypes at stationary state</title><p id="P18">We then studied the effect of population structure on the number of <italic>S</italic>-haplotypes maintained at equilibrium in the metapopulation. Because we wanted to disentangle the effect of population structure on the number of <italic>S</italic>-haplotypes maintained at steady state from its effect on the probability of diversification, we ran simulations using values of <italic>d<sub>p</sub></italic> and <italic>μ</italic><sub>2</sub> under which the results above indicated that <italic>diversification</italic> occurred with probability ≥ 0.5 (<xref ref-type="supplementary-material" rid="SD1">Fig. S5</xref>). Otherwise the number of <italic>S</italic>-haplotypes at steady state would mostly reflect the probability of diversification. For the same reason we also discarded simulation runs where SI was lost or no diversification had occurred. Simulations were run as described in the previous section one hundred times for a given parameter set, with the exception that we let the metapopulation evolve for an arbitrarily large number of generations (10<sup>6</sup>) instead of stopping it when a diversification occurred. The average number of <italic>S</italic>-haplotypes at steady state <inline-formula><mml:math id="M2"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> was estimated over all replicates for a given parameter set by calculating the number of <italic>S</italic>-haplotypes with a frequency &gt; 0.01 during the last 50,000 generations.</p></sec><sec id="S9"><title>Interaction between the genetic architecture and population structure</title><p id="P19">In order to evaluate the effect of the genetic architecture of SI on diversification in a structured population, we compared the average number of <italic>S</italic>-haplotypes at steady state under the 1- <italic>vs</italic>. 2-steps mutational models. For this comparison to be meaningful, the number of <italic>S</italic>-haplotypes generated at equilibrium in a non-structured population with the same mutation rate must be the same in both models. In the 1-step mutation model, <italic>μ</italic><sub>1</sub> is the rate at which new <italic>S</italic>-haplotypes. In the 2-steps mutation model, this rate is not straightforward since it depends on the mutation rate of the pistil and pollen genes <italic>μ</italic><sub>2</sub> but also on the frequency of SC mutants that are the substrate for the compensatory mutations (<xref ref-type="bibr" rid="R16">Gervais et al., 2011</xref>). We defined an <italic>effective mutation rate</italic> as the value <italic>μ</italic><sub>1</sub> such that the average number of <italic>S</italic>-haplotypes is similar in the 1- <italic>vs</italic>. 2-steps mutation model (<inline-formula><mml:math id="M3"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mo>≈</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> <italic>i.e</italic>. the value of <italic>μ</italic><sub>1</sub> that gave the closest value of <inline-formula><mml:math id="M4"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> from <inline-formula><mml:math id="M5"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula>) in a non-subdivided population. We then ran simulations under both mutational models for the same parameter sets, including the effective mutation rate, for different levels of population structure. Comparing the number of <italic>S</italic>-haplotypes at steady state under both mutational models allowed us to isolate the specific effect of the interaction between population structure and genetic architecture.</p></sec><sec id="S10"><title>Scenarios of fitness valleys crossing in structured populations</title><p id="P20">Population structure expands the number of scenarios by which new <italic>S</italic>-alleles can be formed, according to whether those haplotypes arose in the same or different demes and whether the intermediate SC haplotype was maintained along with other SI haplotypes in the different demes. We identified five different possible scenarios (summarized in <xref ref-type="fig" rid="F2">Figure 2</xref>): <list list-type="order" id="L1"><list-item><p id="P21"><italic>Local diversification</italic> — The two mutations occurred in the same deme and the ancestral haplotype was not lost from this deme. Under this scenario, the number of <italic>S</italic>-haplotypes increases at the deme scale, and consequently also at the metapopulation scale.</p></list-item><list-item><p id="P22"><italic>Local replacement</italic> — The two mutations occurred in the same deme but the ancestral haplotype was lost from this deme. Under this scenario, the number of <italic>S</italic>-haplotypes does not change at the deme scale, but it increases at the metapopulation scale (provided that the ancestral haplotype is present in at least one other deme).</p></list-item><list-item><p id="P23"><italic>Allodiversification</italic> — The two mutations occurred in different demes (i.e. at least one dispersal event of the intermediate SC haplotype occurred before the compensatory mutation) and the ancestral haplotype was conserved in the deme where the compensatory mutation occurred. Under this scenario, the number of <italic>S</italic>-haplotypes increases at the deme scale, and consequently also at the metapopulation scale.</p></list-item><list-item><p id="P24"><italic>Alloreplacement</italic> — The two mutations occurred in different demes (i.e. at least one dispersal event of the intermediate SC haplotype occurred before the compensatory mutation) but the ancestral haplotype was lost from the deme where the compensatory mutation occurred. Under this scenario, the number of <italic>S</italic>-haplotypes does not change at the deme scale, but it increases at the metapopulation scale.</p></list-item><list-item><p id="P25"><italic>Global replacement</italic> — The two mutations occurred in different demes but the ancestral haplotype was lost from the whole metapopulation. Under this scenario, the number of <italic>S</italic>-haplotypes does not change neither at the deme scale nor at the metapopulation scale.</p></list-item></list>
</p><p id="P26">The first four scenarios lead to a net global diversification (an increase in the number of <italic>S</italic>-haplotypes at the global scale; <xref ref-type="fig" rid="F2">Fig. 2A</xref>, <xref ref-type="fig" rid="F2">2B</xref>, <xref ref-type="fig" rid="F2">2C</xref> and <xref ref-type="fig" rid="F2">2D</xref>) but not the <italic>Global replacement</italic> scenario where the new <italic>S</italic>-haplotype replaces its ancestor in the whole metapopulation (<xref ref-type="fig" rid="F2">Fig. 2E</xref>).</p><p id="P27">To evaluate the relative frequency of these five mutually exclusive scenarios in the dynamics of allelic diversification in a metapopulation we recorded the fate of every new SC haplotype during 1,000,000 generations in the 2-steps mutation model. We recorded the demes where the initial and the compensatory mutation occurred and the frequency of the ancestral <italic>S</italic>-haplotype in each deme when the compensatory mutation occurred.</p></sec></sec><sec id="S11" sec-type="results"><title>Results</title><p id="P28">In this study we asked three main questions: 1) does population structure affect the probability of diversification? 2) how does population structure affect the number of <italic>S</italic>-haplotypes relative to an isolated population, and if so, 3) what is the role of the 2-genes genetic architecture in determining these effects?</p><sec id="S12"><title>Population structure decreases the overall probability of <italic>S</italic>-haplotype diversification</title><p id="P29">We first ran a hundred replicates of simulation runs for varying parameter sets under a 2-steps mutational model, starting with an initial number of <italic>n</italic> = 5 <italic>S</italic>-haplotypes. Decreasing the pollen dispersal rate <italic>d<sub>p</sub></italic> and hence increasing population subdivision decreased the parameter regions where diversification was possible, and decreased the overall probability of diversification (<xref ref-type="fig" rid="F3">Fig. 3</xref>). For instance, for <italic>μ</italic> = 5 × 10<sup>–6</sup>, the parameter region of diversification was halved between <italic>d<sub>p</sub></italic> = 0.8 and <italic>d<sub>p</sub></italic> = 10<sup>–5</sup>. Increasing the mutation rate <italic>μ</italic>, expanded the parameter region of diversification (because more SC haplotypes were generated). Increasing the mutation rate to <italic>μ</italic> = 5 × 10<sup>–3</sup>, the effect of subdivision was much more subtle since the parameter region of diversification decreased only by ≈ 17% between <italic>d<sub>p</sub></italic> = 0.8 and <italic>d<sub>p</sub></italic> = 10<sup>–5</sup>. For the lowest value of the mutation rate that we explored (<italic>μ</italic> = 5 × 10<sup>–7</sup>), increasing the pollen dispersal rate first expanded the parameter region allowing diversification and then shrunk it. This non-monotonous effect of population structure could be an artifact of the cut-off number of generations after which we determined the state of the population, as the mutation-selection-drift equilibrium takes longer to be reached for low mutation rates. In most cases, the differences between the less structured population (<italic>d<sub>p</sub></italic> = 0.8) and the most structured population (<italic>d<sub>p</sub></italic> = 10<sup>–8</sup>) in the size of the parameter range allowing diversification were quantitatively similar to the differences between large and small non-structured populations (<italic>N</italic> = 5000 <italic>vs. N</italic> = 1000; <xref ref-type="fig" rid="F3">Fig. 3</xref>). Thus, we hypothesized that the shrinkage of the diversification region with population structure is largely due to a reduction of the overall effective population size caused by the reduced pollen dispersal between demes.</p></sec><sec id="S13"><title>Parallel local replacements in different demes promote global diversification</title><p id="P30">In order to study the effect of population structure on the number of <italic>S</italic>-haplotypes maintained in the metapopulation, we explored parameter values where the diversification frequency was higher than 50% for three values of the mutation rate <italic>μ</italic> and four values of the pollen dispersal rate <italic>d<sub>p</sub></italic>. (<xref ref-type="supplementary-material" rid="SD1">Fig. S5</xref>). We found that the average number of <italic>S</italic>-haplotypes at the metapopulation level at steady state <inline-formula><mml:math id="M6"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> always increased with decreasing pollen migration rate <italic>d<sub>p</sub></italic> (<xref ref-type="fig" rid="F4">Fig. 4</xref> and <xref ref-type="supplementary-material" rid="SD1">Fig. S6</xref>). The magnitude of the increase ranged from 5% to 92% depending on the combination of parameters. The effect was especially marked for very low dispersal rates (<italic>d<sub>p</sub></italic> = 10<sup>–8</sup>) and was more subtle for higher dispersal rates (<italic>d<sub>p</sub></italic> = 10<sup>–2</sup> and <italic>d<sub>p</sub></italic> = 10<sup>–5</sup>). Our results thus suggest that population subdivision favors the maintenance of a higher <italic>S</italic>-haplotype diversity, but mostly in strongly structured metapopulations.</p><p id="P31">We then aimed at describing how the two successive mutations that are necessary for the formation of new haplotypes occurred. We recorded whether the second (compensatory) mutation appears in the same or in a different deme than the ancestral <italic>S</italic>-haplotype, and whether the ancestral <italic>S</italic>-haplotype was lost at the local (deme) or the global (metapopulation) scale (<xref ref-type="fig" rid="F5">Fig. 5</xref>). The relative importance of the different fitness valley crossing scenarios differed sharply between largely unstructured (<italic>d<sub>p</sub></italic> = 0.8) and structured populations (<italic>d<sub>p</sub></italic> = 10<sup>–5</sup> and 10<sup>–8</sup>) (<xref ref-type="fig" rid="F5">Fig. 5</xref>). In unstructured populations (<italic>d<sub>p</sub></italic> = 0.8), when the self-pollination rate was low (α ≤ 0.6), the emergence of new <italic>S</italic>-haplotypes was most of the time accompanied with global loss of the ancestral <italic>S</italic>-haplotype, with successive mutations occurring in different demes (global replacement). With higher self-pollination rates in unstructured populations, global replacement became as frequent as allodiversification (<italic>i.e</italic>. the scenario in which the two mutations arise in different demes but the ancestral <italic>S</italic>-haplotype is conserved). This is due to the fact that SC haplotypes can more easily exclude their ancestral haplotype when they are still able to frequently outcross. The emergence of new <italic>S</italic>-haplotypes by succession of the two mutations in the same deme (either local replacement or local diversification) accounted for a little less that 25% of the formations of new <italic>S</italic>-haplotypes for all parameter values explored, <italic>i.e</italic>. in 75% of the cases, the first and second mutations occurred in different demes. In highly structured populations, in contrast, new <italic>S</italic>-haplotypes arose almost exclusively through within-deme events (local replacement and local diversification), and global replacements were rare. Our results thus show that population structure increases global <italic>S</italic>-haplotype diversity both because diversification and replacement take place in parallel in different demes, and because the loss of ancestral <italic>S</italic>-haplotypes at the scale of the metapopulation also becomes more rare.</p></sec><sec id="S14"><title>Interaction between population subdivision and genetic architecture increases <italic>S</italic>-haplotype diversity</title><p id="P32">Our last goal was to check whether the genetic architecture underlying SI could change the effect of population structure on <italic>S</italic>-haplotype diversity. To achieve this, we compared the average <italic>S</italic>-haplotype diversity in structured populations under the 1- <italic>vs</italic>. 2-steps mutational models. We determined the (effective) mutation rate of the 1-step mutational model under which the average number of <italic>S</italic>-haplotypes best approximated that under the 2-steps mutational model <inline-formula><mml:math id="M7"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mo>≈</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> in an unstructured population. For all parameter sets we studied, we found that the 2-steps mutational model was more sensitive to population structure, consistently producing new <italic>S</italic>-haplotypes at a higher rate than the 1-step mutational model (<inline-formula><mml:math id="M8"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo>/</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mo>≥</mml:mo></mml:mrow></mml:math></inline-formula> in <xref ref-type="fig" rid="F6">Fig. 6</xref>). The contrast between the two mutational models was higher when the dispersal rate decreased, resulting in a higher number of <italic>S</italic>-haplotypes under the 2-steps model than under the 1-step model. The number of <italic>S</italic>-haplotypes can be twice higher under the 2-steps than under the 1-step mutational model, even though our simulations were calibrated so that the two mutation models behaved identically in unstructured populations. Our results thus show that in structured populations, a more complex genetic architecture underlying SI can favor the emergence of <italic>S</italic>-haplotype diversity even when controlling for differences in the effective mutation rates.</p></sec></sec><sec id="S15" sec-type="discussion"><title>Discussion</title><sec id="S16"><title>Population structure decreases the conditions under which diversification occurs, yet increases the number of <italic>S</italic>-haplotypes maintained</title><p id="P33">Our results show that population structure monotonically increases the <italic>S</italic>-haplotype diversity at the metapopulation level when diversification was possible, although it also decreases the probability of <italic>S</italic>-haplotype diversification overall. It has been shown, in a 1-step mutation model, that the <italic>S</italic>-allele diversity at the metapopulation level varies non-monotonically with subdivision (<xref ref-type="bibr" rid="R30">Schierup, 1998</xref>; <xref ref-type="bibr" rid="R27">Muirhead, 2001</xref>). Indeed, subdivision increases the loss of local <italic>S</italic>-alleles by drift and this loss is compensated by the differentiation of haplotypes among demes only at low migration rates (of the order of the mutation rate) because balancing selection tends to homogenize <italic>S</italic>-allele diversity among demes. In the 2-steps mutation model, our results show that limited dispersal enhances global diversity. While the same phenomena at the local scale also apply, this genetic architecture modifies the interactions between the underlying mechanisms. Indeed, even after controlling for different effective mutations rates under the 1- <italic>vs</italic>. 2-steps mutation models, <italic>S</italic>-haplotype diversity was always higher under the 2-steps than the 1-step mutation model (<xref ref-type="fig" rid="F6">Fig. 6</xref>). This suggests that crossing fitness valleys through partial self-fertilization, as implied by the 2-steps model, modifies the interactions between selection and dispersal, ultimately affecting the diversity of <italic>S</italic>-haplotypes.</p><p id="P34">Two mechanisms can explain why population structure increases the <italic>S</italic>-haplotype diversity. First, as shown by <xref ref-type="bibr" rid="R16">Gervais et al. (2011)</xref>, the diversification rate is higher when the number of haplotypes is low. Since the relative fitness of SC haplotypes (compared to <italic>S</italic>-haplotypes) is higher when the number of <italic>S</italic>-haplotypes is low, their expected frequency is also higher, which makes the appearance of a compensatory mutation more probable. Population structure thus enhances <italic>S</italic>-haplotype diversity because locally the number of <italic>S</italic>-haplotypes is decreased, causing diversification to be faster at the local scale. This is supported by our observations that the occurrence of local diversification events increased with decreasing dispersal. Second, the relative importance of scenarios by which fitness valleys were crossed varies with population structure. In a non-structured population, new <italic>S</italic>-haplotypes emerge either by a replacement or a diversification (<xref ref-type="bibr" rid="R16">Gervais et al., 2011</xref>). In a structured population, global diversification also comes from events of local replacement. As replacements taking place in different demes likely affects different <italic>S</italic>-haplotypes, different <italic>S</italic>-haplotypes will be lost and replaced locally. Replacement occurring in different demes thus increases <italic>S</italic>-haplotype diversity at the global scale. These two mechanisms probably compensate for the homogenization of <italic>S</italic>-haplotype diversity among demes caused by balancing selection, explaining why the number of <italic>S</italic>-haplotypes increases monotonically with subdivision rather than non-monotonically as in the 1-step mutation model (<xref ref-type="bibr" rid="R30">Schierup, 1998</xref>; <xref ref-type="bibr" rid="R27">Muirhead, 2001</xref>).</p><p id="P35">Overall, can limited dispersal help fill the gap between the observed and expected <italic>S</italic>-haplotype diversity? While we do see an increase in the number of <italic>S</italic>-haplotypes caused by population structure, even for very small dispersal rates, the increase is quantitatively moderate, and still far from explaining the very large <italic>S</italic>-haplotype diversity observed in natural populations (from a few dozens to &gt;100 haplotypes, <xref ref-type="bibr" rid="R24">Lawrence 2000</xref>). An obvious potential caveat is that the number of <italic>S</italic>-haplotypes that can be obtained in our model is limited by the assumed mutation process. Indeed, for compensatory mutations to emerge, one has to set a maximum number of alleles at each locus (our <italic>k</italic> parameter), imposing a maximum number of <italic>S</italic>-haplotypes. <xref ref-type="bibr" rid="R16">Gervais et al. (2011)</xref> showed that decreasing <italic>k</italic> increases the steady-state number of <italic>S</italic>-haplotypes <inline-formula><mml:math id="M9"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> because it increases the probability of compensatory mutation restoring SI in an SC haplotype (<xref ref-type="supplementary-material" rid="SD1">Fig. S3</xref>). Yet, in our simulations, the steady state number of <italic>S</italic>-haplotypes is generally much lower than the theoretical maximum (<xref ref-type="fig" rid="F4">Fig. 4</xref>), suggesting that crossing fitness valleys is more affected by population structure and selective mechanisms than the mutational process.</p><p id="P36">Since population isolation tends to enhance the local diversification dynamics, the large diversity in natural populations might be the result of the complex demographic history of SI species, where populations have several times fragmented and merged, expanded and shrunk, lost and gained pollinators, or exchanged <italic>S</italic>-haplotypes with closely related species. It may also be that other mechanisms, not taken into account in the present model, contribute to the rise of new <italic>S</italic>-haplotypes in nature. For example, <xref ref-type="bibr" rid="R28">Sakai (2016)</xref> proposed that <italic>S</italic>-haplotypes can have been generated from SC populations by progressive optimization of the self-recognition capacity between <italic>S</italic>-haplotypes that initially have incomplete recognition and rejection. He found that this model can generate up to 40-50 haplotypes in an unstructured SC population within a few hundred generations, suggesting that the large <italic>S</italic>-haplotype diversity is the relic of the emergence of SI. How population structure would affect <italic>S</italic>-haplotype diversity in this model is an open question.</p></sec><sec id="S17"><title>Fitness valley crossing in structured populations under balancing selection</title><p id="P37">The crossing of fitness valleys has been studied by population genetics models under directional selection, where the fitness landscape is static as it results from fixed parameters. Balancing selection makes the fitness landscape variable because its shape depends on the frequency of the different haplotypes. Fitness valley crossings under directional selection can occur through two mechanisms (<xref ref-type="bibr" rid="R37">Weissman et al., 2009</xref>): by stochastic tunnelling, where intermediate deleterious genotypes segregate at low frequency because of recurrent mutations, or by sequential fixation, where the intermediate genotype first gets fixed and then the advantageous genotype arises by mutation and goes to fixation. Population structure can facilitate the crossing of fitness valleys under directional selection, a phenomenon interpreted as resulting from “competitive assortment” (<xref ref-type="bibr" rid="R3">Bitbol and Schwab, 2014</xref>; <xref ref-type="bibr" rid="R21">Komarova et al., 2014</xref>; <xref ref-type="bibr" rid="R10">Cooper and Kerr, 2016</xref>; <xref ref-type="bibr" rid="R26">McLaren, 2016</xref>). As dispersal is limited and competition between genotypes occurs locally, local kinship decreases the relative disadvantage of intermediate deleterious genotypes relatively to their wild-type counterparts. The frequency of intermediate genotypes is thus higher, they can even possibly get fixed locally, which facilitates stochastic tunnelling and sequential fixation.</p><p id="P38">In our analysis, the temporary segregation of SC intermediate haplotypes in local demes due to limited dispersal can be interpreted as competitive assortment and may thus facilitate <italic>S</italic>-haplotype diversification through stochastic tunnelling. Diversification is expected to be proportional to the residence time of SC intermediate haplotypes within demes, because the longer the residence time, the higher the probability that a compensatory mutation will occur. The residence time of SC intermediate haplotypes depends on selection acting on SC intermediate haplotypes (depending on the relative importance of inbreeding depression and mate availability). Competitive assortment mitigates the effect of selection against SC intermediate haplotypes because the mate availability advantage increases when the local kinship is higher (a higher kinship means a lower number of <italic>S</italic>-haplotypes). In contrast, local sequential fixation (sequential fixation in a single deme) is unlikely to be common. Indeed, the coexistence of a deme where a SC variant is fixed along with other demes where SI is conserved is never observed in a finite islands population (see also <xref ref-type="bibr" rid="R7">Brom et al., 2020</xref>). This is because, neglecting stochastic fixation, if the conditions are met for a SC haplotype to fix in one deme, SC haplotypes will also tend to get fixed in all other demes of the metapopulation. Overall, fitness valley crossing in the case of <italic>S</italic>-haplotypes diversification in a subdivided population is mostly due to stochastic tunnelling rather than sequential fixation.</p><p id="P39">A series of models (<xref ref-type="bibr" rid="R4">Bod’ova et al., 2018</xref>; <xref ref-type="bibr" rid="R19">Harkness et al., 2019</xref>; <xref ref-type="bibr" rid="R18">Harkness and Brandvain, 2021</xref>) have focused on a deeply rooted SI system in Angiosperms based on non-self recognition of the pollen (<xref ref-type="bibr" rid="R14">Fujii et al., 2016</xref>). The mutational pathway underlying the emergence of new <italic>S</italic>-haplotypes in such systems is different from the one we supposed here. <xref ref-type="bibr" rid="R4">Bod’ova et al. (2018)</xref> found that in such a system new <italic>S</italic>-haplotypes can emerge through a variety of pathways, in particular frequently by a SC intermediate haplotype (<italic>i.e</italic>. a fitness valley crossing). The SC intermediate pathway becomes more likely compared to other pathways when the number of specificities increases and when the mutation rate decreases. How population structure affects diversity in non-self recognition SI systems is another interesting open question.</p></sec><sec id="S18"><title>Relevance to the study of natural populations</title><p id="P40">Overall, our model suggests that the residence time of SC intermediate haplotypes is essential for <italic>S</italic>-haplotype diversification. We can speculate that new <italic>S</italic>-haplotypes are most likely to occur in small isolated demes, or in populations at the margins of species range where SI is most frequently lost <italic>e.g</italic>. <italic>Arabidopsis lyrata</italic> (<xref ref-type="bibr" rid="R17">Griffin and Willi, 2014</xref>). Observations in such populations are now needed to test the models’ predictions.</p><p id="P41">It is not yet totally understood why some species have lost SI while others have not, even among sister species. It is possible that different demographic histories, including histories of habitat fragmentation and pollinators loss may lead to these different outcomes. Indeed, <xref ref-type="bibr" rid="R7">Brom et al. (2020)</xref> predicted that decreasing dispersal rate in a subdivided population should facilitate the loss of SI because the local effective number of <italic>S</italic>-haplotypes is decreased. <xref ref-type="bibr" rid="R12">Encinas-Viso et al. (2020)</xref> further showed that the loss of SI can also occur during range expansion in the range margins and extend to the core population under certain conditions. However, here, we showed that population subdivision makes <italic>S</italic>-haplotype diversification less likely yet faster when it occurs. Hence, we argue that the evolutionary dynamics of a SI species during range expansion, or which recently suffered a fragmentation or pollinators loss is bistable. Either SI will be lost in the short run, or SI will diversify again rapidly. In a nutshell, the loss of SI and SI diversification can be viewed as conflicting processes, and the evolutionary trajectory followed by a species is the result of the race between both processes. A better understanding of how demographic processes and genetic mechanisms affect the balance between SI diversification and SI loss could help predict whether SI loss or SI rescue is the most likely scenario after range expansion, fragmentation, population bottleneck, or the loss of a pollinator.</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary Figures</label><media xlink:href="EMS147796-supplement-Supplementary_Figures.pdf" mimetype="application" mime-subtype="pdf" id="d25aAdEbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S19"><title>Acknowledgements</title><p>This work was funded by the European Research Council (NOVEL project, grant #648321). The authors also thank the Région Hauts-de-France, the Ministere de l’Enseignement Superieur et de la Recherche (CPER Climibio), and the European Fund for Regional Economic Development for their financial support.</p></ack><ref-list><ref id="R1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barrett</surname><given-names>SC</given-names></name></person-group><article-title>The evolution of plant sexual diversity</article-title><source>Nature Reviews Genetics</source><year>2002</year><volume>3</volume><issue>4</issue><fpage>274</fpage><lpage>284</lpage></element-citation></ref><ref id="R2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Billiard</surname><given-names>S</given-names></name><name><surname>Lopez-Villavicencio</surname><given-names>M</given-names></name><name><surname>Devier</surname><given-names>B</given-names></name><name><surname>Hood</surname><given-names>ME</given-names></name><name><surname>Fairhead</surname><given-names>C</given-names></name><name><surname>Giraud</surname><given-names>T</given-names></name></person-group><article-title>Having sex, yes, but with whom? Inferences from fungi on the evolution of anisogamy and mating types</article-title><source>Biological Reviews</source><year>2011</year><volume>86</volume><issue>2</issue><fpage>421</fpage><lpage>442</lpage></element-citation></ref><ref id="R3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bitbol</surname><given-names>A-F</given-names></name><name><surname>Schwab</surname><given-names>DJ</given-names></name></person-group><article-title>Quantifying the role of population subdivision in evolution on rugged fitness landscapes</article-title><source>PLoS computational biology</source><year>2014</year><volume>10</volume><issue>8</issue><elocation-id>e1003778</elocation-id></element-citation></ref><ref id="R4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bod’ova</surname><given-names>K</given-names></name><name><surname>Priklopil</surname><given-names>T</given-names></name><name><surname>Field</surname><given-names>DL</given-names></name><name><surname>Barton</surname><given-names>NH</given-names></name><name><surname>Pickup</surname><given-names>M</given-names></name></person-group><article-title>Evolutionary pathways for the generation of new self-incompatibility haplotypes in a non-self recognition system</article-title><source>Genetics</source><year>2018</year><volume>209</volume><issue>3</issue><fpage>861</fpage><lpage>883</lpage></element-citation></ref><ref id="R5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bovier</surname><given-names>A</given-names></name><name><surname>Coquille</surname><given-names>L</given-names></name><name><surname>Smadi</surname><given-names>C</given-names></name></person-group><article-title>Crossing a fitness valley as a metastable transition in a stochastic population model</article-title><source>Ann Appl Probab</source><year>2019</year><volume>29</volume><issue>6</issue><fpage>3541</fpage><lpage>3589</lpage></element-citation></ref><ref id="R6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bowen</surname><given-names>DG</given-names></name><name><surname>Walker</surname><given-names>CM</given-names></name></person-group><article-title>Mutational escape from CD8+T cell immunity: HCV evolution, from chimpanzees to man</article-title><source>The Journal of Experimental Medicine</source><year>2005</year><volume>201</volume><issue>11</issue><fpage>1709</fpage><lpage>1714</lpage></element-citation></ref><ref id="R7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brom</surname><given-names>T</given-names></name><name><surname>Castric</surname><given-names>V</given-names></name><name><surname>Billiard</surname><given-names>S</given-names></name></person-group><article-title>Breakdown of gametophytic self-incompatibility in subdivided populations</article-title><source>Evolution</source><year>2020</year><volume>74</volume><fpage>270</fpage><lpage>282</lpage></element-citation></ref><ref id="R8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Burch</surname><given-names>CL</given-names></name><name><surname>Chao</surname><given-names>L</given-names></name></person-group><article-title>Evolvability of an RNA virus is determined by its mutational neighbourhood</article-title><source>Nature</source><year>2000</year><volume>406</volume><issue>6796</issue><fpage>625</fpage><lpage>628</lpage></element-citation></ref><ref id="R9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Castric</surname><given-names>V</given-names></name><name><surname>Vekemans</surname><given-names>X</given-names></name></person-group><article-title>Plant self-incompatibility in natural populations: a critical assessment of recent theoretical and empirical advances</article-title><source>Molecular Ecology</source><year>2004</year><volume>13</volume><issue>10</issue><fpage>2873</fpage><lpage>2889</lpage></element-citation></ref><ref id="R10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cooper</surname><given-names>JD</given-names></name><name><surname>Kerr</surname><given-names>B</given-names></name></person-group><article-title>Evolution at ‘sutures’ and ‘centers’: recombination can aid adaptation of spatially structured populations on rugged fitness landscapes</article-title><source>PLoS computational biology</source><year>2016</year><volume>12</volume><issue>12</issue><elocation-id>e1005247</elocation-id></element-citation></ref><ref id="R11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>de Visser</surname><given-names>JAGM</given-names></name><name><surname>Krug</surname><given-names>J</given-names></name></person-group><article-title>Empirical fitness landscapes and the predictability of evolution</article-title><source>Nature Reviews Genetics</source><year>2014</year><volume>15</volume><issue>7</issue><fpage>480</fpage><lpage>490</lpage></element-citation></ref><ref id="R12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Encinas-Viso</surname><given-names>F</given-names></name><name><surname>Young</surname><given-names>A</given-names></name><name><surname>Pannell</surname><given-names>J</given-names></name></person-group><article-title>The loss of self-incompatibility in a range expansion</article-title><source>Journal of Evolutionary Biology</source><year>2020</year><volume>33</volume><issue>9</issue><fpage>1235</fpage><lpage>1244</lpage></element-citation></ref><ref id="R13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fernandez</surname><given-names>CS</given-names></name><name><surname>Stratov</surname><given-names>I</given-names></name><name><surname>Rose</surname><given-names>RD</given-names></name><name><surname>Walsh</surname><given-names>K</given-names></name><name><surname>Dale</surname><given-names>CJ</given-names></name><name><surname>Smith</surname><given-names>MZ</given-names></name><name><surname>Agy</surname><given-names>MB</given-names></name><name><surname>Hu</surname><given-names>S-l</given-names></name><name><surname>Krebs</surname><given-names>K</given-names></name><name><surname>Watkins</surname><given-names>DI</given-names></name><name><surname>Connor</surname><given-names>DHO</given-names></name><etal/></person-group><article-title>Rapid viral escape at an immunodominant simian-human Immunodeficiency virus cytotoxic T-lymphocyte epitope exacts a dramatic fitness cost</article-title><source>Journal of Virology</source><year>2005</year><volume>79</volume><issue>9</issue><fpage>5721</fpage><lpage>5731</lpage></element-citation></ref><ref id="R14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fujii</surname><given-names>S</given-names></name><name><surname>Kubo</surname><given-names>KI</given-names></name><name><surname>Takayama</surname><given-names>S</given-names></name></person-group><article-title>Non-self- and self-recognition models in plant self-incompatibility</article-title><source>Nature Plants</source><year>2016</year><volume>2</volume><issue>9</issue><elocation-id>16130</elocation-id></element-citation></ref><ref id="R15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gervais</surname><given-names>C</given-names></name><name><surname>Awad</surname><given-names>DA</given-names></name><name><surname>Roze</surname><given-names>D</given-names></name><name><surname>Castric</surname><given-names>V</given-names></name><name><surname>Billiard</surname><given-names>S</given-names></name></person-group><article-title>Genetic architecture of inbreeding depression and the maintenance of ga-metophytic self-incompatibility</article-title><source>Evolution</source><year>2014</year><volume>68</volume><issue>11</issue><fpage>3317</fpage><lpage>3324</lpage></element-citation></ref><ref id="R16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gervais</surname><given-names>C</given-names></name><name><surname>Castric</surname><given-names>V</given-names></name><name><surname>Ressayre</surname><given-names>A</given-names></name><name><surname>Billiard</surname><given-names>S</given-names></name></person-group><article-title>Origin and diversification dynamics of self-incompatibility haplotypes</article-title><source>Genetics</source><year>2011</year><volume>188</volume><issue>3</issue><fpage>625</fpage><lpage>636</lpage></element-citation></ref><ref id="R17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Griffin</surname><given-names>PC</given-names></name><name><surname>Willi</surname><given-names>Y</given-names></name></person-group><article-title>Evolutionary shifts to self-fertilisation restricted to geographic range margins in North American Arabidopsis lyrata</article-title><source>Ecology Letters</source><year>2014</year><volume>17</volume><issue>4</issue><fpage>484</fpage><lpage>490</lpage></element-citation></ref><ref id="R18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harkness</surname><given-names>A</given-names></name><name><surname>Brandvain</surname><given-names>Y</given-names></name></person-group><article-title>Non-self recognition-based self-incompatibility can alternatively promote or prevent introgression</article-title><source>New Phytologist</source><year>2021</year></element-citation></ref><ref id="R19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harkness</surname><given-names>A</given-names></name><name><surname>Goldberg</surname><given-names>EE</given-names></name><name><surname>Brandvain</surname><given-names>Y</given-names></name></person-group><article-title>Diversification or collapse of self-incompatibility haplotypes as outcomes of evolutionary rescue</article-title><source>bioRxiv</source><year>2019</year><fpage>1</fpage><lpage>37</lpage></element-citation></ref><ref id="R20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Igic</surname><given-names>B</given-names></name><name><surname>Lande</surname><given-names>R</given-names></name><name><surname>Kohn</surname><given-names>JR</given-names></name></person-group><article-title>Loss of self-incompatibility and its evolutionary consequences</article-title><source>Journal of Plant Sciences</source><year>2008</year><volume>169</volume><issue>1</issue><fpage>93</fpage><lpage>104</lpage></element-citation></ref><ref id="R21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Komarova</surname><given-names>NL</given-names></name><name><surname>Shahriyari</surname><given-names>L</given-names></name><name><surname>Wodarz</surname><given-names>D</given-names></name></person-group><article-title>Complex role of space in the crossing of fitness valleys by asexual populations</article-title><source>J R Soc Interface</source><year>2014</year><volume>11</volume><issue>95</issue><elocation-id>20140014</elocation-id></element-citation></ref><ref id="R22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Korona</surname><given-names>R</given-names></name><name><surname>Nakatsu</surname><given-names>CH</given-names></name><name><surname>Forney</surname><given-names>LJ</given-names></name><name><surname>Lenskit</surname><given-names>RE</given-names></name></person-group><article-title>Evidence for multiple adaptive peaks from populations of bacteria evolving in a structured habitat</article-title><source>Proceedings of the National Academy of Sciences</source><year>1994</year><volume>91</volume><issue>19</issue><fpage>9037</fpage><lpage>9041</lpage></element-citation></ref><ref id="R23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kvitek</surname><given-names>DJ</given-names></name><name><surname>Sherlock</surname><given-names>G</given-names></name></person-group><article-title>Reciprocal sign epistasis between frequently experimentally evolved adaptive mutations causes a rugged fitness landscape</article-title><source>PLoS Genetics</source><year>2011</year><volume>7</volume><issue>4</issue><elocation-id>e1002056</elocation-id></element-citation></ref><ref id="R24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lawrence</surname><given-names>MJ</given-names></name></person-group><article-title>Population genetics of the homomorphic self-incompatibility polymorphisms in flowering plants</article-title><source>Annals of Botany</source><year>2000</year><volume>85</volume><fpage>221</fpage><lpage>226</lpage></element-citation></ref><ref id="R25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McCubbin</surname><given-names>AG</given-names></name><name><surname>Kao</surname><given-names>T-H</given-names></name></person-group><article-title>Molecular recognition and response in pollen and pistil interactions</article-title><source>Annu Rev Cell Dev Biol</source><year>2000</year><volume>16</volume><issue>1</issue><fpage>333</fpage><lpage>364</lpage></element-citation></ref><ref id="R26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McLaren</surname><given-names>M</given-names></name></person-group><article-title>Fitness-valley crossing in subdivided asexual populations</article-title><source>bioRxiv</source><year>2016</year></element-citation></ref><ref id="R27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Muirhead</surname><given-names>CA</given-names></name></person-group><article-title>Consequences of population structure on genes under balancing selection</article-title><source>Evolution</source><year>2001</year><volume>55</volume><issue>8</issue><fpage>1532</fpage><lpage>1541</lpage></element-citation></ref><ref id="R28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sakai</surname><given-names>S</given-names></name></person-group><article-title>How have self-incompatibility haplotypes diversified? Generation of new haplotypes during the evolution of self-incompatibility from self-compatibility</article-title><source>The American Naturalist</source><year>2016</year><volume>188</volume><issue>2</issue><fpage>163</fpage><lpage>174</lpage></element-citation></ref><ref id="R29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Salverda</surname><given-names>MLM</given-names></name><name><surname>Dellus</surname><given-names>E</given-names></name><name><surname>Gorter</surname><given-names>FA</given-names></name><name><surname>Debets</surname><given-names>AJM</given-names></name><name><surname>Oost</surname><given-names>JVD</given-names></name><name><surname>Rolf</surname><given-names>F</given-names></name><name><surname>Tawfik</surname><given-names>DS</given-names></name><name><surname>Visser</surname><given-names>JAGMD</given-names></name></person-group><article-title>Initial mutations direct alternative pathways of protein evolution</article-title><source>PLoS Genetics</source><year>2011</year><volume>7</volume><issue>3</issue><elocation-id>e1001321</elocation-id></element-citation></ref><ref id="R30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schierup</surname><given-names>MH</given-names></name></person-group><article-title>The number of self-incompatibility alleles in a finite, subdivided population</article-title><source>Genetics</source><year>1998</year><volume>149</volume><issue>2</issue><fpage>1153</fpage><lpage>1162</lpage></element-citation></ref><ref id="R31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schierup</surname><given-names>MH</given-names></name><name><surname>Vekemans</surname><given-names>X</given-names></name><name><surname>Charlesworth</surname><given-names>D</given-names></name></person-group><article-title>The effect of subdivision on variation at multi-allelic loci under balancing selection</article-title><source>Genetics Researchics</source><year>2000</year><volume>76</volume><issue>1</issue><fpage>51</fpage><lpage>62</lpage></element-citation></ref><ref id="R32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shih</surname><given-names>AC-c</given-names></name><name><surname>Hsiao</surname><given-names>T-c</given-names></name><name><surname>Ho</surname><given-names>M-s</given-names></name><name><surname>Li</surname><given-names>W-h</given-names></name></person-group><article-title>Simultaneous amino acid substitutions at antigenic sites drive influenza A hemagglutinin evolution</article-title><source>Proceedings of the National Academy of Sciences</source><year>2007</year><volume>104</volume><issue>15</issue><fpage>6283</fpage><lpage>6288</lpage></element-citation></ref><ref id="R33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Uyenoyama</surname><given-names>MK</given-names></name></person-group><article-title>Genealogy-dependent variation in viability among self-incompatibility genotypes</article-title><source>Theoretical Population Biology</source><year>2003</year><volume>63</volume><issue>4</issue><fpage>281</fpage><lpage>293</lpage></element-citation></ref><ref id="R34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Uyenoyama</surname><given-names>MK</given-names></name><name><surname>Zhang</surname><given-names>Y</given-names></name><name><surname>Newbigin</surname><given-names>E</given-names></name></person-group><article-title>On the origin of self-incompatibility haplotypes: transition through self-compatible intermediates</article-title><source>Genetics</source><year>2001</year><volume>157</volume><issue>4</issue><fpage>1805</fpage><lpage>1817</lpage></element-citation></ref><ref id="R35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vos</surname><given-names>MGJD</given-names></name><name><surname>Dawid</surname><given-names>A</given-names></name><name><surname>Sunderlikova</surname><given-names>V</given-names></name><name><surname>Tans</surname><given-names>SJ</given-names></name></person-group><article-title>Breaking evolutionary constraint with a tradeoff ratchet</article-title><source>Proceedings of the National Academy of Sciences</source><year>2015</year><volume>112</volume><issue>48</issue><fpage>4906</fpage><lpage>4911</lpage></element-citation></ref><ref id="R36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weinreich</surname><given-names>DM</given-names></name><name><surname>Delaney</surname><given-names>NF</given-names></name><name><surname>DePristo</surname><given-names>MA</given-names></name><name><surname>Hartl</surname><given-names>DL</given-names></name></person-group><article-title>Darwinian evolution can follow only very few mutational paths to fitter proteins</article-title><source>Science</source><year>2006</year><volume>312</volume><issue>5770</issue><fpage>111</fpage><lpage>114</lpage></element-citation></ref><ref id="R37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weissman</surname><given-names>DB</given-names></name><name><surname>Desai</surname><given-names>MM</given-names></name><name><surname>Fisher</surname><given-names>DS</given-names></name><name><surname>Feldman</surname><given-names>MW</given-names></name></person-group><article-title>The rate at which asexual populations cross fitness valleys</article-title><source>Theoretical Population Biology</source><year>2009</year><volume>75</volume><issue>4</issue><fpage>286</fpage><lpage>300</lpage></element-citation></ref><ref id="R38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weissman</surname><given-names>DB</given-names></name><name><surname>Feldman</surname><given-names>MW</given-names></name><name><surname>Fisher</surname><given-names>DS</given-names></name></person-group><article-title>The rate of fitness-valley crossing in sexual populations</article-title><source>Genetics</source><year>2010</year><volume>186</volume><fpage>1389</fpage><lpage>1410</lpage></element-citation></ref><ref id="R39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Whitlock</surname><given-names>MC</given-names></name><name><surname>Phillips</surname><given-names>PC</given-names></name><name><surname>Moore</surname><given-names>FB</given-names></name><name><surname>Tonsor</surname><given-names>SJ</given-names></name></person-group><article-title>Multiple fitness peaks and epistasis</article-title><source>Annual Review of Ecology and Systematics</source><year>1995</year><volume>26</volume><issue>1</issue><fpage>601</fpage><lpage>629</lpage></element-citation></ref><ref id="R40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wright</surname><given-names>S</given-names></name></person-group><article-title>The role of mutation, inbreeding, crossbreeding, and selection in evolution</article-title><source>Proceedings of the Sixth International Congress on Genetics</source><year>1932</year><volume>1</volume><fpage>356</fpage><lpage>366</lpage></element-citation></ref><ref id="R41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wright</surname><given-names>S</given-names></name></person-group><article-title>The distribution of self-sterility alleles in populations</article-title><source>Genetics</source><year>1939</year><volume>24</volume><fpage>538</fpage><lpage>552</lpage></element-citation></ref><ref id="R42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wright</surname><given-names>S</given-names></name></person-group><article-title>The distribution of self-incompatibility alleles in populations</article-title><source>Evolution</source><year>1964</year><volume>18</volume><issue>4</issue><fpage>609</fpage><lpage>619</lpage></element-citation></ref><ref id="R43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yokoyama</surname><given-names>S</given-names></name><name><surname>Hetherington</surname><given-names>LE</given-names></name></person-group><article-title>The expected number of self-incompatibility alleles in finite plant populations</article-title><source>Heredity</source><year>1982</year><volume>48</volume><issue>2</issue><fpage>299</fpage><lpage>303</lpage></element-citation></ref></ref-list></back><floats-group><boxed-text id="BX1" position="float" orientation="portrait"><caption><title>Box 1</title></caption><p>The question of <italic>S</italic>-haplotype emergence is the following: how is it possible to go from <italic>n</italic> to <italic>n</italic> + 1 <italic>S</italic>-haplotypes segregating in a population, given an intermediate SC haplotype which can have a fitness lower or higher than its ancestral (<italic>S<sub>n</sub></italic>) and derived new (<italic>S</italic><sub><italic>n</italic>+1</sub>) <italic>S</italic>-haplotypes depending on the cost of inbreeding depression relative to the strength of negative frequency dependent selection (<xref ref-type="supplementary-material" rid="SD1">Fig. S1A</xref>, <xref ref-type="supplementary-material" rid="SD1">B</xref> and <xref ref-type="supplementary-material" rid="SD1">C</xref>).</p><p>The number of <italic>S</italic>- haplotypes increases when a fitness valley is crossed either because the SC intermediate haplotype has a fitness lower than both <italic>S<sub>n</sub></italic> and <italic>S</italic><sub><italic>n</italic>+1</sub> (<xref ref-type="supplementary-material" rid="SD1">Fig. S1B</xref>), or because <italic>S</italic><sub><italic>n</italic>+1</sub> has a higher fitness than <italic>S<sub>n</sub></italic> when it co-occurs with the SC intermediate haplotypes and thus <italic>S<sub>n</sub></italic> is lost (<xref ref-type="supplementary-material" rid="SD1">Fig. S1C</xref>) <xref ref-type="bibr" rid="R34">Uyenoyama et al. (2001)</xref> and <xref ref-type="bibr" rid="R16">Gervais et al. (2011)</xref>) showed that fitness valley crossing can be achieved by two mechanisms: either because the ancestral <italic>S</italic>-haplotype <italic>S<sub>n</sub></italic> and the intermediate SC haplotype can stably coexist under negative frequency dependent selection, or because haplotypes with the lowest fitness can be maintained in the population long enough because of genetic drift. Genetic drift is thus an important mechanism allowing fitness valley crossing under either directional (<xref ref-type="bibr" rid="R37">Weissman et al., 2009</xref>) or negative frequency dependent (<xref ref-type="bibr" rid="R16">Gervais et al., 2011</xref>) selection.</p></boxed-text><fig id="F1" position="float"><label>Fig. 1</label><caption><p>Mutational pathway by which new haplotypes are created in the 1-step mutation model (A) and in the 2-steps mutation model (B; <xref ref-type="bibr" rid="R34">Uyenoyama et al., 2001</xref>; <xref ref-type="bibr" rid="R16">Gervais et al., 2011</xref>). Horizontal black lines represent chromosomes carrying the <italic>S</italic>-haplotype which is composed of just one gene in the 1-step mutation model and of two genes in the 2-steps mutation model with gene <italic>A</italic> as the female determinant (blue vertical lines) and gene <italic>B</italic> as the male determinant (red vertical lines). <italic>S<sub>n</sub></italic> is the ancestral <italic>S</italic> haplotype, <italic>S</italic><sub><italic>n</italic>+1</sub> the new S haplotype, <italic>S<sub>a</sub></italic> the pistil-part mutant SC haplotype and <italic>S<sub>b</sub></italic> the pollen-part mutant SC haplotype. Incompatible specificities are represented by matching shapes and identical colours. White arrows represent mutation steps and black arrows indicate that the pollen carrying the haplotype at the base of the arrow can pollinate the pistil carrying the haplotype at the tip of the arrow. Double black arrows indicate mutual compatibility between haplotypes. Modified from <xref ref-type="bibr" rid="R34">Uyenoyama et al. (2001)</xref>.</p></caption><graphic xlink:href="EMS147796-f001"/></fig><fig id="F2" position="float"><label>Fig. 2</label><caption><p>Five different scenarios for the emergence of a new <italic>S</italic><sub><italic>n</italic>+1</sub> <italic>S</italic>-haplotype in a subdivided population. Note that only one allelic line undergoing diversification is depicted although it is segregating along with many others in the population. Three demes are depicted, with different possible S’-haplotypes (pistil gene on the left, pollen gene on the right, the lightning bolt depicts mutation; see <xref ref-type="fig" rid="F1">Figure 1</xref> for more details). Three successive steps for the emergence of <italic>S</italic><sub><italic>n</italic>+1</sub> are represented, separated by black arrows. Blue and brown fonts are used to indicate the local and global number of <italic>S</italic>-haplotypes, respectively. Scenario <bold>A</bold> (local diversification): the compensatory mutation appears in the same deme as the initial mutation and the ancestral SC haplotype is still present in that deme.Scenario <bold>B</bold> (local replacement): the compensatory mutation appears in the same deme as the initial mutation when the ancestral SC haplotype is no longer present in that deme. Scenario <bold>C</bold> (allodiversification): the compensatory mutation appears in a different deme as the initial mutation and the ancestral SC haplotype is still present in that new deme. Scenario <bold>D</bold> (alloreplacement): the compensatory mutation appears in a different deme as the initial mutation and the ancestral SC haplotype is no longer present in that new deme. Scenario <bold>E</bold> (global replacement): the compensatory mutation appears in a different deme as the initial mutation and the ancestral SC haplotype is no longer present in the whole metapopulation. Note that the global number of S-haplotypes increases only in scenarios <bold>A</bold>, <bold>B</bold>, <bold>C</bold> and <bold>D</bold>.</p></caption><graphic xlink:href="EMS147796-f002"/></fig><fig id="F3" position="float"><label>Fig. 3</label><caption><p>Diversification of <italic>S</italic>-haplotypes as a function of the mutation rate <italic>μ</italic> and the pollen dispersal rate <italic>d<sub>p</sub></italic>. The metapopulation is composed of <italic>p</italic> = 5 demes containing 1,000 individuals each, except the two leftmost columns where the population is non-structured: a single deme of size 1,000 or 5,000. Color scaling on the right refers to the percentage of simulation runs among 100 replicates, for a given parameters set, where the total number of <italic>S</italic>-haplotypes increased in the metapopulation (starting with an initial number <italic>n</italic> = 5).</p></caption><graphic xlink:href="EMS147796-f003"/></fig><fig id="F4" position="float"><label>Fig. 4</label><caption><p>Average number and 95% CI of <italic>S</italic>-haplotypes at steady state as a function of the self-pollination rate <italic>α</italic> and for different pollen dispersal rates <italic>d<sub>p</sub></italic>. An asterisk indicates a combination of parameters where diversification is too rare to be considered (inferior to 50% of diversification <italic>i.e</italic>. regions surrounded in black in <xref ref-type="supplementary-material" rid="SD1">Fig. S5</xref>). Dashed green and red line show the initial number of <italic>S</italic>-haplotypes <italic>n</italic> and the maximum number of <italic>S</italic>-haplotypes <italic>k</italic>, respectively. Parameters: <italic>μ</italic><sub>2</sub> = 5 × 10<sup>–5</sup>, <italic>N</italic> = 5000, <italic>p</italic> = 5, <italic>n</italic> = 5 and <italic>k</italic> = 20. A: <italic>δ</italic> = 0.9; B: <italic>δ</italic> = 1.</p></caption><graphic xlink:href="EMS147796-f004"/></fig><fig id="F5" position="float"><label>Fig. 5</label><caption><p>Proportion of five possible scenarios for the emergence of new S’-haplotypes in a metapopulation over 100 simulation runs (see <xref ref-type="fig" rid="F2">Fig. 2</xref>). An asterisk indicates a combination of parameters where diversification is too rare to be considered (inferior to 50% of diversification <italic>i.e</italic>. regions surrounded in black in <xref ref-type="supplementary-material" rid="SD1">Fig. S5</xref>). Parameters: <italic>μ</italic><sub>2</sub> = 5 × 10<sup>–5</sup>, <italic>N</italic> = 5000, <italic>p</italic> = 5, <italic>n</italic> = 5 and <italic>k</italic> = 20.</p></caption><graphic xlink:href="EMS147796-f005"/></fig><fig id="F6" position="float"><label>Fig. 6</label><caption><p>Ratio of the number of <italic>S</italic>-haplotypes at steady state between the 2-steps <italic>vs</italic>. 1-step mutation models <inline-formula><mml:math id="M10"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mo>/</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> for a given effective mutation rate <italic>μ</italic><sub>1</sub> (see text for details). The red dashed line represents a ratio of 1 (with a 95% CI): in other words bars higher than the red dashed line mean that the number of <italic>S</italic>-haplotypes at equilibrium is significantly higher under the 2-steps than the 1-step mutation model even though the effective mutation rate is similar. An asterisk indicates a combination of parameters where diversification is too rare to be considered (inferior to 50% of diversification <italic>i.e</italic>. regions surrounded in black in <xref ref-type="supplementary-material" rid="SD1">Fig. S5</xref>).</p></caption><graphic xlink:href="EMS147796-f006"/></fig></floats-group></article>