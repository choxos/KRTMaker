<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS141082</article-id><article-id pub-id-type="doi">10.1101/2021.12.03.471185</article-id><article-id pub-id-type="archive">PPR428583</article-id><article-version article-version-type="publisher-id">1</article-version><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Robust Single-cell Matching and Multi-modal Analysis Using Shared and Distinct Features Reveals Orchestrated Immune Responses</article-title></title-group><contrib-group><contrib contrib-type="author" equal-contrib="yes"><name><surname>Zhu</surname><given-names>Bokai</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author" equal-contrib="yes"><name><surname>Chen</surname><given-names>Shuxiao</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Bai</surname><given-names>Yunhao</given-names></name><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Chen</surname><given-names>Han</given-names></name><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Mukherjee</surname><given-names>Nilanjan</given-names></name><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Vazquez</surname><given-names>Gustavo</given-names></name><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>McIlwain</surname><given-names>David R</given-names></name><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Tzankov</surname><given-names>Alexandar</given-names></name><xref ref-type="aff" rid="A5">5</xref></contrib><contrib contrib-type="author"><name><surname>Lee</surname><given-names>Ivan T</given-names></name><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Matter</surname><given-names>Matthias S</given-names></name><xref ref-type="aff" rid="A5">5</xref></contrib><contrib contrib-type="author"><name><surname>Golstev</surname><given-names>Yury</given-names></name><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Ma</surname><given-names>Zongming</given-names></name><xref ref-type="aff" rid="A2">2</xref><xref ref-type="fn" rid="FN1">†</xref><xref ref-type="corresp" rid="CR1">✉</xref></contrib><contrib contrib-type="author"><name><surname>Nolan</surname><given-names>Garry P</given-names></name><xref ref-type="aff" rid="A3">3</xref><xref ref-type="fn" rid="FN1">†</xref><xref ref-type="corresp" rid="CR1">✉</xref></contrib><contrib contrib-type="author"><name><surname>Jiang</surname><given-names>Sizun</given-names></name><xref ref-type="aff" rid="A6">6</xref><xref ref-type="aff" rid="A7">7</xref><xref ref-type="fn" rid="FN1">†</xref><xref ref-type="corresp" rid="CR1">✉</xref></contrib></contrib-group><aff id="A1"><label>1</label>Department of Microbiology and Immunology, Stanford University, Stanford, CA, United States</aff><aff id="A2"><label>2</label>Department of Statistics and Data Science, The Wharton School, University of Pennsylvania, PA, United States</aff><aff id="A3"><label>3</label>Department of Pathology, Stanford University, Stanford, CA, United States</aff><aff id="A4"><label>4</label>Department of Chemistry, Stanford University, Stanford, CA, United States</aff><aff id="A5"><label>5</label>Pathology, Institute of Medical Genetics and Pathology, University Hospital Basel, University of Basel, Basel, Switzerland</aff><aff id="A6"><label>6</label>Center for Virology and Vaccine Research, Beth Israel Deaconess Medical Center, Boston, MA, United States</aff><aff id="A7"><label>7</label>Department of Oncologic Pathology, Dana Farber Cancer Institute, Boston, MA, United States</aff><author-notes><corresp id="CR1">Correspondence: <email>zongming@wharton.upenn.edu</email>, <email>gnolan@stanford.edu</email>, <email>sjiang3@bidmc.harvard.edu</email>
</corresp><fn id="FN1"><label>†</label><p id="P1">Senior Authors</p></fn></author-notes><pub-date pub-type="nihms-submitted"><day>07</day><month>02</month><year>2022</year></pub-date><pub-date pub-type="preprint"><day>05</day><month>12</month><year>2021</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P2">The ability to align individual cellular information from multiple experimental sources, techniques and systems is fundamental for a true systems-level understanding of biological processes. While single-cell transcriptomic studies have transformed our appreciation for the complexities and contributions of diverse cell types to disease, they can be limited in their ability to assess protein-level phenotypic information and beyond. Therefore, matching and integrating single-cell datasets which utilize robust protein measurements across multiple modalities is critical for a deeper understanding of cell states, and signaling pathways particularly within their native tissue context. Current available tools are mainly designed for single-cell transcriptomics matching and integration, and generally rely upon a large number of shared features across datasets for mutual Nearest Neighbor (mNN) matching. This approach is unsuitable when applied to single-cell proteomic datasets, due to the limited number of parameters simultaneously accessed, and lack of shared markers across these experiments. Here, we introduce a novel cell matching algorithm, Matching with pARtIal Overlap (MARIO), that takes into account both shared and distinct features, while consisting of vital filtering steps to avoid sub-optimal matching. MARIO accurately matches and integrates data from different single-cell proteomic and multi-modal methods, including spatial techniques, and has cross-species capabilities. MARIO robustly matched tissue macrophages identified from COVID-19 lung autopsies via CODEX imaging to macrophages recovered from COVID-19 bronchoalveolar lavage fluid via CITE-seq. This cross-platform integrative analysis enabled the identification of unique orchestrated immune responses within the lung of complement-expressing macrophages and their impact on the local tissue microenvironment. MARIO thus provides an analytical frame-work for unified analysis of single-cell data for a comprehensive understanding of the underlying biological system.</p></abstract><kwd-group><kwd>Multi-modal data integration</kwd><kwd>Multiplexed imaging</kwd><kwd>Single cell</kwd><kwd>Statistical matching</kwd><kwd>Spatial-omics</kwd><kwd>Proteomics</kwd></kwd-group></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P3">The rapid developments of single-cell technologies have fundamentally transformed our approaches to the investigation of complex biological systems, while potentially influencing clinical decisions. The ability to individually measure the genomic (<xref ref-type="bibr" rid="R1">1</xref>), epigenomic (<xref ref-type="bibr" rid="R2">2</xref>), transcriptomic (<xref ref-type="bibr" rid="R3">3</xref>) and proteomic (<xref ref-type="bibr" rid="R4">4</xref>) states at the single-cell level marks an exciting era in biology. Single-cell transcriptomics and targeted-proteomics are the two major approaches commonly used to delineate cell populations and infer functionality or disease states. Single-cell transcriptomics is theoretically able to assess the entire transcriptome of a target cell, with 5-10k unique gene transcripts captured on average for each cell. A key drawback of this method is the relative sparseness of the data generated, particularly for less abundant genes. On the other hand, antibody-based single-cell proteomics has gradually progressed over the years, from the initial detection of a handful of protein targets (<xref ref-type="bibr" rid="R5">5</xref>, <xref ref-type="bibr" rid="R6">6</xref>), to about 40 targets via mass cytometry (<xref ref-type="bibr" rid="R7">7</xref>), over 100 protein targets via sequencing (<xref ref-type="bibr" rid="R8">8</xref>, <xref ref-type="bibr" rid="R9">9</xref>) and most recently, more than 40 protein targets spatially resolved in their native tissue context (<xref ref-type="bibr" rid="R10">10</xref>–<xref ref-type="bibr" rid="R13">13</xref>). The targeted nature of such approaches requires a careful design, selection, validation and titration of an antibody panel for confident and robust results. Importantly, the features being captured in the biological samples are limited to the antibodies available. Although these factors may limit the number of features that can be measured using targeted single-cell proteomics at any one time, proteomics experiments capture a different spectrum of information than transcriptomics experiments, with following key advantages: first, proteins exert cellular functions, such as signaling cascades, that often define cellular identity, thus allowing a more accurate depiction of the biological state and function, including post-translational events (<xref ref-type="bibr" rid="R14">14</xref>, <xref ref-type="bibr" rid="R15">15</xref>); second, although RNA and protein expression can be correlated, RNA counts often do not faithfully represent the final protein machinery expression level in single-cells (<xref ref-type="bibr" rid="R16">16</xref>–<xref ref-type="bibr" rid="R20">20</xref>); third, due to the limitation of sequencing depth per cell, important but rare transcripts may not be captured in a cell, thus greatly hindering confident cell type annotation (<xref ref-type="bibr" rid="R21">21</xref>, <xref ref-type="bibr" rid="R22">22</xref>). In contrast, well-validated antibodies allow robust signal measurements with high dynamic ranges, thus reducing the uncertainties of measurement and chances of false negative or positive events.</p><p id="P4">Single-cell antibody-based techniques have been widely used, particularly in settings that require robust cell phenotype information or when a specific protein functional read-out is necessary. A wide range of single-cell antibody proteomic modalities have now been implemented, including methods like flow cytometry and CyTOF that utilize fluorescent or metal-tagged antibodies to probe large numbers of dissociated suspension cells in a relatively short time (500-10000 cells per second). The parameters assessed include cell surface proteins and intracellular signaling molecules, and samples from different patients or experimental perturbations can be bar-coded and run in the same batch, minimizing variability. Additional methods have recently been developed that allows analysis of proteins in their native spatial contexts (e.g., CODEX, MIBI, IMC), opening a new field of high-parameter tissue biology examination. Sequencing-based approaches such as CITE-seq and REAP-seq can simultaneously probe the RNA and protein levels for each single cell, albeit with the tradeoff of dissociating cells from their original spatial location. Recent methodology developments now allow robust measurements of both nucleic acid and protein information in tissues, although these are currently hindered by either a low number of parameters or poor resolution (<xref ref-type="bibr" rid="R23">23</xref>–<xref ref-type="bibr" rid="R26">26</xref>).</p><p id="P5">Given the frequent overlap in proteins measured across dissociated single-cells via sequencing, and intact tissues via antibody-imaging, an orthogonal approach would leverage information from one modality to inform the other. Such an effort would use biological measurements obtained on one modality (e.g. CITE-seq) to inform cells measured using another modality (e.g. CODEX) for a comprehensive assessment of the localization of both proteins and RNAs within tissue samples. Such an approach would be key in inferring either the spatial geolocations of dissociation-based CITE-seq experiments, or the RNA localization of spatial-proteomic CODEX experiments, to enable a better understanding of the complex systems of biological entities.</p><p id="P6">Several computational approaches for integrative analysis of single-cell data across multiple modalities currently exist (<xref ref-type="bibr" rid="R27">27</xref>–<xref ref-type="bibr" rid="R30">30</xref>). However, the majority of these methods are tailored toward single-cell sequencing-based analysis, such as scRNA-seq and scATAC-seq, and are not directly compatible with protein-based assays due to differences in the number of parameters and the level of sparsity of the data. The general steps of these methods are the following: Step 1. Project the shared features of the datasets onto a common latent space, from which a cross-dataset distance matrix is constructed; Step 2. Align individual cells greedily via mutual nearest neighbors (mNN); Step 3. Joint embedding of the data and subsequent clustering. Unfortunately, application of this approach to single-cell proteomic datasets can lead to suboptimal results because the number of shared features across proteomic datasets are orders of magnitude smaller than those in single-cell sequencing datasets, and the signals within these limited shared features alone are typically not sufficient to produce high-quality and interpretable pairwise cell matching results. In addition, the intrinsically greedy (and thus at most locally optimal) nature of the mNN matching algorithm limits the ability to fully utilize the correlation structure within the distinct protein features. The first limitation illustrates the necessity of mining the hidden correlations among distinct features, whereas the second roadblock demonstrates the need to optimize the matching objective function to its global optimum. Thus, there is an urgent need for a new strategy specifically designed for matching and integrating single-cell datasets based on limited but robust proteomic parameters.</p><p id="P7">To meet this need, we have developed <italic>Matching with pARtIal Overlap</italic> (MARIO), a novel algorithm that can robustly match and integrate single-cell datasets based on proteomic measurements. The matching process leverages both shared and distinct features between datasets, and is non-greedy and globally optimized. We additionally developed two quality control steps, the <italic>Matchability Test</italic> and <italic>Joint Regularized Filtering,</italic> to avoid sub-optimal matching and prevent over-integration. Benchmarking of MARIO across various single-cell proteomic data generated from different modalities (CyTOF, CITE-seq and CODEX) and are of cross-species origin (human and non-human primates) demonstrated consistent outperformance of cell-cell matching accuracy over available mNN-based methods. Finally, by applying MARIO, we matched a total of 38,125 macrophages from a CODEX multiplex immunofluorescence lung autopsy dataset to CITE-seq bronchoalveolar lavage fluid (BALF) macrophage cells, and uncovered a spatially orchestrated immune conditioning by complement-expressing macrophages in COVID-19. To make MARIO freely available to the public, we implemented the algorithm in a Python package MARIO, along with aR version available online at <ext-link ext-link-type="uri" xlink:href="https://github.com/shuxiaoc/mario-py">https://github.com/shuxiaoc/mario-py</ext-link>.</p></sec><sec id="S2" sec-type="results"><title>Results</title><sec id="S3"><title>Matching and integration of single-cells individually using partially shared features in protein space</title><p id="P8">There are unique challenges in the implementation of a cell matching algorithm using proteomic information. First, each study is unique and rarely shares identical antibody panels, although a portion of the proteins measured is generally the same. Thus, the matching process must be able to achieve stable pairing of cells with this limited number of features; this is in contrast to transcriptomics data where often several hundred to thousand shared features are available for matching (<xref ref-type="bibr" rid="R29">29</xref>, <xref ref-type="bibr" rid="R30">30</xref>). Second, underlying correlations between shared and distinct protein features often exist within and between datasets as a result of panel design and fundamental biological principles. It is therefore pertinent to incorporate information from both shared and distinct protein features. Third, the matching problem should be solved to attain the global optimum rather than a local optimum that is produced by the greedy mNN matching commonly used to align scRNA-seq datasets. Finally, quality control steps are crucial to ensure the accuracy and interpretability of the postulated cell-cell matching results.</p><p id="P9">To address these challenges, we developed MARIO, a robust framework that accurately matches cells across single-cell proteomic datasets for downstream analysis (<xref ref-type="fig" rid="F1">Figure 1</xref>). MARIO first performs a pairwise cell matching using shared features. To do this, we employ singular value decomposition on shared features to construct a cross-data distance matrix based on the Pearson correlation coefficients of the reduced matrix. An initial cell-cell pairing is then obtained by solving a minimum-weight bipartite matching problem that searches for a distance-minimizing injective map between the two collections of cells. The two datasets are next aligned using this initial matching, and both shared and distinct features of the aligned datasets are projected onto a common subspace using Canonical Correlation Analysis (CCA) (<xref ref-type="bibr" rid="R31">31</xref>). This projection is the crux of this methodology as it incorporates the hidden correlations between different proteomic features not shared between the datasets. A cross-dataset distance is then obtained using the canonical scores, and the refined matching is obtained via minimum-weight bipartite matching. By taking the means of the top 10 sample canonical correlations (CCs) as a proxy of matching quality, MARIO then finds the best convex combination weight to interpolate the initial and refined matchings, thus achieving a data-adaptive balancing of the two sources of information.</p><p id="P10">After achieving the balanced matching between the two datasets, MARIO next performs a matchability test to determine whether or not the datasets being integrated by the user are suitable for such a joint analysis. It is pertinent that datasets with poor quality or limited underlying correlations are not forcefully paired. The matchability test is performed by flipping the sign of each row of the two datasets with some flipping probability, so that the majorty of underlying correlations (if exists) between the two datasets is abrogated. This process is repeated a number of times to build a distribution of the background CCs of the samples with low underlying correlation. Comparison of the deviation of the sample CCs from the background distribution reveals whether strong underlying information exists to connect the datasets.</p><p id="P11">Although datasets passing the matchability test are highly correlated, the matching at the individual cell level could still be erroneous if certain rare cell types only exist in one of the dataset or data quality related to specific cell types is inferior. To address these problems, we developed a process termed jointly regularized filtering to automatically filter out low-quality matches without a priori biological knowledge. The filtering process is carried out by optimizing a regularized k-means objective. This objective is a superposition of two parts, where the first part contains individual k-mean clustering objectives for both datasets, and the second part penalizes the Hamming distance between the two individual cluster label vectors and a hypothesized “global” label vector. Use of such a strategy stems from our hypothesis that although the populations being measured in two different experiments may contain modality-specific characteristics (thus the existence of “individual” cluster labels), both originate from a biologically analogous population (thus the existence of a “global” cluster label that is close to the two individual cluster labels). If for a matched pair of cells, the individual labels obtained by joint regularized clustering are not the same, this matched pair is likely spurious and thus disregarded. After this filtering step, the resulting individually matched cells are subject to CCA, and the canonical scores are used as the reduced components for calculating the final embeddings. We implemented generalized Canonical Correlation Analysis (gCCA) to achieve joint embedding of more than two datasets, and subsequently utilized the gCCA sample canonical scores as dimensional-reduced components for calculating and visualizing the final embeddings. Readers are referred to the Materials and Methods section for further descriptions and mathematical details.</p></sec><sec id="S4"><title>Robust matching and integration of multi-platform and multi-modal single-cell protein measurements with MARIO</title><p id="P12">We first evaluated the performance of MARIO on two distinctive datasets generated using individual cells isolated from healthy human bone marrow. The first is a sequencing-based CITE-seq dataset consisting of 29,007 cells, stained with an antibody panel of 29 markers (<xref ref-type="bibr" rid="R30">30</xref>) and the second is a mass cytometry-based CyTOF dataset consisting of 102,977 cells, stained with an antibody panel of 32 markers (<xref ref-type="bibr" rid="R32">32</xref>). Twelve markers (CD11c, CD123, CD14, CD16, CD19, CD3, CD34, CD38, CD4, CD45RA, CD8, and HLA-DR) were common to both datasets. MARIO successfully matched and aligned these two datasets as shown by visual inspection (<xref ref-type="fig" rid="F2">Figure 2A</xref>). The intricate data structures were preserved post-MARIO integration, with clear separation of cells belonging to phenotypically distinctive populations in dimension-reduced t-distributed stochastic neighbor embedding (t-SNE) plots (<xref ref-type="fig" rid="F2">Figure 2B</xref>). The original cell-type annotations based upon the shared low-level annotation (<xref ref-type="fig" rid="F2">Figure 2B</xref>; top left), and on pre-existing annotations from each dataset (<xref ref-type="fig" rid="F2">Figure 2B</xref>; top right and bottom left) were highly conserved after MARIO integration. Subsequent joint clustering of the post-MARIO integrated data using the canonical scores also corroborated in highly accurate cell-type delineation (<xref ref-type="fig" rid="F2">Figure 2B</xref>, bottom right).</p><p id="P13">We next designed three different scenarios to further characterize the integration performance of MARIO and to compare its performance against the single-cell integration methods Seurat (<xref ref-type="bibr" rid="R30">30</xref>), fastMNN (<xref ref-type="bibr" rid="R27">27</xref>), and Scanorama (<xref ref-type="bibr" rid="R28">28</xref>). In the first case, shared protein markers were removed from each dataset individually (in an accumulative fashion and in alphabetical order) to simulate the distinctive antibody panel designs across potential datasets. MARIO consistently outperformed other methods in terms of matching accuracy, independently of the excluded protein targets (<xref ref-type="fig" rid="F2">Figure 2C</xref>). Thus, MARIO outperformed other methods when used with the plethora of variable experiment-specific antibody panel configurations (full 12-shared panel total accuracy: MARIO, 96.01%; Seurat, 90.29%; fastMNN, 90.22%; Scanorama, 91.46%; dropping 8 shared antibodies: MARIO, 91.45%; Seurat, 70.56%; fastMNN, 69.94%; Scanorama, 71.22%). We additionally evaluated the integration quality among these methods, using metrics including Structure alignment score, Silhouette F1 score, Adjusted Rand Index F1, and Cluster Mixing score, in addition to t-SNE visualizations, based on each method’s post-integration latent space scores (<xref ref-type="supplementary-material" rid="SD1">Figure S1A,B</xref>).</p><p id="P14">In the second test, random noise was gradually spiked into the datasets to simulate the variability of intrinsic signal-noise in real world data. The matchability test implemented in MARIO was able to detect and alert the user when data quality was insufficient for confident matching (<xref ref-type="fig" rid="F2">Figures 2D</xref>). In contrast, the elevated noise resulted in an increase in the number of cells being forcefully paired in other tested methods (reaching close to 100%), albeit with low accuracy (ranging from 50% to 80% in accuracy). Given that the other methods are primarily mNN-based and only locally optimized, the higher noise resulted in more erroneous pairs.</p><p id="P15">In the third scenario, an entire group of cell types was removed from the destination dataset (i.e., the set being matched to) to mimic fluctuations of cell type composition between potential datasets. MARIO outperformed all other tested methods by successfully suppressing the incorrect matching of these missing cell types (<xref ref-type="fig" rid="F2">Figure 2E</xref>; error avoidance scores where larger value indicates better performance for plasmacytoid dendritic cells (pDCs): MARIO, 1.65; mNN methods, 0.42-1.12; natural killer (NK) cells: MARIO, 3.83; mNN methods, 0.40-1.21; B cells: MARIO, 6.18; mNN methods, 0.49-1.15; CD8 T cells: MARIO, 12.67; mNN methods, 0.61-1.57; CD4 T cells: MARIO, 18.89; mNN methods, 0.77-1.99; monocytes: MARIO, 2.60; mNN methods, 0.59-1.39). Given the greedy matching nature of other methods tested, it appears that many of the missing cell types were repeatedly and incorrectly matched with cells from other cell types. This confounding situation is circumvented by the built-in cell-pair filtering function in MARIO.</p><p id="P16">The precise matching accuracy for CyTOF to CITE-seq cell pairs amongst all the major cell types with MARIO matching was high (<xref ref-type="supplementary-material" rid="SD1">Figure S2A</xref>): pDCs, 94.57%; NK cells, 98.07%; monocytes, 98.10%; hematopoietic stem and progenitor cells (HSPCs), 76.43%; CD8 T cells, 99.35%; CD4 T cells, 99.64%, and B cells, 98.98%. There was minimal cross-matching, indicative of high accuracy on the single-cell matching level across cell types. Robust matching across two experimental platforms allows the evaluation of differential expression patterns of proteins both shared and unique to these separate experiments. This matching also allows the transcriptome of the single-cells measured using CyTOF to be inferred through the matched CITE-seq pairs. We confirmed that the expression patterns of cell type-specific markers were in good agreement between CyTOF proteins, CITE-seq proteins, and CITE-seq RNA transcripts (<xref ref-type="fig" rid="F2">Figure 2F, G</xref> and <xref ref-type="supplementary-material" rid="SD1">Figure S2B, C</xref>). Moreover, the expression pattern of CD45RO protein and <italic>S100A4</italic> and <italic>CCR7</italic> RNAs from CITE-seq assisted the delineation of memory and naive CD4 T cell subtypes in the integrated dataset, which was individually unavailable for manual annotation in the CyTOF dataset alone. Therefore, this integrated analysis better defines cell states than do these modalities individually.</p><p id="P17">We subsequently evaluated the performance of MARIO on two healthy human peripheral blood mononuclear cell (PBMC) datasets measured by CITE-seq and CyTOF. Fifteen proteins (CD11b, CD127, CD14, CD16, CD19, CD25, CD27, CD3, CD4, CD45RA, CD45RO, CD56, CD8a, HLA- DR and PD-1) were common across these two datasets. MARIO successfully integrated the two datasets (<xref ref-type="supplementary-material" rid="SD1">Figure S3A</xref>) and resulted in accurate cell type matching (<xref ref-type="supplementary-material" rid="SD1">Figure S3B</xref>; NK cells, 89.93%; naive CD4 T cells, 94.33%; memory CD4 T cells, 90.25%; dendritic cells (DCs), 79.66%; CD8 T cells, 98.69%; monocytes, 96.46%; and B cells, 97.94%). Our results reveal that the expression of key genes on both protein (CyTOF and CITE-seq) and RNA (CITE-seq) levels are in high agreement with their corresponding phenotypic cell-of-origin assignments (<xref ref-type="supplementary-material" rid="SD1">Figure S3C</xref>). Further benchmarking using the three cases described above showed similar superior matching accuracy for MARIO regardless of antibody panel setup (<xref ref-type="supplementary-material" rid="SD1">Figure S4A</xref>; full 15-antibody shared panel total accuracy: MARIO, 90.62%; Seurat, 87.55%; fastMNN, 87.27%; Scanorama, 87.39%; dropping 8 shared antibodies total accuracy: MARIO, 86.34%; Seurat, 80.10%; fastMNN, 80.04%; Scanorama, 81.03%). In evaluation of suppression of over-integration due to poor quality data, mNN methods force matched almost all cells with accuracy below 70%, whereas MARIO alerted the user of poor data quality (<xref ref-type="supplementary-material" rid="SD1">Figure S4B</xref>). Thirdly, integration with MARIO, but not with mNN methods, was robust even with extensive cell type composition changes (<xref ref-type="supplementary-material" rid="SD1">Figure S4C</xref>; error avoidance scores for monocytes: MARIO, 1.94; mNN methods, 0.53-1.37; B cells: MARIO, 4.53; «mNN methods, 0.56-1.37; DCs: MARIO, 1.13; mNN methods, 0.31-0.93; NK cells: MARIO, 2.54; mNN methods, 0.43-1.17; CD8 T cells: MARIO, 4.83; mNN methods, 0.46-1.01; memory CD4 T cells: MARIO, 3.97; mNN methods, 0.38-0.85).</p></sec><sec id="S5"><title>Cross-species integrative analysis reveals species and stimuli-specific immunological responses</title><p id="P18">Non-human primates (NHP) are a cornerstone of biomedical research, enabling the rapid investigation of diseases and host responses in a system highly analogous to humans as demonstrated for rapid disease modeling and vaccine development during the recent COVID-19 pandemic (<xref ref-type="bibr" rid="R33">33</xref>). Nonetheless, animal models do not fully recapitulate all host responses in humans (<xref ref-type="bibr" rid="R34">34</xref>, <xref ref-type="bibr" rid="R35">35</xref>). Given the increasing amount of single-cell proteomic studies in NHP models of disease (<xref ref-type="bibr" rid="R36">36</xref>–<xref ref-type="bibr" rid="R39">39</xref>), the ability to identify common and different responses to diseases is essential to appreciate host immune response at scale. Given the major commonalities of host immune compositions across NHPs and humans, we postulated that MARIO would be able to effectively integrate human and NHP datasets to reveal underlying common immune coordination and differential responses.</p><p id="P19">We performed MARIO matching of four CyTOF datasets from studies in which 1) human whole blood cells were isolated from individuals challenged with H1N1 virus (<xref ref-type="bibr" rid="R40">40</xref>), consisting of 102,147 cells, 2) human whole blood cells were stimulated with IFN<sub><italic>γ</italic></sub> (<xref ref-type="bibr" rid="R37">37</xref>), consisting of 114,175 cells, 3) rhesus macaque whole blood cells were stimulated with IFN<sub><italic>γ</italic></sub>, consisting of 112,218 cells, and 4) cynomolgus monkey whole blood cells were stimulated with IFN<sub><italic>γ</italic></sub>, consisting of 91,409 cells (<xref ref-type="fig" rid="F3">Figure 3A, B</xref>). Dataset 1 was generated using 42 markers, and datasets 2, 3, and 4 were generated using 39 markers. We observed a high degree of concordance between cell types when visualizing the human-human and human-NHP datasets via t-SNE using MARIO integrated canonical scores (<xref ref-type="fig" rid="F3">Figures 3A, B</xref>). MARIO cell-type assignment accuracies were high (<xref ref-type="fig" rid="F3">Figure 3C</xref>). For dataset 1 to dataset 2, accuracies were as follows: B cells, 96.96%; CD4 T cells, 98.80%; CD8 T cells, 98.22%; monocytes, 99.66%; neutrophils, 99.51%; NK cells, 98.39%. For dataset 1 to dataset 3, accuracies were as follows: B cells, 86.76%; CD4 T cells, 97.22%; CD8 T cells, 91.75%; monocytes, 97.85%, neutrophils, 97.99%; NK cells, 86.42%. For dataset 1 to dataset 4, accuracies were as follows: 1 to 4: B cells, 91.90%; CD4 T cells, 96.49%; CD8 T cells, 92.53%; monocytes, 95.14%, neutrophils, 96.10%; NK cells, 80.78%. There were minimal differences, as measured using Euclidean distance, between paired cells calculated by canonical scores (<xref ref-type="fig" rid="F3">Figure 3D</xref>).</p><p id="P20">Successful application of MARIO for robust matching and integration across three species and two stimulation conditions allowed us to investigate intrinsic differences in cell type-specific immune responses across humans and NHPs. We observed an increase in proliferation of CD4 T cells in human blood cells after both influenza viral challenge and IFN<sub><italic>γ</italic></sub> stimulation, as marked by the upregulation of Ki-67, but no increase proliferation was detected after stimulation of NHP blood cells (<xref ref-type="fig" rid="F3">Figure 3E and F</xref>). We also observed the upregulation of pSTAT1, particularly in monocytes, in human and NHP samples treated with IFN<sub><italic>γ</italic></sub> but not after influenza challenge (<xref ref-type="fig" rid="F3">Figure 3E and F</xref>). These results are consistent with previous observations (<xref ref-type="bibr" rid="R41">41</xref>–<xref ref-type="bibr" rid="R43">43</xref>). Finally, there was an increased p38 expression in all cell types across all samples, reflective of the conserved functionality of p38 during cell inflammatory and stress responses (<xref ref-type="bibr" rid="R44">44</xref>, <xref ref-type="bibr" rid="R45">45</xref>). Our benchmarking results showed superior matching accuracy using MARIO regardless of antibody panel setup. When using 39 shared antibodies, the total accuracy was 93.26% for MARIO, 86.20% for Seurat, 84.89% for fastMNN, and 85.83% for Scanorama; when eight shared antibodies were dropped, the total accuracy for IFN<sub><italic>γ</italic></sub> treatment was 86.79% for MARIO, 80.88% for Seurat, 77.89% for fastMNN, and 82.23% for Scanoramt (<xref ref-type="supplementary-material" rid="SD1">Figure S5A</xref>). In the analyses with spiked-in noise, mNN methods forced matching almost 100% of cells with accuracy below 70% with increased noise added, whereas MARIO alerted the user of insufficient information for matching (<xref ref-type="supplementary-material" rid="SD1">Figure S5B</xref>). MARIO, unlike the mNN methods we tested, was robust in resisting cell-type composition changes (<xref ref-type="supplementary-material" rid="SD1">Figure S5C</xref>; error avoidance scores, B cells: MARIO, 1.36; mNN methods, 0.51-1.07; NK cells: MARIO, 2.75; mNN methods, 0.52-1.01; neutrophils: MARIO, 2.01; mNN methods 0.41-1.02; CD8 T cells: MARIO, 1.52; mNN methods, 0.63-0.96; CD4 T cells: MARIO, 1.47; mNN methods, 0.43-0.93 monocytes: MARIO, 1.64; mNN methods, 0.52-1.19)</p><p id="P21">We similarly applied this strategy to data from IL-4-stimulated human and NHP whole blood cells, and compared them to human influenza viral challenge blood cells (<xref ref-type="supplementary-material" rid="SD1">Figure S6A, B</xref>). Upon IL-4 stimulation, we saw an upregulation of Ki-67 in human CD4 T cells but not NHP cells, much akin to IFN<sub><italic>γ</italic></sub> stimulation (<xref ref-type="supplementary-material" rid="SD1">Figure S6C</xref>), and high expression of pSTAT1 in monocytes of IL-4-stimulated blood cells but not in human blood cells challenged with influenza (<xref ref-type="supplementary-material" rid="SD1">Figure S6C</xref>). In line with IFN<sub><italic>γ</italic></sub> stimulation, the p38 response was consistent across species and treatments. Our results consistently showed superior matching accuracy using MARIO regard less of antibody panel setup. When using 39 shared antibodies, the total accuracy was 89.60% for MARIO, 87.75% for Seurat, 88.30% for fastMNN, and 86.76% for Scanorama; when eight shared antibodies were dropped, the total accuracy was 87.16% for MARIO, 82.72% for Seurat, 82.87% for fastMNN, and 82.83% for Scanorama (<xref ref-type="supplementary-material" rid="SD1">Figure S7A</xref>). In the analyses where noise is spiked-in, mNN methods forced matching of almost 100% of cells with accuracy below 70% with increasing noise, whereas MARIO alerted the user of insufficient information for matching (<xref ref-type="supplementary-material" rid="SD1">Figure S7B</xref>). MARIO was over most resistant to cell-type composition changes (<xref ref-type="supplementary-material" rid="SD1">Figure S7C</xref>; error avoidance scores B cells: MARIO, 1.12; mNN methods, 0.46-0.96; NK cells: MARIO, 2.97; mNN methods, 0.55-1.03; neutrophils: MARIO, 2.08; mNN methods, 0.42-1.02; CD8 T cells: MARIO, 2.49; mNN methods, 0.65-1.17; CD4 T cells: MARIO, 1.65; mNN methods, 0.430-97; monocytes: MARIO, 1.61; mNN methods, 0.54-1.24).</p></sec><sec id="S6"><title>Accurate tissue architectural reconstruction reveals diverse lymphocyte populations</title><p id="P22">Inferring the spatial localization of biofeatures at the single-cell level is necessary for a holistic understanding of cellular processes <italic>in situ</italic> (<xref ref-type="bibr" rid="R22">22</xref>). Currently used multi-modal approaches to measure nucleic acids and proteins in their native tissue context are often limited by scale or resolution (<xref ref-type="bibr" rid="R9">9</xref>, <xref ref-type="bibr" rid="R23">23</xref>, <xref ref-type="bibr" rid="R25">25</xref>). We reasoned that a highly accurate cell matching and integration strategy, such as MARIO, could infer the spatial localization of transcripts within individual cells. We performed MARIO on spatially resolved data from murine splenic cells collected using antibody-based CODEX imaging (29 protein markers)(<xref ref-type="bibr" rid="R13">13</xref>) and data from dissociated murine splenic cells assayed using CITE-seq (206 protein markers) (<xref ref-type="bibr" rid="R46">46</xref>); 29 protein markers (all the markers in the CODEX dataset) were shared.</p><p id="P23">We first visually verified successful MARIO matching and integration using dimension-reduced t-SNE plots (<xref ref-type="fig" rid="F4">Figure 4A</xref>). Cell-cell matching accuracy was high across all cell types: 87.69% for NK cells, 90.04% for neutrophils, 73.84% for macrophages, 83.72% for monocytes, 94.35% for DCs, 95.61% for CD8 T cells, 95.70% for CD4 T cells, and 93.99% for B cells (<xref ref-type="supplementary-material" rid="SD1">Figure S8A</xref>). This enabled highly accurate single-cell information transfer between cells measured using CITE-seq and CODEX spatially resolved cells (<xref ref-type="fig" rid="F4">Figure 4B</xref> and <xref ref-type="supplementary-material" rid="SD1">Figure S8B</xref>). We visually observed highly concordant spatial organization of cell types annotated using CODEX or CITE-seq information and further observed a clear distribution pattern of transcripts corresponding to their expected spatial localization in the spleen (<xref ref-type="fig" rid="F4">Figure 4B</xref> and <xref ref-type="supplementary-material" rid="SD1">Figure S8B</xref>). For example, <italic>Il7r</italic> is concentrated in the T cell zone as expected (<xref ref-type="bibr" rid="R47">47</xref>); <italic>Myc</italic> and <italic>Cxcr5</italic> are localized to activated and proliferating T and B cells within the germinal center (<xref ref-type="bibr" rid="R48">48</xref>, <xref ref-type="bibr" rid="R49">49</xref>); <italic>Ms4a1</italic> and <italic>Bhlhe41</italic> are highly expressed in the B cell zone and B cells in the red pulp region (50–53); and <italic>Il1b</italic> is expressed outside the B cell zone (<xref ref-type="bibr" rid="R54">54</xref>). t-SNE overlays of the matched protein and RNA expression confirmed expected RNA expression profiles within given cell types (<xref ref-type="supplementary-material" rid="SD1">Figure S8C</xref>).</p><p id="P24">We next sought to further refine cells from the B lymphocyte lineage by gating the B cell population from the CODEX dataset based on B220, CD19, IgM, IgD, CD21/35, and MHCII. Four sub-populations of B cells were identified: Transitional type 1 B cells (T1), Marginal Zone B cells (MZ), Mature B cells (M) and Follicular/Germinal Center B cells (FO/GC) (<xref ref-type="supplementary-material" rid="SD1">Figure S8D</xref>). Visual inspection of the spatial location of these four subtypes of B cells confirmed localization within mouse spleens consistent with previous observations (<xref ref-type="supplementary-material" rid="SD1">Figure S8E</xref>) (<xref ref-type="bibr" rid="R55">55</xref>, <xref ref-type="bibr" rid="R56">56</xref>). MARIO-matching thus enabled a detailed examination of the differentially expressed transcripts within these B cell subtypes resolved by CODEX, revealing a distinctive transcriptional program reflective of their phenotype (<xref ref-type="fig" rid="F4">Figure 4C</xref>). For example, we observed signature landmark genes previously shown to demarcate these B cell subtypes from single-cell or bulk transcriptomic analysis (<italic>Ighm</italic>, <italic>Arid3a,</italic> and <italic>Pafah1b3</italic> for T1; <italic>Ighd, Fcer2a/Cd23</italic> and <italic>Cd69</italic> for M; <italic>Cd9, Cr2</italic> and <italic>Mzb1</italic> for MZ; <italic>Zbtb38, Tmed8</italic> and <italic>Kxd1</italic> for FO/GC)47 (57–59). These genes were significantly up- regulated (p-adjust &lt; 0.05, Wilcoxon Test) in the corresponding gated populations of CODEX B cells.</p><p id="P25">For this CODEX to CITE-seq matching, MARIO had matching accuracy superior to mNN methods (<xref ref-type="supplementary-material" rid="SD1">Figure S9A</xref>). For the full 28-antibody shared panel, the total accuracy for MARIO was 87.76%, for Seurat it was 83.64%, for fastMNN it was 87.40%, and for Scanorama it was 82.70%. Dropping eight shared antibodies in the panel resulted in total accuracies of 85.31% for MARIO, 77.97% for Seurat, 82.01% for fastMNN, and 80.03% for Scanorama. MARIO prevented over-integration due to poor quality data, whereas the mNN methods forced matching (<xref ref-type="supplementary-material" rid="SD1">Figure S9B</xref>). MARIO was also robustness in resisting changes to cell-type composition (<xref ref-type="supplementary-material" rid="SD1">Figure S9C</xref>; error avoidance scores: DCs: MARIO, 1.63; mNN methods, 0.39-0.83; NK cells: MARIO, 1.66; mNN methods, 0.31-0.7; monocytes: MARIO, 1.82; mNN methods, 0.32-0.72; CD8 T cells: MARIO, 2.48; mNN methods, 0.531.23; CD4 T cells: MARIO, 2.24; mNN methods, 0.56-1.18; macrophages: MARIO, 1.77; mNN methods, 0.30-0.74).</p></sec><sec id="S7"><title>A COVID-19 lung molecular atlas reveals the role of complement activation in macrophages and related orchestrated immune responses</title><p id="P26">Single-cell profiling technologies have emerged as powerful tools in response to the ongoing COVID-19 pandemic. The deep functional characterization of clinical samples has provided critical insights into viral pathogenesis and tissue-specific host immune responses (<xref ref-type="bibr" rid="R60">60</xref>). Understanding these responses in their native tissue context has implicated potential therapeutic avenues (<xref ref-type="bibr" rid="R61">61</xref>, <xref ref-type="bibr" rid="R62">62</xref>), but highly coordinated efforts are needed for an integrative understanding of the biological effects in COVID-19 (<xref ref-type="bibr" rid="R63">63</xref>).</p><p id="P27">We reasoned that the ability to perform integrative and inferential analysis across biological analogous clinical cohorts, measured at different institutions with varying technologies, would further our understanding of the facets of COVID-19 biology. We profiled 76 lung tissue regions from 23 individuals who succumbed to COVID-19 using CODEX high dimensional imaging with 50 markers, and MARIO-matched the macrophage population identified therein against those from bronchoalveolar lavage fluid (BALF) samples subject to CITE-seq with 250 surface markers (<xref ref-type="fig" rid="F5">Figure 5A</xref>).</p><p id="P28">We were able to stratify the macrophages into two populations based on their transcriptional signatures of complement pathway activity (<xref ref-type="fig" rid="F5">Figure 5B</xref>; <italic>C1Q</italic> Low and <italic>C1Q</italic> High). Interestingly, we observed a positive correlation between the abundance of <italic>C1Q</italic> Low macrophages and patient body mass index (BMI; <xref ref-type="supplementary-material" rid="SD1">Figure S10D</xref>). Given that low serum <italic>C1Q</italic> levels have been reported in patients with severe COVID-19 (<xref ref-type="bibr" rid="R64">64</xref>), future studies should explore whether <italic>C1Q</italic> dysregulation can explain the positive association between obesity and risk for COVID-19-related hospitalization and death (<xref ref-type="bibr" rid="R65">65</xref>). The protein expression of these two classes of macrophages also partly corresponded to a M1 phenotype for <italic>C1Q</italic> Low macrophages, and an immunosuppressive M2 phenotype for <italic>C1Q</italic> High macrophages (<xref ref-type="fig" rid="F5">Figure 5B</xref>). We further observed that the <italic>C1Q</italic> High transcriptional program was enriched in antigen processing and presentation, whereas that of the <italic>C1Q</italic> Low population consisted of several immune chemotaxis and migration pathways, including that of neutrophil chemoattractants (<xref ref-type="supplementary-material" rid="SD1">Figure S10A</xref>). The top differentially expressed transcripts included <italic>CXCL8</italic>, <italic>CCL7</italic> and <italic>TMEM176B</italic>, with previously described roles in regulating neutrophil recruitment and migration (<xref ref-type="bibr" rid="R66">66</xref>–<xref ref-type="bibr" rid="R68">68</xref>). The roles of proteins encoded by <italic>IL1B, S100A8</italic> and <italic>CCL2</italic> in the recruitment of aberrant neutrophils has been recently eluded in NHP and mice models of SARS-CoV-2 lung pathology (<xref ref-type="bibr" rid="R69">69</xref>), and are also reflected by elevated transcript levels in <italic>C1Q</italic> Low macrophages (<xref ref-type="supplementary-material" rid="SD1">Figure S10B</xref>).</p><p id="P29">In the five previously established functional clusters of interferon stimulated genes (ISG) (<xref ref-type="bibr" rid="R70">70</xref>, <xref ref-type="bibr" rid="R71">71</xref>), we observed distinctive ISG transcriptional programs in <italic>C1Q</italic> Low and High macrophages (<xref ref-type="supplementary-material" rid="SD1">Figure S10C</xref>; p-adjust &lt; 0.05, Wilcoxon Test) across all clusters (C1 &amp; C2: RNA Process, C3: IFN Regulators - Antiviral effectors, C4: Metabolic Regulation, C5: Inflammation). Of particular interest is the C3 (Antiviral Activities) and C5 (Inflammation) clusters (<xref ref-type="supplementary-material" rid="SD1">Figure S10C</xref>; Green and Gold clusters). Our results suggest that in C1Q Low macrophages several previously described genes (including <italic>SERPIN89</italic>, <italic>MX1</italic>, <italic>LGAPS3BP</italic>, <italic>SIGLEC1</italic>, <italic>CKAP4</italic>, <italic>CCL2</italic> and <italic>SPHK1)</italic> that encode proteins reported to directly inhibit SARS-CoV-2 replication and entry are upregulated, but the failure to regulate and dampen this innate response paves the way to unchecked host immune responses and collateral tissue damage (<xref ref-type="bibr" rid="R72">72</xref>–<xref ref-type="bibr" rid="R76">76</xref>) (<xref ref-type="supplementary-material" rid="SD1">Figures S10C</xref>).</p><p id="P30">In line with the transcriptional signatures for aberrant neutrophil infiltration (<xref ref-type="supplementary-material" rid="SD1">Figure S10A</xref>), we noted a correlation between the presence of <italic>C1Q</italic> Low macrophages and increased infiltrating neutrophils (<xref ref-type="fig" rid="F5">Figure 5C–E</xref>; Rho = -0.453, p &lt; 0.0001). This elevated neutrophil presence was also confirmed visually (<xref ref-type="fig" rid="F5">Figures 5F–G</xref> and <xref ref-type="supplementary-material" rid="SD1">S10E</xref>). Spatial cell-cell interaction analysis showed striking differences in these two subclasses of macrophages and their proximity with other cell types, such as high frequency of <italic>C1Q</italic> High macrophages to be proximal to CD4 and CD8 T cells, B cells, myeloid cells and other macrophages (<xref ref-type="supplementary-material" rid="SD1">Figure S10F</xref>). We next anchored <italic>C1Q</italic> High and Low macrophages for an anchor analysis (<xref ref-type="bibr" rid="R25">25</xref>) to understand the microenvironment as a function of distance around these two groups of macrophages. Our analysis confirmed the distinctive microenvironments and differences in immune orchestration around these macrophages, as evident from the differential organization of macrophages, plasma cells, vasculature and CD8 T cells (<xref ref-type="supplementary-material" rid="SD1">Figure S10G</xref>).</p><p id="P31">We finally performed Protein And Nucleic acid IN situ Imaging (PANINI)(<xref ref-type="bibr" rid="R25">25</xref>) to visualize the mRNA of a complement marker, <italic>C1QA,</italic> the neutrophil marker CD15 and the macrophage marker CD68 on COVID-19 tissue microarray sections to experimentally validate the spatially resolved gene expression patterns predicted by MARIO (<xref ref-type="fig" rid="F5">Figure 5H</xref>). We confirmed the robust expression patterns of <italic>C1QA</italic> mRNA, CD68 and CD15 proteins in the tissue sections (<xref ref-type="supplementary-material" rid="SD1">Figure S10H</xref>). We observed a robust and significant correlation between the percentages of experimentally validated <italic>C1Q</italic> High macrophages and MARIO-predicted <italic>C1Q</italic> High macrophages percentage, both at the patient level (p = 0.019, Rho = 0.574) and at the per tissue core level (p = 0.000068, Rho = 0.521, Spearman Ranked test, <xref ref-type="fig" rid="F5">Figures 5I and J</xref>). In line with anchor analysis from MARIO-inferred data, we confirmed a significantly decreased neutrophil density around <italic>C1Q</italic> High macrophages in the PANINI validation experiment (<xref ref-type="fig" rid="F5">Figure 5K</xref>). The RNA spatial pattern from our PANINI experiment, performed on a separate, non-adjacent section of the same patient tissue core, recapitulated the prediction from the MARIO-matched data (<xref ref-type="fig" rid="F5">Figure 5L and M</xref>). The spatial correlation between MARIO-predicted and PANINI- validated expression levels of <italic>C1QA</italic> in macrophages was highly consistent even between non-adjacent sections of the same tissue core <italic>(C1QA</italic> signal per region: p &lt; 0.00001, Rho = 0.597, Spearman ranked test, <xref ref-type="fig" rid="F5">Figure 5N</xref>). This rho value was close to the maximum possible spatial correlation of the tissue structure as determined using cell density per region (p &lt; 0.00001, Rho = 0.602, <xref ref-type="supplementary-material" rid="SD1">Figure S10I</xref>), validating the highly accurate inferential capabilities of MARIO.</p></sec></sec><sec id="S8" sec-type="discussion"><title>Discussion</title><p id="P32">MARIO is a powerful matching and integration framework for single-cells that allows the retention of distinct features. It is thus particularly suitable for the integration of single-cell proteomic datasets with limited antibody panel overlap. We demonstrated that MARIO robustly and accurately matched cells across multiple sample types, assays, and species. Unlike current methodologies, MARIO performs pairwise matching of individual cells utilizing both shared and distinct features and is coupled with rigorous quality control steps. We benchmarked our algorithm across multiple datasets, and MARIO consistently outperformed other methods that were primarily designed for single-cell sequencing data and that are reliant upon the mNN matching algorithm. Importantly, MARIO inferential results allowed novel biologically interpretable insights. First, we demonstrated how CITE-seq data for human bone marrow cells could be leveraged to accurately delineate memory and naive T cell subtypes measured with a CyTOF panel lacking these naive/memory functional antibody markers. Second we showed that conserved and differential responses of human and NHP blood samples could be identified in data from different CyTOF experiments when matched using MARIO. Third, RNA transcripts could be spatially located within the murine spleen through the integration of CODEX and CITE-seq. Finally, two classes of complement pathway <italic>C1Q</italic> High and <italic>C1Q</italic> Low macrophages from COVID-19 BALF suspension cells analyzed by CITE-seq matched with COVID-19 lung autopsy CODEX data using MARIO delineated of the roles that these cell populations play in orchestrating immune responses to SARS-CoV-2 infection.</p><p id="P33">This MARIO analysis pipeline builds upon several novel and consolidated mathematical advances. First, the matching is constructed by globally (rather than locally) optimizing over a novel distance matrix that incorporates both the explicit correlations in shared features and the hidden correlations among distinct features. Second, the accuracy and robustness of the matching is ensured by two theoretically principled quality control processes, the Matchability Test and the Jointly Regularized Filtering (<xref ref-type="bibr" rid="R77">77</xref>). Third, the integrated embeddings are obtained via CCA or gCCA which incorporates the information in both the shared and distinct features.</p><p id="P34">In spite of the clear advantages of MARIO, it has some technical limitations. First, the accuracy and robustness come at the cost of longer analysis times compared to mNN-based approaches. Given the globally optimal nature of the core matching algorithm implemented in MARIO, the time required to run the MARIO pipeline is cubically related to the number of cells; in contrast, time required for mNN-based methods is quadratically related to the number of cells. To circumvent this, we developed a sparsification technique that reduces the search space, which accelerates the matching process. Empirically, we found that MARIO can be run on datasets with moderate sample sizes within reasonable time frames: The execution time for 50,000 cells took 10 minutes with a peak memory usage of approximately 7 GB (<xref ref-type="supplementary-material" rid="SD1">Figure S11</xref>). Second, although MARIO out performs mNN-based methods in the scarce shared feature regime, its success relies on the existence of shared features. This may not be the case in certain scenarios such as when integrating RNA-only and protein-only data. Future work incorporating methods that enable inference of protein levels from transcript levels will no doubt allow methods such as MARIO to have even broader applicability.</p><p id="P35">The need to study biological processes within their tissue context is increasingly evident, with direct relevance to the physiological context of health and disease. Simultaneous single-cell measurement of nucleic acids and proteins in their spatial context remains challenging, despite recent advancements (<xref ref-type="bibr" rid="R25">25</xref>,<xref ref-type="bibr" rid="R26">26</xref>,<xref ref-type="bibr" rid="R78">78</xref>), and it remains limited by factors including resolution and requirements for tissue fixation. The ability to match similar biological samples measured using distinctive single-cell assays will be paramount for hypothesis generation and guidance for experimental design. We are confident that MARIO will serve as a useful methodology and resource for the community with direct applications to a plethora of experimental platforms and biological contexts.</p></sec><sec id="S9" sec-type="materials | methods"><title>Materials &amp; Methods</title><sec id="S10"><title>Cell matching</title><p id="P36">Suppose we have two datasets <italic>X</italic> and <italic>Y</italic>, where <inline-formula><mml:math id="M1"><mml:mrow><mml:mi>X</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:mo>×</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>consists of <italic>n</italic>
<sub>x</sub> cells and (<italic>p</italic>
<sub>share</sub> + <italic>p</italic>
<sub>x</sub>) features and <inline-formula><mml:math id="M2"><mml:mrow><mml:mi>Y</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub><mml:mo>×</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>y</mml:mtext></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> consists of <italic>n</italic>
<sub>y</sub> cells and (<italic>p</italic>
<sub>share</sub> + <italic>p</italic>
<sub>y</sub>) features. Without loss of generality, we assume <italic>n</italic>
<sub>x</sub> ≤ <italic>n</italic>
<sub>y</sub>. Among all the features, <italic>n</italic>
<sub>share</sub> features are shared across both datasets, whereas the rest of the features are distinct to either <italic>X</italic> or <italic>Y</italic>. Thus, we can write both datasets as horizontal concatenations of a shared part and a distinct part: <disp-formula id="FD1"><mml:math id="M3"><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mspace width="0.2em"/><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mtext>dist</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.2em"/><mml:mi>Y</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mspace width="0.2em"/><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mtext>dist</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:math></disp-formula>
</p><p id="P37">The <italic>cell matching</italic> between <italic>X</italic> and <italic>Y</italic> is defined as an injective map Π, represented as a binary matrix of dimension <italic>n</italic>
<sub>x</sub> × <italic>n</italic>
<sub>y</sub>, such that <italic>Π<sub>i,i′</sub></italic> = 1 if and only if the <italic>i</italic>-th cell in X share a similar biological state with the <italic>i</italic>′-th cell in <italic>Y</italic>.</p><sec id="S11"><title>Initial matching with shared features</title><p id="P38">We first construct an initial estimator of Π using shared features alone. The procedure starts by denoising the shared parts via thresholding their singular values. Consider the singular value decomposition of the vertical concatenation of <italic>X</italic>
<sub>share</sub> and <italic>Y</italic>
<sub>share</sub>:<disp-formula id="FD2"><mml:math id="M4"><mml:mrow><mml:mo>(</mml:mo><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msub><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>D</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:msubsup><mml:mover accent="true"><mml:mi>V</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow><mml:mtext>T</mml:mtext></mml:msubsup><mml:mo>,</mml:mo></mml:math></disp-formula> where the vertical concatenation of <inline-formula><mml:math id="M5"><mml:msub><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula> and <inline-formula><mml:math id="M6"><mml:msub><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula> collects the left singular vectors, <inline-formula><mml:math id="M7"><mml:msub><mml:mover accent="true"><mml:mi>D</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula> is a diagonal matrix that collects the singular values in descending order, and <inline-formula><mml:math id="M8"><mml:msub><mml:mover accent="true"><mml:mi>V</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:math></inline-formula> collects the right singular vectors. Let <inline-formula><mml:math id="M9"><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>≤</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:math></inline-formula> be the number of components to keep. In the MARIO package, we denote <inline-formula><mml:math id="M10"><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mtext>n_;components_;ovlp</mml:mtext></mml:math></inline-formula>. We then compute the denoised version of <italic>X</italic>
<sub>share</sub> and <italic>Y</italic>
<sub>share</sub> by <disp-formula id="FD3"><mml:math id="M11"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>D</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>V</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msubsup><mml:mo>.</mml:mo><mml:mrow><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>⊤</mml:mo></mml:msubsup><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>D</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>V</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msubsup><mml:mo>.</mml:mo><mml:mrow><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>⊤</mml:mo></mml:msubsup><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> respectively, where for a matrix <italic>A,</italic> we let <italic>A.<sub>,1:r</sub></italic> denote its first <italic>r</italic> columns and for a diagonal matrix <italic>D</italic>, we let <italic>D<sub>1:r</sub></italic> denote the submatrix formed by taking its first <italic>r</italic> rows and columns. We then construct a cross-data distance matrix <inline-formula><mml:math id="M12"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, whose entries are given by <disp-formula id="FD4"><mml:math id="M13"><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mtext>cor</mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>⋅</mml:mo></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mo>⋅</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math></disp-formula> where <inline-formula><mml:math id="M14"><mml:mtext>cor</mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>⋅</mml:mo></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mo>⋅</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:math></inline-formula> is the Pearson correlation coefficient between the <italic>i</italic>-th row of <inline-formula><mml:math id="M15"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and the <italic>i</italic>-th row of <inline-formula><mml:math id="M16"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. The initial estimator of Π is given by the solution of the following optimization problem: <disp-formula id="FD5"><mml:math id="M17"><mml:mrow><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>arg</mml:mi><mml:mi>min</mml:mi><mml:mo>〈</mml:mo><mml:mi>Π</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:mo>〉</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mtext>subject</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>to</mml:mtext><mml:mspace width="0.2em"/><mml:mi>Π</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msub><mml:mi>Π</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula> where for two matrices <italic>A</italic> and <italic>B,</italic> we let <inline-formula><mml:math id="M18"><mml:mrow><mml:mo>〈</mml:mo><mml:mrow><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>B</mml:mi></mml:mrow><mml:mo>〉</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:msub><mml:msub><mml:mi>B</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:math></inline-formula> denote the Frobenius inner product. This optimization problem is an instance of minimal weight bipartite matching (a.k.a. rectangular linear assignment problem) in the literature (<xref ref-type="bibr" rid="R79">79</xref>).</p><p id="P39">
<bold><italic>Refined matching with distinct features.</italic></bold> Given the initial matching <inline-formula><mml:math id="M19"><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:math></inline-formula>, we can approximately align cells in <italic>X</italic> and <italic>Y</italic>: the rows of <italic>X</italic> and <inline-formula><mml:math id="M20"><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:math></inline-formula> <italic>Y</italic> correspond to pairs of cells with similar biological states, up to a certain level of mismatches induced by the estimation error of <inline-formula><mml:math id="M21"><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:math></inline-formula>. Despite mismatches, such an approximate alignment opens up the possibility of estimating the latent representations of <italic>X</italic> and <italic>Y</italic> by CCA.</p><p id="P40">Assuming both <italic>X</italic> and <italic>Y</italic> are standardized so that their columns are centered and scaled to have unit standard deviation. Then their empirical covariance and cross-covariance matrices are given by <disp-formula id="FD6"><mml:math id="M22"><mml:msub><mml:mover accent="true"><mml:mi>Σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>xx</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>X</mml:mi><mml:mo>⊤</mml:mo></mml:msup><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mtext> </mml:mtext><mml:msub><mml:mover accent="true"><mml:mi>Σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>yy</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:mi>Y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>⊤</mml:mo></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>Σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>x</mml:mtext><mml:mi>y</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>X</mml:mi><mml:mo>⊤</mml:mo></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:mi>Y</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math></disp-formula>
</p><p id="P41">The first pair of sample canonical coefficient vectors is given by <disp-formula id="FD7"><mml:math id="M23"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mspace width="0.6em"/><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mtext>argmax</mml:mtext></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>a</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mspace width="0.6em"/><mml:msup><mml:mi>a</mml:mi><mml:mo>⊤</mml:mo></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>Σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>xy</mml:mtext></mml:mrow></mml:msub><mml:mi>b</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext>subject</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>to</mml:mtext><mml:mspace width="0.2em"/><mml:msup><mml:mi>a</mml:mi><mml:mo>⊤</mml:mo></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>Σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>xx</mml:mtext></mml:mrow></mml:msub><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mi>b</mml:mi><mml:mo>⊤</mml:mo></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>Σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>yy</mml:mtext></mml:mrow></mml:msub><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> and the first sample canonical correlation is given by <inline-formula><mml:math id="M24"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>. Now, <sup>for</sup> 2 ≤ <italic>j</italic> ≤ <italic>p</italic>
<sub>share</sub> + min(<italic>p</italic>
<sub>x</sub>, <italic>p</italic>
<sub>y</sub>), the <italic>j</italic>-th pair of sample canonical coefficient vectors is successively defined as <disp-formula id="FD8"><mml:math id="M25"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mspace width="0.8em"/><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mtext>argmax</mml:mtext></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>a</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mspace width="0.6em"/><mml:msup><mml:mi>a</mml:mi><mml:mo>⊤</mml:mo></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>Σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>xy</mml:mtext></mml:mrow></mml:msub><mml:mi>b</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext>subject</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>to</mml:mtext><mml:mspace width="0.2em"/><mml:msup><mml:mi>a</mml:mi><mml:mo>⊤</mml:mo></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>Σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>xx</mml:mtext></mml:mrow></mml:msub><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mi>b</mml:mi><mml:mo>⊤</mml:mo></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>Σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>yy</mml:mtext></mml:mrow></mml:msub><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mspace width="0.8em"/><mml:msup><mml:mi>a</mml:mi><mml:mo>⊤</mml:mo></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>Σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>xx</mml:mtext></mml:mrow></mml:msub><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>l</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msup><mml:mi>a</mml:mi><mml:mo>⊤</mml:mo></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>Σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>yy</mml:mtext></mml:mrow></mml:msub><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>l</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>∀</mml:mo><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>l</mml:mi><mml:mo>≤</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1.</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
</p><p id="P42">In parallel, the <italic>j</italic>-th sample canonical correlation is given <sup>by</sup> <inline-formula><mml:math id="M26"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mi>Y</mml:mi><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> Let 1 ≤ <inline-formula><mml:math id="M27"><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>all</mml:mtext></mml:mrow></mml:msub></mml:math></inline-formula>≤ <italic>p</italic>
<sub>share</sub> + min(<italic>p</italic>
<sub>x</sub>, <italic>p</italic>
<sub>y</sub>) be the number of components to keep. In the MARIO package, we denote <italic>r</italic>
<sub>all</sub> = <monospace>n_;components_;all</monospace>. Collecting top <inline-formula><mml:math id="M28"><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>all</mml:mtext></mml:mrow></mml:msub></mml:math></inline-formula> sample canonical vectors into matrices <disp-formula id="FD9"><mml:math id="M29"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⋯</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>all</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>⋯</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>r</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>all</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> the latent representation of <italic>X</italic> can be estimated by <inline-formula><mml:math id="M30"><mml:mi>X</mml:mi><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext></mml:msub></mml:math></inline-formula>, the sample canonical scores of <italic>X</italic>. That is, we use <inline-formula><mml:math id="M31"><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext></mml:msub></mml:math></inline-formula> to project <italic>X</italic> onto the latent space. The same projection can be done on <italic>Y</italic> data by computing <inline-formula><mml:math id="M32"><mml:mi>Y</mml:mi><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext></mml:msub></mml:math></inline-formula>
<sub>y</sub>, so that the resulting matrix approximately lies in the same latent space as <inline-formula><mml:math id="M33"><mml:mi>X</mml:mi><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext></mml:msub></mml:math></inline-formula>.</p><p id="P43">To this end, we compute the cross-data distance matrix <inline-formula><mml:math id="M34"><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mtext>all</mml:mtext></mml:mrow></mml:msub></mml:math></inline-formula> directly on the latent space, whose entries are given by <disp-formula id="FD10"><mml:math id="M35"><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mtext>all</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mtext>cor</mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>·</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>Y</mml:mi><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>·</mml:mo></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:math></disp-formula>
</p><p id="P44">We finally solve for a refined matching by <disp-formula id="FD11"><mml:math id="M36"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>all</mml:mtext></mml:msub><mml:mo>∈</mml:mo><mml:mtext>argmin</mml:mtext><mml:mrow><mml:mo>〈</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mtext>all</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mo>〉</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>Π</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext>subject</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>to</mml:mtext><mml:mspace width="0.2em"/><mml:mi>Π</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:msub><mml:mo/><mml:mtext>x</mml:mtext></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>Π</mml:mi><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mn>1</mml:mn></mml:mstyle><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mn>1</mml:mn></mml:mstyle><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
</p></sec><sec id="S12"><title>Interpolation of initial and refined matchings</title><p id="P45">The quality of the refined matching <inline-formula><mml:math id="M37"><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>all</mml:mtext></mml:mrow></mml:msub></mml:math></inline-formula> is highly contingent upon the quality of the distinct features. If the distinct features are extremely noisy, incorporation of them may hurt the performance, in which case it is more desirable to revert back to the initial matching <inline-formula><mml:math id="M38"><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:math></inline-formula>. We develop an data-adaptive way of deciding how much distinct information shall be incorporated when we estimate the matching from the data.</p><p id="P46">To start with, we cut the unit interval [0,1] into grids (e.g., {0,0.1, …, 0.9,1}). For each <italic>λ</italic> on the grid, we interpolate the two kinds of distance matrices by taking their convex combination <disp-formula id="FD12"><mml:math id="M39"><mml:msub><mml:mi>D</mml:mi><mml:mtext>λ</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mtext>λ)</mml:mtext><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mtext>λ</mml:mtext><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mtext>all</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math></disp-formula> from which we can solve for the λ-interpolated matching <disp-formula id="FD13"><mml:math id="M40"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>λ</mml:mtext></mml:msub><mml:mo>∈</mml:mo><mml:mtext>argmin</mml:mtext><mml:mrow><mml:mo>〈</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mtext>λ</mml:mtext></mml:msub></mml:mrow><mml:mo>〉</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>Π</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext>subject</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>to</mml:mtext><mml:mspace width="0.2em"/><mml:mi>Π</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:msub><mml:mo/><mml:mtext>x</mml:mtext></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>Π</mml:mi><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mn>1</mml:mn></mml:mstyle><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mn>1</mml:mn></mml:mstyle><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
</p><p id="P47">Note that <inline-formula><mml:math id="M41"><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>λ=0</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="M42"><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>λ=1</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>dist</mml:mtext></mml:mrow></mml:msub></mml:math></inline-formula> After aligning <italic>X</italic> and <italic>Y</italic> using <inline-formula><mml:math id="M43"><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>λ</mml:mtext></mml:msub></mml:math></inline-formula>, we compute top k sample canonical correlations (in the MARIO package denoted as <monospace>top_;k</monospace>, and defaulted to 10), whose mean is taken to be a proxy of the quality of <inline-formula><mml:math id="M44"><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>λ</mml:mtext></mml:msub></mml:math></inline-formula>. We then select the best <italic>λ</italic> according to this quality measure and use <inline-formula><mml:math id="M45"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:msub></mml:mrow></mml:math></inline-formula> afterwards.</p></sec></sec><sec id="S13"><title>Quality control</title><sec id="S14"><title>Test of matchability</title><p id="P48">In extreme cases, the two datasets <italic>X</italic> and <italic>Y</italic> may not have any correlation at all, and thus any attempt to integrate both datasets would give unreliable results. For example, some methods, when applied to uncorrelated datasets, would pick up the spurious correlations and hence resulting in over-integration. A robust procedure should be able to tell and warn the users when the resulting matching estimator might be of low quality. We develop a rigorous hypothesis test, termed matchability test, for this purpose.</p><p id="P49">The matchability test starts by repeatedly drawing <italic>B</italic> i.i.d. copies of <italic>n</italic>
<sub>x</sub>-dimensional (potentially asymmetric) Rademacher random vectors <inline-formula><mml:math id="M46"><mml:msubsup><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mi>ε</mml:mi><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:msubsup></mml:math></inline-formula> and another <italic>B</italic> i.i.d. copies of <italic>n</italic>
<sub>y</sub>-dimensional Rademacher random vectors <inline-formula><mml:math id="M47"><mml:msubsup><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mi>ε</mml:mi><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:msubsup></mml:math></inline-formula>. That is, for each 1 ≤ <italic>b</italic> ≤ <italic>B</italic>, we have <inline-formula><mml:math id="M48"><mml:msubsup><mml:mi>ε</mml:mi><mml:mo>*</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>ε</mml:mi><mml:mrow><mml:mo>*</mml:mo><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>ε</mml:mi><mml:mrow><mml:mo>*</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mo>*</mml:mo></mml:msub></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, and <inline-formula><mml:math id="M49"><mml:mrow><mml:msubsup><mml:mi>ε</mml:mi><mml:mrow><mml:mo>*</mml:mo><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> is +1 with probability 1 - <italic>p</italic>
<sub>flip</sub> and is –1 otherwise for any 1 ≤ <italic>i</italic> ≤ <italic>n</italic>
<sub>*</sub>, where * is the placeholder for either x or y. The parameter <italic>p</italic>
<sub>flip</sub> (denoted as <monospace>flip_;prob</monospace> in MARIO package and defaulted to 0.2) controls the “sensitivity” of the test — a lower value of <italic>p</italic>
<sub>flip</sub> means that a more accurate matching is needed to pass the matchability test. For every <italic>b</italic>, we generate a fake pair of datasets by flipping the signs of each row of <italic>X</italic> and <italic>Y</italic>: <disp-formula id="FD14"><mml:math id="M50"><mml:msup><mml:mi>X</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mtext>diag</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>ε</mml:mi><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>X</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.8em"/><mml:msup><mml:mi>Y</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mtext>diag</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>ε</mml:mi><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>Y</mml:mi><mml:mo>.</mml:mo></mml:math></disp-formula>
</p><p id="P50">After such a sign-flipping procedure, the majority of the correlation (i.e., the inter-dataset covariance structure) between <italic>X</italic> and <italic>Y</italic>, if exists, is destroyed. On the other hand, the intradataset covariance structures of both <italic>X</italic> and <italic>Y</italic> are preserved.</p><p id="P51">As a result, if we run any matching algorithm with <italic>X</italic>
<sup>(<italic>b</italic>)</sup> and <italic>Y</italic>
<sup>(<italic>b</italic>)</sup> as the input, the resulting estimator <inline-formula><mml:math id="M51"><mml:msup><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> would be of low quality, in the sense that if we align <italic>X</italic>
<sup>(<italic>b</italic>)</sup>, <italic>Y</italic>
<sup>(<italic>b</italic>)</sup> using <inline-formula><mml:math id="M52"><mml:msup><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> and run CCA, the resulting sample canonical correlations will be small. In our implementation, we calculate the mean of <monospace>top_;k</monospace>, and defaulted to 10), which we denote as <inline-formula><mml:math id="M53"><mml:msubsup><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mi>ô</mml:mi><mml:msup><mml:mi>r</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:msubsup></mml:math></inline-formula>.</p><p id="P52">The matchability test proceeds by running the same algorithm on the real datasets <italic>X, Y</italic>, aligning them using the estimator <inline-formula><mml:math id="M54"><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, and calculate the mean of <monospace>top_;k</monospace> sample canonical correlations, which we denote as cor. The final <italic>p</italic>-value for testing the null that <italic>X</italic> and <italic>Y</italic> are uncorrelated is given by the proportion of <inline-formula><mml:math id="M55"><mml:msubsup><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mi>ô</mml:mi><mml:msup><mml:mi>r</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:msubsup></mml:math></inline-formula> that are larger than the observed côr.</p></sec><sec id="S15"><title>Jointly regularized filtering of low-quality matched pairs</title><p id="P53">Even if the two datasets <italic>X</italic> and <italic>Y</italic> are highly correlated (and thus the matchability test gives a small <italic>p</italic>-value), the estimated matching <inline-formula><mml:math id="M56"><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> might still be error-prone. This could happen, for example, when certain cell types exist in <italic>X</italic> but are completely absent in <italic>Y</italic>. We develop an algorithm that automatically filters out the low-quality matched pairs in <inline-formula><mml:math id="M57"><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>.</p><p id="P54">Assume there are <italic>K</italic> cell types present in either <italic>X</italic> or <italic>Y</italic>. In the MARIO package, we denote <italic>K</italic> = <monospace>n_;clusters</monospace> (default = 10). Let <italic>z</italic>
<sub>x</sub>, <italic>z</italic>
<sub>y</sub> ∈ {1,...,<italic>K</italic>}<sup><sub><italic>n</italic>x</sub></sup> be the unknown ground truth cell type labels of <italic>X</italic> and <inline-formula><mml:math id="M58"><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>
<italic>Y</italic>, respectively. The fact that <italic>X</italic> and <italic>Y</italic> have passed the matchability test tells that <italic>z</italic>
<sub>x</sub> and <italic>z</italic>
<sub>y</sub> should agree on most coordinates. However, it is entirely possible that there exists a sparse subset of {1,...,<italic>n</italic>
<sub>x</sub>} on which <italic>z</italic>
<sub>x</sub> and <italic>z</italic>
<sub>y</sub> disagree, and our goal is to detect this sparse subsei and disregard them in downstream analyses. To achieve this goal, we consider the following regularized <italic>k</italic>-means objective: <disp-formula id="FD15"><mml:math id="M59"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>⋆</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mtext>argmin</mml:mtext></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msubsup><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:mo>⊂</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>ν</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:mo>⊂</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mtext>share</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>z</mml:mi><mml:mo>*</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mtext>y</mml:mtext></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mi>K</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:msup></mml:mtd></mml:mtr></mml:mtable></mml:mtd></mml:mtr></mml:mtable></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>•</mml:mo></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mtext>x</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>‖</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>•</mml:mo></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>ν</mml:mi><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mtext>y</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>‖</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>+</mml:mo><mml:mi>log</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mtext>x</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≠</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mo>⋆</mml:mo><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mtext>y</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≠</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mo>⋆</mml:mo><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> where || · ||<sub>2</sub> is the <italic>ℓ</italic>
<sub>2</sub> norm and 1{·} is the indicator function, The above objective function is a superposition of two parts The first part is the classical <italic>k</italic>-means objective for <italic>X</italic> and <italic>Y</italic>, and the second part is a regularization term that imposes penalties when the estimated <italic>X</italic>-label <inline-formula><mml:math id="M60"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> and <italic>Y</italic>-label <inline-formula><mml:math id="M61"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> are too far-away from a “global” label <inline-formula><mml:math id="M62"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>*</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula>.</p><p id="P55">After solving the above objective function, if <inline-formula><mml:math id="M63"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>x,</mml:mtext><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≠</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>y,</mml:mtext><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, then there is evidence that the matched pair <inline-formula><mml:math id="M64"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>·</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>·</mml:mo></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is spurious, and is thus disregarded in the downstream analyses The parameter <italic>ρ</italic> controls the strength of regularization: if <italic>ρ</italic> =1 – 1<italic>/K</italic>, then there is no regularization at all, whereas if <italic>ρ</italic> = 0, we effectively require <inline-formula><mml:math id="M65"><mml:msub><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>*</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext></mml:msub></mml:math></inline-formula>. Thus, we can naturally control the “intensity” of such a filtering procedure by choosing a suitable <italic>ρ</italic>. In fact, under a hierarchical Bayesian model, the parameter <italic>ρ</italic> has a rather intuitive interpretation as the probability of disagreement between <italic>z</italic>
<sub>*,<italic>i</italic></sub> and <italic>z</italic>
<sub>x,<italic>i</italic></sub> (or between <italic>z</italic>
<sub>*,<italic>i</italic></sub> and <italic>z</italic>
<sub>y,<italic>i</italic></sub>) (<xref ref-type="bibr" rid="R77">77</xref>). If the model is correctly specified, then the expected proportion that should be filtered out is given by <inline-formula><mml:math id="M66"><mml:mrow><mml:mtext>bad</mml:mtext><mml:mo>_;</mml:mo><mml:mtext>prop=1</mml:mtext><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>.</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>.</p><p id="P56">We solve the regularized <italic>k</italic>-means objective via a warm- started block coordinate descent algorithm. The algorithm starts by computing initial estimators <inline-formula><mml:math id="M67"><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula>, <inline-formula><mml:math id="M68"><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> of <italic>z</italic>
<sub>x</sub>, <italic>z</italic>
<sub>y</sub> via spectral clustering (<xref ref-type="bibr" rid="R80">80</xref>): we compute the sample canonical scores of <italic>X</italic> and <inline-formula><mml:math id="M69"><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>Y</mml:mi></mml:math></inline-formula>, average them, and apply the classical <italic>k</italic>-means clustering on top <italic>K</italic> eigenvectors of the averaged score to get <inline-formula><mml:math id="M70"><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>K</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula>. We then let <inline-formula><mml:math id="M71"><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:math></inline-formula>. The number of canonical scores to keep is denoted as <monospace>n_;components_;filter</monospace> in the MAIRO package (default = 10).</p><p id="P57">Suppose at iteration <italic>t,</italic> the current estimators of <italic>z</italic>
<sub>x</sub>, <italic>z</italic>
<sub>y</sub> are given by <inline-formula><mml:math id="M72"><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula>, <inline-formula><mml:math id="M73"><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula>, respectively. We run block coordinate descent as follows:</p><list list-type="order" id="L1"><list-item><p id="P58">Given <inline-formula><mml:math id="M74"><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula>, <inline-formula><mml:math id="M75"><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula>, the current estimators of {<italic>μ<sub>k</sub></italic>}, {<italic>ν<sub>k</sub></italic>} are given by <disp-formula id="FD16"><mml:math id="M76"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msubsup><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo><mml:mrow><mml:msubsup><mml:mrow/><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle><mml:mn>1</mml:mn><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>x</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:munderover><mml:mn>1</mml:mn></mml:mstyle><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>x</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:msub><mml:mo>.</mml:mo><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mstyle displaystyle="true"><mml:mo>∑</mml:mo><mml:mrow><mml:msubsup><mml:mrow/><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle><mml:mn>1</mml:mn><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>y</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:munderover><mml:mn>1</mml:mn></mml:mstyle><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>y</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula>
</p></list-item><list-item><p id="P59">Given <inline-formula><mml:math id="M77"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="M78"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>, the next estimators of <italic>z<sub>*</sub>, z</italic>
<sub>x</sub>, <italic>z</italic>
<sub>y</sub> are given by <disp-formula id="FD17"><mml:math id="M79"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>⋆</mml:mo><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>x</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>y</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>⋆</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mtext>y</mml:mtext></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mrow><mml:mo>{</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mi>K</mml:mi><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:munder></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>∥</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>⋅</mml:mo></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mtext>x</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msubsup><mml:mo>∥</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mo>∥</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mo>⋅</mml:mo></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>ν</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mtext>y</mml:mtext></mml:msub><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msubsup><mml:mo>∥</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>+</mml:mo><mml:mi>log</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mtext>x</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≠</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mo>⋆</mml:mo><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mtext>y</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>≠</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mo>⋆</mml:mo><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> for any 1 ≤ <italic>i</italic> ≤ <italic>n</italic>
<sub>x</sub>. The above problem is solved via a careful enumeration procedure. We first hypothesize that <inline-formula><mml:math id="M80"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo>⋆</mml:mo><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:math></inline-formula> for some 1 ≤ <italic>k</italic> ≤ <italic>K</italic>. Given this hypothesis, we can solve for the best <inline-formula><mml:math id="M81"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>x</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> by enumerating all <italic>K</italic> possible choices of labels. The same thing can be done to solve for the best <inline-formula><mml:math id="M82"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>y</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>. Hence, we can compute the best value of the above objective function under the hypothesis that <inline-formula><mml:math id="M83"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>*</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> = <italic>k</italic>. We can then solve for the global optimal <inline-formula><mml:math id="M84"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>*</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> by enumerating and comparing the objective values under every possible hypothesized value of <inline-formula><mml:math id="M85"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>*</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> = 1,...,<italic>K</italic>. Given the global optimal <inline-formula><mml:math id="M86"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>*</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>, the global optimal <inline-formula><mml:math id="M87"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>x</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M88"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>z</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mtext>y</mml:mtext><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> can be easily extracted.</p></list-item></list><p id="P60">In our implementation, we run the above block coordinate descent procedure for 20 iterations.</p></sec><sec id="S16"><title>Downstream analysis after cell matching</title><sec id="S17"><title>Joint embedding</title><p id="P61">After running jointly regularized filtering on the best interpolated estimator <inline-formula><mml:math id="M89"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:msub></mml:mrow></mml:math></inline-formula>, we get a pair of aligned datasets <inline-formula><mml:math id="M90"><mml:msup><mml:mi>X</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula>, <inline-formula><mml:math id="M91"><mml:msup><mml:mi>Y</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>y</mml:mtext></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula>, whose rows correspond to cells of similar types and <italic>n</italic> is the number of remaining cell-cell pairs after filtering. Then, we run CCA on <italic>X<sup>*</sup>,Y<sup>*</sup></italic> and collect the first n pairs of sample canonical scores (scaled within dataset) as the final embeddings. Since the rows of <italic>X<sup>*</sup></italic> and <italic>Y<sup>*</sup></italic> are approximately aligned, other standard methods for joint embedding (e.g., partial least squares) can also be applied.</p></sec><sec id="S18"><title>Label transfer via k-NN matching</title><p id="P62">The interpolated distance <inline-formula><mml:math id="M92"><mml:msub><mml:mi>D</mml:mi><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:msub></mml:math></inline-formula> can be used to do label transfer via <italic>k</italic>-nearest-neighbors. Suppose we know the cell type labels for all cells in <italic>Y</italic> but the corresponding labels for cells in <italic>X</italic> is missing. Then for the <italic>i</italic>-th cell in <italic>X</italic>, we can predict its label by finding the <italic>k</italic>-nearest cells (we denote <italic>k</italic> = knn in the MARIO package) in <italic>Y</italic> according to <inline-formula><mml:math id="M93"><mml:msub><mml:mi mathvariant="script">D</mml:mi><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:msub></mml:math></inline-formula> and taking the majority vote.</p></sec></sec><sec id="S19"><title>Extensions</title><sec id="S20"><title>Matching more than two datasets</title><p id="P63">Suppose we have <italic>L</italic> datasets <inline-formula><mml:math id="M94"><mml:msub><mml:mi>X</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>×</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mtext>1</mml:mtext></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula>, …, <inline-formula><mml:math id="M95"><mml:msub><mml:mi>X</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo>×</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula>. For 2 ≤ <italic>ℓ</italic> ≤ <italic>L</italic>, we run the usual two-dataset procedure to estimate the matching between cells in <italic>X</italic>
<sub>1</sub> and cells in <italic>X<sub>ℓ</sub></italic> by <inline-formula><mml:math id="M96"><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mn>1</mml:mn><mml:mo>↔</mml:mo><mml:mi>ℓ</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula>. We then run jointly regularized filtering on each <inline-formula><mml:math id="M97"><mml:msub><mml:mover accent="true"><mml:mi>Π</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mn>1</mml:mn><mml:mo>↔</mml:mo><mml:mi>ℓ</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> separately and keep the cells in <italic>X</italic>
<sub>1</sub> that survive all <italic>L</italic> – 1 rounds of filtering. This gives us a cell-to-cell matching among the <italic>L</italic> datasets, from which we can construct row-wise aligned datasets <inline-formula><mml:math id="M98"><mml:msubsup><mml:mi>X</mml:mi><mml:mn>1</mml:mn><mml:mo>*</mml:mo></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula>, …, <inline-formula><mml:math id="M99"><mml:msubsup><mml:mi>X</mml:mi><mml:mi>L</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>×</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>L</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> where <italic>n</italic> is the number cells in <italic>X</italic>
<sub>1</sub> that survived all <italic>L</italic> – 1 rounds of filtering.</p><p id="P64">To jointly embed all the aligned datasets, we use generalized canonical correlation analysis (gCCA) (<xref ref-type="bibr" rid="R81">81</xref>). It is well known that gCCA does not admit a unique formulation (<xref ref-type="bibr" rid="R82">82</xref>). We take the following formulation which best suits our goal of obtaining joint embeddings: <disp-formula id="FD18"><mml:math id="M100"><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>ℓ</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>ℓ</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>L</mml:mi></mml:msubsup><mml:msubsup><mml:mo>=</mml:mo><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mi>ℓ</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msup><mml:mtext>R</mml:mtext><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>h</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>ℓ</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>×</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msup></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mspace width="0.8em"/><mml:mo>∀</mml:mo><mml:mn>1</mml:mn><mml:mo>≤</mml:mo><mml:mi>ℓ</mml:mi><mml:mo>≤</mml:mo><mml:mi>L</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mrow><mml:mspace width="0.8em"/><mml:mi>arg</mml:mi><mml:mi>min</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∑</mml:mo><mml:mrow><mml:mi>ℓ</mml:mi><mml:mo>≠</mml:mo><mml:msup><mml:mi>ℓ</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:munder><mml:mrow><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mi>ℓ</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:msub><mml:mi>W</mml:mi><mml:mi>ℓ</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:msup><mml:mi>ℓ</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>*</mml:mo></mml:msubsup><mml:msub><mml:mi>W</mml:mi><mml:msup><mml:mi>ℓ</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub><mml:mo>|</mml:mo><mml:msubsup><mml:mo>|</mml:mo><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mstyle></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mtext>subjet</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>to</mml:mtext><mml:mspace width="0.2em"/><mml:msubsup><mml:mi>W</mml:mi><mml:mi>ℓ</mml:mi><mml:mtext>T</mml:mtext></mml:msubsup><mml:msub><mml:mover accent="true"><mml:mo>∑</mml:mo><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>ℓ</mml:mi><mml:mi>ℓ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>W</mml:mi><mml:mi>ℓ</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>I</mml:mi><mml:msub><mml:mo/><mml:mi>r</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:msub><mml:mover accent="true"><mml:mo>∑</mml:mo><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>ℓ</mml:mi><mml:mi>ℓ</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>ℓ</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mtext>T</mml:mtext></mml:msup><mml:msubsup><mml:mi>X</mml:mi><mml:mi>ℓ</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:mrow><mml:mi>n</mml:mi></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> where || · ||<italic><sub>F</sub></italic> is the Frobenius norm, 1 ≤ <italic>r</italic> ≤ <italic>p</italic>
<sub>share</sub> + min<italic>ℓ p<sub>ℓ</sub></italic> is the number of components to keep, and <inline-formula><mml:math id="M101"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>ℓ</mml:mi></mml:msub><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>ℓ</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> is the embedding for the <italic>ℓ</italic>-th dataset.</p><p id="P65">To solve the above optimization problem, we take a block coordinate descent approach. This approach again needs preliminary estimators <inline-formula><mml:math id="M102"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>. To obtain those preliminary estimators, we first run the classical CCA on the first two datasets and obtain the projection matrices <inline-formula><mml:math id="M103"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>, <inline-formula><mml:math id="M104"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>, so that <inline-formula><mml:math id="M105"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mn>1</mml:mn><mml:mo>*</mml:mo></mml:msubsup><mml:msubsup><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M106"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mn>2</mml:mn><mml:mo>*</mml:mo></mml:msubsup><mml:msubsup><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> are the sample canonical scores for <inline-formula><mml:math id="M107"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mn>1</mml:mn><mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M108"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mn>2</mml:mn><mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula>, respectively. Then, for each <italic>ℓ</italic> ≥ 3, we run least squares regression using <inline-formula><mml:math id="M109"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mn>1</mml:mn><mml:mo>*</mml:mo></mml:msubsup><mml:msubsup><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>X</mml:mi><mml:mn>2</mml:mn><mml:mo>*</mml:mo></mml:msubsup><mml:msubsup><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:math></inline-formula> as the response and <inline-formula><mml:math id="M110"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>l</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> as the feature matrix. The resulting regression coefficient is then taken to be <inline-formula><mml:math id="M111"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>.</p><p id="P66">Given the preliminary estimators, we are ready to enter the block coordinate descent iteration. We first demonstrate how to solve for the first columns of <inline-formula><mml:math id="M112"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Suppose at iteration <italic>t</italic>, we are given preliminary estimators <inline-formula><mml:math id="M113"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="M114"><mml:msubsup><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula>. We then proceed as follows. For every 1 ≤ ℓ ≤ <italic>m</italic>, we run a least squares regression with the response being the current average scores (not counting <italic>ℓ</italic> itself), i.e., <inline-formula><mml:math id="M115"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Σ</mml:mi><mml:mrow><mml:msup><mml:mi>l</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>&lt;</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msup><mml:mi>l</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>&lt;</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msub><mml:mi>Σ</mml:mi><mml:mrow><mml:msup><mml:mi>l</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>&gt;</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msup><mml:mi>l</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>&lt;</mml:mo><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:math></inline-formula>, and with the feature matrix being <inline-formula><mml:math id="M116"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula>. Denote the resulting regression coefficient as <inline-formula><mml:math id="M117"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>. We take <inline-formula><mml:math id="M118"><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>/</mml:mo><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>|</mml:mo><mml:msub><mml:mo>|</mml:mo><mml:mn>2</mml:mn></mml:msub></mml:math></inline-formula>. We run the above procedure for 500 iterations and let <inline-formula><mml:math id="M119"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> be the first columns of <inline-formula><mml:math id="M120"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>.</p><p id="P67">We now discuss how to solve for the <italic>j</italic>-th columns of <inline-formula><mml:math id="M121"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>, where <italic>j</italic> ≥ 2. We start by running a least squares regression with <inline-formula><mml:math id="M122"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>l</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> being the response and the first <italic>j</italic> – 1 scores of <inline-formula><mml:math id="M123"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>l</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> (i.e., <inline-formula><mml:math id="M124"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mn>1</mml:mn><mml:mo>*</mml:mo></mml:msubsup><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>·</mml:mo><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="M125"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>·</mml:mo><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo>:</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is the first <italic>j</italic> – 1 columns of <inline-formula><mml:math id="M126"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>) being the feature matrix. The residual of this regression is denoted as <inline-formula><mml:math id="M127"><mml:msubsup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>j</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:math></inline-formula>. Now suppose at iteration <italic>t</italic>, we are given preliminary estimators <inline-formula><mml:math id="M128"><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>j</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="M129"><mml:msubsup><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mtext>share</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula>. We proceed as follows. For every 1 ≤ ℓ ≤ <italic>L</italic>, we run a least squares regression with the response being <inline-formula><mml:math id="M130"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>Σ</mml:mi><mml:mrow><mml:msup><mml:mi>l</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>&lt;</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:msubsup><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msub><mml:mi>Σ</mml:mi><mml:mrow><mml:msup><mml:mi>l</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>&gt;</mml:mo><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:msubsup><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:msup><mml:mi>l</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>L</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:math></inline-formula>, and with the feature matrix being <inline-formula><mml:math id="M131"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>l</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. Denote the resulting regression coefficient as <inline-formula><mml:math id="M132"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>. We then run a least squares regression with the response being <inline-formula><mml:math id="M133"><mml:msubsup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mo>*</mml:mo></mml:msubsup><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>/</mml:mo><mml:mo>|</mml:mo><mml:mo>|</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>/</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mo>|</mml:mo><mml:mn>2</mml:mn></mml:msub></mml:math></inline-formula> and the feature matrix being <inline-formula><mml:math id="M134"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>l</mml:mi><mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula>. The resulting regression coefficient is taken to be <inline-formula><mml:math id="M135"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>. We run the above procedure for 500 iterations and let <inline-formula><mml:math id="M136"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> be the <italic>j</italic>-th columns of <inline-formula><mml:math id="M137"><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>W</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p></sec><sec id="S21"><title>Speeding up cell matching via distance sparsification</title><p id="P68">Standard implementations of the one-to-one matching run in <inline-formula><mml:math id="M138"><mml:mi mathvariant="script">O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>3</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> time. However, if the distance matrix <inline-formula><mml:math id="M139"><mml:mi>D</mml:mi></mml:math></inline-formula> is sparse (i.e., a lot of entries are infinity, meaning that such a pair is a priori infeasible), then the time complexity can further be reduced. For example, if one regards the distance matrix as a bipartite graph and let (<italic>i,j</italic>) denote an edge if <inline-formula><mml:math id="M140"><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> &lt; ∞, then it is possible to solve the problem in <inline-formula><mml:math id="M141"><mml:mover accent="true"><mml:mi mathvariant="script">O</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:math></inline-formula>((<italic>n</italic>
<sub>x</sub> + <italic>n</italic>
<sub>y</sub>)|<italic>E</italic>|) time, where |<italic>E</italic>| is the number of edges and <inline-formula><mml:math id="M142"><mml:mover accent="true"><mml:mi mathvariant="script">O</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:math></inline-formula> hides poly-log factors (<xref ref-type="bibr" rid="R83">83</xref>).</p><p id="P69">A natural attempt is to manually sparsify <inline-formula><mml:math id="M143"><mml:mi>D</mml:mi></mml:math></inline-formula> so that for each row, only <italic>k</italic> ≪ <italic>n</italic>
<sub>y</sub> smallest entries are finite. Let <inline-formula><mml:math id="M144"><mml:msup><mml:mi>D</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> be the sparsified matrix. In theory, there exists a critical value of <italic>k*</italic> such that: (<xref ref-type="bibr" rid="R1">1</xref>) the distance matrix <inline-formula><mml:math id="M145"><mml:msup><mml:mi>D</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k*</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> can give a valid matching; and (<xref ref-type="bibr" rid="R2">2</xref>) if one sparsifies it further (i.e., use <inline-formula><mml:math id="M146"><mml:msup><mml:mi>D</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> for <italic>k</italic> &lt; <italic>k</italic>*), then there is no valid matching. We give an algorithm for computing this critical value. For any fixed <italic>k</italic>, we can test if <inline-formula><mml:math id="M147"><mml:msup><mml:mi>D</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>k</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> can give a valid matching by computing the maximum-cardinality matching, which can be done in <inline-formula><mml:math id="M148"><mml:mi mathvariant="script">O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:msqrt><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:msqrt></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> time using the Hopcroft–Karp algorithm (<xref ref-type="bibr" rid="R84">84</xref>). We can then use binary search to search for the critical value <italic>k*</italic>. In the worst case (i.e., when <italic>k*</italic> = <italic>n</italic>
<sub>y</sub>), the whole procedure runs in <inline-formula><mml:math id="M149"><mml:mi mathvariant="script">O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub><mml:msqrt><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow></mml:msqrt></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> time, which is already much faster than the <inline-formula><mml:math id="M150"><mml:mi mathvariant="script">O</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>x</mml:mtext></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mtext>y</mml:mtext></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>3</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> time needed to compute the matching using the original distance matrix. In practice, since <italic>k*</italic> is usually very small compared to <italic>n</italic>
<sub>y</sub>, the running time of the whole procedure can be even faster. This procedure generalizes the strategy taken by (<xref ref-type="bibr" rid="R85">85</xref>), which only works when the distance matrix is computed using a single feature.</p><p id="P70">Given the knowledge of <italic>k*</italic>, we sparsify the distance matrix with some user-specified <italic>k</italic> ≥ <italic>k*</italic> (denoted as <monospace>sparsity</monospace> in the MARIO package) and apply the LAPJVsp algorithm (an algorithm specifically designed to tackle sparse inputs) (<xref ref-type="bibr" rid="R86">86</xref>) to compute the matching.</p><p id="P71">In practice, we can further speed up the matching process by randomly splitting the data into <italic>n</italic> (in MARIO package denoted as <monospace>n_;batch</monospace>) evenly-sized batches, computing the matching for each batch, and stitching the batch-wise matchings together.</p></sec></sec><sec id="S22"><title>Details on data pre-processing and analysis</title><sec id="S23"><title>Code and data availability</title><p id="P72">MARIO and related tutorials are freely available to the public at GitHub: <ext-link ext-link-type="uri" xlink:href="https://github.com/shuxiaoc/mario-py">https://github.com/shuxiaoc/mario-py</ext-link>. Data and Code to regenerate the main and supplementary figures are also deposited to GitHub.</p></sec><sec id="S24"><title>Preprocessing and analysis of human bone marrow datasets</title><p id="P73">CyTOF data measuring 32 proteins in healthy human bone marrow cells from levine et al (<xref ref-type="bibr" rid="R32">32</xref>)) was downloaded from GitHub <ext-link ext-link-type="uri" xlink:href="https://github.com/lmweber/benchmark-data-Levine-32-dim">https://github.com/lmweber/benchmark-data-Levine-32-dim</ext-link>.</p><p id="P74">Cells gated as HSPCs, CD4 T cell, CD8 T cell, B cell, monocyte, NK cell and pDC from the paper were selected and a total of 102,977 cells were used. CITE-seq dataset measuring 25 proteins and RNA expression of healthy human bone marrow cells was acquired using <monospace>bmcite</monospace> in the R package <monospace>SeuratData</monospace>. Cells annotated as HSPCs, CD4 T cell, CD8 T cell, B cell, monocyte, NK cell, and pDC from the paper, comprising a total of 29,007 cells, were used. During matching, CITE-seq cells were used to match against CyTOF cells, where the input of CITE-seq cells were prenormalized counts from bmcite and the input of CyTOF cells were values with arcsine transformation (cofactor = 5). The MARIO parameters used are <monospace>n_;components_;ovlp</monospace> = 10, <monospace>n_;components_;all</monospace> = 20, <monospace>sparsity</monospace> = 1000, <monospace>bad_;prop</monospace> = 0.2, and <monospace>n_;batch</monospace> = 4.</p><p id="P75">t-SNE plots were generated using the scaled shared protein features across datasets (pre-integration) or the first 10 components for the CCA scores (MARIO integration), using the <monospace>Rtsne()</monospace> function with default settings in R package <monospace>Rtsne</monospace>. The heatmap was produced using <monospace>heatmap.2()</monospace> in the R package <monospace>gplots</monospace>, with z-scaled CITE-seq and CyTOF protein expression levels. The matched or original values of protein/RNA overlaid with t-SNE plots were generated with the function <monospace>Featureplot()</monospace> in R package <monospace>Seurat</monospace>. The detailed process of benchmarking MARIO against other methods is further described in the Benchmarking section in the Supplementary Methods section.</p></sec><sec id="S25"><title>Preprocessing and analysis of cross species H1N1/IFN gamma challenged datasets</title><p id="P76">CyTOF data measuring 42 proteins in blood cells from humans challenged with H1N1 (<xref ref-type="bibr" rid="R40">40</xref>) virus was acquired from flow repository FR-FCM-Z2NZ 39. Three donors were used (id = “101”, “107”, “108”). The dataset was randomly downsampled to 120,000 cells, arcsine transformed with cofactor = 5, and subsequently clustered via the default <monospace>Seurat</monospace> clustering pipeline with all available antibody markers. Cell types were then manually annotated based on their expression profile. A total of 102,147 annotated cells were used. CyTOF data measuring 39 proteins of whole blood cells from human, rhesus macaque and cynomolgus monkey challenged with Interferon gamma (<xref ref-type="bibr" rid="R37">37</xref>) were acquired from flow repository FRFCM-Z2ZY 35. Three donors of each species (human: “7826”, “7718”, “2810”; rhesus macaque: “D00522”, “D06022”, “D06122”; cynomolgus monkey: “D07282”, “D07292”, “D07322”) were used. Cells gated as Erythrocytes, Platelets and CD4+CD8+ cells in the paper were excluded from downstream analysis. Each individual dataset was randomly downsampled to 120,000 cells, arcsine transformed with cofactor = 5, then clustered with Seurat using all the markers, followed by manually annotation and then removal of cells with ambiguous annotations. Total cell numbers for matching were 114,175 (human); 112,218 (rhesus macaque); 91,409 (cynomolgus monkey). During matching, human H1N1 challenged cells were matched against human, rhesus macaque and cynomolgus monkey IFN gamma-stimulated cells separately, and cells that matched across all four datasets were used for downstream analysis. The MARIO parameters used are <monospace>n_;components_;ovlp</monospace> = 20, <monospace>n_;components_;all</monospace> = 15, <monospace>sparsity</monospace> = 1000, <monospace>bad_;prop</monospace> = 0.1, and <monospace>n_;batch</monospace> = 4.</p><p id="P77">The t-SNE plot was produced by the scaled shared protein features across the dataset (pre-integration) or the first 10 components of the generalized CCA scores (MARIO integration), using the <monospace>Rtsne()</monospace> function with default setting in R package <monospace>Rtsne</monospace>. For visualization purposes, cell numbers were downsampled to 20,000 each dataset (80,000 cells in total) for t-SNE visualization. Euclidean distances between matched cells were calculated based on the integrated generalized CCA scores. Accuracy for MARIO matching results among cell types was generated by 5 repeated measurements on a randomly subsampled 5000 matched cells, and the balanced accuracy was calculated with the function <monospace>confusionMatrix()</monospace> in the R package <monospace>caret</monospace>. The expression level of Ki-67, pSTAT1 and p38 overlaid on each individual dataset’s t-SNE plots was produced with the function <monospace>Featureplot()</monospace> in R package <monospace>Seurat</monospace>. Violin plots were produced based on normalized <monospace>(scale()</monospace> function, within each dataset) values of Ki-67, pSTAT1, and p38 for Monocytes, CD4 T cells subpopulations with <monospace>ggplot2</monospace>.</p></sec><sec id="S26"><title>Preprocessing and analysis of murine spleen datasets</title><p id="P78">Tiff files of CODEX multiplexed imaging data for BALBc mouse spleen, with 29 antibodies, were acquired (<xref ref-type="bibr" rid="R13">13</xref>) (sample ID: ‘balbc-1’). Segmentation was performed with a local implementation of Mesmer (<xref ref-type="bibr" rid="R87">87</xref>), with weights downloaded from: <ext-link ext-link-type="uri" xlink:href="https://deepcell-data.s3-us-west-1.1amazonaws.com/model-weights/Multiplex_;Segmentation_;20200908_;2_;head.h5">https://deepcell-data.s3-us-west-1.1amazonaws.com/model-weights/Multiplex_;Segmentation_;20200908_;2_;head.h5</ext-link>. Inputs of segmentation were DRAQ5 (nuclear) and CD45 (membrane). Signals from the images were capped at 99.7th percentile, with prediction parameter <monospace>model_;mpp</monospace> = 0.8. Lateral spillover signals were cleaned using REDSEA (<xref ref-type="bibr" rid="R88">88</xref>) with the whole cell compensation flag as previously described. To clean out aggregated B220 signals in the dataset, B220 signal inside the cytoplasm (defined by 7 pixels towards the inside of the cell boundary), was removed. Afterwards, cells with DRAQ5 signal value less than 80 were removed and signals were scaled to 0-1, with percentile cut-offs of 0.5% (floor) and 99.5% (ceiling). Cells were subsequently clustered via <monospace>Seurat</monospace>, using CODEX markers: CD45, Ly6C, TCR, Ly6G, CD19, CD169, CD3, CD8a, F480, CD11c, CD27, CD31, CD4, IgM, B220, ERTR7, MHCII, CD35, CD2135, NKp46, CD1632, CD90, CD5, CD79b, IgD, CD11b, CD106. Another round of sub-clustering was then performed for dendritic cells, and macrophage populations before manual annotation of clusters. A total of 48,332 cells labeled as B cell, CD4 T cell, CD8 T cell, Dendritic cell, Macrophage, Monocyte, Neutrophil, and NK cells were used for MARIO matching. CITE-seq data 45 of murine spleen/lymph node samples from a panel of 206 antibodies were downloaded from GitHub: <ext-link ext-link-type="uri" xlink:href="https://github.com/YosefLab/totalVI_;reproducibility/tree/master/data">https://github.com/YosefLab/totalVI_;reproducibility/tree/master/data</ext-link>. Only B, CD4 T cell, CD8 T cell, dendritic, macrophage, neutrophil, and NK cells originating from the spleen, a total of 7601 cells, were used. For matching, the input of CODEX cells are post-compensated, aggregation corrected values, excluding the Ter119 red blood cell channel. CITE-seq input were the downloaded raw counts. The CITE-seq dataset was duplicated to improve the matchability, and CODEX cells subsequently matched against CITE-seq cells, with MARIO parameters: <monospace>n_;components_;ovlp</monospace> = 20, <monospace>n_;components_;all</monospace> = 15, <monospace>sparsity</monospace> = 1000, <monospace>bad_;prop</monospace> = 0.05, <monospace>n_;batch</monospace> = 32, <monospace>knn</monospace> = 15.</p><p id="P79">The t-SNE plots were produced using the scaled, shared protein features across datasets (pre-integration) or the first 101 components for the CCA scores (MARIO integration), using the <monospace>Rtsne()</monospace> function with default settings in R package <monospace>Rtsne</monospace>. For visualization purposes, both datasets were downsampled to 8000 matched cells from each modality (16,000 cells in total) for t-SNE plotting. Pseudo-images of the CODEX murine spleen were colored by their cell-type annotations (Cell type based on CODEX protein annotation; Label transfering from CITE-seq annotation) and matched RNA expression levels. The label transfer of CITE-seq annotation shown in the figure was done using <italic>k</italic>-NN (<italic>k</italic> = 15) on the MARIO distance matrix, to ensure all CODEX cells have an annotation. The RNA expression value for pseudo-imaging plotting was capped to the 80% percentile (values equal to 0 were omitted) of that gene. For gating of B cell subtypes, CODEX proteins B220, CD19, IgM, IgD, CD21/35 and MHCII were used, and manually gated in cellengine <ext-link ext-link-type="uri" xlink:href="https://cellengine.com/">https://cellengine.com/</ext-link>. Heatmaps of matched RNA expression level of CODEX B cell subpopulations was produced via the function <monospace>DoHeatmap()</monospace> in the R package <monospace>Seurat</monospace>, with top 50 differentially expressed genes identified in each subpopulation, via the function <monospace>FindAllMarkers()</monospace> in <monospace>Seurat</monospace>.</p></sec><sec id="S27"><title>COVID-19 human tissue specimen collection</title><p id="P80">Lung tissues from patients who succumbed to COVID-19 were obtained during autopsy at the University Hospital Basel, Switzerland. Tissues were processed as previously described (<xref ref-type="bibr" rid="R89">89</xref>) and collection was approved by the ethics commission of Northern Switzerland (EKNZ; study ID #2020-00969). All patients or their relatives consented to the use of tissue for research purposes. Tissue microarrays were generated from these tissue samples in-house at the University Hospital Basel, Switzerland.</p></sec><sec id="S28"><title>Preprocessing and analysis of COVID patient macrophage datasets</title><p id="P81">CODEX on COVID-19 samples from University Hospital Basel: CODEX acquisition of the COVID-19 tissue microarrays were performed, and post-processing and cell type annotation executed as previously described (<xref ref-type="bibr" rid="R90">90</xref>, <xref ref-type="bibr" rid="R91">91</xref>). Data from 23 COVID-19 patients (76 tissue cores; manuscript in preparation) were acquired, and a total of 62,852 macrophages that were annotated were used for MARIO matching. Processed counts of CITE-seq data acquired with a panel of 250 antibodies from bronchoalveolar lavage fluid washes from COVID-19 patients (VIB/Ghent University Hospital) was acquired from COVID-19 Cell At- las59. Cells from 7 COVID-19 patients (COV002; COV013; COV015; COV024; COV034; COV036; COV037) were selected, clustered, and manually annotated on a per patient level based on their protein features, using Seurat as previously described. A total of 16,090 macrophages were annotated and used for subsequent MARIO matching. During MARIO matching, CODEX macrophages were matched against CITE-seq macrophages, with the MARIO running parameters: <monospace>n_;components_;ovlp</monospace> = 25, <monospace>n_;components_;all</monospace> = 25, <monospace>sparsity</monospace> = 1000, <monospace>bad_;prop</monospace> = 0.1, and <monospace>n_;batch</monospace> = 20.</p><p id="P82">CODEX macrophages were clustered based on their matched <italic>C1Q</italic> mRNA expression levels (C1QA, <italic>C1QB</italic> and <italic>C1QC</italic>) using the function <monospace>hcut()</monospace> with k = 2 and stand = TRUE in the R package <monospace>factoextra</monospace>. Heatmaps were produced with the scaled values from CITE-seq or CODEX, via function <monospace>heatmap.2()</monospace> in R package <monospace>gplots</monospace>. Cell-cell interaction and binned anchor analysis were performed as previously described 25. In brief, for each individual <italic>C1Q</italic> High or Low macrophage, the Delaunay triangulation for neighboring cells (within 100μm) was calculated based on the XY position with the <monospace>deldir</monospace> R package. To establish a baseline distribution of the distances, cells were randomly assigned to existing XY positions, for 1000 permutations. The baseline distribution of the distance was then compared to the observed distances using a Wilcoxon test. The log2 fold enrichment of observed mean over expected mean for each interaction type was plotted for interactions with a p-value &lt; 0.05. For the binned anchor analysis of <italic>C1Q</italic> High or Low macrophages, all cells within a 100μm range were extracted and the average percentage of specific cell types in each radius bin (in 16.66um increments) were calculated and plotted. Differential expression gene analysis was performed using the function <monospace>FindMarkers()</monospace> in the R package <monospace>Seurat</monospace>. The violin plot of DE genes were created with <monospace>ggplot2</monospace>, where mRNA expression values were normalized between 0-1 for visualization purposes. GO term analysis was conducted via the Gene Ontology tool (<xref ref-type="bibr" rid="R92">92</xref>, <xref ref-type="bibr" rid="R93">93</xref>) (with the biological process option activated), with the input as lists of genes that were either significantly upregulated in <italic>C1Q</italic> High or Low macrophages. Heatmaps of the expression pattern of differentially expressed ISG genes (identified via <monospace>FindMarkers()</monospace>), filtered using a list of 628 ISGs with functional annotations 67 in macrophages, was plotted with the function <monospace>heatmap.2()</monospace> from the R package <monospace>gplots</monospace>. Correlations between <italic>C1QA</italic> macrophage percentages and neutrophil percentages were calculated with the R function <monospace>cor()</monospace> with method <monospace>spearman</monospace>.</p></sec><sec id="S29"><title>PANINI Validation with COVID-19 Lung Tissue Samples</title><p id="P83">Protease-free combined ISH + antibody validation experiments using PANINI as previously described (<xref ref-type="bibr" rid="R25">25</xref>). In brief, TMA cores cut onto glass coverslips were baked at 70°C for, 1hr and then transferred to 2 × 5 min xylene washes, followed by deparaffinization steps 2 × 100% EtOH, 2 × 95% EtOH, 1 × 80% EtOH, 1 × 70% EtOH, 3× ddH2O; 3 min each. Heat induced epitope retrieval was then performed at 97°C for 10 min using the pH-9 Dako Target Retrieval Solution (Agilent, S236784-2) in a Lab Vision PT Module (Thermo Fisher Scientific). Slides were cooled to 65°C in the PT Module and then removed for equilibration to room temperature. A hydrophobic barrier was drawn around the tissue using the ImmEdge Hydrophobic Barrier pen (Vector Labs, 310018). Afterwards, endogenous peroxidase was inactivated using RNAscope Hydrogen Peroxide from the ACDBio RNAscope Multiplex Fluorescent Reagent Kit V2 (Biotechne, 323110), for 15 min at 40°C, followed by 2 × 2 min ddH2O washes. Coverslips were incubated overnight at 40°C (16 hrs) with RNAScope probes targeting human <italic>C1QA</italic> mRNA (Biotechne, 485451). Branch amplification was performed with Multiplex Amp 1, 2, 3 and HRP-CĻ in the V2 kit: Amp1 30 min at 40°C, Amp2 15 min at 40°C, Amp3 30 min at 40°C, HRP-C1 15 min at 40°C, with 2 × 2 min 0.5× RNAscope wash Buffer (Biotechne, 310091) washes between each steps. Coverslips were then incubated with TSA-Cy3 (Akoya Biosciences, NEL744001KT) in 1× RNAscope TSA Buffer at a 1:50 dilution, for 15 min at room temperature in the dark, followed by 2 × 2 min 0.5 × RNAscope wash Buffer washing. The coverslips were then washed 2 × 5 min with 1 × TBS-T, then subsequently blocked in Antibody Blocking Buffer (1 × TBS-T, 5% Donkey Serum, 0.1% Triton X-100, 0.05% Sodium Azide) for 1 hour. Antibody staining was next performed at 4°C overnight (16 hrs), with anti-CD15 (1:100 dilution, clone: MC480, Biolegend, 125602) and anti-CD68 (1:100 dilution, clone: D4B9C, Cell Signaling Technology, 76437T) in Antibody Dilution Buffer (1× TBS-T, 3% Donkey Serum, 0.05% Sodium Azide). After staining, coverslips were washed 3 × 10 min with 1× TBS-T, then incubated with secondary antibodies: Anti-Mouse-Cy7 (1:250, Biolegend, 405315) and Anti-Rabbit-Alexa647 (1:250, Thermo Fisher Scientific, A-21245) in Antibody Dilution Buffer for 30 min at room temperature. Coverslips were then washed 3 × 10 min with 1× TBS-T, stained with Hoechst 33342 (1:10000 in 1 × TBS-T, Thermo Fisher Scientific, H3570) for 10 min at room temperature, and mounted with ProLong™ Diamond Antifade Mountant (Thermo Fisher Scientific, P36961).</p><p id="P84">Images were collected using a Keyence BZ-X710 inverted fluorescent microscope (Keyence, Inc) configured with 4 fluorescent filters (Hoechst, Cy3, Cy5 and Cy7), and a CFI Plan Apo l 20x/0.75 objective (Nikon). The Imaging setting was: 3 × 5 tile per tissue core, 5 Z-stacks acquired each FOV (best focused plane used), with High Resolution setting. The exposures were: 1/50s (Hoechst), 1/250s (Cy3), 1/8s (Cy5), and 6s (Cy7). Segmentation was performed with a local implementation of Mesmer (<xref ref-type="bibr" rid="R87">87</xref>), with weights downloaded from: <ext-link ext-link-type="uri" xlink:href="https://deepcell-data.s3-us-west-1.amazonaws.com/model-weights/Multiplex_;Segmentation_;20200908_;2_;head.h5">https://deepcell-data.s3-us-west-1.amazonaws.com/model-weights/Multiplex_;Segmentation_;20200908_;2_;head.h5</ext-link>. Inputs of segmentation were Hoechst (nuclear) and <italic>C1QA</italic> + CD68 + CD15 (membrane). Signals from the images were capped at the 99.7th percentile, with prediction parameter <monospace>model_;mpp</monospace> = 0.8. Features from single cells in segmented Keyence images were extracted based on the segmentation generated above, scaled by cell size, and written out as FCS files. Cells were filtered out if too large (CellSize &gt; 500 pixels), too small (CellSize &lt; 45 pixels) or limited in nuclear signal (Hoechst &lt; 3500). The signal threshold of CD15, CD68 and <italic>C1QA</italic> positive cells were selected for each individual tissue core, and visually assessed to minimize false negative and false positive cells. Cells positive for CD68 and <italic>C1QA</italic> were annotated as <italic>C1Q</italic> High macrophages. The correlation of <italic>C1Q</italic> High macrophages between PANINI and CODEX experiments were calculated with the R function <monospace>cor()</monospace> with method <monospace>spearman</monospace>.</p><p id="P85">For spatial correlation analysis of C1QA expression in macrophages, the tissue core was divided into 100 subregions (a 10×10 grid), and the number of cells or <italic>C1QA</italic> signal level were summed in each individual region and plotted. Correlation was calculated with function <monospace>cor()</monospace> with method <monospace>spearman</monospace>.</p></sec><sec id="S30"><title>Preprocessing and analysis of human PBMC datasets</title><p id="P86">CyTOF data measuring 33 proteins of PBMC from healthy human donors in Hartmann et al (<xref ref-type="bibr" rid="R94">94</xref>) was downloaded from flow-repository (‘FR-FCM-Z249, HD06_;run1’). Cells were downsampled to 50,000, clustered using Seurat and manually annotated, and then a total of 38,866 annotated cells were used. CITE-seq data measuring 29 proteins of health human PBMC was retrieved from 10x genomics <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.2/5k_;pbmc_;protein_;v3?">https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.2/5k_;pbmc_;protein_;v3?</ext-link>. Counts were nor malized via CLR normalization with <monospace>Seurat</monospace> function <monospace>Normalizedata()</monospace>, then cells were clustered based on their protein features in <monospace>Seurat</monospace>. A total of 5,241 cells were annotated and used for matching. During match ing, CITE-seq cells were used to match against CyTOF cells, where the input of CITE-seq cells were raw counts and the input of CyTOF cells were arcsine transformed with cofactor = 5. The MARIO parameters used were <monospace>n_;components_;ovlp</monospace> = 10, <monospace>n_;components_;all</monospace> = 15, <monospace>sparsity</monospace> = 1000, <monospace>bad_;prop</monospace> = 0.2, and <monospace>n_;batch</monospace> = 1. Analysis was performed the same as previously described.</p></sec><sec id="S31"><title>Preprocessing and analysis of cross species H1N1/IL-4 chal lenged datasets</title><p id="P87">Human H1N1 virus challenged data is the same as described in the previous section and the same set o cells were used as input to MARIO matching.</p><p id="P88">IL-4 stimulation cross-species CyTOF data is the same cross-species dataset as described in the previous section, using the same human or animal donors as described above (hu man: “7826”, “7718”, “2810”; Rhesus macaque: “D00522” “D06022”, “D06122”; Cynomolgus monkey: “D07282” “D07292”, “D07322”), and the whole blood cells stimulated with IL-4. Cells gated as Erythrocytes, Platelets and CD4+CD8+ cells from the paper (<xref ref-type="bibr" rid="R37">37</xref>) were excludec from downstream matching and analysis. Each individua dataset was randomly downsampled to 120,000 cells, are-sine transformed with cofactor = 5, and subsequently clustered with <monospace>Seurat</monospace> using all the markers, followed by manual annotation and removal of cells with ambiguous an notations. Total cell numbers for matching were 108,538 (human); 110,328 (rhesus macaque); 90,302 (cynomolgus monkey). During matching, human H1N1 challenged cells were matched against human, rhesus macaque and cynomol gus monkey IL-4 cells separately, and cells that matched to all three other datasets were used for downstream analy sis. The MARIO parameters used: <monospace>n_;components_;ovlp</monospace> = 20, <monospace>n_;components_;all</monospace> = 15, <monospace>sparsity</monospace> = 1000 <monospace>bad_;prop</monospace> = 0.1, <monospace>n_;batch</monospace> = 4. Analysis was performed the same as previously described.</p></sec></sec><sec id="S32"><title>Datasets benchmarking metrics and other methods</title><sec id="S33"><title>Benchmarking on the matching quality</title><p id="P89">Three scenarios were tested during the benchmarking process: <list list-type="order" id="L2"><list-item><p id="P90">Sequentially dropping shared features between datasets in order to test the robustness of the algorithm regardless of the antibody panel design.</p></list-item><list-item><p id="P91">Stimulated poor quality data by adding increasing levels of random noise to both datasets, in order to test the robustness of the algorithm in terms of over-integration Gaussian random noise with mean 0 and standard deviation of 0.1, 0.3, 0.5, 0.7, 0.9, 1.1, 1.3, 1.5 was added to the normalized values of all protein channels.</p></list-item><list-item><p id="P92">Intentionally dropping cell types in the dataset being matched against, in order to test the robustness of the algorithm regardless of the cell type composition difference between datasets.</p></list-item></list>
</p><p id="P93">In all three scenarios described above, all other compared methods used the exact same set of cells tested by MARIO. For cross species data (related to <xref ref-type="fig" rid="F3">Figure 3</xref> and <xref ref-type="supplementary-material" rid="SD1">Figure S6</xref>) only H1N1 challenged human and X-species cynomolgus monkey were benchmarked.</p><p id="P94">The following metrics were used in the benchmarking process: <list list-type="bullet" id="L3"><list-item><p id="P95">
<italic>Matching accuracy</italic>. Matching accuracy was calculated by the percentage of cells in <italic>X</italic> that have paired correctly with the same cell type in <italic>Y</italic>, based on the individual dataset’s cell type annotations.</p></list-item><list-item><p id="P96">
<italic>Matching proportion</italic>. Matching proportion was calculated by the percentage of cells in <italic>X</italic> that has a match in <italic>Y</italic> after quality control steps.</p></list-item><list-item><p id="P97">
<italic>Structure alignment score</italic>. Structure alignment score measures how much structural information is preserved after data integration. Let <italic>D</italic>
<sub><monospace>full</monospace></sub> be the matrix whose (<italic>i, j</italic>)-th entry is the Euclidean distance between the <italic>i</italic>-th row and the <italic>j</italic>-th row of <italic>X</italic>. Similarly, let <italic>D</italic>
<sub><monospace>partial</monospace></sub> be the matrix whose (<italic>i, j</italic>)-th entry is the Euclidean distance between the <italic>i</italic>-th row and the <italic>j</italic>-th row of the embedding of <italic>X</italic>. The structure alignment score for the <italic>i</italic>-th cell in <italic>X</italic> is defined as the Pearson correlation between the <italic>i</italic>-th row of <italic>D</italic>
<sub><monospace>full</monospace></sub> and the <italic>i</italic>-th row of <italic>D</italic>
<sub><monospace>partial</monospace></sub>. The structure alignment score for <italic>X</italic> is then defined as the average of the scores over all cells in <italic>X</italic>. The structure alignment score for <italic>Y</italic> can be similarly obtained. The final structure alignment score is the average of the scores for <italic>X</italic> and <italic>Y</italic>.</p></list-item><list-item><p id="P98">
<italic>Silhouette F1 score</italic>. Silhouette F1 score has been described (31948481) and is an integrated measure of the quality of dataset mixing and information preservation. In brief, two preliminary scores <monospace>slt_;mix</monospace> and <monospace>slt_;clust</monospace> were obtained, and the Silhouette F1 score was calculated as 2 · <monospace>slt_;mix</monospace> · <bold><monospace>slt_;clust</monospace></bold>/(<bold><monospace>slt_;mix</monospace></bold> + <bold><monospace>slt_;clust</monospace></bold>). Here, <monospace>slt_;mix</monospace> is a measure of dataset mixing and is defined as one minus normalized Silhouette width with the label being dataset index, this is a measure of mixing; <monospace>slt_;clust</monospace> is a measure of information preservation and is defined as the normalized Silhouette width with label being cell type annotations. All Silhouette widths were computed using the <monospace>silhouette()</monospace> function from R package <monospace>cluster</monospace>.</p></list-item><list-item><p id="P99">
<italic>Adjusted Rand Index (ARI) F1 score</italic>. ARI F1 score is an integrated measure of the quality of dataset mixing and information preservation (<xref ref-type="bibr" rid="R95">95</xref>). The definition is similar to that of Silhouette F1 score, except that we compute Adjusted Rand Index instead of the Silhouette width. All ARI scores were computed using the function <monospace>adjustedRandIndex()</monospace> in R package <monospace>mclust</monospace>.</p></list-item><list-item><p id="P100">
<italic>Average mixing score.</italic> Average mixing score is a measure of dataset mixing based on the Kolmogorov–Smirnov (KS) statistic. For each cluster, the subsets of cells corresponding to that cluster were extracted from the embeddings of <italic>X</italic> and <italic>Y</italic>, respectively. For each coordinate of the embeddings, one minus the KS statistic was computed. The mixing score for that cluster was then computed by taking the median of one minus the KS statistic for each coordinate. The average mixing score is defined as the average of mixing scores over all clusters.</p></list-item><list-item><p id="P101">
<italic>Error avoidance score</italic>. Error avoidance score measures the performance of the quality control process and is specific to the benchmarking scenario 3 (intentionally dropping cell types). For each cell type dropped, the corresponding error avoidance score is defined as <inline-formula><mml:math id="M151"><mml:msqrt><mml:mrow><mml:mi>a</mml:mi><mml:mo>/</mml:mo><mml:mi>b</mml:mi></mml:mrow></mml:msqrt></mml:math></inline-formula>, where <italic>a</italic> is the number of cells in <italic>X</italic> that are of that type and have survived the quality control process (i.e., a match involving that cell type has occurred), and <italic>b</italic> is the total number of cells of that type <italic>X</italic>. Higher value of this score indicates that erroneous matching towards deleted cells types has been avoided more.</p></list-item></list>
</p><p id="P102">During benchmarking, all datasets were downsampled. The Bone marrow dataset (<xref ref-type="fig" rid="F2">Figure 2</xref>) was downsampled to 40,000 cells (8000 and 32,000 for <italic>X</italic> and <italic>Y</italic>); the PBMC dataset (<xref ref-type="supplementary-material" rid="SD1">Figure S3</xref>) was downsampled to 25,000 cells (5000 and 20,000 for <italic>X</italic> and <italic>Y</italic>); the X-Species H1N1/IFN-gamma dataset (<xref ref-type="fig" rid="F3">Figure 3</xref>) was downsampled to 40,000 cells (8000 and 32,000 for <italic>X</italic> and <italic>Y</italic>); the X-Species H1N1/IL-4 dataset (<xref ref-type="supplementary-material" rid="SD1">Figure S6</xref>) was downsampled to 40,000 cells (8,000 and 32,000 for <italic>X</italic> and <italic>Y</italic>); and the Murine spleen dataset (<xref ref-type="fig" rid="F4">Figure 4</xref>) downsampled to 25,000 cells (5000 and 20,000 for <italic>X</italic> and <italic>Y</italic>). All methods used the same set of cells.</p><p id="P103">Parameters used for benchmarking are as follows. For benchmarking of MARIO, we used a consistent set of parameters across all datasets: <monospace>n_;components_;ovlp</monospace> = 10 (or the maximum number available); <monospace>n_;components_;all</monospace> = 20 (or the maximum available), <monospace>sparsity</monospace> = 5000. <monospace>bad_;prop</monospace> = 0.1, <monospace>n_;batch</monospace> = 1. For other methods, the input of data were all values normalized per feature within each dataset (except Liger where their own custom normalization is required). Only mNN-based methods (Scanorma, Seurat. fastMNN) were included in the comparison of matching accuracy and matching proportion. All methods used default parameters, using available shared features. For computation of SAM, ASW, ARI and avgMix, the first 20 (or maximum available) components of MARIO CCA scores or reduced values from other methods were used. For visualization, t- SNE plots were produced using the first 10 components for all methods.</p></sec><sec id="S34"><title>Benchmarking on time and memory usage</title><p id="P104">Time and memory usage of MARIO on the datasets presented in <xref ref-type="fig" rid="F2">Figure 2</xref>, <xref ref-type="fig" rid="F3">3</xref>, <xref ref-type="fig" rid="F4">4</xref> were evaluated. The full pipeline MARIO time usage (including initial and refined matching; best interpolation finding; joint regularized filtering; CCA calculation) was measured with the default parameters, with increasing amount of cells (50,000 cell max), and ratio of <italic>X</italic> and <italic>Y</italic> set to 1:4 (e.g, at total of 20,000 cells, <italic>X</italic> has 4000 cells and <italic>Y</italic> has 16,00C cells). The MARIO matching time usage (only including intial and refined matching) was measured with the same settings, but with three different sparsity levels: (<xref ref-type="bibr" rid="R1">1</xref>) minimal sparsity calculated by MARIO; (<xref ref-type="bibr" rid="R2">2</xref>) maximal sparsity (i.e., fully dense matching without sparsification); (<xref ref-type="bibr" rid="R3">3</xref>) “medium” sparsity which is in the middle point between minimal and maximum. The MARIO memory usage was measured with the same settings as the time evaluation, but the maximum number was set to 100,000 cells. The peak memory usage was measured by the function profile in the python package <monospace>memory_;profiler</monospace>. The influence of sparsity level used on MARIO matching accuracy was evaluated by inputting different levels (between minimal and maximal sparsity detected by MARIO). A total of 50,000 cells were used for each dataset with a ratio between <italic>X</italic> and <italic>Y</italic> being 1:4.</p></sec></sec></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary Material</label><media xlink:href="EMS141082-supplement-Supplementary_Material.pdf" mimetype="application" mime-subtype="pdf" id="d332aAcEbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S35"><title>Acknowledgements</title><p>We thank Sean Bendall, Scott Rodig and members of the Nolan and Jiang labs for helpful discussions. B.Z. is supported by a Stanford Graduate Fellowship. This work was funded in part by grants from the National Institutes of Health R01AI149672 (S.J., G.P.N.), the Bill &amp; Melinda Gates Foundation INV-002704 (S.J., G.P.N.), OPP1113682 (G.P.N.), COVID-19 Pilot Award (S.J., D.R.M., G.P.N.), the Fast Grant Funding for COVID-19 Science (S.J., D.R.M., G.P.N.), the Botnar Research Centre for Child Health Emergency Response to COVID-19 grant (S.J., D.R.M., G.P.N., M.S.M., and A.T.), the US Food and Drug Administration Medical Countermeasures Initiative contracts HHSF223201610018C and 75F40120C00176 (G.P.N.), the Parker Institute for Cancer Immunotherapy (G.P.N.), and the Rachford and Car- lota A. Harris Endowed Professorship (G.P.N.). This article reflects the views of the authors and should not be construed as representing the views or policies of the FDA, NIH, BMGF, Botnar Foundation or other institutions who provided funding.</p></ack><fn-group><fn id="FN2" fn-type="con"><p id="P105">
<bold>Author ContributionS</bold>
</p><p id="P106">Conceptualization: B.Z., S.C., Z.M., G.P.N., S.J.</p><p id="P107">Algorithm Development and Implementation: S.C., B.Z., Z.M.</p><p id="P108">Analysis: B.Z., S.C., Y.B., H.C., I.T.L., Y.G., S.J. Contribution of Key Reagents and Tools: N.M., G.V., D.R.M., A.T., M.M. Supervision: S.J., G.P.N., Z.M.</p><p id="P109">Both B.Z. and S.C. contributed equally and have the right to list their name first in their CV.</p></fn><fn id="FN3" fn-type="conflict"><p id="P110">
<bold>Conflict of Interests</bold>
</p><p id="P111">G.P.N. received research grants from Pfizer, Inc.; Vaxart, Inc.; Celgene, Inc.; and Juno Therapeutics, Inc. during the course of this work. G.P.N. and Y.G. have equity in Akoya Biosciences, Inc. G.P.N. is a scientific advisory board member of Akoya Biosciences, Inc.</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gawad</surname><given-names>Charles</given-names></name><name><surname>Koh</surname><given-names>Winston</given-names></name><name><surname>Quake</surname><given-names>Stephen R</given-names></name></person-group><article-title>Single-cell genome sequencing: current state of the science</article-title><source>Nature Reviews Genetics</source><year>2016</year><volume>17</volume><issue>3</issue><fpage>175</fpage><lpage>188</lpage></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schwartzman</surname><given-names>Omer</given-names></name><name><surname>Tanay</surname><given-names>Amos</given-names></name></person-group><article-title>Single-cell epigenomics: techniques and emerging applications</article-title><source>Nature Reviews Genetics</source><year>2015</year><volume>16</volume><issue>12</issue><fpage>716</fpage><lpage>726</lpage></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Papalexi</surname><given-names>Efthymia</given-names></name><name><surname>Satija</surname><given-names>Rahul</given-names></name></person-group><article-title>Single-cell rna sequencing to explore immune cell heterogeneity</article-title><source>Nature Reviews Immunology</source><year>2018</year><volume>18</volume><issue>1</issue><fpage>35</fpage><lpage>45</lpage></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vistain</surname><given-names>Luke F</given-names></name><name><surname>Tay</surname><given-names>Savaş</given-names></name></person-group><article-title>Single-cell proteomics</article-title><source>Trends in Biochemical Sciences</source><year>2021</year></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fulwyler</surname><given-names>Mack J</given-names></name></person-group><article-title>Electronic separation of biological cells by volume</article-title><source>Science</source><year>1965</year><volume>150</volume><issue>3698</issue><fpage>910</fpage><lpage>911</lpage></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baumgarth</surname><given-names>Nicole</given-names></name><name><surname>Roederer</surname><given-names>Mario</given-names></name></person-group><article-title>A practical approach to multicolor flow cytometry for immunophenotyping</article-title><source>Journal of immunological methods</source><year>2000</year><volume>243</volume><issue>1-2</issue><fpage>77</fpage><lpage>97</lpage></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bendall</surname><given-names>Sean C</given-names></name><name><surname>Simonds</surname><given-names>Erin F</given-names></name><name><surname>Qiu</surname><given-names>Peng</given-names></name><name><surname>El-ad</surname><given-names>D Amir</given-names></name><name><surname>Krutzik</surname><given-names>Peter O</given-names></name><name><surname>Finck</surname><given-names>Rachel</given-names></name><name><surname>Bruggner</surname><given-names>Robert V</given-names></name><name><surname>Melamed</surname><given-names>Rachel</given-names></name><name><surname>Trejo</surname><given-names>Angelica</given-names></name><name><surname>Ornatsky</surname><given-names>Olga I</given-names></name><etal/></person-group><article-title>Single-cell mass cytometry of differential immune and drug responses across a human hematopoietic continuum</article-title><source>Science</source><year>2011</year><volume>332</volume><issue>6030</issue><fpage>687</fpage><lpage>696</lpage></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stoeckius</surname><given-names>Marlon</given-names></name><name><surname>Hafemeister</surname><given-names>Christoph</given-names></name><name><surname>Stephenson</surname><given-names>William</given-names></name><name><surname>Houck-Loomis</surname><given-names>Brian</given-names></name><name><surname>Chattopadhyay</surname><given-names>Pratip K</given-names></name><name><surname>Swerdlow</surname><given-names>Harold</given-names></name><name><surname>Satija</surname><given-names>Rahul</given-names></name><name><surname>Smibert</surname><given-names>Peter</given-names></name></person-group><article-title>Simultaneous epitope and transcriptome measurement in single cells</article-title><source>Nature methods</source><year>2017</year><volume>14</volume><issue>9</issue><fpage>865</fpage><lpage>868</lpage></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peterson</surname><given-names>Vanessa M</given-names></name><name><surname>Zhang</surname><given-names>Kelvin Xi</given-names></name><name><surname>Kumar</surname><given-names>Namit</given-names></name><name><surname>Wong</surname><given-names>Jerelyn</given-names></name><name><surname>Li</surname><given-names>Lixia</given-names></name><name><surname>Wilson</surname><given-names>Douglas C</given-names></name><name><surname>Moore</surname><given-names>Renee</given-names></name><name><surname>McClanahan</surname><given-names>Terrill K</given-names></name><name><surname>Sadekova</surname><given-names>Svetlana</given-names></name><name><surname>Klappenbach</surname><given-names>Joel A</given-names></name></person-group><article-title>Multiplexed quantification of proteins and transcripts in single cells</article-title><source>Nature biotechnology</source><year>2017</year><volume>35</volume><issue>10</issue><fpage>936</fpage><lpage>939</lpage></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Giesen</surname><given-names>Charlotte</given-names></name><name><surname>Wang</surname><given-names>Hao AO</given-names></name><name><surname>Schapiro</surname><given-names>Denis</given-names></name><name><surname>Zivanovic</surname><given-names>Nevena</given-names></name><name><surname>Jacobs</surname><given-names>Andrea</given-names></name><name><surname>Hattendorf</surname><given-names>Bodo</given-names></name><name><surname>Schüffler</surname><given-names>Peter J</given-names></name><name><surname>Grolimund</surname><given-names>Daniel</given-names></name><name><surname>Buhmann</surname><given-names>Joachim M</given-names></name><name><surname>Brandt</surname><given-names>Simone</given-names></name><etal/></person-group><article-title>Highly multiplexed imaging of tumor tissues with subcellular resolution by mass cytometry</article-title><source>Nature methods</source><year>2014</year><volume>11</volume><issue>4</issue><fpage>417</fpage><lpage>422</lpage></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lin</surname><given-names>Jia-Ren</given-names></name><name><surname>Fallahi-Sichani</surname><given-names>Mohammad</given-names></name><name><surname>Sorger</surname><given-names>Peter K</given-names></name></person-group><article-title>Highly multiplexed imaging ol single cells using a high-throughput cyclic immunofluorescence method</article-title><source>Nature communications</source><year>2015</year><volume>6</volume><issue>1</issue><fpage>1</fpage><lpage>7</lpage></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Keren</surname><given-names>Leeat</given-names></name><name><surname>Bosse</surname><given-names>Marc</given-names></name><name><surname>Marquez</surname><given-names>Diana</given-names></name><name><surname>Angoshtari</surname><given-names>Roshan</given-names></name><name><surname>Jain</surname><given-names>Samir</given-names></name><name><surname>Varma</surname><given-names>Sushama</given-names></name><name><surname>Yang</surname><given-names>Soo-Ryum</given-names></name><name><surname>Kurian</surname><given-names>Allison</given-names></name><name><surname>Van Valen</surname><given-names>David</given-names></name><name><surname>West</surname><given-names>Robert</given-names></name><etal/></person-group><article-title>A structurec tumor-immune microenvironment in triple negative breast cancer revealed by multiplexed ion beam imaging</article-title><source>Cell</source><year>2018</year><volume>174</volume><issue>6</issue><fpage>1373</fpage><lpage>1387</lpage></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Goltsev</surname><given-names>Yury</given-names></name><name><surname>Samusik</surname><given-names>Nikolay</given-names></name><name><surname>Kennedy-Darling</surname><given-names>Julia</given-names></name><name><surname>Bhate</surname><given-names>Salil</given-names></name><name><surname>Hale</surname><given-names>Matthew</given-names></name><name><surname>Vazquez</surname><given-names>Gustavo</given-names></name><name><surname>Black</surname><given-names>Sarah</given-names></name><name><surname>Nolan</surname><given-names>Garry P</given-names></name></person-group><article-title>Deep profiling of mouse splenic architecture with codex multiplexed imaging</article-title><source>Cell</source><year>2018</year><volume>174</volume><issue>4</issue><fpage>968</fpage><lpage>981</lpage></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>Juan</given-names></name><name><surname>Qian</surname><given-names>Cheng</given-names></name><name><surname>Cao</surname><given-names>Xuetao</given-names></name></person-group><article-title>Post-translational modification control of innate immunity</article-title><source>Immunity</source><year>2016</year><volume>45</volume><issue>1</issue><fpage>15</fpage><lpage>30</lpage></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Diskin</surname><given-names>C</given-names></name><name><surname>Ryan</surname><given-names>TAJ</given-names></name><name><surname>O’Neill</surname><given-names>LAJ</given-names></name></person-group><article-title>Modification of proteins by metabolites in immunity</article-title><source>Immunity</source><year>2021</year><volume>54</volume><issue>1</issue><fpage>19</fpage><lpage>31</lpage></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gry</surname><given-names>Marcus</given-names></name><name><surname>Rimini</surname><given-names>Rebecca</given-names></name><name><surname>Strömberg</surname><given-names>Sara</given-names></name><name><surname>Asplund</surname><given-names>Anna</given-names></name><name><surname>Pontén</surname><given-names>Fredrik</given-names></name><name><surname>Uh-lén</surname><given-names>Mathias</given-names></name><name><surname>Nilsson</surname><given-names>Peter</given-names></name></person-group><article-title>Correlations between rna and protein expression profiles in 23 human cell lines</article-title><source>BMCgenomics</source><year>2009</year><volume>10</volume><issue>1</issue><fpage>1</fpage><lpage>14</lpage></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Frei</surname><given-names>Andreas P</given-names></name><name><surname>Bava</surname><given-names>Felice-Alessio</given-names></name><name><surname>Zunder</surname><given-names>Eli R</given-names></name><name><surname>Hsieh</surname><given-names>Elena WY</given-names></name><name><surname>Chen</surname><given-names>Shih-Yu</given-names></name><name><surname>Nolan</surname><given-names>Garry F</given-names></name><name><surname>Gherardini</surname><given-names>Pier Federico</given-names></name></person-group><article-title>Highly multiplexed simultaneous detection of rnas and proteins in single cells</article-title><source>Nature methods</source><year>2016</year><volume>13</volume><issue>3</issue><fpage>269</fpage><lpage>275</lpage></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mair</surname><given-names>Florian</given-names></name><name><surname>Erickson</surname><given-names>Jami R</given-names></name><name><surname>Voillet</surname><given-names>Valentin</given-names></name><name><surname>Simoni</surname><given-names>Yannick</given-names></name><name><surname>Bi</surname><given-names>Timothy</given-names></name><name><surname>Tyznik</surname><given-names>Aaron J</given-names></name><name><surname>Martin</surname><given-names>Jody</given-names></name><name><surname>Gottardo</surname><given-names>Raphael</given-names></name><name><surname>Newell</surname><given-names>Evan W</given-names></name><name><surname>Prlic</surname><given-names>Martin</given-names></name></person-group><article-title>A targeted multi-omic analysis approach measures protein expression and low-abundance transcripts on the single-cell level</article-title><source>Cell reports</source><year>2020</year><volume>31</volume><issue>1</issue><elocation-id>107499</elocation-id></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Woo</surname><given-names>Jongmin</given-names></name><name><surname>Williams</surname><given-names>Sarah M</given-names></name><name><surname>Aguilera-Vazquez</surname><given-names>Victor</given-names></name><name><surname>Sontag</surname><given-names>Ryan L</given-names></name><name><surname>Moore</surname><given-names>Ronald J</given-names></name><name><surname>Markillie</surname><given-names>Lye Meng</given-names></name><name><surname>Mehta</surname><given-names>Hardeep S</given-names></name><name><surname>Cantlon</surname><given-names>Joshua</given-names></name><name><surname>Adkins</surname><given-names>Joshua N</given-names></name><name><surname>Smith</surname><given-names>Richard D</given-names></name><etal/></person-group><article-title>High-throughput and high-efficiency sample preparation for single-cell proteomics using a nested nanowell chip</article-title><source>Nature communication</source><year>2021</year><volume>12</volume><issue>6246</issue></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brunner</surname><given-names>Andreas-David</given-names></name><name><surname>Thielert</surname><given-names>Marvin</given-names></name><name><surname>Vasilopoulou</surname><given-names>Catherine G</given-names></name><name><surname>Ammar</surname><given-names>Constantin</given-names></name><name><surname>Coscia</surname><given-names>Fabian</given-names></name><name><surname>Mund</surname><given-names>Andreas</given-names></name><name><surname>Hoerning</surname><given-names>Ole B</given-names></name><name><surname>Bache</surname><given-names>Nicolai</given-names></name><name><surname>Apalategui</surname><given-names>Amalia</given-names></name><name><surname>Lubeck</surname><given-names>Markus</given-names></name><etal/></person-group><article-title>Ultra-high sensitivity mass spectrometry quantifies single-cell proteome changes upon perturbation</article-title><source>BioRxiv</source><year>2021</year><fpage>2020</fpage><lpage>12</lpage></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stegle</surname><given-names>Oliver</given-names></name><name><surname>Teichmann</surname><given-names>Sarah A</given-names></name><name><surname>Marioni</surname><given-names>John C</given-names></name></person-group><article-title>Computational and analytical challenges in single-cell transcriptomics</article-title><source>Nature Reviews Genetics</source><year>2015</year><volume>16</volume><issue>3</issue><fpage>133</fpage><lpage>145</lpage></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lähnemann</surname><given-names>David</given-names></name><name><surname>Köster</surname><given-names>Johannes</given-names></name><name><surname>Szczurek</surname><given-names>Ewa</given-names></name><name><surname>McCarthy</surname><given-names>Davis J</given-names></name><name><surname>Hicks</surname><given-names>Stephanie C</given-names></name><name><surname>Robinson</surname><given-names>Mark D</given-names></name><name><surname>Vallejos</surname><given-names>Catalina A</given-names></name><name><surname>Campbell</surname><given-names>Kieran R</given-names></name><etal/></person-group><article-title>Eleven grand challenges in single-cell data science</article-title><source>Genome biology</source><year>2020</year><volume>21</volume><issue>1</issue><fpage>1</fpage><lpage>35</lpage></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schulz</surname><given-names>Daniel</given-names></name><name><surname>Zanotelli</surname><given-names>Vito Riccardo Tomaso</given-names></name><name><surname>Fischer</surname><given-names>Jana Raja</given-names></name><name><surname>Schapiro</surname><given-names>Denis</given-names></name><name><surname>Engler</surname><given-names>Stefanie</given-names></name><name><surname>Lun</surname><given-names>Xiao-Kang</given-names></name><name><surname>Jackson</surname><given-names>Hartland Warren</given-names></name><name><surname>Bodenmiller</surname><given-names>Bernd</given-names></name></person-group><article-title>Simultaneous multiplexed imaging of mrna and proteins with subcellular resolution in breast cancer tissue samples by mass cytometry</article-title><source>Cell systems</source><year>2018</year><volume>6</volume><issue>1</issue><fpage>25</fpage><lpage>36</lpage></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Merritt</surname><given-names>Christopher R</given-names></name><name><surname>Ong</surname><given-names>Giang T</given-names></name><name><surname>Church</surname><given-names>Sarah E</given-names></name><name><surname>Barker</surname><given-names>Kristi</given-names></name><name><surname>Danaher</surname><given-names>Patrick</given-names></name><name><surname>Geiss</surname><given-names>Gary</given-names></name><name><surname>Hoang</surname><given-names>Margaret</given-names></name><name><surname>Jung</surname><given-names>Jaemyeong</given-names></name><name><surname>Liang</surname><given-names>Yan</given-names></name><name><surname>McKay-Fleisch</surname><given-names>Jill</given-names></name><etal/></person-group><article-title>Multiplex digital spatial profiling of proteins and rna in fixed tissue</article-title><source>Nature biotechnology</source><year>2020</year><volume>38</volume><issue>5</issue><fpage>586</fpage><lpage>599</lpage></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jiang</surname><given-names>Sizun</given-names></name><name><surname>Chan</surname><given-names>Chi Ngai</given-names></name><name><surname>Rovira-Clave</surname><given-names>Xavier</given-names></name><name><surname>Chen</surname><given-names>Han</given-names></name><name><surname>Bai</surname><given-names>Yunhao</given-names></name><name><surname>Zhu</surname><given-names>Bokai</given-names></name><name><surname>McCaffrey</surname><given-names>Erin</given-names></name><name><surname>Greenwald</surname><given-names>Noah F</given-names></name><name><surname>Liu</surname><given-names>Candace</given-names></name><name><surname>Barlow</surname><given-names>Graham L</given-names></name><etal/></person-group><article-title>Virus-dependen immune conditioning of tissue microenvironments</article-title><source>BioRxiv</source><year>2021</year></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>He</surname><given-names>Shanshan</given-names></name><name><surname>Bhatt</surname><given-names>Ruchir</given-names></name><name><surname>Birditt</surname><given-names>Brian</given-names></name><name><surname>Brown</surname><given-names>Carl</given-names></name><name><surname>Brown</surname><given-names>Emily</given-names></name><name><surname>Chantranuvatana</surname><given-names>Kan</given-names></name><name><surname>Danaher</surname><given-names>Patrick</given-names></name><name><surname>Dunaway</surname><given-names>Dwayne</given-names></name><name><surname>Filanoski</surname><given-names>Brian</given-names></name><name><surname>Garrison</surname><given-names>Ryan G</given-names></name><etal/></person-group><article-title>High-plex mul-tiomic analysis in ffpe tissue at single-cellular and subcellular resolution by spatial molecular imaging</article-title><source>bioRxiv</source><year>2021</year></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haghverdi</surname><given-names>Laleh</given-names></name><name><surname>Lun</surname><given-names>Aaron TL</given-names></name><name><surname>Morgan</surname><given-names>Michael D</given-names></name><name><surname>Marioni</surname><given-names>John C</given-names></name></person-group><article-title>Batch effects in single-cell rna-sequencing data are corrected by matching mutual nearest neighbors</article-title><source>Nature biotechnology</source><year>2018</year><volume>36</volume><issue>5</issue><fpage>421</fpage><lpage>427</lpage></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hie</surname><given-names>Brian</given-names></name><name><surname>Bryson</surname><given-names>Bryan</given-names></name><name><surname>Berger</surname><given-names>Bonnie</given-names></name></person-group><article-title>Efficient integration of heterogeneous single-cell transcriptomes using scanorama</article-title><source>biotechnology Nature</source><year>2019</year><volume>37</volume><issue>6</issue><fpage>685</fpage><lpage>691</lpage></element-citation></ref><ref id="R29"><label>29</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barkas</surname><given-names>Nikolas</given-names></name><name><surname>Petukhov</surname><given-names>Viktor</given-names></name><name><surname>Nikolaeva</surname><given-names>Daria</given-names></name><name><surname>Lozinsky</surname><given-names>Yaroslav</given-names></name><name><surname>Demharter</surname><given-names>Samuel</given-names></name><name><surname>Khodosevich</surname><given-names>Konstantin</given-names></name><name><surname>Kharchenko</surname><given-names>Peter V</given-names></name></person-group><article-title>Joint analysis of heterogeneous single-cell rna-seq dataset collections</article-title><source>Nature methods</source><year>2019</year><volume>16</volume><issue>8</issue><fpage>695</fpage><lpage>698</lpage></element-citation></ref><ref id="R30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stuart</surname><given-names>Tim</given-names></name><name><surname>Butler</surname><given-names>Andrew</given-names></name><name><surname>Hoffman</surname><given-names>Paul</given-names></name><name><surname>Hafemeister</surname><given-names>Christoph</given-names></name><name><surname>Papalexi</surname><given-names>Efthymia</given-names></name><name><surname>Mauck III</surname><given-names>William M</given-names></name><name><surname>Hao</surname><given-names>Yuhan</given-names></name><name><surname>Stoeckius</surname><given-names>Marlon</given-names></name><name><surname>Smibert</surname><given-names>Peter</given-names></name><name><surname>Satija</surname><given-names>Rahul</given-names></name></person-group><article-title>Comprehensive integration of single-cell data</article-title><source>Cell</source><year>2019</year><volume>177</volume><issue>7</issue><fpage>1888</fpage><lpage>1902</lpage></element-citation></ref><ref id="R31"><label>31</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hotelling</surname><given-names>Harold</given-names></name></person-group><article-title>Relations between two sets of variates</article-title><source>Biometrika</source><year>1936</year><month>12</month><volume>28</volume><issue>3-4</issue><fpage>321</fpage><lpage>377</lpage></element-citation></ref><ref id="R32"><label>32</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Levine</surname><given-names>Jacob H</given-names></name><name><surname>Simonds</surname><given-names>Erin F</given-names></name><name><surname>Bendall</surname><given-names>Sean C</given-names></name><name><surname>Davis</surname><given-names>Kara L</given-names></name><name><surname>El-ad</surname><given-names>D Amir</given-names></name><name><surname>Tadmor</surname><given-names>Michelle D</given-names></name><name><surname>Litvin</surname><given-names>Oren</given-names></name><name><surname>Fienberg</surname><given-names>Harris G</given-names></name><name><surname>Jager</surname><given-names>Astraea</given-names></name><name><surname>Zunder</surname><given-names>Eli R</given-names></name><etal/></person-group><article-title>Data-driven phenotypic dissection of aml reveals progenitor-like cells that correlate with prognosis</article-title><source>Cell</source><year>2015</year><volume>162</volume><issue>1</issue><fpage>184</fpage><lpage>197</lpage></element-citation></ref><ref id="R33"><label>33</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Muñoz-Fontela</surname><given-names>César</given-names></name><name><surname>Dowling</surname><given-names>William E</given-names></name><name><surname>Funnell</surname><given-names>Simon GP</given-names></name><name><surname>Gsell</surname><given-names>Pierre-S</given-names></name><name><surname>Riveros-Balta</surname><given-names>A Ximena</given-names></name><name><surname>Albrecht</surname><given-names>Randy A</given-names></name><name><surname>Andersen</surname><given-names>Hanne</given-names></name><name><surname>Baric</surname><given-names>Ralph S</given-names></name><name><surname>Carroll</surname><given-names>Miles W</given-names></name><name><surname>Cavaleri</surname><given-names>Marco</given-names></name><etal/></person-group><article-title>Animal models for covid-19</article-title><source>Nature</source><year>2020</year><volume>586</volume><issue>7830</issue><fpage>509</fpage><lpage>515</lpage></element-citation></ref><ref id="R34"><label>34</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vallender</surname><given-names>Eric J</given-names></name><name><surname>Miller</surname><given-names>Gregory M</given-names></name></person-group><article-title>Nonhuman primate models in the genomic era: a paradigm shift</article-title><source>ILAR journal</source><year>2013</year><volume>54</volume><issue>2</issue><fpage>154</fpage><lpage>165</lpage></element-citation></ref><ref id="R35"><label>35</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Estes</surname><given-names>Jacob D</given-names></name><name><surname>Wong</surname><given-names>Scott W</given-names></name><name><surname>Brenchley</surname><given-names>Jason M</given-names></name></person-group><article-title>Nonhuman primate models o human viral infections</article-title><source>Nature reviews Immunology</source><year>2018</year><volume>18</volume><issue>6</issue><fpage>390</fpage><lpage>404</lpage></element-citation></ref><ref id="R36"><label>36</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Elhmouzi-Younes</surname><given-names>Jamila</given-names></name><name><surname>Palgen</surname><given-names>Jean-Louis</given-names></name><name><surname>Tchitchek</surname><given-names>Nicolas</given-names></name><name><surname>Delandre</surname><given-names>Simon</given-names></name><name><surname>Namet</surname><given-names>Inana</given-names></name><name><surname>Bodinham</surname><given-names>Caroline L</given-names></name><name><surname>Pizzoferro</surname><given-names>Kathleen</given-names></name><name><surname>Lewis</surname><given-names>David JM</given-names></name><name><surname>Grand</surname><given-names>Roger Le</given-names></name><name><surname>Cosma</surname><given-names>Antonio</given-names></name><etal/></person-group><article-title>In depth comparative phenotyping of blood innate myeloid leukocytes from healthy humans and macaques using mass cytometry</article-title><source>Cytometry Part A</source><year>2017</year><volume>91</volume><issue>10</issue><fpage>969</fpage><lpage>982</lpage></element-citation></ref><ref id="R37"><label>37</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bjornson-Hooper</surname><given-names>Zachary B</given-names></name><name><surname>Fragiadakis</surname><given-names>Gabriela K</given-names></name><name><surname>Spitzer</surname><given-names>Matthew H</given-names></name><name><surname>Mad-hireddy</surname><given-names>Deepthi</given-names></name><name><surname>McIlwain</surname><given-names>Dave</given-names></name><name><surname>Nolan</surname><given-names>Garry P</given-names></name></person-group><article-title>A comprehensive atlas of immunological differences between humans, mice and non-human primates</article-title><source>biorxiv</source><year>2019</year><elocation-id>574160</elocation-id></element-citation></ref><ref id="R38"><label>38</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lemaitre</surname><given-names>Julien</given-names></name><name><surname>Cosma</surname><given-names>Antonio</given-names></name><name><surname>Desjardins</surname><given-names>Delphine</given-names></name><name><surname>Lambotte</surname><given-names>Olivier</given-names></name><name><surname>Grand</surname><given-names>Roger Le</given-names></name></person-group><article-title>Mass cytometry reveals the immaturity of circulating neutrophils during siv infection</article-title><source>Journal of innate immunity</source><year>2020</year><volume>12</volume><issue>2</issue><fpage>170</fpage><lpage>181</lpage></element-citation></ref><ref id="R39"><label>39</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Arunachalam</surname><given-names>Prabhu S</given-names></name><name><surname>Charles</surname><given-names>Tysheena P</given-names></name><name><surname>Joag</surname><given-names>Vineet</given-names></name><name><surname>Bollimpelli</surname><given-names>Venkata S</given-names></name><name><surname>Scott</surname><given-names>Madeleine KD</given-names></name><name><surname>Wimmers</surname><given-names>Florian</given-names></name><name><surname>Burton</surname><given-names>Samantha L</given-names></name><name><surname>Labranche</surname><given-names>Celia C</given-names></name><name><surname>Petitdemange</surname><given-names>Caroline</given-names></name><name><surname>Gangadhara</surname><given-names>Sailaja</given-names></name><etal/></person-group><article-title>T cell-inducing vaccine durably prevents mucosal shiv infection even with lower neutralizing antibody titers</article-title><source>Nature medicine</source><year>2020</year><volume>26</volume><issue>6</issue><fpage>932</fpage><lpage>940</lpage></element-citation></ref><ref id="R40"><label>40</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rahil</surname><given-names>Zainab</given-names></name><name><surname>Leylek</surname><given-names>Rebecca</given-names></name><name><surname>Schürch</surname><given-names>Christian M</given-names></name><name><surname>Chen</surname><given-names>Han</given-names></name><name><surname>Bjornson-Hooper</surname><given-names>Zach</given-names></name><name><surname>Christensen</surname><given-names>Shannon R</given-names></name><name><surname>Gherardini</surname><given-names>Pier Federico</given-names></name><name><surname>Bhate</surname><given-names>Salil S</given-names></name><name><surname>Spitzer</surname><given-names>Matthew H</given-names></name><name><surname>Fragiadakis</surname><given-names>Gabriela K</given-names></name><etal/></person-group><article-title>Landscape of coordinated immune responses to h1n1 challenge in humans</article-title><source>The Journal of clinical investigation</source><year>2020</year><volume>130</volume><issue>11</issue></element-citation></ref><ref id="R41"><label>41</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ito</surname><given-names>Satoshi</given-names></name><name><surname>Ansari</surname><given-names>Parswa</given-names></name><name><surname>Sakatsume</surname><given-names>Minoru</given-names></name><name><surname>Dickensheets</surname><given-names>Harold</given-names></name><name><surname>Vazquez</surname><given-names>Nancy</given-names></name><name><surname>Donnelly</surname><given-names>Raymond P</given-names></name><name><surname>Larner</surname><given-names>Andrew C</given-names></name><name><surname>Finbloom</surname><given-names>David S</given-names></name></person-group><article-title>Interleukin-10 inhibits expression of both interferon-and interferon <italic>^</italic>-induced genes by suppressing tyrosine phosphorylation of stat1</article-title><source>Blood, The Journal of the American Society of Hematology</source><year>1999</year><volume>93</volume><issue>5</issue><fpage>1456</fpage><lpage>1463</lpage></element-citation></ref><ref id="R42"><label>42</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rauch</surname><given-names>Isabella</given-names></name><name><surname>Müller</surname><given-names>Mathias</given-names></name><name><surname>Decker</surname><given-names>Thomas</given-names></name></person-group><article-title>The regulation of inflammation by interferons and their stats</article-title><source>Jak-Stat</source><year>2013</year><volume>2</volume><issue>1</issue><elocation-id>e23820</elocation-id></element-citation></ref><ref id="R43"><label>43</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dallagi</surname><given-names>Angham</given-names></name><name><surname>Girouard</surname><given-names>Julie</given-names></name><name><surname>Hamelin-Morrissette</surname><given-names>Jovane</given-names></name><name><surname>Dadzie</surname><given-names>Rachel</given-names></name><name><surname>Laurent</surname><given-names>Laetitia</given-names></name><name><surname>Vaillancourt</surname><given-names>Cathy</given-names></name><name><surname>Lafond</surname><given-names>Julie</given-names></name><name><surname>Carrier</surname><given-names>Christian</given-names></name><name><surname>Reyes-Moreno</surname><given-names>Carlos</given-names></name></person-group><article-title>The activating effect of ifn~<italic>7</italic> on monocytes/macrophages is regulated by the lif-trophoblast-il-10 axis via stat1 inhibition and stat3 activation</article-title><source>Cellular &amp; molecular immunology</source><year>2015</year><volume>12</volume><issue>3</issue><fpage>326</fpage><lpage>341</lpage></element-citation></ref><ref id="R44"><label>44</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zarubin</surname><given-names>Tyler</given-names></name><name><surname>Jiahuai</surname><given-names>HAN</given-names></name></person-group><article-title>Activation and signaling of the p38 map kinase pathway</article-title><source>Cell research</source><year>2005</year><volume>15</volume><issue>1</issue><fpage>11</fpage><lpage>18</lpage></element-citation></ref><ref id="R45"><label>45</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chaudhary</surname><given-names>Omkar</given-names></name><name><surname>Narayan</surname><given-names>Vivek</given-names></name><name><surname>Lelis</surname><given-names>Felipe</given-names></name><name><surname>Linz</surname><given-names>Brandon</given-names></name><name><surname>Watkins</surname><given-names>Meagan</given-names></name><name><surname>Veazey</surname><given-names>Ronald</given-names></name><name><surname>Aldovini</surname><given-names>Anna</given-names></name></person-group><article-title>Inhibition of p38 mapk in combination with art reduces siv-induced immune activation and provides additional protection from immune system deterioration</article-title><source>PLoS pathogens</source><year>2018</year><volume>14</volume><issue>8</issue><elocation-id>e1007268</elocation-id></element-citation></ref><ref id="R46"><label>46</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gayoso</surname><given-names>Adam</given-names></name><name><surname>Steier</surname><given-names>Zoё</given-names></name><name><surname>Lopez</surname><given-names>Romain</given-names></name><name><surname>Regier</surname><given-names>Jeffrey</given-names></name><name><surname>Nazor</surname><given-names>Kristopher L</given-names></name><name><surname>Streets</surname><given-names>Aaron</given-names></name><name><surname>Yosef</surname><given-names>Nir</given-names></name></person-group><article-title>Joint probabilistic modeling of single-cell multi-omic data with to-talvi</article-title><source>Nature Methods</source><year>2021</year><volume>18</volume><issue>3</issue><fpage>272</fpage><lpage>282</lpage></element-citation></ref><ref id="R47"><label>47</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mazzucchelli</surname><given-names>Renata</given-names></name><name><surname>Durum</surname><given-names>Scott K</given-names></name></person-group><article-title>Interleukin-7 receptor expression: intelligent design</article-title><source>Nature Reviews Immunology</source><year>2007</year><volume>7</volume><issue>2</issue><fpage>144</fpage><lpage>154</lpage></element-citation></ref><ref id="R48"><label>48</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grumont</surname><given-names>Raelene</given-names></name><name><surname>Lock</surname><given-names>Peter</given-names></name><name><surname>Mollinari</surname><given-names>Michael</given-names></name><name><surname>Shannon</surname><given-names>Frances M</given-names></name><name><surname>Moore</surname><given-names>Anna</given-names></name><name><surname>Gerondakis</surname><given-names>Steve</given-names></name></person-group><article-title>The mitogen-induced increase in t cell size involves pkc and nfat activation of rel/nf-<italic>κ</italic>b-dependent c-myc expression</article-title><source>Immunity</source><year>2004</year><volume>21</volume><issue>1</issue><fpage>19</fpage><lpage>30</lpage></element-citation></ref><ref id="R49"><label>49</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kleiman</surname><given-names>Eden</given-names></name><name><surname>Salyakina</surname><given-names>Daria</given-names></name><name><surname>De Heusch</surname><given-names>Magali</given-names></name><name><surname>Hoek</surname><given-names>Kristen L</given-names></name><name><surname>Llanes</surname><given-names>Joan M</given-names></name><name><surname>Castro</surname><given-names>Iris</given-names></name><name><surname>Wright</surname><given-names>Jacqueline A</given-names></name><name><surname>Clark</surname><given-names>Emily S</given-names></name><name><surname>Dykxhoorn</surname><given-names>Derek M</given-names></name><name><surname>Capobianco</surname><given-names>Enrico</given-names></name><etal/></person-group><article-title>Distinct transcriptomic features are associated with transitional and mature b-cell populations in the mouse spleen</article-title><source>Frontiers in immunology</source><year>2015</year><volume>6</volume><fpage>30</fpage></element-citation></ref><ref id="R50"><label>50</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wen</surname><given-names>Lijun</given-names></name><name><surname>Shinton</surname><given-names>Susan A</given-names></name><name><surname>Hardy</surname><given-names>Richard R</given-names></name><name><surname>Hayakawa</surname><given-names>Kyoko</given-names></name></person-group><article-title>Association of b-1 b cells with follicular dendritic cells in spleen</article-title><source>The Journal of Immunology</source><year>2005</year><volume>174</volume><issue>11</issue><fpage>6918</fpage><lpage>6926</lpage></element-citation></ref><ref id="R51"><label>51</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hardtke</surname><given-names>Svenja</given-names></name><name><surname>Ohl</surname><given-names>Lars</given-names></name><name><surname>Förster</surname><given-names>Reinhold</given-names></name></person-group><article-title>Balanced expression of cxcr5 and ccr7 on follicular t helper cells determines their transient positioning to lymph node follicles and is essential for efficient b-cell help</article-title><source>Blood</source><year>2005</year><volume>106</volume><issue>6</issue><fpage>1924</fpage><lpage>1931</lpage></element-citation></ref><ref id="R52"><label>52</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kreslavsky</surname><given-names>Taras</given-names></name><name><surname>Vilagos</surname><given-names>Bojan</given-names></name><name><surname>Tagoh</surname><given-names>Hiromi</given-names></name><name><surname>Poliakova</surname><given-names>Daniela Kostanova</given-names></name><name><surname>Schwickert</surname><given-names>Tanja A</given-names></name><name><surname>Wöhner</surname><given-names>Miriam</given-names></name><name><surname>Jaritz</surname><given-names>Markus</given-names></name><name><surname>Weiss</surname><given-names>Siegfried</given-names></name><name><surname>Taneja</surname><given-names>Reshma</given-names></name><name><surname>Ross-ner</surname><given-names>Moritz J</given-names></name><etal/></person-group><article-title>Essential role for the transcription factor bhlhe41 in regulating the development, self-renewal and bcr repertoire of b-1a cells</article-title><source>Nature immunology</source><year>2017</year><volume>18</volume><issue>4</issue><fpage>442</fpage><lpage>455</lpage></element-citation></ref><ref id="R53"><label>53</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pavlasova</surname><given-names>Gabriela</given-names></name><name><surname>Mraz</surname><given-names>Marek</given-names></name></person-group><article-title>The regulation and function of cd20: an “enigma” of b-cell biology and targeted therapy</article-title><source>haematologica</source><year>2020</year><volume>105</volume><issue>6</issue><elocation-id>1494</elocation-id></element-citation></ref><ref id="R54"><label>54</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Netea</surname><given-names>Mihai G</given-names></name><name><surname>Simon</surname><given-names>Anna</given-names></name><name><surname>van de Veerdonk</surname><given-names>Frank</given-names></name><name><surname>Kullberg</surname><given-names>Bart-Jan</given-names></name><name><surname>Van der Meer</surname><given-names>Jos WM</given-names></name><name><surname>Joosten</surname><given-names>Leo AB</given-names></name></person-group><article-title>Il-1 <italic>β</italic> processing in host defense: beyond the inflammasomes</article-title><source>PLoS pathogens</source><year>2010</year><volume>6</volume><issue>2</issue><elocation-id>e1000661</elocation-id></element-citation></ref><ref id="R55"><label>55</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carsetti</surname><given-names>Rita</given-names></name><name><surname>Rosado</surname><given-names>M Manuela</given-names></name><name><surname>Wardmann</surname><given-names>Hedda</given-names></name></person-group><article-title>Peripheral development of b cells in mouse and man</article-title><source>Immunological reviews</source><year>2004</year><volume>197</volume><issue>1</issue><fpage>179</fpage><lpage>191</lpage></element-citation></ref><ref id="R56"><label>56</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Arnon</surname><given-names>Tal I</given-names></name><name><surname>Horton</surname><given-names>Robert M</given-names></name><name><surname>Grigorova</surname><given-names>Irina L</given-names></name><name><surname>Cyster</surname><given-names>Jason G</given-names></name></person-group><article-title>Visualization of splenic marginal zone b-cell shuttling and follicular b-cell egress</article-title><source>Nature</source><year>2013</year><volume>493</volume><issue>7434</issue><fpage>684</fpage><lpage>688</lpage></element-citation></ref><ref id="R57"><label>57</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chung</surname><given-names>James B</given-names></name><name><surname>Sater</surname><given-names>Richard A</given-names></name><name><surname>Fields</surname><given-names>Michele L</given-names></name><name><surname>Erikson</surname><given-names>Jan</given-names></name><name><surname>Monroe</surname><given-names>John G</given-names></name></person-group><article-title>Cd23 defines two distinct subsets of immature b cells which differ in their responses to t cell help signals</article-title><source>International immunology</source><year>2002</year><volume>14</volume><issue>2</issue><fpage>157</fpage><lpage>166</lpage></element-citation></ref><ref id="R58"><label>58</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stolp</surname><given-names>Jessica</given-names></name><name><surname>Mariño</surname><given-names>Eliana</given-names></name><name><surname>Batten</surname><given-names>Marcel</given-names></name><name><surname>Sierro</surname><given-names>Frederic</given-names></name><name><surname>Cox</surname><given-names>Selwyn L</given-names></name><name><surname>Grey</surname><given-names>Shane T</given-names></name><name><surname>Silveira</surname><given-names>Pablo A</given-names></name></person-group><article-title>Intrinsic molecular factors cause aberrant expansion of the splenic marginal zone b cell population in nonobese diabetic mice</article-title><source>The Journal of Immunology</source><year>2013</year><volume>191</volume><issue>1</issue><fpage>97</fpage><lpage>109</lpage></element-citation></ref><ref id="R59"><label>59</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Uhlén</surname><given-names>Mathias</given-names></name><name><surname>Fagerberg</surname><given-names>Linn</given-names></name><name><surname>Hallström</surname><given-names>Björn M</given-names></name><name><surname>Lindskog</surname><given-names>Cecilia</given-names></name><name><surname>Oksvold</surname><given-names>Per</given-names></name><name><surname>Mardinoglu</surname><given-names>Adil</given-names></name><name><surname>Sivertsson</surname><given-names>Åsa</given-names></name><name><surname>Kampf</surname><given-names>Caroline</given-names></name><name><surname>Sjöstedt</surname><given-names>Evelina</given-names></name><name><surname>Asplund</surname><given-names>Anna</given-names></name><etal/></person-group><article-title>Tissuebased map of the human proteome</article-title><source>Science</source><year>2015</year><volume>347</volume><issue>6220</issue></element-citation></ref><ref id="R60"><label>60</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ballestar</surname><given-names>Esteban</given-names></name><name><surname>Farber</surname><given-names>Donna L</given-names></name><name><surname>Glover</surname><given-names>Sarah</given-names></name><name><surname>Horwitz</surname><given-names>Bruce</given-names></name><name><surname>Meyer</surname><given-names>Kerstin</given-names></name><name><surname>Nikolic</surname><given-names>M</given-names></name><name><surname>Ordovas-Montanes</surname><given-names>Jose</given-names></name><name><surname>Sims</surname><given-names>P</given-names></name><name><surname>Shalek</surname><given-names>A</given-names></name><name><surname>Vandamme</surname><given-names>Niels</given-names></name><etal/></person-group><source>Single cell profiling of covid-19 patients: an international data resource from multiple tissues</source><year>2020</year></element-citation></ref><ref id="R61"><label>61</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schwabenland</surname><given-names>Marius</given-names></name><name><surname>Salié</surname><given-names>Henrike</given-names></name><name><surname>Tanevski</surname><given-names>Jovan</given-names></name><name><surname>Killmer</surname><given-names>Saskia</given-names></name><name><surname>Lago</surname><given-names>Marilyn Salvat</given-names></name><name><surname>Schlaak</surname><given-names>Alexandra Emilia</given-names></name><name><surname>Mayer</surname><given-names>Lena</given-names></name><name><surname>Matschke</surname><given-names>Jakob</given-names></name><name><surname>Püschel</surname><given-names>Klaus</given-names></name><name><surname>Fitzek</surname><given-names>Antonia</given-names></name><etal/></person-group><article-title>Deep spatial profiling of human covid-19 brains reveals neuroinflammation with distinct microanatomical microglia-t-cell interactions</article-title><source>Immunity</source><year>2021</year><volume>54</volume><issue>7</issue><fpage>1594</fpage><lpage>1610</lpage></element-citation></ref><ref id="R62"><label>62</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rendeiro</surname><given-names>André F</given-names></name><name><surname>Ravichandran</surname><given-names>Hiranmayi</given-names></name><name><surname>Bram</surname><given-names>Yaron</given-names></name><name><surname>Chandar</surname><given-names>Vasuretha</given-names></name><name><surname>Kim</surname><given-names>Junbum</given-names></name><name><surname>Meydan</surname><given-names>Cem</given-names></name><name><surname>Park</surname><given-names>Jiwoon</given-names></name><name><surname>Foox</surname><given-names>Jonathan</given-names></name><name><surname>Hether</surname><given-names>Tyler</given-names></name><name><surname>Warren</surname><given-names>Sarah</given-names></name><etal/></person-group><article-title>The spatial landscape of lung pathology during covid-19 progression</article-title><source>Nature</source><year>2021</year><volume>593</volume><issue>7860</issue><fpage>564</fpage><lpage>569</lpage></element-citation></ref><ref id="R63"><label>63</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Delorey</surname><given-names>Toni M</given-names></name><name><surname>Ziegler</surname><given-names>Carly GK</given-names></name><name><surname>Heimberg</surname><given-names>Graham</given-names></name><name><surname>Normand</surname><given-names>Rachelly</given-names></name><name><surname>Yang</surname><given-names>Yiming</given-names></name><name><surname>Segerstolpe</surname><given-names>Åsa</given-names></name><name><surname>Abbondanza</surname><given-names>Domenic</given-names></name><name><surname>Fleming</surname><given-names>Stephen J</given-names></name><name><surname>Subramanian</surname><given-names>Ayshwarya</given-names></name><name><surname>Montoro</surname><given-names>Daniel T</given-names></name><etal/></person-group><article-title>Covid-19 tissue atlases reveal sars-cov-2 pathology and cellular targets</article-title><source>Nature</source><year>2021</year><fpage>1</fpage><lpage>8</lpage></element-citation></ref><ref id="R64"><label>64</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wu</surname><given-names>Yingjie</given-names></name><name><surname>Huang</surname><given-names>Xiaoxing</given-names></name><name><surname>Sun</surname><given-names>Jiaxing</given-names></name><name><surname>Xie</surname><given-names>Tian</given-names></name><name><surname>Lei</surname><given-names>Yufei</given-names></name><name><surname>Muhammad</surname><given-names>Jamal</given-names></name><name><surname>Li</surname><given-names>Xinran</given-names></name><name><surname>Zeng</surname><given-names>Xingruo</given-names></name><name><surname>Zhou</surname><given-names>Fuling</given-names></name><name><surname>Qin</surname><given-names>Hong</given-names></name><etal/></person-group><article-title>Clinical characteristics and immune injury1 mechanisms in 71 patients with covid-19</article-title><source>Msphere</source><year>2020</year><volume>5</volume><issue>4</issue><fpage>e00362</fpage><lpage>20</lpage></element-citation></ref><ref id="R65"><label>65</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kompaniyets</surname><given-names>Lyudmyla</given-names></name><name><surname>Goodman</surname><given-names>Alyson B</given-names></name><name><surname>Belay</surname><given-names>Brook</given-names></name><name><surname>Freedman</surname><given-names>David S</given-names></name><name><surname>Sucosky</surname><given-names>Marissa S</given-names></name><name><surname>Lange</surname><given-names>Samantha J</given-names></name><name><surname>Gundlapalli</surname><given-names>Adi V</given-names></name><name><surname>Boehmer</surname><given-names>Tegan K</given-names></name><name><surname>Blanck</surname><given-names>Heidi M</given-names></name></person-group><article-title>Body mass index and risk for covid-19-related hospitalization, intensive care unit admission, invasive mechanical ventilation, and death—united states, march-december 2020</article-title><source>Morbidity and Mortality Weekly Report</source><year>2021</year><volume>70</volume><issue>10</issue><fpage>355</fpage></element-citation></ref><ref id="R66"><label>66</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Michalec</surname><given-names>Lidia</given-names></name><name><surname>Choudhury</surname><given-names>Barun K</given-names></name><name><surname>Postlethwait</surname><given-names>Edward</given-names></name><name><surname>Wild</surname><given-names>James S</given-names></name><name><surname>Alam</surname><given-names>Rafeul</given-names></name><name><surname>Lett-Brown</surname><given-names>Michael</given-names></name><name><surname>Sur</surname><given-names>Sanjiv</given-names></name></person-group><article-title>Ccl7 and cxcl10 orchestrate oxidative stress-induced1 neutrophilic lung inflammation</article-title><source>The Journal of Immunology</source><year>2002</year><volume>168</volume><issue>2</issue><fpage>846</fpage><lpage>852</lpage></element-citation></ref><ref id="R67"><label>67</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Russo</surname><given-names>Remo C</given-names></name><name><surname>Garcia</surname><given-names>Cristiana C</given-names></name><name><surname>Teixeira</surname><given-names>Mauro M</given-names></name><name><surname>Amaral</surname><given-names>Flavio A</given-names></name></person-group><article-title>The cxcl8/il-1 8 chemokine family and its receptors in inflammatory diseases</article-title><source>Expert review of clinical immunology</source><year>2014</year><volume>10</volume><issue>5</issue><fpage>593</fpage><lpage>619</lpage></element-citation></ref><ref id="R68"><label>68</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Segovia</surname><given-names>Mercedes</given-names></name><name><surname>Russo</surname><given-names>Sofia</given-names></name><name><surname>Jeldres</surname><given-names>Mathias</given-names></name><name><surname>Mahmoud</surname><given-names>Yamil D</given-names></name><name><surname>Perez</surname><given-names>Valentina</given-names></name><name><surname>Duhalde</surname><given-names>Maite</given-names></name><name><surname>Charnet</surname><given-names>Pierre</given-names></name><name><surname>Rousset</surname><given-names>Matthieu</given-names></name><name><surname>Victoria</surname><given-names>Sabina</given-names></name><name><surname>Veigas</surname><given-names>Florencia</given-names></name><etal/></person-group><article-title>Targeting tmem176b enhances antitumor immunity and augments the efficacy of immune checkpoint blockers by unleashing inflammasome activation</article-title><source>Cancer cell</source><year>2019</year><volume>35</volume><issue>5</issue><fpage>767</fpage><lpage>781</lpage></element-citation></ref><ref id="R69"><label>69</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Guo</surname><given-names>Qirui</given-names></name><name><surname>Zhao</surname><given-names>Yingchi</given-names></name><name><surname>Li</surname><given-names>Junhong</given-names></name><name><surname>Liu</surname><given-names>Jiangning</given-names></name><name><surname>Yang</surname><given-names>Xiuhong</given-names></name><name><surname>Guo</surname><given-names>Xuefei</given-names></name><name><surname>Kuang</surname><given-names>Ming</given-names></name><name><surname>Xia</surname><given-names>Huawei</given-names></name><name><surname>Zhang</surname><given-names>Zeming</given-names></name><name><surname>Cao</surname><given-names>Lili</given-names></name><etal/></person-group><article-title>Induction of alarmin s100a8/a9 mediates activation of aberrant neutrophils in the pathogenesis of covid-19</article-title><source>Cell host &amp; microbe</source><year>2021</year><volume>29</volume><issue>2</issue><fpage>222</fpage><lpage>235</lpage></element-citation></ref><ref id="R70"><label>70</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mostafavi</surname><given-names>Sara</given-names></name><name><surname>Yoshida</surname><given-names>Hideyuki</given-names></name><name><surname>Moodley</surname><given-names>Devapregasan</given-names></name><name><surname>LeBoité</surname><given-names>Hugo</given-names></name><name><surname>Rothamel</surname><given-names>Katherine</given-names></name><name><surname>Raj</surname><given-names>Towfique</given-names></name><name><surname>Ye</surname><given-names>Chun Jimmie</given-names></name><name><surname>Chevrier</surname><given-names>Nicolas</given-names></name><name><surname>Zhang</surname><given-names>Shen-Ying</given-names></name><name><surname>Feng</surname><given-names>Ting</given-names></name><etal/></person-group><article-title>Parsing the interferon transcriptional network and its disease associations</article-title><source>Cell</source><year>2016</year><volume>164</volume><issue>3</issue><fpage>564</fpage><lpage>578</lpage></element-citation></ref><ref id="R71"><label>71</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname><given-names>Zhuo</given-names></name><name><surname>Ren</surname><given-names>Lili</given-names></name><name><surname>Zhang</surname><given-names>Li</given-names></name><name><surname>Zhong</surname><given-names>Jiaxin</given-names></name><name><surname>Xiao</surname><given-names>Yan</given-names></name><name><surname>Jia</surname><given-names>Zhilong</given-names></name><name><surname>Guo</surname><given-names>Li</given-names></name><name><surname>Yang</surname><given-names>Jing</given-names></name><name><surname>Wang</surname><given-names>Chun</given-names></name><name><surname>Jiang</surname><given-names>Shuai</given-names></name><etal/></person-group><article-title>Heightened innate immune responses in the respiratory tract of covid-19 patients</article-title><source>Cell host &amp; microbe</source><year>2020</year><volume>27</volume><issue>6</issue><fpage>883</fpage><lpage>890</lpage></element-citation></ref><ref id="R72"><label>72</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nguyen-Robertson</surname><given-names>Catriona</given-names></name><name><surname>Haque</surname><given-names>Ashraful</given-names></name><name><surname>Mintern</surname><given-names>Justine</given-names></name><name><surname>La Flamme</surname><given-names>Anne C</given-names></name></person-group><article-title>Covid-19: searching for clues among other respiratory viruses</article-title><source>Immunology &amp; Cell Biology</source><year>2020</year><volume>98</volume><issue>4</issue><fpage>247</fpage><lpage>250</lpage></element-citation></ref><ref id="R73"><label>73</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Merad</surname><given-names>Miriam</given-names></name><name><surname>Martin</surname><given-names>Jerome C</given-names></name></person-group><article-title>Pathological inflammation in patients with covid-19: a key role for monocytes and macrophages</article-title><source>Nature reviews immunology</source><year>2020</year><volume>20</volume><issue>6</issue><fpage>355</fpage><lpage>362</lpage></element-citation></ref><ref id="R74"><label>74</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bizzotto</surname><given-names>Juan</given-names></name><name><surname>Sanchis</surname><given-names>Pablo</given-names></name><name><surname>Abbate</surname><given-names>Mercedes</given-names></name><name><surname>Lage-Vickers</surname><given-names>Sofia</given-names></name><name><surname>Lavignolle</surname><given-names>Rosario</given-names></name><name><surname>Toro</surname><given-names>Ayelén</given-names></name><name><surname>Olszevicki</surname><given-names>Santiago</given-names></name><name><surname>Sabater</surname><given-names>Agustina</given-names></name><name><surname>Cascardo</surname><given-names>Florencia</given-names></name><name><surname>Vazquez</surname><given-names>Elba</given-names></name><etal/></person-group><article-title>Sars-cov-2 infection boosts mx1 antiviral effector in covid-19 patients</article-title><source>Iscience</source><year>2020</year><volume>23</volume><issue>10</issue><elocation-id>101585</elocation-id></element-citation></ref><ref id="R75"><label>75</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Patel</surname><given-names>Hamel</given-names></name><name><surname>Ashton</surname><given-names>Nicholas J</given-names></name><name><surname>Dobson</surname><given-names>Richard JB</given-names></name><name><surname>Andersson</surname><given-names>Lars-Magnus</given-names></name><name><surname>Yil-maz</surname><given-names>Aylin</given-names></name><name><surname>Blennow</surname><given-names>Kaj</given-names></name><name><surname>Gisslen</surname><given-names>Magnus</given-names></name><name><surname>Zetterberg</surname><given-names>Henrik</given-names></name></person-group><article-title>Proteomic blood profiling in mild, severe and critical covid-19 patients</article-title><source>Scientific reports</source><year>2021</year><volume>11</volume><issue>1</issue><fpage>1</fpage><lpage>12</lpage></element-citation></ref><ref id="R76"><label>76</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Khan</surname><given-names>Saad A</given-names></name><name><surname>Goliwas</surname><given-names>Kayla F</given-names></name><name><surname>Deshane</surname><given-names>Jessy S</given-names></name></person-group><article-title>Sphingolipids in lung pathology in the coronavirus disease era: A review of sphingolipid involvement in the pathogenesis of lung damage</article-title><source>Frontiers in Physiology</source><year>2021</year><elocation-id>1757</elocation-id></element-citation></ref><ref id="R77"><label>77</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>Shuxiao</given-names></name><name><surname>Liu</surname><given-names>Sifan</given-names></name><name><surname>Ma</surname><given-names>Zongming</given-names></name></person-group><article-title>Global and individualized communitydetection in inhomogeneous multilayer networks</article-title><source>arXivpreprint</source><year>2020</year><comment>arXiv:2012.00933</comment></element-citation></ref><ref id="R78"><label>78</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Takei</surname><given-names>Yodai</given-names></name><name><surname>Yun</surname><given-names>Jina</given-names></name><name><surname>Zheng</surname><given-names>Shiwei</given-names></name><name><surname>Ollikainen</surname><given-names>Noah</given-names></name><name><surname>Pierson</surname><given-names>Nico</given-names></name><name><surname>White</surname><given-names>Jonathan</given-names></name><name><surname>Shah</surname><given-names>Sheel</given-names></name><name><surname>Thomassie</surname><given-names>Julian</given-names></name><name><surname>Suo</surname><given-names>Shengbao</given-names></name><name><surname>Eng</surname><given-names>Chee-Huat Linus</given-names></name><etal/></person-group><article-title>Integrated spatial genomics reveals global architecture of single nuclei</article-title><source>Nature</source><year>2021</year><volume>590</volume><issue>7845</issue><fpage>344</fpage><lpage>350</lpage></element-citation></ref><ref id="R79"><label>79</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Burkard</surname><given-names>Rainer</given-names></name><name><surname>Dell’Amico</surname><given-names>Mauro</given-names></name><name><surname>Martello</surname><given-names>Silvano</given-names></name></person-group><source>Assignment problems: revised reprint</source><publisher-name>SIAM</publisher-name><year>2012</year></element-citation></ref><ref id="R80"><label>80</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Löffler</surname><given-names>Matthias</given-names></name><name><surname>Zhang</surname><given-names>Anderson Y</given-names></name><name><surname>Zhou</surname><given-names>Harrison H</given-names></name></person-group><article-title>Optimality of spectral clustering in the gaussian mixture model</article-title><source>The Annals of Statistics</source><year>2021</year><volume>49</volume><issue>5</issue><fpage>2506</fpage><lpage>2530</lpage></element-citation></ref><ref id="R81"><label>81</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kettenring</surname><given-names>Jon R</given-names></name></person-group><article-title>Canonical analysis of several sets of variables</article-title><source>Biometrika</source><year>1971</year><volume>58</volume><issue>3</issue><fpage>433</fpage><lpage>451</lpage></element-citation></ref><ref id="R82"><label>82</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gao</surname><given-names>Sheng</given-names></name><name><surname>Ma</surname><given-names>Zongming</given-names></name></person-group><article-title>Sparse gca andthresholded gradient descent</article-title><source>arXivpreprint</source><year>2021</year><comment>arXiv:2107.00371</comment></element-citation></ref><ref id="R83"><label>83</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tardos</surname><given-names>Éva</given-names></name></person-group><article-title>A strongly polynomial minimum cost circulation algorithm</article-title><source>Combinatorica</source><year>1985</year><volume>5</volume><issue>3</issue><fpage>247</fpage><lpage>255</lpage></element-citation></ref><ref id="R84"><label>84</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hopcroft</surname><given-names>John E</given-names></name><name><surname>Karp</surname><given-names>Richard M</given-names></name></person-group><article-title>An n^5/2 algorithm for maximum matchings in bipartite graphs</article-title><source>SIAM Journal on computing</source><year>1973</year><volume>2</volume><issue>4</issue><fpage>225</fpage><lpage>231</lpage></element-citation></ref><ref id="R85"><label>85</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yu</surname><given-names>Ruoqi</given-names></name><name><surname>Silber</surname><given-names>Jeffrey H</given-names></name><name><surname>Rosenbaum</surname><given-names>Paul R</given-names></name><etal/></person-group><article-title>Matching methods for observational studies derived from large administrative databases</article-title><source>Statistical Science</source><year>2020</year><volume>35</volume><issue>3</issue><fpage>338</fpage><lpage>355</lpage></element-citation></ref><ref id="R86"><label>86</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jonker</surname><given-names>Roy</given-names></name><name><surname>Volgenant</surname><given-names>Anton</given-names></name></person-group><article-title>A shortest augmenting path algorithm for dense and sparse linear assignment problems</article-title><source>Computing</source><year>1987</year><volume>38</volume><issue>4</issue><fpage>325</fpage><lpage>340</lpage></element-citation></ref><ref id="R87"><label>87</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Greenwald</surname><given-names>Noah F</given-names></name><name><surname>Miller</surname><given-names>Geneva</given-names></name><name><surname>Moen</surname><given-names>Erick</given-names></name><name><surname>Kong</surname><given-names>Alex</given-names></name><name><surname>Kagel</surname><given-names>Adam</given-names></name><name><surname>Fullaway</surname><given-names>Christine Camacho</given-names></name><name><surname>McIntosh</surname><given-names>Brianna J</given-names></name><name><surname>Leow</surname><given-names>Ke</given-names></name><name><surname>Schwartz</surname><given-names>Morgan Sarah</given-names></name><name><surname>Dougherty</surname><given-names>Thomas</given-names></name><etal/></person-group><article-title>Whole-cell segmentation of tissue images with human-level performance using large-scale data annotation and deep learning</article-title><source>bioRxiv</source><year>2021</year></element-citation></ref><ref id="R88"><label>88</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bai</surname><given-names>Yunhao</given-names></name><name><surname>Zhu</surname><given-names>Bokai</given-names></name><name><surname>Rovira-Clave</surname><given-names>Xavier</given-names></name><name><surname>Chen</surname><given-names>Han</given-names></name><name><surname>Markovic</surname><given-names>Maxim</given-names></name><name><surname>Chan</surname><given-names>Chi Ngai</given-names></name><name><surname>Su</surname><given-names>Tung-Hung</given-names></name><name><surname>McIlwain</surname><given-names>David R</given-names></name><name><surname>Estes</surname><given-names>Jacob D</given-names></name><name><surname>Keren</surname><given-names>Leeat</given-names></name><etal/></person-group><article-title>Adjacent cell marker lateral spillover compensation and reinforcement for multiplexed images</article-title><source>Frontiers in immunology</source><year>2021</year><elocation-id>2510</elocation-id></element-citation></ref><ref id="R89"><label>89</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Menter</surname><given-names>Thomas</given-names></name><name><surname>Haslbauer</surname><given-names>Jasmin D</given-names></name><name><surname>Nienhold</surname><given-names>Ronny</given-names></name><name><surname>Savic</surname><given-names>Spasenija</given-names></name><name><surname>Hopfer</surname><given-names>Helmut</given-names></name><name><surname>Deigendesch</surname><given-names>Nikolaus</given-names></name><name><surname>Frank</surname><given-names>Stephan</given-names></name><name><surname>Turek</surname><given-names>Daniel</given-names></name><name><surname>Willi</surname><given-names>Niels</given-names></name><name><surname>Pargger</surname><given-names>Hans</given-names></name><etal/></person-group><article-title>Postmortem examination of covid-19 patients reveals diffuse alveolar damage with severe capillary congestion and variegated findings in lungs and other organs suggesting vascular dysfunction</article-title><source>Histopathology</source><year>2020</year><volume>77</volume><issue>2</issue><fpage>198</fpage><lpage>209</lpage></element-citation></ref><ref id="R90"><label>90</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Black</surname><given-names>Sarah</given-names></name><name><surname>Phillips</surname><given-names>Darci</given-names></name><name><surname>Hickey</surname><given-names>John W</given-names></name><name><surname>Kennedy-Darling</surname><given-names>Julia</given-names></name><name><surname>Venkataraa-man</surname><given-names>Vishal G</given-names></name><name><surname>Samusik</surname><given-names>Nikolay</given-names></name><name><surname>Goltsev</surname><given-names>Yury</given-names></name><name><surname>Schürch</surname><given-names>Christian M</given-names></name><name><surname>Nolan</surname><given-names>Garry P</given-names></name></person-group><article-title>Codex multiplexed tissue imaging with dna-conjugated antibodies</article-title><source>Nature Protocols</source><year>2021</year><fpage>1</fpage><lpage>36</lpage></element-citation></ref><ref id="R91"><label>91</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schürch</surname><given-names>Christian M</given-names></name><name><surname>Bhate</surname><given-names>Salil S</given-names></name><name><surname>Barlow</surname><given-names>Graham L</given-names></name><name><surname>Phillips</surname><given-names>Darci J</given-names></name><name><surname>Noti</surname><given-names>Luca</given-names></name><name><surname>Zlobec</surname><given-names>Inti</given-names></name><name><surname>Chu</surname><given-names>Pauline</given-names></name><name><surname>Black</surname><given-names>Sarah</given-names></name><name><surname>Demeter</surname><given-names>Janos</given-names></name><name><surname>McIlwain</surname><given-names>David R</given-names></name><etal/></person-group><article-title>Coordinated cellular neighborhoods orchestrate antitumoral immunity at the colorectal cancer invasive front</article-title><source>Cell</source><year>2020</year><volume>182</volume><issue>5</issue><fpage>1341</fpage><lpage>1359</lpage></element-citation></ref><ref id="R92"><label>92</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ashburner</surname><given-names>Michael</given-names></name><name><surname>Ball</surname><given-names>Catherine A</given-names></name><name><surname>Blake</surname><given-names>Judith A</given-names></name><name><surname>Botstein</surname><given-names>David</given-names></name><name><surname>Butler</surname><given-names>Heather</given-names></name><name><surname>Cherry</surname><given-names>J Michael</given-names></name><name><surname>Davis</surname><given-names>Allan P</given-names></name><name><surname>Dolinski</surname><given-names>Kara</given-names></name><name><surname>Dwight</surname><given-names>Selina S</given-names></name><name><surname>Eppig</surname><given-names>Janan T</given-names></name><etal/></person-group><article-title>Gene ontology: tool for the unification of biology</article-title><source>Nature genetics</source><year>2000</year><volume>25</volume><issue>1</issue><fpage>25</fpage><lpage>29</lpage></element-citation></ref><ref id="R93"><label>93</label><element-citation publication-type="journal"><collab>The gene ontology resource: enriching a gold mine</collab><source>Nucleic Acids Research</source><year>2021</year><volume>49</volume><issue>D1</issue><fpage>D325</fpage><lpage>D334</lpage></element-citation></ref><ref id="R94"><label>94</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hartmann</surname><given-names>Felix J</given-names></name><name><surname>Babdor</surname><given-names>Joel</given-names></name><name><surname>Gherardini</surname><given-names>Pier Federico</given-names></name><name><surname>Amir</surname><given-names>El-Ad D</given-names></name><name><surname>Jones</surname><given-names>Kyle</given-names></name><name><surname>Sahaf</surname><given-names>Bita</given-names></name><name><surname>Marquez</surname><given-names>Diana M</given-names></name><name><surname>Krutzik</surname><given-names>Peter</given-names></name><name><surname>O’Donnell</surname><given-names>Erika</given-names></name><name><surname>Sigal</surname><given-names>Natalia</given-names></name><etal/></person-group><article-title>Comprehensive immune monitoring of clinical trials to advance human immunotherapy</article-title><source>Cell reports</source><year>2019</year><volume>28</volume><issue>3</issue><fpage>819</fpage><lpage>831</lpage></element-citation></ref><ref id="R95"><label>95</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tran</surname><given-names>Hoa Thi Nhu</given-names></name><name><surname>Ang</surname><given-names>Kok Siong</given-names></name><name><surname>Chevrier</surname><given-names>Marion</given-names></name><name><surname>Zhang</surname><given-names>Xiaomeng</given-names></name><name><surname>Lee</surname><given-names>Nicole Yee Shin</given-names></name><name><surname>Goh</surname><given-names>Michelle</given-names></name><name><surname>Chen</surname><given-names>Jinmiao</given-names></name></person-group><article-title>A benchmark of batch-effect correction methods for single-cell rna sequencing data</article-title><source>Genome biology</source><year>2020</year><volume>21</volume><issue>1</issue><fpage>1</fpage><lpage>32</lpage></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>Schematic of the MARIO Analysis Pipeline</title><p>
<bold>(A)</bold> Single-cell proteomic datasets can be acquired using various modalities, including CyTOF, CITE-seq and CODEX, on different biological samples or species (e.g. human/ non-human primate) with shared underlying biological information. Protein markers are divided into two classes: 1) features captured within both datasets (Shared Features), and 2)markers not shared between the datasets (Distinct Features). Both classes of protein expression matrices serve as inputs to the MARIO algorithm detailed in <bold>(B)</bold>. After the MARIO pipeline, further downstream analysis can be conducted using the combined information integrated across multiple individual experiments. <bold>(B)</bold> A schematic of MARIO algorithm: 1) Individual cells are first subject to matching using the distance matrix constructed using the Shared Features described in (A), before further match refinement using the distance matrix constructed from the Distinct Features such that all features are included. Thereafter, a best interpolation of initial and refined matching will be performed. The dataset then undergoes a matchability test, where random sign flipping is used to validate the statistical rigorosity of MARIO integration using the Canonical Correlation distribution. Subsequently, we perform a cell-cell matching quality control step coined Joint Regularized Filtering, removing spurious cell pairs. Lastly, the matched cells across datasets are jointly embedded into a Canonical Correlation Analysis (CCA) subspace.</p></caption><graphic xlink:href="EMS141082-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>Matching and Integration of CyTOF and CITE-seq Bone Marrow Data using MARIO.</title><p>
<bold>(A)</bold> t-SNE plots of individual cells colored by assay modality, either pre-integration or MARIO integration. <bold>(B)</bold> t-SNE plots of MARIO integrated cells colored by clustering results from (top left to bottom right): High concordance in shared cell types based on annotations from both original datasets; Annotation from Levine et al.; Annotation from Stuart et al.; Clustering result based on CCA scores from MARIO high cell type resolution using information from both assays. <bold>(C-E)</bold> Benchmarking results of MARIO against other mNN-based methods (Purple: MARIO, Blue: Seurat, Green: Scanorama, Red: FastMNN). (C) The matching accuracy (left) and the proportion of cells being matched (right) are tested by sequentially dropping protein features. (D) The matching accuracy (left) and the proportions of cells being matched (right) are measured with increasingly spiked-in noise. (E) The error avoidance score (higher is better) is calculated after dropping each cell type sequentially from the dataset. <bold>(F)</bold> Heatmap of cross modality protein expression levels for the matched cells. <bold>(G)</bold> t-SNE plots of the matched cells with protein/RNA expression levels overlaid based on each of the assays.</p></caption><graphic xlink:href="EMS141082-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>MARIO enables Cross-species and Stimuli Integrative Analysis</title><p>
<bold>(A)</bold> t-SNE plots of the four datasets, pre- and post-MARIO integration, colored their origin. <bold>(B)</bold> t-SNE of MARIO integrated plots from each individual dataset, colored by cell type. <bold>(C)</bold> Balanced accuracy for each cell type after MARIO matching, for cells from Rahil et al. to other datasets. <bold>(D)</bold> Euclidean distance of canonical correlations for pairs of matched versus random cells between Rahil et al. to other datasets. <bold>(E)</bold> t-SNE plots with expression levels of Ki-67, pSTAT1 and p38 across the four datasets. <bold>(F)</bold> Violin plot of the normalized expression levels of Ki-67, pSTAT1 and p38 across the four datasets for the specified cell types: CD4 T cells and monocytes.</p></caption><graphic xlink:href="EMS141082-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>MARIO Integration of Suspension and Tissue Single-cell Measurements Enables Spatial Multi-omics</title><p>
<bold>(A)</bold> t-SNE plots of murine spleen CITE-seq and CODEX cells, pre-integration and MARIO integration, colored by the dataset of origin (left and middle) or colored by cell type annotation (right). <bold>(B)</bold> A murine spleen section colored by the cell type annotation from CODEX (top left) or the label transferred annotation from CITE-seq (middle left). Examples of RNA transcripts <italic>((Il7r, Ms4a1, Cxcr5</italic> and <italic>Myc)</italic> and their tissue-specific localization are inferred through MARIO integrative analysis (middle and right columns). An enlarged view of the tissue region demarcated by the orange box is shown in the bottom row. <bold>(C)</bold> Heatmap of differentially expressed genes (from matched CITE-seq cells) among subpopulations of CODEX B cells, gated based on CODEX proteins.</p></caption><graphic xlink:href="EMS141082-f004"/></fig><fig id="F5" position="float"><label>Figure 5</label><caption><title>Integrative Spatial Multi-omic Analysis of Macrophages in COVID-19patients with MARIO</title><p>
<bold>(A)</bold> A schematic of the experimental and MARIO analysis on BALF and lung tissues from COVID-19 patients were measured from two independent studies via CITE-seq (from VIB/Ghent) and CODEX (University Hospital Basel/Stanford). Macrophages from the CODEX lung data were matched to those identified from BALF using CITE-seq using MARIO for integrative analysis. <bold>(B)</bold> Heatmaps of <italic>C1Q</italic> High and Low macrophages identified from CITE-seq, and their matched CITE-seq and CODEX expression patterns. <bold>(C)</bold> A ranked plot for macrophages from each patient in the CODEX data, as a percentage of <italic>C1Q</italic> High proportions. <bold>(D)</bold> Proportion of Neutrophils (as a percentage of all cell types) in each patient from the CODEX data, ranked by the same sequence as in (C). <bold>(E)</bold> A dot plot showing the relationship between C1Q High macrophages (Y axis) and Neutrophil percentage (X axis). Each dot represents a tissue core from the tissue microarray. <bold>(F)</bold> An representative pseudo image of two tissue cores colored with the locations of <italic>C1Q</italic> High and Low macrophages. <bold>(G)</bold> The CODEX multiplexed Images of the same two tissue cores in (F), with CD163, CD68 and CD15 antibody staining. An enlarged view of the region demarcated by the orange box is shown on the right. <bold>(H)</bold> An experimental schematic of PANINI to validate the spatial localization of <italic>C1Q</italic> macrophages on Basel/Stanford COVID-19 tissues. Slides were co-stained with probes detecting <italic>C1QA</italic> mRNA and antibodies targeting CD15 and CD68 proteins. <bold>(I-J)</bold> A dot plot showing the relationship between the proportion of <italic>C1QA</italic> High Macrophages (as a percentage of all macrophages) from the PANINI validation (Y axis) versus the MARIO prediction (X axis) per patient (I) or per tissue core (J). P-values and correlations were calculated using the Spearman-ranked test. <bold>(K)</bold> Anchor plots of Neutrophils as a function of distance from <italic>C1QA</italic> High (magenta) or <italic>C1QA</italic> Low macrophages (green) in MARIO predicted (above) or PANINI validated (below) experiments. <bold>(L-M)</bold> A representative tissue core with MARIO predicted <italic>C1QA</italic> expression levels in macrophages (left), and PANINI validated <italic>C1QA</italic> and CD68 signals (right). <bold>(N)</bold> Spatial-correlations between validation and prediction experiments were performed. The tissue core was divided into 10x10 regions, the summation of <italic>C1QA</italic> signals in macrophages were calculated and plotted for Mario and PANINI validation (P-value and correlation calculated by Spearman-ranked test).</p></caption><graphic xlink:href="EMS141082-f005"/></fig></floats-group></article>