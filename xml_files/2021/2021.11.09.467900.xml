<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS145924</article-id><article-id pub-id-type="doi">10.1101/2021.11.09.467900</article-id><article-id pub-id-type="archive">PPR418789</article-id><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Neural assemblies uncovered by generative modeling explain whole-brain activity statistics and reflect structural connectivity</article-title></title-group><contrib-group><contrib contrib-type="author" equal-contrib="yes"><name><surname>van der Plas</surname><given-names>Thijs L.</given-names></name><xref ref-type="aff" rid="A1">a</xref><xref ref-type="aff" rid="A2">b</xref><xref ref-type="aff" rid="A3">c</xref></contrib><contrib contrib-type="author" equal-contrib="yes"><name><surname>Tubiana</surname><given-names>Jérôme</given-names></name><xref ref-type="aff" rid="A4">d</xref></contrib><contrib contrib-type="author"><name><surname>Le Goc</surname><given-names>Guillaume</given-names></name><xref ref-type="aff" rid="A2">b</xref></contrib><contrib contrib-type="author"><name><surname>Migault</surname><given-names>Geoffrey</given-names></name><xref ref-type="aff" rid="A2">b</xref></contrib><contrib contrib-type="author"><name><surname>Kunst</surname><given-names>Michael</given-names></name><xref ref-type="aff" rid="A5">e</xref><xref ref-type="aff" rid="A6">f</xref></contrib><contrib contrib-type="author"><name><surname>Baier</surname><given-names>Herwig</given-names></name><xref ref-type="aff" rid="A5">e</xref></contrib><contrib contrib-type="author"><name><surname>Bormuth</surname><given-names>Volker</given-names></name><xref ref-type="aff" rid="A2">b</xref><xref ref-type="fn" rid="FN1">**</xref></contrib><contrib contrib-type="author"><name><surname>Englitz</surname><given-names>Bernhard</given-names></name><xref ref-type="aff" rid="A1">a</xref><xref ref-type="fn" rid="FN1">**</xref></contrib><contrib contrib-type="author"><name><surname>Debrégeas</surname><given-names>Georges</given-names></name><xref ref-type="aff" rid="A2">b</xref><xref ref-type="corresp" rid="CR1">g</xref><xref ref-type="fn" rid="FN1">**</xref></contrib></contrib-group><aff id="A1"><label>a</label>Computational Neuroscience Lab, Department of Neurophysiology, Donders Center for Neuroscience, Radboud University, Nijmegen, The Netherlands</aff><aff id="A2"><label>b</label>Sorbonne Université, CNRS, Institut de Biologie Paris-Seine (IBPS), Laboratoire Jean Perrin (LJP), Paris, France</aff><aff id="A3"><label>c</label>Department of Physiology, Anatomy and Genetics, University of Oxford, Oxford, United Kingdom</aff><aff id="A4"><label>d</label>Blavatnik School of Computer Science, Tel Aviv University, Tel Aviv</aff><aff id="A5"><label>e</label>Department Genes – Circuits – Behavior, Max Planck Institute of Neurobiology, 82152 Martinsried, Germany</aff><aff id="A6"><label>f</label>Allen Institute for Brain Science, Seattle, WA 98109, USA</aff><author-notes><corresp id="CR1">
<label>g</label>Corresponding author: <email>georges.debregeas@sorbonne-universite.fr</email> (Georges Debrégeas)</corresp><fn id="FN1" fn-type="equal"><label>**</label><p id="P1">Senior authors with equal contribution</p></fn></author-notes><pub-date pub-type="nihms-submitted"><day>14</day><month>06</month><year>2022</year></pub-date><pub-date pub-type="preprint"><day>10</day><month>06</month><year>2022</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P2">Patterns of endogenous activity in the brain reflect a stochastic exploration of the neuronal state space that is constrained by the underlying assembly organization of neurons. Yet it remains to be shown that this interplay between neurons and their assembly dynamics indeed suffices to generate whole-brain data statistics. Here we recorded the activity from ~40, 000 neurons simultaneously in zebrafish larvae, and show that a data-driven generative model of neuron-assembly interactions can accurately reproduce the mean activity and pairwise correlation statistics of their spontaneous activity. This model, the compositional Restricted Boltzmann Machine (cRBM), unveils ~200 neural assemblies, which compose neurophysiological circuits and whose various combinations form successive brain states. We then performed <italic>in silico</italic> perturbation experiments to determine the interregional functional connectivity, which is conserved across individual animals and correlates well with structural connectivity. Our results showcase how cRBMs can capture the coarse-grained organization of the zebrafish brain. Notably, this generative model can readily be deployed to parse neural data obtained by other large-scale recording techniques.</p></abstract><kwd-group><kwd>Light-Sheet Microscopy</kwd><kwd>Zebrafish</kwd><kwd>Neural Assembly</kwd><kwd>Maximum Entropy</kwd><kwd>Restricted Boltzmann Machine</kwd><kwd>Functional Connectivity</kwd></kwd-group></article-meta></front><body><sec id="S1" sec-type="intro"><label>1</label><title>Introduction</title><p id="P3">The brain is a highly connected network, organized across multiple scales, from local circuits involving just a few neurons to extended networks spanning multiple brain regions (<xref ref-type="bibr" rid="R80">White et al., 1986</xref>; <xref ref-type="bibr" rid="R64">Song et al., 2005</xref>; <xref ref-type="bibr" rid="R40">Kunst et al., 2019</xref>). Concurrent with this spatial organization, brain activity exhibits correlated firing among large groups of neurons, often referred to as neural assemblies (<xref ref-type="bibr" rid="R27">Harris, 2005</xref>). This assembly organization of brain dynamics has been observed in, e.g., auditory cortex (<xref ref-type="bibr" rid="R9">Bathellier et al., 2012</xref>), motor cortex (<xref ref-type="bibr" rid="R51">Narayanan et al., 2005</xref>), prefrontal cortex (<xref ref-type="bibr" rid="R65">Tavoni et al., 2017</xref>), hippocampus (<xref ref-type="bibr" rid="R42">Lin et al., 2005</xref>), retina (<xref ref-type="bibr" rid="R62">Shlens et al., 2009</xref>), and zebrafish optic tectum (<xref ref-type="bibr" rid="R59">Romano et al., 2015</xref>; <xref ref-type="bibr" rid="R48">Mölter et al., 2018</xref>; <xref ref-type="bibr" rid="R17">Diana et al., 2019</xref>; <xref ref-type="bibr" rid="R69">Triplett et al., 2020</xref>). These neural assemblies are thought to form elementary computational units and subserve essential cognitive functions such as short-term memory, sensorimotor computation or decision-making (<xref ref-type="bibr" rid="R29">Hebb, 1949</xref>; <xref ref-type="bibr" rid="R25">Gersteinet al., 1989</xref>; <xref ref-type="bibr" rid="R27">Harris, 2005</xref>; <xref ref-type="bibr" rid="R13">Buzsáki, 2010</xref>; <xref ref-type="bibr" rid="R28">Harris, 2012</xref>; <xref ref-type="bibr" rid="R52">Palm et al., 2014</xref>; <xref ref-type="bibr" rid="R19">Eichenbaum, 2018</xref>). Despite the prevalence of these assemblies across the nervous system and their role in neural computation, it remains an open challenge to extract the assembly organization of a full brain and to show that the assembly activity state, derived from that of the neurons, is sufficient to account for the collective neural dynamics.</p><p id="P4">The need to address this challenge is catalyzed by technological advances in light-sheet microscopy, enabling the simultaneous recording of the majority of neurons in the zebrafish brain at single-cell resolution <italic>in vivo</italic> (<xref ref-type="bibr" rid="R53">Panier et al., 2013</xref>; <xref ref-type="bibr" rid="R5">Ahrens et al., 2013</xref>; <xref ref-type="bibr" rid="R82">Wolf et al., 2015</xref>, <xref ref-type="bibr" rid="R81">2017</xref>; <xref ref-type="bibr" rid="R47">Migault et al., 2018</xref>; <xref ref-type="bibr" rid="R75">Vanwalleghem et al.,2018</xref>). This neural recording technique opens up new avenues for constructing near-complete models of neural activity, and in particular its assembly organization. Recent attempts have been made to identify assemblies using either clustering (<xref ref-type="bibr" rid="R53">Panier et al., 2013</xref>; <xref ref-type="bibr" rid="R68">Triplett et al., 2018</xref>; <xref ref-type="bibr" rid="R14">Chen et al., 2018</xref>; <xref ref-type="bibr" rid="R48">Mölter et al., 2018</xref>; <xref ref-type="bibr" rid="R7">Bartoszek et al., 2021</xref>), dimensionality reduction approaches (<xref ref-type="bibr" rid="R59">Romano et al., 2015</xref>; <xref ref-type="bibr" rid="R50">Mu et al., 2019</xref>) or latent variable models (<xref ref-type="bibr" rid="R17">Diana et al., 2019</xref>; <xref ref-type="bibr" rid="R69">Triplett et al., 2020</xref>), albeit often limited to single brain regions. However, these methods do not explicitly assess to what extent the inferred assemblies could give rise to the observed neural data statistics, which is a crucial property of physiologically meaningful assemblies (<xref ref-type="bibr" rid="R27">Harris, 2005</xref>). Here, we address this challenge by developing a generative model of neural activity that is explicitly constrained by the assembly organization, thereby quantifying if assemblies indeed suffice to produce the observed neural data statistics.</p><p id="P5">Specifically, we formalize neural assemblies using a bipartite network of two connected layers representing the neuronal and the assembly activity, respectively. Together with the maximum entropy principle (<xref ref-type="bibr" rid="R35">Jaynes, 1957</xref>; <xref ref-type="bibr" rid="R11">Bialek, 2012</xref>), this architecture defines the Restrictive Boltzmann Machine (RBM) model (<xref ref-type="bibr" rid="R33">Hinton &amp; Salakhutdinov, 2006</xref>). Here we use an extension to the classical RBM definition termed compositional RBM (cRBM) that we have recently introduced (<xref ref-type="bibr" rid="R73">Tubiana &amp; Monasson, 2017</xref>; <xref ref-type="bibr" rid="R71">Tubiana et al., 2019a</xref>) and which brings multiple advances to assembly-based network modeling: (1) The maximum entropy principle ensures that neural assemblies are inferred solely from the data statistics. (2) The generative nature of the model, through alternate data sampling of the neuronal and assembly layers, can be leveraged to evaluate its capacity to replicate the empirical data statistics, such as the pairwise co-activation probabilities of all neuron pairs. (3) The cRBM steers the assembly organization to the so-called compositional phase where a small number of assemblies are active at any point in time, making the resulting model highly interpretable as we have shown previously for protein sequence analysis (<xref ref-type="bibr" rid="R72">Tubiana et al., 2019b</xref>).</p><p id="P6">Here, we have successfully trained cRBMs to brain-scale, neuron-level recordings of spontaneous activity in larval zebrafish containing 41000 neurons on average (<xref ref-type="bibr" rid="R53">Panier et al., 2013</xref>; <xref ref-type="bibr" rid="R81">Wolf et al., 2017</xref>; <xref ref-type="bibr" rid="R47">Migault et al.,2018</xref>). This represents an increase of ~2 orders of magnitude in number of neurons with respect to previously reported RBM implementations (<xref ref-type="bibr" rid="R39">Köster et al., 2014</xref>; <xref ref-type="bibr" rid="R23">Gardella et al., 2017</xref>; <xref ref-type="bibr" rid="R78">Volpi et al., 2020</xref>), attained through significant algorithmic and computational enhancements. We found that all cells could be grouped into 100-200 partially overlapping assemblies, which are anatomically localized and together span the entire brain, and accurately replicate the first and second order statistics of the neural activity. These assemblies were found to carry more predictive power than a fully connected model which has orders of magnitude more parameters, validating that assemblies underpin collective neural dynamics. Further, the probabilistic nature of our model allowed us to compute a functional connectivity matrix by quantifying the effect of activity perturbations <italic>in silico</italic>. This assembly-based functional connectivity is well-conserved across individual fish and consistent with anatomical connectivity at the mesoscale (<xref ref-type="bibr" rid="R40">Kunst et al., 2019</xref>).</p><p id="P7">In summary, we present an assembly decomposition spanning the zebrafish brain, which accurately accounts for its activity statistics. Our cRBM model provides a widely applicable tool to the community to construct low-dimensional data representations that are defined by the statistics of the data, in particular for very highdimensional systems. Its generative capability further allows to produce new (synthetic) activity patterns that are amenable to direct <italic>in silico</italic> perturbation and ablation studies.</p></sec><sec id="S2" sec-type="results"><label>2</label><title>Results</title><sec id="S3"><label>2.1</label><title>Compositional RBMs construct Hidden Units by grouping neurons into assemblies</title><p id="P8">Spontaneous neural activity was recorded from 8 zebrafish larvae aged 5-7 days post fertilization expressing the GCaMP6s or GCaMP6f calcium reporters using light-sheet microscopy (<xref ref-type="bibr" rid="R53">Panier et al., 2013</xref>; <xref ref-type="bibr" rid="R81">Wolf et al.,2017</xref>; <xref ref-type="bibr" rid="R47">Migault et al., 2018</xref>). Each data set contained the activity of a large fraction of the neurons in the brain (40709 ± 13854; mean ± standard deviation), which, after cell segmentation, were registered onto the ZBrain atlas (<xref ref-type="bibr" rid="R57">Randlett et al., 2015</xref>) and mapzebrain atlas (<xref ref-type="bibr" rid="R40">Kunst et al., 2019</xref>). Individual neuronal fluorescence traces were deconvolved to binarized spike trains using blind sparse deconvolution (<xref ref-type="bibr" rid="R74">Tubiana et al., 2020</xref>). This data acquisition process is depicted in <xref ref-type="fig" rid="F1">Figure 1A</xref>.</p><p id="P9">We trained compositional Restricted Boltzmann Machine (cRBM) models to capture the activity statistics of these neural recordings. cRBMs are maximum entropy models, i.e., the maximally unconstrained solution that fits model-specific data statistics (<xref ref-type="bibr" rid="R33">Hinton &amp; Salakhutdinov, 2006</xref>; <xref ref-type="bibr" rid="R73">Tubiana &amp; Monasson, 2017</xref>; <xref ref-type="bibr" rid="R24">Gardella et al., 2019</xref>), and critically extend the classical RBM formulation. Its architecture consists of a bipartite graph where the high-dimensional layer of neurons <bold>v</bold> (named ‘visible units’ in RBM terminology) is connected to the low-dimensional layer of latent components, termed Hidden Units (HUs) <bold>h</bold>. Their interaction is characterized by a weight matrix <bold>W</bold> that is regularized to be sparse. The collection of neurons that have non-zero interactions with a particular HU, noted <italic>h<sub>μ</sub></italic> (i.e., with |<italic>w<sub>i,μ</sub></italic>| &gt; 0), define its corresponding neural assembly <italic>μ</italic> (<xref ref-type="fig" rid="F1">Figure 1B</xref>). This weight matrix, together with the neuron weight vector <bold>g</bold> and HU potential <inline-formula><mml:math id="M1"><mml:mi mathvariant="script">U</mml:mi></mml:math></inline-formula>, defines the transformation from the binarized neural activity <bold>v</bold>(<italic>t</italic>) to the continuous HU activity <bold>h</bold>(<italic>t</italic>) (<xref ref-type="fig" rid="F1">Figure 1B</xref>). <xref ref-type="fig" rid="F1">Figure 1C</xref> shows all recorded neurons of a zebrafish brain, color-labeled according to their strongest-connecting HU, illustrating that cRBM-inferred assemblies are typically densely localized in space and together span the entire brain.</p><p id="P10">Beyond its architecture (<xref ref-type="fig" rid="F2">Figure 2A</xref>), the model is defined by the probability function <italic>P</italic>(<bold>v</bold>, <bold>h</bold>) of any data configuration (<bold>v</bold>, <bold>h</bold>) (see <xref ref-type="sec" rid="S10">Methods</xref> for details): <disp-formula id="FD1"><label>(1)</label><mml:math id="M2"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>Z</mml:mi></mml:mfrac><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P11">Where <italic>Z</italic> is the partition function that normalizes <xref ref-type="disp-formula" rid="FD1">Equation 1</xref> and <italic>E</italic> is the following energy function: <disp-formula id="FD2"><label>(2)</label><mml:math id="M3"><mml:mrow><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mi>μ</mml:mi></mml:munder><mml:mrow><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p id="P12">HU activity <bold>h</bold> is obtained by sampling from the conditional probability function <italic>P</italic>(<bold>h</bold>|<bold>v</bold>): <disp-formula id="FD3"><label>(3)</label><mml:math id="M4"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo>∣</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>∝</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:mi>exp</mml:mi><mml:mo>(</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p id="P13">Conversely, neural activity is obtained from HU activity through: <disp-formula id="FD4"><label>(4)</label><mml:math id="M5"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo>∣</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>∝</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:mi>exp</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mi>μ</mml:mi></mml:munder><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p id="P14"><xref ref-type="disp-formula" rid="FD3">Equations 3</xref> and <xref ref-type="disp-formula" rid="FD4">4</xref> mathematically reflect the dual relationship between neural and assembly states: the Hidden Units <bold>h</bold> drive ‘visible’ neural activity <bold>v</bold>, expressed as <italic>P</italic>(<bold>v</bold>|<bold>h</bold>), while the stochastic assembly activity <bold>h</bold> itself is defined as a function of the activity of the neurons: <italic>P</italic>(<bold>h</bold>|<bold>v</bold>). Importantly, the model does not include direct connections between neurons, hence neural correlations 〈<italic>v<sub>i</sub>v<sub>j</sub></italic>〉 can arise solely from shared assemblies. Moreover, this bipartite architecture ensures that the conditional distributions factorize, leading to a sampling procedure where all neurons or all HUs can be sampled in parallel. The cRBM leverages this property to efficiently generate new data by Monte Carlo sampling alternately from <italic>P</italic>(<bold>h</bold>|<bold>v</bold>) and <italic>P</italic>(<bold>v</bold>|<bold>h</bold>) (<xref ref-type="fig" rid="F2">Figure 2B</xref>).</p><p id="P15">The cRBM differs from the classical RBM formulation (<xref ref-type="bibr" rid="R33">Hinton &amp; Salakhutdinov, 2006</xref>) through the introduction of double Rectified Linear Unit (dReLU) potentials <inline-formula><mml:math id="M6"><mml:mrow><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> weight sparsity regularization and normalized HU activity (further detailed in <xref ref-type="sec" rid="S10">Methods</xref>). We have previously demonstrated in theory and application (<xref ref-type="bibr" rid="R73">Tubiana &amp; Monasson, 2017</xref>; <xref ref-type="bibr" rid="R71">Tubiana et al., 2019a</xref>,<xref ref-type="bibr" rid="R72">b</xref>) that this new formulation steers the model into the so-called compositional phase, which makes the latent representation highly interpretable. This phase occurs when a limited number <italic>m</italic> of HUs co-activate such that 1 ≪ <italic>m</italic> ≪ <italic>M</italic> where <italic>M</italic> is the total number of HUs. Thus, each visible configuration is mapped to a specific combination of activated HUs. This contrasts with the ferromagnetic phase (<italic>m</italic> ~ 1) where each HU encodes one specific activity pattern, thus severely limiting the possible number of encoded patterns, or the spin-glass phase (<italic>m</italic> ~ <italic>M</italic>) where all HUs activate simultaneously, yielding a very complex assembly patchwork (<xref ref-type="bibr" rid="R73">Tubiana &amp; Monasson, 2017</xref>). Therefore, the compositional phase can provide the right level of granularity for a meaningful interpretation of the cRBM neural assemblies by decomposing the overall activity as a time-dependent co-activation of different assemblies of interpretable size and extent.</p></sec><sec id="S4"><label>2.2</label><title>Trained cRBMs accurately replicate data statistics</title><p id="P16">cRBM models are trained to maximize the <italic>P</italic>(<bold>v</bold>, <bold>h</bold>) log-likelihood of the zebrafish data recordings, which is achieved by matching the model-generated statistics 〈<italic>v<sub>i</sub></italic>〉, 〈<italic>h<sub>μ</sub></italic>〉 and 〈<italic>v<sub>i</sub>h<sub>μ</sub></italic>〉 (the mean neuronal activity, mean HU activity and their correlations, respectively) to the empirical data statistics (<xref ref-type="disp-formula" rid="FD14">Equation 14</xref>). In order to optimize the two free parameters of the cRBM model - the sparsity regularization parameter <italic>λ</italic> and the total number of HUs <italic>M</italic> - we assessed the cRBM performance for a grid of (<italic>λ</italic>, <italic>M</italic>)-values for one data set (fish #3). This analysis yielded an optimum for <italic>λ</italic> = 0.02 and <italic>M</italic> = 200 (<xref ref-type="supplementary-material" rid="SD2">Fig S1</xref>). These values were subsequently used for all recordings, where <italic>M</italic> was scaled with the number of neurons <italic>N</italic>.</p><p id="P17">We trained cRBMs on 70% of the recording length, and compared the statistics of model-generated data to the withheld test data set (the remaining 30% of recording, see <xref ref-type="sec" rid="S10">Methods</xref> for details). After convergence, the cRBM generated data that replicated the training statistics accurately, with normalized Root Mean Square Error (nRMSE) values of nRMSE<sub>〈<italic>v<sub>i</sub></italic>〉</sub> = 0.11, nRMSE<sub>〈<italic>h<sub>μ</sub></italic>〉</sub> = 0.15 and nRMSE<sub>〈<italic>v<sub>i</sub>h<sub>μ</sub></italic>〉</sub> = 0.09 (<xref ref-type="fig" rid="F2">Figures 2C-E</xref>). Here, nRMSE is normalized such that 1 corresponds to shuffled data statistics and 0 corresponds to the best possible RMSE, i.e., between train and test data.</p><p id="P18">We further evaluated cRBM performance to assess its ability to capture data statistics that the cRBM was not explicitly trained to replicate: the pairwise correlations between neurons 〈<italic>v<sub>i</sub>v<sub>j</sub></italic>〉 and the pairwise correlations between HUs 〈<italic>h<sub>μ</sub>h<sub>ν</sub></italic>〉. We found that these statistics were also accurately replicated by model-generated data, with nRMSE 〈<italic>v<sub>i</sub>v<sub>j</sub></italic>〉 = −0.09 (meaning that the model slightly outperformed the train-test data difference) and nRMSE 〈<italic>h<sub>μ</sub>h<sub>ν</sub></italic>〉 = 0.17 (<xref ref-type="fig" rid="F2">Figures 2F, G</xref>). The fact that cRBM also accurately replicated neural correlations 〈<italic>v<sub>i</sub>v<sub>j</sub></italic>〉 (<xref ref-type="fig" rid="F2">Figure 2F</xref>) is of particular relevance, since this indicates that (1) the assumption that neural correlations can be explained by their shared assemblies is justified and (2) cRBMs may provide an efficient mean to model neural interactions of such large systems (<italic>N</italic> ~ 10<sup>4</sup>) where directly modeling all <italic>N</italic><sup>2</sup> interactions would be computationally infeasible or not sufficiently constrained by the available data.</p><p id="P19">Next, we assessed the reconstruction quality after neural data was compressed by the cRBM low-dimensional bottleneck. This is important to prevent trivial, undesired solutions like <italic>w<sub>i,μ</sub></italic> = 0 ∀ <italic>i</italic>, <italic>μ</italic> which would directly lead to 〈<italic>h<sub>μ</sub></italic>〉<sub><italic>P</italic>(<bold>v</bold>,<bold>h</bold>)</sub> = 〈<italic>h<sub>μ</sub></italic>〉<sub>data</sub> = 0 (potentially because of strong sparsity regularization). <xref ref-type="fig" rid="F2">Figure 2H</xref> shows the distribution of cRBM reconstruction quality of all neurons (in purple), quantified by the normalized log-likelihood (nLLH) such that 0 corresponds to an independent model (<italic>P</italic>(<italic>v<sub>i</sub></italic>(<italic>t</italic>)) = 〈<italic>v<sub>i</sub></italic>〉) and 1 corresponds to perfect reconstruction (non-normalized LLH = 0). For comparison, we also reconstructed the neural activity using a fully connected Generalized Linear Model (GLM, see <xref ref-type="sec" rid="S10">Methods</xref> and <xref ref-type="supplementary-material" rid="SD2">Figures S2</xref>, <xref ref-type="supplementary-material" rid="SD2">2H</xref>, blue). The cRBM nLLH distribution is significantly greaterthan the GLM nLLH distribution (one-sided Mann Whitney U test, <italic>P</italic> &lt; 10<sup>−42</sup>), with medians LLH<sub>cRBM</sub> = 0.24 and LLH<sub>GLM</sub> = 0.20. Hence, projecting the neural data onto the low-dimensional representation of the HUs does not compromise the ability to explain the neural activity. In fact, reconstruction quality of the cRBM slightly outperforms the GLM, possibly due to the suppression of noise in the cRBM estimate. The optimal (<italic>λ</italic> = 0.02, <italic>M</italic> = 200) choice of free parameters was selected by cross-validating the median of the cRBM reconstruction quality, together with the normalized RMSE of the 5 previously described statistics (<xref ref-type="supplementary-material" rid="SD2">Figure S1</xref>).</p><p id="P20">Lastly, we confirmed that the cRBM indeed resides in the compositional phase, characterized by 1 ≪ <italic>m</italic>(<italic>t</italic>) ≪ <italic>M</italic> where <italic>m</italic>(<italic>t</italic>) is the number of HUs active at time point <italic>t</italic> (<xref ref-type="supplementary-material" rid="SD2">Figure S3A</xref>). This property is a consequence of the sparse weight matrix <bold>W</bold>, indicated by its heavy-tail log-distribution (<xref ref-type="fig" rid="F2">Figure 2I</xref>, purple). The compositional phase is the norm for the presently estimated cRBMs, evidenced by the distribution of median <italic>m</italic>(<italic>t</italic>) values for all recordings (average <inline-formula><mml:math id="M7"><mml:mrow><mml:mfrac><mml:mrow><mml:mtext>median</mml:mtext><mml:mo>(</mml:mo><mml:mi>m</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mi>M</mml:mi></mml:mfrac></mml:mrow></mml:math></inline-formula> is 0.26, see <xref ref-type="supplementary-material" rid="SD2">Figure S3B</xref>). Importantly, the sparse weight matrix does not automatically imply that only a small subset of neurons is connected to the cRBM hidden layer. We validated this by observing that more neurons strongly connect to the hidden layer than expected by shuffling the weight matrix (<xref ref-type="fig" rid="F2">Figure 2J</xref>).</p><p id="P21">Sparsity facilitated that each assembly only connects to a handful of anatomical regions, as we quantified by calculating the overlap between cRBM assemblies and anatomical regions (<xref ref-type="supplementary-material" rid="SD2">Figure S4</xref>). We found that cRBM assemblies connect to a median of 3 regions (interquartile range: 2 to 6 regions). Importantly, the cRBM has no information about the locations of neurons during training, so the localization to a limited set of anatomical areas that we observe is extracted from the neural co-activation properties alone. For comparison, Principal Component Analysis (PCA), a commonly used non-sparse dimensionality reduction method that shares the cRBM architecture, naturally converged to a non-sparse weight matrix (<xref ref-type="fig" rid="F2">Figure 2I</xref>, yellow), with fewer connected neurons than expected by shuffling its weight matrix (<xref ref-type="fig" rid="F2">Figure 2K</xref>). This led to unspecific assemblies that are difficult to interpret by anatomy (<xref ref-type="supplementary-material" rid="SD2">Figure S4</xref>). As a result, sparsity, a cRBM property shared with some other dimensionality reduction techniques, is crucial to interpret the assemblies by anatomy as we demonstrate in the next section. Other clustering or dimensionality reduction methods, such as k-means, PCA and non-negative matrix factorization, have been used previously to cluster neurons in the zebrafish brain (<xref ref-type="bibr" rid="R14">Chen et al., 2018</xref>; <xref ref-type="bibr" rid="R50">Mu et al., 2019</xref>; <xref ref-type="bibr" rid="R44">Marques et al., 2020</xref>). However, because these methods cannot generate artificial neural data using their inferred assemblies, their quality cannot be quantitatively assessed as we have done for the cRBM (but see <xref ref-type="bibr" rid="R71">Tubiana et al. (2019a)</xref> for other comparisons).</p></sec><sec id="S5"><label>2.3</label><title>cRBM assemblies compose functional circuits and anatomical structures</title><p id="P22">Above, we have shown that cRBMs converge to sparse weight matrix solutions. This property enables us to visualize the neural assemblies as the collection of significantly connected neurons to an HU. Neurons from a given neural assembly display concerted dynamics, and so one may expect their spatial organization to reflect the neuroanatomy and functional organization of the brain. We here highlight a selection of salient examples of neural assemblies, illustrating that assemblies match well with anatomical structures and functional circuits, while the complete set of neural assemblies is presented in <xref ref-type="supplementary-material" rid="SD1">Supplementary Video 1</xref>. In particular, we identified assemblies that together compose a neural circuit, are neurotransmitter-specific, encompass a long-range pathway, or can be identified by anatomy. The examples shown here are from a single fish (#3), but results from other fish were comparable.</p><p id="P23">First, we identified six assemblies that together span the hindbrain circuit that drives eye and tail movements (<xref ref-type="bibr" rid="R18">Dunn et al., 2016</xref>; <xref ref-type="bibr" rid="R81">Wolf et al., 2017</xref>; <xref ref-type="bibr" rid="R14">Chen et al., 2018</xref>). We find two neural assemblies in rhombomere 2 which align with the anterior rhombencephalic turning region (ARTR, (<xref ref-type="bibr" rid="R5">Ahrens et al., 2013</xref>; <xref ref-type="bibr" rid="R18">Dunn et al., 2016</xref>; <xref ref-type="bibr" rid="R81">Wolf et al., 2017</xref>), <xref ref-type="fig" rid="F3">Figure 3A-B</xref>). Each assembly primarily comprises neurons of either the left or right side of the ARTR, but also includes a small subset of contralateral neurons with weights of opposite sign in line with the established mutual inhibition between both subpopulations. Two other symmetric assemblies (<xref ref-type="fig" rid="F3">Figure 3C, D</xref>) together encompass the oculomotor nucleus (nIII) and the contralateral abducens nucleus (nVI, in rhombomere 6), two regions engaged in ocular saccades (<xref ref-type="bibr" rid="R43">Ma et al., 2014</xref>) and under the control of the ARTR (<xref ref-type="bibr" rid="R81">Wolf et al.,2017</xref>). Additionally, we observed two symmetric assemblies (<xref ref-type="fig" rid="F3">Figure 3E, F</xref>) in the posterior hindbrain (in rhom-bomere 7), in a region known to drive unilateral tail movements (<xref ref-type="bibr" rid="R14">Chen et al., 2018</xref>; <xref ref-type="bibr" rid="R44">Marques et al., 2020</xref>) and whose antiphasic activation is also controlled by the ARTR activity (<xref ref-type="bibr" rid="R18">Dunn et al., 2016</xref>).</p><p id="P24">Next, we observed assemblies that correspond to particular neurotransmitter expressions in the ZBrain atlas (<xref ref-type="bibr" rid="R57">Randlett et al., 2015</xref>), such as the excitatory Vglut2 (<xref ref-type="fig" rid="F3">Figure 3G</xref>) and inhibitory Gad1b (<xref ref-type="fig" rid="F3">Figure 3H</xref>) neurotransmitters. These assemblies consist of multiple dense loci that sparsely populate the entire brain, confirming that cRBMs are able to capture a large morphological diversity of neural assemblies. <xref ref-type="fig" rid="F3">Figure 3I</xref> depicts another sparse, brain-wide assembly that encompasses the pallium, habenula (Hb) and interpeduncular nucleus (IPN), and thus captures the Hb-IPN pathway that connects to other regions such as the pallium (<xref ref-type="bibr" rid="R10">Beretta et al., 2012</xref>; <xref ref-type="bibr" rid="R7">Bartoszek et al., 2021</xref>).</p><p id="P25">Larger nuclei or circuits were often composed of a small number of distinct neural assemblies with some overlap. For example, the cerebellum was decomposed into multiple, bilateral assemblies (<xref ref-type="fig" rid="F3">Figure 3J</xref>) whereas neurons in the torus semicircularis were grouped per brain hemisphere (<xref ref-type="fig" rid="F3">Figure 3K</xref>). As a last example, the optictectum was composed of a larger set of approximately 18 neural assemblies, which spatially tiled the volume of the optictectum (<xref ref-type="fig" rid="F3">Figure 3L</xref>). This particular organization is suggestive of spatially localized interactions within the optic tectum, and aligns with the morphology of previously inferred assemblies in this specific region (<xref ref-type="bibr" rid="R59">Romano et al., 2015</xref>; <xref ref-type="bibr" rid="R17">Diana et al., 2019</xref>; <xref ref-type="bibr" rid="R69">Triplett et al., 2020</xref>). However, <xref ref-type="fig" rid="F3">Figure 3</xref> altogether demonstrates that the typical assembly morphology of the optic tectum identified by our and these previous analyses does not readily generalize to other brain regions, where a large range of different assembly morphologies compose neural circuits.</p><p id="P26">Overall, the clear alignment of cRBM-based neural assemblies with anatomical regions and circuits suggests that cRBMs are able to identify anatomical structures from dynamical activity alone, which enables them to break down the overall activity into parts that are interpretable by physiologists in the context of previous, more local studies.</p></sec><sec id="S6"><label>2.4</label><title>HU dynamics cluster into groups and display slower dynamics than neurons</title><p id="P27">HU activity, defined as the expected value of <italic>P</italic>(<bold>h</bold>|<bold>v</bold>) (<xref ref-type="disp-formula" rid="FD9">Equation 9</xref>), exhibits a rich variety of dynamical patterns (<xref ref-type="fig" rid="F4">Figure 4A</xref>). HUs can activate very transiently, slowly modulate their activity, or display periods of active and inactive states of comparable duration. <xref ref-type="fig" rid="F4">Figure 4B</xref> highlights a few HU activity traces that illustrate this diversity of HU dynamics. The top three panels of <xref ref-type="fig" rid="F4">Figure 4B</xref> show the dynamics of the assemblies of <xref ref-type="fig" rid="F3">Figure 3A-F</xref> which encompass the ARTR hindbrain circuit that controls saccadic eye movements and directional tail flips. HUs 99 and 161 drive the left and right ARTR and display antiphasic activity with long dwell times of ~15s, in accordance with previous studies (<xref ref-type="bibr" rid="R5">Ahrens et al., 2013</xref>; <xref ref-type="bibr" rid="R18">Dunn et al., 2016</xref>; <xref ref-type="bibr" rid="R81">Wolf et al., 2017</xref>). HU 102 and 163 correspond to the oculomotor neurons in the nuclei nIII and nVI that together drive the horizontal saccades. Their temporal dynamics are locked to that of the ARTR units in line with the previously identified role of ARTR as a pacemaker for the eye saccades (<xref ref-type="bibr" rid="R81">Wolf et al., 2017</xref>). HUs 95 and 135, which drive directional tail flips, display transient activations that only occur when the ipsilateral ARTR-associated HU is active. This is consistent with the previous finding that the ARTR alternating activation pattern sets the orientation of successive tail flips accordingly (<xref ref-type="bibr" rid="R18">Dunn et al., 2016</xref>). The fourth panel shows the traces of the brain-wide assemblies of <xref ref-type="fig" rid="F3">Figures 3G, I</xref>, displaying slow tonic modulation of their activity. Finally, the bottom panel, which corresponds to the collective dynamics of assembly 122 (<xref ref-type="fig" rid="F3">Figure 3H</xref>), comprises short transient activity that likely corresponds to fictive swimming events.</p><p id="P28">Some HUs regularly co-activate, leading to strong correlations between different HUs. This is quantified by their Pearson correlation matrix shown in <xref ref-type="fig" rid="F4">Figure 4C</xref> (top), which reveals clusters of correlated HUs. These were grouped using hierarchical clustering (<xref ref-type="fig" rid="F4">Figure 4C</xref>, bottom), and we then manually identified their main anatomical location (top labels). We further observed that HU activity is bimodal, as evidenced by the distribution of all HU activity traces in <xref ref-type="fig" rid="F4">Figure 4D</xref>. This bimodality can emerge because the dReLU potentials <inline-formula><mml:math id="M8"><mml:mrow><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>(<xref ref-type="disp-formula" rid="FD13">Equation 13</xref>) can learn to take different shapes, including a double-well potential that leads to bimodal dynamics (see <xref ref-type="sec" rid="S10">Methods</xref>). This allows us to effectively describe HU activity as a two-state system, where <italic>h<sub>μ</sub></italic>(<italic>t</italic>) &gt; 0 increases the probability to spike (<italic>P</italic>(<italic>v<sub>i</sub></italic>(<italic>t</italic>) = 1)) for its positively connected neurons, and <italic>h<sub>μ</sub></italic>(<italic>t</italic>) &lt; 0 decreases their probability to spike. The binarized neuron activity is also a two-state system (spiking or not spiking), which enabled us to compare the time constants of neuron and HU state changes, quantified by the median time between successive onsets of activity. We find that HUs, which represent the concerted dynamics of neuronal assemblies, operate on a slower time scale than individual neurons (<xref ref-type="fig" rid="F4">Figure 4E</xref>). This observation aligns with the expected difference between cellular and circuit-level time scales.</p></sec><sec id="S7"><label>2.5</label><title>cRBM embodies functional connectivity that is strongly correlated across individuals</title><p id="P29">The probabilistic nature of cRBMs uniquely enables <italic>in silico</italic> perturbation experiments to estimate the functional connection <italic>J<sub>ij</sub></italic> between pairs of neurons, where <italic>J<sub>ij</sub></italic> is quantified by directly perturbing the activity of neuron <italic>j</italic> and observing the change in probability to spike of neuron <italic>i</italic>. We first defined the generic, symmetric functional connection <italic>J<sub>ij</sub></italic> using <italic>P</italic>(<italic>v<sub>i</sub></italic>|<italic>v<sub>j</sub></italic>, <italic>v</italic><sub><italic>k</italic>≠<italic>i,j</italic></sub>) (<xref ref-type="disp-formula" rid="FD15">Equation 15</xref>) and then used <italic>P</italic>(<bold>v</bold>) (<xref ref-type="disp-formula" rid="FD12">Equation 12</xref>) to derive the cRBM-specific <italic>J<sub>ij</sub></italic> (<xref ref-type="disp-formula" rid="FD17">Equation 17</xref>, see <xref ref-type="sec" rid="S10">Methods</xref>). Using this definition of <italic>J<sub>ij</sub></italic>, we constructed a full neuron-to-neuron effective connectivity matrix for each zebrafish recording. We then asked whether this cRBM-inferred connectivity matrix was robust across individuals. For this purpose we calculated the functional connections between anatomical regions, given by the assemblies that occupy each region, because neuronal identities can vary across individual specimen. For this purpose we considered anatomical regions as defined by the mapzebrain atlas (<xref ref-type="bibr" rid="R40">Kunst et al., 2019</xref>) for which a regional-scale structural connectivity matrix exists to which we will compare our functional connectivity matrix.</p><p id="P30">We aggregated neurons using the <italic>L</italic><sub>1</sub> norm for each pair of anatomical regions to determine the functional connection between regions (see <xref ref-type="sec" rid="S10">Methods</xref>). This led to a symmetrical functional connectivity matrix for each animal, three of which are shown in <xref ref-type="fig" rid="F5">Figure 5A-C</xref> (where non-imaged regions are left blank, and all 8 animals are shown in <xref ref-type="supplementary-material" rid="SD2">Figure S5</xref>). The strength of functional connections is distributed approximately log-normal (<xref ref-type="fig" rid="F5">Figure 5D</xref>), similar to the distribution of structural region-to-region connections (<xref ref-type="bibr" rid="R40">Kunst et al., 2019</xref>). To quantify the similarity between individual fish, we computed the Pearson correlation between each pair of fish. Functional connectivity matrices correlate strongly across individuals, with an average Pearson correlation of 0.69 (<xref ref-type="fig" rid="F5">Figures 5E and F</xref>).</p><p id="P31">We conclude that similar functional circuits spontaneously activate across individuals, despite the limited 270 duration of neural recordings (~25 minutes), which can be identified across fish using independently estimated cRBMs. In the next section we aggregate these individual matrices to a general functional connectivity matrix for comparison with the zebrafish structural connectivity matrix.</p></sec><sec id="S8"><label>2.6</label><title>cRBM-inferred functional connectivity reflects structural connectivity</title><p id="P32">In the previous section we have determined the functional connections between anatomical regions using the cRBM assembly organization. Although functional connectivity stems from the structural (i.e., biophysical) connections between neurons, it can reflect correlations that arise through indirect network interactions (<xref ref-type="bibr" rid="R8">Bassett &amp; Sporns, 2017</xref>; <xref ref-type="bibr" rid="R16">Das &amp; Fiete, 2020</xref>). Using recently published structural connectivity data of the zebrafish brain (<xref ref-type="bibr" rid="R40">Kunst et al., 2019</xref>), we are now able to quantify the overlap between a structurally defined connectivity matrix and our functional connectivity matrix estimated through neural dynamics. <xref ref-type="bibr" rid="R40">Kunst et al. (2019)</xref> determined a zebrafish structural connectivity matrix between 72 anatomical regions using structural imaging data from thousands of individually Green Fluorescent Protein (GFP)-labeled neurons from multiple animals. We slightly extended this matrix by using the most recent data, filtering indirect connections and accounting for the resulting sampling bias (<xref ref-type="fig" rid="F6">Figure 6A</xref>, regions that were not imaged in our light-sheet microscopy experiments were excluded). Next, we aggregated the functional connectivity matrices of all our calcium imaging recordings to one grand average functional connectivity matrix (<xref ref-type="fig" rid="F6">Figure 6B</xref>).</p><p id="P33">For comparison, we also calculated the connectivity matrices defined by either covariance or Pearson correlation (<xref ref-type="supplementary-material" rid="SD2">Figure S6</xref>). The cRBM functional connectivity spans a larger range of values than either of these methods, leading to a more fine-grained connectivity matrix akin to the structural connectivity map (<xref ref-type="fig" rid="F6">Figure 6B</xref>). This greater visual resemblance was statistically confirmed by calculating the Spearman correlation between structural and functional connectivity, which is greater for cRBM (<italic>r</italic><sub>S</sub> = 0.39, <xref ref-type="fig" rid="F6">Figure 6C</xref>), than for covariance-based connectivity (<italic>r</italic><sub>S</sub> = 0.18, <xref ref-type="supplementary-material" rid="SD2">Figure S6</xref> left) or correlation-based connectivity (<italic>r</italic><sub>S</sub> = 0.26, <xref ref-type="supplementary-material" rid="SD2">Figure S6</xref> right). Hence, using recordings of ~25 minutes on average, cRBMs were able to identify functional connections that resemble the anatomical connectivity between brain regions. Strong or weak functional connections are predictive of present or absent structural connections respectively (<xref ref-type="fig" rid="F6">Figure 6D</xref>), and could thus potentially be used for inference in systems where the structural connectivity pattern is unknown.</p></sec></sec><sec id="S9" sec-type="discussion"><label>3</label><title>Discussion</title><p id="P34">We have developed a cRBM model that accurately replicated the data statistics of brain-scale zebrafish recordings, thereby forming neural assemblies that spanned the entire brain. The objective of our study was threefold: first, to show that the cRBM model can be applied to high-dimensional data, such as whole-brain recordings, second, to prove that an assembly-based model is sufficient to generate whole-brain neural data statistics, and third, to describe the physiological properties of the assembly organization in the zebrafish brain and use it to create a functional connectivity map. We have shown that, after convergence, the cRBM-generated data not only replicated the data statistics that it was constrained to fit, but also extrapolated to fit the pairwise correlation statistics of neurons and HUs, leading to a better reconstruction of neural data than a fully connected GLM (<xref ref-type="fig" rid="F2">Figure 2</xref>). These results thereby quantify how neural assemblies play a major role in determining the collective dynamics of the brain. To achieve this, cRBMs formed sparsely localized assemblies that spanned the entire brain, facilitating their biological interpretation (<xref ref-type="fig" rid="F3">Figure 3</xref>, <xref ref-type="supplementary-material" rid="SD2">S4</xref>, <xref ref-type="fig" rid="F4">4</xref>). Further, the probabilistic nature of the cRBM model allowed us to create a mesoscale functional connectivity map that was largely conserved across individual fish and correlated well with structural connectivity (<xref ref-type="fig" rid="F5">Figures 5</xref>, <xref ref-type="fig" rid="F6">6</xref>).</p><p id="P35">The maximum entropy principle underlying the cRBM definition has been a popular method for inferring pairwise effective connections between neurons or assemblies of co-activating cells (<xref ref-type="bibr" rid="R61">Schneidman et al., 2006</xref>; <xref ref-type="bibr" rid="R65">Tavoni et al., 2017</xref>; <xref ref-type="bibr" rid="R20">Ferrari et al., 2017</xref>; <xref ref-type="bibr" rid="R46">Meshulam et al., 2017</xref>; <xref ref-type="bibr" rid="R55">Posani et al., 2018</xref>; <xref ref-type="bibr" rid="R15">Chen et al., 2019</xref>). However, its computational cost has limited this pairwise connectivity analysis to typically ~10<sup>2</sup> neurons. The two-layer cRBM model that we used here alleviates this burden, because the large number of neuron-to-neuron connections are no longer explicitly optimized, which enables a fast data sampling procedure (<xref ref-type="fig" rid="F2">Figure 2B</xref>). However, we have shown that these connections are still estimated indirectly with high accuracy via the assemblies they connect to (<xref ref-type="fig" rid="F2">Figure 2F</xref>). We have thus shown that the cRBM is able to infer the <inline-formula><mml:math id="M9"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msup><mml:mi>N</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>≈</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mn>9</mml:mn></mml:msup></mml:mrow></mml:math></inline-formula> (symmetric) pairwise connections through its assembly structure, a feat that is computationally infeasible for many other methods.</p><p id="P36">Previously, we have extensively compared cRBM performance to other dimensionality reduction techniques, including Principal Component Analysis (PCA), Independent Component Analysis (ICA), Variational Autoencoders (VAEs) and their sparse variants, using protein sequence data as a benchmark (<xref ref-type="bibr" rid="R71">Tubiana et al., 2019a</xref>). Briefly put, we showed that PCA and ICA could not accurately model the system due to their deterministic nature, putting too much emphasis on low-probability high-variance states, while VAEs were unable to capture all features of data due to the unrealistic assumption of independent, Gaussian-distributed latent variables. Additionally, while PCA has previously been successful in describing zebrafish neural dynamics in terms of their main covariances modes (<xref ref-type="bibr" rid="R4">Ahrens et al., 2012</xref>; <xref ref-type="bibr" rid="R44">Marques et al., 2020</xref>), we show here that it is not appropriate for assembly extraction due to the absence of both a compositional and stochastic nature (<xref ref-type="fig" rid="F2">Figures 2</xref>, <xref ref-type="supplementary-material" rid="SD2">S4</xref>). Furthermore, we have shown that the generative component of cRBM models is essential for quantitatively assessing that the assembly organization is sufficient for reproducing neural statistics (<xref ref-type="fig" rid="F2">Figure 2</xref>), moving beyond deterministic clustering analyses such as k-means (<xref ref-type="bibr" rid="R53">Panier et al., 2013</xref>; <xref ref-type="bibr" rid="R14">Chen et al., 2018</xref>), similarity graph clustering (<xref ref-type="bibr" rid="R48">Mölter et al., 2018</xref>) or non-negative matrix factorization (<xref ref-type="bibr" rid="R50">Mu et al., 2019</xref>).</p><p id="P37">After having quantitatively validated the resultant assemblies, we moved to discussing the biological implications of our findings. Previous studies of the zebrafish optic tectum have identified neural assemblies that were spatially organized into single dense clusters of cells (<xref ref-type="bibr" rid="R59">Romano et al., 2015</xref>; <xref ref-type="bibr" rid="R17">Diana et al., 2019</xref>; <xref ref-type="bibr" rid="R69">Triplett et al., 2020</xref>). We have replicated these findings by observing the distinct organization of ball-shaped assemblies in the optic tectum (<xref ref-type="fig" rid="F3">Figure 3L</xref>). However, our data extends to many other anatomical regions in the brain, where we found that assemblies can be much more dispersed, albeit still locally dense, consisting of multiple clusters of neurons (<xref ref-type="fig" rid="F3">Figure 3</xref>).</p><p id="P38">cRBM allowed us to compute the effective, functional connections between each pair of neurons, aggregated to functional connections between each pair of regions, by perturbing neural activity <italic>in silico</italic>. Importantly, we found that this region-scale connectivity is well-conserved across specimen. This observation is non-trivial because each recording only lasted ~25 minutes, which represents a short trajectory across accessible brain states. It suggests that, although each individual brain may be unique at the neuronal scale, the functional organization could be highly stereotyped at a sufficiently coarse-grained level.</p><p id="P39">It would be naive to assume that these functional connections equate biophysical, structural connections (<xref ref-type="bibr" rid="R16">Das &amp; Fiete, 2020</xref>). Both represent different, yet interdependent aspects of the brain organization. Indeed, we found that structural connectivity is well-correlated to functional connectivity, confirming that functional links are tied to the structural blueprint of brain connectivity (<xref ref-type="fig" rid="F6">Figure 6</xref>). Furthermore, strong (weak) functional connections are predictive of present (absent) structural connections between brain regions, though intermediate values are ambiguous.</p><p id="P40">It will be crucial to synergistically merge structural and dynamic information of the brain to truly comprehend brain-wide functioning (<xref ref-type="bibr" rid="R6">Bargmann &amp; Marder, 2013</xref>; <xref ref-type="bibr" rid="R38">Kopell et al., 2014</xref>). Small brain organisms are becoming an essential means to this end, providing access to a relatively large fraction of cells (<xref ref-type="bibr" rid="R3">Ahrens &amp; En-gert, 2015</xref>). To generate new scientific insights it is thus essential to develop analytical methods that can scale with the rapidly growing size of both structural and dynamic data (<xref ref-type="bibr" rid="R30">Helmstaedter, 2015</xref>; <xref ref-type="bibr" rid="R2">Ahrens, 2019</xref>). In this study we have established that the cRBM can model high-dimensional data accurately, and that its application to zebrafish recordings was crucial to unveil their brain-scale assembly organization. In future studies, cRBMs could be used to generate artificial data whose statistics replicate those of the zebrafish brain. This could be used for further <italic>in silico</italic> ablation and perturbation studies with strong physiological footing, crucial for developing hypotheses for future experimental work (<xref ref-type="bibr" rid="R36">Jazayeri &amp; Afraz, 2017</xref>; <xref ref-type="bibr" rid="R16">Das &amp; Fiete, 2020</xref>). Lastly, the application of cRBMs is not specific to calcium imaging data, and can therefore be readily applied to high-dimensional neural data obtained by other recording techniques.</p></sec><sec id="S10" sec-type="methods" specific-use="web-only"><label>7</label><title>Methods</title><sec id="S11"><label>7.0.2</label><title>Zebrafish larvae</title><p id="P41">Experiments were conducted on nacre mutants, aged 5-7 days post-fertilization (dpf). Larvae were reared in Petri dishes at 28°C in embryo medium (E3) on a 14/10h light/dark cycle, and were fed powdered nursery food every day from 6 dpf. They were expressing either the calcium reporter GCaMP6s (fish 1-4, 6 and 8) or GCaMP6f (fish 5 and 7) under the control of the nearly pan-neuronal promoter elavl3 expressed in the nucleus <italic>Tg</italic>(<italic>elavl3:H2B-GCaMP6</italic>). Both lines were provided by Misha Ahrens and published by <xref ref-type="bibr" rid="R77">Vladimirov et al. (2014)</xref> (H2B-GCaMP6s) and <xref ref-type="bibr" rid="R56">Quirin et al. (2016)</xref> (H2B-GCaMP6f). Experiments were approved by Le Comité d’ Éthique pour l’ Experimentation Animale Charles Darwin C2EA-05 (02601.01).</p></sec><sec id="S12"><label>7.0.3</label><title>Light-sheet microscopy of zebrafish larvae</title><p id="P42">Spontaneous neural activity (i.e., in the absence of sensory stimulation) was recorded in larval zebrafish using light-sheet microscopy, which acquires brain-scale scans by imaging multiple <italic>z</italic>-planes sequentially (<xref ref-type="bibr" rid="R53">Panier et al., 2013</xref>; <xref ref-type="bibr" rid="R81">Wolf et al., 2017</xref>; <xref ref-type="bibr" rid="R47">Migault et al., 2018</xref>). Larvae were placed in 2% low melting point agarose (Sigma-Aldrich), drawn tail-first into a glass capillary tube with 1mm inner diameter via a piston and placed in chamber filled with E3 in the microscope. Recordings were of length 1514 ± 238 seconds (mean ± standard deviation), with a brain volume imaging frequency of 3.9 ± 0.8 Hz.</p><p id="P43">The following imaging pre-processing steps were performed offline using MATLAB, in line with previously reported protocols (<xref ref-type="bibr" rid="R53">Panier et al., 2013</xref>; <xref ref-type="bibr" rid="R47">Migault et al., 2018</xref>). Automated cell segmentation was performed using a watershed algorithm (<xref ref-type="bibr" rid="R53">Panier et al., 2013</xref>; <xref ref-type="bibr" rid="R47">Migault et al., 2018</xref>) and fluorescence values of pixels belonging to the same neuron was averaged to obtain cell measurements. The fluorescence intensity values <italic>F</italic> were normalized to Δ<italic>F</italic>/<italic>F</italic> = (<italic>F</italic> − 〈<italic>F</italic>〉)/(〈<italic>F</italic>〉 − <italic>F</italic><sub>0</sub>) where 〈<italic>F</italic>〉 is the baseline signal per neuron and <italic>F</italic><sub>0</sub> is the overall background intensity (<xref ref-type="bibr" rid="R47">Migault et al., 2018</xref>). The Δ<italic>F</italic>/<italic>F</italic> activity of different imaging planes was subsequently temporally aligned using interpolation (because of the time delay between imaging planes) (<xref ref-type="bibr" rid="R47">Migault et al., 2018</xref>) and deconvolved to binarized spike traces using Blind Sparse Deconvolution (BSD) (<xref ref-type="bibr" rid="R74">Tubiana et al., 2020</xref>). BSD estimates the most likely binary spike trace by minimizing the <italic>L</italic><sub>2</sub> norm of the difference between the estimated spike trace convolved with an exponential kernel and the ground-truth calcium data, using <italic>L</italic><sub>1</sub> sparsity regularization and online hyperparameter optimization. Calcium kernel time constants used for deconvolution were inferred using BSD on the spontaneous activity of three different fish (approximately 5000 neurons per fish, recorded at 10Hz, previously reported by <xref ref-type="bibr" rid="R47">Migault et al. (2018)</xref>). For the GCaMP6s line, we used a rise time of 0.2s and a decay time of 3.55s; for the GCaMP6f line, we used 0.15s and 1.6s, respectively.</p><p id="P44">Brain activity was recorded of 15 animals in total. Of these recordings, 1 was discarded because of poor image quality and 6 were discarded because neurons were inactive (defined by less than 0.02 spikes/(neurons × time points)), hence leaving 8 data sets for further analysis. The recorded brains were then registered onto the ZBrain Atlas (<xref ref-type="bibr" rid="R57">Randlett et al., 2015</xref>) and the mapzebrain atlas (<xref ref-type="bibr" rid="R40">Kunst et al., 2019</xref>) for anatomical labeling of neurons (<xref ref-type="bibr" rid="R47">Migault et al., 2018</xref>). The ZBrain Atlas was used in <xref ref-type="fig" rid="F1">figures 1</xref>-<xref ref-type="fig" rid="F4">4</xref> because of its detailed region descriptions (outlining 294 regions in total). However, we also registered our data to the mapzebrain atlas (72 regions in total) in order to compare our results with the structural connectivity matrix which was defined for this atlas only (<xref ref-type="bibr" rid="R40">Kunst et al., 2019</xref>). Only neurons that were registered to at least 1 ZBrain region were used for analysis (to filter imaging artefacts). This resulted in 40709 ± 13854 neurons per recording (mean ± standard deviation, minimum = 23446, maximum = 65517).</p></sec><sec id="S13"><label>7.0.4</label><title>Maximum Entropy Principle</title><p id="P45">Here we provide in brief the general derivation of the class of maximum entropy probabilistic models. Restricted Boltzmann Machines are an instance of this model, which is detailed in the following sections. The maximum entropy principle is used to create probabilistic models <italic>P</italic>(<italic>x</italic>) (where <italic>x</italic> denotes one data configuration sample) that replicate particular data statistics <italic>f<sub>k</sub></italic>, but are otherwise most random, and therefore least assumptive, by maximizing their entropy <inline-formula><mml:math id="M10"><mml:mrow><mml:mi>H</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>log</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula> (<xref ref-type="bibr" rid="R24">Gardella et al., 2019</xref>). The goal of the model is to match its model statistics <inline-formula><mml:math id="M11"><mml:mrow><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>model</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>x</mml:mi></mml:msub><mml:mi>P</mml:mi></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> to the empirical data statistics 〈<italic>f<sub>k</sub></italic>〉<sub>data</sub> = <italic>F<sub>k</sub></italic>. This is done using Lagrange multipliers Λ<sub><italic>k</italic></sub>: <disp-formula id="FD5"><label>(5)</label><mml:math id="M12"><mml:mrow><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mi>x</mml:mi></mml:munder><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>log</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mi>k</mml:mi></mml:munder><mml:msub><mml:mo>Λ</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:mo>(</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mi>x</mml:mi></mml:munder><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>F</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula> which yields, when <inline-formula><mml:math id="M13"><mml:mover accent="true"><mml:mi>H</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:math></inline-formula> is maximized with respect to <italic>P</italic>(<italic>x</italic>), the Boltzmann distribution (see, e.g., <xref ref-type="bibr" rid="R11">Bialek (2012)</xref> for a full derivation): <disp-formula id="FD6"><label>(6)</label><mml:math id="M14"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>Z</mml:mi></mml:mfrac><mml:mi>exp</mml:mi><mml:mo>(</mml:mo><mml:mo>−</mml:mo><mml:mi>ln</mml:mi><mml:mn>2</mml:mn><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mi>k</mml:mi></mml:munder><mml:mrow><mml:msub><mml:mo>Λ</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mi>f</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>Z</mml:mi></mml:mfrac><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula> where <italic>E</italic>(<italic>x</italic>) is defined as the resulting energy function. Importantly, the data dependency (<italic>F<sub>k</sub></italic>) disappears when going from <xref ref-type="disp-formula" rid="FD5">Equation 5</xref> to <xref ref-type="disp-formula" rid="FD6">Equation 6</xref>. Hence, the maximum entropy principle only defines the shape of the distribution <italic>P</italic>(<italic>x</italic>), but not its specific parameters Λ<sub><italic>k</italic></sub> (<xref ref-type="bibr" rid="R11">Bialek, 2012</xref>). In the case of RBM, these are then optimized using maximum likelihood estimation, as detailed in the sections below.</p><sec id="S14"><label>7.0.4.1</label><title>Motivation for choice of statistics</title><p id="P46">The derivation above describes the general maximum entropy model for a set of statistics {<italic>f<sub>k</sub></italic>}. The objective of this study is to extract the assembly structure from neural data, therefore creating two layers: a visible (neural data) layer <bold>v</bold> = (<italic>v</italic><sub>1</sub>, <italic>v</italic><sub>2</sub>, …, <italic>v<sub>N</sub></italic>) and a hidden (latent) layer <bold>h</bold> = (<italic>h</italic><sub>1</sub>, <italic>h</italic><sub>2</sub>, …, <italic>h<sub>M</sub></italic>). The model should capture the mean activity of each neuron 〈<italic>v<sub>i</sub></italic>〉, their pairwise correlations 〈<italic>v<sub>i</sub>v<sub>j</sub></italic>〉, the neuron-HU interactions 〈<italic>v<sub>i</sub>h<sub>μ</sub></italic>〉 and a function of <italic>h<sub>μ</sub></italic>. The latter is determined by the potential <inline-formula><mml:math id="M15"><mml:mi mathvariant="script">U</mml:mi></mml:math></inline-formula> which we set to be a double Rectified Linear Unit (dReLU), as motivated in the following sections. Fitting all <italic>N</italic><sup>2</sup> pairwise interactions 〈<italic>v<sub>i</sub>v<sub>j</sub></italic>〉 is computationally infeasible, but under the cell assembly hypothesis we assume that this should not be necessary because collective neural behavior is expected to be explained by membership to similar assemblies via 〈<italic>v<sub>i</sub>h<sub>μ</sub></italic>〉, and can therefore be excluded. We later show that pairwise correlations are indeed optimized implicitly (<xref ref-type="fig" rid="F2">Figure 2</xref>). All other statistics are included and therefore explicitly optimized, also see <xref ref-type="disp-formula" rid="FD14">Equation 14</xref>.</p></sec></sec><sec id="S15"><label>7.0.5</label><title>Restricted Boltzmann Machines</title><p id="P47">A Restricted Boltzmann Machine (RBM) is an undirected graphical model defined on a bipartite graph (<xref ref-type="bibr" rid="R63">Smolensky, 1986</xref>; <xref ref-type="bibr" rid="R31">Hinton, 2002</xref>; <xref ref-type="bibr" rid="R33">Hinton &amp; Salakhutdinov, 2006</xref>), see <xref ref-type="fig" rid="F2">Figure 2A</xref>. RBMs are constituted by two layers of random variables, neurons <bold>v</bold> and Hidden Units (HUs) <bold>h</bold>, which are coupled by a weight matrix <bold>W</bold>. There are no direct couplings between pairs of units within the same layer. Here, each visible unit <italic>v<sub>i</sub></italic> corresponds to a single recorded neuron with binary (spike-deconvolved) activity (<italic>v<sub>i</sub></italic>(<italic>t</italic>) ∈ {0, 1}). Each Hidden Unit (HU) <italic>h<sub>μ</sub></italic> corresponds to the (weighted) activity of its neural assembly and is chosen to be real-valued. The joint probability distribution <italic>P</italic>(<bold>v</bold>, <bold>h</bold>) writes (<xref ref-type="bibr" rid="R33">Hinton &amp; Salakhutdinov, 2006</xref>; <xref ref-type="bibr" rid="R73">Tubiana &amp; Monasson, 2017</xref>): <disp-formula id="FD7"><label>(7)</label><mml:math id="M16"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>Z</mml:mi></mml:mfrac><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>Z</mml:mi></mml:mfrac><mml:mi>exp</mml:mi><mml:mo>(</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mi>μ</mml:mi></mml:munder><mml:mrow><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p id="P48">Where <italic>E</italic> is the energy function and <inline-formula><mml:math id="M17"><mml:mrow><mml:mi>Z</mml:mi><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mtext mathvariant="bold">v</mml:mtext></mml:msub><mml:mrow><mml:msub><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∫</mml:mo></mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:msub><mml:mi>d</mml:mi><mml:mi>v</mml:mi><mml:mspace width="0.2em"/><mml:mi>d</mml:mi><mml:mi>h</mml:mi><mml:mo>⋅</mml:mo><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula> is the partition function. The weights <italic>g<sub>i</sub></italic> and potentials <inline-formula><mml:math id="M18"><mml:mrow><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> control the activity level of the visible units and the marginal distributions of the HUs respectively, and the weights <italic>w<sub>i,μ</sub></italic> couple the two layers.</p><sec id="S16"><label>7.0.5.1</label><title>From data to features</title><p id="P49">Given a visible layer configuration <bold>v</bold>, a HU <italic>h<sub>μ</sub></italic> receives the input <inline-formula><mml:math id="M19"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>≡</mml:mo><mml:msubsup><mml:mtext mathvariant="bold">w</mml:mtext><mml:mi>μ</mml:mi><mml:mi>T</mml:mi></mml:msubsup><mml:mtext mathvariant="bold">v</mml:mtext></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula> and, owing to the bipartite architecture, the conditional distribution <italic>P</italic>(<bold>h</bold>|<bold>v</bold>) factorizes as: <disp-formula id="FD8"><label>(8)</label><mml:math id="M20"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo>∣</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∏</mml:mo><mml:mi>μ</mml:mi></mml:munder><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∏</mml:mo><mml:mi>μ</mml:mi></mml:munder><mml:mrow><mml:mi>exp</mml:mi><mml:mo>(</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:msub><mml:mi>I</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mo>Γ</mml:mo><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>I</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p id="P50">Where <inline-formula><mml:math id="M21"><mml:mrow><mml:msub><mml:mo>Γ</mml:mo><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>I</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>log</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mstyle mathsize="140%" displaystyle="true"><mml:mo>∫</mml:mo></mml:mstyle><mml:mi>h</mml:mi></mml:msub><mml:mi>d</mml:mi><mml:mi>h</mml:mi><mml:mo>⋅</mml:mo><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>h</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>h</mml:mi><mml:mi>I</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> is the cumulant generating function associated to the potential <inline-formula><mml:math id="M22"><mml:mrow><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> that normalizes <xref ref-type="disp-formula" rid="FD8">Equation 8</xref> (<xref ref-type="bibr" rid="R72">Tubiana et al., 2019b</xref>). The average activity of HU <italic>h<sub>μ</sub></italic> associated to a visible configuration <bold>v</bold> is given by a linear-nonlinear transformation (as defined by the properties of the cumulant generating function): <disp-formula id="FD9"><label>(9)</label><mml:math id="M23"><mml:mrow><mml:mo>〈</mml:mo><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext></mml:mrow><mml:mo>〉</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mo>Γ</mml:mo><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:mi>I</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msubsup><mml:mo>Γ</mml:mo><mml:mi>μ</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mtext mathvariant="bold">w</mml:mtext><mml:mi>μ</mml:mi></mml:msub><mml:msup><mml:mrow/><mml:mi>T</mml:mi></mml:msup><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P51">Throughout the manuscript, we use this definition to compute HU activity 〈<italic>h<sub>μ</sub></italic>(<italic>t</italic>) = 〈<italic>h<sub>μ</sub></italic>|<bold>v</bold>(<italic>t</italic>)〉 (e.g., in <xref ref-type="fig" rid="F4">Figure 4</xref>).</p></sec><sec id="S17"><label>7.0.5.2</label><title>From features to data</title><p id="P52">Conversely, given a hidden layer configuration <bold>h</bold>, a visible unit <italic>v<sub>i</sub></italic> receives the input <inline-formula><mml:math id="M24"><mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>≡</mml:mo><mml:msubsup><mml:mtext mathvariant="bold">w</mml:mtext><mml:mtext mathvariant="bold">i</mml:mtext><mml:mi>T</mml:mi></mml:msubsup><mml:mtext mathvariant="bold">h</mml:mtext></mml:mrow></mml:math></inline-formula> and the conditional distribution factorizes as: <disp-formula id="FD10"><label>(10)</label><mml:math id="M25"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo>∣</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∏</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mi>P</mml:mi></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>∝</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mo>∏</mml:mo><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:mi>exp</mml:mi></mml:mrow></mml:mstyle><mml:mo>(</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>)</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:math></disp-formula> and the average sampled <italic>v<sub>i</sub></italic> activity is given by: <disp-formula id="FD11"><label>(11)</label><mml:math id="M26"><mml:mrow><mml:mo>〈</mml:mo><mml:mrow><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext></mml:mrow><mml:mo>〉</mml:mo><mml:mo>=</mml:mo><mml:mi>σ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mtext mathvariant="bold">w</mml:mtext><mml:mtext mathvariant="bold">i</mml:mtext></mml:msub><mml:msup><mml:mrow/><mml:mi>T</mml:mi></mml:msup><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo>+</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P53">Where <italic>σ</italic>(<italic>x</italic>) = 1/(1 + <italic>e</italic><sup>−<italic>x</italic></sup>) is the logistic function. Hence, a sampled visible layer configuration <bold>v</bold> is obtained by a weighted combination of the HU activity followed by Bernoulli sampling. RBMs are generative models, in the sense that they can generate new, artificial data using <xref ref-type="disp-formula" rid="FD8">Equations 8</xref> and <xref ref-type="disp-formula" rid="FD10">10</xref>. <xref ref-type="fig" rid="F2">Figure 2B</xref> illustrates this Markov Chain Monte Carlo (MCMC) process, by recursively sampling from <italic>P</italic>(<bold>h</bold>|<bold>v</bold>) and <italic>P</italic>(<bold>v</bold>|<bold>h</bold>), which converges at equilibrium to <italic>P</italic>(<bold>v</bold>, <bold>h</bold>).</p></sec><sec id="S18"><label>7.0.5.3</label><title>Marginal distributions</title><p id="P54">The marginal distribution <italic>P</italic>(<bold>v</bold>) has a closed-form expression because of the factorized conditional distribution of <xref ref-type="disp-formula" rid="FD9">Equation 9</xref> (<xref ref-type="bibr" rid="R71">Tubiana et al., 2019a</xref>,<xref ref-type="bibr" rid="R72">b</xref>): <disp-formula id="FD12"><label>(12)</label><mml:math id="M27"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:mrow><mml:mo>∫</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mi>d</mml:mi></mml:mstyle></mml:mrow></mml:mrow></mml:mstyle><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>Z</mml:mi></mml:mfrac><mml:mi>exp</mml:mi><mml:mo>(</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mo>Γ</mml:mo><mml:mi>μ</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P55">For a quadratic potential <inline-formula><mml:math id="M28"><mml:mrow><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>h</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:msubsup><mml:mi>h</mml:mi><mml:mi>μ</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mn>2</mml:mn></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> the cumulant generating function would also be quadratic and <italic>P</italic>(<bold>v</bold>) would reduce to a Hopfield model, i.e., a pairwise model with an interaction matrix <inline-formula><mml:math id="M29"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>μ</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula> (<xref ref-type="bibr" rid="R71">Tubiana et al., 2019a</xref>). Otherwise, Γ<sub><italic>μ</italic></sub> is not quadratic, yielding high-order effective interaction terms between visible units and allowing RBMs to express more complex distributions. Importantly, the number of parameters remains limited, controlled by <italic>M</italic> and does not scale as <italic>N</italic><sup>2</sup> (unlike pairwise models).</p></sec><sec id="S19"><label>7.0.5.4</label><title>Choice of HU potential</title><p id="P56">The choice of HU potential determines three related properties: the HU conditional distribution <italic>P</italic>(<bold>h</bold>|<bold>v</bold>), the transfer function of the HUs and the parametric form of the marginal distribution <italic>P</italic>(<bold>v</bold>). Hereafter we use the double-Rectified Linear Unit (dReLU) potential: <disp-formula id="FD13"><label>(13)</label><mml:math id="M30"><mml:mrow><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>h</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mo>+</mml:mo></mml:mrow></mml:msub><mml:msubsup><mml:mi>h</mml:mi><mml:mo>+</mml:mo><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mo>−</mml:mo></mml:mrow></mml:msub><mml:msubsup><mml:mi>h</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mo>+</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mo>+</mml:mo></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mo>−</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mo>−</mml:mo></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mtext>where</mml:mtext><mml:mspace width="0.3em"/><mml:msub><mml:mi>h</mml:mi><mml:mo>+</mml:mo></mml:msub><mml:mo>=</mml:mo><mml:mi>max</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mo>−</mml:mo></mml:msub><mml:mo>=</mml:mo><mml:mi>min</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>h</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p><p id="P57">Varying the parameters {<italic>γ</italic><sub><italic>μ</italic>,+</sub>, <italic>γ</italic><sub><italic>μ</italic>,−</sub>, <italic>θ</italic><sub><italic>μ</italic>,+</sub>, <italic>θ</italic><sub><italic>μ</italic>,−</sub>}allows the potential to take a variety of shapes, including quadratic potentials (<italic>γ</italic><sub><italic>μ</italic>,+</sub> = <italic>γ</italic><sub><italic>μ</italic>,−</sub>, <italic>θ</italic><sub><italic>μ</italic>,+</sub> = <italic>θ</italic><sub><italic>μ</italic>,−</sub>) and double-well potentials (<xref ref-type="bibr" rid="R72">Tubiana et al., 2019b</xref>). The associated cumulant generating function Γ(<italic>I</italic>) is non-quadratic in general, and depending on the parameters, the transfer function can be linear, ReLU-like (asymmetric slope and thresholding) or logistic-like (strong local slopes for binarizing inputs). Closed-form expressions of Γ are detailed in (<xref ref-type="bibr" rid="R72">Tubiana et al., 2019b</xref>,<xref ref-type="bibr" rid="R71">a</xref>), and its derivatives are also detailed in (<xref ref-type="bibr" rid="R70">Tubiana, 2018</xref>, p49-50). Note that the dReLU potential <inline-formula><mml:math id="M31"><mml:mrow><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and distribution <italic>P</italic>(<bold>v</bold>) are invariant to the sign swap transformation <italic>γ</italic><sub><italic>μ</italic>,+</sub>, <italic>θ</italic><sub><italic>μ</italic>,+</sub> ⟺ <italic>γ</italic><sub><italic>μ</italic>,−</sub>, <italic>θ</italic><sub><italic>μ</italic>,−</sub> and <italic>w<sub>iμ</sub></italic> ⟺ −<italic>w<sub>iμ</sub></italic> ∀ <italic>i</italic>, <italic>μ</italic> (leading to <italic>h<sub>μ</sub></italic> ⟺ −<italic>h<sub>μ</sub></italic>). For visual clarity, we perform this sign swap transformation after training on all HUs with predominantly negative weights (defined by <inline-formula><mml:math id="M32"><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula> Subsequently all HUs are positively activated if the group of neurons to which it connects is strongly active.</p></sec><sec id="S20"><label>7.0.5.5</label><title>RBM training</title><p id="P58">The RBM is trained by maximizing the average log-likelihood of the empirical data configurations <inline-formula><mml:math id="M33"><mml:mrow><mml:mi>ℓ</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:mi>log</mml:mi><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>data</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> using stochastic gradient descent methods. The gradient update steps are derived by calculating the derivative of <inline-formula><mml:math id="M34"><mml:mrow><mml:mi>ℓ</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> using <xref ref-type="disp-formula" rid="FD12">Equation 12</xref>, with respect to the model parameters (<xref ref-type="bibr" rid="R71">Tubiana et al., 2019a</xref>): <disp-formula id="FD14"><label>(14)</label><mml:math id="M35"><mml:mrow><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>ℓ</mml:mi></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>data</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>model</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>ℓ</mml:mi></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>data</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>model</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>ℓ</mml:mi></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mo>±</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:msubsup><mml:mi>h</mml:mi><mml:mi>μ</mml:mi><mml:mo>±</mml:mo></mml:msubsup><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>data</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:msubsup><mml:mi>h</mml:mi><mml:mi>μ</mml:mi><mml:mo>±</mml:mo></mml:msubsup><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>model</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>ℓ</mml:mi></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mo>±</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:msubsup><mml:mi>h</mml:mi><mml:mi>μ</mml:mi><mml:mrow><mml:mo>±</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>data</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:msubsup><mml:mi>h</mml:mi><mml:mi>μ</mml:mi><mml:mrow><mml:mo>±</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>model</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p><p id="P59">Each gradient of <inline-formula><mml:math id="M36"><mml:mi>ℓ</mml:mi></mml:math></inline-formula> is thus the difference between a data statistic 〈<italic>f<sub>k</sub></italic>〉<sub>data</sub> and a model statistic 〈<italic>f<sub>k</sub></italic>〉<sub>model</sub>. Hence the model learns to match these statistics to the training data. Importantly, model statistics 〈<italic>f<sub>k</sub></italic>〉<sub>model</sub> cannot be evaluated exactly due to the exponentially large number of data configurations (e.g., 2<sup><italic>N</italic></sup> visible configurations). Therefore they are approximated by computing the statistics of model-generated data using the MCMC sampling scheme defined with <xref ref-type="disp-formula" rid="FD8">Equations 8</xref> and <xref ref-type="disp-formula" rid="FD10">10</xref>. MCMC sampling of a Boltzmann distribution in such high-dimensional space is in general very challenging owing to the exponentially long time to reach equilibrium. We use the persistent contrastive divergence approximation (<xref ref-type="bibr" rid="R66">Tieleman, 2008</xref>) and discuss its validity below.</p></sec></sec><sec id="S21"><label>7.0.6</label><title>Compositional Restricted Boltzmann Machine</title><p id="P60">In the previous sections we have described the general properties of RBMs. We now motivate the specific RBM model choices that we have implemented, such as the dReLU potential and sparsity regularization, by discussing their impact on the properties of RBM-generated data.</p><p id="P61">Directed graphical models, e.g., PCA, ICA, sparse dictionaries or variational autoencoders, prescribe a priori statistical constraints for their data representations, such as orthogonality/independence or specific marginal distributions such as Gaussian/sparse distributions. In contrast, the statistical properties of the representation of the data learned by RBMs are unknown a priori by construction (because of the maximum entropy principle). Instead, they emerge from the structure of the weight matrix, the potentials and the recursive back-and-forth sampling procedure described above. We have therefore previously studied the properties of typical samples of RBM with random weights as a function of the visible and hidden unit potentials and properties of the weight matrix using statistical mechanics tools (<xref ref-type="bibr" rid="R73">Tubiana &amp; Monasson, 2017</xref>; <xref ref-type="bibr" rid="R71">Tubiana et al., 2019a</xref>). We have identified the three following typical behaviors, or phases.</p><p id="P62">In the ferromagnetic phase, a typical sample from <italic>P</italic>(<bold>v</bold>, <bold>h</bold>) has a single strongly activated HU (<italic>m</italic>(<italic>t</italic>) ~ 1, where <italic>m</italic>(<italic>t</italic>) is the number of activated HUs at time <italic>t</italic>), whereas the others are not or merely weakly activated. The corresponding active visible units <italic>v<sub>i</sub></italic> are defined by the weight vector <bold>w</bold><sub><italic>μ</italic>✶</sub> associated to the active HU <italic>h</italic><sub><italic>μ</italic>✶</sub> (see <xref ref-type="disp-formula" rid="FD10">Equation 10</xref>).</p><p id="P63">In the spin-glass phase, a typical sample does not have any relatively strongly activated HUs, but instead many moderately activated ones (<italic>m</italic>(<italic>t</italic>) ~ <italic>M</italic>). They interfere in a complex fashion to produce different visible unit configurations and there is no clear correspondence between the weight matrix and a typical data configuration.</p><p id="P64">Finally, in the compositional phase, a typical sample from <italic>P</italic>(<bold>v</bold>, <bold>h</bold>) has a small number of strongly activated HUs (1 ≪ <italic>m</italic>(<italic>t</italic>) ≪ <italic>M</italic>) whereas the others are weak or silent. Their weights are linearly combined through <xref ref-type="disp-formula" rid="FD10">Equation 10</xref> to produce the corresponding visible layer configuration. The compositional phase is desirable because, firstly, there exists a simple link between the weight matrix and typical data configurations (they are obtained by combining a few weights), which facilitates interpretation of biological systems (<xref ref-type="bibr" rid="R72">Tubiana et al., 2019b</xref>). Secondly, the corresponding neural activity distribution is rich, as different choices of HU subsets yield a combinatorial diversity of visible layer configurations. Moreover, the modular nature of the compositional phase facilitates the assembly organization of neural dynamics, as motivated in the Introduction.</p><p id="P65">A set of sufficient conditions for the emergence of the compositional phase are (<xref ref-type="bibr" rid="R73">Tubiana &amp; Monasson,2017</xref>): <list list-type="order" id="L1"><list-item><p id="P66">The HUs are unbounded and real-valued with a ReLU-like transfer function.</p></list-item><list-item><p id="P67">The weight matrix <bold>W</bold> is sparse.</p></list-item><list-item><p id="P68">The columns <bold>w</bold><sub><italic>μ</italic></sub> of the weight matrix have similar norm. (If a weight column associated to one HU is much larger than the others, visible configurations are solely aligned to it according to <xref ref-type="disp-formula" rid="FD10">Equation 10</xref>.)</p></list-item></list>
</p><p id="P69">The first condition is satisfied by the dReLU potential (but not by quadratic potentials or binary-valued HUs). The second condition is enforced in practice by adding a <italic>L</italic><sub>1</sub> sparse penalty term <inline-formula><mml:math id="M37"><mml:mrow><mml:mi>λ</mml:mi><mml:mo>⋅</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula> to the log-likelihood cost function. In our experiments, the optimal sparsity parameter <italic>λ</italic> was determined to be <italic>λ</italic> = 0.02 by cross-validation (<xref ref-type="supplementary-material" rid="SD2">Figure S1</xref>). The final condition is achieved by enforcing that Var(<italic>h<sub>μ</sub></italic>) = 1 and 〈<italic>h<sub>μ</sub></italic>〉 ~ 0 ∀ <italic>μ</italic>. This is done by an appropriate reparameterization of the HU potential of <xref ref-type="disp-formula" rid="FD13">Equation 13</xref> and a batch-norm–like procedure, described in detail in (<xref ref-type="bibr" rid="R70">Tubiana, 2018</xref>). This normalization promotes homogeneity among HU importance, preventing some units from being disconnected or others from dominating. In addition, ensuring that <inline-formula><mml:math id="M38"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="script">O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> irrespective of the visible layer size (as opposed to e.g., <inline-formula><mml:math id="M39"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>γ</mml:mi><mml:mo>+</mml:mo></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>γ</mml:mi><mml:mo>−</mml:mo></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> which yields <inline-formula><mml:math id="M40"><mml:mrow><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>~</mml:mo><mml:msqrt><mml:mi>N</mml:mi></mml:msqrt><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>) avoids the problem of ill-conditioned Hessians that was previously described by <xref ref-type="bibr" rid="R32">Hinton (2012)</xref>.</p><p id="P70">To emphasise the departure from the classic RBM formulation in this study, we name our model compositional RBM (cRBM).</p></sec><sec id="S22"><label>7.0.7</label><title>Algorithmic Implementation</title><p id="P71">In the previous sections we have described the cRBM model in full mathematical detail. The corresponding algorithmic implementation was adapted from (<xref ref-type="bibr" rid="R72">Tubiana et al., 2019b</xref>). In addition, we have made several major implementation and algorithmic changes to accommodate the large data size of the zebrafish neural recordings. We provide the code open-source, and describe the code improvements and hyperparameter settings in this section. The following improvements were made, leading to a substantial reduction of computation time: <list list-type="bullet" id="L2"><list-item><p id="P72">Python 3 and numba (<xref ref-type="bibr" rid="R41">Lam et al., 2015</xref>) were used to compile custom functions, enabling SIMD vectorization and multicore parallelism.</p></list-item><list-item><p id="P73">The sampling of <italic>P</italic>(<italic>h<sub>μ</sub></italic>|<italic>I<sub>μ</sub></italic>) and evaluating its cumulant generating function Γ<sub><italic>μ</italic></sub> and various moments requires repeated and costly evaluation of error functions erf and related functions (<xref ref-type="bibr" rid="R70">Tubiana, 2018</xref>, p49-50). Fast numerical approximations of these functions were implemented based on (<xref ref-type="bibr" rid="R1">Abramowitz et al., 1988</xref>, p299).</p></list-item><list-item><p id="P74">The number of memory allocation operations was minimized.</p></list-item><list-item><p id="P75">The optimization algorithm was changed from stochastic gradient ascent to RMSprop (i.e., ADAM without momentum) with learning rate 5 · 10<sup>−4</sup> to 5 · 10<sup>−3</sup>, <italic>β</italic><sub>1</sub> = 0, <italic>β</italic><sub>2</sub> = 0.999, <italic>ϵ</italic> = 10<sup>−6</sup>, see <xref ref-type="bibr" rid="R37">Kingma &amp; Ba (2014)</xref> for a definition of the parameters. Compared to the original stochastic gradient ascent, the adaptive learning rates of RMSprop/ADAM yield larger updates for the weights attached to neurons with very sparse activity, resulting in substantially faster convergence.</p></list-item></list>
</p><sec id="S23"><label>7.0.7.1</label><title>Hyperparameter settings</title><p id="P76">The following hyperparameters were used in the experiments of this manuscript: <list list-type="bullet" id="L3"><list-item><p id="P77">Number of hidden unit <italic>M</italic>: 200. This value was determined by cross-validation (<xref ref-type="supplementary-material" rid="SD2">Figure S1</xref>) on one data set (example fish #3). Because this cross-validation procedure was computationally expensive, the same value was used for all other data sets, except for 3 data sets which used <italic>M</italic> = 100 because their <inline-formula><mml:math id="M41"><mml:mrow><mml:mi>N</mml:mi><mml:mo>≈</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mo>#</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msub><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula></p></list-item><list-item><p id="P78">Sparse regularization penalty <italic>λ</italic>: 0.02 (determined by cross-validation).</p></list-item><list-item><p id="P79">Batch size: 100, 200 or 400. Larger batch sizes yield longer training time but more stable training; batch size was increased if training failed to converge.</p></list-item><list-item><p id="P80">Number of Monte Carlo chains: 100.</p></list-item><list-item><p id="P81">Number of gradient updates: 2 · 10<sup>5</sup></p></list-item><list-item><p id="P82">Number of Monte Carlo steps between each gradient update: 15.</p></list-item><list-item><p id="P83">Initial learning rate <italic>η</italic>: between 5 · 10<sup>−4</sup> and 5 · 10<sup>−3</sup>. We used 5 · 10<sup>−3</sup> by default and if weight divergence was observed, the learning was reinitialized with a reduced learning rate. This occurred notably for high-<italic>M</italic> and low-<italic>λ</italic> models during the cross-validation procedure of <xref ref-type="supplementary-material" rid="SD2">Figure S1</xref>.</p></list-item><list-item><p id="P84">Learning rate annealing scheme: the learning rate geometrically decayed during training, starting after 25% of the gradient update steps, from its initial value <italic>η</italic> to a final value of 10<sup>−5</sup>.</p></list-item><list-item><p id="P85">Number of training data samples: 70% of frames of each recording (= 4086 training data samples on average), see <xref ref-type="sec" rid="S32">section 7.0.10.1</xref> for details.</p></list-item></list>
</p><p id="P86">cRBM models of these zebrafish data sets could be estimated in approximately 8-12 hours using 16 CPU threads (Intel Xeon Phi processor). The (<italic>λ, M</italic>)-cross-validation was therefore completed in three weeks using two desktop computers.</p></sec></sec><sec id="S24"><label>7.0.8</label><title>Validity of the Persistent Contrastive Divergence algorithm</title><p id="P87">Training RBM requires extensive MCMC sampling which is notoriously difficult for high-dimensional data sets. We resolve this by using Persistent Contrastive Divergence (PCD) to approximate the gradients (<xref ref-type="bibr" rid="R66">Tieleman, 2008</xref>). In this section we discuss why this worked to successfully converge, despite the very large data size.</p><p id="P88">The typical number of Monte Carlo steps required to transition from one energy minimum to another through an energy barrier Δ<italic>E</italic> follows the Arrhenius law, scaling as <italic>e</italic><sup>Δ<italic>E</italic></sup>. In the thermodynamic limit (<italic>N</italic> → ∞), Δ<italic>E</italic> scales as the system size <italic>N</italic> multiplied by the typical energy required to flip a single visible unit, corresponding here to the inputs received from the hidden layer <italic>I</italic>. In contrast, for PCD only a limited number of MC steps (here, 15) are applied between each gradient update. Three factors explain why reasonably successful convergence was achieved in the trainings presented here.</p><p id="P89">Firstly, the use of the <italic>L</italic><sub>1</sub> regularization limits the magnitude of the weights and therefore limits the input scale <italic>I</italic>. Secondly, in the compositional phase, the energy barriers do not scale as the full system size <italic>N</italic> but rather as the size of one assembly <italic>pN</italic> where <italic>p</italic> is the fraction of non-zero weights (<xref ref-type="bibr" rid="R73">Tubiana &amp; Monasson, 2017</xref>). Indeed, transitioning from one energy minimum, characterized by a subset of strongly activated HUs, to another minimum, characterized by another set of strongly activated HUs, is done by gradually morphing the first set into the second (<xref ref-type="bibr" rid="R60">Roussel et al., 2021</xref>). Compared to a direct transition, such a path is favored because the intermediate states are thermodynamically stable and energy barriers are smaller as each HU flip has an energy cost ~ <italic>pN</italic>. Lastly, throughout PCD training, MCMC sampling is not performed at thermal equilibrium and the model updates of the parameters of the distribution promote mixing (<xref ref-type="bibr" rid="R67">Tieleman &amp; Hinton, 2009</xref>). This is seen from <xref ref-type="disp-formula" rid="FD14">Equation 14</xref>: the log-likelihood gradient is the difference between the gradient of the energy averaged over the empirical data and the energy averaged over MCMC samples. Ascending the gradient amounts to pushing down the energy of data configurations and pushing up the energy of MCMC samples, thereby promoting mixing of the Markov chains.</p><p id="P90">Overall, combining small learning rates (and large number of gradient updates), large regularization, large number of Markov Chains and Monte Carlo steps has allowed convergence to be reached for the majority of cRBM training sessions.</p></sec><sec id="S25"><label>7.0.9</label><title>Functional Connectivity Inference</title><sec id="S26"><label>7.0.9.1</label><title>Effective connectivity matrix</title><p id="P91">In this section we present a derivation of the effective coupling matrix between neurons from the marginal distribution <italic>P</italic>(<bold>v</bold>) using cRBMs. This is achieved by perturbing the activity of each neuron individually and quantifying the effect on other neurons. We first define the local coupling <italic>J<sub>ij</sub></italic> between two neurons <italic>v<sub>i</sub></italic> and <italic>v<sub>j</sub></italic> for a generic probability distribution <italic>P</italic>(<italic>v</italic><sub>1</sub>, <italic>v</italic><sub>2</sub>, … <italic>v<sub>N</sub></italic>), given a data configuration <bold>v</bold>: <disp-formula id="FD15"><label>(15)</label><mml:math id="M42"><mml:mrow><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mo>=</mml:mo></mml:mtd><mml:mtd><mml:mi>log</mml:mi><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>∣</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>N</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>∣</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>N</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd><mml:mtd><mml:mrow><mml:mo>−</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mi>log</mml:mi><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>∣</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>N</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>∣</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>N</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p><p id="P92">In other words, <italic>J<sub>ij</sub></italic> is defined as the impact of the state of neuron <italic>j</italic> on neuron <italic>i</italic> in the context of activity pattern <bold>v</bold>. Hence, the effective connectivity matrix <bold>J</bold> mathematically defines the functional connections, which can only be done using a probabilistic model <italic>P</italic>(<bold>v</bold>). A positive (negative) coupling <italic>J<sub>ij</sub></italic> indicates correlated (anti-correlated) collective behavior of neurons <italic>i, j</italic>. This effective coupling value is symmetric (because of Bayes’ rule): <italic>J<sub>ij</sub></italic>(<bold>v</bold>) = <italic>J<sub>ji</sub></italic>(<bold>v</bold>). For context, note that <italic>J<sub>ij</sub></italic>(<bold>v</bold>) is uniformly zero for an independent model of the form <inline-formula><mml:math id="M43"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mn>..</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>N</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∏</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> and that for a maximum entropy pairwise (Ising) model, with <inline-formula><mml:math id="M44"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mn>..</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>N</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>Z</mml:mi></mml:mfrac><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>&lt;</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msubsup><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mtext>ising</mml:mtext></mml:mrow></mml:msubsup><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>v</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> the <italic>J<sub>ij</sub></italic>(<bold>v</bold>) matrix exactly identifies with the coupling matrix <inline-formula><mml:math id="M45"><mml:mrow><mml:msubsup><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mtext>ising</mml:mtext></mml:mrow></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> and does not depend on the data configuration <bold>v</bold> (so <italic>J<sub>ij</sub></italic>(<bold>v</bold>) = <italic>J<sub>ij</sub></italic>).</p><p id="P93">However, in general, and for RBMs in particular, <italic>J<sub>ij</sub></italic>(<bold>v</bold>) depends onthe data set <bold>v</bold>, and an overall coupling matrix can be derived by taking its average over all data configurations: <disp-formula id="FD16"><label>(16)</label><mml:math id="M46"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>data</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula></p><p id="P94">Although <xref ref-type="disp-formula" rid="FD16">Equation 16</xref> has a closed-form solution for RBMs (by inserting <xref ref-type="disp-formula" rid="FD12">Equation 12</xref>), a naive evaluation requires <inline-formula><mml:math id="M47"><mml:mi mathvariant="script">O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>N</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mi>M</mml:mi><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:math></inline-formula> operations where <italic>T</italic> is the number of data samples. However, a fast and intuitive approximation can be derived by performing a second order Taylor expansion of Γ<sub><italic>μ</italic></sub>(<italic>I<sub>μ</sub></italic>): <disp-formula id="FD17"><label>(17)</label><mml:math id="M48"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:msubsup><mml:mo>Γ</mml:mo><mml:mi>μ</mml:mi><mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>data</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>μ</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mo>〈</mml:mo><mml:mtext>Var</mml:mtext><mml:mo>(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>μ</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo>)</mml:mo><mml:mo>〉</mml:mo></mml:mrow><mml:mrow><mml:mtext>data</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p id="P95"><xref ref-type="disp-formula" rid="FD17">Equation 17</xref> is exact for quadratic potential and in general justified as the contribution of neurons <italic>i, j</italic> is small compared to the scale of variation of Γ<sub><italic>μ</italic></sub>, <inline-formula><mml:math id="M49"><mml:mrow><mml:mi>O</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msqrt><mml:mrow><mml:mi>p</mml:mi><mml:mi>N</mml:mi></mml:mrow></mml:msqrt><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> where <italic>p</italic> is the fraction of non-zero couplings. In conclusion, we have mathematically derived the effective coupling between any two neurons <italic>i</italic> and <italic>j</italic>. Intuitively, two neurons <italic>i</italic>, <italic>j</italic> are effectively connected if they are connected to the same HUs (<xref ref-type="disp-formula" rid="FD17">Equation 17</xref>).</p></sec><sec id="S27"><label>7.0.9.2</label><title>From inter-neuron to inter-region connectivity</title><p id="P96">In the above section we have derived the inter-neuronal connectivity matrix <bold>J</bold>. This matrix is then aggregated to an inter-regional connectivity matrix <inline-formula><mml:math id="M50"><mml:mrow><mml:msup><mml:mtext mathvariant="bold">J</mml:mtext><mml:mi mathvariant="script">R</mml:mi></mml:msup></mml:mrow></mml:math></inline-formula> by taking the <italic>L</italic><sub>1</sub> norm of the corresponding <bold>J</bold> matrix block (i.e., <inline-formula><mml:math id="M51"><mml:mrow><mml:msubsup><mml:mi>J</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>m</mml:mi></mml:mrow><mml:mi mathvariant="script">R</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>m</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula> where <italic>R<sub>k</sub></italic> is the set of neurons in region <italic>k</italic>).</p><p id="P97">Next, to derive the average connectivity matrix across multiple recordings, we used a weighted average of the individual recordings, with a region-pair specific weight equal to the length of the recording multiplied by the sum of the number of neurons in both regions (also see <xref ref-type="sec" rid="S40">Section 7.0.16</xref>). Compared to a naive average, this weighted average accounts for the variable number of neurons per region between recordings.</p></sec><sec id="S28"><label>7.0.9.3</label><title>Training cRBM models for connectivity estimates</title><p id="P98">Constructing the functional connectivity matrix of a cRBM does not require test data, but just the estimated weight matrix <bold>W</bold> (as explained above). Therefore we trained new cRBMs using the entire recordings (100% of data) to fully use the information available. cRBM training is stochastic, and to mitigate the possible variability that could arise we trained 5 cRBMs for each recording. Then, to assess convergence, we selected all cRBMs with 0.01 &lt; std(<bold>w</bold>) &lt; 0.1, where std denotes standard deviation, for further functional connectivity analysis (yielding 23 cRBMs for 8 data sets in total). Connectivity estimates of multiple cRBM models per data sets were averaged.</p></sec><sec id="S29"><label>7.0.9.4</label><title>Connectivity inference baselines</title><p id="P99">We considered four additional connectivity inference baseline methods: <list list-type="bullet" id="L4"><list-item><p id="P100">The covariance matrix.</p></list-item><list-item><p id="P101">The Pearson correlation matrix.</p></list-item><list-item><p id="P102">The sparse inverse covariance matrix inferred by graphical LASSO (<xref ref-type="bibr" rid="R22">Friedman et al., 2008</xref>) (as implemented in scikit-learn with default settings (<xref ref-type="bibr" rid="R54">Pedregosa et al., 2011</xref>)). Graphical LASSO is an efficient method for inference of large scale connectivity. Unfortunately, the implementation available failed to converge in reasonable time due to the high dimensionality of the data.</p></list-item><list-item><p id="P103">The Ising model with pseudo-likelihood maximization (PLM) inference (<xref ref-type="bibr" rid="R58">Ravikumar et al., 2010</xref>).</p></list-item></list>
</p><p id="P104">Results obtained with the covariance and correlation matrices are presented in <xref ref-type="supplementary-material" rid="SD2">Figure S6</xref>. The connectivity matrices obtained by the PLM Ising model (not shown) correctly identified the diagonal entries of the region-region matrix, but not the off-diagonal coefficients and had a weaker correlation with the structural connectivity matrix than the covariance and correlation matrices (<italic>r</italic><sub>S</sub> = 0.06 using 4 fish).</p></sec></sec><sec id="S30"><label>7.0.10</label><title>Optimizing the free parameters of cRBM</title><p id="P105">We set the free parameters <italic>λ</italic> (sparsity regularization parameter) and <italic>M</italic> (number of HUs) by cross-validating a large range of (<italic>λ</italic>, <italic>M</italic>) values for one data set (fish #3). This was done by training cRBMs on 70% of the data, and evaluating model performance on the remaining test data, as detailed below. The resulting optimal values could then be used for all data sets (where <italic>M</italic> was scaled with the number of neurons <italic>N</italic>). Importantly, the (<italic>λ, M</italic>) parameters implicitly tune the average assembly size. Increasing the number of HUs and/or increasing the regularization strength decreases the average number of neurons per assembly (<xref ref-type="bibr" rid="R71">Tubiana et al., 2019a</xref>). Intuitively, assemblies that are too small do not have the capacity to capture high-order correlations, while assemblies that are too large would fail to account for local co-activations. Hence, the (<italic>M, λ</italic>)-cross-validation effectively identifies the optimal assembly sizes that fit the data statistics.</p><sec id="S31"><label>7.0.10.1</label><title>Train / test data split</title><p id="P106">We split up one recording (fish #3) into training data (70% of recording) and withheld test data (30% of recording) for the free parameter (<italic>λ, M</italic>) optimization procedure. This enabled us to assess whether the cRBMs learned to model the data statistics (as described in the main text, <xref ref-type="fig" rid="F2">Figures 2</xref> and <xref ref-type="supplementary-material" rid="SD2">S1</xref>), while ensuring that the cRBMs had not overfit to the specific training data configurations. Importantly, this assumes that the test data comes from the same statistical distribution as the training data (while consisting of different data configurations). To ensure this, we split up the recording of example fish #3 (used for parameter optimization) in training and test splits as follows (before training the cRBMs): We divided the recording of length <italic>T</italic> in 10 chronological segments of equal length (so that segment 1 has time points <inline-formula><mml:math id="M52"><mml:mrow><mml:mo>{</mml:mo><mml:mi>t</mml:mi><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mfrac><mml:mi>T</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mfrac><mml:mo stretchy="false">)</mml:mo><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> cetera), with the rationale that by maintaining temporal order within each segment we would later be able to conduct dynamic activity analysis. This yielded <inline-formula><mml:math id="M53"><mml:mrow><mml:mo>(</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>3</mml:mn></mml:mtd></mml:mtr></mml:mtable><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mn>120</mml:mn></mml:mrow></mml:math></inline-formula> possible training/test splits of the neural data. We then evaluated the statistical similarity between the training and test split of each combination, by assessing the mean neural activity 〈<italic>v<sub>i</sub></italic>〉 and pairwise neural correlations 〈<italic>v<sub>i</sub>v<sub>j</sub></italic>〉 − 〈<italic>v<sub>i</sub></italic>〉〈<italic>v<sub>j</sub></italic>〉 statistics. We quantified the similarity between training and test statistics by calculating the Root Mean Square Error <inline-formula><mml:math id="M54"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mtext>RMSE</mml:mtext><mml:mo>(</mml:mo><mml:msub><mml:mtext mathvariant="bold">x</mml:mtext><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mtext mathvariant="bold">x</mml:mtext><mml:mn>2</mml:mn></mml:msub><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mstyle></mml:mrow></mml:msqrt><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula> The most similar split is defined by the lowest RMSE, but to show that cRBM are not dependent on picking the best possible split, but rather on avoiding the bad splits, we then chose to use the split with the 10<sup>th</sup>-percentile ranking RMSE. We hope that this aids future studies, where a potentially high number of possible splits prevents researchers from evaluating all possible splits, but a good split may nevertheless be found efficiently.</p></sec><sec id="S32"><label>7.0.10.2</label><title>Assessment of data statistics</title><p id="P107">Please note that the loss function, the log-likelihood, is computationally intractable and therefore cannot be readily used to monitor convergence or goodness-of-fit after training (<xref ref-type="bibr" rid="R21">Fischer &amp; Igel, 2012</xref>). Moreover, approximations of the log-likelihood based on annealed importance sampling were found to be unreliable due to the large system size. Instead, we assessed the following quantities.</p><p id="P108">Firstly, we evaluated 3 statistics that cRBMs are trained to optimize: the mean activity of neurons 〈<italic>v<sub>i</sub></italic>〉, the mean activity of HUs 〈<italic>h<sub>μ</sub></italic>〉 and their pairwise interactions 〈<italic>v<sub>i</sub>h<sub>μ</sub></italic>〉. Additionally, second order statistics of pairwise neuron-neuron interactions 〈<italic>v<sub>i</sub>v<sub>j</sub></italic>〉, HU-HU interactions 〈<italic>h<sub>μ</sub>h<sub>ν</sub></italic>〉 and the reconstruction quality were evaluated, which the cRBM was not constrained to fit. Data statistics were calculated on withheld test data (30% of recording). Monitoring HU single and pairwise statistics 〈<italic>h<sub>μ</sub></italic>〉 and 〈<italic>h<sub>μ</sub>h<sub>ν</sub></italic>〉 served two purposes: (i) validation of model convergence and (ii) assessing whether correlations between assemblies can be captured by this bipartite model (i.e., without direct couplings between hidden units or an additional hidden layer). Model statistics cannot be calculated exactly, because that would require one to sample all possible states <italic>P</italic>(<bold>v</bold>, <bold>h</bold>), and were therefore approximated by evaluating cRBM-generated data. Here, 300 Monte Carlo chains were each initiated on random training data configurations and 50 configurations were sampled consecutively for each chain, with 20 sampling steps between saved configurations, after a burn-in period of 100 effective sampling configurations.</p><p id="P109">The 〈<italic>v<sub>i</sub>h<sub>μ</sub></italic>〉 statistic (<xref ref-type="fig" rid="F2">Figure 2C</xref>) was corrected for the sparsity regularization, by adding the sparsity regularization parameter <italic>λ</italic> to 〈<italic>v<sub>i</sub>h<sub>μ</sub></italic>〉: 〈<italic>v<sub>i</sub>h<sub>μ</sub></italic>〉<sub>model</sub> = 〈<italic>v<sub>i</sub>h<sub>μ</sub></italic>〉<sub>model-generated data</sub> + <italic>λ</italic> · <italic>sign</italic>(<italic>w<sub>i</sub>,μ</italic>). Furthermore, (<italic>v<sub>i</sub></italic>, <italic>h<sub>μ</sub></italic>) pairs with exactly <italic>w<sub>i,μ</sub></italic> = 0 were excluded from analysis (5% of total for optimal cRBM in <xref ref-type="fig" rid="F2">Figure 2C</xref>).</p><p id="P110">The pairwise neuron-neuron and HU-HU statistics (〈<italic>v<sub>i</sub>v<sub>j</sub></italic>〉, 〈<italic>h<sub>μ</sub>h<sub>ν</sub></italic>〉) were corrected for their (trivially) expected correlation due to their mean activities (by subtraction of 〈<italic>v<sub>i</sub></italic>〉〈<italic>v<sub>j</sub></italic>〉 and 〈<italic>h<sub>μ</sub></italic>〉〈<italic>h<sub>ν</sub></italic>〉 respectively), so that only true correlations were assessed.</p><p id="P111">Goodness of fit was quantified by computing the normalized Root Mean Square Error (nRMSE) for each statistic (shown in <xref ref-type="supplementary-material" rid="SD2">Figure S1</xref>). The RMSE between two vectors <bold>x</bold><sub>1</sub>, <bold>x</bold><sub>2</sub> of length <italic>N<sub>x</sub></italic> is defined as <inline-formula><mml:math id="M55"><mml:mrow><mml:mtext>RMSE</mml:mtext><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>x</mml:mi></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mstyle></mml:mrow></mml:msqrt><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula> Ordinary RMSE was normalized so that different statistics could be compared, where 1 corresponds to nRMSE<sub>shuffled</sub>, where both data and model statistics were randomly shuffled, and 0 corresponds to nRMSE<sub>optimal</sub> which is the RMSE between the training data and test data (by <inline-formula><mml:math id="M56"><mml:mrow><mml:mtext>nRMSE</mml:mtext><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mtext>RMSE</mml:mtext></mml:mrow><mml:mrow><mml:mtext>ondinary</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mtext>RMSE</mml:mtext></mml:mrow><mml:mrow><mml:mtext>chuaffled</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mtext>RMSE</mml:mtext></mml:mrow><mml:mrow><mml:mtext>optimal</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mrow/></mml:msub><mml:mtext>shuffled</mml:mtext></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula>).</p><p id="P112">Additionally, we assessed the reconstruction quality of the test data. Here, the log-likelihood (LLH) between the test data <bold>v</bold> and its reconstruction <inline-formula><mml:math id="M57"><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mtext mathvariant="bold">v</mml:mtext><mml:mrow><mml:mtext>recon</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo>∣</mml:mo><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">h</mml:mtext><mml:mo>∣</mml:mo><mml:mtext mathvariant="bold">v</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>∈</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula> was computed. Because <italic>v<sub>i</sub></italic> ∈ {0, 1}, the LLH is defined as <disp-formula id="FD18"><label>(18)</label><mml:math id="M58"><mml:mrow><mml:mtext>LLH</mml:mtext><mml:mo>(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mtext mathvariant="bold">v</mml:mtext><mml:mrow><mml:mtext>recon</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>T</mml:mi></mml:munderover><mml:mrow><mml:mi>log</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mtext mathvariant="bold">v</mml:mtext><mml:mrow><mml:mtext>recon</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∗</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mtext mathvariant="bold">v</mml:mtext><mml:mrow><mml:mtext>recon</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>∗</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p id="P113">The resulting LLH was normalized (nLLH) such that 0 corresponds to an independent model (i.e., fitting neural activity with <inline-formula><mml:math id="M59"><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mtext mathvariant="bold">v</mml:mtext><mml:mrow><mml:mtext>recon</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>〈</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>〉</mml:mo><mml:mspace width="0.5em"/><mml:mo>∀</mml:mo><mml:mspace width="0.5em"/><mml:mi>t</mml:mi></mml:mrow></mml:math></inline-formula> and 1 to optimal performance (which is LLH<sub>optimal</sub> = 0), by <inline-formula><mml:math id="M60"><mml:mrow><mml:mtext>nLLH</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mtext>LLH</mml:mtext></mml:mrow><mml:mrow><mml:mtext>ordinary</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mtext>LLH</mml:mtext></mml:mrow><mml:mrow><mml:mtext>independent</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mtext>LLH</mml:mtext></mml:mrow><mml:mrow><mml:mtext>independent</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula></p></sec><sec id="S33"><label>7.0.10.3</label><title>Generalized Linear Model</title><p id="P114">We used logistic regression, a Generalized Linear Model (GLM), to quantify the reconstruction quality of a fully connected model (i.e., with neuron-to-neuron connections, see <xref ref-type="supplementary-material" rid="SD2">Figure S2A</xref>). Logistic regression makes a probabilistic binary prediction (<xref ref-type="bibr" rid="R12">Bishop, 2006</xref>), hence allowing direct comparison to the probabilistic estimates of neural activity by the cRBM. In logistic regression, for a neuron <italic>v<sub>i</sub></italic>(<italic>t</italic>) at time <italic>t</italic>, the activity of all other neurons <bold>v</bold><sub>−<italic>i</italic></sub>(<italic>t</italic>) at time <italic>t</italic> was used to predict <inline-formula><mml:math id="M61"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>v</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mtext mathvariant="bold">w</mml:mtext><mml:mi>i</mml:mi></mml:msub><mml:mo>⋅</mml:mo><mml:msub><mml:mtext mathvariant="bold">v</mml:mtext><mml:mrow><mml:mo>−</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math></inline-formula> where <bold>w</bold><sub><italic>i</italic></sub> is the estimated weight vector. This was implemented with scikit-learn (<xref ref-type="bibr" rid="R54">Pedregosa et al., 2011</xref>), using <italic>L</italic><sub>2</sub> regularization. <italic>L</italic><sub>2</sub> regularization was favored over <italic>L</italic><sub>1</sub> as it typically yields higher reconstruction performance; in the related context of protein contact map prediction, <italic>L</italic><sub>2</sub>-regularized GLMs also better reconstructed contacts than <italic>L</italic><sub>1</sub>-regularized GLMs (<xref ref-type="bibr" rid="R49">Morcos et al., 2011</xref>). The parameter <italic>λ</italic><sub>GLM</sub> was optimized to <italic>λ</italic><sub>GLM</sub> = 1000 using cross-validation (<xref ref-type="supplementary-material" rid="SD2">Figure S2B</xref>). This is a computationally intensive model to compute because of the large number of regressor neurons <italic>N</italic> − 1. Therefore we performed the cross-validation of <xref ref-type="supplementary-material" rid="SD2">Figure S2B</xref> on 2% of all neurons (=1050 neurons) and computed the final 0 distribution of <xref ref-type="fig" rid="F2">Figure 2H</xref> on 10% of all neurons (= 5252 neurons). GLMs were trained on the same train data as cRBMs, and evaluated on the same withheld test data as cRBMs (as described above).</p></sec></sec><sec id="S34"><label>7.0.11</label><title>Regional occupancy</title><p id="P115">We determined the anatomical region labels of each neuron by registering our recordings to the ZBrain Atlas (as described previously). This yields a matrix <italic>L</italic> of size <italic>N</italic><sub>ZBA</sub> × <italic>N</italic>, which elements are <italic>l<sub>r,i</sub></italic> = 1 if neuron <italic>i</italic> is embedded in region <italic>r</italic> and 0 if it is not. A cRBM neural assembly of HU <italic>μ</italic> is defined by its weight vector <bold>w</bold><sub><italic>μ</italic></sub> (of size <italic>N</italic>). Because cRBMs converge to sparse solutions, most of the weight elements will be very close to 0. To determine which anatomical regions are occupied by the assembly neurons with significantly nonzero weights, we computed the dot product between the weight vector <bold>w</bold><sub><italic>μ</italic></sub> and matrix <italic>L</italic>, leading to a weighted region label vector (of size <italic>N</italic><sub>ZBA</sub>) for each HU. The matrix of all <italic>M</italic> weighted region label vectors is shown in <xref ref-type="supplementary-material" rid="SD2">Figure S4A</xref> for cRBM and <xref ref-type="supplementary-material" rid="SD2">Figure S4B</xref> for PCA.</p><p id="P116">The effective number of anatomical regions that one cRBM/PCA assembly is embedded in was then calculated using the Participation Ratio (PR) of each HU/Principal Axis. PRs are used to estimate the effective number of nonzero elements in a vector, without using a threshold (<xref ref-type="bibr" rid="R73">Tubiana &amp; Monasson, 2017</xref>). The PR of a vector <bold>x</bold> = (<italic>x</italic><sub>1</sub>,.., <italic>x<sub>n</sub></italic>) is defined by: <disp-formula id="FD19"><label>(19)</label><mml:math id="M62"><mml:mrow><mml:mtext>PR</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mtext mathvariant="bold">x</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:msubsup><mml:mi>x</mml:mi><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mstyle><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:msubsup><mml:mi>x</mml:mi><mml:mi>i</mml:mi><mml:mn>4</mml:mn></mml:msubsup></mml:mrow></mml:mstyle></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p id="P117">PR varies from <inline-formula><mml:math id="M63"><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac></mml:mrow></mml:math></inline-formula> when only 1 element of <bold>x</bold> is nonzero and <italic>n</italic> when all elements are equal. We therefore estimated the effective number of regions by multiplying PR of the weighted region label vectors with the total number of regions <italic>N</italic><sub>ZBA</sub> in <xref ref-type="supplementary-material" rid="SD2">Figure S4C</xref>.</p></sec><sec id="S35"><label>7.0.12</label><title>Time constant calculation</title><p id="P118">The dReLU potential <inline-formula><mml:math id="M64"><mml:mrow><mml:msub><mml:mi mathvariant="script">U</mml:mi><mml:mi>μ</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> of <xref ref-type="disp-formula" rid="FD13">equation 13</xref> can learn to take a variety of shapes, including a double-well potential (<xref ref-type="bibr" rid="R71">Tubiana et al., 2019a</xref>). HUs generally converged to this shape, giving rise to bimodal HU activity distributions (<xref ref-type="fig" rid="F4">Figure 4D</xref>). We determined the positions of the two peaks per HU using Gaussian Mixture Models fitted with two Gaussians. The bimodality transition point was then defined as the average between the two peaks (which was approximately 0 for most HUs). To calculate the time constant of state changes between the two activity modes, we subtracted the bimodality transition point from each HU activity <italic>h<sub>μ</sub></italic> individually. For clarity, all dynamic activity traces shown (e.g., <xref ref-type="fig" rid="F4">Figure 4</xref>) are thus bimodality transition point subtracted. The time constant of an activity trace was then defined as the period of a (two-state) oscillation. A HU oscillation is defined as a consecutive negative and positive activity interval (because the bimodality now occurs at 0). A neuron oscillation is defined as a consecutive interspike-interval and spike-interval (which can last for multiple time steps, for example see <xref ref-type="fig" rid="F1">Figure 1A</xref>, right panel).</p></sec><sec id="S36"><label>7.0.13</label><title>Sorting of HUs</title><p id="P119">HUs were sorted by hierarchical clustering of the Pearson correlation matrix of their dynamic activity (<xref ref-type="fig" rid="F4">Figure 4B</xref>). Hierarchical clustering was performed using the Ward variance minimization algorithm that defines the distance between clusters (<xref ref-type="bibr" rid="R76">Virtanen et al., 2020</xref>). This sorting of HUs (and thus assemblies) is maintained throughout the manuscript for the sake of consistency.</p></sec><sec id="S37"><label>7.0.14</label><title>Validating that the cRBM is in the compositional phase</title><p id="P120">To validate that the cRBMs converged to the compositional phase (see <xref ref-type="sec" rid="S22">section 7.0.6</xref>, compositional RBM formulation), we calculated the effective number of active HUs per data configuration (i.e., time step) <italic>m</italic>(<italic>t</italic>) = PR (<bold>h</bold><sub>+</sub>(<italic>t</italic>)) · <italic>M</italic> where PR is the participation ratio (<xref ref-type="disp-formula" rid="FD19">equation 19</xref>), <italic>M</italic> the number of HUs and <italic>h</italic><sub>+</sub> = <italic>h</italic> − <italic>h</italic><sub>inactive</sub>, where <italic>h</italic><sub>inactive</sub> is the inactive peak as calculated with the Gaussian Mixture Models (see <xref ref-type="sec" rid="S36">section 7.0.12</xref>), because PR assumes that inactive elements are approximately zero (<xref ref-type="bibr" rid="R71">Tubiana et al., 2019a</xref>). A cRBM is said to be in the compositional phase if 1 ≪ median(m) ≪ M, which is true for all cRBMs (<xref ref-type="supplementary-material" rid="SD2">Figure S3</xref>).</p></sec><sec id="S38"><label>7.0.15</label><title>Extensions of the structural connectivity matrix</title><p id="P121">The inter-region structural connectivity matrix was derived from the single cell zebrafish brain atlas (<xref ref-type="bibr" rid="R40">Kunst et al., 2019</xref>). We used the post-publication updated data set from (<xref ref-type="bibr" rid="R40">Kunst et al., 2019</xref>) (timestamp: 28 October 2019). The data set consists of <italic>N</italic> = 3098 neurons, each characterized by the 3D coordinates of the soma center and of its neurites; there is no distinction between dendrites and axons. The brain is subdivided into <italic>R</italic> = 72 regions and each neuron is duplicated by left/right hemisphere symmetry. We aim to estimate <italic>c<sub>r,r′</sub></italic>, the average strength of the connection between two neurons belonging to regions <italic>r, r</italic>′ ∈ [1, <italic>R</italic>]. For each neuron <italic>n</italic> ∈ [1, <italic>N</italic>], we determine, using region masks, the region <italic>r</italic>(<italic>n</italic>) where its soma is located and the cumulative length of the intersection between all its neurites and each region <italic>l<sub>n</sub></italic>(<italic>r</italic>). Under the assumptions that (i) the linear density of dendritic spines / axon presynaptic boutons is constant and (ii) the volumetric density of neurons is identical throughout regions, <italic>L<sub>n</sub></italic>(<italic>r</italic>) is proportional to the volume <italic>V<sub>r</sub></italic> of region <italic>r</italic> times the average (bidirectional) connection strength between neuron <italic>n</italic> and any neuron of region <italic>r</italic>. Aggregating over all neurons and symmetrizing, we obtain the following estimator for <italic>c<sub>r,r′</sub></italic>: <disp-formula id="FD20"><label>(20)</label><mml:math id="M65"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>r</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mtext>Symmetrized</mml:mtext><mml:mo>{</mml:mo><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>δ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>r</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:msup><mml:mi>r</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub><mml:mo>×</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>δ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mfrac><mml:mo>}</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>δ</italic><sub><italic>r</italic>(<italic>n</italic>),<italic>r</italic></sub> = 1 if neuron <italic>n</italic> has its soma in region <italic>r</italic> and 0 if not. Using the same notations, the formula previously used in (<xref ref-type="bibr" rid="R40">Kunst et al., 2019</xref>) is: <disp-formula id="FD21"><label>(21)</label><mml:math id="M66"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>r</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>ℓ</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>r</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:msup><mml:mi>r</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mi>r</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>}</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P122"><xref ref-type="disp-formula" rid="FD20">Equation 20</xref> differs from <xref ref-type="disp-formula" rid="FD21">Equation 21</xref> in three aspects: <list list-type="order" id="L5"><list-item><p id="P123">It discriminates between direct and indirect connections. Previously, a structural connection between region <italic>r</italic> and region <italic>r</italic>′ was established if a neuron had neurites with either tips or its soma within both regions. This may however result in indirect connections between <italic>r</italic> and <italic>r</italic>′, in cases where the neuron soma resides in another region <italic>r</italic>˝. Here, we only account for direct connections, resulting in an overall slightly sparser connectivity matrix.</p></list-item><list-item><p id="P124">It is well-defined along the diagonal, i.e., for intra-region connections, whereas in <xref ref-type="disp-formula" rid="FD21">Equation 21</xref>, each neurite would be counted as a self-connection.</p></list-item><list-item><p id="P125">The denominator corrects for non-uniform sampling of the <italic>traced</italic> neurons throughout regions. Note that this issue only arose in the post-publication data set as non-uniform sampling was used to fill missing entries of the matrix.</p></list-item></list>
</p></sec><sec id="S39"><label>7.0.16</label><title>Specimen averaging of connectivity matrices</title><p id="P126">The number of neurons in a particular brain region can vary across recordings from different specimen. Since the entries of the connectivity matrix are expected to be more accurate for well-sampled regions, we computed the weighted average of region-to-region connections <italic>c<sub>r,r′</sub></italic> as follows: <disp-formula id="FD22"><label>(22)</label><mml:math id="M67"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mo>〈</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>r</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mo>〉</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mtext>Fish</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>F</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>r</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mi>F</mml:mi></mml:msubsup><mml:mo>⋅</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>r</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mi>F</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mtext>Fish</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>F</mml:mtext></mml:mrow></mml:msub><mml:mrow><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>r</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mi>F</mml:mi></mml:msubsup></mml:mrow></mml:mstyle></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>r</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mi>F</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:msup><mml:mi>T</mml:mi><mml:mi>F</mml:mi></mml:msup><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>N</mml:mi><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow><mml:mi>F</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>N</mml:mi><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:msup><mml:mi>r</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:msub></mml:mrow><mml:mi>F</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p><p id="P127">Where <italic>T<sup>F</sup></italic> is the recording length and <inline-formula><mml:math id="M68"><mml:mrow><mml:msubsup><mml:mi>N</mml:mi><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow><mml:mi>F</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> is the number of neurons in region <italic>r</italic> of fish <italic>F</italic> that were recorded.</p></sec><sec id="S40"><label>7.0.17</label><title>Correlation analysis of connectivity matrices</title><p id="P128">Pearson correlation was used to assess the similarity between cRBM functional connectivity matrices of different individual animals (<xref ref-type="fig" rid="F5">Figure 5</xref>). Spearman correlation was used to compare structural connectivity versus functional connectivity (<xref ref-type="fig" rid="F6">Figure 6</xref>), because these two metrics do not necessarily scale linearly. All correlation analyses, and the Kilmogorov-Smirnov test of <xref ref-type="supplementary-material" rid="SD2">Figure S6C</xref>, performed on symmetric matrices excluded one off-diagonal triangle (of symmetrical values) to avoid duplicates.</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary Video 1</label><media xlink:href="EMS145924-supplement-Supplementary_Video_1.mp4" mimetype="video" mime-subtype="mp4" id="d35aAeEbB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD2"><label>Supplementary Information</label><media xlink:href="EMS145924-supplement-Supplementary_Information.pdf" mimetype="application" mime-subtype="pdf" id="d35aAeEcB" position="anchor"/></supplementary-material></sec></body><back><ack id="S41"><label>4</label><title>Acknowledgements</title><p>T.L.v.d.P. had an Erasmus+ fellowship (European Union) and acknowledges support from the Biotechnology and Biological Sciences Research Council (BBSRC, grant No. BB/M011224/1). J.T. acknowledges support from the Edmond J. Safra Center for Bioinformatics at Tel Aviv University and from the Human Frontier Science Program (cross-disciplinary postdoctoral fellowship LT001058/2019-C). G.M. was funded by a PhD fellowship from the Doctoral School in Physics, Ile de France (EDPIF). G.L.G. had a PhD fellowship from the Systems Biology Network of Sorbonne Université. B.E. and T.L.v.d.P. were supported by an NWO-VIDI Grant.</p><sec id="S42"><title>Funding sources</title><p>European Research Council (ERC) under the European Union’s Horizon 2020 research and innovation program grant agreement number 715980. Human Frontier Science Program (RGP0060/2017). The French Research National Agency under grant No. ANR-16-CE16-0017. Dutch Institute for Scientific Research NWO (Nederlandse Organisatie voor Wetenschappelijk Onderzoek) grant No. 016.VIDI.189.052.</p><p>We thank the IBPS fish facility staff for the fish maintenance, in particular Stéphane Tronche and Alex Bois. We are grateful to Carounagarane Dore for his contribution to the design of the experimental setup. We thank Misha Ahrens for providing the GCaMP lines. We are also grateful to Rémi Monasson for very fruitful discussions and his comments on the manuscript.</p></sec></ack><sec id="S43" sec-type="data-availability"><label>7.0.1</label><title>Data and Code Availability</title><p id="P129">The cRBM model has been developed in Python 3.7 and is available at: <ext-link ext-link-type="uri" xlink:href="https://github.com/jertubiana/PGM">https://github.com/jertubiana/PGM</ext-link></p><p id="P130">An extensive example notebook that implements this model is provided <ext-link ext-link-type="uri" xlink:href="https://github.com/jertubiana/PGM/blob/master/examples/Neural%20recordings%20of%20larval%20zebrafish%20spontaneous%20activity.ipynb">here</ext-link>.</p><p id="P131">Calcium imaging data pre-processing was performed in MATLAB (Mathworks) using previously published protocols and software (<xref ref-type="bibr" rid="R53">Panier et al., 2013</xref>; <xref ref-type="bibr" rid="R81">Wolf et al., 2017</xref>; <xref ref-type="bibr" rid="R47">Migault et al., 2018</xref>; <xref ref-type="bibr" rid="R74">Tubiana et al., 2020</xref>). The functional data recordings, the trained cRBM models and the structural connectivity matrix will be made publicly available after publication.</p><p id="P132">Figures of neural assemblies or neurons (<xref ref-type="fig" rid="F1">Figure 1</xref>, <xref ref-type="fig" rid="F3">3</xref>) were made using the Fishualizer, which is a 4D (space + time) data visualization software package that we have previously published (<xref ref-type="bibr" rid="R47">Migault et al., 2018</xref>), available at <ext-link ext-link-type="uri" xlink:href="https://bitbucket.org/benglitz/fishualizer_public">https://bitbucket.org/benglitz/fishualizer_public</ext-link></p><p id="P133">Minor updates were implemented to tailor the Fishualizer for viewing assemblies, which can be found at <ext-link ext-link-type="uri" xlink:href="https://bitbucket.org/benglitz/fishualizer_public/src/assembly_viewer/">https://bitbucket.org/benglitz/fishualizer_public/src/assembly_viewer/</ext-link></p><p id="P134">All other data analysis and visualization was performed in Python 3.7 using standard packages (numpy (<xref ref-type="bibr" rid="R26">Harris et al., 2020</xref>), scipy (<xref ref-type="bibr" rid="R76">Virtanen et al., 2020</xref>), scikit-learn (<xref ref-type="bibr" rid="R54">Pedregosa et al., 2011</xref>), matplotlib (<xref ref-type="bibr" rid="R34">Hunter, 2007</xref>), pandas (<xref ref-type="bibr" rid="R45">McKinney et al., 2010</xref>), seaborn (<xref ref-type="bibr" rid="R79">Waskom, 2021</xref>), h5py). The corresponding code is available from the authors on request.</p></sec><fn-group><fn id="FN2" fn-type="con"><p id="P135"><bold>5 Author Contributions</bold></p><p id="P136">T.L.v.d.P., J.T., V.B., B.E. and G.D. conceived the project, analyzed data and wrote the manuscript. T.L.v.d.P. and J.T. developed the cRBM code, performed the various analyses and wrote the original draft. G.L.G. and G.M. carried out the functional neural recording experiments and associated data pre-processing. M.K. and H.B. produced the structural connectivity data. V.B., B.E. and G.D. supervised the work. All authors contributed to the writing and editing of the manuscript.</p></fn><fn id="FN3" fn-type="conflict"><p id="P137"><bold>6 Declaration of Interests</bold></p><p id="P138">The authors declare no competing interests.</p></fn></fn-group><ref-list><ref id="R1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Abramowitz</surname><given-names>M</given-names></name><name><surname>Stegun</surname><given-names>IA</given-names></name><name><surname>Romer</surname><given-names>RH</given-names></name></person-group><source>Handbook of mathematical functions with formulas graphs and mathematical tables</source><year>1988</year></element-citation></ref><ref id="R2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ahrens</surname><given-names>MB</given-names></name></person-group><article-title>Zebrafish neuroscience: Using artificial neural networks to help understand brains</article-title><source>Current Biology</source><year>2019</year><volume>29</volume><fpage>R1138</fpage><lpage>R1140</lpage></element-citation></ref><ref id="R3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ahrens</surname><given-names>MB</given-names></name><name><surname>Engert</surname><given-names>F</given-names></name></person-group><article-title>Large-scale imaging in small brains</article-title><source>Current opinion in neurobiology</source><year>2015</year><volume>32</volume><fpage>78</fpage><lpage>86</lpage></element-citation></ref><ref id="R4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ahrens</surname><given-names>MB</given-names></name><name><surname>Li</surname><given-names>JM</given-names></name><name><surname>Orger</surname><given-names>MB</given-names></name><name><surname>Robson</surname><given-names>DN</given-names></name><name><surname>Schier</surname><given-names>AF</given-names></name><name><surname>Engert</surname><given-names>F</given-names></name><name><surname>Portugues</surname><given-names>R</given-names></name></person-group><article-title>Brain-wide neuronal dynamics during motor adaptation in zebrafish</article-title><source>Nature</source><year>2012</year><volume>485</volume><fpage>471</fpage><lpage>477</lpage></element-citation></ref><ref id="R5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ahrens</surname><given-names>MB</given-names></name><name><surname>Orger</surname><given-names>MB</given-names></name><name><surname>Robson</surname><given-names>DN</given-names></name><name><surname>Li</surname><given-names>JM</given-names></name><name><surname>Keller</surname><given-names>PJ</given-names></name></person-group><article-title>Whole-brain functional imaging at cellular resolution using light-sheet microscopy</article-title><source>Nature methods</source><year>2013</year><volume>10</volume><fpage>413</fpage><lpage>420</lpage></element-citation></ref><ref id="R6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bargmann</surname><given-names>CI</given-names></name><name><surname>Marder</surname><given-names>E</given-names></name></person-group><article-title>From the connectome to brain function</article-title><source>Nature methods</source><year>2013</year><volume>10</volume><fpage>483</fpage><lpage>490</lpage></element-citation></ref><ref id="R7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bartoszek</surname><given-names>EM</given-names></name><name><surname>Ostenrath</surname><given-names>AM</given-names></name><name><surname>Jetti</surname><given-names>SK</given-names></name><name><surname>Serneels</surname><given-names>B</given-names></name><name><surname>Mutlu</surname><given-names>AK</given-names></name><name><surname>Chau</surname><given-names>KTP</given-names></name><name><surname>Yaksi</surname><given-names>E</given-names></name></person-group><article-title>Ongoing habenular activity is driven by forebrain networks and modulated by olfactory stimuli</article-title><source>Current Biology</source><year>2021</year><volume>31</volume><fpage>3861</fpage><lpage>3874</lpage><elocation-id>e3</elocation-id><pub-id pub-id-type="doi">10.1016/j.cub.2021.08.021</pub-id><comment>URL: <ext-link ext-link-type="uri" xlink:href="https://linkinghub.elsevier.com/retrieve/pii/S0960982221011258">https://linkinghub.elsevier.com/retrieve/pii/S0960982221011258</ext-link></comment></element-citation></ref><ref id="R8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bassett</surname><given-names>DS</given-names></name><name><surname>Sporns</surname><given-names>O</given-names></name></person-group><article-title>Network neuroscience</article-title><source>Nature neuroscience</source><year>2017</year><volume>20</volume><fpage>353</fpage><lpage>364</lpage></element-citation></ref><ref id="R9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bathellier</surname><given-names>B</given-names></name><name><surname>Ushakova</surname><given-names>L</given-names></name><name><surname>Rumpel</surname><given-names>S</given-names></name></person-group><article-title>Discrete neocortical dynamics predict behavioral categorization ofsounds</article-title><source>Neuron</source><year>2012</year><volume>76</volume><fpage>435</fpage><lpage>449</lpage></element-citation></ref><ref id="R10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Beretta</surname><given-names>CA</given-names></name><name><surname>Dross</surname><given-names>N</given-names></name><name><surname>Gutierrez-Triana</surname><given-names>JA</given-names></name><name><surname>Ryu</surname><given-names>S</given-names></name><name><surname>Carl</surname><given-names>M</given-names></name></person-group><article-title>Habenula circuit development: past, present, and future</article-title><source>Frontiers in neuroscience</source><year>2012</year><volume>6</volume><fpage>51</fpage></element-citation></ref><ref id="R11"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Bialek</surname><given-names>W</given-names></name></person-group><source>Biophysics: searching for principles</source><publisher-name>Princeton University Press</publisher-name><year>2012</year></element-citation></ref><ref id="R12"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Bishop</surname><given-names>CM</given-names></name></person-group><source>Pattern recognition and machine learning</source><publisher-name>springer</publisher-name><year>2006</year></element-citation></ref><ref id="R13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buzsáki</surname><given-names>G</given-names></name></person-group><article-title>Neural syntax: cell assemblies, synapsembles, and readers</article-title><source>Neuron</source><year>2010</year><volume>68</volume><fpage>362</fpage><lpage>385</lpage></element-citation></ref><ref id="R14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>X</given-names></name><name><surname>Mu</surname><given-names>Y</given-names></name><name><surname>Hu</surname><given-names>Y</given-names></name><name><surname>Kuan</surname><given-names>AT</given-names></name><name><surname>Nikitchenko</surname><given-names>M</given-names></name><name><surname>Randlett</surname><given-names>O</given-names></name><name><surname>Chen</surname><given-names>AB</given-names></name><name><surname>Gavornik</surname><given-names>JP</given-names></name><name><surname>Sompolinsky</surname><given-names>H</given-names></name><name><surname>Engert</surname><given-names>F</given-names></name><etal/></person-group><article-title>Brain-wide organization of neuronal activity and convergent sensorimotor transformations in larval zebrafish</article-title><source>Neuron</source><year>2018</year><volume>100</volume><fpage>876</fpage><lpage>890</lpage></element-citation></ref><ref id="R15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>X</given-names></name><name><surname>Randi</surname><given-names>F</given-names></name><name><surname>Leifer</surname><given-names>AM</given-names></name><name><surname>Bialek</surname><given-names>W</given-names></name></person-group><article-title>Searching for collective behavior in a small brain</article-title><source>Physical Review E</source><year>2019</year><volume>99</volume><elocation-id>052418</elocation-id></element-citation></ref><ref id="R16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Das</surname><given-names>A</given-names></name><name><surname>Fiete</surname><given-names>IR</given-names></name></person-group><article-title>Systematic errors in connectivity inferred from activity in strongly recurrent networks</article-title><source>Nature Neuroscience</source><year>2020</year><volume>23</volume><fpage>1286</fpage><lpage>1296</lpage></element-citation></ref><ref id="R17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Diana</surname><given-names>G</given-names></name><name><surname>Sainsbury</surname><given-names>TT</given-names></name><name><surname>Meyer</surname><given-names>MP</given-names></name></person-group><article-title>Bayesian inference of neuronal assemblies</article-title><source>PLoS computational biology</source><year>2019</year><volume>15</volume><elocation-id>e1007481</elocation-id></element-citation></ref><ref id="R18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dunn</surname><given-names>TW</given-names></name><name><surname>Mu</surname><given-names>Y</given-names></name><name><surname>Narayan</surname><given-names>S</given-names></name><name><surname>Randlett</surname><given-names>O</given-names></name><name><surname>Naumann</surname><given-names>EA</given-names></name><name><surname>Yang</surname><given-names>C-T</given-names></name><name><surname>Schier</surname><given-names>AF</given-names></name><name><surname>Freeman</surname><given-names>J</given-names></name><name><surname>Engert</surname><given-names>F</given-names></name><name><surname>Ahrens</surname><given-names>MB</given-names></name></person-group><article-title>Brain-wide mapping of neural activity controlling zebrafish exploratory locomotion</article-title><source>Elife</source><year>2016</year><volume>5</volume><elocation-id>e12741</elocation-id></element-citation></ref><ref id="R19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eichenbaum</surname><given-names>H</given-names></name></person-group><article-title>Barlow versus hebb: When is it time to abandon the notion of feature detectors and adopt the cell assembly as the unit of cognition?</article-title><source>Neuroscience letters</source><year>2018</year><volume>680</volume><fpage>88</fpage><lpage>93</lpage></element-citation></ref><ref id="R20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ferrari</surname><given-names>U</given-names></name><name><surname>Obuchi</surname><given-names>T</given-names></name><name><surname>Mora</surname><given-names>T</given-names></name></person-group><article-title>Random versus maximum entropy models of neural population activity</article-title><source>Physical Review E</source><year>2017</year><volume>95</volume><elocation-id>042321</elocation-id></element-citation></ref><ref id="R21"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Fischer</surname><given-names>A</given-names></name><name><surname>Igel</surname><given-names>C</given-names></name></person-group><chapter-title>An introduction to restricted boltzmann machines</chapter-title><source>Iberoamerican congress on pattern recognition</source><year>2012</year><fpage>14</fpage><lpage>36</lpage><publisher-name>Springer</publisher-name></element-citation></ref><ref id="R22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Friedman</surname><given-names>J</given-names></name><name><surname>Hastie</surname><given-names>T</given-names></name><name><surname>Tibshirani</surname><given-names>R</given-names></name></person-group><article-title>Sparse inverse covariance estimation with the graphical lasso</article-title><source>Biostatistics</source><year>2008</year><volume>9</volume><fpage>432</fpage><lpage>441</lpage></element-citation></ref><ref id="R23"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Gardella</surname><given-names>C</given-names></name><name><surname>Marre</surname><given-names>O</given-names></name><name><surname>Mora</surname><given-names>T</given-names></name></person-group><source>Restricted boltzmann machines provide an accurate metric for retinal responses to visual stimuli</source><conf-name>5th International Conference on Learning Representations, ICLR 2017, Toulon, France, April 24-26, 2017, Workshop Track Proceedings</conf-name><year>2017</year><comment>OpenReview net. 2017 URL: <ext-link ext-link-type="uri" xlink:href="https://openreview.net/forum?id=Sk1OOnNFx">https://openreview.net/forum?id=Sk1OOnNFx</ext-link></comment></element-citation></ref><ref id="R24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gardella</surname><given-names>C</given-names></name><name><surname>Marre</surname><given-names>O</given-names></name><name><surname>Mora</surname><given-names>T</given-names></name></person-group><article-title>Modeling the correlated activity of neural populations: A review</article-title><source>Neural computation</source><year>2019</year><volume>31</volume><fpage>233</fpage><lpage>269</lpage></element-citation></ref><ref id="R25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gerstein</surname><given-names>GL</given-names></name><name><surname>Bedenbaugh</surname><given-names>P</given-names></name><name><surname>Aertsen</surname><given-names>AM</given-names></name></person-group><article-title>Neuronal assemblies</article-title><source>IEEE Transactions on Biomedical Engineering</source><year>1989</year><volume>36</volume><fpage>4</fpage><lpage>14</lpage></element-citation></ref><ref id="R26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harris</surname><given-names>CR</given-names></name><name><surname>Millman</surname><given-names>KJ</given-names></name><name><surname>van der Walt</surname><given-names>SJ</given-names></name><name><surname>Gommers</surname><given-names>R</given-names></name><name><surname>Virtanen</surname><given-names>P</given-names></name><name><surname>Cournapeau</surname><given-names>D</given-names></name><name><surname>Wieser</surname><given-names>E</given-names></name><name><surname>Taylor</surname><given-names>J</given-names></name><name><surname>Berg</surname><given-names>S</given-names></name><name><surname>Smith</surname><given-names>NJ</given-names></name><name><surname>Kern</surname><given-names>R</given-names></name><etal/></person-group><article-title>Array programming with NumPy</article-title><source>Nature</source><year>2020</year><volume>585</volume><fpage>357</fpage><lpage>362</lpage><pub-id pub-id-type="doi">10.1038/s41586-020-2649-2</pub-id></element-citation></ref><ref id="R27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harris</surname><given-names>KD</given-names></name></person-group><article-title>Neural signatures of cell assembly organization</article-title><source>Nature Reviews Neuroscience</source><year>2005</year><volume>6</volume><fpage>399</fpage><lpage>407</lpage></element-citation></ref><ref id="R28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harris</surname><given-names>KD</given-names></name></person-group><article-title>Cell assemblies of the superficial cortex</article-title><source>Neuron</source><year>2012</year><volume>76</volume><fpage>263</fpage><lpage>265</lpage></element-citation></ref><ref id="R29"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Hebb</surname><given-names>DO</given-names></name></person-group><source>The organization of behavior: A neuropsychological theory</source><publisher-name>Wiley</publisher-name><year>1949</year></element-citation></ref><ref id="R30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Helmstaedter</surname><given-names>M</given-names></name></person-group><article-title>The mutual inspirations of machine learning and neuroscience</article-title><source>Neuron</source><year>2015</year><volume>86</volume><fpage>25</fpage><lpage>28</lpage></element-citation></ref><ref id="R31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hinton</surname><given-names>GE</given-names></name></person-group><article-title>Training products of experts by minimizing contrastive divergence</article-title><source>Neural computation</source><year>2002</year><volume>14</volume><fpage>1771</fpage><lpage>1800</lpage></element-citation></ref><ref id="R32"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Hinton</surname><given-names>GE</given-names></name></person-group><chapter-title>A practical guide to training restricted boltzmann machines</chapter-title><source>Neural networks: Tricks of the trade</source><year>2012</year><fpage>599</fpage><lpage>619</lpage><publisher-name>Springer</publisher-name></element-citation></ref><ref id="R33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hinton</surname><given-names>GE</given-names></name><name><surname>Salakhutdinov</surname><given-names>RR</given-names></name></person-group><article-title>Reducing the dimensionality of data with neural networks</article-title><source>Science</source><year>2006</year><volume>313</volume><fpage>504</fpage><lpage>507</lpage></element-citation></ref><ref id="R34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hunter</surname><given-names>JD</given-names></name></person-group><article-title>Matplotlib: A 2d graphics environment</article-title><source>IEEE Annals of the History of Computing</source><year>2007</year><volume>9</volume><fpage>90</fpage><lpage>95</lpage></element-citation></ref><ref id="R35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jaynes</surname><given-names>ET</given-names></name></person-group><article-title>Information theory and statistical mechanics</article-title><source>Physical review</source><year>1957</year><volume>106</volume><fpage>620</fpage></element-citation></ref><ref id="R36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jazayeri</surname><given-names>M</given-names></name><name><surname>Afraz</surname><given-names>A</given-names></name></person-group><article-title>Navigating the neural space in search of the neural code</article-title><source>Neuron</source><year>2017</year><volume>93</volume><fpage>1003</fpage><lpage>1014</lpage></element-citation></ref><ref id="R37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kingma</surname><given-names>DP</given-names></name><name><surname>Ba</surname><given-names>J</given-names></name></person-group><article-title>Adam: A method for stochastic optimization</article-title><source>arXiv preprint</source><year>2014</year><elocation-id>arXiv:1412.6980</elocation-id></element-citation></ref><ref id="R38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kopell</surname><given-names>NJ</given-names></name><name><surname>Gritton</surname><given-names>HJ</given-names></name><name><surname>Whittington</surname><given-names>MA</given-names></name><name><surname>Kramer</surname><given-names>MA</given-names></name></person-group><article-title>Beyond the connectome: the dynome</article-title><source>Neuron</source><year>2014</year><volume>83</volume><fpage>1319</fpage><lpage>1328</lpage></element-citation></ref><ref id="R39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Köster</surname><given-names>U</given-names></name><name><surname>Sohl-Dickstein</surname><given-names>J</given-names></name><name><surname>Gray</surname><given-names>CM</given-names></name><name><surname>Olshausen</surname><given-names>BA</given-names></name></person-group><article-title>Modeling higher-order correlations within cortical microcolumns</article-title><source>PLoS computational biology</source><year>2014</year><volume>10</volume><elocation-id>e1003684</elocation-id></element-citation></ref><ref id="R40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kunst</surname><given-names>M</given-names></name><name><surname>Laurell</surname><given-names>E</given-names></name><name><surname>Mokayes</surname><given-names>N</given-names></name><name><surname>Kramer</surname><given-names>A</given-names></name><name><surname>Kubo</surname><given-names>F</given-names></name><name><surname>Fernandes</surname><given-names>AM</given-names></name><name><surname>Förster</surname><given-names>D</given-names></name><name><surname>Dal Maschio</surname><given-names>M</given-names></name><name><surname>Baier</surname><given-names>H</given-names></name></person-group><article-title>A cellular-resolution atlas of the larval zebrafish brain</article-title><source>Neuron</source><year>2019</year><volume>103</volume><fpage>21</fpage><lpage>38</lpage></element-citation></ref><ref id="R41"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Lam</surname><given-names>SK</given-names></name><name><surname>Pitrou</surname><given-names>A</given-names></name><name><surname>Seibert</surname><given-names>S</given-names></name></person-group><source>Numba: A llvm-based python jit compiler</source><conf-name>Proceedings of the Second Workshop on the LLVM Compiler Infrastructurein HPC</conf-name><year>2015</year><fpage>1</fpage><lpage>6</lpage></element-citation></ref><ref id="R42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lin</surname><given-names>L</given-names></name><name><surname>Osan</surname><given-names>R</given-names></name><name><surname>Shoham</surname><given-names>S</given-names></name><name><surname>Jin</surname><given-names>W</given-names></name><name><surname>Zuo</surname><given-names>W</given-names></name><name><surname>Tsien</surname><given-names>JZ</given-names></name></person-group><article-title>Identification of network-level coding units for real-time representation of episodic experiences in the hippocampus</article-title><source>Proceedings of the National Academy of Sciences</source><year>2005</year><volume>102</volume><fpage>6125</fpage><lpage>6130</lpage></element-citation></ref><ref id="R43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ma</surname><given-names>L-H</given-names></name><name><surname>Grove</surname><given-names>CL</given-names></name><name><surname>Baker</surname><given-names>R</given-names></name></person-group><article-title>Development of oculomotor circuitry independent of hox3 genes</article-title><source>Nature communications</source><year>2014</year><volume>5</volume><fpage>1</fpage><lpage>12</lpage></element-citation></ref><ref id="R44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marques</surname><given-names>JC</given-names></name><name><surname>Li</surname><given-names>M</given-names></name><name><surname>Schaak</surname><given-names>D</given-names></name><name><surname>Robson</surname><given-names>DN</given-names></name><name><surname>Li</surname><given-names>JM</given-names></name></person-group><article-title>Internal state dynamics shape brainwide activity and foraging behaviour</article-title><source>Nature</source><year>2020</year><volume>577</volume><fpage>239</fpage><lpage>243</lpage></element-citation></ref><ref id="R45"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>McKinney</surname><given-names>W</given-names></name><etal/></person-group><source>Data structures for statistical computing in python</source><conf-name>Proceedings of the 9th Python in Science Conference</conf-name><conf-loc>Austin, TX</conf-loc><year>2010</year><volume>445</volume><fpage>51</fpage><lpage>56</lpage></element-citation></ref><ref id="R46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Meshulam</surname><given-names>L</given-names></name><name><surname>Gauthier</surname><given-names>JL</given-names></name><name><surname>Brody</surname><given-names>CD</given-names></name><name><surname>Tank</surname><given-names>DW</given-names></name><name><surname>Bialek</surname><given-names>W</given-names></name></person-group><article-title>Collective behavior of place and non-place neurons in the hippocampal network</article-title><source>Neuron</source><year>2017</year><volume>96</volume><fpage>1178</fpage><lpage>1191</lpage></element-citation></ref><ref id="R47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Migault</surname><given-names>G</given-names></name><name><surname>van der Plas</surname><given-names>TL</given-names></name><name><surname>Trentesaux</surname><given-names>H</given-names></name><name><surname>Panier</surname><given-names>T</given-names></name><name><surname>Candelier</surname><given-names>R</given-names></name><name><surname>Proville</surname><given-names>R</given-names></name><name><surname>Englitz</surname><given-names>B</given-names></name><name><surname>Debre’geas</surname><given-names>G</given-names></name><name><surname>Bormuth</surname><given-names>V</given-names></name></person-group><article-title>Whole-brain calcium imaging during physiological vestibular stimulation in larval zebrafish</article-title><source>Current Biology</source><year>2018</year><volume>28</volume><fpage>3723</fpage><lpage>3735</lpage></element-citation></ref><ref id="R48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mölter</surname><given-names>J</given-names></name><name><surname>Avitan</surname><given-names>L</given-names></name><name><surname>Goodhill</surname><given-names>GJ</given-names></name></person-group><article-title>Detecting neural assemblies in calcium imaging data</article-title><source>BMC biology</source><year>2018</year><volume>16</volume><fpage>1</fpage><lpage>20</lpage></element-citation></ref><ref id="R49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Morcos</surname><given-names>F</given-names></name><name><surname>Pagnani</surname><given-names>A</given-names></name><name><surname>Lunt</surname><given-names>B</given-names></name><name><surname>Bertolino</surname><given-names>A</given-names></name><name><surname>Marks</surname><given-names>DS</given-names></name><name><surname>Sander</surname><given-names>C</given-names></name><name><surname>Zecchina</surname><given-names>R</given-names></name><name><surname>Onuchic</surname><given-names>JN</given-names></name><name><surname>Hwa</surname><given-names>T</given-names></name><name><surname>Weigt</surname><given-names>M</given-names></name></person-group><article-title>Direct-coupling analysis of residue coevolution captures native contacts across many protein families</article-title><source>Proceedings of the National Academy of Sciences</source><year>2011</year><volume>108</volume><elocation-id>E1293-E1301</elocation-id></element-citation></ref><ref id="R50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mu</surname><given-names>Y</given-names></name><name><surname>Bennett</surname><given-names>DV</given-names></name><name><surname>Rubinov</surname><given-names>M</given-names></name><name><surname>Narayan</surname><given-names>S</given-names></name><name><surname>Yang</surname><given-names>C-T</given-names></name><name><surname>Tanimoto</surname><given-names>M</given-names></name><name><surname>Mensh</surname><given-names>BD</given-names></name><name><surname>Looger</surname><given-names>LL</given-names></name><name><surname>Ahrens</surname><given-names>MB</given-names></name></person-group><article-title>Glia accumulate evidence that actions are futile and suppress unsuccessful behavior</article-title><source>Cell</source><year>2019</year><volume>178</volume><fpage>27</fpage><lpage>43</lpage></element-citation></ref><ref id="R51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Narayanan</surname><given-names>NS</given-names></name><name><surname>Kimchi</surname><given-names>EY</given-names></name><name><surname>Laubach</surname><given-names>M</given-names></name></person-group><article-title>Redundancy and synergy of neuronal ensembles in motor cortex</article-title><source>Journal of Neuroscience</source><year>2005</year><volume>25</volume><fpage>4207</fpage><lpage>4216</lpage></element-citation></ref><ref id="R52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Palm</surname><given-names>G</given-names></name><name><surname>Knoblauch</surname><given-names>A</given-names></name><name><surname>Hauser</surname><given-names>F</given-names></name><name><surname>Schü</surname><given-names>A</given-names></name></person-group><article-title>Cell assemblies in the cerebral cortex</article-title><source>Biological cybernetics</source><year>2014</year><volume>108</volume><fpage>559</fpage><lpage>572</lpage></element-citation></ref><ref id="R53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Panier</surname><given-names>T</given-names></name><name><surname>Romano</surname><given-names>S</given-names></name><name><surname>Olive</surname><given-names>R</given-names></name><name><surname>Pietri</surname><given-names>T</given-names></name><name><surname>Sumbre</surname><given-names>G</given-names></name><name><surname>Candelier</surname><given-names>R</given-names></name><name><surname>Debre’geas</surname><given-names>G</given-names></name></person-group><article-title>Fast functional imaging of multiple brain regions in intact zebrafish larvae using selective plane illumination microscopy</article-title><source>Frontiers in neural circuits</source><year>2013</year><volume>7</volume><fpage>65</fpage></element-citation></ref><ref id="R54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pedregosa</surname><given-names>F</given-names></name><name><surname>Varoquaux</surname><given-names>G</given-names></name><name><surname>Gramfort</surname><given-names>A</given-names></name><name><surname>Michel</surname><given-names>V</given-names></name><name><surname>Thirion</surname><given-names>B</given-names></name><name><surname>Grisel</surname><given-names>O</given-names></name><name><surname>Blondel</surname><given-names>M</given-names></name><name><surname>Prettenhofer</surname><given-names>P</given-names></name><name><surname>Weiss</surname><given-names>R</given-names></name><name><surname>Dubourg</surname><given-names>V</given-names></name><etal/></person-group><article-title>Scikit-learn: Machine learning in python</article-title><source>the Journal of machine Learning research</source><year>2011</year><volume>12</volume><fpage>2825</fpage><lpage>2830</lpage></element-citation></ref><ref id="R55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Posani</surname><given-names>L</given-names></name><name><surname>Cocco</surname><given-names>S</given-names></name><name><surname>Monasson</surname><given-names>R</given-names></name></person-group><article-title>Integration and multiplexing of positional and contextual information by the hippocampal network</article-title><source>PLoS computational biology</source><year>2018</year><volume>14</volume><elocation-id>e1006320</elocation-id></element-citation></ref><ref id="R56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Quirin</surname><given-names>S</given-names></name><name><surname>Vladimirov</surname><given-names>N</given-names></name><name><surname>Yang</surname><given-names>C-T</given-names></name><name><surname>Peterka</surname><given-names>DS</given-names></name><name><surname>Yuste</surname><given-names>R</given-names></name><name><surname>Ahrens</surname><given-names>MB</given-names></name></person-group><article-title>Calcium imaging of neural circuits with extended depth-of-field light-sheet microscopy</article-title><source>Optics letters</source><year>2016</year><volume>41</volume><fpage>855</fpage><lpage>858</lpage></element-citation></ref><ref id="R57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Randlett</surname><given-names>O</given-names></name><name><surname>Wee</surname><given-names>CL</given-names></name><name><surname>Naumann</surname><given-names>EA</given-names></name><name><surname>Nnaemeka</surname><given-names>O</given-names></name><name><surname>Schoppik</surname><given-names>D</given-names></name><name><surname>Fitzgerald</surname><given-names>JE</given-names></name><name><surname>Portugues</surname><given-names>R</given-names></name><name><surname>Lacoste</surname><given-names>AM</given-names></name><name><surname>Riegler</surname><given-names>C</given-names></name><name><surname>Engert</surname><given-names>F</given-names></name><etal/></person-group><article-title>Whole-brain activity mapping onto a zebrafish brain atlas</article-title><source>Nature methods</source><year>2015</year><volume>12</volume><fpage>1039</fpage><lpage>1046</lpage></element-citation></ref><ref id="R58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ravikumar</surname><given-names>P</given-names></name><name><surname>Wainwright</surname><given-names>MJ</given-names></name><name><surname>Lafferty</surname><given-names>JD</given-names></name><etal/></person-group><article-title>High-dimensional ising model selection using l1-regularized logistic regression</article-title><source>The Annals of Statistics</source><year>2010</year><volume>38</volume><fpage>1287</fpage><lpage>1319</lpage></element-citation></ref><ref id="R59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Romano</surname><given-names>SA</given-names></name><name><surname>Pietri</surname><given-names>T</given-names></name><name><surname>Pe’rez-Schuster</surname><given-names>V</given-names></name><name><surname>Jouary</surname><given-names>A</given-names></name><name><surname>Haudrechy</surname><given-names>M</given-names></name><name><surname>Sumbre</surname><given-names>G</given-names></name></person-group><article-title>Spontaneous neuronal network dynamics reveal circuit’s functional adaptations for behavior</article-title><source>Neuron</source><year>2015</year><volume>85</volume><fpage>1070</fpage><lpage>1085</lpage></element-citation></ref><ref id="R60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Roussel</surname><given-names>C</given-names></name><name><surname>Cocco</surname><given-names>S</given-names></name><name><surname>Monasson</surname><given-names>R</given-names></name></person-group><article-title>Barriers and dynamical paths in alternating gibbs sampling of restricted boltzmann machines</article-title><source>arXiv preprint</source><year>2021</year><elocation-id>arXiv:2107.06013</elocation-id></element-citation></ref><ref id="R61"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schneidman</surname><given-names>E</given-names></name><name><surname>Berry</surname><given-names>MJ</given-names></name><name><surname>Segev</surname><given-names>R</given-names></name><name><surname>Bialek</surname><given-names>W</given-names></name></person-group><article-title>Weak pairwise correlations imply strongly correlated network states in a neural population</article-title><source>Nature</source><year>2006</year><volume>440</volume><fpage>1007</fpage><lpage>1012</lpage></element-citation></ref><ref id="R62"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shlens</surname><given-names>J</given-names></name><name><surname>Field</surname><given-names>GD</given-names></name><name><surname>Gauthier</surname><given-names>JL</given-names></name><name><surname>Greschner</surname><given-names>M</given-names></name><name><surname>Sher</surname><given-names>A</given-names></name><name><surname>Litke</surname><given-names>AM</given-names></name><name><surname>Chichilnisky</surname><given-names>E</given-names></name></person-group><article-title>The structure of large-scale synchronized firing in primate retina</article-title><source>Journal of Neuroscience</source><year>2009</year><volume>29</volume><fpage>5022</fpage><lpage>5031</lpage></element-citation></ref><ref id="R63"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Smolensky</surname><given-names>P</given-names></name></person-group><chapter-title>Information processing in dynamical systems: Foundations of harmony theory</chapter-title><person-group person-group-type="editor"><name><surname>Rumelhart</surname><given-names>DE</given-names></name><name><surname>McClelland</surname><given-names>JL</given-names></name></person-group><source>Parallel Distributed Processing chapter 6</source><publisher-name>MIT Press</publisher-name><publisher-loc>Cambridge</publisher-loc><year>1986</year><volume>1</volume><fpage>194</fpage><lpage>281</lpage></element-citation></ref><ref id="R64"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Song</surname><given-names>S</given-names></name><name><surname>Sjöström</surname><given-names>PJ</given-names></name><name><surname>Reigl</surname><given-names>M</given-names></name><name><surname>Nelson</surname><given-names>S</given-names></name><name><surname>Chklovskii</surname><given-names>DB</given-names></name></person-group><article-title>Highly nonrandom features of synaptic connectivity in local cortical circuits</article-title><source>PLoS Biology</source><year>2005</year><volume>3</volume><fpage>e68</fpage></element-citation></ref><ref id="R65"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tavoni</surname><given-names>G</given-names></name><name><surname>Ferrari</surname><given-names>U</given-names></name><name><surname>Battaglia</surname><given-names>FP</given-names></name><name><surname>Cocco</surname><given-names>S</given-names></name><name><surname>Monasson</surname><given-names>R</given-names></name></person-group><article-title>Functional coupling networks inferred from prefrontal cortex activity show experience-related effective plasticity</article-title><source>Network Neuroscience</source><year>2017</year><volume>1</volume><fpage>275</fpage><lpage>301</lpage></element-citation></ref><ref id="R66"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Tieleman</surname><given-names>T</given-names></name></person-group><source>Training restricted boltzmann machines using approximations to the likelihood gradient</source><conf-name>Proceedings of the 25th international conference on Machine learning</conf-name><year>2008</year><fpage>1064</fpage><lpage>1071</lpage></element-citation></ref><ref id="R67"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Tieleman</surname><given-names>T</given-names></name><name><surname>Hinton</surname><given-names>G</given-names></name></person-group><source>Using fast weights to improve persistent contrastive divergence</source><conf-name>Proceedings of the 26th annual international conference on machine learning</conf-name><year>2009</year><fpage>1033</fpage><lpage>1040</lpage></element-citation></ref><ref id="R68"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Triplett</surname><given-names>MA</given-names></name><name><surname>Avitan</surname><given-names>L</given-names></name><name><surname>Goodhill</surname><given-names>GJ</given-names></name></person-group><article-title>Emergence of spontaneous assembly activity in developing neural networks without afferent input</article-title><source>PLoS computational biology</source><year>2018</year><volume>14</volume><elocation-id>e1006421</elocation-id></element-citation></ref><ref id="R69"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Triplett</surname><given-names>MA</given-names></name><name><surname>Pujic</surname><given-names>Z</given-names></name><name><surname>Sun</surname><given-names>B</given-names></name><name><surname>Avitan</surname><given-names>L</given-names></name><name><surname>Goodhill</surname><given-names>GJ</given-names></name></person-group><article-title>Model-based decoupling of evoked and spontaneous neural activity in calcium imaging data</article-title><source>PLoS computational biology</source><year>2020</year><volume>16</volume><elocation-id>e1008330</elocation-id></element-citation></ref><ref id="R70"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Tubiana</surname><given-names>J</given-names></name></person-group><source>Restricted Boltzmann machines: from compositional representations to protein sequence analysis</source><publisher-name>Ph.D. thesis PSL Research University</publisher-name><year>2018</year></element-citation></ref><ref id="R71"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tubiana</surname><given-names>J</given-names></name><name><surname>Cocco</surname><given-names>S</given-names></name><name><surname>Monasson</surname><given-names>R</given-names></name></person-group><article-title>Learning compositional representations of interacting systems withrestricted boltzmann machines: Comparative study of lattice proteins</article-title><source>Neural computation</source><year>2019a</year><volume>31</volume><fpage>1671</fpage><lpage>1717</lpage></element-citation></ref><ref id="R72"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tubiana</surname><given-names>J</given-names></name><name><surname>Cocco</surname><given-names>S</given-names></name><name><surname>Monasson</surname><given-names>R</given-names></name></person-group><article-title>Learning protein constitutive motifs from sequence data</article-title><source>Elife</source><year>2019b</year><volume>8</volume><elocation-id>e39397</elocation-id></element-citation></ref><ref id="R73"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tubiana</surname><given-names>J</given-names></name><name><surname>Monasson</surname><given-names>R</given-names></name></person-group><article-title>Emergence of compositional representations in restricted boltzmannmachines</article-title><source>Physical review letters</source><year>2017</year><volume>118</volume><elocation-id>138301</elocation-id></element-citation></ref><ref id="R74"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tubiana</surname><given-names>J</given-names></name><name><surname>Wolf</surname><given-names>S</given-names></name><name><surname>Panier</surname><given-names>T</given-names></name><name><surname>Debregeas</surname><given-names>G</given-names></name></person-group><article-title>Blind deconvolution for spike inference from fluorescence recordings</article-title><source>Journal of neuroscience methods</source><year>2020</year><volume>342</volume><elocation-id>108763</elocation-id></element-citation></ref><ref id="R75"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vanwalleghem</surname><given-names>GC</given-names></name><name><surname>Ahrens</surname><given-names>MB</given-names></name><name><surname>Scott</surname><given-names>EK</given-names></name></person-group><article-title>Integrative whole-brain neuroscience in larval zebrafish</article-title><source>Current opinion in neurobiology</source><year>2018</year><volume>50</volume><fpage>136</fpage><lpage>145</lpage></element-citation></ref><ref id="R76"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Virtanen</surname><given-names>P</given-names></name><name><surname>Gommers</surname><given-names>R</given-names></name><name><surname>Oliphant</surname><given-names>TE</given-names></name><name><surname>Haberland</surname><given-names>M</given-names></name><name><surname>Reddy</surname><given-names>T</given-names></name><name><surname>Cournapeau</surname><given-names>D</given-names></name><name><surname>Burovski</surname><given-names>E</given-names></name><name><surname>Peterson</surname><given-names>P</given-names></name><name><surname>Weckesser</surname><given-names>W</given-names></name><name><surname>Bright</surname><given-names>J</given-names></name><name><surname>van der Walt</surname><given-names>SJ</given-names></name><etal/></person-group><article-title>SciPy 1.0: Fundamental Algorithms for Scientific Computing in Python</article-title><source>Nature Methods</source><year>2020</year><volume>17</volume><fpage>261</fpage><lpage>272</lpage><pub-id pub-id-type="doi">10.1038/s41592-019-0686-2</pub-id></element-citation></ref><ref id="R77"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vladimirov</surname><given-names>N</given-names></name><name><surname>Mu</surname><given-names>Y</given-names></name><name><surname>Kawashima</surname><given-names>T</given-names></name><name><surname>Bennett</surname><given-names>DV</given-names></name><name><surname>Yang</surname><given-names>C-T</given-names></name><name><surname>Looger</surname><given-names>LL</given-names></name><name><surname>Keller</surname><given-names>PJ</given-names></name><name><surname>Freeman</surname><given-names>J</given-names></name><name><surname>Ahrens</surname><given-names>MB</given-names></name></person-group><article-title>Light-sheet functional imaging in fictively behaving zebrafish</article-title><source>Nature methods</source><year>2014</year><volume>11</volume><fpage>883</fpage><lpage>884</lpage></element-citation></ref><ref id="R78"><element-citation publication-type="report"><person-group person-group-type="author"><name><surname>Volpi</surname><given-names>R</given-names></name><name><surname>Zanotto</surname><given-names>M</given-names></name><name><surname>Maccione</surname><given-names>A</given-names></name><name><surname>Di Marco</surname><given-names>S</given-names></name><name><surname>Berdondini</surname><given-names>L</given-names></name><name><surname>Sona</surname><given-names>D</given-names></name><name><surname>Murino</surname><given-names>V</given-names></name></person-group><article-title>Modeling a population of retinal ganglion cells with restricted boltzmann machines</article-title><source>Scientific reports</source><year>2020</year><volume>10</volume><fpage>1</fpage><lpage>10</lpage></element-citation></ref><ref id="R79"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Waskom</surname><given-names>ML</given-names></name></person-group><article-title>Seaborn: statistical data visualization</article-title><source>Journal of Open Source Software</source><year>2021</year><volume>6</volume><fpage>3021</fpage></element-citation></ref><ref id="R80"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>White</surname><given-names>JG</given-names></name><name><surname>Southgate</surname><given-names>E</given-names></name><name><surname>Thomson</surname><given-names>JN</given-names></name><name><surname>Brenner</surname><given-names>S</given-names></name></person-group><article-title>The structure of the nervous system of the nematode caenorhabditiselegans</article-title><source>Philos Trans R Soc Lond B Biol Sci</source><year>1986</year><volume>314</volume><fpage>1</fpage><lpage>340</lpage></element-citation></ref><ref id="R81"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wolf</surname><given-names>S</given-names></name><name><surname>Dubreuil</surname><given-names>AM</given-names></name><name><surname>Bertoni</surname><given-names>T</given-names></name><name><surname>Böhm</surname><given-names>UL</given-names></name><name><surname>Bormuth</surname><given-names>V</given-names></name><name><surname>Candelier</surname><given-names>R</given-names></name><name><surname>Karpenko</surname><given-names>S</given-names></name><name><surname>Hildebrand</surname><given-names>DG</given-names></name><name><surname>Bianco</surname><given-names>IH</given-names></name><name><surname>Monasson</surname><given-names>R</given-names></name><etal/></person-group><article-title>Sensorimotor computation underlying phototaxis in zebrafish</article-title><source>Nature communications</source><year>2017</year><volume>8</volume><fpage>1</fpage><lpage>12</lpage></element-citation></ref><ref id="R82"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wolf</surname><given-names>S</given-names></name><name><surname>Supatto</surname><given-names>W</given-names></name><name><surname>Debre’geas</surname><given-names>G</given-names></name><name><surname>Mahou</surname><given-names>P</given-names></name><name><surname>Kruglik</surname><given-names>SG</given-names></name><name><surname>Sintes</surname><given-names>J-M</given-names></name><name><surname>Beaurepaire</surname><given-names>E</given-names></name><name><surname>Candelier</surname><given-names>R</given-names></name></person-group><article-title>Whole-brain functional imaging with two-photon light-sheet microscopy</article-title><source>Nature methods</source><year>2015</year><volume>12</volume><fpage>379</fpage><lpage>380</lpage></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>cRBMs construct Hidden Units by grouping neurons into assemblies</title><p><bold>(A)</bold> The neural activity of zebrafish larvae was imaged using light-sheet microscopy (left), which resulted in brain-scale, single-cell resolution data sets (middle, microscopy image of a single plane shown for fish #1). Calcium activity Δ<italic>F</italic>/<italic>F</italic> was deconvolved to binarized spike traces for each segmented cell (right, example neuron).</p><p><bold>(B)</bold> cRBM sparsely connects neurons (left) to Hidden Units (HUs, right). The neurons that connect to a HU are defined to be its corresponding assembly (depicted by color labeling, right panel). Data sets typically consist of <italic>N</italic> ~ 10<sup>4</sup> neurons and <italic>M</italic> ~ 10<sup>2</sup> HUs. The activity of 500 randomly chosen example neurons (raster plot, left) and HUs 99, 26, 115 (activity traces, right) of the same time excerpt is shown. HU activity is continuous and is determined by transforming the neural activity of its assembly.</p><p><bold>(C)</bold> The neural assemblies of an example data set (fish #3) are shown by coloring each neuron according to its strongest-connecting HU. 7 assemblies are highlighted (starting rostrally at the green forebrain assembly, going clockwise: HU 177, 187, 7, 156, 124, 64, 178), by showing their neurons with a connection |<italic>w</italic>| ≥ 0.1. See <xref ref-type="fig" rid="F3">Figure 3</xref> for more anatomical details of assemblies.</p><p>R: Right, L: Left, Ro: Rostral, C: Caudal.</p></caption><graphic xlink:href="EMS145924-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>cRBM is optimized to accurately replicate data statistics</title><p><bold>(A)</bold> Schematic of the cRBM architecture, with neurons <italic>v<sub>i</sub></italic> on the left, HUs <italic>h<sub>μ</sub></italic> on the right, connected by weights <italic>w<sub>i,μ</sub></italic>. <bold>(B)</bold> Schematic depicting how cRBMs generate new data. The HU activity <bold>h</bold>(<italic>t</italic>) is sampled from the visible unit (i.e., neuron) configuration <bold>v</bold>(<italic>t</italic>), after which the new visible unit configuration <bold>v</bold>(<italic>t</italic> + 1) is sampled and so forth.</p><p><bold>(C)</bold> cRBM-predicted and experimental mean neural activity 〈<italic>v<sub>i</sub></italic>〉 were highly correlated (Pearson correlation <italic>r</italic><sub>P</sub> = 0.91, <italic>P</italic> &lt; 10<sup>−307</sup>) and had low error (nRMSE<sub>〈<italic>v<sub>i</sub></italic>〉</sub> = 0.11, normalized Root Mean Square Error, see <xref ref-type="sec" rid="S10">Methods</xref>). Data displayed as 2D probability density function (PDF), scaled logarithmically (base 10).</p><p><bold>(D)</bold> cRBM-predicted and experimental mean Hidden Unit (HU) activity 〈<italic>h<sub>μ</sub></italic>〉 also correlated very strongly (<italic>r</italic><sub>P</sub> = 0.93, <italic>P</italic> &lt; 10<sup>−86</sup>) and had low nRMSE<sub>〈<italic>h<sub>μ</sub></italic>〉</sub> = 0.15 (other details as in C)</p><p><bold>(E)</bold> cRBM-predicted and experimental average pairwise neuron-HU interactions 〈<italic>v<sub>i</sub>h<sub>μ</sub></italic>〉 correlated strongly (<italic>r</italic><sub>P</sub> = 0.74, <italic>P</italic> &lt; 10<sup>−307</sup>) and had a low error (nRMSE<sub>〈<italic>v<sub>i</sub>h<sub>μ</sub></italic>〉</sub> = 0.09).</p><p><bold>(F)</bold> cRBM-predicted and experimental average pairwise neuron-neuron interactions 〈<italic>v<sub>i</sub>v<sub>j</sub></italic>〉 correlated well (<italic>r</italic><sub>P</sub> = 0.58, <italic>P</italic> &lt; 10<sup>−307</sup>) and had a low error (nRMSE<sub>〈<italic>v<sub>i</sub>v<sub>j</sub>〉</italic></sub> = −0.09, where the negative nRMSE value means that cRBM-predictions match the test data slightly better than the train data). Pairwise interactions were corrected for naive correlations due to their mean activity by subtracting 〈<italic>v<sub>i</sub></italic>〉〈<italic>v<sub>j</sub></italic>〉.</p><p><bold>(G)</bold> cRBM-predicted and experimental average pairwise HU-HU interactions 〈<italic>h<sub>μ</sub>h<sub>ν</sub></italic>〉 correlated strongly (<italic>r</italic><sub>P</sub> = 0.73, <italic>P</italic> &lt; 10<sup>−307</sup>) and had a low error (nRMSE<sub>〈<italic>h<sub>μ</sub>h<sub>ν</sub></italic>〉</sub> = 0.17).</p><p><bold>(H)</bold> The low-dimensional cRBM bottleneck reconstructs most neurons above chance level (purple), quantified by the normalized log-likelihood (nLLH) between neural test data vi and the reconstruction after being transformed to HU activity (see <xref ref-type="sec" rid="S10">Methods</xref>). Median normalized nLLH<sub>cRBM</sub> = 0.24. Reconstruction quality was also determined for a fully connected Generalized Linear Model (GLM) that attempted to reconstruct the activity of a neuron <italic>v<sub>i</sub></italic> using all other neurons <bold>v</bold><sub>−<italic>i</italic></sub> (see <xref ref-type="sec" rid="S10">Methods</xref>). The distribution of 5000 randomly chosen neurons is shown (blue), with median nLLH<sub>GLM</sub> = 0.20. The cRBM distribution is stochastically greater than the GLM distribution (one-sided Mann Whitney U test, <italic>P</italic> &lt; 10<sup>−42</sup>).</p><p><bold>(I)</bold> cRBM (purple) had a sparse weight distribution, but exhibited a greater proportion of large weights <italic>w<sub>i,μ</sub></italic> than PCA (yellow), both for positive and negative weights, displayed in log-probability.</p><p><bold>(J)</bold> Distribution of above-threshold absolute weights |<italic>w<sub>i,μ</sub></italic>| per neuron <italic>v<sub>i</sub></italic> (dark purple), indicating that more neurons strongly connect to the cRBM hidden layer than expected by shuffling the weight matrix of the same cRBM (light purple). The threshold Θ was set such that the expected number of above-threshold weights per neuron <inline-formula><mml:math id="M69"><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>#</mml:mo><mml:msub><mml:mtext mathvariant="bold">w</mml:mtext><mml:mi>i</mml:mi></mml:msub><mml:mo>&gt;</mml:mo><mml:mo>Θ</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1.</mml:mn></mml:mrow></mml:math></inline-formula></p><p><bold>(K)</bold> Corresponding distribution as in (J) for PCA (dark yellow) and its shuffled weight matrix (light yellow), indicating a predominance of small weights in PCA for most neurons <italic>v<sub>i</sub></italic>.</p><p>All panels of this figure show the data statistics of the cRBM with parameters <italic>M</italic> = 200 and <italic>λ</italic> = 0.02 (best choice after cross-validation, see <xref ref-type="supplementary-material" rid="SD2">Figure S1</xref>) of example fish #3, comparing the experimental test data test and model-generated data after cRBM training converged.</p></caption><graphic xlink:href="EMS145924-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>cRBM assemblies compose functional circuits and anatomical structures</title><p><bold>(A-I)</bold> Individual example assemblies <italic>μ</italic> are shown by coloring each neuron <italic>i</italic> with its connectivity weight value <italic>w<sub>i,μ</sub></italic> (see color bar at the right hand side). The assembly index <italic>μ</italic> is stated at the bottom of each panel. The orientation and scale are given in panel A (Ro: rostral, C: caudal, R: right, L: left, D: dorsal, V: ventral). Anatomical regions of interest, defined by the ZBrain Atlas (<xref ref-type="bibr" rid="R57">Randlett et al., 2015</xref>), are shown in each panel (Rh: rhombomere, nMLF: nucleus of the medial longitudinal fascicle; nIII: oculomotor nucleus nIII, Cl: cluster; Str: stripe, P. nV TG: Posterior cluster of nV trigeminal motorneurons; Pa: pallium; Hb: habenula; IPN: interpeduncular nucleus).</p><p><bold>(J-L)</bold> Groups of example assemblies that lie in the same anatomical region are shown for cerebellum (Cb), torus semicircularis (TSC) and optic tectum (OT). Neurons <italic>i</italic> were defined to be in an assembly <italic>μ</italic> when |<italic>w<sub>i,μ</sub></italic>| &gt; 0.15, and colored accordingly. If neurons were in multiple assemblies shown, they were colored according to their strongest-connecting assembly.</p></caption><graphic xlink:href="EMS145924-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>HU dynamics are bimodal and activate slower than neurons</title><p><bold>(A)</bold> HU dynamics are diverse and are partially shared across HUs. The bimodality transition point of each HU was determined and subtracted individually, such that positive values correspond to HU activation (see <xref ref-type="sec" rid="S10">Methods</xref>). The test data consisted of 3 blocks, with a discontinuity in time between the first and second block (<xref ref-type="sec" rid="S10">Methods</xref>).</p><p><bold>(B)</bold> Highlighted example traces from panel A. HU indices are denoted on the right of each trace, colored according to their cluster from panel D. The corresponding cellular assemblies of these HU are shown in <xref ref-type="fig" rid="F3">Figure 3A-I</xref>.</p><p><bold>(C)</bold> Top: Pearson correlation matrix of the dynamic activity of panel A. Bottom: Hierarchical clustering of the Pearson correlation matrix. Clusters (as defined by the colors) were annotated manually. This sorting of HUs is maintained throughout the manuscript. OT: Optic Tectum, Di: Diencephalon, ARTR: anterior rhombencephalic turning region, Misc.: Miscellaneous, L: Left, R: Right.</p><p><bold>(D)</bold> The distribution of all HU activity values of panel A shows that HU activity is bimodal and sparsely activated (because the positive peak is smaller than the negative peak). PDF: Probability Density Function.</p><p><bold>(E)</bold> Distribution of the time constants of HUs (black) and neurons (grey). Time constants are defined as the median oscillation period, for both HUs and neurons. An HU oscillation is defined as a consecutive negative and positive activity interval. A neuron oscillation is defined as a consecutive interspike-interval and spike-interval (which can last for multiple time steps, for example see <xref ref-type="fig" rid="F1">Figure 1A</xref>). The time constant distribution of HUs is greater than the neuron distribution (Mann Whitney U test, <italic>P</italic> &lt; 10<sup>−16</sup>).</p></caption><graphic xlink:href="EMS145924-f004"/></fig><fig id="F5" position="float"><label>Figure 5</label><caption><title>cRBM gives rise to functional connectivity that is strongly correlated across individuals</title><p><bold>(A)</bold> The functional connectivity matrix between anatomical regions of the mapzebrain atlas (<xref ref-type="bibr" rid="R40">Kunst et al., 2019</xref>) of example fish #2 is shown. Functional connections between two anatomical regions were determined by the similarity of the HUs to which neurons from both regions connect to (<xref ref-type="sec" rid="S10">Methods</xref>). Mapzebrain atlas regions with less than 5 imaged neurons were excluded, yielding <italic>N</italic><sub>MAP</sub> = 50 regions in total. See <xref ref-type="supplementary-material" rid="SD2">Table S1</xref> for region name abbreviations. The matrix is shown in log<sub>10</sub> scale, because functional connections are distributed approximately log-normal (see panel D).</p><p><bold>(B)</bold> Equivalent figure for example fish #3 (example fish of prior figures).</p><p><bold>(C)</bold> Equivalent figure for example fish #4. Panels A-C share the same log<sub>10</sub> color scale (right).</p><p><bold>(D)</bold> Functional connections are distributed approximately log-normal. (Mutual information with a log-normal fit (black dashed line) is 3.83, while the mutual information with a normal fit is 0.13). All connections of all 8 fish are shown, in log<sub>10</sub> scale (purple).</p><p><bold>(E)</bold> Functional connections of different fish correlate well, exemplified by the 3 example fish of panels A-C. All non-zero functional connections (x-axis and y-axis) are shown, in log<sub>10</sub> scale. Pearson correlation rP between pairs: <italic>r</italic><sub>P</sub>(#2, #3) = 0.73, <italic>r</italic><sub>P</sub>(#2, #4) = 0.73, <italic>r</italic><sub>P</sub>(#3, #4) = 0.78. All correlation P values &lt; 10<sup>−20</sup> (two-sided t-test).</p><p><bold>(F)</bold> Pearson correlations <italic>r</italic><sub>P</sub> of region-to-region functional connections between all pairs of 8 fish. For each pair, regions with less than 5 neurons in either fish were excluded. All P values &lt; 10<sup>−20</sup> (two-sided t-test), and average correlation value is 0.69.</p></caption><graphic xlink:href="EMS145924-f005"/></fig><fig id="F6" position="float"><label>Figure 6</label><caption><title>cRBM-inferred functional connectivity reflects structural connectivity</title><p><bold>(A)</bold> Structural connectivity matrix is shown in log<sub>10</sub> scale, adapted from <xref ref-type="bibr" rid="R40">Kunst et al. (2019)</xref>. Regions that were not imaged in our experiments were excluded (such that <italic>N</italic><sub>MAP</sub> = 50 out of 72 regions remain). Regions (x-axis and y-axis) were sorted according to <xref ref-type="bibr" rid="R40">Kunst et al. (2019)</xref>. Additional structural data was added and the normalization procedure was updated to include within-region connectivity (see <xref ref-type="sec" rid="S10">Methods</xref>). See <xref ref-type="supplementary-material" rid="SD2">Table S1</xref> for region name abbreviations.</p><p><bold>(B)</bold> Average functional connectivity matrix is shown in log<sub>10</sub> scale, as determined by averaging the cRBM functional connectivity matrices of all 8 fish (see <xref ref-type="sec" rid="S10">Methods</xref>). The same regions (x-axis and y-axis) are shown as in panel A.</p><p><bold>(C)</bold> The average functional and structural connectivity of panels A and B correlate well, with Spearman correlation <italic>r</italic><sub>S</sub> = 0.39 (<italic>P</italic> &lt; 10<sup>−20</sup>, two-sided t-test). Each data point corresponds to one region-to-region pair. Data points for which the structural connection was exactly 0 were excluded (see panel D for their analysis).</p><p><bold>(D)</bold> The distribution of average functional connections of region pairs with non-zero structural connections is greater than functional connections corresponding to region pairs without structural connections (<italic>P</italic> &lt; 10<sup>−15</sup>, two-sided Kolmogorov-Smirnov test). The bottom panel shows the evidence for inferring either non-zero or zero structural connections, defined as the fraction between the PDFs of the top panel (fitted Gaussian distributions were used for denoising).</p></caption><graphic xlink:href="EMS145924-f006"/></fig></floats-group></article>