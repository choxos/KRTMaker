<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="epub">2692-8205</issn></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS207077</article-id><article-id pub-id-type="doi">10.1101/2025.07.02.662710</article-id><article-id pub-id-type="archive">PPR1046304</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Accurate and Interpretable Prediction of Antidepressant Treatment Response from Receptor-informed Neuroimaging</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Tolle</surname><given-names>Hanna M.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">∗</xref></contrib><contrib contrib-type="author"><name><surname>Luppi</surname><given-names>Andrea I</given-names></name><xref ref-type="aff" rid="A2">2</xref><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Lawn</surname><given-names>Timothy</given-names></name><xref ref-type="aff" rid="A5">5</xref></contrib><contrib contrib-type="author"><name><surname>Roseman</surname><given-names>Leor</given-names></name><xref ref-type="aff" rid="A6">6</xref></contrib><contrib contrib-type="author"><name><surname>Nutt</surname><given-names>David</given-names></name><xref ref-type="aff" rid="A7">7</xref></contrib><contrib contrib-type="author"><name><surname>Carhart-Harris</surname><given-names>Robin L.</given-names></name><xref ref-type="aff" rid="A8">8</xref><xref ref-type="aff" rid="A9">9</xref></contrib><contrib contrib-type="author"><name><surname>Mediano</surname><given-names>Pedro A. M.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A10">10</xref><xref ref-type="corresp" rid="CR2">†</xref></contrib></contrib-group><aff id="A1"><label>1</label>Department of Computing, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/041kmwe10</institution-id><institution>Imperial College London</institution></institution-wrap></aff><aff id="A2"><label>2</label>Centre for Eudaimonia and Human Flourishing, Department of Psychiatry, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/052gg0110</institution-id><institution>University of Oxford</institution></institution-wrap></aff><aff id="A3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/05ghs6f64</institution-id><institution>Montreal Neurological Institute</institution></institution-wrap>, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/01pxwe438</institution-id><institution>McGill University</institution></institution-wrap></aff><aff id="A4"><label>4</label>Division of Information Engineering and St John’s College, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/013meh722</institution-id><institution>University of Cambridge</institution></institution-wrap></aff><aff id="A5"><label>5</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/032q5ym94</institution-id><institution>Athinoula A. Martinos Center for Biomedical Imaging</institution></institution-wrap>, Department of Radiology, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/002pd6e78</institution-id><institution>Massachusetts General Hospital</institution></institution-wrap> and Harvard Medical School</aff><aff id="A6"><label>6</label>Department of Psychology, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/03yghzc09</institution-id><institution>University of Exeter</institution></institution-wrap></aff><aff id="A7"><label>7</label>Division of Psychiatry, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/041kmwe10</institution-id><institution>Imperial College London</institution></institution-wrap></aff><aff id="A8"><label>8</label>Departments of Neurology, Psychiatry and Behavioral Sciences, Weill Institute for Neurosciences, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/043mz5j54</institution-id><institution>University of California San Francisco</institution></institution-wrap></aff><aff id="A9"><label>9</label>Centre for Psychedelic Research, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/041kmwe10</institution-id><institution>Imperial College London</institution></institution-wrap></aff><aff id="A10"><label>10</label>Division of Psychology and Language Sciences, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/02jx3x895</institution-id><institution>University College London</institution></institution-wrap></aff><author-notes><corresp id="CR1"><label>∗</label><email>h.tolle23@imperial.ac.uk</email></corresp><corresp id="CR2"><label>†</label><email>p.mediano@imperial.ac.uk</email></corresp></author-notes><pub-date pub-type="nihms-submitted"><day>11</day><month>07</month><year>2025</year></pub-date><pub-date pub-type="preprint"><day>03</day><month>07</month><year>2025</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Conventional antidepressants show moderate efficacy in treating major depressive disorder. Psychedelic-assisted therapy holds promise, yet individual responses vary, underscoring the need for predictive tools to guide treatment selection. Here, we present <monospace>graphTRIP</monospace>(graph-based Treatment Response Interpretability and Prediction) – a geometric deep learning architecture that enables three advances: 1) accurate prediction of post-treatment depression severity using only pretreatment clinical and neuroimaging data; 2) identification of robust, patient-specific biomarkers; and 3) causal analysis of treatment effects and underlying mechanisms. Trained on data from a clinical trial comparing psilocybin and escitalopram (NCT03429075), <monospace>graphTRIP</monospace> achieves strong predictive accuracy (<italic>r</italic> = 0.75, <italic>p</italic> &lt; 10<sup>−8</sup>), and generalises both to an independent dataset and across brain atlases. The model links better outcomes to reduced functional coupling within serotonin systems, and broader serotonergic integration with sensory-motor networks. Finally, causal analysis reveals a group-level advantage of psilocybin over escitalopram, but also identifies individuals with specific stress-related neuromodulatory profiles who may benefit more from escitalopram. Overall, this work advances precision medicine and biomarker discovery in depression.</p></abstract><kwd-group><kwd>precision medicine</kwd><kwd>geometric deep learning</kwd><kwd>depression</kwd><kwd>interpretability</kwd><kwd>psychedelic therapy</kwd></kwd-group></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P2">Major depressive disorder (MDD) is a debilitating psychiatric disorder that places a serious burden on individuals, their families, and society. Already a leading cause of disability worldwide [<xref ref-type="bibr" rid="R1">1</xref>], its incidence has continued to rise in recent years [<xref ref-type="bibr" rid="R2">2</xref>, <xref ref-type="bibr" rid="R3">3</xref>], highlighting the urgent need for a more effective treatment strategy.</p><p id="P3">Selective serotonin reuptake inhibitors (SSRIs) are the most widely prescribed antidepressant drugs [<xref ref-type="bibr" rid="R4">4</xref>]. These compounds act by inhibiting the reuptake of serotonin (5-HT) from the synaptic cleft through blockade of the serotonin transporter (5-HTT, a.k.a. SERT) [<xref ref-type="bibr" rid="R4">4</xref>]. While SSRIs are among the most effective treatments currently available, less than 40% of patients achieve remission after the first treatment course, and approximately one in three fails to remit even after multiple successive treatment trials with different SSRIs [<xref ref-type="bibr" rid="R5">5</xref>, <xref ref-type="bibr" rid="R6">6</xref>].</p><p id="P4">The psychedelic compound psilocybin has recently emerged as a promising alternative to conventional antidepressants [<xref ref-type="bibr" rid="R7">7</xref>], with some evidence indicating efficacy even in SSRI-resistant patients [<xref ref-type="bibr" rid="R8">8</xref>, <xref ref-type="bibr" rid="R9">9</xref>]. Like most psychedelic drugs, psilocybin primarily acts as an agonist at the serotonin receptors 5-HT2A and 5-HT1A [<xref ref-type="bibr" rid="R10">10</xref>]. Notably, in contrast to SSRIs, which require continuous daily use, psilocybin treatment typically involves only one or two therapist-guided drug sessions in addition to psychological therapy [<xref ref-type="bibr" rid="R11">11</xref>].</p><p id="P5">However, like all treatments, psychedelic treatments come with associated risks. Individual responses to psychedelics vary widely, with one study reporting increased suicidal ideation in certain individuals [<xref ref-type="bibr" rid="R9">9</xref>]. This variability likely reflects both the underlying heterogeneity of MDD [<xref ref-type="bibr" rid="R12">12</xref>] and the marked individual differences in response to psychedelics [<xref ref-type="bibr" rid="R13">13</xref>]. Thus, to safely deploy psychedelic treatments and improve MDD prognosis worldwide, we need a means to predict how an individual patient will respond to a given treatment, allowing for a more targeted approach and reducing the prolonged trial- and-error process in antidepressant prescribing.</p><p id="P6">One promising approach is to predict treatment outcomes from pre-treatment neuroimaging data. Because brain function is assumed to emerge from complex interactions between specialised regions, it is natural to model the brain as a network, or brain graph, where nodes represent brain regions (defined by a brain atlas) and edges capture anatomical or functional connectivity [<xref ref-type="bibr" rid="R14">14</xref>]. Functional connectivity (FC) refers to statistical dependencies – typically correlations – between brain regional activity, and its disruption has been consistently linked to psychiatric disorders, including MDD [<xref ref-type="bibr" rid="R15">15</xref>–<xref ref-type="bibr" rid="R17">17</xref>], making it a particularly relevant feature for antidepressant response prediction. Furthermore, recent approaches such as REACT (Receptor-Enriched Analysis of functional Connectivity by Targets) enable the integration of fMRI data with normative maps of molecular targets, derived from PET imaging [<xref ref-type="bibr" rid="R18">18</xref>–<xref ref-type="bibr" rid="R21">21</xref>], providing features of neuromodulatory activity that have proven valuable for studying neurological and psychiatric disorders [<xref ref-type="bibr" rid="R22">22</xref>, <xref ref-type="bibr" rid="R23">23</xref>], as well as the acute effects of psychedelics [<xref ref-type="bibr" rid="R24">24</xref>]. Together, these developments position molecularly informed brain graphs as a clinically relevant basis for predicting antidepressant treatment outcomes.</p><p id="P7">Indeed, previous studies using machine learning (ML) have achieved notable successes in predicting antidepressant treatment outcome from brain graph features [<xref ref-type="bibr" rid="R25">25</xref>–<xref ref-type="bibr" rid="R27">27</xref>], yet several key challenges have so far hindered clinical translation. For instance, prior approaches have largely focused on binary classification of treatment response, or remission, because sample sizes of available datasets are often too small for accurate prediction of post-treatment depression scores [<xref ref-type="bibr" rid="R25">25</xref>, <xref ref-type="bibr" rid="R27">27</xref>, <xref ref-type="bibr" rid="R28">28</xref>]. Furthermore, few models have been validated on independent datasets, and those that have, show limited generalisation performance [<xref ref-type="bibr" rid="R25">25</xref>]. Moreover, conventional ML architectures require fixed input sizes, which constrains the analysis to a specific brain atlas. However, the choice of atlas can substantially alter findings, and no universally accepted standard exists [<xref ref-type="bibr" rid="R29">29</xref>, <xref ref-type="bibr" rid="R30">30</xref>].</p><p id="P8">Another key barrier to clinical translation is the lack of interpretability – most classical ML models operate as “black boxes,” offering little insight into the basis of their predictions. In a clinical context, this is unacceptable. To ensure safe and reliable decisions, it is crucial to understand why a specific treatment outcome was predicted. Importantly, interpretability must be available at the individual patient level to verify that each decision is based on valid, biologically-relevant features. Although there is a broad and fast-moving literature on interpretability for large language models [<xref ref-type="bibr" rid="R31">31</xref>, <xref ref-type="bibr" rid="R32">32</xref>], its application to clinical ML has thus far remained limited [<xref ref-type="bibr" rid="R33">33</xref>]. Closing this gap is essential, not only for safety, but also for identifying biomarkers of treatment responsiveness and advancing our understanding of antidepressant treatment.</p><p id="P9">Beyond interpretability, a further critical challenge lies in estimating <italic>causal</italic> treatment effects. Predictive models can identify features associated with good or poor response, but they cannot reliably determine whether one treatment would have worked better than another for a given patient. To enable data-driven treatment selection, we must therefore go beyond prediction and incorporate causal inference methods that can distinguish shared biomarkers of treatment responsiveness from treatment-specific moderators.</p><p id="P10">Here, we present a geometric deep learning (GDL) approach for predicting antidepressant treatment response from pre-treatment clinical and fMRI data in patients treated with escitalopram or psilocybin. GDL is uniquely suited to learning from brain graphs, enabling more powerful and biologically-informed predictions than conventional ML. Our novel architecture, dubbed <monospace>graphTRIP</monospace>, addresses key roadblocks to clinical translation in a fundamentally new way: 1) it directly predicts post-treatment depression scores (QIDS) with high accuracy; 2) it generalises to an independent dataset of SSRI-resistant patients, treated with psilocybin; 3) it flexibly adapts to different brain atlases, maintaining significant predictions without retraining; 4) it enables rich interpretability analyses – particularly through our novel method GRAIL (Gradient Alignment for Interpreting Latent-variable models), which quantifies learned associations between treatment outcome and any brain-graph biomarkers of interest. Finally, we extend our model within a causal inference framework [<xref ref-type="bibr" rid="R34">34</xref>], enabling us to estimate the expected difference in outcome under psilocybin versus escitalopram for each patient, and discern treatment-specific moderators.</p><p id="P11">Leveraging state-of-the-art GDL and causal inference, our approach advances the field of antidepressant response prediction, offering a robust tool for both biomarker discovery and clinical decision-making.</p></sec><sec id="S2" sec-type="results"><title>Results</title><p id="P12">The primary dataset [<xref ref-type="bibr" rid="R35">35</xref>] in our study included 42 MDD patients who participated in a double-blind randomised controlled trial (DB-RCT) with two treatment arms: psilocybin (<italic>N</italic> = 22) and escitalopram (<italic>N</italic> = 20) (<xref ref-type="fig" rid="F1">Fig. 1a</xref>). To assess the generalisability of our model, we used an independent dataset [<xref ref-type="bibr" rid="R8">8</xref>] consisting of 16 patients with treatment-resistance depression (TRD), who received psilocybin in an open-label trial (<xref ref-type="fig" rid="F1">Fig. 1b</xref>). In both datasets, we used baseline resting-state fMRI scans and clinical data (QIDS and BDI depression scores, and a binary indicator of prior SSRI use) and the drug condition (psilocybin or escitalopram) as input features to our model. The primary prediction target was post-treatment QIDS.</p><p id="P13">Our model, called <monospace>graphTRIP</monospace> (graph-based Treatment Response Interpretability and Prediction), combines a variational graph autoencoder (VGAE) with a multilayer perceptron (MLP) (<xref ref-type="fig" rid="F1">Fig. 1c</xref>). The VGAE learns a latent representation of brain graphs. The MLP predicts post-treatment QIDS. Brain graphs were constructed from baseline fMRI data, with edges defined by thresholded FC (|FC| &gt; 0.5). The threshold was chosen to approximate the density of typical structural connectomes, though performance generalised to alternative thresholding choices (<xref ref-type="supplementary-material" rid="SD1">Supp. Fig. 7</xref>). Node features encoded REACT values for 5-HT1A, 5-HT2A, and 5-HTT, denoted as R5-HT1A, R5-HT2A, and R5-HTT to distinguish them from the corresponding normative receptor densities. REACT provides subject-specific estimates of how strongly each brain region’s activity is functionally coupled with a molecular target of interest. The VGAE encoder maps each brain region to a latent space, and the decoder reconstructs the original graph from the resulting matrix of latent node vectors, <italic>Z</italic>. A readout layer then aggregates <italic>Z</italic> into a graph-level representation vector <bold><italic>z</italic></bold>, conditioned on the treatment. This vector, combined with the drug condition and baseline clinical data, serves as input to the MLP.</p><p id="P14">We applied two analyses to probe model predictions: 1) analysis of the VGAE readout to assess the predictive contributions of brain regions, and 2) analysis of the latent space using our GRAIL method to identify biomarkers of treatment responsiveness (<xref ref-type="fig" rid="F1">Fig. 1d</xref>).</p><p id="P15">Moving beyond predictive modelling, we further extended <monospace>graphTRIP</monospace> within a causal inference framework to estimate individual treatment effects and identify treatment-specific moderators (<xref ref-type="fig" rid="F1">Fig. 1e</xref>).</p><sec id="S3"><title>Accurate, robust predictions of treatment response</title><p id="P16"><monospace>graphTRIP</monospace> achieved a strong correlation between true and predicted post-treatment QIDS scores (<italic>r</italic> = 0.7047, <italic>p</italic> &lt; 1.9 × 10<sup>−7</sup>; <xref ref-type="fig" rid="F2">Fig. 2a</xref>) and showed good reconstruction performance (<xref ref-type="fig" rid="F2">Figure 2c-d</xref>). In contrast, a control MLP, trained only on the clinical data and the drug condition (i.e., without neuroimaging data) performed substantially worse (<italic>r</italic> = 0.3947, <italic>p</italic> &lt; 9.7 × 10<sup>−3</sup>; <xref ref-type="fig" rid="F2">Fig. 2a</xref>). Further analysis suggests that the control MLP primarily predicted the mean QIDS scores for each drug condition, which was higher in the escitalopram group [<xref ref-type="bibr" rid="R35">35</xref>]. After controlling for the drug condition, the partial correlation between true and predicted scores remained significant for <monospace>graphTRIP</monospace> (<italic>r</italic> = 0.6607, <italic>p</italic> &lt; 1.9 × 10<sup>−6</sup>), but not for the control MLP (<italic>r</italic> = 0.2663, <italic>p</italic> = 0.0883; <xref ref-type="fig" rid="F2">Fig. 2b</xref>). Reducing the neuroimaging data using PCA or t-SNE also failed to produce meaningful predictions, highlighting the advantage of <monospace>graphTRIP</monospace>’s VGAE (<xref ref-type="supplementary-material" rid="SD8">Supp. Fig. 8</xref>).</p><p id="P17">To assess the contribution of latent brain-graph features in the <monospace>graphTRIP</monospace> model, we performed permutation importance analysis, measuring the impact of feature shuffling on prediction error (mean absolute error) across 50 repetitions. Higher increases in error indicate greater feature importance. As expected, baseline QIDS was the most important predictor (<xref ref-type="fig" rid="F2">Fig. 2e</xref>). The latent brain-graph representation <bold><italic>z</italic></bold>, ranked second.</p><p id="P18">We additionally trained a <monospace>graphTRIP</monospace> model to predict post-treatment BDI scores. We achieved significant predictions (<italic>r</italic> = 0.5490, <italic>p</italic> &lt; 1.7 1× 0<sup>−4</sup>; <xref ref-type="supplementary-material" rid="SD9">Supp. Fig. 9</xref>), confirming the robustness of our approach.</p></sec><sec id="S4"><title>Generalisation across brain atlases</title><p id="P19">We evaluated <monospace>graphTRIP</monospace>’s ability to generalise across brain parcellations by testing it on atlases different from the one used for training (Schaefer 100 [<xref ref-type="bibr" rid="R36">36</xref>]). On Schaefer 200, which has twice as many parcels, <monospace>graphTRIP</monospace> produced highly accurate reconstructions and maintained significant prediction performance (<italic>r</italic> = 0.5633, <italic>p</italic> &lt; 1.0 × 10<sup>−4</sup>; <xref ref-type="fig" rid="F3">Fig. 3a</xref>). We further replicated this result on the AAL atlas [<xref ref-type="bibr" rid="R37">37</xref>], which differs fundamentally from Schaefer and includes subcortical regions, where <monospace>graphTRIP</monospace> also generalised (<italic>r</italic> = 0.5205, <italic>p</italic> &lt; 4.1 × 10<sup>−4</sup>; <xref ref-type="supplementary-material" rid="SD10">Supp. Fig. 10</xref>).</p><p id="P20">Once a parcellation is selected, all brain graphs have a consistent number of nodes and direct anatomical correspondence across subjects. Exploiting this, we trained an atlas-bound model on the full, unthresholded Schaefer 100 FC matrices. Like <monospace>graphTRIP</monospace>, it includes a representation learning module (analogous to the VGAE) and an MLP for QIDS prediction. However, unlike <monospace>graphTRIP</monospace>, it processes entire FC columns as node features and does not incorporate edges, enabling it to handle the full FC, at the trade-off of being restricted to a fixed parcellation.</p><p id="P21">We trained a hybrid predictor combining the strengths of both models by concatenating their latent representations. Specifically, after pretraining each model separately, we froze their representation learning modules and trained a new MLP on the combined latent features, along with baseline clinical data and the drug condition (<xref ref-type="fig" rid="F3">Fig. 3b</xref>). This hybrid approach yielded the best prediction performance (<italic>r</italic> = 0.7507, <italic>p</italic> &lt; 1.0 × 10<sup>−8</sup>; <xref ref-type="fig" rid="F3">Fig. 3c</xref>), suggesting that the models capture complementary information. Importance analysis revealed that <monospace>graphTRIP</monospace>’s latent features were substantially more influential (<xref ref-type="fig" rid="F3">Fig. 3d</xref>), suggesting that the atlas-bound model acts as an auxiliary component, offering a performance boost if committing to a parcellation is acceptable.</p></sec><sec id="S5"><title>Validation in an independent dataset</title><p id="P22">We evaluated <monospace>graphTRIP</monospace> on an independent dataset that differed from the primary dataset in key aspects (<xref ref-type="fig" rid="F1">Fig. 1a</xref>), including 1) a single treatment arm (psilocybin); 2) patients with treatment-resistant depression (TRD); 3) a different psilocybin treatment protocol; and 4) a different follow-up assessment time point.</p><p id="P23">Fine-tuning <monospace>graphTRIP</monospace> on the validation dataset required addressing some of the dataset differences. Since all patients in the validation dataset had TRD and received psilocybin, SSRI history and drug condition inputs were constant and hence uninformative for training. Thus, we pretrained a modified <monospace>graphTRIP</monospace> model on the primary dataset, removing drug condition and SSRI history from the MLP (<xref ref-type="fig" rid="F4">Fig. 4a</xref>), with only a small drop in prediction accuracy (<italic>r</italic> = 0.6393, <italic>p</italic> &lt; 5.2 × 10<sup>−6</sup>). The pretrained model was then transferred, freezing VGAE weights and fine-tuning only the MLP on the new dataset (see <xref ref-type="sec" rid="S14">Methods</xref>). Note that since pretraining involved 6-fold cross-validation (CV), we obtained six pretrained models. We fine-tuned each of these models separately, and averaged final predictions across models.</p><p id="P24">Even without fine-tuning, the pretrained VGAEs maintained high reconstruction accuracy on the validation dataset (<xref ref-type="fig" rid="F4">Fig. 4b</xref>). Crucially, fine-tuned models achieved a significant correlation between true scores and mean predictions (<xref ref-type="fig" rid="F4">Fig. 4c</xref>). Notably, given the small validation sample (<italic>N</italic> = 16), training from scratch proved infeasible, whereas pretraining and fine-tuning consistently enabled successful transfer (<xref ref-type="fig" rid="F4">Fig. 4d</xref>).</p></sec><sec id="S6"><title>Model attention reflects cortical hierarchy</title><p id="P25"><monospace>graphTRIP</monospace>’s attention module provides a natural way to assess regional contributions to predictions: since the final prediction is based on a weighted average of latent node vectors <bold><italic>z</italic></bold><sub><italic>i</italic></sub>, regions with higher attention weight contribute more strongly to the prediction (<xref ref-type="fig" rid="F5">Fig. 5a</xref>). More specifically, attention weights are computed based on <bold><italic>z</italic></bold><sub><italic>i</italic></sub> and the drug condition, allowing us to estimate each region’s predictive effect at both individual and treatment-group levels. Given the high consistency of attention patterns across CV-fold models (<xref ref-type="supplementary-material" rid="SD11">Supp. Fig. 11a</xref>), we averaged attention weights across folds for each patient in all subsequent analyses.</p><p id="P26">First, for each patient, we computed regional attention weights by conditioning the readout on the patient’s actual treatment, yielding one attention vector per patient. Averaging across patients revealed a clear population-wide pattern: the model attends most to sensory-motor (SMN) and visual (VIS) regions, and least to association cortices (<xref ref-type="fig" rid="F5">Fig. 5a</xref>). This spatial pattern aligns with the unimodal-transmodal cortical gradient, known to reflect key anatomical and functional differences [<xref ref-type="bibr" rid="R20">20</xref>, <xref ref-type="bibr" rid="R38">38</xref>–<xref ref-type="bibr" rid="R41">41</xref>]. Indeed, a linear model predicting regional attention weights from unimodal-transmodal axis assignments and ten normative molecular-target density maps, derived from open-access datasets [<xref ref-type="bibr" rid="R20">20</xref>, <xref ref-type="bibr" rid="R41">41</xref>, <xref ref-type="bibr" rid="R42">42</xref>] (see <xref ref-type="sec" rid="S14">Methods</xref>), achieved a strong correlation with observed values (<italic>r</italic> = 0.8782, <italic>p</italic> &lt; 10<sup>−4</sup> against 1000 spatial autocorrelation-preserving nulls [<xref ref-type="bibr" rid="R43">43</xref>]). Dominance analysis confirmed the unimodal-transmodal axis as the strongest predictor, followed by serotonin receptor densities (<xref ref-type="fig" rid="F5">Fig. 5b</xref>).</p><p id="P27">Second, to assess treatment-specific effects, we computed two attention vectors for each patient by conditioning the model separately on psilocybin and escitalopram. We found a significant shift in attention from unimodal (SMN, VIS) to transmodal (DMN, FPN, LIM) regions when the model predicted outcomes under psilocybin compared to escitalopram (<xref ref-type="fig" rid="F5">Fig. 5d</xref>). This suggests that the model relies more heavily on association cortices when estimating psilocybin response.</p></sec><sec id="S7"><title>Biomarkers of treatment responsiveness</title><p id="P28">Beyond attention weights, we developed GRAIL to systematically link treatment response predictions to brain graph-derived biomarkers (<xref ref-type="fig" rid="F5">Fig. 5f</xref>). This method exploits the dual structure of <monospace>graphTRIP</monospace> – a VGAE for learning brain graph representations and an MLP for predicting treatment outcome. For any differentiable biomarker of interest (<italic>b</italic>), GRAIL computes the alignment (cosine similarity) between the gradient of the model’s prediction (<italic>ŷ</italic>) and the gradient of <italic>b</italic> in latent space. Intuitively, these gradients describe how small changes in the latent brain representation affect the prediction <italic>ŷ</italic> and the biomarker <italic>b</italic>, respectively. Thus, their alignment provides a direct, analytical measure of learned associations: positive alignment indicates that higher biomarker values are associated with worse treatment outcomes (i.e., higher post-treatment QIDS), and negative alignment suggests the opposite. Zero alignment suggests no learned association.</p><p id="P29">We applied GRAIL to <monospace>graphTRIP</monospace> and assessed learned associations for a range of candidate biomarkers (Tab. I), chosen to span two biologically and clinically relevant axes: large-scale brain networks (i.e., resting-state networks; RSNs [<xref ref-type="bibr" rid="R44">44</xref>]) and neuromodulatory systems. Specifically, we included ten normative molecular-target density maps available from open-access datasets [<xref ref-type="bibr" rid="R20">20</xref>, <xref ref-type="bibr" rid="R42">42</xref>], covering major neurotransmitter systems implicated in antidepressant treatment [<xref ref-type="bibr" rid="R12">12</xref>]: serotonin (5-HT), dopamine (DA), noradrenaline (NA), acetylcholine (ACh). Candidate biomarkers included i) mean brain graph features (i.e., FC or REACT maps) within each RSN, and ii) spatial correlations between each brain graph feature and the normative molecular target maps. This broad screening strategy leverages GRAIL’s ability to discover biomarkers in a data-driven fashion.</p><p id="P30">For each patient and candidate biomarker, we computed gradient alignments for 100 latent brain-graph samples. Results were highly consistent across both latent samples and CV-fold models (<xref ref-type="supplementary-material" rid="SD11">Supp. Fig. 11b,c</xref>). Thus, each patient’s alignment pattern was derived by averaging across samples and folds. Some biomarkers displayed distinct patterns, suggesting the presence of patient subtypes. To identify these, we clustered patients based on the similarity of their mean alignment profiles using the Louvain algorithm for community detection, revealing two treatment responsiveness subtypes, with one patient left unassigned due to an intermediate profile. We focused all following analyses on biomarkers with absolute mean alignment above the 75<sup>th</sup> percentile.</p><p id="P31">Among the strongest biomarkers with consistent positive alignment were the correlations between R5-HT1A, R5-HT2A, and R5-HTT REACT maps, as well as correlations of R5-HT2A and R5-HTT with normative 5-HT4 density (<xref ref-type="fig" rid="F5">Fig. 5g</xref>). These results suggest that decreased functional coupling within serotonin systems is broadly associated with better treatment outcomes. Additionally, weaker FC of regions with higher normative 5-HT1A density was also linked to improved response.</p><p id="P32">We identified two distinct treatment response subtypes based on biomarker alignment patterns (<xref ref-type="fig" rid="F5">Fig. 5g</xref>). Subtype 1 was especially marked by strong negative alignment of SMN biomarkers, and negative alignment of noradrenaline transporter (NAT) and vesicular acetylcholine transporter (VAChT) biomarkers. In contrast, Subtype 2 featured strong negative alignment of VIS biomarkers, milder SMN effects, and positive alignment of NAT and VAChT biomarkers.</p><p id="P33">Although the two subtypes did not differ significantly in treatment allocation (Subtype 1: 60% escitalopram; Subtype 2: 62% psilocybin; <italic>χ</italic><sup>2</sup> = 1.188, <italic>p</italic> = 0.2757), several biomarkers showed nominally significant alignment differences between drug conditions, including VIS and VAChT biomarkers, as well as correlations among the serotonin REACT maps (<xref ref-type="supplementary-material" rid="SD12">Supp. Fig. 12</xref>). While these effects did not survive FDR correction, the pattern suggests that <monospace>graphTRIP</monospace> learned both shared biomarkers, with similar predictive effect across treatments, and treatment-specific biomarkers.</p><p id="P34">Despite consistent patterns, alignment magnitudes remained low (approx. -0.05 to 0.05 on a scale from -1 to 1) (<xref ref-type="fig" rid="F5">Fig. 5g</xref>), suggesting that no single biomarker alone predicts treatment response. This highlights the need for ML approaches like <monospace>graphTRIP</monospace>, which can capture global, high-order patterns of brain organisation [<xref ref-type="bibr" rid="R45">45</xref>].</p><p id="P35">Notably, PCA of the alignment matrix revealed that the first two principal components captured 71% of the variance, and their patient loadings correlated significantly with treatment outcome (<xref ref-type="supplementary-material" rid="SD12">Supp. Fig. 13a</xref>). This indicates that, while individual biomarkers lack strong predictive power, each patient’s full GRAIL profile captures clinically meaningful variation. Furthermore, group-averaged alignment values showed a borderline significant correlation (<italic>r</italic> = 0.2440, <italic>p</italic> = 0.0520) with the outcome-predictive strength of each biomarker, as estimated by the direct correlation between outcome and brain-graph derived biomarker values (<xref ref-type="supplementary-material" rid="SD12">Supp. Fig. 13b</xref>). This confirms that GRAIL identifies meaningful biomarkers, while also capturing higher-order dependencies that go beyond simple univariate associations.</p></sec><sec id="S8"><title>Estimating individual treatment effects</title><p id="P36">Identifying the most effective treatment for a given patient relies on estimating causal treatment effects. This can be achieved by comparing outcomes between treatment groups that are statistically equivalent in all other covariates (e.g., baseline clinical and brain-graph data).</p><p id="P37">RCTs, like the one underlying our primary dataset, are designed to approximate such conditions. However, small-sample effects such as dropouts can introduce subtle biases. Indeed, we found that treatment assignment could be predicted from pre-treatment data, primarily due to lower – though non-significant – baseline QIDS scores in the psilocybin group (<xref ref-type="supplementary-material" rid="SD12">Supp. Fig. 14a</xref>). As a result, <monospace>graphTRIP</monospace> cannot reliably infer causal effects. To address this, we developed <monospace>X-graphTRIP</monospace>, which extends the <monospace>graphTRIP</monospace> architecture within the X-learner causal inference framework [<xref ref-type="bibr" rid="R34">34</xref>]. Together, these models provide complementary insights: <monospace>graphTRIP</monospace> predicts treatment outcome and identifies treatment responsiveness biomarkers, while <monospace>X-graphTRIP</monospace> estimates individual treatment effects (ITEs) and reveals treatment-specific moderators.</p><p id="P38">In the X-learner framework (<xref ref-type="fig" rid="F6">Fig. 6a</xref>), two so-called T-learners are first trained independently on patients from each treatment group. These T-learners are then used to compute pseudo-ITE labels by comparing observed outcomes with counterfactual predictions. Finally, an X-learner – <monospace>X-graphTRIP</monospace> – is trained on the full dataset to predict these ITEs. The idea is that the X-learner can leverage the entire sample to learn a smooth, generalisable ITE function from the imputed pseudo-labels. To ensure unconfoundedness, we removed pre-treatment QIDS from the input features of all models (T- and X-learners), and defined ITEs in terms of the expected difference in QIDS change from baseline under psilocybin versus escitalopram. Negative ITEs indicate that psilocybin is expected to lead to a greater reduction in QIDS compared to escitalopram, and vice versa for positive values. We confirmed that treatment assignment was not predictable from <monospace>X-graphTRIP</monospace>’s latent brain-graph representations (<xref ref-type="supplementary-material" rid="SD12">Supp. Fig. 14b</xref>), confirming that the model masks treatment-associated confounds and satisfies causal identifiability assumptions [<xref ref-type="bibr" rid="R46">46</xref>].</p><p id="P39"><monospace>X-graphTRIP</monospace> successfully learned a smooth ITE function that significantly correlated with the pseudo-labels (<italic>r</italic> = 0.38, <italic>p</italic> = 0.0132; <xref ref-type="fig" rid="F6">Fig. 6b</xref>). On average, psilocybin was predicted to yield better outcomes than escitalopram, with an estimated average treatment effect (ATE) of −1.34 <italic>±</italic> 0.39 (SEM; <xref ref-type="fig" rid="F6">Fig. 6c</xref>). However, several patients were predicted to respond better to escitalopram, emphasising the importance of personalised treatment.</p><p id="P40">To identify neural biomarkers associated with treatment effect, we applied our attention-weight and GRAIL analyses to <monospace>X-graphTRIP</monospace>. However, while the resulting interpretability patterns learned by most CV-fold models were broadly consistent, some variability remained across folds (<xref ref-type="supplementary-material" rid="SD12">Supp. Fig. 16</xref>), suggesting that the underlying signal may be weak, noisy, or distributed across many overlapping features – a common challenge in low-sample causal inference settings with imputed labels. To isolate consistently informative features, we developed a robustness analysis based on the assumption that meaningful patterns should improve model generalisation. We trained a large set of CV-fold models with varying train-test splits and focused our analyses on the performance-weighted average attention weights and gradient alignments from models with significant test performance (defined by the Spearman correlation between ITE predictions and pseudo-labels). For GRAIL, we additionally applied a conservative filtering procedure based on partial least squares (PLS) regression to identify biomarkers reliably associated with generalisation across folds and patients (see <xref ref-type="sec" rid="S14">Methods</xref>).</p><p id="P41">Models with significant generalisation performance attended most strongly to VIS regions, as well as LIM areas, particularly the orbitofrontal cortex and temporal poles (<xref ref-type="fig" rid="F6">Fig. 6d</xref>). GRAIL analysis further identified several treatment-specific moderators (<xref ref-type="fig" rid="F6">Fig. 6e</xref>). Relatively better response to psilocybin was linked to increased serotonin REACT maps in VIS regions and stronger functional coupling between 5-HT1A and 5-HT2A signalling. In contrast, relatively better response to escitalopram was associated with enhanced serotonin signalling in NAT- and VAChT-rich regions, and stronger 5-HT1A–5-HTT coupling. Please note that these relative biomarker effects should be interpreted in the context of an overall group-level advantage for psilocybin.</p></sec></sec><sec id="S9" sec-type="discussion"><title>Discussion</title><p id="P42">Predicting individual response to antidepressant treatment remains a major challenge in psychiatry, with implications for developing more effective, personalised interventions. Here, we introduced <monospace>graphTRIP</monospace>, a geometric deep learning (GDL) model that predicts post-treatment depression severity from pre-treatment neuroimaging and clinical data. Our model demonstrated strong prediction performance, generalised across brain parcellations and datasets, and provided insights into treatment responsiveness through rich interpretability analyses. Moreover, we delevoped <monospace>X-graphTRIP</monospace>, a causal inference extension of <monospace>graphTRIP</monospace>, to estimate individual treatment effects and identify treatment-specific moderators.</p><p id="P43"><monospace>X-graphTRIP</monospace> estimated an average treatment effect favouring psilocybin over escitalopram at the primary endpoint of three weeks post-treatment. This finding is consistent with previous analyses of the same dataset [<xref ref-type="bibr" rid="R35">35</xref>] and several other studies [<xref ref-type="bibr" rid="R10">10</xref>]. However, some patients were predicted to respond better to escitalopram. This underscores the importance of personalised treatment, and raises the question of what neurobiological mechanisms drive differential responsiveness to each drug.</p><sec id="S10"><title>Shared mechanisms of treatment responsiveness</title><p id="P44">Our analysis identified a number of brain-graph biomarkers that were consistently associated with treatment outcome across both treatments, possibly pointing to shared mechanisms of responsiveness. Specifically, better response was linked to reduced functional coupling within serotonin systems, and stronger coupling between these systems and sensory-motor regions. These findings were corroborated by attention weight analysis, which assigned significantly higher importance to VIS and SMN regions across both treatment arms. This pattern suggests that enhanced cross-talk between serotonin-rich cortices and serotonin-sparse sensory-motor regions may facilitate therapeutic effects, potentially by supporting broader integration of serotonin signalling.</p><p id="P45">Notably, a recent study showed that the predictive value of RSN connectivity varies across post-treatment time points [<xref ref-type="bibr" rid="R25">25</xref>]. At three weeks – the primary end-point in our dataset – VIS connectivity was the strongest predictor, followed by auditory and SMN connectivity. In contrast, DMN and FPN connectivity performed at chance level. This suggests that the relevance of sensory-motor networks may be specific to early treatment response. Future work could extend <monospace>graphTRIP</monospace> to predict long-term treatment outcomes.</p></sec><sec id="S11"><title>Treatment-specific moderators</title><p id="P46">While <monospace>graphTRIP</monospace> highlighted the general predictive role of VIS regions, <monospace>X-graphTRIP</monospace> further refined this picture by identifying serotonergic signalling in this network as a key moderator of psilocybin response. The mechanisms underlying psilocybin’s antidepressant effects remain unclear. However, one of the more robust findings is that the acute subjective experience – particularly so-called “mystical-type experiences” – is predictive of long-term clinical benefit across conditions such as depression, end-of-life anxiety, and addiction [<xref ref-type="bibr" rid="R47">47</xref>–<xref ref-type="bibr" rid="R51">51</xref>]. Although 5-HT2A receptors are most densely expressed in association cortices such as the DMN and FPN, parts of the VIS also show high 5-HT2A density and have been implicated in the vivid visual phenomena characteristic of the acute psychedelic state [<xref ref-type="bibr" rid="R52">52</xref>–<xref ref-type="bibr" rid="R54">54</xref>]. In this context, our results may suggest that stronger VIS–serotonin coupling predisposes patients to a more intense psychedelic experience, potentially amplifying its therapeutic impact.</p><p id="P47">Furthermore, <monospace>X-graphTRIP</monospace> also identified stronger correlation between R5-HT1A and R5-HT2A REACT maps as a biomarker of relatively better response to psilocybin. However, <monospace>graphTRIP</monospace> linked greater 5-HT1A–5-HT2A coupling to poorer treatment outcomes overall. Together, these results imply that the biomarker likely reflects reduced responsiveness to escitalopram, rather than enhanced responsiveness to psilocybin. A plausible explanation for this pattern is a disrupted neuromodulatory state in which inhibitory control via 5-HT1A is compromised, leading to heightened excitability and co-activation of 5-HT1A- and 5-HT2A-rich cortices. This interpretation aligns with evidence that under chronic stress, inhibitory 5-HT1A signaling may down-regulate while the sensitivity of excitatory 5-HT2A receptors increases [<xref ref-type="bibr" rid="R55">55</xref>–<xref ref-type="bibr" rid="R57">57</xref>]. Since 5-HT2A receptors are predominantly expressed by excitatory pyramidal neurons in transmodal cortices – most of which also express 5-HT1A [<xref ref-type="bibr" rid="R58">58</xref>] – this shift in the balance between 5-HT1A and 5-HT2A signalling could increase cortical excitability in response to serotonin. Notably, while the mechanisms of SSRIs like escitalopram remain incompletely understood, a leading hypothesis is that their antidepressant effects are facilitated by elevated cortical serotonin levels that suppress pyramidal cell firing via 5-HT1A-mediated inhibition [<xref ref-type="bibr" rid="R4">4</xref>, <xref ref-type="bibr" rid="R59">59</xref>]. In this context, our findings may support the idea that intact 5-HT1A-mediated inhibition is critical for SSRI efficacy.</p><p id="P48">Finally, <monospace>X-graphTRIP</monospace> identified greater coupling between serotonin systems and other neuromodulatory systems – particularly the cholinergic and noradrenergic systems – as predictors of relatively better response to escitalopram. Interestingly, in <monospace>graphTRIP</monospace> we observed a trend whereby serotonin–VAChT coupling predicted better outcomes under escitalopram, but worse outcomes under psilocybin, suggesting that this biomarker has opposing predictive effects for the two drugs.</p><p id="P49">One plausible conjecture is that greater serotonin-system coupling with VAChT- and NAT-rich regions reflects elevated cholinergic and noradrenergic tone, indicative of a more reactive stress system. Both systems are tightly linked to stress responsivity in depression. The noradrenergic system, via the locus coeruleus, directly activates the hypothalamic–pituitary–adrenal (HPA) axis – a neuroendocrine pathway frequently dysregulated in MDD [<xref ref-type="bibr" rid="R60">60</xref>]. Meanwhile, central cholinergic (ACh) tone has been associated with depressive and anxiety symptoms [<xref ref-type="bibr" rid="R61">61</xref>]. For instance, pharmacological inhibition of ACh breakdown can induce depressive-like behaviour in both animals and humans [<xref ref-type="bibr" rid="R62">62</xref>, <xref ref-type="bibr" rid="R63">63</xref>]. Conversely, VAChT knockdown mice, exhibiting reduced cholinergic tone, show attenuated depressive-like behaviour and elevated striatal serotonin levels [<xref ref-type="bibr" rid="R64">64</xref>]. Several SSRIs are also known to inhibit nicotinic acetylcholine receptors (nAChRs), and nicotinic modulators have been shown to enhance SSRI efficacy [<xref ref-type="bibr" rid="R61">61</xref>]. In this context, elevated serotonin-system coupling with NAT- and VAChT-rich regions may reflect an overactive stress-related neuromodulatory state that escitalopram can stabilise more effectively than psilocybin.</p><p id="P50">This hypothesis aligns with a theoretical model that proposes distinct stress-coping mechanisms for SSRIs and psychedelics [<xref ref-type="bibr" rid="R59">59</xref>]. According to this framework, SSRIs promote emotional blunting and stress buffering via post-synaptic 5-HT1A-mediated inhibition, whereas psychedelics foster emotional openness and psychological flexibility via 5-HT2A-mediated cortical excitation and enhanced synaptic plasticity. Individuals with heightened stress reactivity may benefit more from SSRIs, as psychedelics could be destabilising or counterproductive. Viewed through this lens, our results suggest that cholinergic and noradrenergic tone may serve as a moderator of antidepressant efficacy, influencing the extent to which patients benefit from stress-buffering versus emotionally amplifying treatment strategies.</p></sec><sec id="S12"><title>Limitations and future work</title><p id="P51">One potential source of confusion lies in the use of two separate models to predict treatment outcome (<monospace>graphTRIP</monospace>) and causal treatment effects (<monospace>X-graphTRIP</monospace>). This distinction arises from fundamental modeling limitations: since treatment assignment is partially predictable from pre-treatment data, plain <monospace>graphTRIP</monospace> violates the identifiability assumption required for causal inference [<xref ref-type="bibr" rid="R34">34</xref>]. Conceptually, outcome prediction involves learning the two main effects of treatment and brain-graph features, whereas ITE estimation requires capturing the <italic>interaction</italic> between treatment and brain-graph features – that is, treatment-specific moderators. Our results suggest that <monospace>graphTRIP</monospace> captures the main effects well: after controlling for treatment, the correlation between true and predicted outcomes was slightly reduced but remained significant, indicating that both treatment and brain-graph effects were learned. However, <monospace>graphTRIP</monospace> likely captures treatment-specific interactions only partially. Nevertheless, <monospace>graphTRIP</monospace> remains clinically valuable: it identifies robust predictors of overall treatment response, highlighting substantial shared mechanisms underlying responsiveness to both escitalopram and psilocybin. Moreover, its predictions can inform decisions about care intensity, safety considerations, and treatment escalation. Future work should explore unified causal inference frameworks, such as CFR-Net [<xref ref-type="bibr" rid="R46">46</xref>] or Dragonnet [<xref ref-type="bibr" rid="R65">65</xref>], which can – in principle – estimate both outcome and treatment effects within a single model. The <monospace>graphTRIP</monospace> architecture can be readily integrated into such frameworks, similar to how we integrated it into the X-learner framework [<xref ref-type="bibr" rid="R34">34</xref>]. While these alternative frameworks tend to be more data-hungry, they offer a promising path forward for future studies with larger datasets.</p><p id="P52">The GRAIL method also has certain constraints. First, it evaluates individual biomarkers, while treatment response likely depends on complex interactions. Second, GRAIL does not account for redundancy among correlated biomarkers; when two candidate biomarkers are highly correlated, both may show similar alignment patterns, but the method does not indicate which one is more explanatory. This limitation is particularly relevant given the substantial correlations among several normative molecular target maps used in our analysis (<xref ref-type="supplementary-material" rid="SD12">Supp. Fig. 17b</xref>). Finally, GRAIL identifies statistical relationships, not causal mechanisms. An exciting future direction involves integrating brain connectivity and molecular chemoarchitecture with generative whole-brain models – biophysically informed simulations of brain activity [<xref ref-type="bibr" rid="R66">66</xref>–<xref ref-type="bibr" rid="R71">71</xref>]. By using <monospace>graphTRIP</monospace> to predict treatment response from simulated brain dynamics and backpropagating through the whole-brain model, we could systematically screen for plausible neurophysiological mechanisms underlying treatment response.</p><p id="P53">Finally, we used normative molecular target maps derived from independent PET datasets, acquired in healthy individuals. While this is standard practice in molecular-enriched neuroimaging analyses [<xref ref-type="bibr" rid="R19">19</xref>], it is important to note that these maps were obtained from independent cohorts using distinct imaging methods. Although all data were transformed to standard space, such differences may introduce variability in resolution. Nonetheless, extensive work has demonstrated that this approach yields valid and clinically informative insights [<xref ref-type="bibr" rid="R18">18</xref>, <xref ref-type="bibr" rid="R19">19</xref>, <xref ref-type="bibr" rid="R22">22</xref>–<xref ref-type="bibr" rid="R24">24</xref>].</p></sec></sec><sec id="S13" sec-type="conclusions"><title>Conclusion</title><p id="P54">In this work, we introduced <monospace>graphTRIP</monospace>, a geometric deep learning approach for predicting antidepressant treatment outcomes, offering both high predictive accuracy and interpretability. <monospace>graphTRIP</monospace> overcomes key limitations of conventional ML approaches, generalises across brain atlases, and enables patient-specific biomarker discovery. Our analysis highlights the role of global serotonergic integration with serotonin-sparse regions of the sensory-motor networks in treatment responsiveness. Additionally, we estimated causal treatment effects and identified drug-specific response biomarkers, particularly involving serotonin-system interactions with stress-regulating neuromodulatory systems. Future work could scale our approach to larger datasets and integrate whole-brain models to move beyond biomarker-based to mechanistic explanations of treatment responsiveness. Overall, these advances mark a step toward data-driven, personalised treatment selection, bringing ML models closer to clinical translation.</p></sec><sec id="S14" sec-type="methods"><title>Methods</title><sec id="S15"><title>Datasets</title><p id="P55">We used data from two clinical trials conducted at the Imperial Clinical Research Facility and approved by relevant UK regulatory bodies. All participants provided written informed consent. The main dataset consisted of a double-blind randomised controlled trial (DB-RCT, <ext-link ext-link-type="uri" xlink:href="http://clinicaltrials.gov">clinicaltrials.gov</ext-link>: NCT03429075) comparing psilocybin and escitalopram for the treatment of major depressive disorder (MDD). An additional validation dataset was derived from an open-label trial of psilocybin treatment (<ext-link ext-link-type="uri" xlink:href="http://gtr.ukri.org">gtr.ukri.org</ext-link>: MR/J00460X/1). Detailed trial protocols and clinical outcomes have been previously published [<xref ref-type="bibr" rid="R72">72</xref>].</p></sec><sec id="S16" sec-type="subjects"><title>Participants</title><p id="P56">Eligible participants in both trials were diagnosed with unipolar MDD (Hamilton Depression Rating Scale score <italic>≥</italic> 16). The DB-RCT included 59 patients, randomly assigned to either psilocybin (n = 30) or escitalopram (n = 29) treatment. The final imaging sample comprised 22 patients in the psilocybin arm (mean age = 44.5 <italic>±</italic> 11.0 years; 8 female) and 20 in the escitalopram arm (mean age = 40.9 <italic>±</italic> 10.1 years; 6 female). The open-label trial included 19 patients with treatment-resistant depression (TRD), defined as having failed to respond to multiple courses of antidepressant treatment (mean = 4.6 <italic>±</italic> 2.6 past medications). Out of the initial sample, 16 patients were retained for analysis after excluding three due to excessive head motion (mean age = 42.75 <italic>±</italic> 10.15 years; 4 female). Exclusion criteria for both trials included a history of psychosis, significant medical conditions, serious suicide attempts, pregnancy, and MRI contraindications. The DB-RCT additionally excluded patients with contraindications for SSRIs or prior escitalopram use.</p></sec><sec id="S17"><title>Treatments</title><p id="P57">In both trials, all participants underwent a pretreatment baseline session, involving clinical assessment and resting-state fMRI. The psilocybin arm received a 25 mg dose on Day 1 followed by a second identical dose3 weeks later, along with daily placebo capsules for six weeks. The escitalopram arm received a negligible 1 mg psilocybin dose on Day 1, followed by 10 mg of escitalopram daily for the first 3 weeks, increased to 20 mg daily thereafter. In the open-label trial, patients received two psilocybin doses (10 mg and 25 mg, one week apart).</p></sec><sec id="S18"><title>Clinical outcome measures</title><p id="P58">Depression severity was assessed using both the Quick Inventory of Depressive Symptomatology (QIDS) and the Beck Depression Inventory (BDI-1A) in both trials, at baseline and post-treatment. In the DB-RCT, QIDS was the primary outcome measure, with post-treatment assessments conducted 3 weeks after dosing day 2. BDI served as a secondary outcome measure in this trial. Thus, we used QIDS as the default prediction target of our model. The open-label trial used BDI as the primary outcome measure, with post-treatment assessments occurring 1 week after dosing day 2. In the open-label dataset, additional pre-treatment scores from the HAMD and LOT-R scales were available, which we included as input features when training models (simple MLP or <monospace>graphTRIP</monospace>) from scratch without pretraining.</p></sec><sec id="S19"><title>fMRI data acquisition and preprocessing</title><p id="P59">Resting-state fMRI data were acquired using a 3T Siemens Tim Trio scanner with T2*-weighted echo-planar imaging. In the DB-RCT, scans included 480 volumes in approximately 10 min (TR = 1,250 ms; TE = 30 ms; 44 axial slices; spatial resolution = 3 mm isotropic; flip angle = 70 degrees; bandwidth = 2,232 Hz per pixel; and GRAPPA acceleration = 2). In the open-label trial, scans included 280 volumes in approximately 8 min (TR = 2,000 ms; TE = 31 ms; 36 axial slices; flip angle = 80 degrees; bandwidth = 2,298 Hz per pixel; and GRAPPA acceleration = 2). We used the Schaefer et al. [<xref ref-type="bibr" rid="R36">36</xref>] brain atlas with 100 parcels as the default atlas, and also conducted analyses using the Schaefer atlas with 200 parcels and the Automated Anatomical Labeling (AAL) atlas [<xref ref-type="bibr" rid="R37">37</xref>]. Preprocessing was performed using a custom pipeline integrating FSL, AFNI, Freesurfer, and ANTs, following standard procedures: motion correction, spatial smoothing, band-pass filtering (0.01–0.08 Hz), and nuisance regression. Volumes with &gt; 20% framewise displacement &gt; 0.5 mm were excluded. Full details of the preprocessing steps can be found in [<xref ref-type="bibr" rid="R72">72</xref>].</p></sec><sec id="S20"><title>Functional connectivity</title><p id="P60">BOLD time series were parcellated and z-scored using the Schaefer atlases with 100 or 200 parcels [<xref ref-type="bibr" rid="R36">36</xref>], and the AAL atlas [<xref ref-type="bibr" rid="R37">37</xref>]. Functional connectivity (FC) was then computed as the Pearson correlation coefficient between the z-scored time series of each pair of brain regions, resulting in an <italic>N × N</italic> FC matrix for each participant and parcellation. FC matrices were thresholded to retain only values with |<italic>r</italic>| &gt; 0.5, which served as edge attributes in the main model of our study. This threshold was chosen to yield network densities comparable to typical structural connectomes (mean density <italic>ρ</italic> = 0.16, SD = 0.05). The atlas-bound model, in contrast, used the non-thresholded FC matrices as input.</p></sec><sec id="S21"><title>Molecular target maps</title><p id="P61">Positron emission tomography (PET) maps of regional neuroreceptor and transporter densities were obtained from publicly available datasets. Serotonin receptor (5-HT1A, 5-HT2A) and serotonin transporter (5-HTT) maps were downloaded from Beliveau et al. [<xref ref-type="bibr" rid="R42">42</xref>] (<ext-link ext-link-type="uri" xlink:href="https://nru.dk/index.php/allcategories/category/90-nru-serotonin-atlas-and-clustering">https://nru.dk/index.php/allcategories/category/90-nru-serotonin-atlas-and-clustering</ext-link>). The maps were resampled to 2 mm MNI152 space, cerebellar voxels were excluded, and density values were normalised to a range of 0–1.</p><p id="P62">Additionally, we used PET maps for seven other molecular targets to explain the regional attention weight patterns and compute interpretable biomarkers in the gradient alignment analysis. Specifically, we included density maps for serotonin receptors (5-HT4, 5-HT1B), dopamine receptors (D1, D2) and transporter (DAT), noradrenaline transporter (NAT), and vesicular acetylcholine transporter (VAChT). These data were obtained from Hansen et al. [<xref ref-type="bibr" rid="R20">20</xref>].</p></sec><sec id="S22"><title>REACT maps</title><p id="P63">The REACT maps, which served as the node attributes of our main model, were computed for each participant using the voxelwise PET maps of 5-HT1A, 5-HT2A, and 5-HTT densities from Beliveau et al. [<xref ref-type="bibr" rid="R42">42</xref>]. The analysis was performed with the <monospace>react-fmri</monospace> Python toolbox [<xref ref-type="bibr" rid="R18">18</xref>], following the protocol described in Lawn et al. [<xref ref-type="bibr" rid="R19">19</xref>].</p><p id="P64">Specifically, we used the <monospace>react masks</monospace> command to generate masks that ensured that all voxels included in the subsequent analysis had valid PET data for all molecular targets, BOLD data for all participants, and were located within grey matter. Subsequently, we computed the REACT maps with the <monospace>react</monospace> command, which involves two sequential linear regressions for each voxel and molecular target. First, a voxel-level spatial regression of each molecular density map (5-HT1A, 5-HT2A, and 5-HTT) against the BOLD values at each time point yields a time series capturing the dominant fluctuations within each molecular system over time. In the second step, these molecular time series are regressed against the BOLD time series of each voxel, producing estimates of the coupling between each voxel’s activity and the broader activity associated with each molecular system. The resulting voxelwise REACT time series were parcellated to obtain one time series for each brain region, participant, and atlas.</p></sec><sec id="S23"><title>Model and training configurations</title><p id="P65">Full hyperparameter configurations, including architectural details and training parameters are provided in <xref ref-type="supplementary-material" rid="SD12">Supplementary Tables II-VII</xref>. These cover all models evaluated in this study. Addtionally, the complete code-base and all configuration files are available at: <ext-link ext-link-type="uri" xlink:href="https://github.com/Imperial-MIND-lab/graphTRIP">https://github.com/Imperial-MIND-lab/graphTRIP</ext-link>.</p></sec><sec id="S24"><title><monospace>graphTRIP</monospace> model</title><p id="P66">The main model in our study, called <monospace>graphTRIP</monospace> model, consists of a variational graph autoencoder (VGAE) with graph attention layers and a downstream multi-layer perceptron (MLP). The VGAE is trained to learn informative latent node representations by reconstructing the original input graph, while the MLP predicts post-treatment depression severity based on these latent representations and additional clinical data.</p></sec><sec id="S25"><title>VGAE inputs</title><p id="P67">The input to the VGAE is a brain graph, where nodes represent brain regions defined by a brain atlas and edges represent FC between regions. Each node has a 6-dimensional feature vector: three elements encode the REACT values for serotonin receptors 5-HT1A, 5-HT2A, and the serotonin transporter 5-HTT, and the remaining three encode the 3D spatial coordinates of the brain region in MNI space. Edges exist between regions if the absolute FC value exceeds 0.5, and edge attributes are the original (non-thresholded) FC values. Self-connections were set to 1.</p></sec><sec id="S26"><title>VGAE architecture</title><p id="P68">The VGAE consists of an encoder, a decoder, and a readout layer. The encoder consists of six GATv2Conv layers [<xref ref-type="bibr" rid="R73">73</xref>] with skip connections between consecutive layers of consistent width, followed by layer normalisation and dropout after each hidden layer. A final dense linear layer outputs two vectors per node: the latent means <italic>µ</italic> and log variances log <italic>σ</italic><sup>2</sup>. Node features are updated iteratively in each GATv2Conv layer as <disp-formula id="FD1"><label>(1)</label><mml:math id="M1"><mml:mrow><mml:msubsup><mml:mi>x</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true"><mml:mo>∪</mml:mo></mml:mstyle><mml:mo>{</mml:mo><mml:mi>i</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:munder><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>W</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P69">Here, 𝒩 (<italic>i</italic>) denotes the set of neighbors of node <italic>i, α</italic><sub><italic>i</italic>,<italic>j</italic></sub> are the attention coefficients, and <italic>W</italic><sub><italic>t</italic></sub> is a learnable weight matrix. The term <italic>x</italic><sub><italic>i</italic></sub>+ implements the skip connection, which is used in all layers with consistent input and output dimensions – specifically, between all layers except the transition from layer 0 to layer 1. The attention coefficients <italic>α</italic><sub><italic>i</italic>,<italic>j</italic></sub> – not to be confused with the attention weights of the VGAE readout – are computed as <disp-formula id="FD2"><label>(2)</label><mml:math id="M2"><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>a</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>φ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mstyle displaystyle="true"><mml:mtext>Σ</mml:mtext></mml:mstyle><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true"><mml:mo>∪</mml:mo></mml:mstyle><mml:mo>{</mml:mo><mml:mi>i</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:msub><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>a</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mi>φ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>φ</italic> is the LeakyReLU activation function, <italic>W</italic><sub><italic>s</italic></sub>, <italic>W</italic><sub><italic>t</italic></sub>, and <italic>W</italic><sub><italic>e</italic></sub> are learnable weight matrices for source nodes, target nodes, and edge attributes, respectively, and <italic>a</italic><sup><italic>T</italic></sup> is a learnable vector determining the relevance of features for attention.</p></sec><sec id="S27"><title>Latent space sampling</title><p id="P70">Latent node representations <italic>z</italic><sub><italic>i</italic></sub> are sampled as <disp-formula id="FD3"><label>(3)</label><mml:math id="M3"><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>⊙</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P71">where <italic>ϵ ~ 𝒩</italic> (0, <italic>I</italic>) and <italic>σ</italic><sub><italic>i</italic></sub> = exp(0.5 <italic>·</italic> log <italic>σ</italic><sup>2</sup>). These samples serve as input to the decoders and the readout.</p></sec><sec id="S28"><title>Decoders</title><p id="P72">The VGAE has three decoders:</p><list list-type="bullet" id="L1"><list-item><p id="P73"><bold>Node decoder:</bold> A 3-layer MLP with LeakyReLU activation and dropout, and a linear output layer to reconstruct node features from <italic>z</italic><sub><italic>i</italic></sub>. Note: only REACT node features were reconstructed, as the 3D spatial coordinates of brain regions are normative and do not contain patient-specific information.</p></list-item><list-item><p id="P74"><bold>Edge index decoder:</bold> A 3-layer MLP with LeakyReLU activation and dropout, and a sigmoid output to predict the probability of edges between nodes.</p></list-item><list-item><p id="P75"><bold>Edge attribute decoder:</bold> A 3-layer MLP with LeakyReLU activation and dropout, and a tanh output to predict FC values in the range [−1, 1].</p></list-item></list><p id="P76">The reconstruction of the thresholded FC matrix is obtained by elementwise multiplication of the edge-index and edge-attribute decoder outputs.</p></sec><sec id="S29"><title>Readout layer</title><p id="P77">The VGAE includes an attention-based mean pooling layer to generate a single graph representation vector <italic>z</italic> from the latent node vectors <italic>z</italic><sub><italic>i</italic></sub>, <disp-formula id="FD4"><label>(4)</label><mml:math id="M4"><mml:mrow><mml:mi>z</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle></mml:mrow><mml:mi>i</mml:mi></mml:munder><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>N</italic> is the number of nodes, and <italic>w</italic><sub><italic>i</italic></sub> are attention weights computed as <disp-formula id="FD5"><label>(5)</label><mml:math id="M5"><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mtext>Φ</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‖</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD6"><label>(6)</label><mml:math id="M6"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>s</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:munder><mml:mrow><mml:mtext>max</mml:mtext><mml:mspace width="0.2em"/></mml:mrow><mml:mi>j</mml:mi></mml:munder><mml:msub><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD7"><label>(7)</label><mml:math id="M7"><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>s</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msubsup><mml:mstyle displaystyle="true"><mml:mtext>Σ</mml:mtext></mml:mstyle><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mtext>exp</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>s</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P78">Here, <italic>d</italic> is a scalar encoding the drug condition (1 for psilocybin, -1 for escitalopram) and Φ is a 1-layer MLP with ReLU activation. The subtraction of the maximum score in <xref ref-type="disp-formula" rid="FD6">Equation (6)</xref> implements the log-sum-exp trick, a standard technique to improve the numerical stability of the softmax computation by preventing potential overflow in the exponentials.</p></sec><sec id="S30"><title>MLP for prediction</title><p id="P79">The input to the downstream MLP consists of a concatenation of the graph representation vector <italic>z</italic> and clinical data: baseline BDI and QIDS scores (pre-treatment depression scores), a binary indicator of prior SSRI use (0 for no, 1 for yes), and the drug condition <italic>d</italic> (-1 for escitalopram, 1 for psilocybin). The MLP has four layers with LeakyReLU activation and dropout in the hidden layers, and a linear output layer to predict post-treatment depression scores (QIDS).</p></sec><sec id="S31"><title>Atlas-bound model</title><p id="P80">In contrast to the <monospace>graphTRIP</monospace> model, the atlas-bound model employs a variational autoencoder (VAE) and learns a latent representation of graphs rather than nodes. This model processes the full un-thresholded functional connectivity (FC) matrix, making it dependent on a specific brain atlas, as the dimension of the FC matrix determines the size of the input feature vectors.</p><sec id="S32"><title>VAE inputs</title><p id="P81">Each node’s feature vector consists of all FC edges connected to that node, along with an integer encoding of the brain region’s identity. This model does not use REACT features. The FC matrix is not thresholded, allowing the model to leverage the full connectivity information.</p></sec><sec id="S33"><title>VAE architecture</title><p id="P82">The encoder consists of a 4-layer MLP with LeakyReLU activation and dropout, shared across nodes, which transforms each node’s feature vector into a lower-dimensional node embedding vector. The node embeddings for all nodes in a graph are concatenated to form a single graph-level feature vector. This vector is then passed through a dense linear layer that outputs two vectors: the latent means <italic>µ</italic> and log variances log <italic>σ</italic><sup>2</sup>. Latent graph representation vectors <italic>z</italic> are sampled from the latent distribution analogously to <xref ref-type="disp-formula" rid="FD3">Eq. (3)</xref>.</p></sec><sec id="S34"><title>Decoder</title><p id="P83">The decoder is a 3-layer MLP with LeakyReLU activation and dropout, designed to reconstruct the FC matrix. The first hidden layer increases the dimensionality stepwise from the latent dimension to match the number of upper triangular edges in the FC matrix. The output layer uses a tanh activation function, ensuring that predicted FC values lie within the range [−1, 1].</p></sec></sec><sec id="S35"><title>Hybrid model</title><p id="P84">To construct the hybrid model, we first trained the <monospace>graphTRIP</monospace> and atlas-bound models separately on the primary dataset. We then froze the weights of their respective representation learning modules (VGAE and VAE) and trained a new MLP on the concatenated latent readouts from both models, combined with the pre-treatment clinical data and drug condition.</p></sec><sec id="S36"><title><monospace>X-graphTRIP</monospace> model</title><p id="P85">To estimate individual treatment effects (ITEs), we extended the <monospace>graphTRIP</monospace> architecture within a causal inference framework based on the X-learner [<xref ref-type="bibr" rid="R34">34</xref>]. The X-learner is a two-step approach: first, counterfactual outcomes are estimated using separate models trained on each treatment group (T-learners); second, pseudo-ITE labels are computed from these counterfactuals and used to train a new model (X-learner) that predicts ITEs from pre-treatment covariates (i.e., clinical and fMRI data).</p><sec id="S37"><title>T-learners</title><p id="P86">We trained two T-learners, each using the <monospace>graphTRIP</monospace> architecture with minor modifications: One model was trained exclusively on psilocybin-treated patients, the other on escitalopram-treated patients. To avoid encoding treatment information, the drug condition was excluded from the MLP input, and the VGAE readout was no longer conditioned on treatment. Instead, the readout employed a simplified attention-based mean pooling, in which attention weights were computed from latent node vectors using a linear scoring function (i.e., Φ in <xref ref-type="disp-formula" rid="FD7">Eq. 7</xref> was replaced by a single linear layer). Additionally, we also excluded pre-treatment QIDS from the MLP inputs due to its predictive association with treatment assignment. To account for this omission, the T-learners were trained to predict the change in QIDS from pre- to post-treatment instead of post-treatment QIDS.</p><p id="P87">Each T-learner was trained on all patients from its respective treatment group and evaluated on the patients from the other treatment group. We selected T-learners that achieved the highest correlation between observed outcomes and predicted counterfactuals during evaluation (<xref ref-type="supplementary-material" rid="SD12">Supp. Fig. 15</xref>). This selection was motivated by the expectation of substantial shared variance across treatment conditions, as suggested by prior results with the main <monospace>graphTRIP</monospace> model.</p></sec><sec id="S38"><title>Computing pseudo-ITE labels</title><p id="P88">From the trained T-learners, we estimated ITEs for individual patients <italic>i</italic> by combining observed outcomes with counterfactual predictions as <disp-formula id="FD8"><label>(8)</label><mml:math id="M8"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>D</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:mtext>Δ</mml:mtext><mml:msubsup><mml:mi>Y</mml:mi><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msubsup><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mspace width="0.2em"/><mml:msubsup><mml:mover accent="true"><mml:mi>D</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mn>0</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mtext>Δ</mml:mtext><mml:msubsup><mml:mi>Y</mml:mi><mml:mi>i</mml:mi><mml:mn>0</mml:mn></mml:msubsup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P89">Here, <inline-formula><mml:math id="M9"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>D</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> is the estimated treatment effect for psilocybin-treated patients, and <inline-formula><mml:math id="M10"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>D</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mn>0</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> for escitalopramtreated patients. <inline-formula><mml:math id="M11"><mml:mrow><mml:mtext>Δ</mml:mtext><mml:msubsup><mml:mi>Y</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> denotes the observed QIDS change under treatment <italic>t</italic>. Conversely, <inline-formula><mml:math id="M12"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> denotes the counterfactual outcome with treatment <italic>t ≠t</italic><sup><italic>′</italic></sup>. These counterfactuals are generated with the T-learner that was trained on patients who actually received treatment <italic>t</italic><sup><italic>′</italic></sup>. Finally, <inline-formula><mml:math id="M13"><mml:mrow><mml:msubsup><mml:mi>X</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi></mml:msubsup></mml:mrow></mml:math></inline-formula> are the pre-treatment covariates.</p></sec><sec id="S39"><title>X-learner</title><p id="P90">Finally, we trained a new <monospace>graphTRIP</monospace> model, called <monospace>X-graphTRIP</monospace>, on patients from both treatment conditions to predict the pseudo-ITE labels from their pre-treatment covariates. The goal of the X-learner is to smooth the noisy pseudo-labels into a robust and generalisable estimate of the ITE function.</p></sec></sec><sec id="S40"><title>Treatment classifiers</title><p id="P91">To assess whether treatment assignment was predictable from pre-treatment data – which would indicate a violation of the unconfoundedness assumption necessary for causal inference [<xref ref-type="bibr" rid="R34">34</xref>, <xref ref-type="bibr" rid="R65">65</xref>] – we trained classifiers to distinguish between psilocybin- and escitalopram-treated patients. First, we trained a <monospace>graphTRIP</monospace>-type VGAE on the full dataset using only pre-treatment clinical and fMRI data. The readout was not conditioned on treatment, and the downstream MLP was replaced with a logistic regression head (using the same architecture as the <monospace>graphTRIP</monospace> MLP, but with a sigmoid output). Second, to test whether the latent representations learned by <monospace>X-graphTRIP</monospace> encoded treatment information, we trained a new logistic regression head on the pre-trained, frozen VGAE outputs of <monospace>X-graphTRIP</monospace>.</p></sec><sec id="S41"><title>Model training</title><p id="P92">All models were implemented in PyTorch and trained using gradient descent with the ADAM optimizer and a learning rate of 0.001. The VGAE (or VAE, in the case of the atlas-bound model) and the downstream MLP were trained jointly to optimise both reconstruction accuracy and QIDS prediction accuracy. The loss function was a weighted combination of the VGAE/VAE loss and the MLP loss, <disp-formula id="FD9"><label>(9)</label><mml:math id="M14"><mml:mrow><mml:mi>ℒ</mml:mi><mml:mo>=</mml:mo><mml:mi>α</mml:mi><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>VGAE</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>α</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>MLP</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>α</italic> is a weighting factor, usually set to 0.5.</p><p id="P93">The loss for the VGAE consists of a reconstruction loss, a Kullback-Leibler (KL) divergence loss, and an L2 regularisation term, <disp-formula id="FD10"><label>(10)</label><mml:math id="M15"><mml:mrow><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>VGAE</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>recon </mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>KL</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>reg </mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula> <disp-formula id="FD11"><label>(11)</label><mml:math id="M16"><mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mo>‖</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:msubsup><mml:mo>‖</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>+</mml:mo></mml:mrow></mml:mstyle><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∈</mml:mo><mml:mi>ℰ</mml:mi></mml:mrow></mml:munder><mml:mo>∥</mml:mo><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>e</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mo>∥</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></disp-formula> <disp-formula id="FD12"><label>(12)</label><mml:math id="M17"><mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi mathvariant="double-struck">E</mml:mi><mml:mrow><mml:mi>q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:mo stretchy="false">[</mml:mo><mml:mtext>KL</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mi>q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo>∣</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>‖</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD13"><label>(13)</label><mml:math id="M18"><mml:mrow><mml:mo>+</mml:mo><mml:mi>λ</mml:mi><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mtext>VGAE</mml:mtext></mml:mrow></mml:msub><mml:msubsup><mml:mo>∥</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>x</italic><sub><italic>i</italic></sub> and <inline-formula><mml:math id="M19"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> are the input and reconstructed node features, respectively, <italic>e</italic><sub><italic>ij</italic></sub> and <italic>ê</italic><sub><italic>ij</italic></sub> are the input and reconstructed edge attributes (FC values), <italic>N</italic> is the number of nodes, and <italic>ε</italic> is the set of unique (i.e., upper triangular) edges. The KL divergence term minimises the difference between the learned latent distribution <italic>𝒩</italic> (<italic>µ, σ</italic><sup>2</sup>) and the prior (0, <italic>I</italic>). The regularisation term <inline-formula><mml:math id="M20"><mml:mrow><mml:mi>λ</mml:mi><mml:mo>∥</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mtext>VGAE </mml:mtext></mml:mrow></mml:msub><mml:msubsup><mml:mo>∥</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> prevents overfitting.</p><p id="P94">The MLP loss combines the prediction error with an L2 regularisation term, <disp-formula id="FD14"><label>(14)</label><mml:math id="M21"><mml:mrow><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>MLP</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>pred</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>reg</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula> <disp-formula id="FD15"><label>(15)</label><mml:math id="M22"><mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:mo>∥</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:msubsup><mml:mo>∥</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mi>λ</mml:mi><mml:mo>∥</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mtext>MLP</mml:mtext></mml:mrow></mml:msub><mml:msubsup><mml:mo>∥</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula> where <italic>y</italic><sub><italic>i</italic></sub> and <italic>ŷ</italic><sub><italic>i</italic></sub> are the true and predicted QIDS scores for the <italic>i</italic>-th patient, respectively, <italic>n</italic> is the batch size, and <inline-formula><mml:math id="M23"><mml:mrow><mml:mi>λ</mml:mi><mml:mo>∥</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mtext>MLP</mml:mtext></mml:mrow></mml:msub><mml:msubsup><mml:mo>∥</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> is the L2 regularisation term for the MLP weights.</p><p id="P95">To improve robustness we augmented our data during training by sampling multiple latent vectors per patient and computing a loss for each sample. All models were trained for a fixed number of epochs and using k-fold cross-validation (CV). Unless stated otherwise, predictions and reconstructions for each patient were generated using the CV-fold model in which that patient was part of the test set – that is, the model had not seen the patient during training. Full training configurations for each model are provided in the supplementary tables.</p></sec><sec id="S42"><title>Fine-tuning</title><p id="P96">To transfer the <monospace>graphTRIP</monospace> model to the validation dataset (<italic>n</italic> = 16), we first pre-trained the model on the main dataset using only clinical variables that were available in both datasets (baseline QIDS and BDI scores, and drug condition). After pre-training, the weights of the VGAE were frozen, and only the downstream MLP was fine-tuned on the validation dataset for 100 epochs.</p><p id="P97">The validation dataset differed from the main dataset in several aspects. For instance, it included patients with TRD rather than MDD, and the prediction target was the QIDS score one week post-treatment instead of three weeks. Given these differences, perfect transfer was not expected. However, we reasoned that a positive correlation between the pre-trained model’s predictions and the true labels would indicate successful transfer.</p><p id="P98">Following this rationale, the total loss was defined as the combination of 1) mean squared error loss with <italic>L</italic><sub>2</sub> regularisation, and 2) a correlation-based loss, <disp-formula id="FD16"><label>(16)</label><mml:math id="M24"><mml:mrow><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>MSE</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mi>λ</mml:mi><mml:mo>‖</mml:mo><mml:mi>W</mml:mi><mml:msup><mml:mo>‖</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula> <disp-formula id="FD17"><label>(17)</label><mml:math id="M25"><mml:mrow><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>corr</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mstyle displaystyle="true"><mml:mtext>Σ</mml:mtext></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="true">¯</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msqrt><mml:mrow><mml:msubsup><mml:mstyle displaystyle="true"><mml:mtext>Σ</mml:mtext></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:msubsup><mml:mstyle displaystyle="true"><mml:mtext>Σ</mml:mtext></mml:mstyle><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="true">¯</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>n</italic> is the batch size, <italic>y</italic><sub><italic>i</italic></sub> and <italic>ŷ</italic><sub><italic>i</italic></sub> are the true and predicted post-treatment QIDS scores, <inline-formula><mml:math id="M26"><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo stretchy="true">¯</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M27"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mrow><mml:mo stretchy="true">¯</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> are their respective means, <italic>W</italic> are the MLP weights, and <italic>λ</italic> is the regularisation coefficient.</p><p id="P99">To balance the influence of both terms during optimisation, we normalised each loss component by its exponential running average. At training step <italic>t</italic>, the running averages <inline-formula><mml:math id="M28"><mml:mrow><mml:msubsup><mml:mi mathvariant="script">A</mml:mi><mml:mrow><mml:mtext>MSE</mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M29"><mml:mrow><mml:msubsup><mml:mi mathvariant="script">A</mml:mi><mml:mrow><mml:mtext>corr </mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> were updated as <disp-formula id="FD18"><label>(18)</label><mml:math id="M30"><mml:mrow><mml:msubsup><mml:mi mathvariant="script">A</mml:mi><mml:mrow><mml:mtext>MSE</mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>β</mml:mi><mml:msubsup><mml:mi mathvariant="script">A</mml:mi><mml:mrow><mml:mtext>MSE</mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>β</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>MSE</mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD19"><label>(19)</label><mml:math id="M31"><mml:mrow><mml:msubsup><mml:mi mathvariant="script">A</mml:mi><mml:mrow><mml:mtext>corr</mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>β</mml:mi><mml:msubsup><mml:mi mathvariant="script">A</mml:mi><mml:mrow><mml:mtext>corr</mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>β</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>corr</mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>β</italic> = 0.9 is the leak rate. The normalised loss used for optimisation was <disp-formula id="FD20"><label>(20)</label><mml:math id="M32"><mml:mrow><mml:msubsup><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>MLP</mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>ρ</mml:mi><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>corr</mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:msubsup><mml:mi mathvariant="script">A</mml:mi><mml:mrow><mml:mtext>corr</mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>ℒ</mml:mi><mml:mrow><mml:mtext>MSE</mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:msubsup><mml:mi mathvariant="script">A</mml:mi><mml:mrow><mml:mtext>MSE</mml:mtext></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>ρ</italic> was set to 0.4. This dynamic normalisation ensured stable training despite the different scales of the correlation and MSE components.</p><p id="P100">The same learning rate as in pre-training (lr = 0.001) was used. Data augmentation was implemented by sampling three latent vectors per patient for each batch and summing the loss across samples.</p></sec><sec id="S43"><title>Gradient Alignment for Interpreting Latent-variable models</title><p id="P101">The GRAIL method was developed to estimate the association between specific biomarkers and treatment response. Positive alignment indicates that higher values of a biomarker are associated with higher predicted post-treatment depression scores (i.e., lower treatment responsiveness), while negative alignment suggests the opposite. An alignment of zero indicates no association between the biomarker and treatment responsiveness.</p><p id="P102">This method is enabled by the two-part architecture of the <monospace>graphTRIP</monospace> model, which includes a VGAE for reconstruction and an MLP for regression. The VGAE encoder maps input brain graphs to latent representations <italic>z</italic>, which serve as inputs to 1) the VGAE readout and the MLP (predicting post-treatment QIDS scores, <italic>ŷ</italic>), and 2) the VGAE decoder (reconstructing brain graphs). Biomarkers of interest, such as the mean FC within a specific RSN, are computed from the reconstructed brain graphs. The only requirement for a biomarker to be tested is that it can be computed in a differentiable manner from the reconstructed graph.</p><p id="P103">By deriving both <italic>ŷ</italic> and a biomarker <italic>b</italic> as differentiable functions of <italic>z</italic>, we can compute the gradients ∇ <sub><italic>z</italic></sub><italic>ŷ</italic> and ∇ <sub><italic>z</italic></sub><italic>b</italic>. These gradients indicate the directions in the latent space that most strongly increase <italic>ŷ</italic> and <italic>b</italic>, respectively. If the gradients point in similar directions, it implies that increasing the biomarker value would also increase the predicted QIDS score, indicating positive alignment. Conversely, opposite directions imply negative alignment.</p><p id="P104">To quantify alignment, we computed the cosine similarity between the normalised gradient vectors: <disp-formula id="FD21"><label>(21)</label><mml:math id="M33"><mml:mrow><mml:mtext>Alignment</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mo>∇</mml:mo><mml:mi>z</mml:mi></mml:msub><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>⋅</mml:mo><mml:msub><mml:mo>∇</mml:mo><mml:mi>z</mml:mi></mml:msub><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mo>∥</mml:mo><mml:msub><mml:mo>∇</mml:mo><mml:mi>z</mml:mi></mml:msub><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>∥</mml:mo><mml:mo>∥</mml:mo><mml:msub><mml:mo>∇</mml:mo><mml:mi>z</mml:mi></mml:msub><mml:mi>b</mml:mi><mml:mo>∥</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P105">The alignment score ranges from − 1 (maximum negative alignment) to 1 (maximum positive alignment), with 0 indicating no alignment.</p><p id="P106">We computed the gradient alignment for a number of biomarkers as follows. For each patient, we sampled 100 latent vectors from a Gaussian distribution with a mean equal to the latent mean vector of the patient’s original brain graph and a standard deviation of 2. For each latent sample, we then:</p><list list-type="order" id="L2"><list-item><p id="P107">Computed the predicted QIDS score <italic>ŷ</italic> and derived the gradient ∇<sub><italic>z</italic></sub><italic>ŷ</italic>.</p></list-item><list-item><p id="P108">Reconstructed the brain graph using the VGAE decoder and computed the biomarkers of interest.</p></list-item><list-item><p id="P109">Derived the gradient ∇<sub><italic>z</italic></sub><italic>b</italic> for each biomarker <italic>b</italic>.</p></list-item><list-item><p id="P110">Calculated the alignment score as the cosine similarity between ∇<sub><italic>z</italic></sub><italic>ŷ</italic> and ∇<sub><italic>z</italic></sub><italic>b</italic>.</p></list-item></list><p id="P111">This approach enabled us to systematically assess the alignment of a wide range of biomarkers, providing an interpretable link between model predictions and biologically meaningful factors.</p></sec><sec id="S44"><title>Permutation importance analysis</title><p id="P112">To quantify the contribution of each input feature to the treatment outcome predictions, we conducted permutation importance analysis. Individual features, including pre-treatment depression scores, prior SSRI use, treatment condition, and the latent brain-graph representation, were shuffled independently across patients in the test set, using 50 random permutations per feature. All other features were held constant. Feature importance was defined as the difference between the model’s mean absolute error (MAE) on the permuted input and the MAE on the original data. Larger increases in MAE indicate greater predictive importance. For the latent brain representation, the entire vector <bold><italic>z</italic></bold> was permuted as a unit.</p></sec><sec id="S45"><title>PLS-based Robustness Analysis</title><p id="P113">To identify robust biomarkers, we developed a new method based on partial least squares (PLS) regression. This method identifies gradient alignment patterns that correlate with model generalisation (test performance) across cross-validation (CV) folds, building on the idea that meaningful biomarkers improve test performance while spurious ones degrade it.</p><p id="P114">First, to enhance statistical power, we trained a larger number of models with overlapping test folds. Specifically, test-fold assignments were circularly shifted by one index <italic>N</italic> = 41 times until the original assignments were recovered. For <monospace>X-graphTRIP</monospace>, trained with 7-fold CV, this yielded 41 × 7 = 287 models. Each model’s test performance was quantified as the Spearman correlation (<italic>ρ</italic>) between predicted and true labels on its respective test fold. Models with <italic>ρ ≤</italic> 0.3 were excluded to reduce noise.</p><p id="P115">For each model and patient, we computed the gradient alignments for all candidate biomarkers, resulting in a matrix per patient (rows: CV models; columns: candidate biomarkers). We then performed a PLS regression</p><p id="P116">for each patient to extract the direction (first PLS component) in biomarker space that most strongly correlated with model performance across folds. To enable group-level interpretation, we aligned the sign of each patient’s PLS component (multiplying by − 1 if the Pearson correlation between component scores and model performance was negative) and stacked the aligned components across patients.</p><p id="P117">Finally, due to the signed nature of gradient alignment values, additional filtering was required to resolve ambiguity where a positive PLS weight could reflect either a beneficial or detrimental alignment. To identify robust, performance-enhancing biomarkers, we implemented a conservative three-step filtering procedure:</p><list list-type="order" id="L3"><list-item><p id="P118"><bold>Consistency of Influence:</bold> We performed a one-sample <italic>t</italic>-test across patients on the horizontally stacked PLS components for each biomarker. Biomarkers with FDR-corrected <italic>p</italic> &lt; 0.05 were retained, indicating a consistent association between their PLS-component weights and generalisation performance.</p></list-item><list-item><p id="P119"><bold>Directionality of Benefit:</bold> For each biomarker, we compared the sign of its average PLS weight with the sign of its weighted mean gradient alignment (computed by averaging CV-fold alignment vectors, weighted by each model’s test performance). Only biomarkers with matching signs were retained, ensuring they positively contributed to generalisation.</p></list-item><list-item><p id="P120"><bold>Necessity for Performance:</bold> We performed a one-sample <italic>t</italic>-test across patients on the weighted mean gradient alignment values for each biomarker. Biomarkers were retained if their alignment values were consistently non-zero (FDR-corrected <italic>p</italic> &lt; 0.05), indicating they were reliably learned by generalising models and were necessary for strong predictive performance.</p></list-item></list></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary Figure 1</label><media xlink:href="EMS207077-supplement-Supplementary_Figure_1.jpg" mimetype="image" mime-subtype="jpeg" id="d77aAcFbB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD2"><label>Supplementary Figure 2</label><media xlink:href="EMS207077-supplement-Supplementary_Figure_2.jpg" mimetype="image" mime-subtype="jpeg" id="d77aAcFcB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD3"><label>Supplementary Figure 3</label><media xlink:href="EMS207077-supplement-Supplementary_Figure_3.jpg" mimetype="image" mime-subtype="jpeg" id="d77aAcFdB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD4"><label>Supplementary Figure 4</label><media xlink:href="EMS207077-supplement-Supplementary_Figure_4.jpg" mimetype="image" mime-subtype="jpeg" id="d77aAcFeB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD5"><label>Supplementary Figure 5</label><media xlink:href="EMS207077-supplement-Supplementary_Figure_5.jpg" mimetype="image" mime-subtype="jpeg" id="d77aAcFfB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD6"><label>Supplementary Figure 6</label><media xlink:href="EMS207077-supplement-Supplementary_Figure_6.jpg" mimetype="image" mime-subtype="jpeg" id="d77aAcFgB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD7"><label>Supplementary Figure 7</label><media xlink:href="EMS207077-supplement-Supplementary_Figure_7.jpg" mimetype="image" mime-subtype="jpeg" id="d77aAcFhB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD8"><label>Supplementary Figure 8</label><media xlink:href="EMS207077-supplement-Supplementary_Figure_8.jpg" mimetype="image" mime-subtype="jpeg" id="d77aAcFiB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD9"><label>Supplementary Figure 9</label><media xlink:href="EMS207077-supplement-Supplementary_Figure_9.jpg" mimetype="image" mime-subtype="jpeg" id="d77aAcFjB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD10"><label>Supplementary Figure 10</label><media xlink:href="EMS207077-supplement-Supplementary_Figure_10.jpg" mimetype="image" mime-subtype="jpeg" id="d77aAcFkB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD11"><label>Supplementary Figure 11</label><media xlink:href="EMS207077-supplement-Supplementary_Figure_11.jpg" mimetype="image" mime-subtype="jpeg" id="d77aAcFlB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD12"><label>Supplementary Material</label><media xlink:href="EMS207077-supplement-Supplementary_Material.pdf" mimetype="application" mime-subtype="pdf" id="d77aAcFmB" position="anchor"/></supplementary-material></sec></body><back><ack id="S48"><title>Acknowledgments</title><p>H.M.T. is supported by the Doctoral Teaching Scholarship of the Department of Computing, Imperial College London. A.I.L. acknowledges support from St John’s College, Cambridge; and a Wellcome Early Career Award (grant number 226924/Z/23/Z). We are grateful to Lewis J. Ng, whose prior work on predictive modelling for this dataset provided valuable context and inspiration for this project. For the purpose of open access, the authors have applied a Creative Commons Attribution (CC-BY) license to any Author Accepted Manuscript version arising from this submission.</p></ack><sec id="S46" sec-type="data-availability"><title>Data Availability</title><p id="P121">All requests for raw or processed data and study materials will be reviewed by R.L.C.-H., the chief investigator of both clinical trials from which the datasets were obtained. The receptor density maps from in vivo PET are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/netneurolab/hansen_receptors">https://github.com/netneurolab/hansen_receptors</ext-link>.</p></sec><sec id="S47" sec-type="data-availability"><title>Code Availability</title><p id="P122">The code used to implement and run all analyses in this study is publicly available at: <ext-link ext-link-type="uri" xlink:href="https://github.com/Imperial-MIND-lab/graphTRIP">https://github.com/Imperial-MIND-lab/graphTRIP</ext-link></p></sec><ref-list><ref id="R1"><label>[1]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bromet</surname><given-names>EJ</given-names></name><name><surname>Andrade</surname><given-names>LH</given-names></name><name><surname>Hwang</surname><given-names>IH</given-names></name><name><surname>Sampson</surname><given-names>NA</given-names></name><name><surname>Alonso</surname><given-names>J</given-names></name><name><surname>de Girolamo</surname><given-names>G</given-names></name><name><surname>de Graaf</surname><given-names>R</given-names></name><name><surname>Demyttenaere</surname><given-names>K</given-names></name><name><surname>Hu</surname><given-names>C</given-names></name><name><surname>Iwata</surname><given-names>N</given-names></name><name><surname>Karam</surname><given-names>AN</given-names></name><etal/></person-group><source>BMC Medicine</source><year>2011</year><volume>9</volume><fpage>90</fpage></element-citation></ref><ref id="R2"><label>[2]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shorey</surname><given-names>S</given-names></name><name><surname>Ng</surname><given-names>ED</given-names></name><name><surname>Wong</surname><given-names>CHJ</given-names></name></person-group><source>The British journal of clinical psychology</source><year>2021</year></element-citation></ref><ref id="R3"><label>[3]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cui</surname><given-names>L</given-names></name><name><surname>Li</surname><given-names>S</given-names></name><name><surname>Wang</surname><given-names>S</given-names></name><name><surname>Wu</surname><given-names>X</given-names></name><name><surname>Liu</surname><given-names>Y</given-names></name><name><surname>Yu</surname><given-names>W</given-names></name><name><surname>Wang</surname><given-names>Y</given-names></name><name><surname>Tang</surname><given-names>Y</given-names></name><name><surname>Xia</surname><given-names>M</given-names></name><name><surname>Li</surname><given-names>B</given-names></name></person-group><source>Signal Transduction and Targeted Therapy</source><year>2024</year><volume>9</volume></element-citation></ref><ref id="R4"><label>[4]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sharp</surname><given-names>T</given-names></name><name><surname>Collins</surname><given-names>H</given-names></name></person-group><source>Current Topics in Behavioral Neurosciences</source><year>2023</year><fpage>21</fpage><lpage>47</lpage></element-citation></ref><ref id="R5"><label>[5]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rush</surname><given-names>A</given-names></name></person-group><source>American Journal of Psychiatry</source><year>2006</year><volume>163</volume><fpage>1905</fpage></element-citation></ref><ref id="R6"><label>[6]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cipriani</surname><given-names>A</given-names></name><name><surname>Furukawa</surname><given-names>T</given-names></name><name><surname>Salanti</surname><given-names>G</given-names></name><name><surname>Geddes</surname><given-names>JR</given-names></name><name><surname>Higgins</surname><given-names>JPT</given-names></name><name><surname>Churchill</surname><given-names>R</given-names></name><name><surname>Watanabe</surname><given-names>N</given-names></name><name><surname>Nakagawa</surname><given-names>A</given-names></name><name><surname>Omori</surname><given-names>IM</given-names></name><name><surname>McGuire</surname><given-names>H</given-names></name><name><surname>Tansella</surname><given-names>M</given-names></name><etal/></person-group><source>The Lancet</source><year>2009</year><volume>373</volume><fpage>746</fpage><pub-id pub-id-type="pmid">19185342</pub-id></element-citation></ref><ref id="R7"><label>[7]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haikazian</surname><given-names>S</given-names></name><name><surname>Chen-Li</surname><given-names>DC</given-names></name><name><surname>Johnson</surname><given-names>DE</given-names></name><name><surname>Fancy</surname><given-names>F</given-names></name><name><surname>Levinta</surname><given-names>A</given-names></name><name><surname>Husain</surname><given-names>MI</given-names></name><name><surname>Mansur</surname><given-names>RB</given-names></name><name><surname>McIntyre</surname><given-names>RS</given-names></name><name><surname>Rosenblat</surname><given-names>JD</given-names></name></person-group><source>Psychiatry Research</source><year>2023</year><volume>329</volume><elocation-id>115531</elocation-id><pub-id pub-id-type="pmid">37844352</pub-id></element-citation></ref><ref id="R8"><label>[8]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carhart-Harris</surname><given-names>RL</given-names></name><name><surname>Roseman</surname><given-names>L</given-names></name><name><surname>Bolstridge</surname><given-names>M</given-names></name><name><surname>Demetriou</surname><given-names>L</given-names></name><name><surname>Pannekoek</surname><given-names>JN</given-names></name><name><surname>Wall</surname><given-names>MB</given-names></name><name><surname>Tanner</surname><given-names>MA</given-names></name><name><surname>Kaelen</surname><given-names>M</given-names></name><name><surname>McGonigle</surname><given-names>J</given-names></name><name><surname>Murphy</surname><given-names>K</given-names></name><name><surname>Leech</surname><given-names>R</given-names></name><etal/></person-group><source>Scientific Reports</source><year>2017</year><volume>7</volume></element-citation></ref><ref id="R9"><label>[9]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Goodwin</surname><given-names>GM</given-names></name><name><surname>Aaronson</surname><given-names>ST</given-names></name><name><surname>Alvarez</surname><given-names>O</given-names></name><name><surname>Arden</surname><given-names>PC</given-names></name><name><surname>Baker</surname><given-names>A</given-names></name><name><surname>Bennett</surname><given-names>JC</given-names></name><name><surname>Bird</surname><given-names>CIV</given-names></name><name><surname>Blom</surname><given-names>RE</given-names></name><name><surname>Brennan</surname><given-names>C</given-names></name><name><surname>Brusch</surname><given-names>D</given-names></name><name><surname>Burke</surname><given-names>L</given-names></name><etal/></person-group><source>The New England journal of medicine</source><year>2022</year><volume>387 18</volume><fpage>1637</fpage><pub-id pub-id-type="pmid">36322843</pub-id></element-citation></ref><ref id="R10"><label>[10]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Watford</surname><given-names>T</given-names></name><name><surname>Masood</surname><given-names>N</given-names></name></person-group><source>Clinical Psychopharmacology and Neuroscience</source><year>2023</year><volume>22</volume><fpage>2</fpage><lpage>12</lpage></element-citation></ref><ref id="R11"><label>[11]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carhart-Harris</surname><given-names>RL</given-names></name><name><surname>Goodwin</surname><given-names>GM</given-names></name></person-group><source>Neuropsychopharmacology</source><year>2017</year><volume>42</volume><fpage>2105</fpage><lpage>2113</lpage><pub-id pub-id-type="doi">10.1038/npp.2017.84</pub-id><pub-id pub-id-type="pmcid">PMC5603818</pub-id><pub-id pub-id-type="pmid">28443617</pub-id></element-citation></ref><ref id="R12"><label>[12]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Otte</surname><given-names>C</given-names></name><name><surname>Gold</surname><given-names>SM</given-names></name><name><surname>Penninx</surname><given-names>BW</given-names></name><name><surname>Pariante</surname><given-names>CM</given-names></name><name><surname>Etkin</surname><given-names>A</given-names></name><name><surname>Fava</surname><given-names>M</given-names></name><name><surname>Mohr</surname><given-names>DC</given-names></name><name><surname>Schatzberg</surname><given-names>AF</given-names></name></person-group><source>Nature Reviews Disease Primers</source><year>2016</year><volume>2</volume></element-citation></ref><ref id="R13"><label>[13]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moujaes</surname><given-names>F</given-names></name><name><surname>Preller</surname><given-names>KH</given-names></name><name><surname>Ji</surname><given-names>JL</given-names></name><name><surname>Murray</surname><given-names>JD</given-names></name><name><surname>Berkovitch</surname><given-names>L</given-names></name><name><surname>Vollenweider</surname><given-names>FX</given-names></name><name><surname>Anticevic</surname><given-names>A</given-names></name></person-group><source>Biological Psychiatry</source><year>2023</year><volume>93</volume><fpage>1061</fpage></element-citation></ref><ref id="R14"><label>[14]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bullmore</surname><given-names>ET</given-names></name><name><surname>Sporns</surname><given-names>O</given-names></name></person-group><source>Nature Reviews Neuroscience</source><year>2009</year><volume>10</volume><fpage>186</fpage><pub-id pub-id-type="pmid">19190637</pub-id></element-citation></ref><ref id="R15"><label>[15]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van den Heuvel</surname><given-names>MP</given-names></name><name><surname>Sporns</surname><given-names>O</given-names></name></person-group><source>Nature Reviews Neuroscience</source><year>2019</year><volume>20</volume><fpage>435</fpage><pub-id pub-id-type="doi">10.1038/s41583-019-0177-6</pub-id><pub-id pub-id-type="pmcid">PMC8864539</pub-id><pub-id pub-id-type="pmid">31127193</pub-id></element-citation></ref><ref id="R16"><label>[16]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>Y</given-names></name><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Liang</surname><given-names>X</given-names></name><name><surname>Li</surname><given-names>D</given-names></name><name><surname>Zheng</surname><given-names>Y</given-names></name><name><surname>Zhang</surname><given-names>H</given-names></name><name><surname>Cui</surname><given-names>Y</given-names></name><name><surname>Chen</surname><given-names>J</given-names></name><name><surname>Liu</surname><given-names>J</given-names></name><name><surname>Qiu</surname><given-names>S</given-names></name></person-group><source>Frontiers in Neurology</source><year>2020</year><volume>11</volume></element-citation></ref><ref id="R17"><label>[17]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kaiser</surname><given-names>RH</given-names></name><name><surname>Andrews-Hanna</surname><given-names>JR</given-names></name><name><surname>Wager</surname><given-names>TD</given-names></name><name><surname>Pizzagalli</surname><given-names>DA</given-names></name></person-group><source>JAMA psychiatry</source><year>2015</year><volume>72 6</volume><fpage>603</fpage><pub-id pub-id-type="doi">10.1001/jamapsychiatry.2015.0071</pub-id><pub-id pub-id-type="pmcid">PMC4456260</pub-id><pub-id pub-id-type="pmid">25785575</pub-id></element-citation></ref><ref id="R18"><label>[18]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dipasquale</surname><given-names>O</given-names></name><name><surname>Selvaggi</surname><given-names>P</given-names></name><name><surname>Veronese</surname><given-names>M</given-names></name><name><surname>Gabay</surname><given-names>AS</given-names></name><name><surname>Turkheimer</surname><given-names>FE</given-names></name><name><surname>Mehta</surname><given-names>MA</given-names></name></person-group><source>Neuroimage</source><year>2019</year><volume>195</volume><fpage>252</fpage><pub-id pub-id-type="doi">10.1016/j.neuroimage.2019.04.007</pub-id><pub-id pub-id-type="pmcid">PMC6547164</pub-id><pub-id pub-id-type="pmid">30953835</pub-id></element-citation></ref><ref id="R19"><label>[19]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lawn</surname><given-names>T</given-names></name><name><surname>Howard</surname><given-names>MA</given-names></name><name><surname>Turkheimer</surname><given-names>FE</given-names></name><name><surname>Mišić</surname><given-names>B</given-names></name><name><surname>Deco</surname><given-names>G</given-names></name><name><surname>Martins</surname><given-names>DFD</given-names></name><name><surname>Dipasquale</surname><given-names>O</given-names></name></person-group><source>Neuroscience and Biobehavioral Reviews</source><year>2023</year><volume>150</volume><elocation-id>105193</elocation-id><pub-id pub-id-type="doi">10.1016/j.neubiorev.2023.105193</pub-id><pub-id pub-id-type="pmcid">PMC10390343</pub-id><pub-id pub-id-type="pmid">37086932</pub-id></element-citation></ref><ref id="R20"><label>[20]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hansen</surname><given-names>JY</given-names></name><name><surname>Shafiei</surname><given-names>G</given-names></name><name><surname>Markello</surname><given-names>RD</given-names></name><name><surname>Smart</surname><given-names>K</given-names></name><name><surname>Cox</surname><given-names>SML</given-names></name><name><surname>Wu</surname><given-names>Y</given-names></name><name><surname>Gallezot</surname><given-names>JD</given-names></name><name><surname>Aumont</surname><given-names>É</given-names></name><name><surname>Servaes</surname><given-names>S</given-names></name><name><surname>Scala</surname><given-names>SG</given-names></name><name><surname>DuBois</surname><given-names>JM</given-names></name><etal/></person-group><source>Nature Neuroscience</source><year>2022</year><volume>25</volume><fpage>1569</fpage></element-citation></ref><ref id="R21"><label>[21]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Luppi</surname><given-names>AI</given-names></name><name><surname>Hansen</surname><given-names>JY</given-names></name><name><surname>Adapa</surname><given-names>R</given-names></name><name><surname>Carhart-Harris</surname><given-names>RL</given-names></name><name><surname>Roseman</surname><given-names>L</given-names></name><name><surname>Timmermann</surname><given-names>C</given-names></name><name><surname>Golkowski</surname><given-names>D</given-names></name><name><surname>Ranft</surname><given-names>A</given-names></name><name><surname>Ilg</surname><given-names>R</given-names></name><name><surname>Jordan</surname><given-names>D</given-names></name><etal/></person-group><source>Science advances</source><year>2023</year><volume>9</volume><elocation-id>eadf8332</elocation-id><pub-id pub-id-type="doi">10.1126/sciadv.adf8332</pub-id><pub-id pub-id-type="pmcid">PMC10266734</pub-id><pub-id pub-id-type="pmid">37315149</pub-id></element-citation></ref><ref id="R22"><label>[22]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lawn</surname><given-names>T</given-names></name><name><surname>Giacomel</surname><given-names>A</given-names></name><name><surname>Martins</surname><given-names>D</given-names></name><name><surname>Veronese</surname><given-names>M</given-names></name><name><surname>Howard</surname><given-names>M</given-names></name><name><surname>Turkheimer</surname><given-names>FE</given-names></name><name><surname>Dipasquale</surname><given-names>O</given-names></name></person-group><source>Communications Biology</source><year>2024</year><volume>7</volume></element-citation></ref><ref id="R23"><label>[23]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Martins</surname><given-names>D</given-names></name><name><surname>Veronese</surname><given-names>M</given-names></name><name><surname>Turkheimer</surname><given-names>FE</given-names></name><name><surname>Howard</surname><given-names>MA</given-names></name><name><surname>Williams</surname><given-names>SC</given-names></name><name><surname>Dipasquale</surname><given-names>O</given-names></name></person-group><source>Brain Communications</source><year>2021</year><volume>4</volume></element-citation></ref><ref id="R24"><label>[24]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lawn</surname><given-names>T</given-names></name><name><surname>Dipasquale</surname><given-names>O</given-names></name><name><surname>Vamvakas</surname><given-names>A</given-names></name><name><surname>Tsougos</surname><given-names>I</given-names></name><name><surname>Mehta</surname><given-names>MA</given-names></name><name><surname>Howard</surname><given-names>MA</given-names></name></person-group><source>Psychopharmacology</source><year>2022</year><volume>239</volume><fpage>1797</fpage><pub-id pub-id-type="doi">10.1007/s00213-022-06117-5</pub-id><pub-id pub-id-type="pmcid">PMC9166846</pub-id><pub-id pub-id-type="pmid">35322297</pub-id></element-citation></ref><ref id="R25"><label>[25]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Copa</surname><given-names>D</given-names></name><name><surname>Erritzoe</surname><given-names>D</given-names></name><name><surname>Giribaldi</surname><given-names>B</given-names></name><name><surname>Nutt</surname><given-names>D</given-names></name><name><surname>Carhart-Harris</surname><given-names>R</given-names></name><name><surname>Tagliazucchi</surname><given-names>E</given-names></name></person-group><source>Journal of Affective Disorders</source><year>2024</year><volume>353</volume><fpage>60</fpage><lpage>69</lpage><pub-id pub-id-type="pmid">38423367</pub-id></element-citation></ref><ref id="R26"><label>[26]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Escrichs</surname><given-names>A</given-names></name><name><surname>Perl</surname><given-names>YSanz</given-names></name><name><surname>Fisher</surname><given-names>PM</given-names></name><name><surname>Martínez-Molina</surname><given-names>N</given-names></name><name><surname>G-Guzman</surname><given-names>E</given-names></name><name><surname>Frokjaer</surname><given-names>VG</given-names></name><name><surname>Kringelbach</surname><given-names>ML</given-names></name><name><surname>Knudsen</surname><given-names>GM</given-names></name><name><surname>Deco</surname><given-names>G</given-names></name></person-group><source>Molecular Psychiatry</source><year>2024</year><volume>30</volume><fpage>1069</fpage><lpage>1079</lpage></element-citation></ref><ref id="R27"><label>[27]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Deco</surname><given-names>G</given-names></name><name><surname>Perl</surname><given-names>YS</given-names></name><name><surname>Johnson</surname><given-names>S</given-names></name><name><surname>Bourke</surname><given-names>N</given-names></name><name><surname>Carhart-Harris</surname><given-names>RL</given-names></name><name><surname>Kringelbach</surname><given-names>ML</given-names></name></person-group><source>Nature Mental Health</source><year>2024</year></element-citation></ref><ref id="R28"><label>[28]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chekroud</surname><given-names>AM</given-names></name><name><surname>Zotti</surname><given-names>R</given-names></name><name><surname>Shehzad</surname><given-names>Z</given-names></name><name><surname>Gueorguieva</surname><given-names>R</given-names></name><name><surname>Johnson</surname><given-names>MK</given-names></name><name><surname>Trivedi</surname><given-names>MH</given-names></name><name><surname>Cannon</surname><given-names>TD</given-names></name><name><surname>Krystal</surname><given-names>JH</given-names></name><name><surname>Corlett</surname><given-names>PR</given-names></name></person-group><source>The lancet Psychiatry</source><year>2016</year><volume>3</volume><issue>3</issue><fpage>243</fpage></element-citation></ref><ref id="R29"><label>[29]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eickhoff</surname><given-names>SB</given-names></name><name><surname>Yeo</surname><given-names>BTT</given-names></name><name><surname>Genon</surname><given-names>S</given-names></name></person-group><source>Nature Reviews Neuroscience</source><year>2018</year><volume>19</volume><fpage>672</fpage><pub-id pub-id-type="pmid">30305712</pub-id></element-citation></ref><ref id="R30"><label>[30]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Luppi</surname><given-names>AI</given-names></name><name><surname>Gellersen</surname><given-names>HM</given-names></name><name><surname>Liu</surname><given-names>Z-Q</given-names></name><name><surname>Peattie</surname><given-names>AR</given-names></name><name><surname>Manktelow</surname><given-names>AE</given-names></name><name><surname>Adapa</surname><given-names>R</given-names></name><name><surname>Owen</surname><given-names>AM</given-names></name><name><surname>Naci</surname><given-names>L</given-names></name><name><surname>Menon</surname><given-names>DK</given-names></name><name><surname>Dimitriadis</surname><given-names>SI</given-names></name><etal/></person-group><source>Nature Communications</source><year>2024</year><volume>15</volume><fpage>4745</fpage></element-citation></ref><ref id="R31"><label>[31]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Templeton</surname><given-names>A</given-names></name><name><surname>Conerly</surname><given-names>T</given-names></name><name><surname>Marcus</surname><given-names>J</given-names></name><name><surname>Lindsey</surname><given-names>J</given-names></name><name><surname>Bricken</surname><given-names>T</given-names></name><name><surname>Chen</surname><given-names>B</given-names></name><name><surname>Pearce</surname><given-names>A</given-names></name><name><surname>Citro</surname><given-names>C</given-names></name><name><surname>Ameisen</surname><given-names>E</given-names></name><name><surname>Jones</surname><given-names>A</given-names></name><name><surname>Cunningham</surname><given-names>H</given-names></name><etal/></person-group><source>Transformer Circuits Thread</source><year>2024</year></element-citation></ref><ref id="R32"><label>[32]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lindsey</surname><given-names>J</given-names></name><name><surname>Gurnee</surname><given-names>W</given-names></name><name><surname>Ameisen</surname><given-names>E</given-names></name><name><surname>Chen</surname><given-names>B</given-names></name><name><surname>Pearce</surname><given-names>A</given-names></name><name><surname>Turner</surname><given-names>NL</given-names></name><name><surname>Citro</surname><given-names>C</given-names></name><name><surname>Abrahams</surname><given-names>D</given-names></name><name><surname>Carter</surname><given-names>S</given-names></name><name><surname>Hosmer</surname><given-names>B</given-names></name><name><surname>Marcus</surname><given-names>J</given-names></name><etal/></person-group><source>Transformer Circuits Thread</source><year>2025</year></element-citation></ref><ref id="R33"><label>[33]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lekadir</surname><given-names>K</given-names></name><name><surname>Frangi</surname><given-names>AF</given-names></name><name><surname>Porras</surname><given-names>AR</given-names></name><name><surname>Glocker</surname><given-names>B</given-names></name><name><surname>Cintas</surname><given-names>C</given-names></name><name><surname>Langlotz</surname><given-names>CP</given-names></name><name><surname>Weicken</surname><given-names>E</given-names></name><name><surname>Asselbergs</surname><given-names>FW</given-names></name><name><surname>Prior</surname><given-names>F</given-names></name><name><surname>Collins</surname><given-names>GS</given-names></name><etal/></person-group><source>BMJ</source><year>2025</year><volume>388</volume></element-citation></ref><ref id="R34"><label>[34]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Künzel</surname><given-names>SR</given-names></name><name><surname>Sekhon</surname><given-names>JS</given-names></name><name><surname>Bickel</surname><given-names>PJ</given-names></name><name><surname>Yu</surname><given-names>B</given-names></name></person-group><source>Proceedings of the National Academy of Sciences of the United States of America</source><year>2019</year><volume>116</volume><fpage>4156</fpage></element-citation></ref><ref id="R35"><label>[35]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carhart-Harris</surname><given-names>RL</given-names></name><name><surname>Giribaldi</surname><given-names>B</given-names></name><name><surname>Watts</surname><given-names>R</given-names></name><name><surname>Baker-Jones</surname><given-names>M</given-names></name><name><surname>Murphy-Beiner</surname><given-names>A</given-names></name><name><surname>Murphy</surname><given-names>R</given-names></name><name><surname>Martell</surname><given-names>J</given-names></name><name><surname>Blemings</surname><given-names>A</given-names></name><name><surname>Erritzoe</surname><given-names>D</given-names></name><name><surname>Nutt</surname><given-names>DJ</given-names></name></person-group><source>The New England journal of medicine</source><year>2021</year><volume>384 15</volume><fpage>1402</fpage><pub-id pub-id-type="pmid">33852780</pub-id></element-citation></ref><ref id="R36"><label>[36]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schaefer</surname><given-names>A</given-names></name><name><surname>Kong</surname><given-names>R</given-names></name><name><surname>Gordon</surname><given-names>EM</given-names></name><name><surname>Laumann</surname><given-names>TO</given-names></name><name><surname>Zuo</surname><given-names>X-N</given-names></name><name><surname>Holmes</surname><given-names>AJ</given-names></name><name><surname>Eickhoff</surname><given-names>SB</given-names></name><name><surname>Yeo</surname><given-names>BTT</given-names></name></person-group><source>Cerebral Cortex</source><year>2018</year></element-citation></ref><ref id="R37"><label>[37]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tzourio-Mazoyer</surname><given-names>N</given-names></name><name><surname>Landeau</surname><given-names>B</given-names></name><name><surname>Papathanassiou</surname><given-names>D</given-names></name><name><surname>Crivello</surname><given-names>F</given-names></name><name><surname>Etard</surname><given-names>O</given-names></name><name><surname>Delcroix</surname><given-names>N</given-names></name><name><surname>Mazoyer</surname><given-names>B</given-names></name><name><surname>Joliot</surname><given-names>M</given-names></name></person-group><source>NeuroImage</source><year>2002</year><volume>15</volume><fpage>273</fpage><pub-id pub-id-type="pmid">11771995</pub-id></element-citation></ref><ref id="R38"><label>[38]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Margulies</surname><given-names>DS</given-names></name><name><surname>Ghosh</surname><given-names>SS</given-names></name><name><surname>Ghosh</surname><given-names>SS</given-names></name><name><surname>Goulas</surname><given-names>A</given-names></name><name><surname>Falkiewicz</surname><given-names>M</given-names></name><name><surname>Huntenburg</surname><given-names>JM</given-names></name><name><surname>Langs</surname><given-names>G</given-names></name><name><surname>Langs</surname><given-names>G</given-names></name><name><surname>Bezgin</surname><given-names>G</given-names></name><name><surname>Eickhoff</surname><given-names>SB</given-names></name><name><surname>Castellanos</surname><given-names>FX</given-names></name><etal/></person-group><source>Proceedings of the National Academy of Sciences</source><year>2016</year><volume>113</volume><elocation-id>12574</elocation-id></element-citation></ref><ref id="R39"><label>[39]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Goulas</surname><given-names>A</given-names></name><name><surname>Changeux</surname><given-names>JP</given-names></name><name><surname>Wagstyl</surname><given-names>K</given-names></name><name><surname>Amunts</surname><given-names>K</given-names></name><name><surname>Palomero-Gallagher</surname><given-names>N</given-names></name><name><surname>Hilgetag</surname><given-names>CC</given-names></name></person-group><source>Proceedings of the National Academy of Sciences of the United States of America</source><year>2020</year><volume>118</volume></element-citation></ref><ref id="R40"><label>[40]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Luppi</surname><given-names>AI</given-names></name><name><surname>Mediano</surname><given-names>PAM</given-names></name><name><surname>Rosas</surname><given-names>FE</given-names></name><name><surname>Holland</surname><given-names>N</given-names></name><name><surname>Fryer</surname><given-names>TD</given-names></name><name><surname>Rowe</surname><given-names>JB</given-names></name><name><surname>Menon</surname><given-names>DK</given-names></name><name><surname>Bor</surname><given-names>D</given-names></name><name><surname>Stamatakis</surname><given-names>EA</given-names></name></person-group><source>Nature Neuroscience</source><year>2022</year><volume>25</volume><fpage>771</fpage></element-citation></ref><ref id="R41"><label>[41]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sydnor</surname><given-names>VJ</given-names></name><name><surname>Larsen</surname><given-names>B</given-names></name><name><surname>Bassett</surname><given-names>DS</given-names></name><name><surname>Alexander-Bloch</surname><given-names>A</given-names></name><name><surname>Fair</surname><given-names>DA</given-names></name><name><surname>Liston</surname><given-names>C</given-names></name><name><surname>Mackey</surname><given-names>AP</given-names></name><name><surname>Milham</surname><given-names>MP</given-names></name><name><surname>Pines</surname><given-names>A</given-names></name><name><surname>Roalf</surname><given-names>DR</given-names></name><etal/></person-group><source>Neuron</source><year>2021</year><volume>109</volume><fpage>2820</fpage><pub-id pub-id-type="doi">10.1016/j.neuron.2021.06.016</pub-id><pub-id pub-id-type="pmcid">PMC8448958</pub-id><pub-id pub-id-type="pmid">34270921</pub-id></element-citation></ref><ref id="R42"><label>[42]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Beliveau</surname><given-names>V</given-names></name><name><surname>Ganz</surname><given-names>M</given-names></name><name><surname>Feng</surname><given-names>L</given-names></name><name><surname>Ozenne</surname><given-names>B</given-names></name><name><surname>Højgaard</surname><given-names>L</given-names></name><name><surname>Fisher</surname><given-names>PM</given-names></name><name><surname>Svarer</surname><given-names>C</given-names></name><name><surname>Greve</surname><given-names>DN</given-names></name><name><surname>Knudsen</surname><given-names>GM</given-names></name></person-group><source>The Journal of Neuroscience</source><year>2017</year><volume>37</volume><fpage>120</fpage></element-citation></ref><ref id="R43"><label>[43]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Váša</surname><given-names>F</given-names></name><name><surname>Mišić</surname><given-names>B</given-names></name></person-group><source>Nature Reviews Neuroscience</source><year>2022</year><volume>23</volume><fpage>493</fpage><pub-id pub-id-type="pmid">35641793</pub-id></element-citation></ref><ref id="R44"><label>[44]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yeo</surname><given-names>BTT</given-names></name><name><surname>Krienen</surname><given-names>FM</given-names></name><name><surname>Sepulcre</surname><given-names>J</given-names></name><name><surname>Sepulcre</surname><given-names>J</given-names></name><name><surname>Sabuncu</surname><given-names>MR</given-names></name><name><surname>Sabuncu</surname><given-names>MR</given-names></name><name><surname>Lashkari</surname><given-names>D</given-names></name><name><surname>Hollinshead</surname><given-names>MO</given-names></name><name><surname>Hollinshead</surname><given-names>MO</given-names></name><name><surname>Roffman</surname><given-names>JL</given-names></name><name><surname>Smoller</surname><given-names>JW</given-names></name><etal/></person-group><source>Journal of neurophysiology</source><year>2011</year><volume>1063</volume><fpage>1125</fpage></element-citation></ref><ref id="R45"><label>[45]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Luppi</surname><given-names>AI</given-names></name><name><surname>Rosas</surname><given-names>FE</given-names></name><name><surname>Mediano</surname><given-names>PA</given-names></name><name><surname>Menon</surname><given-names>DK</given-names></name><name><surname>Stamatakis</surname><given-names>EA</given-names></name></person-group><source>Trends in Cognitive Sciences</source><year>2024</year><volume>28</volume><fpage>352</fpage><pub-id pub-id-type="pmid">38199949</pub-id></element-citation></ref><ref id="R46"><label>[46]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shalit</surname><given-names>U</given-names></name><name><surname>Johansson</surname><given-names>FD</given-names></name><name><surname>Sontag</surname><given-names>DA</given-names></name></person-group><source>ArXiv</source><year>2017</year><elocation-id>abs/1606.03976</elocation-id></element-citation></ref><ref id="R47"><label>[47]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Griffiths</surname><given-names>RR</given-names></name><name><surname>Johnson</surname><given-names>MW</given-names></name><name><surname>Carducci</surname><given-names>MA</given-names></name><name><surname>Umbricht</surname><given-names>A</given-names></name><name><surname>Richards</surname><given-names>WA</given-names></name><name><surname>Richards</surname><given-names>BD</given-names></name><name><surname>Cosimano</surname><given-names>MP</given-names></name><name><surname>Klinedinst</surname><given-names>MA</given-names></name></person-group><source>Journal of Psychopharmacology (Oxford, England)</source><year>2016</year><volume>30</volume><fpage>1181</fpage><pub-id pub-id-type="doi">10.1177/0269881116675513</pub-id><pub-id pub-id-type="pmcid">PMC5367557</pub-id><pub-id pub-id-type="pmid">27909165</pub-id></element-citation></ref><ref id="R48"><label>[48]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Roseman</surname><given-names>L</given-names></name><name><surname>Nutt</surname><given-names>DJ</given-names></name><name><surname>Carhart-Harris</surname><given-names>RL</given-names></name></person-group><source>Frontiers in Pharmacology</source><year>2018</year><volume>8</volume></element-citation></ref><ref id="R49"><label>[49]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ross</surname><given-names>S</given-names></name><name><surname>Bossis</surname><given-names>A</given-names></name><name><surname>Guss</surname><given-names>J</given-names></name><name><surname>Agin-Liebes</surname><given-names>G</given-names></name><name><surname>Malone</surname><given-names>T</given-names></name><name><surname>Cohen</surname><given-names>B</given-names></name><name><surname>Mennenga</surname><given-names>SE</given-names></name><name><surname>Belser</surname><given-names>A</given-names></name><name><surname>Kalliontzi</surname><given-names>K</given-names></name><name><surname>Babb</surname><given-names>J</given-names></name><etal/></person-group><source>Journal of Psychopharmacology</source><year>2016</year><volume>30</volume><fpage>1165</fpage><lpage>1180</lpage></element-citation></ref><ref id="R50"><label>[50]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bogenschutz</surname><given-names>MP</given-names></name><name><surname>Forcehimes</surname><given-names>AA</given-names></name><name><surname>Pommy</surname><given-names>JA</given-names></name><name><surname>Wilcox</surname><given-names>CE</given-names></name><name><surname>Barbosa</surname><given-names>P</given-names></name><name><surname>Strassman</surname><given-names>RJ</given-names></name></person-group><source>Journal of Psychopharmacology</source><year>2015</year><volume>29</volume><fpage>289</fpage><pub-id pub-id-type="pmid">25586396</pub-id></element-citation></ref><ref id="R51"><label>[51]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Johnson</surname><given-names>MW</given-names></name><name><surname>Garcia-Romeu</surname><given-names>A</given-names></name><name><surname>Griffiths</surname><given-names>RR</given-names></name></person-group><source>The American Journal of Drug and Alcohol Abuse</source><year>2016</year><volume>43</volume><fpage>55</fpage><lpage>60</lpage></element-citation></ref><ref id="R52"><label>[52]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nichols</surname><given-names>DE</given-names></name></person-group><source>Pharmacological Reviews</source><year>2016</year><volume>68</volume><fpage>264</fpage><pub-id pub-id-type="doi">10.1124/pr.115.011478</pub-id><pub-id pub-id-type="pmcid">PMC4813425</pub-id><pub-id pub-id-type="pmid">26841800</pub-id></element-citation></ref><ref id="R53"><label>[53]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ballentine</surname><given-names>G</given-names></name><name><surname>Friedman</surname><given-names>SF</given-names></name><name><surname>Bzdok</surname><given-names>D</given-names></name></person-group><source>Science Advances</source><year>2021</year><volume>8</volume></element-citation></ref><ref id="R54"><label>[54]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Preller</surname><given-names>KH</given-names></name><name><surname>Burt</surname><given-names>JB</given-names></name><name><surname>Ji</surname><given-names>JL</given-names></name><name><surname>Schleifer</surname><given-names>CH</given-names></name><name><surname>Adkinson</surname><given-names>BD</given-names></name><name><surname>Stämpfli</surname><given-names>P</given-names></name><name><surname>Seifritz</surname><given-names>E</given-names></name><name><surname>Repovs</surname><given-names>G</given-names></name><name><surname>Krystal</surname><given-names>JH</given-names></name><name><surname>Murray</surname><given-names>JD</given-names></name><etal/></person-group><source>Elife</source><year>2018</year><volume>7</volume><elocation-id>e35082</elocation-id></element-citation></ref><ref id="R55"><label>[55]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berton</surname><given-names>O</given-names></name><name><surname>Aguerre</surname><given-names>S</given-names></name><name><surname>Sarrieau</surname><given-names>A</given-names></name><name><surname>Mormède</surname><given-names>P</given-names></name><name><surname>Chaouloff</surname><given-names>F</given-names></name></person-group><source>Neuroscience</source><year>1998</year><volume>82</volume><fpage>147</fpage><pub-id pub-id-type="pmid">9483511</pub-id></element-citation></ref><ref id="R56"><label>[56]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Benekareddy</surname><given-names>M</given-names></name><name><surname>Goodfellow</surname><given-names>NM</given-names></name><name><surname>Lambe</surname><given-names>EK</given-names></name><name><surname>Vaidya</surname><given-names>VA</given-names></name></person-group><source>The Journal of Neuroscience</source><year>2010</year><volume>30</volume><elocation-id>12138</elocation-id></element-citation></ref><ref id="R57"><label>[57]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lopez</surname><given-names>JF</given-names></name><name><surname>Liberzon</surname><given-names>I</given-names></name><name><surname>Vázquez</surname><given-names>DM</given-names></name><name><surname>Young</surname><given-names>EA</given-names></name><name><surname>Watson</surname><given-names>SJ</given-names></name></person-group><source>Biological Psychiatry</source><year>1999</year><volume>45</volume><fpage>934</fpage><pub-id pub-id-type="pmid">10202584</pub-id></element-citation></ref><ref id="R58"><label>[58]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Amargós-Bosch</surname><given-names>M</given-names></name><name><surname>Bortolozzi</surname><given-names>A</given-names></name><name><surname>Puig</surname><given-names>MV</given-names></name><name><surname>Serrats</surname><given-names>J</given-names></name><name><surname>Adell</surname><given-names>A</given-names></name><name><surname>Celada</surname><given-names>P</given-names></name><name><surname>Toth</surname><given-names>M</given-names></name><name><surname>Mengod</surname><given-names>G</given-names></name><name><surname>Artigas</surname><given-names>F</given-names></name></person-group><source>Cerebral cortex</source><year>2004</year><volume>14</volume><issue>3</issue><fpage>281</fpage><pub-id pub-id-type="pmid">14754868</pub-id></element-citation></ref><ref id="R59"><label>[59]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carhart-Harris</surname><given-names>R</given-names></name><name><surname>Nutt</surname><given-names>DJ</given-names></name></person-group><source>Journal of Psychopharmacology (Oxford, England)</source><year>2017</year><volume>31</volume><fpage>1091</fpage><pub-id pub-id-type="doi">10.1177/0269881117725915</pub-id><pub-id pub-id-type="pmcid">PMC5606297</pub-id><pub-id pub-id-type="pmid">28858536</pub-id></element-citation></ref><ref id="R60"><label>[60]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tsigos</surname><given-names>C</given-names></name><name><surname>Chrousos</surname><given-names>GP</given-names></name></person-group><source>Journal of psychosomatic research</source><year>2002</year><volume>53</volume><issue>4</issue><fpage>865</fpage><pub-id pub-id-type="pmid">12377295</pub-id></element-citation></ref><ref id="R61"><label>[61]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Arias</surname><given-names>HR</given-names></name><name><surname>Targowska-Duda</surname><given-names>KM</given-names></name><name><surname>García-Colunga</surname><given-names>J</given-names></name><name><surname>Ortells</surname><given-names>MO</given-names></name></person-group><source>Molecules</source><year>2021</year><volume>26</volume></element-citation></ref><ref id="R62"><label>[62]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mineur</surname><given-names>YS</given-names></name><name><surname>Obayemi</surname><given-names>A</given-names></name><name><surname>Wigestrand</surname><given-names>MB</given-names></name><name><surname>Fote</surname><given-names>GM</given-names></name><name><surname>Calarco</surname><given-names>CA</given-names></name><name><surname>Li</surname><given-names>AM</given-names></name><name><surname>Picciotto</surname><given-names>MR</given-names></name></person-group><source>Proceedings of the National Academy of Sciences</source><year>2013</year><volume>110</volume><fpage>3573</fpage><lpage>3578</lpage></element-citation></ref><ref id="R63"><label>[63]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Risch</surname><given-names>SC</given-names></name><name><surname>Cohen</surname><given-names>RM</given-names></name><name><surname>Janowsky</surname><given-names>DS</given-names></name><name><surname>Kalin</surname><given-names>NH</given-names></name><name><surname>Murphy</surname><given-names>DL</given-names></name></person-group><source>Science</source><year>1980</year><volume>209</volume><issue>4464</issue><fpage>1545</fpage><pub-id pub-id-type="pmid">7433977</pub-id></element-citation></ref><ref id="R64"><label>[64]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pádua-Reis</surname><given-names>M</given-names></name><name><surname>Aquino</surname><given-names>NSS</given-names></name><name><surname>Oliveira</surname><given-names>VEM</given-names></name><name><surname>Szawka</surname><given-names>RE</given-names></name><name><surname>Prado</surname><given-names>MAM</given-names></name><name><surname>Prado</surname><given-names>VF</given-names></name><name><surname>Pereira</surname><given-names>GS</given-names></name></person-group><source>Behavioural Brain Research</source><year>2017</year><volume>330</volume><fpage>127</fpage><pub-id pub-id-type="pmid">28461009</pub-id></element-citation></ref><ref id="R65"><label>[65]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shi</surname><given-names>C</given-names></name><name><surname>Blei</surname><given-names>DM</given-names></name><name><surname>Veitch</surname><given-names>V</given-names></name></person-group><source>Neural Information Processing Systems</source><year>2019</year></element-citation></ref><ref id="R66"><label>[66]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cofré</surname><given-names>R</given-names></name><name><surname>Herzog</surname><given-names>R</given-names></name><name><surname>Mediano</surname><given-names>PAM</given-names></name><name><surname>Piccinini</surname><given-names>JI</given-names></name><name><surname>Rosas</surname><given-names>FE</given-names></name><name><surname>Perl</surname><given-names>YS</given-names></name><name><surname>Tagliazucchi</surname><given-names>E</given-names></name></person-group><source>Brain Sciences</source><year>2020</year><volume>10</volume></element-citation></ref><ref id="R67"><label>[67]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Deco</surname><given-names>G</given-names></name><name><surname>Cruzat</surname><given-names>J</given-names></name><name><surname>Cabral</surname><given-names>J</given-names></name><name><surname>Knudsen</surname><given-names>GM</given-names></name><name><surname>Carhart-Harris</surname><given-names>RL</given-names></name><name><surname>Whybrow</surname><given-names>PC</given-names></name><name><surname>Logothetis</surname><given-names>NK</given-names></name><name><surname>Kringelbach</surname><given-names>ML</given-names></name></person-group><source>Current biology</source><year>2018</year><volume>28</volume><fpage>3065</fpage></element-citation></ref><ref id="R68"><label>[68]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kringelbach</surname><given-names>ML</given-names></name><name><surname>Cruzat</surname><given-names>J</given-names></name><name><surname>Cabral</surname><given-names>J</given-names></name><name><surname>Knudsen</surname><given-names>GM</given-names></name><name><surname>Carhart-Harris</surname><given-names>R</given-names></name><name><surname>Whybrow</surname><given-names>PC</given-names></name><name><surname>Logothetis</surname><given-names>NK</given-names></name><name><surname>Deco</surname><given-names>G</given-names></name></person-group><source>Proceedings of the National Academy of Sciences</source><year>2020</year><volume>117</volume><fpage>9566</fpage></element-citation></ref><ref id="R69"><label>[69]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Burt</surname><given-names>JB</given-names></name><name><surname>Preller</surname><given-names>KH</given-names></name><name><surname>Demirtas</surname><given-names>M</given-names></name><name><surname>Ji</surname><given-names>JL</given-names></name><name><surname>Krystal</surname><given-names>JH</given-names></name><name><surname>Vollenweider</surname><given-names>FX</given-names></name><name><surname>Anticevic</surname><given-names>A</given-names></name><name><surname>Murray</surname><given-names>JD</given-names></name></person-group><source>Elife</source><year>2021</year><volume>10</volume><elocation-id>e69320</elocation-id></element-citation></ref><ref id="R70"><label>[70]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Luppi</surname><given-names>AI</given-names></name><name><surname>Singleton</surname><given-names>SP</given-names></name><name><surname>Hansen</surname><given-names>JY</given-names></name><name><surname>Jamison</surname><given-names>KW</given-names></name><name><surname>Bzdok</surname><given-names>D</given-names></name><name><surname>Kuceyeski</surname><given-names>A</given-names></name><name><surname>Betzel</surname><given-names>RF</given-names></name><name><surname>Misic</surname><given-names>B</given-names></name></person-group><source>Nature Biomedical Engineering</source><year>2024</year><volume>8</volume><fpage>1142</fpage><pub-id pub-id-type="doi">10.1038/s41551-024-01242-2</pub-id><pub-id pub-id-type="pmcid">PMC11410673</pub-id><pub-id pub-id-type="pmid">39103509</pub-id></element-citation></ref><ref id="R71"><label>[71]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Luppi</surname><given-names>AI</given-names></name><name><surname>Milisav</surname><given-names>FI</given-names></name><name><surname>Suarez</surname><given-names>LE</given-names></name><name><surname>Shafiei</surname><given-names>G</given-names></name><name><surname>Vohryzek</surname><given-names>J</given-names></name><name><surname>Sanz Perl</surname><given-names>Y</given-names></name><name><surname>Ali</surname><given-names>H</given-names></name><name><surname>Rosas</surname><given-names>FE</given-names></name><name><surname>Mediano</surname><given-names>PA</given-names></name><name><surname>Misic</surname><given-names>B</given-names></name><etal/></person-group><source>bioRxiv</source><year>2025</year><volume>2025</volume></element-citation></ref><ref id="R72"><label>[72]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Daws</surname><given-names>RE</given-names></name><name><surname>Timmermann</surname><given-names>CB</given-names></name><name><surname>Giribaldi</surname><given-names>B</given-names></name><name><surname>Sexton</surname><given-names>JD</given-names></name><name><surname>Wall</surname><given-names>MB</given-names></name><name><surname>Erritzoe</surname><given-names>D</given-names></name><name><surname>Roseman</surname><given-names>L</given-names></name><name><surname>Nutt</surname><given-names>DJ</given-names></name><name><surname>Carhart-Harris</surname><given-names>RL</given-names></name></person-group><source>Nature Medicine</source><year>2022</year><volume>28</volume><fpage>844</fpage></element-citation></ref><ref id="R73"><label>[73]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brody</surname><given-names>S</given-names></name><name><surname>Alon</surname><given-names>U</given-names></name><name><surname>Yahav</surname><given-names>E</given-names></name></person-group><source>ArXiv</source><year>2021</year><elocation-id>abs/2105.14491</elocation-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Fig. 1</label><caption><title>Overview of study design and methodological framework.</title><p><bold>a</bold>, Primary dataset: 42 MDD patients from a double-blind RCT, comparing escitalopram (<italic>N</italic> = 20) and psilocybin (<italic>N</italic> = 22) treatment. Escitalopram and psilocybin groups, respectively, received inactive and high doses of psilocybin on each dosing day (DD1, DD2), conducted in a safe environment with psychological support. Escitalopram or placebo was administered daily for three weeks after each session. Depression severity was assessed using QIDS three weeks after DD2. <bold>b</bold>, Validation dataset: 16 TRD patients received low (DD1) and high (DD2) doses of psilocybin in an open-label trial. Depression severity was assessed using QIDS one week after DD2. <bold>c</bold>, Brain graphs were constructed from baseline fMRI, with node features encoding serotonin system REACT maps and edges reflecting functional connectivity. A variational graph autoencoder (VGAE) learned latent graph embeddings, which were passed to a multilayer perceptron (MLP) for predicting post-treatment QIDS. <bold>d</bold>, Two complementary interpretability analyses reveal the predictive contributions of brain regions and biomarkers. <bold>e</bold> We extend our model within a causal inference framework to estimate individual treatment effects and identify treatment-specific moderators.</p></caption><graphic xlink:href="EMS207077-f001"/></fig><fig id="F2" position="float"><label>Fig. 2</label><caption><title>Reconstruction and prediction performance of the <monospace>graphTRIP</monospace> model.</title><p><bold>a</bold>, <monospace>graphTRIP</monospace> significantly predicts post-treatment QIDS, outperforming a control MLP trained only on clinical data and drug condition, without latent neuroimaging features (<bold><italic>z</italic></bold>). <bold>b</bold>, After controlling for the difference in post-treatment QIDS between drug conditions, the partial correlation between true and predicted scores remains significant for the <monospace>graphTRIP</monospace> model, but not for the control MLP. <bold>c</bold>, Example VGAE reconstructions of FC and REACT node features. <bold>d</bold>, Correlations between original and reconstructed FC and node features across all patients. <bold>e</bold>, Permutation importance analysis, showing the increase in mean absolute error (MAE) caused by shuffling individual features across patients. Intuitively, shuffling important features results in greater prediction error. Bars indicate the mean increase in MAE across 50 random permutations; error bars denote standard error.</p></caption><graphic xlink:href="EMS207077-f002"/></fig><fig id="F3" position="float"><label>Fig. 3</label><caption><title>Generalisation across brain parcellations and boosting performance with a hybrid model.</title><p><bold>a</bold>, The <monospace>graphTRIP</monospace> model, trained on Schaefer 100, generalises to Schaefer 200 while maintaining strong reconstruction and prediction performance. The panel shows the Schaefer 200 atlas (left), FC and node feature reconstructions for an example subject (centre), and the MLP’s prediction performance (right). <bold>b</bold>, Schematic of the hybrid model, where a new MLP is trained on drug condition, baseline clinical data, and the concatenated latent representations of the separately pretrained atlas-bound and <monospace>graphTRIP</monospace> models. <bold>c</bold>, The hybrid model achieves the best prediction performance. <bold>d</bold>, Permutation importance analysis shows that <monospace>graphTRIP</monospace>’s latent features contribute significantly more to predictions than those of the atlas-bound model.</p></caption><graphic xlink:href="EMS207077-f003"/></fig><fig id="F4" position="float"><label>Fig. 4</label><caption><title>Transfer learning enables generalisation to an independent dataset.</title><p><bold>a</bold>, A modified <monospace>graphTRIP</monospace> model was pretrained on the primary dataset, excluding from the MLP variables not available in the validation dataset. The pre-trained model was then fine-tuned on the validation dataset, training only the MLP and freezing the VGAE. <bold>b</bold>, Correlations between original and reconstructed FC and node features across all patients. <bold>c</bold>, True vs. predicted QIDS scores using the mean prediction across six fine-tuned models. <bold>d</bold>, Training 50 randomly initialised <monospace>graphTRIP</monospace> models, or 50 MLPs trained on demographic and clinical data, fails due to the small validation sample size. In contrast, all six pretrained models produce positive true-vs-predicted correlations before fine-tuning, and most achieve significance after fine-tuning.</p></caption><graphic xlink:href="EMS207077-f004"/></fig><fig id="F5" position="float"><label>Fig. 5</label><caption><title>Interpretability analysis reveals unique role of unimodal brain regions and population subtypes.</title><p><bold>a</bold>, Population-mean attention weights from the VGAE readout reveal a structured pattern. <bold>b</bold>, Relative contributions of normative molecular target densities and unimodal-transmodal axis assignments to a linear model for explaining population-mean attention weights (<italic>r</italic> = 0.8782, <italic>p</italic> &lt; 10<sup>−4</sup>). <bold>c</bold>, Mean attention weights within each resting-state network (RSN) for each patient, showing highest values in sensory-motor networks. <bold>d</bold>, Attention shifts from VIS and SMN regions to FPN, DMN, and LIM regions when the model predicts treatment response under psilocybin versus escitalopram. Dots represent per-patient RSN mean attention differences (psilocybin minus escitalopram); asterisks indicate significant shifts after FDR correction (‘*’: <italic>p</italic> &lt; 0.05, ‘**’: <italic>p</italic> &lt; 0.01, ‘***’: <italic>p</italic> &lt; 0.001). <bold>e</bold>, Resting-state networks. <bold>f</bold>, GRAIL method overview. By computing latent gradients of predicted outcomes (<italic>ŷ</italic>) and candidate biomarkers (<italic>b</italic>), GRAIL quantifies learned associations between biomarkers and treatment response. <bold>g</bold>, GRAIL results across patients (rows), treated with psilocybin (P) or escitalopram (E), showing universal and subtype-specific biomarkers of treatment responsiveness. Biomarker labels are defined in Tab. I.</p></caption><graphic xlink:href="EMS207077-f005"/></fig><fig id="F6" position="float"><label>Fig. 6</label><caption><title>Causal inference via <monospace>X-graphTRIP</monospace> predicts individual treatment effects (ITEs) and reveals treatment-specific moderators.</title><p><bold>a</bold>, Schematic of the X-learner framework [<xref ref-type="bibr" rid="R34">34</xref>], used to extend <monospace>graphTRIP</monospace> with causal inference, resulting in <monospace>X-graphTRIP</monospace>. <bold>b</bold>, <monospace>X-graphTRIP</monospace> learns a smooth ITE function, with predicted ITEs significantly correlated with pseudo-labels. <bold>c</bold>, Most patients are predicted to benefit more from psilocybin than escitalopram, with an average treatment effect (ATE) of − 1.34 <italic>±</italic> 0.39 SEM. <bold>d</bold>, Performance-weighted mean attention weights are highest in VIS and LIM regions. <bold>e</bold>, Performance-weighted mean alignments of robust biomarkers for all patients. Models that learn these biomarkers generalise significantly better, suggesting they reflect true treatment-specific moderators.</p></caption><graphic xlink:href="EMS207077-f006"/></fig><table-wrap id="T1" orientation="portrait" position="float"><label>Table I</label><caption><title>Candidate biomarkers tested with GRAIL.</title><p>*The 10 targets were normative maps of serotonin targets 5-HT1A, 5-HT2A, 5-HTT, 5-HT1B, 5-HT4; dopamine receptors D1, D2, and transporter DAT; noradrenaline transporter NAT; and vesicular acetylcholine transporter VAChT. Densities were derived from open-access PET scan data of healthy subjects [<xref ref-type="bibr" rid="R20">20</xref>, <xref ref-type="bibr" rid="R42">42</xref>]. Note: we excluded correlations between REACT node features and molecular maps for 5-HT1A, 5-HT2A, 5-HTT, because these maps were used to compute the REACT features themselves, making such relationships difficult to interpret.</p></caption><table frame="hsides" rules="groups"><thead><tr><th valign="top" align="left" style="border-top: 1px solid #000000">Description</th><th valign="top" align="left" style="border-top: 1px solid #000000">Example</th></tr></thead><tbody><tr><td valign="top" align="left" style="border-top: 1px solid #000000">FC modularity based on Louvain or RSN partition</td><td valign="top" align="left" style="border-top: 1px solid #000000">modularity, modularity_rsn</td></tr><tr><td valign="top" align="left">Mean FC of all edges attached to an RSN</td><td valign="top" align="left">FC_mean_VIS</td></tr><tr><td valign="top" align="left">Mean REACT node feature in an RSN</td><td valign="top" align="left">R5-HT1A_mean_VIS, R5-HT2A_mean_SMN</td></tr><tr><td valign="top" align="left">Correlation of regional FC with 10 target* densities</td><td valign="top" align="left">FC_corr_D2, FC_corr_5-HT1A</td></tr><tr><td valign="top" align="left">Correlation of REACT node features with 7 target* densities</td><td valign="top" align="left">R5-HT2A_corr_5-HT4, R5-HTT_corr_D2</td></tr><tr><td valign="top" align="left" style="border-bottom: 1px solid #000000">Pairwise correlations of REACT node features</td><td valign="top" align="left" style="border-bottom: 1px solid #000000">R5-HT1A_corr_R5-HT2A,R5-HT2A_corr_R5-HTT</td></tr></tbody></table></table-wrap></floats-group></article>