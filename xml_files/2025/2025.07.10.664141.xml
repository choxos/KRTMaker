<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="epub">2692-8205</issn></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS207296</article-id><article-id pub-id-type="doi">10.1101/2025.07.10.664141</article-id><article-id pub-id-type="archive">PPR1051755</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Kandinsky: enabling neighbourhood analysis of spatial omics data for functional insights on cell ecosystems</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Andrei</surname><given-names>Pietro</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Grieco</surname><given-names>Mariachiara</given-names></name><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Acha-Sagredo</surname><given-names>Amelia</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Dhami</surname><given-names>Pawan</given-names></name><xref ref-type="aff" rid="A5">5</xref></contrib><contrib contrib-type="author"><name><surname>Fung</surname><given-names>Kathy</given-names></name><xref ref-type="aff" rid="A5">5</xref></contrib><contrib contrib-type="author"><name><surname>Rodriguez-Justo</surname><given-names>Manuel</given-names></name><xref ref-type="aff" rid="A6">6</xref></contrib><contrib contrib-type="author"><name><surname>Cereda</surname><given-names>Matteo</given-names></name><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref><xref ref-type="fn" rid="FN1">7</xref></contrib><contrib contrib-type="author" corresp="yes"><name><surname>Ciccarelli</surname><given-names>Francesca D.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref><xref ref-type="aff" rid="A3">3</xref><xref ref-type="fn" rid="FN1">7</xref><xref ref-type="fn" rid="FN2">8</xref></contrib></contrib-group><aff id="A1"><label>1</label>Centre for Evolution, Bart’s Cancer Institute, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/026zzn846</institution-id><institution>Queen Mary University London</institution></institution-wrap>, <city>London</city><postal-code>EC1M 6AU</postal-code>, <country country="GB">UK</country></aff><aff id="A2"><label>2</label>Cancer Systems Biology Laboratory, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/04tnbqb63</institution-id><institution>The Francis Crick Institute</institution></institution-wrap>, <city>London</city><postal-code>NW1 1AT</postal-code>, <country country="GB">UK</country></aff><aff id="A3"><label>3</label>Department of Oncology and Hemato-Oncology, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/00wjc7c48</institution-id><institution>Università Statale di Milano</institution></institution-wrap>, <city>Milan</city>, <country country="IT">Italy</country></aff><aff id="A4"><label>4</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/036054d36</institution-id><institution>Italian Institute for Genomic Medicine</institution></institution-wrap>, c/o <institution-wrap><institution-id institution-id-type="ror">https://ror.org/04tfzc498</institution-id><institution>IRCCS</institution></institution-wrap>, <city>Candiolo</city>, <state>Turin</state>, <country country="IT">Italy</country></aff><aff id="A5"><label>5</label>Genomics Research Platform and Single Cell Laboratory at <institution-wrap><institution-id institution-id-type="ror">https://ror.org/00j161312</institution-id><institution>Guy’s and St Thomas’ NHS Foundation Trust</institution></institution-wrap>, <city>London</city>, <country country="GB">UK</country></aff><aff id="A6"><label>6</label>Department of Research Pathology, Cancer Institute, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/02jx3x895</institution-id><institution>University College London</institution></institution-wrap>, <city>London</city>, <country country="GB">United Kingdom</country></aff><author-notes><corresp id="CR1">Corresponding author: <email>francesca.ciccarelli@crick.ac.uk</email> ; <email>f.ciccarelli@qmul.ac.uk</email>
</corresp><fn id="FN1"><label>7</label><p id="P1">= Senior authors</p></fn><fn id="FN2"><label>8</label><p id="P2">= Lead author</p></fn></author-notes><pub-date pub-type="nihms-submitted"><day>17</day><month>07</month><year>2025</year></pub-date><pub-date pub-type="preprint"><day>16</day><month>07</month><year>2025</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P3">Spatially resolved omics technologies enable investigation of how cells interact within their local environments or neighbourhoods directly <italic>in situ</italic>. Although a few computational methods have been developed to aid this analysis, significant limitations still exist in the way neighbourhoods are defined and exploited for downstream analyses. Here, we present Kandinsky, a computational tool that implements multiple approaches for neighbourhood identification, enabling high flexibility and versatility to address a variety of biological questions. Once identified, Kandinsky applies neighbourhoods for downstream studies, including proximity-based cell grouping for functional comparisons, spatial co-localisation and dispersion, and identification of hot and cold expression areas within the tissue. We apply Kandinsky to transcriptomic and proteomic data from different spatial technologies to showcase how it can reveal functional interactions between cells across multiple biological contexts.</p><sec id="S1"><title>Availability and implementation</title><p id="P4">Kandinsky is freely available as an R package at <ext-link ext-link-type="uri" xlink:href="https://github.com/ciccalab/Kandinsky">https://github.com/ciccalab/Kandinsky</ext-link>.</p></sec></abstract><kwd-group><kwd>Spatial biology</kwd><kwd>cell neighbourhoods</kwd><kwd>transcriptomics</kwd><kwd>proteomics</kwd><kwd>sequencing</kwd><kwd>imaging</kwd><kwd>data analysis</kwd></kwd-group></article-meta></front><body><sec id="S2" sec-type="intro"><title>Introduction</title><p id="P5">Recent technological developments in high dimensional spatial biology open new opportunities to study cell properties and interactions <italic>in situ</italic> at unprecedented levels of resolution and throughput. Spatial proteomic approaches such as imaging mass cytometry (IMC)(<xref ref-type="bibr" rid="R18">Giesen, et al., 2014</xref>) and CODEX(<xref ref-type="bibr" rid="R19">Goltsev, et al., 2018</xref>) (now PhenoCycler(<xref ref-type="bibr" rid="R57">Taube, et al., 2021</xref>)) were the first to enable quantification of tens of proteins at micro or nano scale using metal-tagged or fluorescent markers. Imaging-based spatial transcriptomic technologies such as MERSCOPE(<xref ref-type="bibr" rid="R39">Moffitt, et al., 2018</xref>), CosMx(<xref ref-type="bibr" rid="R22">He, et al., 2022</xref>), or Xenium(<xref ref-type="bibr" rid="R26">Janesick, et al., 2023</xref>) simultaneously track the spatial location of RNAs from hundreds or thousands of genes. Sequencing-based approaches such as Slide-Seq(<xref ref-type="bibr" rid="R55">Stickels, et al., 2021</xref>), Visium(<xref ref-type="bibr" rid="R54">Stahl, et al., 2016</xref>), and Visium-HD(<xref ref-type="bibr" rid="R41">Nagendran, et al., 2023</xref>) detect the whole-transcriptome within capture areas or spots of variable size returning different levels of spatial resolutions. Most recent platforms such as COMET(<xref ref-type="bibr" rid="R47">Rivest, et al., 2023</xref>) or G4X(<xref ref-type="bibr" rid="R38">Maurer, et al., 2025</xref>) even enable quantification of both transcripts and proteins from the same cells.</p><p id="P6">In parallel with technological advances, several computational tools have been adapted from single cell analysis or developed <italic>ex novo</italic> for spatial data to enable cell segmentation(<xref ref-type="bibr" rid="R27">Jones, et al., 2024</xref>; <xref ref-type="bibr" rid="R45">Polanski, et al., 2024</xref>), deconvolution(<xref ref-type="bibr" rid="R30">Kleshchevnikov, et al., 2022</xref>; <xref ref-type="bibr" rid="R36">Mages, et al., 2023</xref>), and phenotyping(<xref ref-type="bibr" rid="R12">Danaher, et al., 2022</xref>; <xref ref-type="bibr" rid="R33">Lee, et al., 2025</xref>; <xref ref-type="bibr" rid="R52">Singhal, et al., 2024</xref>), as well as infer cell-cell communication(<xref ref-type="bibr" rid="R5">Armingol, et al., 2024</xref>; <xref ref-type="bibr" rid="R9">Cang, et al., 2023</xref>; <xref ref-type="bibr" rid="R60">Zhu, et al., 2024</xref>). One of the main advances introduced by spatial approaches is the opportunity to investigate how cells interact <italic>in situ</italic> within the local neighbourhood constituted by their proximal cell environment. Neighbourhood analysis has been used to evaluate cell co-localisation or dispersion of cells within the tissue(<xref ref-type="bibr" rid="R3">Agrawal, et al., 2024</xref>; <xref ref-type="bibr" rid="R10">Chen, et al., 2023</xref>; <xref ref-type="bibr" rid="R31">Kojima, et al., 2024</xref>; <xref ref-type="bibr" rid="R32">Lafzi, et al., 2024</xref>; <xref ref-type="bibr" rid="R35">Liu, et al., 2024</xref>; <xref ref-type="bibr" rid="R43">Palla, et al., 2022</xref>; <xref ref-type="bibr" rid="R58">Varrone, et al., 2024</xref>), map gene co-expression patterns in space(<xref ref-type="bibr" rid="R40">Moses, et al., 2023</xref>; <xref ref-type="bibr" rid="R59">Withnell and Secrier, 2024</xref>), and identify local clusters based on cell composition(<xref ref-type="bibr" rid="R10">Chen, et al., 2023</xref>; <xref ref-type="bibr" rid="R13">Ding, et al., 2025</xref>; <xref ref-type="bibr" rid="R15">Feng, et al., 2023</xref>; <xref ref-type="bibr" rid="R32">Lafzi, et al., 2024</xref>; <xref ref-type="bibr" rid="R35">Liu, et al., 2024</xref>; <xref ref-type="bibr" rid="R58">Varrone, et al., 2024</xref>).</p><p id="P7">An additional aspect that is currently only partially explored by available analytical approaches is how the local neighbourhood affects the cell phenotype. Some approaches enable functional comparisons between cell types grouped according to the presence or absence of another cell type within the same neighbourhood(<xref ref-type="bibr" rid="R29">Kim, et al., 2023</xref>; <xref ref-type="bibr" rid="R37">Mason, et al., 2024</xref>), while others restrict this comparisons to gene expression programmes pre-inferred from the data(<xref ref-type="bibr" rid="R3">Agrawal, et al., 2024</xref>). However, the flexibility in defining the cell of interests, their neighbours, or the downstream analyses is still limited.</p><p id="P8">To overcome these limitations we developed Kandinsky, an R package that implements several approaches for cell or spot neighbourhood identification and analysis, including supervised and unsupervised clustering for downstream functional investigations, spatial co-localisation or dispersion, and detection of patterns of high or low gene expression within the tissue. Here, we describe its implementation and provide examples of how Kandinsky can be used to address a variety of scientific questions in different biological contexts.</p></sec><sec id="S3" sec-type="methods"><title>Methods</title><sec id="S4"><title>Kandinsky data structure and initialization</title><p id="P9">Kandinsky implements R object-oriented programming defined by an S4 class with 11 components. These components store information regarding c/s-NBs identity, cell/spot polygons, c/s-NB definition, c/s-NBs composition, fixed spot distance (spot data), transcript and FOV coordinates (cell data), texture features of Haematoxylin &amp; Eosin (H&amp;E) staining and tissue slide images.</p><p id="P10">Class construction is implemented in two steps. First, Kandinsky exploits a set of platform-specific <italic>prepare_seurat</italic> functions which read raw data files from different spatial technologies to initialize a Seurat object. Second, the <italic>kandinsky_init</italic> function creates the object that is stored within the object containing polygon, neighbour and image data associated with the spatial dataset. If a Seurat object has been already created prior to Kandinsky, <italic>kandinsky_init</italic> can still be called if all the required input files are provided. The final output is an updated version of the input Seurat object with the new Kandinsky object stored as a ‘tools’ slot. (<xref ref-type="fig" rid="F1">Figure 1A</xref>).</p><p id="P11">The <italic>kandinsky_init</italic> function uses cell or spot coordinates to derive cell or spot polygons and identify c/s-NBs relying on R packages sf(<xref ref-type="bibr" rid="R44">Pebesma, 2018</xref>), spdep(<xref ref-type="bibr" rid="R7">Bivand, 2018</xref>) and tripack(<xref ref-type="bibr" rid="R16">Gebhardt, 2024</xref>) based on five neighbouring methods (<xref ref-type="fig" rid="F1">Figure 1B</xref>): <list list-type="simple" id="L1"><list-item><label>(1)</label><p id="P12">KNN (based on spdep <italic>knearneigh</italic> function), whereby neighbouring cells are selected as the top user-defined k nearest cells;</p></list-item><list-item><label>(2)</label><p id="P13">centroid distance (based on spdep <italic>dnearneigh</italic> function), whereby cells or spots with centroids closer than a user-defined distance are considered within the same c/s-NB;</p></list-item><list-item><label>(3)</label><p id="P14">Delaunay triangulation (based on tripack <italic>tri.mesh</italic> function), whereby c/s-NBs are the edges of a network of triangle whose nodes are cells or spots;</p></list-item><list-item><label>(4)</label><p id="P15">queen contiguity (spot data only, based on spdep <italic>poly2nb</italic> function), whereby s-NBs are defined as the top user-defined number of layers of surrounding spots;</p></list-item><list-item><label>(5)</label><p id="P16">membrane distance (cell data only), whereby cells with membranes closer than a user-defined distance are considered within the same c-NB. Membrane distances are measured by expanding single-cell boundaries using the <italic>st_buffer</italic> function of a radius <italic>r</italic> calculated as</p></list-item></list> <disp-formula id="FD1"><mml:math id="M1"><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mi>d</mml:mi><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p id="P17">where <italic>d</italic> is the user-defined distance.</p><p id="P18">Neighbours of each cell are identified by checking the intersection between the expanded single-cell boundaries using the sf <italic>st_intersects</italic> function.</p><p id="P19">For Visium and Visium HD technology, H&amp;E images are loaded as raster objects using the R package terra(<xref ref-type="bibr" rid="R23">Hijmans, 2025</xref>) and aligned to spot coordinates. The resulting list of polygon, c/s-NB, and image objects are assembled into the class as slots, stored as a tool slot within the previously initialised Seurat object and used as input for downstream analysis.</p></sec><sec id="S5"><title>Cell, spot, and c/s-NB grouping</title><p id="P20">Input for this analysis are c/s-NBs and an external annotation of cell or spot types used by the <italic>nnMat</italic> function to generate a c/s-NB composition matrix reporting the count of cell or spot types neighbouring each cell or spot across all c/s-NBs (<xref ref-type="fig" rid="F1">Figure 1C</xref>). This matrix is then used to derive cell, spot or c/s-NB groups.</p><p id="P21">For cells and spots, the <italic>nn_query</italic> function is used to derive groups based on user-defined criteria (supervised approach) and perform an optional differential gene expression analysis via the internal call of the <italic>FindMarkers</italic> function.</p><p id="P22">For c/s-NBs, the <italic>nbCluster</italic> function performs c/s-NB grouping via unsupervised clustering based on composition similarity using the R package mclust(<xref ref-type="bibr" rid="R50">Scrucca, 2023</xref>). Users can specify different configurations for the number of clusters to test. For each configuration, the Bayesian Information Criterion (BIC) is evaluated and the cluster configuration with the lowest BIC value is chosen as optimal. Groups will be stored in the metadata and in the sf data slot of the object.</p></sec><sec id="S6"><title>Analysis of cell or spot co-localisation and dispersion</title><p id="P23">Input for this analysis are c/s-NBs and an external annotation of cell or spot types used by the <italic>jc_coloc</italic> function that implements the multi-class join count statistics(<xref ref-type="bibr" rid="R53">SOKAL and ODEN, 1978</xref>) as defined in the joincount.multi function from the <italic>spdep</italic> package(<xref ref-type="bibr" rid="R7">Bivand, 2018</xref>) (<xref ref-type="fig" rid="F1">Figure 1D</xref>). The function calculates the number of observed and expected neighbours between each cell or spot type pairs (join counts, <italic>J</italic>) given the overall neighbour composition and under the null hypothesis of random distribution of cell or spot types in the tissue. Then it evaluates if each join occurs by chance by measuring a z-score <italic>z</italic> as: <disp-formula id="FD2"><mml:math id="M2"><mml:mrow><mml:mi>z</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msqrt><mml:mrow><mml:mi>V</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p id="P24">where <italic>J</italic><sub><italic>obs</italic></sub> and <italic>J</italic><sub><italic>exp</italic></sub> is the observed and expected number of join counts, respectively.</p><p id="P25">Positive z-score values indicate spatial co-localisation. Negative z-score values indicate spatial dispersion. Additionally, the observed-to-expected ratio <italic>r</italic> of join counts is calculated as: <disp-formula id="FD3"><mml:math id="M3"><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p id="P26">The numerical values of z-scores <italic>z</italic> and their ratio are stored in a tabular format and visualised as a heatmap.</p></sec><sec id="S7"><title>Hot/cold expression areas</title><p id="P27">Input for this analysis are c/s-NBs and gene, protein, or gene signature expression values used by the <italic>hotspot_analysis</italic> function to classify cells or spots based on Getis-Ord Gi statistics calculated for each cell or spot using the <italic>localG_perm</italic> function of the spdep package(<xref ref-type="bibr" rid="R7">Bivand, 2018</xref>) (<xref ref-type="fig" rid="F1">Figure 1E</xref>). Getis-Ord Gi statistics estimates the tendency of cells or spots within the same c/s-NB to express a gene, protein, or signature at significantly higher or lower values than the other cells or spots given the overall c/s-NB composition(<xref ref-type="bibr" rid="R42">Ord, 1995</xref>). For each cell or spot <italic>i</italic>, the Getis-Ord Gi statistics is calculated as: <disp-formula id="FD4"><mml:math id="M4"><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mo>−</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo stretchy="true">¯</mml:mo></mml:mover></mml:mrow></mml:mstyle></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msqrt><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo>≠</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:math></disp-formula></p><p id="P28">given: <disp-formula id="FD5"><mml:math id="M5"><mml:mrow><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:msubsup><mml:mi>x</mml:mi><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mstyle></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>−</mml:mo><mml:msup><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msqrt></mml:mrow></mml:math></disp-formula></p><p id="P29">where <italic>w</italic><sub><italic>ij</italic></sub> is the spatial weight between the cell or spot of interest <italic>i</italic> and any other cell spot <italic>j</italic> within the corresponding c/s-NBs, <italic>x</italic><sub><italic>j</italic></sub> is the expression value of the variable of interest in any cell or spot <italic>j</italic> within the c/s-NBs, <inline-formula><mml:math id="M6"><mml:mrow><mml:mover accent="true"><mml:mtext>x</mml:mtext><mml:mo stretchy="true">¯</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> is the mean expression of the variable of interest across all cells or spots, <italic>s</italic> is the standardized difference between observed and expected expression values across neighbours, and <italic>n</italic> is the total number of cells or spots considered.</p><p id="P30">Statistical significance is assessed by comparing each observed value to the expected one calculated after randomly reshuffling expression values across all cells or spots via permutations test. An empirical p-value is calculated using the spdep <italic>localG_perm</italic> function for each cell or spot as: <disp-formula id="FD6"><mml:math id="M7"><mml:mrow><mml:mi>p</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>∗</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mstyle mathsize="140%" displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>G</mml:mi><mml:msub><mml:mi>i</mml:mi><mml:mrow><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mo>&gt;</mml:mo><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>G</mml:mi><mml:msub><mml:mi>i</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>b</mml:mi><mml:mi>s</mml:mi><mml:mspace width="0.2em"/></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p id="P31">where <italic>Gi</italic><sub>exp</sub> and <italic>Gi</italic><sub><italic>obs</italic></sub> are the expected and observed Getis-Ord Gi statistics, respectively, and <italic>N</italic> is the number of permutations. Empirical p-values are corrected for multiple testing using Benjamini-Hochberg. Cells or spots associated with a positive or negative Getis-Ord Gi statistics and an FDR lower than a user-defined threshold are classified as hot and cold areas, respectively.</p></sec><sec id="S8"><title>Additional functions</title><p id="P32">In addition to neighbourhood-based analysis, Kandinsky implements additional function to facilitate spatial data analysis. These include: <list list-type="simple" id="L2"><list-item><label>(1)</label><p id="P33"><italic>get_visium_textures</italic> function to extract texture features from H&amp;E images associated with Visium and Visium HD data. The R package GLCMTextures(<xref ref-type="bibr" rid="R25">Ilich, 2025</xref>) is internally used to calculate grey-level co-occurrence matrix texture metrics across pixels. Pixel metrics are then aggregated at the spot level. The output is a spot-metrics matrix stored as slot of the Kandinsky object, with each metrics summarised as mean pixel-level values observed for each spot;</p></list-item><list-item><label>(2)</label><p id="P34"><italic>he_mask</italic> function to perform automatic tissue masking from H&amp;E images given a pixel filtering threshold specified via ‘sd_thresh’ paremeter;</p></list-item><list-item><label>(3)</label><p id="P35"><italic>global_univ_spatcor</italic> and <italic>global_biv_spatcor</italic> functions to calculate univariate and bivariate spatial correlation coefficients, respectively, for any list of genes or proteins specified by the user;</p></list-item><list-item><label>(4)</label><p id="P36"><italic>stitch_samples</italic> function to merge independent samples into a regular grid and create a common coordinate system.</p></list-item></list>
</p></sec><sec id="S9"><title>CosMx normal pancreas dataset</title><p id="P37">CosMx Human Whole Transcriptome dataset and annotation file of a human pancreas sample was downloaded from the NanoString website(<xref ref-type="bibr" rid="R6">Biology, 2024</xref>). The <italic>prepare_cosmx_seur</italic>at and <italic>kandinsky_init</italic> functions were used to initialize a Seraut object with CosMx raw data. c-NBs were defined during initialization using the membrane distance method (‘nb.method=M’ and ‘d.max’ = 0). The <italic>nnMat</italic> and <italic>nn_query</italic> functions were used to (1) build the c-NB composition matrix with CosMx cell type annotation as reference and (2) separate acinar cells into peri-islet and non peri-islet cells based on the presence or absence of islet cells within the same c-NB. Expression profiles of the two acinar cell groups were compared via differential gene expression analysis using <italic>FindMarkers</italic> directly called via the <italic>nn_query</italic> function. Differentially expressed genes were defined as fold change &gt;1.1 or &lt;0.9 and FDR &lt;0.01 (Bonferroni correction). Genes expressed in &lt;20% of peri-islet acinar cells and &lt;5% of non peri-islet acinar cells were excluded to avoid possible contamination.</p></sec><sec id="S10"><title>IMC PDAC dataset</title><p id="P38">A Seurat object containing all cell measurements and metadata for all IMC regions of interest (ROIs) was downloaded from the Zenodo website(<xref ref-type="bibr" rid="R56">Sussman, et al., 2024</xref>). Cell centroid coordinates from independent ROIs were shifted and merged into a unique coordinate system using the <italic>stitch_samples</italic> function. Following the original methods(<xref ref-type="bibr" rid="R56">Sussman, et al., 2024</xref>), a Seurat object was initialized with the <italic>kandinsky_init</italic> function and c-NBs were defined using KNN method (‘nb.method=K’ and ‘k’=20). The <italic>nbCluster</italic> function was then used to group c-NBs across samples, setting the expected number of groups as in the original publication(<xref ref-type="bibr" rid="R56">Sussman, et al., 2024</xref>) (‘n_clust’ = 10). Enrichment of PDAC cell types or spatial niches in c-NB groups was tested using Fisher’s test corrected for multiple testing with Benjamini- Hochberg correction.</p></sec><sec id="S11"><title>Xenium human breast cancer dataset</title><p id="P39">Xenium Prime 5K Human Pan Tissue and Pathways Panel data of a human breast cancer sample were downloaded from 10X website(<xref ref-type="bibr" rid="R17">Genomics, 2024</xref>). Raw Xenium data were loaded into R and used to create a Seurat object using the <italic>prepare_xenium_seurat</italic> function. Cells with &lt;25 transcripts and &lt;20 unique genes were excluded. A new Seurat object was initialized with the <italic>kandinsky_init</italic> function and c-NBs were defined using the cell centroid distance method (‘nb.method=C’ and ‘d.max’=40). For cell clustering, gene expression values were normalized with the <italic>NormalizeData</italic> function with default parameters, and the top 2000 variable genes were selected using the <italic>FindVariableFeatures</italic> function with default parameters. Based on these genes, the <italic>SketchData</italic> function was applied to select a subset of 75000 cells representative of the whole dataset. The top 2000 variable genes were re-selected within the sketched dataset. The <italic>ScaleData</italic> and <italic>RunPCA</italic> functions with default parameters were used to perform dimensionality reduction on the sketched dataset and the <italic>FindNeighbors</italic> and <italic>FindClusters</italic> functions (‘dims’ = 1:50 and ‘res’ = 1.2) were used to identify cell clusters. Uniform manifold approximation and projection (UMAP) was created using the <italic>RunUMAP</italic> function (‘dims’ = 1:50, ‘return.model’ = T). Single cells excluded from sketching were mapped onto the sketched dimensional reduction results using the <italic>ProjectData</italic> function. Cell type annotation for each cluster was manually curated based on the top differentially expressed genes (FC &gt;1.5 and FDR &lt;0.05) identified using the <italic>FindAllMarkers</italic> function.</p><p id="P40">Co-localisation and dispersion of cell types in the tissue were assessed via multi-class join count statistics using the <italic>jc_coloc</italic> function. Differential gene expression analysis between tumour 5 and 6 cells and the rest of tumour cells was performed using Seurat <italic>FindMarkers</italic> function for all genes expressed in ≥1% of tumour 5 and 6 cells with default parameters. Obtained log2 FC values were used to perform ranked gene set enrichment analysis (GSEA) using the R package fgsea v1.28.0(<xref ref-type="bibr" rid="R51">Sergushichev, 2016</xref>).</p></sec><sec id="S12"><title>CosMx human CRC dataset</title><p id="P41">CosMx raw data and cell annotations of CRC sample CR48 were downloaded from the Zenodo website(<xref ref-type="bibr" rid="R1">Acha-Sagredo, et al., 2025</xref>). Raw files were loaded into R and used to create a Seurat object with the <italic>prepare_cosmx_seurat</italic> function. A new Seurat object was initialized with the <italic>kandinsky_init</italic> function and c-NBs were defined using the cell membrane distance distance (‘nb.method=“M“’ and ‘d.max’=30). Gene expression levels were normalized using <italic>NormalizeData</italic> function.</p><p id="P42">Hot and cold areas for <italic>CD74</italic> gene expression were derived using the <italic>hotspot_analysis</italic> function to measure the Getis-Ord Gi statistics and statistical significance with 999 permutations (‘perm’ = 999 and ‘padj.thresh’ = 0.05). Enrichment of TAMs, CRC and T/NK cells within <italic>CD74</italic> hot and cold areas was tested using one-tailed Fisher’s exact test.</p><p id="P43">To assess the effect of T/NK cell proximity on <italic>CD74</italic> expression in CRC cells, the <italic>nnMat and nn_query</italic> functions were run to define the contribution of CRC cell types within each c-NB and group CRC cells based on the presence or absence of T/NK cells within the c-NBs. <italic>CD74</italic> expression between CRC cells proximal to T/NK cells and the rest was compared using two-tailed Wilcoxon’s rank-sum test.</p></sec><sec id="S13"><title>Visium CRC data generation and analysis</title><p id="P44">A 5um section was cut from the FFPE block of CRC sample CR48 and placed within the 6x6mm<sup>2</sup> fiducial frame of the Visium slide. The slide was then incubated at 42 °C for 3h, deparaffinized, H&amp;E stained and imaged using an Olympus VS200 slide scanner. Once imaged, the coverslip was removed, and the slide was decrosslinked. Visium Human Transcriptome Probe kit (v1, PN-1000363) was used for transcript hybridisation. Hybridised RNA molecules were released after tissue permeabilization and captured within each spot by barcoded oligonucleotides. Captured RNA molecules were used for sequencing library preparation and sequenced using NextSeq2000 with a sequencing depth of ≥25000 reads per tissue covered spot.</p><p id="P45">Visium FASTQ files were processed using the 10X Genomics spaceranger v2.0 software to derive raw gene expression count data. Visium gene expression data were imported in R using Seurat(<xref ref-type="bibr" rid="R21">Hao, et al., 2024</xref>). Spots matching with empty regions within the tissue slides annotated using the 10X Genomics Loupe Browser v6.2.0 software and those with &lt;500 transcripts and 300 unique genes were excluded. Genes expressed in less than 10 Visium spots were also removed. Visium raw counts were normalized using the <italic>NormalizeData</italic> function. A new Seurat object was initialized with the <italic>kandinsky_init</italic> function. s-NBs were defined using the queen contiguity method (‘nb.method=“Q“’) and the <italic>nb_expand</italic> function to add the second closest spot layer.</p><p id="P46">Gene expression scores for the seven immune gene signatures (M0-27, CXCL10/TAM-16, CD209/TAM-13, T-8, CD4-17, Cytotoxic-23, NK-33)(<xref ref-type="bibr" rid="R1">Acha-Sagredo, et al., 2025</xref>) were calculated and smoothed across spots using the UCell(<xref ref-type="bibr" rid="R4">Andreatta and Carmona, 2021</xref>) <italic>AddModuleScore_UCell</italic> (‘maxRank=5000’) and <italic>SmoothKNN</italic> (‘k’ = 20) functions, respectively. Hot and cold areas for the immune signatures and <italic>CD74</italic> gene were defined using the <italic>hotspot_analysis</italic> function as described above. Enrichment of immune signatures within <italic>CD74</italic> hot and cold areas was tested via one-tailed Fisher exact test and corrected for multiple testing with Benjamini-Hochberg method.</p></sec></sec><sec id="S14" sec-type="results"><title>Results</title><sec id="S15"><title>Kandinsky overview</title><p id="P47">Kandinsky is an R package for neighbourhood analysis of spatial omics data. Compared to available approaches, it shows higher versatility in terms of type and resolution of input data, neighbour definition, and downstream analyses (Table S1).</p><p id="P48">Kandinsky uses cell or spot coordinates derived from any spatial transcriptomic or proteomic platform and implements helper functions to automate their loading and formatting into a Seurat object(<xref ref-type="bibr" rid="R21">Hao, et al., 2024</xref>) (<xref ref-type="fig" rid="F1">Figure 1A</xref>, <xref ref-type="sec" rid="S3">Methods</xref>). It then defines cell or spot neighbourhoods (c/s-NBs) according to the spatial relationships between cells or spots as inferred with five methods: k-nearest neighbours (KNN), centroid distance, Delaunay triangulation, queen contiguity, and membrane distance (<xref ref-type="fig" rid="F1">Figure 1B</xref>). KNN, centroid distance and Delaunay triangulation are applicable to both cell and spot data. Queen contiguity and membrane distance are limited to spot and cell data, respectively. Once defined, c/s-NBs can be used together with cell or spot type annotation and expression values to (a) group cells, spots, or c/s-NBs based on user-defined similarity or proximity criteria (<xref ref-type="fig" rid="F1">Figure 1C</xref>), (b) measure cell or spot co-localisation or dispersion in space (<xref ref-type="fig" rid="F1">Figure 1D</xref>) and (c) derive hot and cold expression areas within the tissue (<xref ref-type="fig" rid="F1">Figure 1E</xref>).</p><p id="P49">Cells, spots, or c/s-NBs can be grouped based on a c/s-NB composition matrix derived by counting the number of cell or spot types neighbouring each cell or spot within the tissue (<xref ref-type="fig" rid="F1">Figure 1C</xref>). Cells or spots are then grouped following a user-defined supervised approach based on their neighbours, for example grouping epithelial cells surrounded only by other epithelial cells or immune cells proximal to a certain type of stromal cells. c/s-NBs are instead grouped with an unsupervised approach based on the similarity of their cell or spot composition. Once defined, groups of cells, spots, or c/s-NBs can be compared in terms of their functional features, for example global transcriptional profiles or expression levels of specific genes, proteins or signatures of interest. Additionally, their occurrence can be quantified and compared across samples or biological conditions.</p><p id="P50">Spatial co-localisation and dispersion measure the tendency of cells or spots of a given type to co-localise with or disperse from other cell or spot types (<xref ref-type="fig" rid="F1">Figure 1D</xref>). In this case, c/s-NBs are used to measure co-occurrence or dispersion between pairs of neighbouring cell or spot types using z-scores and associated observed-to-expected ratios derived using the multi-class join count statistics(<xref ref-type="bibr" rid="R53">SOKAL and ODEN, 1978</xref>) (<xref ref-type="sec" rid="S3">Methods</xref>).</p><p id="P51">Lastly, hot and cold areas identify regions of the tissues where genes, proteins or signatures of interest are expressed more or less than expected by chance (<xref ref-type="fig" rid="F1">Figure 1E</xref>). Here, c/s-NBs are used to detect areas of high or low expression levels across neighbouring cells using the Getis-Ord Gi statistics(<xref ref-type="bibr" rid="R42">Ord, 1995</xref>) and statistical significance is assessed with permutations (<xref ref-type="sec" rid="S3">Methods</xref>).</p><p id="P52">In addition to these three c/s-NB based analyses, Kandinsky implements additional functions to facilitate the analysis of spatial data, including extraction and masking of image texture features, global spatial correlation tests, and coordinate stitching across independent samples.</p></sec><sec id="S16"><title>Neighbours modify the phenotypes of healthy and pancreatic cancer cells</title><p id="P53">We applied Kandinsky to investigate how the local neighbourhood affects cell phenotypes in normal and cancerous human pancreas.</p><p id="P54">As a first case study, we analysed a CosMx single-cell whole-transcriptome dataset composed of 48951 normal pancreatic cells from a healthy donor(<xref ref-type="bibr" rid="R6">Biology, 2024</xref>). Based on the original annotation(<xref ref-type="bibr" rid="R6">Biology, 2024</xref>), we identified 12 cell types corresponding to major exocrine (acinar and ductal) and endocrine (islet) pancreatic cells, as well as stellate cells and macrophages (<xref ref-type="fig" rid="F2">Figure 2A</xref>). Experiments in mouse showed that acinar cells proximal to islets upregulate trypsin and other digestive enzymes(<xref ref-type="bibr" rid="R14">Egozi, et al., 2020</xref>) and undergo acinar-to-beta cell reprogramming(<xref ref-type="bibr" rid="R11">Dahiya, et al., 2024</xref>). We used Kandinsky to check whether acinar cells located within peri-islet neighbourhoods of human pancreatic tissues exhibit the same phenotype. First, we identified c-NBs composed of cells in physical contact with each other (membrane distance = 0, <xref ref-type="fig" rid="F1">Figure 1B</xref>). We then separated acinar cells in two groups: those in physical contact with at least one islet cell (532 peri-islet acinar cells) and those not in contact with islets (33465 non peri-islet acinar cells, <xref ref-type="fig" rid="F2">Figure 2B</xref>). Comparing the gene expression profiles between these two groups of acinar cells, we found 15 differentially expressed genes (<xref ref-type="fig" rid="F2">Figure 2C</xref>). Among these, digestion-associated genes, such as <italic>CTRB1/2, CPA1, CEL, PNLIPRP1</italic>, were significantly overexpressed in peri-islet acinar cells (<xref ref-type="fig" rid="F2">Figure 2C</xref>). These cells also showed significantly lower expression of acinar markers (<italic>REG1A</italic> and <italic>REG1B</italic>) and upregulation of insulin-sensitive (<italic>PDIA4, MT2A</italic> and <italic>MT1H/X</italic>) and pancreatic progenitor (<italic>GP2</italic>) genes (<xref ref-type="fig" rid="F2">Figure 2C</xref>) supporting their tendency to be reprogrammed into beta-like cells(<xref ref-type="bibr" rid="R11">Dahiya, et al., 2024</xref>). Therefore, direct <italic>in situ</italic> human tissue analysis confirmed islet-induced phenotypic changes in acinar cells.</p><p id="P55">As a second case study, we analysed an IMC spatial proteomic dataset composed of 144976 single cells from nine pancreatic ductal adenocarcinoma (PDAC) samples assayed with a panel of 26 metal-tagged antibodies(<xref ref-type="bibr" rid="R56">Sussman, et al., 2024</xref>). Applying KNN to derive neighbourhoods and k-means for clustering, the original study described ten distinct spatial niches(Sussman, et al., 2024) (<xref ref-type="fig" rid="F2">Figure 2D</xref>). We tested whether Kandinsky could detect similar or even better refined cell neighbourhoods. To define c-NBs, we applied KNN with the same neighbourhood size (k=20) of the original study and grouped these into ten groups using the built-in unsupervised model-based clustering function (<xref ref-type="sec" rid="S3">Methods</xref>). Overall, we found good concordance between cells assigned to the original spatial niches and newly detected c-NB groups (adjusted Rand index = 0.4, <xref ref-type="fig" rid="F2">Figure 2E</xref>). Four niches (endocrine, granulocyte, proliferating tumour, and stromal 2) showed significant overlap with only one c-NB group (<xref ref-type="fig" rid="F2">Figures 2F, G</xref>). For the remaining six niches, c-NB groups refined the original annotation. For instance, cells in the original tumour/ductal and tumour/stromal niches were reassigned to c-NB groups 5 and 6 (<xref ref-type="fig" rid="F2">Figures 2G</xref>). Enrichment analysis of cell types confirmed that c-NB group 5 was mostly composed of tumour cells, while c-NB group 6 of a variety of stromal and immune cells (<xref ref-type="fig" rid="F2">Figures 2H</xref>). Similarly, the vascular niche, which in the original study contained also a significant proportion of stromal cells and macrophages(<xref ref-type="bibr" rid="R56">Sussman, et al., 2024</xref>), was split into c-NB groups 7 (composed mostly of endothelial cells with a minor contribution of macrophages and stromal cells) and 8 (mostly macrophages and stomal cells with a minor contribution of endothelial cells, <xref ref-type="fig" rid="F2">Figures 2G,H</xref>). Finally, the original lymphoid niche was further split into c-NB groups 9 and 10 (<xref ref-type="fig" rid="F2">Figure 2G,H</xref>). Both c-NB groups were enriched in T cells, but group 9 showed a significant overrepresentation of B cells (<xref ref-type="fig" rid="F2">Figure 2I</xref>) while group 10 of macrophages (<xref ref-type="fig" rid="F2">Figure 2G,H</xref>). In all these examples, a more precise identification of cell populations within separate groups may improve to characterise their functional properties.</p></sec><sec id="S17"><title>Myoepithelial cells surround non-invasive cancer cells within the breast tissue</title><p id="P56">We tested Kandinsky to assess the tendency of cells to significantly co-localise or disperse in the tissue (<xref ref-type="fig" rid="F1">Figure 1D</xref>) using a single-cell spatial transcriptomic dataset from a stage II-A breast cancer sample profiled with the Xenium Prime 5K Human Panel(<xref ref-type="bibr" rid="R17">Genomics, 2024</xref>). After removing low-quality cells (<xref ref-type="sec" rid="S3">Methods</xref>), we performed unsupervised clustering of the 468583 remaining cells leading to the identification of 23 cell populations based on differentially expressed marker genes (<xref ref-type="fig" rid="F3">Figures 3A, B</xref>).</p><p id="P57">We used Kandinsky to define c-NBs according to a centroid distance of 40um (<xref ref-type="fig" rid="F1">Figure 1B</xref>), resulting in a median of 35 cells per c-NB (<xref ref-type="fig" rid="F3">Figures 3C</xref>). We then quantified the tendency of cells to significantly aggregate or disperse in the tissue using multi-class join count derived z-scores (<xref ref-type="fig" rid="F1">Figure 1D</xref>). As expected, immune cell populations tended to localise proximal to each other and to be separated from both tumour cells and, to a lower extent, the stromal compartment (<xref ref-type="fig" rid="F3">Figures 3D</xref>). Overall, tumour cells also tended to co-localise in the tissue space, except for a small population corresponding to 1.6% of all tumour cells that clustered away from anything else (tumour 7, <xref ref-type="fig" rid="F3">Figure 3D</xref>).</p><p id="P58">Interestingly, Kandinsky detected spatial co-localisation between myoepithelial cells (MECs) and two tumour clusters (tumour 5 and 6, <xref ref-type="fig" rid="F3">Figure 3D</xref>). In normal breast, MECs are known to protect the structure and integrity of epithelial cells(<xref ref-type="bibr" rid="R20">Gudjonsson, et al., 2005</xref>; <xref ref-type="bibr" rid="R48">Runswick, et al., 2001</xref>). In breast cancer, MECs act as a physical barrier against tumour cell invasion(<xref ref-type="bibr" rid="R2">Adriance, et al., 2005</xref>), and the structural integrity of MEC layer is associated with the risk of progression in patients with ductal carcinoma in situ(<xref ref-type="bibr" rid="R46">Risom, et al., 2022</xref>; <xref ref-type="bibr" rid="R49">Russell, et al., 2015</xref>). When inspecting the spatial organisation of MECs in the tissue, we observed that these cells formed a monolayer around duct-like structures formed of tumour 5 (<xref ref-type="fig" rid="F3">Figure 3E</xref>) and tumour 6 (<xref ref-type="fig" rid="F3">Figure 3F</xref>) cells. Compared to the other tumour cells, tumour 5 and 6 cells showed higher interferon response and reduced proliferation potential (<xref ref-type="fig" rid="F3">Figure 3G</xref>). Since MEC layers surrounding milk ducts are gradually lost during cancer progression as a consequence of the increase in cancer cell proliferation and spreading(<xref ref-type="bibr" rid="R24">Hu, et al., 2008</xref>), it is tempting to speculate that these tumour cells might have a limited invasive potential. This analysis shows how studying the spatial organisation of cell populations in the tissue can inform on functional phenotypes.</p></sec><sec id="S18"><title>CRC tissue areas enriched in lymphocytes and TAMs show high <italic>CD74</italic> expression</title><p id="P59">We recently showed that cytotoxic lymphocytes induce upregulation of interferon genes, including MHC class II invariant chain <italic>CD74</italic>, in tumour associated macrophages (TAMs) and colorectal cancer (CRC) cells(<xref ref-type="bibr" rid="R1">Acha-Sagredo, et al., 2025</xref>). This is clinically relevant because <italic>CD74</italic> is highly expressed in CRC patients that respond to treatment with immune checkpoint inhibitors(<xref ref-type="bibr" rid="R1">Acha-Sagredo, et al., 2025</xref>; <xref ref-type="bibr" rid="R8">Bortolomeazzi, et al., 2021</xref>; <xref ref-type="bibr" rid="R28">Kim, et al., 2024</xref>).</p><p id="P60">Using Kandinsky, we further analysed whether <italic>CD74</italic> expression levels correlate with the spatial localisation of cancer cells, TAMs and lymphocytes in a CRC sample profiled with the CosMx 1000 gene panel(<xref ref-type="bibr" rid="R1">Acha-Sagredo, et al., 2025</xref>). Following the original annotation(<xref ref-type="bibr" rid="R1">Acha-Sagredo, et al., 2025</xref>), we found five main cell clusters, corresponding to CRC, T/NK, plasma/B, myeloid, and stroma cells (<xref ref-type="fig" rid="F4">Figure 4A</xref>). We then identified c-NBs applying a cell membrane distance of 30um, which resulted in a median of 36 cells per c-NB (<xref ref-type="fig" rid="F4">Figure 4B</xref>). Finally, we applied Getis-Ord Gi statistics (<xref ref-type="fig" rid="F1">Figure 1E</xref>) on single cell <italic>CD74</italic> expression levels (<xref ref-type="fig" rid="F4">Figure 4C</xref>) to map <italic>CD74</italic> hot and cold areas within the sample (<xref ref-type="fig" rid="F4">Figure 4D</xref>).</p><p id="P61">To test the overlap between spatial localisation of CRC, myeloid and T/NK cells and <italic>CD74</italic> expression levels, we measured the relative enrichment of each cell population in <italic>CD74</italic> hot areas using one-tailed Fisher’s exact test. We found a significant enrichment of myeloid and T/NK cells in <italic>CD74</italic> hot areas (<xref ref-type="fig" rid="F4">Figure 4E</xref>), confirming that TAMs are the major source of <italic>CD74</italic> expression in the tumour stroma upon stimulation by interferon-producing lymphocytes(<xref ref-type="bibr" rid="R1">Acha-Sagredo, et al., 2025</xref>; <xref ref-type="bibr" rid="R8">Bortolomeazzi, et al., 2021</xref>). Unexpectedly, CRC cells showed no significant enrichment in <italic>CD74</italic> hot areas (<xref ref-type="fig" rid="F4">Figure 4E</xref>). We reasoned that this may be due to the fact that only CRC cells proximal to lymphocytes would co-localise within <italic>CD74</italic> high expression areas, since only these CRC cells overexpress <italic>CD74</italic> in response to IFN stimulation(<xref ref-type="bibr" rid="R1">Acha-Sagredo, et al., 2025</xref>). To test this hypothesis, we compared <italic>CD74</italic> expression between CRC cells in c-NBs also containing T/NK cells and those in c-NBs with no T/NK cells. We confirmed that CRC cells proximal to T/NK cells express significantly higher <italic>CD74</italic> levels than the rest of CRC cells (<xref ref-type="fig" rid="F4">Figure 4F</xref>), thus supporting the initial hypothesis.</p><p id="P62">Being based on 1000 genes only, the CosMx panel enabled broad separation of the main immune populations (<xref ref-type="fig" rid="F4">Figure 4A</xref>) but prevented further characterisation of relevant immune subpopulations associated with <italic>CD74</italic> hot and cold areas. To overcome this limitation, we profiled another tissue region of the same CRC sample using Visium whole transcriptomics approach (<xref ref-type="sec" rid="S3">Methods</xref>). After quality control and removal of low quality spots and genes, we mapped <italic>CD74</italic> expression levels across the retained 2955 spots (<xref ref-type="fig" rid="F4">Figure 4G</xref>). To define s-NBs, we used the queen contiguity approach (<xref ref-type="fig" rid="F1">Figure 1B</xref>) considering the first two contiguous layers surrounding each spot, resulting in a median of 17 spots per s-NB (<xref ref-type="fig" rid="F4">Figure 4H</xref>).</p><p id="P63">Like for the c-NBs analysis, we used s-NBs to identify <italic>CD74</italic> hot and cold areas using the Getis-Ord Gi statistics (<xref ref-type="fig" rid="F4">Figure 4I</xref>). Since the Visium technology does not provide single cell resolution, we could not assess the enrichment of TAM and lymphocyte sub-populations in <italic>CD74</italic> hot and cold areas directly. Instead, we used seven manually curated gene signatures representing three TAM subpopulations (M0, CXCL10, and CD209 TAMs) and four lymphocyte subpopulations (cytotoxic lymphocytes, T, NK, and CD4 T cells)(<xref ref-type="bibr" rid="R1">Acha-Sagredo, et al., 2025</xref>). We identified hot and cold areas in the CRC tissue for each of these gene signatures using again the Getis-Ord Gi statistics and applied one-tailed Fisher’s exact test to assess their overlap with <italic>CD74</italic> hot and cold areas. Overall, we found a significant enrichment of hot areas for signatures associated with TAM and lymphocyte subpopulations within hot areas for <italic>CD74</italic> expression (<xref ref-type="fig" rid="F4">Figure 4J</xref>). Similarly, we found areas significantly depleted in TAM and lymphocyte subpopulations within areas with low <italic>CD74</italic> expression (<xref ref-type="fig" rid="F4">Figure 4K</xref>). This analysis confirmed <italic>in situ</italic> the <italic>CD74</italic> overexpression in TAM subpopulations induced by T cells previously detected <italic>in vitro</italic>.</p></sec></sec><sec id="S19" sec-type="discussion"><title>Discussion</title><p id="P64">Kandinsky is a computational tool designed for cell or spot neighbourhood analysis that allows the user to interact with data derived from several spatial technologies and adapt the analysis to the biological query. Compared to other methods, Kandinsky can identify c/s-NBs with greater flexibility. For example, to our knowledge, Kandinsky is the first tool able to apply single-cell segmentation data to define c-NBs according to cell membrane distance in addition to other commonly implemented criteria (KNN, centroid distance, Delaunay triangulation, queen contiguity). In addition, Kandinsky implements a suite of functions and analytical modules to facilitate spatial data analysis without depending on multiple software for each specific task.</p><p id="P65">We showed with real-world data how downstream analytical modules implemented in Kandinsky make use of c/s-NBs in a coherent way, applying c/s-NB definition to each analytical task. Users can interrogate c/s-NBs to define group of cells and spots proximal to cell types of interest, or c/s-NBs sharing a similar neighbourhood composition, study spatial co-localisation patterns between cell or spot types, or identify local hot or cold expression areas. By analysing spatial datasets generated through CosMx, IMC, Xenium, and Visium platforms, we demonstrated Kandinsky versatility to produce biologically meaningful results supported by literature evidence.</p><p id="P66">Although c/s-NB grouping, co-localisation and dispersion analyses are compatible with spatial data of any resolution, they do not support direct inclusion of cell type deconvolution often associated with spot-level data. This is a current limitation of Kandinsky that could be part of future updates. Another possible improvement would be the possibility to run Kandinsky on more than one dataset at the same time for multi-sample comparisons. This requires a substantial change of Kandinsky object format to store molecular and spatial information for independent samples, without losing interoperability with the underlying Seurat infrastructure.</p><p id="P67">Given the continuous development new of spatial technologies, we aim at maintaining Kandinsky code and documentation up to date and expanding the list of compatible spatial platforms and possible analyses.</p></sec></body><back><ack id="S20"><title>Acknowledgements</title><p>We thank the Experimental Histopathology and the Advanced Light Microscopy facilities of the Francis Crick Institute for the support with the Visium experiment, and Gabriele Boscagli for reviewing the code.</p><sec id="S21"><title>Funding</title><p>This work was supported by Cancer Research UK [C43634/A25487 to F.D.C.] and [EDDPJT-Nov21\100010 to F.D.C], the Cancer Research UK City of London Centre [C7893/A26233 to F.D.C], the Barts Charity: Theme 3 – Genomics and Evolution of Cancer [MGU0460 to F.D.C.], and the Francis Crick Institute, which receives its core funding from Cancer Research UK (FC001002), the UK Medical Research Council (FC001002), and the Wellcome Trust (FC001002). M.C. is supported by AIRC (BRIDGE 2023 ID 28739) and Compagnia di San Paolo. M.G. is a PhD student within the European School of Molecular Medicine (SEMM). MR-J is partly funded by the NIHR UCL/ UCLH Biomedical Research Centre (BRC).</p></sec></ack><sec id="S22" sec-type="data-availability"><title>Data Availability</title><p id="P68">CosMx human pancreas data(<xref ref-type="bibr" rid="R6">Biology, 2024</xref>) were downloaded from <ext-link ext-link-type="uri" xlink:href="https://nanostring.com/products/cosmx-spatial-molecular-imager/ffpe-dataset/cosmx-smi-human-pancreas-ffpe-dataset">https://nanostring.com/products/cosmx-spatial-molecular-imager/ffpe-dataset/cosmx-smi-human-pancreas-ffpe-dataset</ext-link>. IMC PDAC data(<xref ref-type="bibr" rid="R56">Sussman, et al., 2024</xref>) were downloaded from <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/records/10246315">https://zenodo.org/records/10246315</ext-link>. Xenium breast cancer data(<xref ref-type="bibr" rid="R17">Genomics, 2024</xref>) were downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/datasets/xenium-prime-ffpe-human-breast-cancer">https://www.10xgenomics.com/datasets/xenium-prime-ffpe-human-breast-cancer</ext-link>. CosMx CRC data(<xref ref-type="bibr" rid="R1">Acha-Sagredo, et al., 2025</xref>) were downloaded from <ext-link ext-link-type="uri" xlink:href="https://zenodo.org/records/10927005">https://zenodo.org/records/10927005</ext-link>. Visium CRC data have been deposited in Zenodo (<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.15209564">https://doi.org/10.5281/zenodo.15209564</ext-link>). Access to these data is restricted to non-commercial research only and requires data sharing agreement with the Francis Crick Institute.</p></sec><fn-group><fn fn-type="con" id="FN3"><p id="P69"><bold>Author Contributions</bold></p><p id="P70">Conceptualization: P.A., and F.D.C.; methodology: P.A., M.G., M.C., and F.D.C.; software: P.A., M.G., and M.C.; formal analysis: P.A.; investigation: A.A.-S., P.D., and K.F; resources: P.D., K.F., and M.R.-J.; writing – original draft: P.A., and F.D.C.; writing – review and editing: P.A., M.G., M.C., and F.D.C.; visualization: P.A., and F.D.C.; supervision: M.C. and F.D.C.; funding acquisition: F.D.C.</p></fn><fn fn-type="conflict" id="FN4"><p id="P71"><bold>Conflict of Interest</bold></p><p id="P72">The authors declare no competing interests.</p></fn></fn-group><ref-list><ref id="R1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Acha-Sagredo</surname><given-names>A</given-names></name><etal/></person-group><article-title>A constitutive interferon-high immunophenotype defines response to immunotherapy in colorectal cancer</article-title><source>Cancer Cell</source><year>2025</year><volume>43</volume><issue>2</issue><fpage>292</fpage><lpage>307</lpage><elocation-id>e297</elocation-id><pub-id pub-id-type="pmid">39824178</pub-id></element-citation></ref><ref id="R2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Adriance</surname><given-names>MC</given-names></name><etal/></person-group><article-title>Myoepithelial cells: good fences make good neighbors</article-title><source>Breast Cancer Res</source><year>2005</year><volume>7</volume><issue>5</issue><fpage>190</fpage><lpage>197</lpage><pub-id pub-id-type="doi">10.1186/bcr1286</pub-id><pub-id pub-id-type="pmcid">PMC1242144</pub-id><pub-id pub-id-type="pmid">16168137</pub-id></element-citation></ref><ref id="R3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Agrawal</surname><given-names>A</given-names></name><etal/></person-group><article-title>NiCo identifies extrinsic drivers of cell state modulation by niche covariation analysis</article-title><source>Nat Commun</source><year>2024</year><volume>15</volume><issue>1</issue><elocation-id>10628</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-024-54973-w</pub-id><pub-id pub-id-type="pmcid">PMC11621405</pub-id><pub-id pub-id-type="pmid">39639035</pub-id></element-citation></ref><ref id="R4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Andreatta</surname><given-names>M</given-names></name><name><surname>Carmona</surname><given-names>SJ</given-names></name></person-group><article-title>UCell: Robust and scalable single-cell gene signature scoring</article-title><source>Comput Struct Biotechnol J</source><year>2021</year><volume>19</volume><fpage>3796</fpage><lpage>3798</lpage><pub-id pub-id-type="doi">10.1016/j.csbj.2021.06.043</pub-id><pub-id pub-id-type="pmcid">PMC8271111</pub-id><pub-id pub-id-type="pmid">34285779</pub-id></element-citation></ref><ref id="R5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Armingol</surname><given-names>E</given-names></name><name><surname>Baghdassarian</surname><given-names>HM</given-names></name><name><surname>Lewis</surname><given-names>NE</given-names></name></person-group><article-title>The diversification of methods for studying cell-cell interactions and communication</article-title><source>Nat Rev Genet</source><year>2024</year><volume>25</volume><issue>6</issue><fpage>381</fpage><lpage>400</lpage><pub-id pub-id-type="doi">10.1038/s41576-023-00685-8</pub-id><pub-id pub-id-type="pmcid">PMC11139546</pub-id><pub-id pub-id-type="pmid">38238518</pub-id></element-citation></ref><ref id="R6"><element-citation publication-type="other"><person-group person-group-type="author"><name><surname>Biology</surname><given-names>BS</given-names></name></person-group><person-group person-group-type="editor"><name><surname>Biology</surname><given-names>BS</given-names></name></person-group><source>CosMx Human Pancreas FFPE Dataset</source><year>2024</year></element-citation></ref><ref id="R7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bivand</surname><given-names>RWD</given-names></name></person-group><article-title>Comparing implementations of global and local indicators of spatial association</article-title><source>TEST</source><volume>2018</volume><issue>27</issue><fpage>716</fpage><lpage>748</lpage></element-citation></ref><ref id="R8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bortolomeazzi</surname><given-names>M</given-names></name><etal/></person-group><article-title>Immunogenomics of Colorectal Cancer Response to Checkpoint Blockade: Analysis of the KEYNOTE 177 Trial and Validation Cohorts</article-title><source>Gastroenterology</source><year>2021</year><volume>161</volume><issue>4</issue><fpage>1179</fpage><lpage>1193</lpage><pub-id pub-id-type="doi">10.1053/j.gastro.2021.06.064</pub-id><pub-id pub-id-type="pmcid">PMC8527923</pub-id><pub-id pub-id-type="pmid">34197832</pub-id></element-citation></ref><ref id="R9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cang</surname><given-names>Z</given-names></name><etal/></person-group><article-title>Screening cell-cell communication in spatial transcriptomics via collective optimal transport</article-title><source>Nat Methods</source><year>2023</year><volume>20</volume><issue>2</issue><fpage>218</fpage><lpage>228</lpage><pub-id pub-id-type="doi">10.1038/s41592-022-01728-4</pub-id><pub-id pub-id-type="pmcid">PMC9911355</pub-id><pub-id pub-id-type="pmid">36690742</pub-id></element-citation></ref><ref id="R10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>JG</given-names></name><etal/></person-group><article-title>Giotto Suite: a multi-scale and technology-agnostic spatial multi-omics analysis ecosystem</article-title><source>bioRxiv</source><year>2023</year></element-citation></ref><ref id="R11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dahiya</surname><given-names>S</given-names></name><etal/></person-group><article-title>Acinar to beta-like cell conversion through inhibition of focal adhesion kinase</article-title><source>Nat Commun</source><year>2024</year><volume>15</volume><issue>1</issue><elocation-id>3740</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-024-47972-4</pub-id><pub-id pub-id-type="pmcid">PMC11068907</pub-id><pub-id pub-id-type="pmid">38702347</pub-id></element-citation></ref><ref id="R12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Danaher</surname><given-names>P</given-names></name><etal/></person-group><article-title>Insitutype: likelihood-based cell typing for single cell spatial transcriptomics</article-title><source>biorXiv</source><year>2022</year><elocation-id>2022.2010.2019.512902</elocation-id></element-citation></ref><ref id="R13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ding</surname><given-names>DY</given-names></name><etal/></person-group><article-title>Quantitative characterization of tissue states using multiomics and ecological spatial analysis</article-title><source>Nat Genet</source><year>2025</year><pub-id pub-id-type="doi">10.1038/s41588-025-02119-z</pub-id><pub-id pub-id-type="pmcid">PMC11985343</pub-id><pub-id pub-id-type="pmid">40169791</pub-id></element-citation></ref><ref id="R14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Egozi</surname><given-names>A</given-names></name><etal/></person-group><article-title>Zonation of Pancreatic Acinar Cells in Diabetic Mice</article-title><source>Cell Rep</source><year>2020</year><volume>32</volume><issue>7</issue><elocation-id>108043</elocation-id><pub-id pub-id-type="doi">10.1016/j.celrep.2020.108043</pub-id><pub-id pub-id-type="pmcid">PMC7443616</pub-id><pub-id pub-id-type="pmid">32814046</pub-id></element-citation></ref><ref id="R15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Feng</surname><given-names>Y</given-names></name><etal/></person-group><article-title>Spatial analysis with SPIAT and spaSim to characterize and simulate tissue microenvironments</article-title><source>Nat Commun</source><year>2023</year><volume>14</volume><issue>1</issue><elocation-id>2697</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-023-37822-0</pub-id><pub-id pub-id-type="pmcid">PMC10185501</pub-id><pub-id pub-id-type="pmid">37188662</pub-id></element-citation></ref><ref id="R16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gebhardt</surname><given-names>ARR</given-names></name><name><surname>Eglen</surname><given-names>S</given-names></name><name><surname>Zuyev</surname><given-names>S</given-names></name><name><surname>White</surname><given-names>D</given-names></name></person-group><article-title>tripack: Triangulation of Irregularly Spaced Data</article-title><year>2024</year></element-citation></ref><ref id="R17"><element-citation publication-type="other"><person-group person-group-type="author"><name><surname>Genomics</surname><given-names>X</given-names></name></person-group><person-group person-group-type="editor"><name><surname>Genomics</surname><given-names>X</given-names></name></person-group><article-title>FFPE Human Breast Cancer with 5K Human Pan Tissue and Pathways Panel plus 100 Custom Genes</article-title><year>2024</year></element-citation></ref><ref id="R18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Giesen</surname><given-names>C</given-names></name><etal/></person-group><article-title>Highly multiplexed imaging of tumor tissues with subcellular resolution by mass cytometry</article-title><source>Nat Methods</source><year>2014</year><volume>11</volume><issue>4</issue><fpage>417</fpage><lpage>422</lpage><pub-id pub-id-type="pmid">24584193</pub-id></element-citation></ref><ref id="R19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Goltsev</surname><given-names>Y</given-names></name><etal/></person-group><article-title>Deep Profiling of Mouse Splenic Architecture with CODEX Multiplexed Imaging</article-title><source>Cell</source><year>2018</year><volume>174</volume><issue>4</issue><fpage>968</fpage><lpage>981</lpage><elocation-id>e915</elocation-id><pub-id pub-id-type="doi">10.1016/j.cell.2018.07.010</pub-id><pub-id pub-id-type="pmcid">PMC6086938</pub-id><pub-id pub-id-type="pmid">30078711</pub-id></element-citation></ref><ref id="R20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gudjonsson</surname><given-names>T</given-names></name><etal/></person-group><article-title>Myoepithelial cells: their origin and function in breast morphogenesis and neoplasia</article-title><source>J Mammary Gland Biol Neoplasia</source><year>2005</year><volume>10</volume><issue>3</issue><fpage>261</fpage><lpage>272</lpage><pub-id pub-id-type="doi">10.1007/s10911-005-9586-4</pub-id><pub-id pub-id-type="pmcid">PMC2798159</pub-id><pub-id pub-id-type="pmid">16807805</pub-id></element-citation></ref><ref id="R21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hao</surname><given-names>Y</given-names></name><etal/></person-group><article-title>Dictionary learning for integrative, multimodal and scalable single-cell analysis</article-title><source>Nat Biotechnol</source><year>2024</year><volume>42</volume><issue>2</issue><fpage>293</fpage><lpage>304</lpage><pub-id pub-id-type="doi">10.1038/s41587-023-01767-y</pub-id><pub-id pub-id-type="pmcid">PMC10928517</pub-id><pub-id pub-id-type="pmid">37231261</pub-id></element-citation></ref><ref id="R22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>He</surname><given-names>S</given-names></name><etal/></person-group><article-title>High-plex imaging of RNA and proteins at subcellular resolution in fixed tissue by spatial molecular imaging</article-title><source>Nat Biotechnol</source><year>2022</year><volume>40</volume><issue>12</issue><fpage>1794</fpage><lpage>1806</lpage><pub-id pub-id-type="pmid">36203011</pub-id></element-citation></ref><ref id="R23"><element-citation publication-type="web"><person-group person-group-type="author"><name><surname>Hijmans</surname><given-names>R</given-names></name></person-group><source>terra: Spatial Data Analysis</source><year>2025</year><comment><ext-link ext-link-type="uri" xlink:href="https://github.com/rspatial/terra">https://github.com/rspatial/terra</ext-link></comment></element-citation></ref><ref id="R24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hu</surname><given-names>M</given-names></name><etal/></person-group><article-title>Regulation of in situ to invasive breast carcinoma transition</article-title><source>Cancer Cell</source><year>2008</year><volume>13</volume><issue>5</issue><fpage>394</fpage><lpage>406</lpage><pub-id pub-id-type="doi">10.1016/j.ccr.2008.03.007</pub-id><pub-id pub-id-type="pmcid">PMC3705908</pub-id><pub-id pub-id-type="pmid">18455123</pub-id></element-citation></ref><ref id="R25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ilich</surname><given-names>A</given-names></name></person-group><source>GLCMTextures: GLCM Textures of Raster Layers Release 05</source><year>2025</year></element-citation></ref><ref id="R26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Janesick</surname><given-names>A</given-names></name><etal/></person-group><article-title>High resolution mapping of the tumor microenvironment using integrated single-cell, spatial and in situ analysis</article-title><source>Nat Commun</source><year>2023</year><volume>14</volume><issue>1</issue><elocation-id>8353</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-023-43458-x</pub-id><pub-id pub-id-type="pmcid">PMC10730913</pub-id><pub-id pub-id-type="pmid">38114474</pub-id></element-citation></ref><ref id="R27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jones</surname><given-names>DC</given-names></name><etal/></person-group><article-title>Cell Simulation as Cell Segmentation</article-title><source>bioRxiv</source><year>2024</year></element-citation></ref><ref id="R28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kim</surname><given-names>H</given-names></name><etal/></person-group><article-title>Unveiling contact-mediated cellular crosstalk</article-title><source>Trends Genet</source><year>2024</year><volume>40</volume><issue>10</issue><fpage>868</fpage><lpage>879</lpage><pub-id pub-id-type="pmid">38906738</pub-id></element-citation></ref><ref id="R29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kim</surname><given-names>H</given-names></name><etal/></person-group><article-title>CellNeighborEX: deciphering neighbor-dependent gene expression from spatial transcriptomics data</article-title><source>Mol Syst Biol</source><year>2023</year><volume>19</volume><issue>11</issue><elocation-id>e11670</elocation-id><pub-id pub-id-type="doi">10.15252/msb.202311670</pub-id><pub-id pub-id-type="pmcid">PMC10632736</pub-id><pub-id pub-id-type="pmid">37815040</pub-id></element-citation></ref><ref id="R30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kleshchevnikov</surname><given-names>V</given-names></name><etal/></person-group><article-title>Cell2location maps fine-grained cell types in spatial transcriptomics</article-title><source>Nat Biotechnol</source><year>2022</year><volume>40</volume><issue>5</issue><fpage>661</fpage><lpage>671</lpage><pub-id pub-id-type="pmid">35027729</pub-id></element-citation></ref><ref id="R31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kojima</surname><given-names>Y</given-names></name><etal/></person-group><article-title>Single-cell colocalization analysis using a deep generative model</article-title><source>Cell Syst</source><year>2024</year><volume>15</volume><issue>2</issue><fpage>180</fpage><lpage>192</lpage><elocation-id>e187</elocation-id><pub-id pub-id-type="pmid">38387441</pub-id></element-citation></ref><ref id="R32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lafzi</surname><given-names>A</given-names></name><etal/></person-group><article-title>Identifying Spatial Co-occurrence in Healthy and InflAmed tissues (ISCHIA</article-title><source>Mol Syst Biol</source><year>2024</year><volume>20</volume><issue>2</issue><fpage>98</fpage><lpage>119</lpage><pub-id pub-id-type="doi">10.1038/s44320-023-00006-5</pub-id><pub-id pub-id-type="pmcid">PMC10897385</pub-id><pub-id pub-id-type="pmid">38225383</pub-id></element-citation></ref><ref id="R33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>Y</given-names></name><etal/></person-group><article-title>Segmentation aware probabilistic phenotyping of single-cell spatial protein expression data</article-title><source>Nat Commun</source><year>2025</year><volume>16</volume><issue>1</issue><fpage>389</fpage><pub-id pub-id-type="doi">10.1038/s41467-024-55214-w</pub-id><pub-id pub-id-type="pmcid">PMC11700195</pub-id><pub-id pub-id-type="pmid">39755686</pub-id></element-citation></ref><ref id="R34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liberzon</surname><given-names>A</given-names></name><etal/></person-group><article-title>The Molecular Signatures Database (MSigDB) hallmark gene set collection</article-title><source>Cell Syst</source><year>2015</year><volume>1</volume><issue>6</issue><fpage>417</fpage><lpage>425</lpage><pub-id pub-id-type="doi">10.1016/j.cels.2015.12.004</pub-id><pub-id pub-id-type="pmcid">PMC4707969</pub-id><pub-id pub-id-type="pmid">26771021</pub-id></element-citation></ref><ref id="R35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>N</given-names></name><etal/></person-group><article-title>hoodscanR: profiling single-cell neighborhoods in spatial transcriptomics data</article-title><source>bioRxiv</source><year>2024</year></element-citation></ref><ref id="R36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mages</surname><given-names>S</given-names></name><etal/></person-group><article-title>TACCO unifies annotation transfer and decomposition of cell identities for single-cell and spatial omics</article-title><source>Nat Biotechnol</source><year>2023</year><volume>41</volume><issue>10</issue><fpage>1465</fpage><lpage>1473</lpage><pub-id pub-id-type="doi">10.1038/s41587-023-01657-3</pub-id><pub-id pub-id-type="pmcid">PMC10513360</pub-id><pub-id pub-id-type="pmid">36797494</pub-id></element-citation></ref><ref id="R37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mason</surname><given-names>K</given-names></name><etal/></person-group><article-title>Niche-DE: niche-differential gene expression analysis in spatial transcriptomics data identifies context-dependent cell-cell interactions</article-title><source>Genome Biol</source><year>2024</year><volume>25</volume><issue>1</issue><fpage>14</fpage><pub-id pub-id-type="doi">10.1186/s13059-023-03159-6</pub-id><pub-id pub-id-type="pmcid">PMC10785550</pub-id><pub-id pub-id-type="pmid">38217002</pub-id></element-citation></ref><ref id="R38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maurer</surname><given-names>K</given-names></name><etal/></person-group><article-title>Coordinated immune networks in leukemia bone marrow microenvironments distinguish response to cellular therapy</article-title><source>Sci Immunol</source><year>2025</year><volume>10</volume><issue>103</issue><elocation-id>eadr0782</elocation-id><pub-id pub-id-type="pmid">39854478</pub-id></element-citation></ref><ref id="R39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moffitt</surname><given-names>JR</given-names></name><etal/></person-group><article-title>Molecular, spatial, and functional single-cell profiling of the hypothalamic preoptic region</article-title><source>Science</source><year>2018</year><volume>362</volume><issue>6416</issue><pub-id pub-id-type="doi">10.1126/science.aau5324</pub-id><pub-id pub-id-type="pmcid">PMC6482113</pub-id><pub-id pub-id-type="pmid">30385464</pub-id></element-citation></ref><ref id="R40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moses</surname><given-names>L</given-names></name><etal/></person-group><article-title>Voyager: exploratory single-cell genomics data analysis with geospatial statistics</article-title><source>bioRxiv</source><year>2023</year></element-citation></ref><ref id="R41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nagendran</surname><given-names>M</given-names></name><etal/></person-group><article-title>1457 Visium HD enables spatially resolved, single-cell scale resolution mapping of FFPE human breast cancer tissue</article-title><source>Journal for ImmunoTherapy of Cancer</source><year>2023</year><volume>11</volume><elocation-id>A1620</elocation-id></element-citation></ref><ref id="R42"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ord</surname><given-names>JKGA</given-names></name></person-group><article-title>Local Spatial Autocorrelation Statistics: Distributional Issues and an Application</article-title><source>Geographical Analysis</source><year>1995</year><volume>27</volume><issue>4</issue><fpage>286</fpage><lpage>306</lpage></element-citation></ref><ref id="R43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Palla</surname><given-names>G</given-names></name><etal/></person-group><article-title>Squidpy: a scalable framework for spatial omics analysis</article-title><source>Nat Methods</source><year>2022</year><volume>19</volume><issue>2</issue><fpage>171</fpage><lpage>178</lpage><pub-id pub-id-type="doi">10.1038/s41592-021-01358-2</pub-id><pub-id pub-id-type="pmcid">PMC8828470</pub-id><pub-id pub-id-type="pmid">35102346</pub-id></element-citation></ref><ref id="R44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pebesma</surname><given-names>E</given-names></name></person-group><article-title>Simple Features for R: Standardized Support for Spatial Vector Data</article-title><source>The R Journal</source><year>2018</year><volume>10</volume><issue>1</issue><fpage>439</fpage></element-citation></ref><ref id="R45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Polanski</surname><given-names>K</given-names></name><etal/></person-group><article-title>Bin2cell reconstructs cells from high resolution Visium HD data</article-title><source>Bioinformatics</source><year>2024</year><volume>40</volume><issue>9</issue><pub-id pub-id-type="doi">10.1093/bioinformatics/btae546</pub-id><pub-id pub-id-type="pmcid">PMC11419951</pub-id><pub-id pub-id-type="pmid">39250728</pub-id></element-citation></ref><ref id="R46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Risom</surname><given-names>T</given-names></name><etal/></person-group><article-title>Transition to invasive breast cancer is associated with progressive changes in the structure and composition of tumor stroma</article-title><source>Cell</source><year>2022</year><volume>185</volume><issue>2</issue><fpage>299</fpage><lpage>310</lpage><elocation-id>e218</elocation-id><pub-id pub-id-type="doi">10.1016/j.cell.2021.12.023</pub-id><pub-id pub-id-type="pmcid">PMC8792442</pub-id><pub-id pub-id-type="pmid">35063072</pub-id></element-citation></ref><ref id="R47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rivest</surname><given-names>F</given-names></name><etal/></person-group><article-title>Fully automated sequential immunofluorescence (seqIF) for hyperplex spatial proteomics</article-title><source>Sci Rep</source><year>2023</year><volume>13</volume><issue>1</issue><elocation-id>16994</elocation-id><pub-id pub-id-type="doi">10.1038/s41598-023-43435-w</pub-id><pub-id pub-id-type="pmcid">PMC10562446</pub-id><pub-id pub-id-type="pmid">37813886</pub-id></element-citation></ref><ref id="R48"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Runswick</surname><given-names>SK</given-names></name><etal/></person-group><article-title>Desmosomal adhesion regulates epithelial morphogenesis and cell positioning</article-title><source>Nat Cell Biol</source><year>2001</year><volume>3</volume><issue>9</issue><fpage>823</fpage><lpage>830</lpage><pub-id pub-id-type="pmid">11533662</pub-id></element-citation></ref><ref id="R49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Russell</surname><given-names>TD</given-names></name><etal/></person-group><article-title>Myoepithelial cell differentiation markers in ductal carcinoma in situ progression</article-title><source>Am J Pathol</source><year>2015</year><volume>185</volume><issue>11</issue><fpage>3076</fpage><lpage>3089</lpage><pub-id pub-id-type="doi">10.1016/j.ajpath.2015.07.004</pub-id><pub-id pub-id-type="pmcid">PMC4630168</pub-id><pub-id pub-id-type="pmid">26343330</pub-id></element-citation></ref><ref id="R50"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Scrucca</surname><given-names>LF</given-names></name><name><surname>Murphy</surname><given-names>TB</given-names></name><name><surname>Raftery</surname><given-names>AE</given-names></name></person-group><source>Model-Based Clustering, Classification, and Density Estimation Using mclust in R</source><publisher-name>Chapman and Hall/CRC</publisher-name><year>2023</year><pub-id pub-id-type="pmcid">PMC5096736</pub-id><pub-id pub-id-type="pmid">27818791</pub-id></element-citation></ref><ref id="R51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sergushichev</surname><given-names>AA</given-names></name></person-group><article-title>An algorithm for fast preranked gene set enrichment analysis using cumulative statistic calculation</article-title><source>bioRxiv</source><year>2016</year></element-citation></ref><ref id="R52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Singhal</surname><given-names>V</given-names></name><etal/></person-group><article-title>BANKSY unifies cell typing and tissue domain segmentation for scalable spatial omics data analysis</article-title><source>Nat Genet</source><year>2024</year><volume>56</volume><issue>3</issue><fpage>431</fpage><lpage>441</lpage><pub-id pub-id-type="doi">10.1038/s41588-024-01664-3</pub-id><pub-id pub-id-type="pmcid">PMC10937399</pub-id><pub-id pub-id-type="pmid">38413725</pub-id></element-citation></ref><ref id="R53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sokal</surname><given-names>RR</given-names></name><name><surname>Oden</surname><given-names>NL</given-names></name></person-group><article-title>Spatial autocorrelation in biology: 1. Methodology</article-title><source>Biological Journal of the Linnean Society</source><year>1978</year><volume>10</volume><issue>2</issue><fpage>199</fpage><lpage>228</lpage></element-citation></ref><ref id="R54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stahl</surname><given-names>PL</given-names></name><etal/></person-group><article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title><source>Science</source><year>2016</year><volume>353</volume><issue>6294</issue><fpage>78</fpage><lpage>82</lpage><pub-id pub-id-type="pmid">27365449</pub-id></element-citation></ref><ref id="R55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stickels</surname><given-names>RR</given-names></name><etal/></person-group><article-title>Highly sensitive spatial transcriptomics at near-cellular resolution with Slide-seqV2</article-title><source>Nat Biotechnol</source><year>2021</year><volume>39</volume><issue>3</issue><fpage>313</fpage><lpage>319</lpage><pub-id pub-id-type="doi">10.1038/s41587-020-0739-1</pub-id><pub-id pub-id-type="pmcid">PMC8606189</pub-id><pub-id pub-id-type="pmid">33288904</pub-id></element-citation></ref><ref id="R56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sussman</surname><given-names>JH</given-names></name><etal/></person-group><article-title>Multiplexed Imaging Mass Cytometry Analysis Characterizes the Vascular Niche in Pancreatic Cancer</article-title><source>Cancer Res</source><year>2024</year><volume>84</volume><issue>14</issue><fpage>2364</fpage><lpage>2376</lpage><pub-id pub-id-type="doi">10.1158/0008-5472.CAN-23-2352</pub-id><pub-id pub-id-type="pmcid">PMC11250934</pub-id><pub-id pub-id-type="pmid">38695869</pub-id></element-citation></ref><ref id="R57"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Taube</surname><given-names>JM</given-names></name><etal/></person-group><article-title>Multi-institutional TSA-amplified Multiplexed Immunofluorescence Reproducibility Evaluation (MITRE) Study</article-title><source>J Immunother Cancer</source><year>2021</year><volume>9</volume><issue>7</issue><pub-id pub-id-type="doi">10.1136/jitc-2020-002197</pub-id><pub-id pub-id-type="pmcid">PMC8286792</pub-id><pub-id pub-id-type="pmid">34266881</pub-id></element-citation></ref><ref id="R58"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Varrone</surname><given-names>M</given-names></name><etal/></person-group><article-title>CellCharter reveals spatial cell niches associated with tissue remodeling and cell plasticity</article-title><source>Nat Genet</source><year>2024</year><volume>56</volume><issue>1</issue><fpage>74</fpage><lpage>84</lpage><pub-id pub-id-type="pmid">38066188</pub-id></element-citation></ref><ref id="R59"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Withnell</surname><given-names>E</given-names></name><name><surname>Secrier</surname><given-names>M</given-names></name></person-group><article-title>SpottedPy quantifies relationships between spatial transcriptomic hotspots and uncovers environmental cues of epithelial-mesenchymal plasticity in breast cancer</article-title><source>Genome Biol</source><year>2024</year><volume>25</volume><issue>1</issue><fpage>289</fpage><pub-id pub-id-type="doi">10.1186/s13059-024-03428-y</pub-id><pub-id pub-id-type="pmcid">PMC11552145</pub-id><pub-id pub-id-type="pmid">39529126</pub-id></element-citation></ref><ref id="R60"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhu</surname><given-names>J</given-names></name><etal/></person-group><article-title>Mapping cellular interactions from spatially resolved transcriptomics data</article-title><source>Nat Methods</source><year>2024</year><volume>21</volume><issue>10</issue><fpage>1830</fpage><lpage>1842</lpage><pub-id pub-id-type="pmid">39227721</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>Overview of Kandinsky</title><p><bold>A</bold>. Examples of technologies delivering spatially resolved data that can be used as an input for Kandinsky.</p><p><bold>B</bold>. Representation of the approaches implemented in Kandinsky to identify c/s-NBs based on spatial relationships between cells or spots. KNN, centroid distance, and Delaunay triangulation can be applied to any data type. Queen contiguity and membrane distance can be used only with spot or cell data, respectively.</p><p><bold>C</bold>. Cell, spot or c/s-NB grouping. Cell or spot types are labelled according to user-defined annotations, and a matrix is derived by counting the number of cells or spots of every type within each c/s-NB. Cells and spots are grouped based on user-defined neighbourhood criteria (supervised approach). c/s-NBs are grouped based on their cell/spot composition (unsupervised approach).</p><p><bold>D</bold>. Cell/spot co-localisation and dispersion. c/s-NBs are used to estimate the tendency of cell or spot types to occupy proximal or distant positions based on z-scores from multi-class join count test.</p><p><bold>E</bold>. Hot and cold expression areas. Getis-Ord Gi statistics and permutations are used to identify areas of significantly high and low expression values of a gene, protein, or signature of interest across cells or spots within each c/s-NB.</p><p>c/s-NB, cell/spot neighbourhood; KNN, K-nearest neighbour.</p></caption><graphic xlink:href="EMS207296-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>Neighbour-based phenotyping of pancreatic cells</title><p><bold>A</bold>,<bold>B</bold>. Cells from nine representative FOVs of a human pancreas sample(<xref ref-type="bibr" rid="R6">Biology, 2024</xref>) coloured using the original cell type (<bold>A</bold>) and peri-islet and non peri-islet acinar cell definition from Kandinsky (<bold>B</bold>). Inlets show examples of pancreatic islets surrounded by acinar cells.</p><p><bold>C</bold>. Genes up- (FC &gt;1.1) and down- (FC &lt;0.9) regulated in peri-islet acinar cells. Differential gene expression analysis was run between per-islet and non peri-islet acinar cells. Genes expressed in &lt;20% of peri-islet acinar cells and &lt;5% of non peri-islet acinar cells were excluded to limit transcript contamination. Genes with Bonferroni adjusted p-value &lt;0.01 were considered differentially expressed.</p><p><bold>D</bold>,<bold>E</bold>. Cells from representative FOVs of four PDAC samples (P1-R1, P4-R1, P6-R3, P8-R2) coloured by spatial niches(<xref ref-type="bibr" rid="R56">Sussman, et al., 2024</xref>) (<bold>D</bold>) and c-NB groups (<bold>E</bold>).</p><p><bold>F</bold>. Proportion of spatial niches(<xref ref-type="bibr" rid="R56">Sussman, et al., 2024</xref>) within c-NB groups.</p><p><bold>G</bold>,<bold>H</bold>. Enrichment of spatial niches (<bold>G</bold>) and cell types (<bold>H</bold>) within c-NB groups. Enrichment was tested using one-tailed Fisher’s exact test. P-values were corrected for multiple testing with Benjamini-Hochberg method.</p><p><bold>I</bold>. Comparison of B cell proportions between c-NB groups 9 and 10. Proportions were compared using two-sided Fisher’s exact test.</p><p>c-NB, cell neighbourhood; FC, fold change; FDR, false discovery rate; FOV, field of view; IMC, imaging mass cytometry; PDAC, pancreatic ductal adenocarcinoma.</p></caption><graphic xlink:href="EMS207296-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>Cell localisation analysis in breast cancer</title><p><bold>A</bold>. Unsupervised clustering of 468583 cells from a breast cancer single cell transcriptomics dataset obtained with the Xenium 5K technology(<xref ref-type="bibr" rid="R17">Genomics, 2024</xref>). Cells are coloured by cell type.</p><p><bold>B</bold>. Mean expression value of marker genes representative of cell types identified with clustering. Differential gene expression analysis was performed between each cell type and the rest. Up to two differentially expressed genes per cell type (FC &gt;2, FDR &lt;0.05) were selected for visualisation.</p><p><bold>C</bold>. Distribution of cells per c-NB, identified using a centroid distance of 40um. Median number of cells is reported as a dashed red line.</p><p><bold>D</bold>. Multi-class join count z-score matrix assessing co-occurrence or dispersion of each cell pair (<xref ref-type="sec" rid="S3">Methods</xref>). Positive z-score values indicate co-localisation, negative z-score values indicate dispersion. Dot size indicate observed-to-expected ratio of join counts.</p><p><bold>E-F</bold>. Representative regions of the breast tissue sample showing layers of MECs surrounding tumour 5 (<bold>E</bold>) and tumour 6 (<bold>F</bold>) cells.</p><p><bold>G</bold>. Significantly enriched (NES &gt;0) and depleted (NES &lt;0) hallmark cancer pathways(Liberzon, et al., 2015) in cancer cells of tumour 5 and 6 clusters compared to the rest of cancer cells. Enrichment was estimated using ranked GSEA. Pathways with FDR &lt;0.05 were considered significant.</p><p>c-NB, cell neighbourhood; FC, fold change; FDR, false discovery rate (Benjamini-Hochberg); GSEA, gene set enrichment analysis; MECs, myoepithelial cells; NES, normalised enrichment score; PVL, perivascular-like.</p></caption><graphic xlink:href="EMS207296-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>Cell enrichment within <italic>CD74</italic> hot and cold CRC tissue areas</title><p><bold>A</bold>. Cells from four representative FOVs of a human CRC sample (CR48) coloured by original cell type(<xref ref-type="bibr" rid="R1">Acha-Sagredo, et al., 2025</xref>).</p><p><bold>B</bold>. Distribution of cells per c-NB, identified using a cell membrane distance of 30um. Median number of cells is reported as a dashed red line.</p><p><bold>C</bold>,<bold>D</bold>. Cells from the FOVs shown in (<bold>A</bold>), coloured by <italic>CD74</italic> expression levels (<bold>C</bold>) and <italic>CD74</italic> hot or cold areas (<bold>D</bold>). <italic>CD74</italic> hot and cold areas were identified using the Getis-Ord Gi statistics applied to neighbour cells.</p><p><bold>E</bold>. Comparison of <italic>CD74</italic> hot and non-hot areas containing myeloid, T/NK, or CRC cells.</p><p><bold>F</bold>. Density plot of <italic>CD74</italic> expression values in CRC cells with or without T/NK cells within their c-NBs. Distributions were compared using two-sided Wilcoxon’s rank-sum test.</p><p><bold>G</bold>. Visium spots for CRC sample (CR48), coloured by <italic>CD74</italic> expression levels.</p><p><bold>H</bold>. Distribution of spots per s-NB, identified using the queen contiguity method with the first two contiguous layers surrounding each spot. Median number of spots is reported as a dashed red line.</p><p><bold>I</bold>. Visium spots for CRC sample (CR48), coloured by <italic>CD74</italic> hot or cold areas. <italic>CD74</italic> hot and cold areas were identified based on Getis-Ord Gi statistics applied to neighbour spots.</p><p><bold>J</bold>,<bold>K</bold>. Comparison of <italic>CD74</italic> hot and non-hot (<bold>J</bold>) and <italic>CD74</italic> cold and non-cold (<bold>K</bold>) areas overlapping with hot and cold areas for gene signatures associated with TAMs and lymphocyte subpopulations(<xref ref-type="bibr" rid="R1">Acha-Sagredo, et al., 2025</xref>).</p><p>Significance in (D) and (I) was tested based on permutations and cells associated with a positive or negative Getis-Ord Gi statistics with FDR &lt;0.05 were assigned to <italic>CD74</italic> hot or cold areas, respectively (<xref ref-type="sec" rid="S3">Methods</xref>). Proportions in (E), (J) and (K) were compared using one-sided Fisher’s exact test and corrected for multiple testing when needed.</p><p>c-NB, cell neighbourhood; CRC, colorectal cancer; FDR, false discovery rate (Benjamini-Hochberg); FOV, field of view; NK, natural killer; ns, not significant s-NB, spot neighbourhood; TAMs, tumour-associated macrophages.</p></caption><graphic xlink:href="EMS207296-f004"/></fig></floats-group></article>