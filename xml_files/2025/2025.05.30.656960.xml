<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="epub">2692-8205</issn></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS206132</article-id><article-id pub-id-type="doi">10.1101/2025.05.30.656960</article-id><article-id pub-id-type="archive">PPR1029503</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>EnrichMap: Spatially informed enrichment analysis for functional interpretation of spatial transcriptomics</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Celik</surname><given-names>Cenk</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib><contrib contrib-type="author"><name><surname>Secrier</surname><given-names>Maria</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib></contrib-group><aff id="A1"><label>1</label>UCL Genetics Institute, Department of Genetics, Evolution and Environment, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/02jx3x895</institution-id><institution>University College London</institution></institution-wrap>, <addr-line>Gower Street</addr-line>, <city>London</city>, <postal-code>WC1E 6BT</postal-code>, <country country="GB">UK</country></aff><author-notes><corresp id="CR1">
<label>*</label>Correspondence to <email>cenk.celik@ucl.ac.uk</email> and <email>m.secrier@ucl.ac.uk</email></corresp></author-notes><pub-date pub-type="nihms-submitted"><day>04</day><month>06</month><year>2025</year></pub-date><pub-date pub-type="preprint"><day>01</day><month>06</month><year>2025</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Advances in spatial transcriptomics (ST) allow high-resolution mapping of gene expression within intact tissues, revealing spatially regulated biology. However, accurately quantifying gene set activity in spatial contexts remains inadequate. We present EnrichMap, a Python package designed to compute gene set enrichment scores in ST data by integrating batch correction, smoothing and spatial confounder adjustment. EnrichMap generates enrichment scores for signatures or pathways, with an optional framework for incorporating gene weights. To assess performance, we benchmark EnrichMap against established scoring techniques using spatial autocorrelation metrics such as Moran’s <italic>I</italic>. Our results show that EnrichMap improves spatial coherence, producing scores that capture both local and global spatial patterns, while conventional approaches tend to exhibit higher heterogeneity or diminished spatial structure. EnrichMap is demonstrated to be generalisable across a variety of ST platforms, including Visium, Xenium, MERFISH and imaging mass cytometry, maintaining consistent performance despite differences in spatial resolution and detection chemistry. Our method offers a platform-agnostic, spatially and biologically meaningful representation of gene set activity across complex tissue landscapes.</p></abstract></article-meta></front><body><sec id="S1" sec-type="intro"><title>Background</title><p id="P2">The tissue microenvironment is a spatially organised ecosystem, comprising diverse cell types (e.g. epithelial, immune, stromal) and extracellular matrix components. These elements interact in structured spatial patterns shaped by development, homeostasis and pathology. In cancer, such interactions influence outcomes including immune evasion<sup><xref ref-type="bibr" rid="R1">1</xref>, <xref ref-type="bibr" rid="R2">2</xref></sup>, metastasis<sup><xref ref-type="bibr" rid="R3">3</xref>, <xref ref-type="bibr" rid="R4">4</xref></sup> and therapeutic resistance<sup><xref ref-type="bibr" rid="R1">1</xref>, <xref ref-type="bibr" rid="R5">5</xref>–<xref ref-type="bibr" rid="R7">7</xref></sup>. Advances in spatial transcriptomics (ST) enable transcriptome-wide profiling at near-cellular or cellular resolution, while preserving the spatial context<sup><xref ref-type="bibr" rid="R8">8</xref>, <xref ref-type="bibr" rid="R9">9</xref></sup>. This spatially resolved view allows investigation of tissue <italic>in situ</italic>, where neighbouring cells share environmental cues and influence local phenotypes and cell states in cooperation. Capturing such intertwined spatial patterns is essential for understanding tissue function and diseases.</p><p id="P3">Gene set enrichment analysis (GSEA)<sup><xref ref-type="bibr" rid="R10">10</xref></sup> and related approaches<sup><xref ref-type="bibr" rid="R11">11</xref>–<xref ref-type="bibr" rid="R14">14</xref></sup> link expression data to biological processes. However, they assume independence between samples, an assumption violated in spatial data, where gene expression in a cell is often impacted by the surrounding microenvironment, accommodating the continuity of certain biological features across space. As a result, these methods fail to account for the spatial continuity of many biological features across tissue landscapes.</p><p id="P4">While several tools have been developed for domain detection (e.g. BayesSpace<sup><xref ref-type="bibr" rid="R15">15</xref></sup>, CellCharter<sup><xref ref-type="bibr" rid="R16">16</xref></sup>, SpottedPy<sup><xref ref-type="bibr" rid="R17">17</xref></sup>), spatial gene variability (e.g. SPARK<sup><xref ref-type="bibr" rid="R18">18</xref></sup>, SpatialDE<sup><xref ref-type="bibr" rid="R19">19</xref></sup>) or cell-cell communication (e.g. CellPhoneDB<sup><xref ref-type="bibr" rid="R20">20</xref></sup>, Renoir<sup><xref ref-type="bibr" rid="R21">21</xref></sup>, SpaceBF<sup><xref ref-type="bibr" rid="R22">22</xref></sup>), methods that integrate spatial context into the evaluation of gene programmes remain limited. Here, we present EnrichMap, a spatially informed framework for gene set scoring in ST data. EnrichMap integrates spatial relationships, models tissue continuity and corrects for spatial confounders by leveraging binary or weighted gene sets. The resulting maps reflect spatially organised signals, enabling discovery of biologically coherent tissue regions. EnrichMap also provides spatial diagnostics (e.g. autocorrelation, correlograms, variograms) adapted from geostatistics<sup><xref ref-type="bibr" rid="R23">23</xref>, <xref ref-type="bibr" rid="R24">24</xref></sup> to assess spatial structure.</p><p id="P5">We demonstrate EnrichMap’s utility across ST datasets, including healthy and cancer tissues. First, we showcase EnrichMap’s capabilities in a mouse brain dataset and recover a spatially localised pyramidal layer. Then, we investigate cancer hallmarks in two human breast cancer datasets to highlight EnrichMap’s batch handling. We demonstrate spatially localised proliferative zones and G0 arrest linked with immune suppression and metastasis, uncovering transcriptional landscapes that are not apparent from raw gene expression. Furthermore, we show EnrichMap’s performance across various ST platforms, including Visium HD, Xenium, MERFISH and imaging mass cytometry, highlighting its versatility in handling datasets with varying spatial resolution and detection chemistries. Our approach offers a platform-agnostic, spatially informed framework for functional genomics <italic>in situ</italic>, with wide-ranging applications in cancer research, developmental biology and tissue-based diagnostics.</p></sec><sec id="S2" sec-type="results"><title>Results</title><sec id="S3"><title>EnrichMap enables spatially informed gene set enrichment analysis</title><p id="P6">Standard enrichment tools<sup><xref ref-type="bibr" rid="R10">10</xref>–<xref ref-type="bibr" rid="R14">14</xref>, <xref ref-type="bibr" rid="R25">25</xref>, <xref ref-type="bibr" rid="R26">26</xref></sup>, designed for either bulk or single-cell transcriptomics data, assume independent observations and overlook spatial relationships. When applied to ST data, these methods produce fragmented and artefactual patterns, limiting spatial interpretability. To address this, we developed EnrichMap, a spatially informed framework for gene set scoring in ST data. EnrichMap builds on the principle that biologically meaningful processes manifest as spatially coherent patterns across tissue sections by incorporating spatial smoothing, batch correction and spatial covariate adjustment (<xref ref-type="fig" rid="F1">Fig. 1a</xref>), generating per-cell or per-spot enrichment scores visualised as interpretable maps with optional gene contribution plots (<xref ref-type="fig" rid="F1">Fig. 1b</xref>).</p><p id="P7">The EnrichMap toolkit includes spatial diagnostics (i.e. Moran’s <italic>I</italic>, Geary’s <italic>C</italic>, variograms) to quantify spatial coherence and distinguish biological signal from technical noise (<xref ref-type="fig" rid="F1">Fig. 1c</xref>), helping determine whether a gene programme shows meaningful spatial localisation. For instance, Moran’s <italic>I</italic> measures global spatial autocorrelation, capturing broad patterns where gene expression is spatially clustered, while Geary’s <italic>C</italic> is more sensitive to local dissimilarities, making it well-suited for detecting gradients or spatial boundaries. Similarly, a variogram shows how related (or dissimilar) two observations are as the spatial distance between them increases.</p><p id="P8">To demonstrate its utility, we applied EnrichMap to a simulated Visium-like dataset (<xref ref-type="fig" rid="F1">Fig. 1d</xref>) with a 10-gene signature marking a specific population (cluster 2). Compared with area under the curve per cell (AUCell)<sup><xref ref-type="bibr" rid="R11">11</xref></sup>, Z score, Scanpy<sup><xref ref-type="bibr" rid="R27">27</xref></sup> (<monospace>score_genes();</monospace> Seurat’s <monospace>AddModuleScore()</monospace> function<sup><xref ref-type="bibr" rid="R26">26</xref></sup>), single-sample GSEA (ssGSEA)<sup><xref ref-type="bibr" rid="R12">12</xref></sup> and gene set variation analysis (GSVA)<sup><xref ref-type="bibr" rid="R13">13</xref></sup>, EnrichMap yielded the most favourable values for both Moran’s <italic>I</italic> and Geary’s <italic>C</italic> (<xref ref-type="fig" rid="F1">Fig. 1e</xref>), indicating superior sensitivity to spatial organisation. Unlike Z score, which produced spatially fragmented scores, EnrichMap preserved spatial coherence (<xref ref-type="fig" rid="F1">Fig. 1f</xref>, <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 1a</xref>). A Moran’s scatter plot confirmed strong spatial autocorrelation (Moran’s <italic>I</italic> = 0.79, <italic>p</italic>-value &lt; 0.001; <xref ref-type="fig" rid="F1">Fig. 1g</xref>), with high-to-high and low-to-low expression clustering across the tissue. Top contributing genes identified by EnrichMap showed spatial expression patterns that aligned with their enrichment scores (<xref ref-type="fig" rid="F1">Fig. 1h-i</xref>), reinforcing the biological interpretability of the method. We further assessed sensitivity by scoring signatures of varying sizes. On the simulated data, signatures comprising 10-50 genes showed the most coherent spatial structure (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 1b-d</xref>), consistent with the gene set size of many co-regulated biological programmes. Repeating the simulation 100 times confirmed the robustness of these results, with EnrichMap consistently showing higher spatial autocorrelation compared with other methods, as captured by both variogram range distributions (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 1e</xref>) and Moran’s <italic>I</italic> scores (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 1f)</xref>.</p></sec><sec id="S4"><title>Spatially coherent gene programmes reveal laminar organisation in the mouse brain</title><p id="P9">To demonstrate EnrichMap’s capabilities in a real-world dataset, we explored a mouse coronal brain section dataset (<xref ref-type="fig" rid="F2">Fig. 2a</xref>, <xref ref-type="sec" rid="S9">Methods</xref>). The coronal section is highly compartmentalised, therefore, ideal to use for benchmarking. To test the performance of EnrichMap and other methods, we ranked the top 10 differentially expressed genes of the pyramidal layer, a layer of the cerebral cortex that contains large, excitatory pyramidal neurons responsible for integrating and transmitting cortical information.</p><p id="P10">EnrichMap demonstrated the smoothest spatial structure of the pyramidal layer scores both visually (<xref ref-type="fig" rid="F2">Fig. 2b</xref>) and statistically, where a sharp increase was followed by a plateau in the variogram analysis (<xref ref-type="fig" rid="F2">Fig. 2c</xref>). To enable a fair comparison across methods, we did not centre the generated scores, although EnrichMap inherently produces scores centred around zero, reflecting both activation and deactivation of the input gene set. Nonetheless, Z score and AUCell were spatially unstructured as observed in the constant increase of the corresponding variograms, whereas Scanpy, ssGSEA and GSVA remained spatially autocorrelated to some extent (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 2a</xref>) and EnrichMap yielding autocorrelation of a Moran’s <italic>I</italic> of 0.86 with a <italic>P</italic> value of 0.001 (<xref ref-type="fig" rid="F2">Fig 2d</xref>).</p><p id="P11">To benchmark classification accuracy, we evaluated each method’s ability to recover a predefined cell population. EnrichMap achieved the highest classification performance (F1=1.0), significantly outperforming all other methods (<xref ref-type="fig" rid="F2">Fig. 2e</xref>) that showed comparable but consistently lower performance (F1 ≈ 0.6-0.7). These results underscore EnrichMap’s sensitivity and precision in capturing spatially meaningful biological programmes, supporting for spatially resolved functional inference. We further compared runtimes across methods using gene sets of varying size. Z score and Scanpy were the fastest, followed by AUCell and ssGSEA, with GSVA being the slowest (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 2b</xref>). EnrichMap showed stable and relatively short runtimes up to 100 genes, after which a linear increase was observed, reflecting the cost of neighbourhood-based calculations–a feature that conventional methods ignore. Nevertheless, all methods completed within seconds, rendering runtime differences negligible in practice.</p><p id="P12">We next explored the top contributing genes and found that <italic>Grin2a</italic>, <italic>Scn3a</italic> and <italic>Tmsb4x</italic> were among the highest contributors that clustered together (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 2c</xref>), highlighting the deep layer, involved in modulating excitatory circuits in the brain, the main roles of pyramidal neurons in CA1 region of the hippocampus<sup><xref ref-type="bibr" rid="R28">28</xref></sup>.</p></sec><sec id="S5"><title>Design considerations for accurate spatial enrichment with EnrichMap</title><p id="P13">EnrichMap implements a coefficient of variation (CV)<sup><xref ref-type="bibr" rid="R29">29</xref></sup>-based gene weighting scheme which prioritises genes with high relative dispersion to enhance sensitivity to biologically relevant, spatially structured signals (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 3a-b</xref>). To explore this, we assessed the influence of housekeeping genes, whose expression is typically ubiquitous across tissues regions. When housekeeping genes were added to the pyramidal layer signature, EnrichMap continued to capture spatially coherent structures, yielding Moran’s <italic>I</italic> scores comparable to those without housekeeping genes and showing high rank correlation with the original scores (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 3c-d</xref>). This demonstrates that EnrichMap scores remain robust and spatially coherent, even in the presence of uniformly expressed genes, thereby mitigating noise from genes with weak or no spatial structure.</p><p id="P14">We evaluated EnrichMap’s sensitivity to a range of gene set sizes. Very small signatures (e.g. 2 or 5 genes) produced patchy enrichment patterns, whereas larger signatures (200-500 genes) led to overestimation (<xref ref-type="fig" rid="F3">Fig. 3a</xref>). These findings suggest that signatures comprising 10-50 genes offer not only spatially but also biologically relevant balance. While variogram shapes were consistent across all sizes, semivariance was most stable within the 10-50 gene range (<xref ref-type="fig" rid="F3">Fig. 3b</xref>). Notably, Moran’s <italic>I</italic> was highest at 50 genes, indicating the strongest spatial autocorrelation (<xref ref-type="fig" rid="F3">Fig. 3c</xref>, <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 4a-b</xref>). Although peak autocorrelation was observed with 50 genes, gene sets of 10-20 or even 100 genes may still be appropriate, as their enrichment scores correlate with those from 50-gene signatures at over 93% accuracy (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 4c</xref>). From here onwards, we centred all spatial plots according to EnrichMap’s design to ensure consistent and interpretable visualisation. We also provide a wrapper function for generating spatial enrichment maps in an interpretable format.</p><p id="P15">We then explored the effect of neighbourhood size on spatial associations. Using 1-2 neighbourhood rings (i.e., 6-12 neighbours) most accurately highlighted the ground truth pyramidal layer without inflating enrichment scores. Both neighbourhood ring analysis and variogram-based assessment indicated that neighbourhood size should be predefined to avoid artificial score inflation (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 3e-f</xref>). This adaptability makes EnrichMap well suited to platforms like Visium, where spatial resolution and spot topology can vary.</p><p id="P16">Although EnrichMap can operate directly on raw counts (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 4d</xref>), we recommend applying normalisation to improve smoothness and mitigate technical artefacts, such as those introduced by batch effects. To evaluate this, we compared EnrichMap’s performance using several commonly used approaches: shifted logarithm transformation<sup><xref ref-type="bibr" rid="R30">30</xref></sup>, natural logarithm of one plus (log1p) with estimated size factors<sup><xref ref-type="bibr" rid="R31">31</xref></sup>, analytic Pearson residuals<sup><xref ref-type="bibr" rid="R32">32</xref></sup>, square root transformation and standard log1p normalisation (see <xref ref-type="sec" rid="S9">Methods</xref>). Apart from analytic Pearson residuals, all methods yielded consistent results (<xref ref-type="fig" rid="F3">Fig. 3d-f</xref>), with spatial enrichment scores exhibiting over 99% similarity (<xref ref-type="fig" rid="F3">Fig. 3g</xref>). Analytic Pearson residuals, although still producing interpretable results, showed greater variability in spatial score distributions (<xref ref-type="fig" rid="F3">Fig. 3e-f</xref>, <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 4e</xref>). These findings support the use of log-based transformations for robust scoring.</p></sec><sec id="S6"><title>EnrichMap reveals spatially distinct cancer hallmark programmes in breast tumours</title><p id="P17">To demonstrate EnrichMap’s broader applicability beyond developmental contexts, we investigated the spatial organisation of cancer hallmarks in breast cancer. Using two ST slides from distinct patients, we applied previously established signatures<sup><xref ref-type="bibr" rid="R33">33</xref>, <xref ref-type="bibr" rid="R34">34</xref></sup> (see <xref ref-type="sec" rid="S9">Methods</xref>) to explore proliferation and cell cycle arrest patterns within these cancer tissues using EnrichMap (<xref ref-type="fig" rid="F4">Fig. 4a</xref>). Proliferation and G0 arrest scores were computed within tumour-annotated spots only (<xref ref-type="fig" rid="F4">Fig. 4a</xref>). Despite the spatial the restriction to tumour-only regions, the resulting enrichment maps exhibited clear spatial patterns, smooth transitions and high spatial autocorrelation in both slides (<xref ref-type="fig" rid="F4">Fig. 4b-c</xref>). As expected, G0 arrest and proliferation scores were inversely correlated, reflecting their spatially mutually exclusive biological states (<xref ref-type="fig" rid="F4">Fig. 4b</xref>), reinforcing EnrichMap’s reliability in recapitulating spatial cell cycle dynamics.</p><p id="P18">We next assessed the spatial association of G0 arrest and proliferation with other cancer hallmarks using curated signatures from Sibai et al. (2025)<sup><xref ref-type="bibr" rid="R35">35</xref></sup>. Proliferation co-localised with hallmarks such as <italic>sustaining proliferative signalling</italic>, <italic>resisting cell death</italic> and <italic>replicative immortality</italic> (<xref ref-type="fig" rid="F4">Fig. 4d-e</xref>, <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 5a</xref>). In contrast, G0 arrest was consistently co-enriched with <italic>avoiding immune destruction</italic> and <italic>tumour promoting inflammation</italic> hallmarks, suggesting G0 regions may represent immune-suppressed niches whose features have been linked with metastatic progression<sup><xref ref-type="bibr" rid="R36">36</xref>, <xref ref-type="bibr" rid="R37">37</xref></sup> and therapy resistance<sup><xref ref-type="bibr" rid="R38">38</xref>–<xref ref-type="bibr" rid="R40">40</xref></sup>. Notably, in patient 1, G0 arrest also aligned with <italic>activation of invasion and metastasis</italic>, a pattern absent in patient 2 (<xref ref-type="fig" rid="F4">Fig. 4d-f</xref>), underscoring interpatient heterogeneity and EnrichMap’s capacity to capture heterogeneous spatial programmes across individuals. To explore the molecular drivers these programmes, we examined gene-level contributions to immune evasion and metastasis (<xref ref-type="fig" rid="F4">Fig. 4g–h</xref>, <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 5b–c</xref>). While overarching spatial patterns were conserved, the specific gene-level contributors varied between patients, revealing interpatient variability in the expression of genes <italic>TRBC1</italic> and <italic>TNXB</italic> (<xref ref-type="fig" rid="F4">Fig. 4h</xref>). Together, these findings highlight EnrichMap’s ability to detect spatially distinct, biologically meaningful programmes, with potential implications for diagnostics and spatially targeted therapies.</p></sec><sec id="S7"><title>Platform-agnostic spatial enrichment with EnrichMap</title><p id="P19">To assess the generalisability of EnrichMap across diverse spatial transcriptomics (ST) platforms, we applied it to datasets spanning a range of spatial resolutions, detection chemistries and gene capture strategies. These included high-resolution Visium HD (10x Genomics), Xenium (10x Genomics), MERFISH (Vizgen) and imaging mass cytometry (Standard Bio), each offering distinct advantages in spatial granularity, throughput and tissue compatibility.</p><p id="P20">In a coronal mouse brain section profiled using Visium HD, which provides denser spatial coverage than standard Visium, EnrichMap generated smooth enrichment landscapes using the same gene signature applied to standard Visium data (<xref ref-type="fig" rid="F5">Fig. 5a</xref>). The top contributing genes exhibited spatial patterns that cohered with known anatomical structures and closely mirrored the EnrichMap scores.</p><p id="P21">In a Xenium dataset of mouse breast cancer tissue, EnrichMap retained its capacity to resolve fine-grained enrichment patterns at single-cell resolution. It identified spatially distinct niches corresponding to normal ductal carcinoma <italic>in situ</italic> (DCIS), triple-negative DCIS and T cells (<xref ref-type="fig" rid="F5">Fig. 5b</xref>), despite the increased sparsity and noise characteristic of single-cell resolved spatial data.</p><p id="P22">In the MERFISH mouse preoptic hypothalamus dataset, which captures high-resolution expression for a targeted gene panel, EnrichMap successfully identified enrichment of ependymal cell signatures in line with original tissue annotations (<xref ref-type="fig" rid="F5">Fig. 5c</xref>). This result underscores EnrichMap’s robustness in settings with constrained gene coverage.</p><p id="P23">Finally, to evaluate its applicability to spatial proteomics, we applied EnrichMap to an imaging mass cytometry dataset<sup><xref ref-type="bibr" rid="R41">41</xref></sup>. Despite the minimal input of only two or three antibodies, EnrichMap captured distinct enrichment patterns associated with apoptotic tumour cells and T cells (<xref ref-type="fig" rid="F5">Fig. 5d</xref>), suggesting its potential utility in low-dimensional spatial data modalities. However, this approach is best suited to cases where each cell type or biological process is uniquely identifiable by a small, non-overlapping set of markers, as overlapping expression patterns could limit the interpretability of signals in sparse antibody panels.</p><p id="P24">Together, these results demonstrate that EnrichMap is platform-agnostic and broadly applicable across diverse spatial omics technologies. Its ability to extract coherent biological signals in both transcriptomic and proteomic data, regardless of resolution or gene coverage, highlights its utility for integrative spatial analysis across experimental platforms.</p></sec></sec><sec id="S8" sec-type="discussion"><title>Discussion</title><p id="P25">The spatial organisation of biological function defines tissue biology, and in diseases like cancer, underpins tumour evolution, immune evasion and treatment response, yet the analytical tools to extract spatially coherent insights remain limited. Here, we introduced EnrichMap, a method that bridges this gap by enabling spatially aware GSEA directly on ST data.</p><p id="P26">EnrichMap addresses a fundamental shortcoming of conventional GSEA methods: the assumption of sample independence. By explicitly modelling spatial context and continuity, EnrichMap produces scores that reflect not only gene expression magnitude but also the spatial structure of underlying biological processes. Through spatial smoothing and spatial confounder correction, the method yields functional maps that better correspond to known histological compartments and tissue architecture. Our analysis of human breast cancer tissues reveals patterns of immune suppression, proliferative gradients and invasive activity that would be missed using classical enrichment approaches. For example, Sibai et al. (2025)<sup><xref ref-type="bibr" rid="R35">35</xref></sup> observed that proliferative signalling co-localised spatially with hallmarks such as <italic>evading growth suppressors</italic>, <italic>senescent cells</italic> and <italic>non-mutational epigenetic reprogramming</italic> across multiple cancer types, patterns that were also captured by EnrichMap. Notably, while their model failed to detect coherent regions associated with <italic>avoiding immune destruction</italic> and <italic>tumour-promoting inflammation</italic>, EnrichMap successfully identified these signals, particularly within G0 arrested regions. These findings highlight EnrichMap’s capacity to detect spatially coherent biological signals beyond the reach of conventional methods, offering a powerful framework for spatially informed functional genomics.</p><p id="P27">A distinguishing feature of EnrichMap is its inclusion of spatial diagnostics, which allow users to assess whether inferred gene set activity exhibits expected spatial continuity. These tools not only strengthen confidence in results but also provide a means to detect potential artefacts or spatial biases in the data. EnrichMap thereby encourages a more principled and statistically grounded interpretation of spatial gene programmes. For instance, from all our analyses, we found that using 10-50 genes, and even up to 100 genes, demonstrates spatial coherence.</p><p id="P28">Compared to other ST tools, which primarily focus on spatial domain detection, spatially variable genes or cell-cell communication, EnrichMap fills an important niche by offering spatial gene programme scoring. While tools like SpatialDE<sup><xref ref-type="bibr" rid="R19">19</xref></sup> and SPARK<sup><xref ref-type="bibr" rid="R18">18</xref></sup> identify where genes vary or cluster, they do not assess coordinated expression of gene sets within a spatial framework. By doing so, EnrichMap supports a richer layer of biological interpretation that is especially valuable in complex diseases such as cancer, where distinct phenotypes arise through the interplay of multiple cell types and signalling pathways within spatially organised niches.</p><p id="P29">Nonetheless, EnrichMap has several limitations. The current framework is designed for 2D ST data and may need adaptation for 3D or multi-slice technologies. Second, spatial smoothing improves noise robustness but can blur sharp boundaries in low-resolution data, making it imperative to assess spatial metrics such as variograms and autocorrelation. While EnrichMap supports user-defined gene weights, finding optimal weights remains a challenge. We addressed this by implementing the coefficient of variation (CV)<sup><xref ref-type="bibr" rid="R29">29</xref></sup> as a simple heuristic to prioritise genes with high relative dispersion, which often reflect spatially patterned, biologically relevant expression. Low-CV genes, such as housekeeping genes, contribute less to spatial variation. Applying EnrichMap to a 10-gene pyramidal layer signature, a housekeeping gene set, and a combined signature showed CV-based weighting correctly prioritised spatially specific genes, though some housekeeping genes (e.g. <italic>B2m</italic>) still ranked highly but lacked spatial specificity. While more complex weighting strategies exist, CV offers an efficient, unsupervised proxy without requiring prior knowledge. To demonstrate this, we applied EnrichMap to the 10-gene pyramidal layer signature (<xref ref-type="fig" rid="F2">Fig. 2a</xref>), a housekeeping gene set<sup><xref ref-type="bibr" rid="R42">42</xref></sup> and a combined signature (<xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 3a-d</xref>), and CV-based weighting correctly prioritised the pyramidal layer genes, even in the mixed set. Notably, <italic>B2m</italic>, a housekeeping gene, ranked the last among the top contributors but clustered with other housekeeping genes, indicating low spatial specificity, and stability as reported by Ho and Patrizi (2021)<sup><xref ref-type="bibr" rid="R42">42</xref></sup>. These results demonstrate both the usefulness and limitations of CV, highlighting the need for contextual interpretation of gene weights.</p><p id="P30">We also envision several exciting directions. Integration with cell-cell interaction frameworks could allow gene set scoring to be modulated not only by spatial proximity but also by inferred communication networks. EnrichMap could also serve as a prior for spatial deconvolution methods, helping refine cell type annotations based on pathway activity. Moreover, extending the framework to incorporate temporal or multi-modal data, such as spatial proteomics or metabolomics, could provide an even more comprehensive view of tissue organisation.</p><p id="P31">In conclusion, EnrichMap provides a spatially aware, interpretable and extensible framework for functional analysis of ST data. By capturing the continuity and structure of gene programme activity across tissues, it offers a powerful approach for spatial functional genomics, particularly in the context of cancer, where tissue architecture and microenvironmental context are critical determinants of disease behaviour and therapeutic response.</p></sec><sec id="S9" sec-type="methods"><title>Methods</title><sec id="S10"><title>EnrichMap: Spatially aware gene set enrichment scoring</title><p id="P32">To compute gene set enrichment scores that incorporate spatial context and account for batch effects, we developed EnrichMap, a Python tool compatible with scverse ecosystem, including <monospace>anndata, scanpy</monospace> and <monospace>squidpy</monospace>. EnrichMap supports multiple gene set signatures, offers optional spatial smoothing and corrects for spatial covariates using generalised additive models (GAM), accommodating the continuity of certain biological features across space.</p><sec id="S11"><title>Raw gene set score computation</title><p id="P33">Let <italic>x<sub>ij</sub></italic> denote the expression of gene <italic>g<sub>i</sub>,</italic> and <italic>w<sub>i</sub></italic> the weight assigned to a gene <italic>g<sub>i</sub></italic>.The raw score <italic>Z<sub>j</sub></italic> for each cell or spot is computed as a weighted average over the genes: <disp-formula id="FD1"><mml:math id="M1"><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p id="P34">A dictionary of gene weights may be provided for the gene signature <italic>S</italic> = {<italic>g</italic><sub>1</sub>, <italic>g</italic><sub>2</sub>, …, <italic>g</italic><sub>3</sub>} or alternatively inferred from the expression matrix (see next section). By default, EnrichMap infers gene weights from the normalised expression values of the signature genes in the matrix (i.e. <monospace>adata.X</monospace>). When a batch label (i.e. representing multiple slides) is specified via <monospace>batch_key</monospace>, z-score normalisation is applied within each batch. For a given batch <italic>b</italic>, batch-normalised scores are computed as: <disp-formula id="FD2"><mml:math id="M2"><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>Z</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>J</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>Z</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p id="P35">where <italic>μ<sub>b</sub></italic> and <italic>σ<sub>b</sub></italic> are the mean and standard deviation of raw scores within batch <italic>b</italic>, respectively.</p></sec><sec id="S12"><title>Spatial smoothing</title><p id="P36">To incorporate local spatial context, we construct a spatial neighbours’ graph leveraging <monospace>squidpy</monospace>’s <monospace>spatial_neighbors()</monospace> function. For each cell or spot, the smoothed score <inline-formula><mml:math id="M3"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Z</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>J</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>, is calculated as a weighted average of the scores of its neighbours: <disp-formula id="FD3"><mml:math id="M4"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Z</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>J</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mfrac><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>·</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p id="P37">where <italic>A</italic> is the adjacency matrix of the spatial graph and <italic>N</italic><sub>(<italic>j</italic>)</sub> denotes the neighbours of the cell <italic>j</italic>.</p></sec><sec id="S13"><title>Correcting spatial covariates</title><p id="P38">To account for spatial trends in gene expression, we fit a generalised additive model (GAM) using spatial coordinates as smooth covariates: <disp-formula id="FD4"><mml:math id="M5"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>Z</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>J</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>α</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>x</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>ε</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula></p><p id="P39">Here, <italic>f</italic><sub>1</sub> and <italic>f</italic><sub>2</sub> are spline functions of the <italic>x</italic> and <italic>y</italic> spatial coordinates, respectively, <italic>α</italic> is the intercept and <italic>ε<sub>j</sub></italic> is the residuals. The corrected score is then taken as the model residual: <disp-formula id="FD5"><mml:math id="M6"><mml:mrow><mml:mi>C</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>c</mml:mi><mml:mi>t</mml:mi><mml:mi>e</mml:mi><mml:msub><mml:mi>d</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>Z</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mover accent="true"><mml:mi>Z</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo stretchy="true">^</mml:mo></mml:mover></mml:mrow><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></disp-formula></p><p id="P40">All steps are integrated into the <monospace>score</monospace>() function available under <monospace>enrichmap.tools</monospace> module. The final corrected scores for each signature are stored in <monospace>adata.obs</monospace>. We also implemented a wrapper function <monospace>spatial_enrichmap</monospace>() for intuitive visualisation of scores under <monospace>enrichmap.plotting</monospace> module.</p></sec></sec><sec id="S14"><title>Inferring gene weights by the coefficient of variation</title><p id="P41">To infer gene weights, EnrichMap uses the coefficient of variation (CV)<xref ref-type="bibr" rid="R29">29</xref>. For each gene <italic>g<sub>i</sub></italic> we compute the mean <italic>μ<sub>i</sub></italic> and standard deviation <italic>σ<sub>i</sub></italic> of its expression across all cells or spots. The coefficient of variation is defined as: <disp-formula id="FD6"><mml:math id="M7"><mml:mrow><mml:mi>C</mml:mi><mml:msub><mml:mi>V</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>σ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p id="P42">For genes where <italic>μ<sub>i</sub></italic> = 0, the CV is set to zero to avoid division by zero. The result is a dictionary <italic>W</italic> mapping gene names to their inferred weights: <disp-formula id="FD7"><mml:math id="M8"><mml:mrow><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>↦</mml:mo><mml:mi>C</mml:mi><mml:msub><mml:mi>V</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mi>ϵ</mml:mi><mml:mi>G</mml:mi></mml:mrow></mml:math></disp-formula></p><p id="P43">This scheme captures relative variability and upweights genes with higher dynamic expression, which may highlight spatially contextual gene expression patterns more robustly than uniform weighting.</p></sec><sec id="S15"><title>Other functionalities</title><p id="P44">For interpretation of the spatial gene set enrichment scores, we developed several visual and analytical tools. For example, the <monospace>gene_contributions_heatmap()</monospace> function visualises the expression of the top contributing genes to any given enrichment score across all data points in a slide. Genes are sorted by expression level, and the heatmap highlights which genes drive specific spatial patterns across conditions or samples. Similarly, to explore broader patterns in gene contributions, we implemented the <monospace>gene_contributions_pca</monospace>() function, which applies principal component analysis (PCA) to reduce the dimensionality of gene-level weights of a given enrichment score. This approach facilitates the identification of dominant contribution patterns and gene clusters.</p><p id="P45">Spatial autocorrelation of enrichment scores was assessed using the <monospace>morans_correlogram()</monospace> function. This method computes Moran’s <italic>I</italic> statistic over increasing neighbourhood distances, generating a spatial correlogram that captures how spatial structure changes with distance. The implementation draws on geospatial statistics functions from the <monospace>esda</monospace> and <monospace>libpysal</monospace> libraries<sup><xref ref-type="bibr" rid="R23">23</xref>, <xref ref-type="bibr" rid="R24">24</xref></sup>.</p><p id="P46">Finally, spatial continuity and heterogeneity can be evaluated using the <monospace>variogram</monospace>() function, which plots a semi-variogram for a given enrichment score. This classical geostatistical tool estimates how variance evolves with increasing spatial lag and relies on functionality from the <monospace>esda</monospace> and <monospace>libpysal</monospace> libraries<sup><xref ref-type="bibr" rid="R23">23</xref>, <xref ref-type="bibr" rid="R24">24</xref></sup>.</p></sec><sec id="S16"><title>Spatial transcriptomics datasets</title><p id="P47">All tests of the EnrichMap package were performed using a pre-processed and annotated coronal section of the mouse brain dataset provided by the <monospace>squidpy</monospace> package<sup><xref ref-type="bibr" rid="R43">43</xref></sup>. The raw version of this dataset is publicly available at <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/spatial-gene-expression/datasets">https://support.10xgenomics.com/spatial-gene-expression/datasets</ext-link>. To demonstrate cross platform compatibility of EnrichMap, we additionally tested EnrichMap on three further datasets: a MERFISH dataset from Moffitt et al (2018)<sup><xref ref-type="bibr" rid="R44">44</xref></sup>, and Visium HD mouse brain and Xenium mouse breast cancer datasets, also available from <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/spatial-gene-expression/datasets">https://support.10xgenomics.com/spatial-gene-expression/datasets</ext-link>.</p><p id="P48">As the datasets were provided with raw counts, we first filtered for genes with at least 1 count in a single spot. Following this, we applied <monospace>scanpy</monospace>’s normalisation and log1p transformation, except in analyses specifically designed to evaluate the impact of different normalisation strategies on EnrichMap scores. In those cases, we compared standard log(<italic>X</italic> + 1) (log1p) transformation with alternative approaches including pooling-based size factor estimation (log1p with estimated size factors)<xref ref-type="bibr" rid="R31">31</xref>, shifted logarithm <inline-formula><mml:math id="M9"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>log</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mi>y</mml:mi><mml:mi>s</mml:mi></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula><sup><xref ref-type="bibr" rid="R30">30</xref></sup>, analytic Pearson residuals <inline-formula><mml:math id="M10"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>g</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msqrt><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>g</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:msubsup><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>g</mml:mi><mml:mi>c</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula><sup><xref ref-type="bibr" rid="R32">32</xref></sup> and square root transformation <inline-formula><mml:math id="M11"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:msqrt><mml:mo>·</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mn>4</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>.</p></sec><sec id="S17"><title>Simulated spatial transcriptomic dataset</title><p id="P49">A hexagonal grid mimicking 10X Visium layout was generated with fixed spacing to simulate spatial coordinates. Human gene symbols (n = 15,000) were sampled from the HGNC database [<ext-link ext-link-type="uri" xlink:href="https://www.genenames.org">https://www.genenames.org</ext-link>]. Spatially coherent clusters were assigned by randomly sampling biological labels and reinforcing local neighbourhood similarity. Gene expression was simulated using a Poisson distribution, with elevated expression for a random gene set in cluster 2. The resulting data were stored in an AnnData object with spatial coordinates.</p></sec><sec id="S18"><title>Gene set signatures</title><p id="P50">For the Visium mouse brain dataset, differentially expressed genes (DEGs) were identified from selected clusters using a minimum log<sub>2</sub> fold change of 1 and a detection fraction of 0.5. The top 10 genes were then used for scoring on the Visium and 50 genes for the Visium HD mouse brain dataset. The same strategy was applied to the simulated dataset. To assess spatial metrics and performance, we generated gene sets of varying sizes by selecting the top 2, 5, 10, 20, 50, 100, 200 and 500 genes from the DEG lists. Additionally, a list of mouse housekeeping genes was used to illustrate the impact of gene weighting<sup><xref ref-type="bibr" rid="R42">42</xref></sup>.</p><p id="P51">For the Xenium mouse breast cancer data set, we employed two signatures for identifying triple negative ductal carcinoma <italic>in situ</italic> (DCIS) and normal DCIS regions reported by Rebbeck et al. (2022)<sup><xref ref-type="bibr" rid="R45">45</xref></sup>. We also used an 8-gene cytotoxic T cell signature<sup><xref ref-type="bibr" rid="R46">46</xref></sup> to highlight T cells across invasive and non-invasive regions of the breast tumour.</p><p id="P52">The G0 arrest signature was calculated by EnrichMap generated scores of 27 upregulated and 112 downregulated genes described by us in Wiecek et al (2023)<sup><xref ref-type="bibr" rid="R47">47</xref></sup>. A final G0 arrest score was obtained by subtracting the two scores. A unique proliferation signature<sup><xref ref-type="bibr" rid="R34">34</xref></sup> was then used for validation. Cancer hallmark gene sets were generated as described in Sibai et al (2025)<sup><xref ref-type="bibr" rid="R35">35</xref></sup>.</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary Figures</label><media xlink:href="EMS206132-supplement-Supplementary_Figures.pdf" mimetype="application" mime-subtype="pdf" id="d74aAcEbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S19"><title>Acknowledgements</title><p>MS and CC were supported by a UKRI Future Leaders Fellowship (MR/T042184/1, MR/Y034031/1). Work in MS’s lab was supported by a BBSRC equipment grant (BB/R01356X/1) and a Wellcome Institutional Strategic Support Fund (204841/Z/16/Z). We thank Ms Emma Champneys for her critical reading of the manuscript.</p></ack><sec id="S20" sec-type="data-availability"><title>Data availability</title><p id="P53">The mouse brain coronal section (Visium), mouse preoptic hypothalamus (MERFISH) and human breast cancer (imaging mass cytometry) datasets are available through the <monospace>squidpy</monospace> package<sup><xref ref-type="bibr" rid="R43">43</xref></sup>. Mouse breast cancer (Xenium) data can be accessed via 10x Genomics at <ext-link ext-link-type="uri" xlink:href="https://support.10xgenomics.com/spatial-gene-expression/datasets">https://support.10xgenomics.com/spatial-gene-expression/datasets</ext-link>. Processed Visium from human breast cancer samples and Visium HD mouse coronal brain section data are publicly available on Zenodo (DOI: 10.5281/zenodo.15438169).</p></sec><sec id="S21" sec-type="data-availability"><title>Code availability</title><p id="P54">EnrichMap is a pip installable Python package available at <ext-link ext-link-type="uri" xlink:href="https://github.com/secrierlab/enrichmap">https://github.com/secrierlab/enrichmap</ext-link>, with documentation at <ext-link ext-link-type="uri" xlink:href="https://enrichmap.readthedocs.io/en/stable">https://enrichmap.readthedocs.io/en/stable</ext-link>. All the code to reproduce the results of the analyses can be found at the following repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/secrierlab/enrichmap_reproducibility">https://github.com/secrierlab/enrichmap_reproducibility</ext-link>.</p></sec><fn-group><fn id="FN1" fn-type="con"><p id="P55"><bold>Author’s contributions</bold></p><p id="P56">CC conceptualised and conducted the study. MS supervised the study and secured the funding.</p><p id="P57">CC wrote the manuscript with input from MS.</p></fn><fn id="FN2"><p id="P58"><bold>Corresponding author</bold></p><p id="P59">Correspondence to Cenk Celik and Maria Secrier.</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haynes</surname><given-names>NM</given-names></name><name><surname>Chadwick</surname><given-names>TB</given-names></name><name><surname>Parker</surname><given-names>BS</given-names></name></person-group><article-title>The complexity of immune evasion mechanisms throughout the metastatic cascade</article-title><source>Nat Immunol</source><year>2024</year><volume>25</volume><fpage>1793</fpage><lpage>1808</lpage><pub-id pub-id-type="pmid">39285252</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rakina</surname><given-names>M</given-names></name><name><surname>Larionova</surname><given-names>I</given-names></name><name><surname>Kzhyshkowska</surname><given-names>J</given-names></name></person-group><article-title>Macrophage diversity in human cancers: New insight provided by single-cell resolution and spatial context</article-title><source>Heliyon</source><year>2024</year><volume>10</volume><elocation-id>e28332</elocation-id><pub-id pub-id-type="pmcid">PMC10988020</pub-id><pub-id pub-id-type="pmid">38571605</pub-id><pub-id pub-id-type="doi">10.1016/j.heliyon.2024.e28332</pub-id></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Attieh</surname><given-names>Y</given-names></name><name><surname>Vignjevic</surname><given-names>DM</given-names></name></person-group><article-title>The hallmarks of CAFs in cancer invasion</article-title><source>Eur J Cell Biol</source><year>2016</year><volume>95</volume><fpage>493</fpage><lpage>502</lpage><pub-id pub-id-type="pmid">27575401</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Quail</surname><given-names>DF</given-names></name><name><surname>Joyce</surname><given-names>JA</given-names></name></person-group><article-title>Microenvironmental regulation of tumor progression and metastasis</article-title><source>Nat Med</source><year>2013</year><volume>19</volume><fpage>1423</fpage><lpage>1437</lpage><pub-id pub-id-type="pmcid">PMC3954707</pub-id><pub-id pub-id-type="pmid">24202395</pub-id><pub-id pub-id-type="doi">10.1038/nm.3394</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Khalaf</surname><given-names>K</given-names></name><etal/></person-group><article-title>Aspects of the Tumor Microenvironment Involved in Immune Resistance and Drug Resistance</article-title><source>Front Immunol</source><year>2021</year><volume>12</volume><elocation-id>656364</elocation-id><pub-id pub-id-type="pmcid">PMC8190405</pub-id><pub-id pub-id-type="pmid">34122412</pub-id><pub-id pub-id-type="doi">10.3389/fimmu.2021.656364</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pu</surname><given-names>Y</given-names></name><etal/></person-group><article-title>Drug-tolerant persister cells in cancer: the cutting edges and future directions</article-title><source>Nat Rev Clin Oncol</source><year>2023</year><volume>20</volume><fpage>799</fpage><lpage>813</lpage><pub-id pub-id-type="pmid">37749382</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Recasens</surname><given-names>A</given-names></name><name><surname>Munoz</surname><given-names>L</given-names></name></person-group><article-title>Targeting Cancer Cell Dormancy</article-title><source>Trends Pharmacol Sci</source><year>2019</year><volume>40</volume><fpage>128</fpage><lpage>141</lpage><pub-id pub-id-type="pmid">30612715</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marx</surname><given-names>V</given-names></name></person-group><article-title>Method of the Year: spatially resolved transcriptomics</article-title><source>Nat Methods</source><year>2021</year><volume>18</volume><fpage>9</fpage><lpage>14</lpage><pub-id pub-id-type="pmid">33408395</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xia</surname><given-names>C</given-names></name><name><surname>Fan</surname><given-names>J</given-names></name><name><surname>Emanuel</surname><given-names>G</given-names></name><name><surname>Hao</surname><given-names>J</given-names></name><name><surname>Zhuang</surname><given-names>X</given-names></name></person-group><article-title>Spatial transcriptome profiling by MERFISH reveals subcellular RNA compartmentalization and cell cycledependent gene expression</article-title><source>Proc Natl Acad Sci U S A</source><year>2019</year><volume>116</volume><fpage>19490</fpage><lpage>19499</lpage><pub-id pub-id-type="pmcid">PMC6765259</pub-id><pub-id pub-id-type="pmid">31501331</pub-id><pub-id pub-id-type="doi">10.1073/pnas.1912459116</pub-id></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mootha</surname><given-names>VK</given-names></name><etal/></person-group><article-title>PGC-1alpha-responsive genes involved in oxidative phosphorylation are coordinately downregulated in human diabetes</article-title><source>Nat Genet</source><year>2003</year><volume>34</volume><fpage>267</fpage><lpage>273</lpage><pub-id pub-id-type="pmid">12808457</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aibar</surname><given-names>S</given-names></name><etal/></person-group><article-title>SCENIC: single-cell regulatory network inference and clustering</article-title><source>Nat Methods</source><year>2017</year><volume>14</volume><fpage>1083</fpage><lpage>1086</lpage><pub-id pub-id-type="pmcid">PMC5937676</pub-id><pub-id pub-id-type="pmid">28991892</pub-id><pub-id pub-id-type="doi">10.1038/nmeth.4463</pub-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barbie</surname><given-names>DA</given-names></name><etal/></person-group><article-title>Systematic RNA interference reveals that oncogenic KRAS-driven cancers require TBK1</article-title><source>Nature</source><year>2009</year><volume>462</volume><fpage>108</fpage><lpage>112</lpage><pub-id pub-id-type="pmcid">PMC2783335</pub-id><pub-id pub-id-type="pmid">19847166</pub-id><pub-id pub-id-type="doi">10.1038/nature08460</pub-id></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hanzelmann</surname><given-names>S</given-names></name><name><surname>Castelo</surname><given-names>R</given-names></name><name><surname>Guinney</surname><given-names>J</given-names></name></person-group><article-title>GSVA: gene set variation analysis for microarray and RNA-seq data</article-title><source>BMC Bioinformatics</source><year>2013</year><volume>14</volume><fpage>7</fpage><pub-id pub-id-type="pmcid">PMC3618321</pub-id><pub-id pub-id-type="pmid">23323831</pub-id><pub-id pub-id-type="doi">10.1186/1471-2105-14-7</pub-id></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Subramanian</surname><given-names>A</given-names></name><etal/></person-group><article-title>Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles</article-title><source>Proc Natl Acad Sci U S A</source><year>2005</year><volume>102</volume><fpage>15545</fpage><lpage>15550</lpage><pub-id pub-id-type="pmcid">PMC1239896</pub-id><pub-id pub-id-type="pmid">16199517</pub-id><pub-id pub-id-type="doi">10.1073/pnas.0506580102</pub-id></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhao</surname><given-names>E</given-names></name><etal/></person-group><article-title>Spatial transcriptomics at subspot resolution with BayesSpace</article-title><source>Nat Biotechnol</source><year>2021</year><volume>39</volume><fpage>1375</fpage><lpage>1384</lpage><pub-id pub-id-type="pmcid">PMC8763026</pub-id><pub-id pub-id-type="pmid">34083791</pub-id><pub-id pub-id-type="doi">10.1038/s41587-021-00935-2</pub-id></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Varrone</surname><given-names>M</given-names></name><name><surname>Tavernari</surname><given-names>D</given-names></name><name><surname>Santamaria-Martinez</surname><given-names>A</given-names></name><name><surname>Walsh</surname><given-names>LA</given-names></name><name><surname>Ciriello</surname><given-names>G</given-names></name></person-group><article-title>CellCharter reveals spatial cell niches associated with tissue remodeling and cell plasticity</article-title><source>Nat Genet</source><year>2024</year><volume>56</volume><fpage>74</fpage><lpage>84</lpage><pub-id pub-id-type="pmid">38066188</pub-id></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Withnell</surname><given-names>E</given-names></name><name><surname>Secrier</surname><given-names>M</given-names></name></person-group><article-title>SpottedPy quantifies relationships between spatial transcriptomic hotspots and uncovers environmental cues of epithelial-mesenchymal plasticity in breast cancer</article-title><source>Genome Biol</source><year>2024</year><volume>25</volume><fpage>289</fpage><pub-id pub-id-type="pmcid">PMC11552145</pub-id><pub-id pub-id-type="pmid">39529126</pub-id><pub-id pub-id-type="doi">10.1186/s13059-024-03428-y</pub-id></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sun</surname><given-names>S</given-names></name><name><surname>Zhu</surname><given-names>J</given-names></name><name><surname>Zhou</surname><given-names>X</given-names></name></person-group><article-title>Statistical analysis of spatial expression patterns for spatially resolved transcriptomic studies</article-title><source>Nat Methods</source><year>2020</year><volume>17</volume><fpage>193</fpage><lpage>200</lpage><pub-id pub-id-type="pmcid">PMC7233129</pub-id><pub-id pub-id-type="pmid">31988518</pub-id><pub-id pub-id-type="doi">10.1038/s41592-019-0701-7</pub-id></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Svensson</surname><given-names>V</given-names></name><name><surname>Teichmann</surname><given-names>SA</given-names></name><name><surname>Stegle</surname><given-names>O</given-names></name></person-group><article-title>SpatialDE: identification of spatially variable genes</article-title><source>Nat Methods</source><year>2018</year><volume>15</volume><fpage>343</fpage><lpage>346</lpage><pub-id pub-id-type="pmcid">PMC6350895</pub-id><pub-id pub-id-type="pmid">29553579</pub-id><pub-id pub-id-type="doi">10.1038/nmeth.4636</pub-id></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Troulé</surname><given-names>K</given-names></name><etal/></person-group><article-title>CellPhoneDB v5: inferring cell-cell communication from single-cell multiomics data</article-title><source>arXiv:2311.04567</source><year>2023</year><pub-id pub-id-type="pmid">40133495</pub-id></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rao</surname><given-names>N</given-names></name><etal/></person-group><article-title>Charting spatial ligand-target activity using Renoir</article-title><source>bioRxiv</source><year>2024</year></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Seal</surname><given-names>S</given-names></name><name><surname>Neelon</surname><given-names>B</given-names></name></person-group><article-title>SpaceBF: Spatial coexpression analysis using Bayesian Fused approaches in spatial omics datasets</article-title><source>bioRxiv</source><year>2025</year><elocation-id>2025.2003.2029.646124</elocation-id></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Anselin</surname><given-names>L</given-names></name><name><surname>Smirnov</surname><given-names>O</given-names></name></person-group><article-title>Efficient Algorithms for Constructing Proper Higher Order Spatial Lag Operators*</article-title><source>Journal of Regional Science</source><year>2006</year><volume>36</volume><fpage>67</fpage><lpage>89</lpage></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Rey</surname><given-names>SJ</given-names></name><name><surname>Anselin</surname><given-names>L</given-names></name></person-group><source>Handbook of Applied Spatial Analysis: Software Tools, Methods and Applications</source><person-group person-group-type="editor"><name><surname>Fischer</surname><given-names>MM</given-names></name><name><surname>Getis</surname><given-names>A</given-names></name></person-group><publisher-name>Springer Berlin Heidelberg</publisher-name><publisher-loc>Berlin, Heidelberg</publisher-loc><year>2010</year><fpage>175</fpage><lpage>193</lpage></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Andreatta</surname><given-names>M</given-names></name><name><surname>Carmona</surname><given-names>SJ</given-names></name></person-group><article-title>UCell: Robust and scalable single-cell gene signature scoring</article-title><source>Comput Struct Biotechnol J</source><year>2021</year><volume>19</volume><fpage>3796</fpage><lpage>3798</lpage><pub-id pub-id-type="pmcid">PMC8271111</pub-id><pub-id pub-id-type="pmid">34285779</pub-id><pub-id pub-id-type="doi">10.1016/j.csbj.2021.06.043</pub-id></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hao</surname><given-names>Y</given-names></name><etal/></person-group><article-title>Integrated analysis of multimodal single-cell data</article-title><source>Cell</source><year>2021</year><volume>184</volume><fpage>3573</fpage><lpage>3587</lpage><elocation-id>e3529</elocation-id><pub-id pub-id-type="pmcid">PMC8238499</pub-id><pub-id pub-id-type="pmid">34062119</pub-id><pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wolf</surname><given-names>FA</given-names></name><name><surname>Angerer</surname><given-names>P</given-names></name><name><surname>Theis</surname><given-names>FJ</given-names></name></person-group><article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title><source>Genome Biol</source><year>2018</year><volume>19</volume><fpage>15</fpage><pub-id pub-id-type="pmcid">PMC5802054</pub-id><pub-id pub-id-type="pmid">29409532</pub-id><pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Benavides-Piccione</surname><given-names>R</given-names></name><etal/></person-group><article-title>Key morphological features of human pyramidal neurons</article-title><source>Cereb Cortex</source><year>2024</year><volume>34</volume><pub-id pub-id-type="pmcid">PMC11094408</pub-id><pub-id pub-id-type="pmid">38745556</pub-id><pub-id pub-id-type="doi">10.1093/cercor/bhae180</pub-id></element-citation></ref><ref id="R29"><label>29</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pearson</surname><given-names>K</given-names></name></person-group><article-title>Note on Regression and Inheritance in the Case of Two Parents</article-title><source>Proceedings of the Royal Society of London</source><year>1895</year><fpage>240</fpage><lpage>242</lpage></element-citation></ref><ref id="R30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dorfman</surname><given-names>R</given-names></name></person-group><article-title>A note on the! d-method for finding variance formulae</article-title><source>Biometric Bulletin</source><year>1938</year></element-citation></ref><ref id="R31"><label>31</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lun</surname><given-names>AT</given-names></name><name><surname>Bach</surname><given-names>K</given-names></name><name><surname>Marioni</surname><given-names>JC</given-names></name></person-group><article-title>Pooling across cells to normalize single-cell RNA sequencing data with many zero counts</article-title><source>Genome Biol</source><year>2016</year><volume>17</volume><fpage>75</fpage><pub-id pub-id-type="pmcid">PMC4848819</pub-id><pub-id pub-id-type="pmid">27122128</pub-id><pub-id pub-id-type="doi">10.1186/s13059-016-0947-7</pub-id></element-citation></ref><ref id="R32"><label>32</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lause</surname><given-names>J</given-names></name><name><surname>Berens</surname><given-names>P</given-names></name><name><surname>Kobak</surname><given-names>D</given-names></name></person-group><article-title>Analytic Pearson residuals for normalization of single-cell RNA-seq UMI data</article-title><source>Genome Biol</source><year>2021</year><volume>22</volume><fpage>258</fpage><pub-id pub-id-type="pmcid">PMC8419999</pub-id><pub-id pub-id-type="pmid">34488842</pub-id><pub-id pub-id-type="doi">10.1186/s13059-021-02451-7</pub-id></element-citation></ref><ref id="R33"><label>33</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Celik</surname><given-names>C</given-names></name><etal/></person-group><article-title>Balancing tumour proliferation and sustained cell cycle arrest through proteostasis remodelling drives immune niche compartmentalisation in breast cancer</article-title><source>bioRxiv</source><year>2025</year><elocation-id>2025.2001.2008.632014</elocation-id></element-citation></ref><ref id="R34"><label>34</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nielsen</surname><given-names>TO</given-names></name><etal/></person-group><article-title>A comparison of PAM50 intrinsic subtyping with immunohistochemistry and clinical prognostic factors in tamoxifen-treated estrogen receptor-positive breast cancer</article-title><source>Clin Cancer Res</source><year>2010</year><volume>16</volume><fpage>5222</fpage><lpage>5232</lpage><pub-id pub-id-type="pmcid">PMC2970720</pub-id><pub-id pub-id-type="pmid">20837693</pub-id><pub-id pub-id-type="doi">10.1158/1078-0432.CCR-10-1282</pub-id></element-citation></ref><ref id="R35"><label>35</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sibai</surname><given-names>M</given-names></name><etal/></person-group><article-title>The spatial landscape of cancer hallmarks reveals patterns of tumor ecological dynamics and drug sensitivity</article-title><source>Cell Rep</source><year>2025</year><volume>44</volume><elocation-id>115229</elocation-id><pub-id pub-id-type="pmid">39864059</pub-id></element-citation></ref><ref id="R36"><label>36</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barkan</surname><given-names>D</given-names></name><etal/></person-group><article-title>Metastatic growth from dormant cells induced by a col-I-enriched fibrotic environment</article-title><source>Cancer Res</source><year>2010</year><volume>70</volume><fpage>5706</fpage><lpage>5716</lpage><pub-id pub-id-type="pmcid">PMC3436125</pub-id><pub-id pub-id-type="pmid">20570886</pub-id><pub-id pub-id-type="doi">10.1158/0008-5472.CAN-09-2356</pub-id></element-citation></ref><ref id="R37"><label>37</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sosa</surname><given-names>MS</given-names></name><name><surname>Bragado</surname><given-names>P</given-names></name><name><surname>Aguirre-Ghiso</surname><given-names>JA</given-names></name></person-group><article-title>Mechanisms of disseminated cancer cell dormancy: an awakening field</article-title><source>Nat Rev Cancer</source><year>2014</year><volume>14</volume><fpage>611</fpage><lpage>622</lpage><pub-id pub-id-type="pmcid">PMC4230700</pub-id><pub-id pub-id-type="pmid">25118602</pub-id><pub-id pub-id-type="doi">10.1038/nrc3793</pub-id></element-citation></ref><ref id="R38"><label>38</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Blasco</surname><given-names>MT</given-names></name><name><surname>Espuny</surname><given-names>I</given-names></name><name><surname>Gomis</surname><given-names>RR</given-names></name></person-group><article-title>Ecology and evolution of dormant metastasis</article-title><source>Trends Cancer</source><year>2022</year><volume>8</volume><fpage>570</fpage><lpage>582</lpage><pub-id pub-id-type="pmid">35370115</pub-id></element-citation></ref><ref id="R39"><label>39</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Puig</surname><given-names>I</given-names></name><etal/></person-group><article-title>TET2 controls chemoresistant slow-cycling cancer cell survival and tumor recurrence</article-title><source>J Clin Invest</source><year>2018</year><volume>128</volume><fpage>3887</fpage><lpage>3905</lpage><pub-id pub-id-type="pmcid">PMC6118637</pub-id><pub-id pub-id-type="pmid">29944140</pub-id><pub-id pub-id-type="doi">10.1172/JCI96393</pub-id></element-citation></ref><ref id="R40"><label>40</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rehman</surname><given-names>SK</given-names></name><etal/></person-group><article-title>Colorectal Cancer Cells Enter a Diapause-like DTP State to Survive Chemotherapy</article-title><source>Cell</source><year>2021</year><volume>184</volume><fpage>226</fpage><lpage>242</lpage><elocation-id>e221</elocation-id><pub-id pub-id-type="pmcid">PMC8437243</pub-id><pub-id pub-id-type="pmid">33417860</pub-id><pub-id pub-id-type="doi">10.1016/j.cell.2020.11.018</pub-id></element-citation></ref><ref id="R41"><label>41</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jackson</surname><given-names>HW</given-names></name><etal/></person-group><article-title>The single-cell pathology landscape of breast cancer</article-title><source>Nature</source><year>2020</year><volume>578</volume><fpage>615</fpage><lpage>620</lpage><pub-id pub-id-type="pmid">31959985</pub-id></element-citation></ref><ref id="R42"><label>42</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ho</surname><given-names>KH</given-names></name><name><surname>Patrizi</surname><given-names>A</given-names></name></person-group><article-title>Assessment of common housekeeping genes as reference for gene expression studies using RT-qPCR in mouse choroid plexus</article-title><source>Sci Rep</source><year>2021</year><volume>11</volume><elocation-id>3278</elocation-id><pub-id pub-id-type="pmcid">PMC7870894</pub-id><pub-id pub-id-type="pmid">33558629</pub-id><pub-id pub-id-type="doi">10.1038/s41598-021-82800-5</pub-id></element-citation></ref><ref id="R43"><label>43</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Palla</surname><given-names>G</given-names></name><etal/></person-group><article-title>Squidpy: a scalable framework for spatial omics analysis</article-title><source>Nat Methods</source><year>2022</year><volume>19</volume><fpage>171</fpage><lpage>178</lpage><pub-id pub-id-type="pmcid">PMC8828470</pub-id><pub-id pub-id-type="pmid">35102346</pub-id><pub-id pub-id-type="doi">10.1038/s41592-021-01358-2</pub-id></element-citation></ref><ref id="R44"><label>44</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moffitt</surname><given-names>JR</given-names></name><etal/></person-group><article-title>Molecular, spatial, and functional single-cell profiling of the hypothalamic preoptic region</article-title><source>Science</source><year>2018</year><volume>362</volume><pub-id pub-id-type="pmcid">PMC6482113</pub-id><pub-id pub-id-type="pmid">30385464</pub-id><pub-id pub-id-type="doi">10.1126/science.aau5324</pub-id></element-citation></ref><ref id="R45"><label>45</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rebbeck</surname><given-names>CA</given-names></name><etal/></person-group><article-title>Gene expression signatures of individual ductal carcinoma in situ lesions identify processes and biomarkers associated with progression towards invasive ductal carcinoma</article-title><source>Nat Commun</source><year>2022</year><volume>13</volume><elocation-id>3399</elocation-id><pub-id pub-id-type="pmcid">PMC9192778</pub-id><pub-id pub-id-type="pmid">35697697</pub-id><pub-id pub-id-type="doi">10.1038/s41467-022-30573-4</pub-id></element-citation></ref><ref id="R46"><label>46</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Franzen</surname><given-names>O</given-names></name><name><surname>Gan</surname><given-names>LM</given-names></name><name><surname>Bjorkegren</surname><given-names>JLM</given-names></name></person-group><article-title>PanglaoDB: a web server for exploration of mouse and human single-cell RNA sequencing data</article-title><source>Database (Oxford)</source><year>2019</year><volume>2019</volume><pub-id pub-id-type="pmcid">PMC6450036</pub-id><pub-id pub-id-type="pmid">30951143</pub-id><pub-id pub-id-type="doi">10.1093/database/baz046</pub-id></element-citation></ref><ref id="R47"><label>47</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wiecek</surname><given-names>AJ</given-names></name><etal/></person-group><article-title>Genomic hallmarks and therapeutic implications of G0 cell cycle arrest in cancer</article-title><source>Genome Biol</source><year>2023</year><volume>24</volume><fpage>128</fpage><pub-id pub-id-type="pmcid">PMC10204193</pub-id><pub-id pub-id-type="pmid">37221612</pub-id><pub-id pub-id-type="doi">10.1186/s13059-023-02963-4</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Fig. 1</label><caption><title>EnrichMap presents a spatially informed framework for gene set enrichment in spatial transcriptomics data.</title><p><bold>a</bold>, Overview of spatially aware gene set enrichment score workflow. EnrichMap calculates weighted raw scores, smoothens the scores based on spatial neighbourhood graph and corrects for spatial covariates, producing spatially informed enrichment scores. <bold>b-c</bold>, EnrichMap provides functionalities to identify the top contributing genes in a gene set, defined either by principal components (left) or by gene expression (right) <bold>(b)</bold>, and geostatistical analytical toolkit to aid the enrichment score’s spatial interpretability <bold>(c)</bold>. <bold>d</bold>, EnrichMap showcased on a simulated Visium-like dataset, where a 10-gene signature was defined to identify cluster 2 and compared with conventional scoring methods, including AUCell, Z score, Scanpy, ssGSEA and GSVA. <bold>e</bold>, Spatial autocorrelation scores both in Moran’s <italic>I</italic> (top) and Geary’s <italic>C</italic> (bottom). <bold>f</bold>, Experimental variograms across different scoring methods (see <xref ref-type="supplementary-material" rid="SD1">Supplementary Fig. 1</xref> for details). <bold>g</bold>, Moran’s scatter plot reveals a strong positive spatial autocorrelation, with a Moran’s <italic>I</italic> of 0.79, indicating that spatial units with high (or low) attribute values tend to be adjacent to others with similarly high (or low) values. This is evident from the dense clustering of points in the top-right (high-high) and bottom-left (low-low) quadrants, suggesting the scores exhibit significant spatial structuring. <bold>h-i</bold>, Top contributing genes <bold>(h)</bold> demonstrate consistent spatial coherence with their individual expression <bold>(i)</bold>.</p></caption><graphic xlink:href="EMS206132-f001"/></fig><fig id="F2" position="float"><label>Fig. 2</label><caption><title>Laminar organisation in the mouse brain revealed by spatially informed gene set enrichment.</title><p><bold>a</bold>, An annotated Visium data set demonstrating structured anatomy of the mouse brain (left). A 10-gene signature was used to score for the pyramidal layer (right). <bold>b</bold>, EnrichMap scores demonstrate smoother tissue structure compared to AUCell, Z score, Scanpy, ssGSEA and GSVA. <bold>c</bold>, Variograms across different scoring methods highlight that EnrichMap has the best spatial structure, which increases sharply then plateaus, showing strong short-range structure, followed by ssGSEA. <bold>d</bold>, Moran’s scatter plot reveals a strong positive spatial autocorrelation of EnrichMap scores, with a Moran’s <italic>I</italic> of 0.86 with <italic>p</italic> &lt; 0.001. <bold>e</bold>, Bar plot shows F1 scores across different scoring methods in identifying the pyramidal cells. EnrichMap outperforms all other methods, achieving the highest score. <bold>f-g</bold>, EnrichMap finds the genes <italic>Grin2a</italic>, <italic>Scn3b</italic> and <italic>Tmsb4x</italic> as top contributors that clustered together <bold>(f)</bold>, aligning with their individual expression <bold>(g)</bold>.</p></caption><graphic xlink:href="EMS206132-f002"/></fig><fig id="F3" position="float"><label>Fig. 3</label><caption><title>EnrichMap produces consistent enrichment scores across gene set sizes and normalisation methods.</title><p><bold>a</bold>, Spatial enrichment scores generated by EnrichMap using gene sets of varying sizes. <bold>b</bold>, Variograms across gene set sizes demonstrate stability for signatures comprising 10–50 genes. <bold>c</bold>, Moran’s <italic>I</italic> indicates peak spatial autocorrelation with a 50-gene signature. <bold>d</bold>, Enrichment scores derived using different normalisation methods. <bold>e</bold>, Variograms remain stable across normalisations, except for analytic Pearson residuals, which show greater variability. <bold>f</bold>, Distribution of enrichment scores across normalisation methods. <bold>g</bold>, Similarity matrix showing high concordance (&gt;99%) among most normalisation methods.</p></caption><graphic xlink:href="EMS206132-f003"/></fig><fig id="F4" position="float"><label>Fig. 4</label><caption><title>EnrichMap reveals spatially distinct G0 arrest niches linked to immune evasion and metastasis.</title><p><bold>a</bold>, Spatial G0 arrest (Wiecek <italic>et al.</italic>) and proliferation scores (Nielsen <italic>et al.</italic>) computed using EnrichMap in two breast cancer patients, restricted to tumour-annotated spots. <bold>b</bold>, Cross-Moran of proliferation enrichment scores reveal expected spatial anticorrelation, indicating mutually exclusive localisation of quiescent and proliferative tumour niches. <bold>c</bold>, Moran’s <italic>I</italic> of proliferation scores demonstrate consistent and smooth spatial patterns in both patients. <bold>d</bold>, Cancer hallmark signatures avoiding immune destruction and tumour-promoting inflammation show correlation with G0 arrest across both patients. <bold>e-f</bold>, Spatial map of EnrichMap scores <bold>(e)</bold> and cross-Moran correlation with <italic>avoiding immune destruction</italic> and <italic>activating invasion and metastasis</italic> hallmarks <bold>(f)</bold> across two patients. <bold>g-h</bold>, Gene-level analysis of hallmark signatures contributing to G0-enriched niches show top 5 genes <bold>(g)</bold> and gene expression of the selected genes <bold>(h)</bold>.</p></caption><graphic xlink:href="EMS206132-f004"/></fig><fig id="F5" position="float"><label>Fig. 5</label><caption><title>EnrichMap generalises across spatial transcriptomics platforms and resolutions.</title><p><bold>a</bold>, Application of EnrichMap to the Visium HD mouse brain dataset. Left: spatial clusters; middle: EnrichMap score for the pyramidal layer; right: top gene contributors with expression patterns for two selected genes. <bold>b</bold>, Annotated mouse breast cancer Xenium dataset (top left) and targeted cell types (top right). Bottom panels show EnrichMap scores for Normal DCIS (bottom left), triple-negative DCIS (bottom middle), and T cells (bottom right). <bold>c</bold>, Mouse preoptic hypothalamus MERFISH dataset with tissue annotations (left), ependymal cell regions highlighted for clarity (middle), and EnrichMap score for ependymal cells (right). <bold>d</bold>, Mass cytometry of human breast cancer. Left: spatial context; middle: apoptotic tumour regions captured with two antibodies; right: T cells identified using three antibodies.</p></caption><graphic xlink:href="EMS206132-f005"/></fig></floats-group></article>