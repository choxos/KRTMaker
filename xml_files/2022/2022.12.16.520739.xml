<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS158934</article-id><article-id pub-id-type="doi">10.1101/2022.12.16.520739</article-id><article-id pub-id-type="archive">PPR586809</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">2</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Detection of PatIent-Level distances from single cell genomics and pathomics data with Optimal Transport (PILOT)</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Joodaki</surname><given-names>Mehdi</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="fn" rid="FN1">@</xref></contrib><contrib contrib-type="author"><name><surname>Shaigan</surname><given-names>Mina</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="fn" rid="FN1">@</xref></contrib><contrib contrib-type="author"><name><surname>Parra</surname><given-names>Victor</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Bülow</surname><given-names>Roman D.</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Kuppe</surname><given-names>Christoph</given-names></name><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Hölscher</surname><given-names>David L.</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Cheng</surname><given-names>Mingbo</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Nagai</surname><given-names>James S.</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Goedertier</surname><given-names>Michaël</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Bouteldja</surname><given-names>Nassim</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Tesar</surname><given-names>Vladimir</given-names></name><xref ref-type="aff" rid="A5">5</xref></contrib><contrib contrib-type="author"><name><surname>Barratt</surname><given-names>Jonathan</given-names></name><xref ref-type="aff" rid="A6">6</xref><xref ref-type="aff" rid="A7">7</xref></contrib><contrib contrib-type="author"><name><surname>Roberts</surname><given-names>Ian S.D.</given-names></name><xref ref-type="aff" rid="A8">8</xref></contrib><contrib contrib-type="author"><name><surname>Coppo</surname><given-names>Rosanna</given-names></name><xref ref-type="aff" rid="A9">9</xref></contrib><contrib contrib-type="author"><name><surname>Kramann</surname><given-names>Rafael</given-names></name><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Boor</surname><given-names>Peter</given-names></name><xref ref-type="aff" rid="A2">2</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib><contrib contrib-type="author"><name><surname>Costa</surname><given-names>Ivan G.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib></contrib-group><aff id="A1"><label>1</label>Institute for Computational Genomics, Joint Research Center for Computational Biomedicine, RWTH Aachen University Medical School</aff><aff id="A2"><label>2</label>Institute of Pathology, Laboratory of Nephropathology, RWTH Aachen University Medical School</aff><aff id="A3"><label>3</label>Institute of Experimental Medicine and Systems Biology, RWTH Aachen University</aff><aff id="A4"><label>4</label>Department of Internal Medicine, Nephrology and Transplantation, Erasmus Medical Center</aff><aff id="A5"><label>5</label>Department of Nephrology, 1<sup>st</sup> Faculty of Medicine and General University Hospital, Charles University, Prague, Czech Republic</aff><aff id="A6"><label>6</label>John Walls Renal Unit, University Hospital of Leicester National Health Service Trust, Leicester, United Kingdom</aff><aff id="A7"><label>7</label>Department of Cardiovascular Sciences, University of Leicester, Leicester, United Kingdom</aff><aff id="A8"><label>8</label>Department of Cellular Pathology, Oxford University Hospitals National Health Services Foundation Trust, Oxford, United Kingdom</aff><aff id="A9"><label>9</label>Fondazione Ricerca Molinette. Regina Margherita Children’s University Hospital, Torino, Italy</aff><author-notes><fn id="FN1"><label>@</label><p id="P1">Shared first authorship</p></fn><corresp id="CR1"><label>*</label><email>pboor@ukaachen.de</email>, <email>ivan.costa@rwth-aachen.de</email></corresp></author-notes><pub-date pub-type="nihms-submitted"><day>23</day><month>12</month><year>2022</year></pub-date><pub-date pub-type="preprint"><day>19</day><month>12</month><year>2022</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P2">Although clinical applications represent the next challenge in single-cell genomics and digital pathology, we still lack computational methods to analyze single-cell and pathomics data to find sample level trajectories or clusters associated with diseases. This remains challenging as single-cell/pathomics data are multi-scale, i.e., a sample is represented by clusters of cells/structures and samples cannot be easily compared with each other. Here we propose PatIent Level analysis with Optimal Transport (PILOT). PILOT uses optimal transport to compute the Wasserstein distance between two individual single-cell samples. This allows us to perform unsupervised analysis at the sample level and uncover trajectories or cellular clusters associated with disease progression. We evaluate PILOT and competing approaches in single-cell genomics and pathomics studies involving various human diseases with up to 600 samples/patients and millions of cells or tissue structures. Our results demonstrate that PILOT detects disease-associated samples from large and complex single-cell and pathomics data. Moreover, PILOT provides a statistical approach to delineate non-linear changes in cell populations, gene expression, and tissue structures related to the disease trajectories supporting interpretation of predictions.</p></abstract></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P3">Single-cell genomics and digital pathology methods are revolutionary technologies, which in principle, allow researchers to computationally dissect molecular, cellular, and structural changes in human tissues<sup><xref ref-type="bibr" rid="R1">1</xref>, <xref ref-type="bibr" rid="R2">2</xref></sup>. However, the clinical application of single-cell sequencing, i.e., finding cells and their markers for patient stratification and personalized treatments<sup><xref ref-type="bibr" rid="R3">3</xref></sup>, is still in its infancy. Recent clinical genomics efforts include the use of single-cell transcriptomics to dissect the progression of acute human myocardial infarction<sup><xref ref-type="bibr" rid="R4">4</xref></sup>, to characterize COVID-19 patients’ disease severity<sup><xref ref-type="bibr" rid="R5">5</xref></sup> and the development of pancreatic ductal adenocarcinomas<sup><xref ref-type="bibr" rid="R6">6</xref></sup>, just to cite a few. Computational analysis of these datasets mainly leverages standard methods for standard single-cell sequencing analysis, i.e., finding genes with differential expression in control vs. disease for each cell cluster. These approaches require a-priori patient classifications, i.e., control vs. disease. Therefore, they cannot be used to find novel sub-groups of patients. Alternatively, trajectory analysis can be performed to uncover disease progression allowing the characterization of early disease events. Particularly challenging is the multi-scale nature of single-cell experiments, i.e., each sample is represented by thousands of single cells, which are clustered in distinct cell types or cell states. Currently, there are no analytical methods to compare two single cell experiments from the same tissue from two distinct individuals.</p><p id="P4">Pathomics, i.e., the use of machine learning methods to extract morphological structures in histology slides, is likely to revolutionize pathology by producing reproducible and fast quantification of histological slides for disease diagnosis, as recently shown in the kidney<sup><xref ref-type="bibr" rid="R7">7</xref></sup>. Pathomics data of a slide is represented by thousands of anatomical structures, which are described by morphometric features, e.g., their individual shape and size. These can be clusters to find structures at distinct morphological states, i.e. distinct degrees of dysmorphism. As for scRNA-seq, there is no analytical method which is able to compare two or more histological slides based on morphometric properties of their structures.</p><p id="P5">Until now, only a few methods allow the analysis of single-cell genomics datasets at a sample level. PhEMD<sup><xref ref-type="bibr" rid="R8">8</xref></sup> is based on earth moving distance (EMD) to measure the distance between specimens (single-cell samples), where the distance between specimens was based on clustering representations from a diffusion-based space. This method was successfully used to explore the response of cell lines to drug effects. Nevertheless, it is based on the diffusion map and pseudotime estimates on the cell level. This explicitly assumes the presence of a cellular continuum (cell differentiation/activation) between all cells in the scRNA-seq experiments. Therefore, it is not suitable for the analysis of single-cell experiments measured in whole organ samples with heterogeneous cell populations. Moreover, PhEMD lacks methods for interpretation of the results, i.e., detection of molecular and cellular features explaining predictions. Ravindra and colleagues <sup><xref ref-type="bibr" rid="R9">9</xref></sup> propose the use of graph attention networks for the classification of scRNA-seq samples and apply this to predict the disease states of multiple Sclerosis<sup><xref ref-type="bibr" rid="R10">10</xref></sup>. More recently, SCANCell<sup><xref ref-type="bibr" rid="R11">11</xref></sup>, which explores association networks across cell clusters, was proposed and applied for the analysis of systemic lupus erythematodes. Multiscale PHATE<sup><xref ref-type="bibr" rid="R12">12</xref></sup> explores non-linear embeddings and multi-resolution representation to find the individual sample representation. This method uses supervised filters to find groups of cells related to COVID-19 mortality. Recently, Flores and colleagues proposed a multi-omics factor analysis that analyses single cell data at pseudo-bulk level<sup><xref ref-type="bibr" rid="R13">13</xref></sup>. This work focus on finding factors and molecular features explaining previously known sample phenotypes. Except for PhEMD, all related methods<sup><xref ref-type="bibr" rid="R9">9</xref>, <xref ref-type="bibr" rid="R11">11</xref>, <xref ref-type="bibr" rid="R12">12</xref></sup> require labels of patients for their analysis and cannot be used in the unsupervised analysis (clustering or trajectory inference) of patient-level single-cell experiments.</p></sec><sec id="S2" sec-type="results"><title>Results</title><sec id="S3"><title>Patient level distance with Optimal Transport (PILOT)</title><p id="P6">Upon diseases, tissues undergo cellular and tissue remodelling changes. For example, in myocardial infarction cardiomyocytes acquire an injury cell states, immune cells migrate to injured tissue and fibrosis or scarring takes place to compensate tissue loss due to necrosis. We hypothesize therefore that changes in cellular composition are hallmarks of disease progression. We propose PILOT— Patient level distance with Optimal Transport (OT)— to find similarities between samples measured with multi-scale single-cell or pathomics data with the optimal transport based Wasserstein distance<sup><xref ref-type="bibr" rid="R14">14</xref></sup> (<xref ref-type="fig" rid="F1">Fig. 1</xref>). PILOT models each sample/patient as a distribution of cells into clusters (cell types and cell states present in a given tissue). It then uses optimal transport to move cell distributions between all samples. PILOT explores the fact that some cellular changes, i.e. the change of a healthy cardiomyocytes to injured cardiomyocyte state are short term events in disease progression, while tissue remodeling (e.g. replacement of lost cardiomyocytes by fibroblasts due to scarring process) is indicative of a long term event in disease progression. Therefore, we define a cost matrix for the optimal transport so that transporting masses between similar cell types (healthy vs. injured cardiomyocytes) have a lower cost than transporting masses between distinct cell types (cardiomyocytes vs. fibroblasts). The optimal transport plan can be used to obtain the Wasserstein distance. PILOT explores diffusion maps<sup><xref ref-type="bibr" rid="R15">15</xref></sup> and a path inference algorithm<sup><xref ref-type="bibr" rid="R16">16</xref></sup> to infer sample-level disease progression trajectories or graph-based clustering<sup><xref ref-type="bibr" rid="R17">17</xref></sup> to find unknown sub-groups of patients. For disease trajectories, PILOT explores robust non-linear and regression models<sup><xref ref-type="bibr" rid="R18">18</xref></sup> to find cell types, genes, or morphological features associated with disease progression. The test indicates for features explaining the predicted pseudotime by fitting either linear or quadratic models, i.e. find changes in cell populations. For the case of genes and morphological features, the test can be conditioned on a cluster/cell type. Moreover, we use a Wald test to check if the cluster specific model fit differs from a global model<sup><xref ref-type="bibr" rid="R19">19</xref></sup>. Thus PILOT represents the first approach to detect unknown patient trajectories and clusters, while providing statistical models for interpretation of cellular, molecular, and morphometric features associated with disease progression.</p></sec><sec id="S4"><title>Evaluation of patient-level clustering and trajectory analysis</title><p id="P7">We compare the results of PILOT and PhEMD<sup><xref ref-type="bibr" rid="R8">8</xref></sup> and baseline methods in the recovery of known patient groups of eight single-cell RNA data sets (PBMCs from systemic lupus erythematodes<sup><xref ref-type="bibr" rid="R20">20</xref></sup>, pancreatic ductal adenocarcinoma [PADC]<sup><xref ref-type="bibr" rid="R6">6</xref></sup>, acute myocardial infarction<sup><xref ref-type="bibr" rid="R4">4</xref></sup>, PBMC of patients with COVID-19 infection<sup><xref ref-type="bibr" rid="R5">5</xref></sup>, kidney injury<sup><xref ref-type="bibr" rid="R21">21</xref></sup>, lung cancer<sup><xref ref-type="bibr" rid="R22">22</xref></sup>, follicular lymphoma<sup><xref ref-type="bibr" rid="R23">23</xref></sup> and diabetes<sup><xref ref-type="bibr" rid="R24">24</xref></sup>) and four pathomics data sets with morphological features of glomeruli and tubules from two distinct disease cohorts (kidney IgA nephropathy of the VALIGA study [IgAN]<sup><xref ref-type="bibr" rid="R25">25</xref></sup> and kidney biopsies of the Aachen cohort [AC]<sup><xref ref-type="bibr" rid="R7">7</xref></sup>). For most of these data, we use disease status (control and case) as labels for the clustering task. For the Kidney IgAN pathomics data, patients/donors were labeled by their estimated glomerular filtration rate (eGFR; normal, reduced, and low); for the COVID-19 samples were labeled as control, mild and severe cases; for the scRNA-seq kidney injury data samples were grouped as normal, chronic kidney disease and acute kidney failure. The lung and pancreas cell atlas have controls and distinct disease types (4 for lung and 3 for pancreas). These are the largest publicly available single cell and pathomics data with up to millions of cells and structures and measured in hundreds of patient samples (<xref ref-type="table" rid="T1">Table 1</xref>). We also evaluate two baseline methods: pseudo-bulk libraries per sample by using state-of-art RNA-seq pipelines<sup><xref ref-type="bibr" rid="R26">26</xref></sup> or clustering directly the cell proportion matrices.</p><p id="P8">For scRNA-seq data, we used the data as provided in the original manuscript as input for PILOT. For pathomics data, structure segmentation was performed with FLASH followed by graph-based clustering as described before<sup><xref ref-type="bibr" rid="R7">7</xref></sup>. Next, we used graph-based clustering<sup><xref ref-type="bibr" rid="R17">17</xref></sup> on the Wasserstein distance matrices and evaluated results with the adjusted Rand index (ARI)<sup><xref ref-type="bibr" rid="R27">27</xref></sup>. The number of clusters was the same as the number of true classes in the data. PILOT obtained the highest average ARI score and its ranking was significantly superior than all competing methods (<xref ref-type="fig" rid="F2">Fig. 2A</xref>, <italic>p</italic>-value &lt; 0.05; Friedman-Nemenyi test, and <xref ref-type="supplementary-material" rid="SD1">Sup. Table S1</xref>). Next, we evaluate the performance of distance matrix of PILOT and competing methods with the Silhouette index<sup><xref ref-type="bibr" rid="R28">28</xref></sup>. PILOT had the highest ranking among all evaluated methods (<xref ref-type="fig" rid="F2">Fig. 2B</xref>) and outperformed PheEMED (<italic>p</italic>-value &lt; 0.05; Friedman-Nemenyi test). Due to the large size of data sets, computing time is also a relevant aspect. In the Lupus PBMC data with millions of cells, PILOT required 58.12 seconds versus 9.03 seconds of the simple pseudo-bulk and 16.50 minutes of PhEMD <sup><xref ref-type="fn" rid="FN4">1</xref></sup>. These indicate that PILOT and some competing methods can be efficiently run in large data with millions of cells or tissue structures.</p><p id="P9">We observe that diffusion maps estimated with PILOT recovered trajectory-like structures in all analyzed data sets (<xref ref-type="fig" rid="F2">Fig.2D-E</xref>; <xref ref-type="supplementary-material" rid="SD1">Sup. Fig. S1-S2</xref>). Therefore, we modeled these trajectories with the EIPGraph<sup><xref ref-type="bibr" rid="R16">16</xref></sup> to rank samples regarding their disease progression score. We observe that a disease progression score recapitulates the severity of diseases in the data sets (<xref ref-type="fig" rid="F2">Fig. 2D-E</xref>; <xref ref-type="supplementary-material" rid="SD1">Sup. Fig. S3</xref>).. For example, in the lung cell atlas normal samples were at the beginning of the trajectory. These were followed by samples associated with chronic lung disease (COPD), while acute carcinoma samples (SCLC, LA, NSCLC) accumutated in the end of the trajectory. For Kidney IgAN (Tubule), we observe the trajectory order samples regarding normal, low or reduced glomerular filtration rate. To evaluate this more systematically, we considered the two-class problem for all data sets (controls vs. disease) and used the estimated pseudo-time score to compute the area under the precision-recall curves (AUPR). We observe that PILOT has the highest mean rank when considering AUPR values, which supports its power in disease trajectory detection (<xref ref-type="fig" rid="F2">Fig. 2</xref>, <italic>p</italic>-value &lt; 0.01; Friedman-Nemenyi test).</p><p id="P10">PILOT requires no definition of parameters. However, it assumes that single cell experiments have been previously pre-processed and clustered. Currently, PILOT adopts the same clustering and integration strategy as in the manuscript describing the data, as cells are labelled and this helps the interpretation of results. To investigate if clustering can impact PILOT, we change the resolution parameter of the Leiden Clustering algorithm for selected data sets. We observe that this parameter is not critical for the performance of PILOT (<xref ref-type="supplementary-material" rid="SD1">Sup. Fig. S4</xref>).</p></sec><sec id="S5"><title>PILOT trajectories detects events associated to cardiac remodelling in myocardial infarction</title><p id="P11">Next, we analyze the inferred trajectory from normal heart tissue towards ischaemic zone (IZ) tissue in acute myocardial infarction. The trajectory reflected the known annotation of samples with the exception of one case in the decision boundary between controls/IZ samples (<xref ref-type="fig" rid="F3">Fig. 3A</xref>). We use non-linear regression methods to find cellular and molecular changes associated with the disease progression score. Major cellular changes, as indicated by the highest adjusted <italic>R</italic><sup>2</sup> values, include a quadratic increase of SPP1 positive macrophages and myofibroblasts, a quadratic decrease of healthy cardiomyocytes followed by a later and smoother decrease of stressed cardiomyocytes during disease progression (<xref ref-type="fig" rid="F3">Fig. 3B</xref>; <xref ref-type="supplementary-material" rid="SD1">Sup. Fig. S5</xref>). These patterns are in accordance with cellular changes in early myocardial infarction, which include damage of myogenic tissue followed by inflammation and fibrosis. This example also confirms the power of PILOT predicting trajectories to find continuous changes related to tissue remodelling.</p><p id="P12">At the gene level, PILOT identifies genes related to extracellular matrix remodelling induced by myofibroblasts (<xref ref-type="supplementary-material" rid="SD1">Supp. Fig. S6</xref>). These include COL1A2, which has an overall quadratic increase in gene expression upon disease progression (<xref ref-type="fig" rid="F3">Fig. 3C</xref>). Decorin (DCN) and exostosin-1 (EXT1) are examples of genes with decreased expression upon late stages of disease progression. Decorin is a fibroblast specific gene with antifibrotic properties due to TGFB signalling inhibition<sup><xref ref-type="bibr" rid="R29">29</xref>,<xref ref-type="bibr" rid="R30">30</xref></sup>. Exostosin-1 has been associated with early formation of collagen fibres<sup><xref ref-type="bibr" rid="R31">31</xref></sup>. We observe genes associated with heart development and with disease progression related changes in healthy cardiomyocytes (<xref ref-type="supplementary-material" rid="SD1">Supp. Fig. S8</xref>). One of these genes with a steep reduction in expression is HDAC9, which functions as a signal-responsive repressor of cardiac hypertrophy by inactivating MEF2 transcription factors<sup><xref ref-type="bibr" rid="R32">32</xref></sup>. MLP, which is a gene with a slow decrease in expression, is a regulator of myofibril assembly <sup><xref ref-type="bibr" rid="R33">33</xref></sup>. Finally, FHOD3 is a gene important in the regulation actin filaments. It has a decrease in expression at sames at the middle of the trajectory indicating a potential role which would have been missed if not analyzed within temporal context<sup><xref ref-type="bibr" rid="R34">34</xref></sup>. Altogether, these results support how PILOT can detect molecular and cellular changes at distinct stages of myocardial infarction.</p></sec><sec id="S6"><title>PILOT trajectories in Pathomics data</title><p id="P13">Next, we performed a trajectory analysis of the pathomics data of kidney IgAN biopsies. As distinct morphological features are used to describe tubules and glomeruli, it is not possible to cluster these structures together, so these data are independently analyzed as in<sup><xref ref-type="bibr" rid="R7">7</xref></sup>. We combine the two disease progression scores with their sum, which yields similar or higher AUCPR scores than the trajectories considering one structure at a time (<xref ref-type="fig" rid="F4">Fig. 4A</xref>; <xref ref-type="supplementary-material" rid="SD1">Fig. S9</xref>). This trajectory is associated with a linear decrease in eGFR (<xref ref-type="fig" rid="F4">Fig. 4B</xref>), which is the current surrogate used in clinical practice to estimate kidney function. Regarding morphometric features, PILOT detects a significant linear decrease of glomerular tuft sizes and tubule sizes; and a linear increase in distance between glomeruli and tubules as significant characteristics of disease progression (<xref ref-type="fig" rid="F4">Fig. 4C</xref>; <xref ref-type="supplementary-material" rid="SD1">Supp. Fig. S10- S11</xref>). These are indicative of interstitial fibrosis, tubular atrophy, and glomerulosclerosis, which are all hallmarks of kidney function decline. Finally, we made use of a prognostic variable from the kidney IgAN biopsies, which indicates if patients progressed to kidney failure. PILOT progression score is more associated with kidney failure (<italic>p</italic>-value of 2.4e-11; likelihood ratio test) than a multivariate model combining all morphometric variables (<italic>p</italic>-value of 7e-05; likelihood ratio test) or the use of individual morphometric variables (<xref ref-type="supplementary-material" rid="SD1">Supp. Table S2</xref>). Indeed, samples with higher disease progression scores (top 75 quartiles) have a higher chance of kidney failure than other samples (<xref ref-type="fig" rid="F4">Fig. 4D</xref>). Altogether, these results reinforce the power of PILOT in discriminating disease outcomes from pathomics data.</p></sec></sec><sec id="S7" sec-type="discussion"><title>Discussion</title><p id="P14">The technological improvements in single cell genomics and digital pathology are providing us with clinically rich and large-sized data describing cellular and morphological changes in diseases. We present here PILOT—the first computational pipeline for the detection and feature characterization of disease trajectories from single-cell genomics or pathomics data. By using a comprehensive benchmark with twelve data sets, we show that PILOT is superior to the competing approaches in both clustering and disease trajectory prediction. Another important aspect, which is only addressed by PILOT, is the interpretation of predictions. PILOT uses a robust non-linear regression model, which can predict cellular populations, marker genes or morphological features associated with the disease progression.</p><p id="P15">We revisited the analysis of the largestsingle-cell genomics data on myocardial infarction<sup><xref ref-type="bibr" rid="R4">4</xref></sup>, where PILOT could successfully predict a trajectory from controls towards ischemic samples. This allowed us to find non-linear changes in cell composition during cardiac remodeling, i.e., quadratic decrease of healthy cardiomyocytes and quadratic increase of myofibroblast and macrophages cells. Similarly, PILOT dissected gene expression programs associated with these changes, such as non-linear increase in expression of extra cellular matrix related genes in myofibroblasts and increase of genes associated with cardiomyopathy in healthy cardiomyocytes. We also evaluated the power of PILOTin inferring adisease trajectory ofpathomics data from patients with kidney IgAN. We show that disease progression as estimated by PILOT is related to eGFR and provides a better predictor for future kidney failure than the use of the morphometric features alone or together. These highlight the power of PILOT in finding non-linear manifolds to model disease progression. Molecular studies of diseases are increasingly based on multi-modal measurements; gene expression, protein abundances, chromatin accessibility, and histology images at either single cell and/or spatial level<sup><xref ref-type="bibr" rid="R35">35</xref></sup>. Future work of multi-scale level analysis will require methods considering the multi-modal and spatial nature of these data into account.</p></sec><sec id="S8" sec-type="methods"><title>Methods</title><sec id="S9"><title>PILOT</title><p id="P16">We formalize the main steps of PILOT<sup><xref ref-type="fn" rid="FN5">2</xref></sup>. In analyzing single-cell experiments, assume there are L single-cell matrices <inline-formula><mml:math id="M1"><mml:mrow><mml:mi>χ</mml:mi><mml:mspace width="1.2em"/><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mn>…</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mn>…</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>X</mml:mi><mml:mi>L</mml:mi></mml:msub></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> where <inline-formula><mml:math id="M2"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mi>ε</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>×</mml:mo><mml:mi>D</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. Where <italic>N<sub>l</sub></italic> represents the number of cells in sample <italic>l</italic> and <italic>D</italic> is the number of features (genes), which is common between all experiments. In practice, PILOT receives as input a single matrix <inline-formula><mml:math id="M3"><mml:mrow><mml:msup><mml:mi>X</mml:mi><mml:mn>1</mml:mn></mml:msup><mml:mi>ε</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>}</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>D</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula> after integration of the matrices in χ, where <italic>N</italic> represents the total number of cells. To keep the sample information, we define a vector indicating the sample identity of cell <italic>i</italic>, i.e. <italic>s</italic> = {<italic>s</italic><sub>1</sub>,…, <italic>s<sub>N</sub></italic>}, where <italic>s<sub>i</sub></italic> ε {1,…, <italic>L</italic>} indicates which sample (patient) the cells belongs to. A usual representation/sumarization of single cell experiments is to group cells with a clustering algorithm. This can be represented by a vector <italic>y</italic>= <italic>y</italic><sub>1</sub>,…,<italic>y<sub>N</sub></italic>, where <italic>y<sub>i</sub></italic> ε {1,…,<italic>K</italic>} indicates the group of cell <italic>i</italic>.</p><p id="P17">Our main problem is to estimate the distance between scRNA-seq data measured over two distinct samples (patients), where a scRNA-seq is represented as a set of clustered cells. Here we explore the concepts of the optimal transport based Wasserstein method<sup><xref ref-type="bibr" rid="R36">36</xref></sup> to compare two samples by representing samples as distributions of cells. First, we defined the probability of having a cluster <italic>k</italic> for patient <italic>l</italic> as: <disp-formula id="FD1"><label>(1)</label><mml:math id="M4"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>y</mml:mi><mml:mo>=</mml:mo><mml:mi>k</mml:mi><mml:mo>|</mml:mo><mml:mi>s</mml:mi><mml:mo>=</mml:mo><mml:mi>l</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P18">This can be used to define a probability distribution vector <italic>p<sub>l</sub></italic> =(<italic>p</italic><sub><italic>l</italic>1</sub>,…,<italic>p<sub>lk</sub></italic>).</p><p id="P19">From these, we use optimal transport to find the optimal transport plan <italic>J</italic> = {<italic>j<sub>ij</sub></italic>}<italic><sup>KxK</sup></italic> between two distributions <italic>pl</italic> and <italic>pq</italic> describing samples <italic>l</italic> and <italic>q</italic> by considering that there is a cost <italic>c<sub>ij</sub></italic> associated with moving some mass between cluster <italic>i</italic> to cluster <italic>j</italic>: <disp-formula id="FD2"><label>(2)</label><mml:math id="M5"><mml:mrow><mml:munder><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mi>j</mml:mi></mml:munder><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula> such that <inline-formula><mml:math id="M6"><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>≥</mml:mo><mml:msubsup><mml:mi>∑</mml:mi><mml:mi>i</mml:mi><mml:mi>k</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mi>j</mml:mi><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow><mml:msubsup><mml:mi>∑</mml:mi><mml:mi>j</mml:mi><mml:mi>k</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>q</mml:mi><mml:mi>j</mml:mi><mml:mspace width="0.2em"/></mml:mrow></mml:msub><mml:mi>a</mml:mi><mml:mi>n</mml:mi><mml:mi>d</mml:mi></mml:mrow><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:msubsup><mml:mrow><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>k</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>=</mml:mo><mml:mn>1.</mml:mn></mml:mrow></mml:mrow></mml:math></inline-formula></p><p id="P20">For a given optimal transport plan <italic>J</italic>, the Wasserstein distance (W) is calculated as: <disp-formula id="FD3"><label>(3)</label><mml:math id="M7"><mml:mi>W</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mi>l</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mi>q</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:math></disp-formula>.</p><p id="P21">The optimal transport matrix J can be estimated using a minimum flow cost algorithm<sup><xref ref-type="bibr" rid="R36">36</xref></sup>. PILOT is based on the emd2 function from POT library<sup><xref ref-type="bibr" rid="R37">37</xref></sup>, which implements the best solver described in<sup><xref ref-type="bibr" rid="R36">36</xref></sup>. By estimating the Wasserstein distance between all pairs of samples, we obtain a distance matrix W between all samples.</p><p id="P22">This framework, which is also denoted Earth Moving Distance<sup><xref ref-type="bibr" rid="R38">38</xref></sup>, is also explored by PhEMD. PILOT, however, explores important issues which are crucial in the noisy and large nature of single cell and pathomics data. These are namely: (1) how to obtain robust estimates of probability distributions due to potential cell content bias and low cell coverage of individual samples; (2) how to estimate the cost matrix <italic>C</italic> on the large matrices <bold>X<sup>T</sup></bold> ; and (3) by offering statistical models to select features associated with disease progression. These three points are described below.</p></sec><sec id="S10"><title>Robust estimation of sample probability distributions</title><p id="P23">The coverage of cells per cluster can vary across distinct samples. This effect is potentially higher in diseased samples, due to their lower cell viability. Let <italic>z<sub>l</sub></italic> = (<italic>z</italic><sub>l1</sub>, …<italic>z<sub>li</sub></italic>, …, <italic>z<sub>lK</sub></italic>) be a vector, where <italic>z<sub>lk</sub></italic> is the number of cells in a cluster <italic>k</italic> and sample <italic>l</italic>. We define the following hierarchical model: <disp-formula id="FD4"><mml:math id="M8"><mml:msub><mml:mi>Z</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>∼</mml:mo><mml:mi>M</mml:mi><mml:mi>u</mml:mi><mml:mi>l</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>Θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:math></disp-formula> <disp-formula id="FD5"><label>(4)</label><mml:math id="M9"><mml:mi>Θ</mml:mi><mml:mo>∼</mml:mo><mml:mi>D</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:math></disp-formula> where <italic>N<sub>l</sub></italic> is the number of cells in the sample <italic>l</italic>, <bold><italic>Θ</italic></bold> is a random variable representing distributions <italic>p</italic> and a is the hyper-parameter of a Dirichlet distribution. The posterior distribution can be re-written as <disp-formula id="FD6"><label>(5)</label><mml:math id="M10"><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Θ</mml:mi><mml:mo>|</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>α</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mi>D</mml:mi><mml:mi>i</mml:mi><mml:mi>r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:math></disp-formula> We can use this to obtain maximum a posteriori estimates of Θ, i.e. <disp-formula id="FD7"><label>(6)</label><mml:math id="M11"><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>l</mml:mi><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>l</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>K</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow></mml:mfrac></mml:math></disp-formula>.</p><p id="P24">Here, we use the following parametrization of the prior <italic>α<sub>k</sub></italic> = <italic>N<sub>k</sub>/N * c</italic>, where <italic>c</italic> is set as 0.1 as default. This prior adds “pseudo cell counts”, which are weighted by the cell distribution of all samples. This prior mitigates the fact rare cells might not be observed in samples with low cell coverage.</p></sec><sec id="S11"><title>Estimation of Cost Matrix</title><p id="P25">The optimal transport also considers the cost <italic>c<sub>ij</sub></italic> of transporting a distribution mass from a cluster <italic>i</italic> to a cluster <italic>j</italic>. For this, we generate a median representation for each cluster (in the PCA space) and estimate the cosine distance between the median value of clusters <italic>i</italic> and <italic>j</italic> as the cost to transport masses. The cosine distance between the median of cluster <italic>i</italic> (<italic>M<sub>i</sub></italic>) and cluster <italic>j</italic> (<italic>M<sub>j</sub></italic>) is defined as: <disp-formula id="FD8"><label>(7)</label><mml:math id="M12"><mml:mi>C</mml:mi><mml:mi>o</mml:mi><mml:mi>s</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>.</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mo>∥</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mo>∥</mml:mo><mml:mn>2</mml:mn></mml:msub><mml:mo>∥</mml:mo><mml:msub><mml:mi>M</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msub><mml:mo>∥</mml:mo><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:mfrac></mml:math></disp-formula></p><p id="P26">Of note, PhEMD uses centroids and Euclidean distances in non-linear embedding to estimate the cost matrices. The non-linear embedding assumes a cellular continuum between all cells in the data, which is not present in whole tissue single cell or pathomics data. Moreover, median values reduce the effects of outliers.</p></sec><sec id="S12"><title>Clustering and disease trajectory estimation</title><p id="P27">The matrix <italic>W</italic> (Eq. 3) provides the distance between all samples. Clustering analysis can be performed by providing W as input to a Leiden clustering algorithm<sup><xref ref-type="bibr" rid="R17">17</xref></sup>. PILOT also performs trajectory analysis by the use of diffusion maps<sup><xref ref-type="bibr" rid="R39">39</xref></sup> followed by a trajectory estimation with EIPLGraph<sup><xref ref-type="bibr" rid="R16">16</xref></sup>. For this, we apply the Gaussian kernel to <italic>W</italic><sup><xref ref-type="bibr" rid="R40">40</xref></sup> to construct the affinity matrix as <italic>W<sup>s</sup></italic>, i.e.: <disp-formula id="FD9"><label>(8)</label><mml:math id="M13"><mml:msup><mml:mi>W</mml:mi><mml:mi>s</mml:mi></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>e</mml:mi><mml:mi>x</mml:mi><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mo>∥</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∥</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mi>ℰ</mml:mi><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>w</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo stretchy="false">)</mml:mo></mml:math></disp-formula> where <italic>ε</italic> and <italic>ρ</italic> are the scale parameter and the bandwidth function<sup><xref ref-type="bibr" rid="R41">41</xref></sup> respectively.</p><p id="P28">Next, we compute the transition matrix:<disp-formula id="FD10"><label>(9)</label><mml:math id="M14"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mi>D</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mi>W</mml:mi><mml:mi>s</mml:mi></mml:msup></mml:math></disp-formula> where D is a diagonal matrix with <inline-formula><mml:math id="M15"><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>∑</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mrow><mml:msubsup><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mi>s</mml:mi></mml:msubsup></mml:mrow></mml:mrow></mml:math></inline-formula>. Finally, we perform the spectral decomposition of matrix <italic>M</italic> as: <disp-formula id="FD11"><label>(10)</label><mml:math id="M16"><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mi>D</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi>V</mml:mi><mml:mi>Λ</mml:mi><mml:msup><mml:mi>V</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:msup><mml:mi>D</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:math></disp-formula> where Λ and V are the eigenvalue and eigenvectors matrices. Ultimately we use eigenvectors with the highest values for obtaining diffusion maps. These are provided as input for EIPLGraph<sup><xref ref-type="bibr" rid="R16">16</xref></sup>, which infers a backbone of the trajectory. It also allows us to rank samples with a disease progression score <italic>t</italic> = <italic>t</italic><sub>1</sub>,…,<italic>t<sub>L</sub></italic>, where <italic>t<sub>l</sub></italic> is the ranking of the sample <italic>l.</italic> In our experiments, we only considered two highest eigenvectors. EIPLGraph also requires a root sample, which was visually selected to reflect parts of the trajectory with control samples.</p></sec><sec id="S13"><title>Identification of molecular and structural features associated with disease progression</title><p id="P29">PILOT uses step-wise regression models to identify features (cellular abundances, gene expression or structural properties), whose values are consistently changing across disease trajectories. For this, it fits regression models with linear, quadratic, and linear-quadratic terms for each feature and uses statistical tests to determine the goodness of fit. We then report the most significant model for each feature.</p><p id="P30">Let <italic>x<sub>ij</sub></italic> represent the expression of a feature (gene) - in a cell <italic>i</italic>, and <italic>P<sub>i</sub></italic> the pseudo-time variable (associated with the pseudo-time of its sample, <italic>P<sub>i</sub> = t<sub>s</sub><sub>i</sub></italic>). In short, we fit the three regression models to the <italic>j</italic>th feature: <disp-formula id="FD12"><mml:math id="M17"><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mmultiscripts><mml:mi>p</mml:mi><mml:mprescripts/><mml:mi>j</mml:mi><mml:none/></mml:mmultiscripts></mml:math></disp-formula>,<disp-formula id="FD13"><mml:math id="M18"><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mmultiscripts><mml:mi>p</mml:mi><mml:mprescripts/><mml:mi>j</mml:mi><mml:none/></mml:mmultiscripts><mml:msup><mml:mrow/><mml:mn>2</mml:mn></mml:msup></mml:math></disp-formula>,<disp-formula id="FD14"><label>(11)</label><mml:math id="M19"><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>j</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mmultiscripts><mml:mi>p</mml:mi><mml:mprescripts/><mml:mi>j</mml:mi><mml:none/></mml:mmultiscripts><mml:mo>+</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msub><mml:mmultiscripts><mml:mi>p</mml:mi><mml:mprescripts/><mml:mi>j</mml:mi><mml:none/></mml:mmultiscripts><mml:msup><mml:mrow/><mml:mn>2</mml:mn></mml:msup></mml:math></disp-formula> where <inline-formula><mml:math id="M20"><mml:mrow><mml:mover><mml:mi>μ</mml:mi><mml:mo>∧</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> is the models’ intercept, and <inline-formula><mml:math id="M21"><mml:mrow><mml:mover><mml:mi>ß</mml:mi><mml:mo>∧</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> are the models’ coefficients. The models are ranked based on the coefficient of determination (<italic>R</italic><sup>2</sup>), and we only consider the model with the highest R-squared and at a significance level (<italic>p</italic>-values &lt; 0.05). The same approach can be performed for distinct features, such as the proportion of cell types in the sample or morphological features.</p><p id="P31">In the case of gene expression, one is mostly interested in finding cell type (cluster) specific genes. Therefore, we only consider cells <italic>i</italic> belonging to cluster <italic>k</italic>. Due to the sparsity of single cell data, i.e., dropout events, we observed a single side tailed distributions of residuals. Therefore, to improve the robustness of our regression models, we use the Huber least square criterion (Eq. 12)<sup><xref ref-type="bibr" rid="R42">42</xref></sup>. <disp-formula id="FD15"><label>(12)</label><mml:math id="M22"><mml:mi>H</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>e</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mi>e</mml:mi><mml:mfrac><mml:mn>2</mml:mn><mml:mi>i</mml:mi></mml:mfrac><mml:mspace width="1.2em"/><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mi>e</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mo>&lt;</mml:mo><mml:mo>=</mml:mo><mml:mi>δ</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>δ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>|</mml:mo><mml:msub><mml:mi>e</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mi>δ</mml:mi><mml:mspace width="1.2em"/><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mi>e</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mo>&gt;</mml:mo><mml:mi>δ</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M23"><mml:mrow><mml:msub><mml:mi>e</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>x</mml:mi><mml:mo>.</mml:mo><mml:mi>j</mml:mi><mml:mo>−</mml:mo><mml:mover><mml:mi>x</mml:mi><mml:mo>∧</mml:mo></mml:mover><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:math></inline-formula>. The Huber regression lessens the effects of the outliers by using a term <italic>δ</italic> (default of 1.35). This defines residual values associated with outliers. For large <italic>δ</italic>, the regression is equal to ridge regression.</p><p id="P32">Of note, the previous formulation requires a re-definition of the R-squared to consider the Huber regression penalization, that is: <disp-formula id="FD16"><mml:math id="M24"><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>o</mml:mi><mml:mi>d</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>S</mml:mi><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>S</mml:mi><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:math></disp-formula> <disp-formula id="FD17"><mml:math id="M25"><mml:mi>S</mml:mi><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mo>&lt;</mml:mo><mml:mo>=</mml:mo><mml:mi>δ</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mo>+</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>|</mml:mo><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mo>&gt;</mml:mo><mml:mi>δ</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:mi>δ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>|</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mo>|</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mi>δ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula> <disp-formula id="FD18"><label>(13)</label><mml:math id="M26"><mml:mi>S</mml:mi><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mi>o</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mi>j</mml:mi></mml:munder><mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:msub><mml:mo>.</mml:mo><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></disp-formula></p><p id="P33">Another relevant questions is if the pattern of the feature (gene expression or morphometrics) in a given cluster over pseudo-time is distinct from other clusters. To do this, we compare the expression patterns along the pseudotime between one cluster vs cells/structures from all other clusters (non-cluster). We utilized Wald statistics, using the linear combination of coefficients, to test whether there are differences between pair points of fitted curves (cluster vs. non-cluster). Subsequently, for each gene, we test 2 × 3 null hypotheses (between two models, each having at most three coefficients; see Eq. 11) on the <italic>n</italic> pseudotime points: <disp-formula id="FD19"><mml:math id="M27"><mml:msub><mml:mi>H</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>:</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math></disp-formula> <disp-formula id="FD20"><label>(14)</label><mml:math id="M28"><mml:msub><mml:mi>H</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>:</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:math></disp-formula> where <italic>C</italic> is the (2 × 3) × <italic>n</italic> contrast matrix of interest and <inline-formula><mml:math id="M29"><mml:mover accent="true"><mml:mi>β</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> are coefficients of two models. The distribution of the test statistic under the null hypothesis is: <disp-formula id="FD21"><label>(15)</label><mml:math id="M30"><mml:mrow><mml:mi>W</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mover><mml:mi>β</mml:mi><mml:mo>∧</mml:mo></mml:mover></mml:mrow><mml:mi>T</mml:mi></mml:msup><mml:mi>C</mml:mi><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>C</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mover><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mover><mml:mi>β</mml:mi><mml:mo>∧</mml:mo></mml:mover></mml:mrow></mml:msub><mml:mi>C</mml:mi></mml:mrow><mml:mo>∧</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msup><mml:mi>C</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mover><mml:mi>β</mml:mi><mml:mo>∧</mml:mo></mml:mover></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M31"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>V</mml:mi><mml:mo>∧</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mover><mml:mi>β</mml:mi><mml:mo>∧</mml:mo></mml:mover></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is an estimator of the variance-covariance matrix of estimated coefficients. For large enough <italic>n</italic>, <italic>W</italic> is distributed as <italic>χ</italic><sup>2</sup> with <italic>r</italic> degrees of freedom d.f. for <italic>n</italic> = 100<sup><xref ref-type="bibr" rid="R43">43</xref></sup>. To estimate the Wald score, we need to perform a eigendecomposition ofthe variance-covariance matrix (<inline-formula><mml:math id="M32"><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>V</mml:mi><mml:mo>∧</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mover><mml:mi>β</mml:mi><mml:mo>∧</mml:mo></mml:mover></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>). We consider all eigenvectors with eigenvalues larger than 1<italic>e</italic><sup>–8</sup>. Statistical significance is estimated with the χ<sup>2</sup> and the degree of freedom in the rank.</p></sec></sec><sec id="S14" sec-type="materials"><title>Materials</title><sec id="S15"><title>Data sets</title><p id="P34">We use public single cell and pathomics data sets to benchmark the proposed methods (see <xref ref-type="fig" rid="F1">Fig.1B</xref>).</p></sec><sec id="S16"><title>Single cell data sets</title><p id="P35">Peng and colleagues<sup><xref ref-type="bibr" rid="R6">6</xref></sup> performed a single cell study on pancreatic ductal adenocarcinoma (PDAC). They characterized 11 healthy and 24 PDAC samples with a total of 57,530 scRNA-seq annotated in 10 major pancreas cell types. As only raw data was provided (obtained from GSA: CRA001160 <ext-link ext-link-type="uri" xlink:href="https://ngdc.cncb.ac.cn/gsa/browse/CRA001160">https://ngdc.cncb.ac.cn/gsa/browse/CRA001160</ext-link>), we reanalyzed the data using Seurat and re-annotated cell types using the same marker genes (<xref ref-type="supplementary-material" rid="SD1">Sup. Fig. S12</xref>).</p><p id="P36">Systemic lupus erythematosus is a common type of lupus that, in the immune system, pounds its tissues, yielding overall rash and tissue injury in the acted organs<sup><xref ref-type="bibr" rid="R20">20</xref></sup> . This single cell study characterized peripheral blood mononuclear cells (PBMCs) gene expression of 261 donors consisting of 1,263,676 cells. Of these donors, 99 were healthy controls, and 162 were disease patients. We use the normalized and clustered (11 groups) data sets provided in Gene Expression Omibus (GEO; GSE174188; GSE174188_CLUES1_adjusted.h5ad.gz).</p><p id="P37">We use single-cell and single-nucleus assays from kidney samples from the Kidney Precision Medicine Project<sup><xref ref-type="bibr" rid="R21">21</xref></sup>. For this study, we used the single-cell RNA-seq experiments, including 76,020 cells, annotated in 57 major cell types. This data has 36 donors, including 18 control, 5 acute kidney failure, and 13 chronic kidney samples). For this data, we consider those acute kidney failure and chronic kidney samples infected with diabetes. Pre-processed data was obtained from GEO (GSE169285).</p><p id="P38">The lung cancer single cell atlas is another large data set with 941,504 cells from 165 donors<sup><xref ref-type="bibr" rid="R22">22</xref></sup>. The samples are formed by 51 normal lung, 18 chronic obstructive pulmonary diseases, 76 lung adenocarcinomas, 13 non-small cell lung carcinomas and 12 squamous cell lung carcinoma. The cells are clustered in 33 clusters/cell types. The atlas is based on distinct studies measured under distinct platforms. We only consider here samples from lung tissue and measured with the 10X genomics platform. Data was obtained from Zenodo (ID 7227571).</p><p id="P39">We have recently proposed a large study to characterize myocardial infarction<sup><xref ref-type="bibr" rid="R4">4</xref></sup>. We recovered 115,517 high quality cells, which were clustered in 33 cellular sub-types. We focus here on samples associated with healthy heart tissues (healthy controls and remote zones; n=13) and ischemic zone (IZ; n=7). We exclude one sample due to low quality (less than 1000 genes (on average) per cell). A final dataset is provided in Zenodo (ID 7435911).</p><p id="P40">The single cell pancreas diabetes data<sup><xref ref-type="bibr" rid="R24">24</xref></sup> covers 264,235 mouse pancreatic islet cells (with 13 cell types) from 52 samples. This includes 12 endocrine pancreas disorders, 6 type-1 diabetes mellitus, 12 type-2 diabetes mellitus, and 22 normal samples. We excluded four samples (Embryos E12-E15) due to being outliers by trajectories of methods. The dataset was obtained in GEO (GSE211799). Follicular lymphoma data<sup><xref ref-type="bibr" rid="R23">23</xref></sup> collected by Han and colleagues containing 137,147 single cells have been processed to illustrate the various tumor and immune cell populations of Follicular lymphoma. Cells have been clustered into 18 cell types from 23 donors (3 normal and 20 lymphoma samples). The raw data is accessible from EGA (EGAS00001006052).</p><p id="P41">Finally, we obtained a study with PBMC cells from patients infected with Covid-19<sup><xref ref-type="bibr" rid="R44">44</xref></sup>. We only considered patients with PMBCs (frozen or fresh cells). This totals to 151 samples classified as either severe infection (n=70), mild infection (n=61), and control (n=20). For these samples, we have 993,171 cells, which were grouped into 10 major cell types. The data was obtained from GEO (GSE158055).</p></sec><sec id="S17"><title>Pathomics data sets</title><p id="P42">The VALIGA study is a European cohort with kidney biopsies and accompanying clinical data of patients with IgA nephropathy<sup><xref ref-type="bibr" rid="R25">25</xref></sup>. We used a pathomics pipeline developed by us<sup><xref ref-type="bibr" rid="R7">7</xref></sup> to detect and measure 3 morphometric features of 65,483 tubules and 14 features associated with 24,227 glomeruli structures, which could be detected in 634 biopsies. Patients were classified regarding their glomerular filtration rate (GFR): normal (GFR&gt;60; n=400), reduced (30&lt;GFR &lt;=60; n=177) or low (GFR&lt;=30; n=57). Lower GFR indicates lower kidney function. A second pathomics data set is the Aachen Cohort data, which includes 57 samples with healthy controls and distinct diseases/co-morbidity associated with lower kidney function<sup><xref ref-type="bibr" rid="R7">7</xref></sup>. We analyzed the histology slides as before<sup><xref ref-type="bibr" rid="R7">7</xref></sup>, which provided 4,731 glomeruli and 46,999 tubules, each quantified with 3/14 morphometric features. Patients were classified as either being healthy controls (n=17) or diseased (n=40).</p><p id="P43">We employed a uniform pre-processing pipeline utilizing Seurat<sup><xref ref-type="bibr" rid="R45">45</xref></sup> for the normalization and clustering of structures. First, we normalized the data with the function NormalizeData of Seurat, and next ran the ScaleData function. Next, we performed dimension reduction (RunPCA) and kept the 10 and 2 main components for glomeruli and tubules respectively. Next, clusters were found with the Leiden algorithm by using the FindNeighbors and FindClusters functions, respectively. The same pipeline was performed on the kidney IgAN (VALIGA) and Aachen cohort data. As morphometric features are not comparable between glomeruli and tubules, these data are analyzed independently, which results in four distinct data sets. At the patient level, PILOT also allowed the combination of the Wasserstein distance for glomeruli and tubuli, which provided a unique trajectory for each cohort.</p></sec></sec><sec id="S18"><title>Competing methods</title><sec id="S19"><title>Pseudo-bulk</title><p id="P44">We investigate pseudo-bulk here as a baseline method for sample-level analysis. For single cell data, we sum the gene expression count for all cells in a sample. Then the Poisson distance<sup><xref ref-type="bibr" rid="R26">26</xref></sup> between summed counts is employed to compute the sample contrasts. For pathomics data, we calculate the average morphological features per sample and then scale values between 0 and 1. Afterwards, the principal components(PCA) for samples are computed. We detected knees in the variance plots and kept the PCs with the highest variances. We calculated the cosine distance, which was used as input for diffusion maps and Leiden clustering.</p></sec><sec id="S20"><title>Proportions</title><p id="P45">Here, we take the original single cell and pathomics data and calculate the proportion of cell types (clusters) per sample. Next, we calculate the dissimilarity among samples based on their fraction of clusters by cosine distance. Finally, we apply the diffusion map to the distance matrix and get the order of samples.</p></sec><sec id="S21"><title>PhEMD</title><p id="P46">PhEMD required the use of Monocle 2<sup><xref ref-type="bibr" rid="R46">46</xref></sup> to perform normalization, dimension reduction, and clustering of cells. The inputs of PhEMD for all data sets are the first 50 principal components of PCA and original pathomic measurements. Among other parameters, PhEMD/Monocle2 requires the definition of a distribution function for expression values. We use as default Negative Binomial distributions to model single cell data sets as advised in the tutorials. For PBMC COVID-19, Diabetic, and Lupus data, we used Gaussianff, due to the fact no cluster was found with the default model. For pathomics data, we used truncated normal distributions due to their best performance. We then used the distance matrices provided by PhEMD as input for a diffusion map analysis as implemented in PILOT.</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Sup. Table and Figures</label><media xlink:href="EMS158934-supplement-Sup__Table_and_Figures.pdf" mimetype="application" mime-subtype="pdf" id="d22aAdGbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S22"><title>Acknowledgements</title><p>We thank the European Validation Study of the Oxford Classification of IgAN (VALIGA), funded by the Immunonephrology Working Group of the European Renal Association for access to VALIGA data. This work was funded by grants of the Deutsche Forschungsgemeinschaft (DFG-GE 2811/3) to I.G.C. and the clinical research unit KFO5011 for I.G.C., P.B., R.K. and C.K. and by the Bundesministerium für Bildung und Forschung (BMBF e:Med Consortia Fibromap) to I.G.C. and R.K. PB is supported by the German Research Foundation (DFG, Project IDs 322900939, 454024652, 432698239 445703531), European Research Council (ERC Consolidator Grant No 101001791), and the Federal Ministry of Education and Research (BMBF, STOP-FSGS-01GM2202C).</p></ack><sec id="S23" sec-type="data-availability"><title>Data and code availability</title><p id="P47">PILOT code, including documentation, tutorials and scripts for replicating experiments, are found in <monospace><ext-link ext-link-type="uri" xlink:href="https://github.com/CostaLab/PILOT">https://github.com/CostaLab/PILOT</ext-link></monospace>. Pre-processed R and H5ad objects used as input in benchmarking and case studies are deposited in zenodo, part 1 and zenodo, part 2.</p></sec><fn-group><fn id="FN2" fn-type="con"><p id="P48">Author contributions statement</p><p id="P49">M.J., M.S., and V.P. developed PILOT. R.B., C.K., D.H., M.G., J.N., N. B., and I.C. performed analysis and interpretation of single cell and pathomics data. M. J., R.K., I.C. conceived the experiments. M.J., M.S. and I.C. wrote the manuscript. All authors reviewed the manuscript.</p></fn><fn id="FN3"><p id="P50">Group information</p><p id="P51">Validation Study of the Oxford Classification of IgAN (VALIGA) investigators:</p><p id="P52">M.L. Russo (MA, PhD, Fondazione Ricerca Molinette, Torino, Italy); S. Troyanov (MD, Division of Nephrology, Department of Medicine, Hopital du Sacre-Coeur de Montreal, Montreal, Quebec, Canada); H.T. Cook (MD, Centre for Complement and Inflammation Research, Department of Medicine, Imperial College, London, England); I. Roberts (MD, Department of Cellular Pathology, Oxford University Hospitals NHS Foundation Trust, John Radcliffe Hospital, Oxford, United Kingdom); V. Tesar, (MD, Department of Nephrology, 1st Faculty of Medicine and General University Hospital, Charles University, Prague, Czech Republic); D. Maixnerova (MD, Department of Nephrology, 1st Faculty of Medicine and General University Hospital, Charles University, Prague, Czech Republic); S. Lundberg (MD, Nephrology Unit, Department of Clinical Sciences, Karolinska Institute, Stockholm, Sweden); L. Gesualdo (MD, Department of Nephrology, Emergency and Organ Transplantation, University of Bari “Aldo Moro,” Foggia-Bari, Italy); F. Emma (MD, Division of Nephrology, Department of Pediatric Subspecialties, Bambino Gesù Children’s Hospital IRCCS, Rome, Italy); F. Diomedi (MD, Division of Nephrology, Department of Pediatric Subspecialties, Bambino Gesù Children’s Hospital IRCCS, Rome, Italy); G. Beltrame (MD, Nephrology and Dialysis Unit, San Giovanni Bosco Hospital, and University of Turin,Turin, Italy); C. Rollino (MD, Nephrology and Dialysis Unit, San Giovanni Bosco Hospital, and University of Turin,Turin, Italy); A. Amore (MD, Nephrology Unit, Regina Margherita Children’s Hospital,Turin, Italy); R. Camilla (MD Nephrology Unit, Regina Margherita Children’s Hospital, Turin, Italy); L. Peruzzi (MD, Nephrology Unit, Regina Margherita Children’s Hospital, Turin, Italy); M. Praga (MD, Nephrology Unit, Hospital 12 de Octubre,Madrid, Spain); S. Feriozzi (MD, Nephrology Unit, Belcolle Hospital, Viterbo, Italy), R. Polci, (MD, Nephrology Unit, Belcolle Hospital,Viterbo, Italy); G. Segoloni, (MD, Division of Nephrology Dialysis and Transplantation, Department of Medical Sciences, Città della Salute e della Scienza Hospital and University of Turin, Turin, Italy); L.Colla (MD, Division of Nephrology Dialysis and Transplantation, Department of Medical Sciences, Città della Salute e della Scienza Hospital and University of Turin,Turin, Italy); A. Pani (MD, Nephrology Unit, G. Brotzu Hospital, Cagliari, Italy); D. Piras (MD, Nephrology Unit, G. Brotzu Hospital, Cagliari, Italy), A. Angioi (MD, Nephrology Unit, G. Brotzu Hospital, Cagliari, Italy); G. Cancarini, (MD, Nephrology Unit, Spedali Civili University Hospital, Brescia, Italy); S. Ravera (MD, Nephrology Unit, Spedali Civili University Hospital, Brescia, Italy); M. Durlik (MD, Department of Transplantation Medicine, Nephrology, and Internal Medicine, Medical University ofWarsaw,Warsaw, Poland); E. Moggia (Nephrology Unit, Santa Croce Hospital, Cuneo, Italy); J. Ballarin (MD, Department of Nephrology, Fundacion Puigvert, Barcelona, Spain); S. Di Giulio (MD, Nephrology Unit, San Camillo Forlanini Hospital, Rome, Italy); F. Pugliese (MD, Department of Nephrology, Policlinico Umberto I University Hospital, Rome, Italy); I. Serriello (MD, Department of Nephrology, Policlinico Umberto I University Hospital, Rome, Italy); Y. Caliskan (MD, Division of Nephrology, Department of Internal Medicine, Istanbul Faculty of Medicine, Istanbul University, Istanbul, Turkey); M. Sever (MD, Division of Nephrology, Department of Internal Medicine, Istanbul Faculty of Medicine, Istanbul University, Istanbul, Turkey); I. Kilicaslan (MD, Department of Pathology, Istanbul Faculty of Medicine, Istanbul University, Istanbul, Turkey); F. Locatelli (MD, Department of Nephrology and Dialysis, Alessandro Manzoni Hospital, ASST Lecco, Italy); L. Del Vecchio (MD, Department of Nephrology and Dialysis, Alessandro Manzoni Hospital, ASST Lecco, Italy); J.F.M.Wetzels (MD, Departments of Nephrology, Radboud University Medical Center, Nijmegen, the Netherlands); H. Peters (MD, Departments of Nephrology, Radboud University Medical Center, Nijmegen, the Netherlands); U. Berg (MD, Division of Pediatrics, Department of Clinical Science, Intervention and Technology, Huddinge, Sweden); F. Carvalho (MD, Nephrology Unit, Hospital de Curry Cabral, Lisbon, Portugal); A.C. da Costa Ferreira (MD, Nephrology Unit, Hospital de Curry Cabral, Lisbon, Portugal); M. Maggio (MD, Nephrology Unit, Hospital Maggiore di Lodi, Lodi, Italy); A. Wiecek (MD, Department Nephrology, Endocrinology and Metabolic Diseases, Silesian University of Medicine, Katowice, Poland); M. Ots-Rosenberg(MD, Nephrology Unit, Tartu University Clinics, Tartu,Estonia); R. Magistroni (MD, Department of Nephrology, Policlinic of Modena and Reggio Emilia; Modena, Italy); R. Topaloglu (MD, Department of Pediatric Nephrology and Rheumatology, Hacettepe University, Ankara, Turkey); Y. Bilginer (MD, Department of Pediatric Nephrology and Rheumatology, Hacettepe University, Ankara, Turkey); M. D’Amico (MD, Nephrology Unit, S. Anna Hospital, Como, Italy); M. Stangou (MD, Department of Nephrology, Hippokration General Hospital, Aristotle University of Thessaloniki, Thessaloniki, Greece); F. Giacchino (MD, Nephrology Unit, Ivrea Hospital, Ivrea, Italy); D. Goumenos (MD Department of Nephrology, University Hospital of Patras, Patras, Greece); P. Kalliakmani (MD Department of Nephrology, University Hospital of Patras, Patras, Greece); M. Papasotiriou (MD Department of Nephrology, University Hospital of Patras, Patras, Greece); K. Galesic (MD, Department of Nephrology, University Hospital Dubrava, Zagreb, Croatia); C. Geddes (MD, Renal Unit,Western Infirmary Glasgow, Glasgow, United Kingdom); K. Siamopoulos (MD, Nephrology Unit, Medical School University of Ioanina, Ioannina, Greece); O. Balafa (MD, Nephrology Unit,Medical School University of Ioanina, Ioannina, Greece); M. Galliani (MD, Nephrology Unit, S.Pertini Hospital, Rome, Italy); P. Stratta (MD, Department of Nephrology, Maggiore della Carità Hospital, Piemonte Orientale University, Novara, Italy); M. Quaglia (MD, Department of Nephrology, Maggiore della Carità Hospital, Piemonte Orientale University, Novara, Italy); R. Bergia (MD, Nephrology Unit, Degli Infermi Hospital, Biella,Italy); R. Cravero (MD, Nephrology Unit, Degli Infermi Hospital, Biella, Italy); M. Salvadori, (MD, Department of Nephrology, Careggi Hospital, Florence, Italy); L. Cirami (MD, Department of Nephrology, Careggi Hospital, Florence, Italy); B. Fellstrom (MD, Renal Department, University of Uppsala, Uppsala, Sweden); H. Kloster Smerud (MD, Renal Department, University of Uppsala, Uppsala, Sweden); F. Ferrario (MD, Nephropathology Unit, San Gerardo Hospital, Monza, Italy); T. Stellato (MD, Nephropathology Unit, San Gerardo Hospital, Monza, Italy); J. Egido (MD, Department of Nephrology, Fundacion Jimenez Diaz, Madrid, Spain); C. Martin (MD, Department of Nephrology, Fundacion Jimenez Diaz, Madrid, Spain); J. Floege (MD, Nephrology and Immunology, Medizinische Klinik II, University of Aachen, Aachen, Germany); F. Eitner (MD, Nephrology and Immunology, Medizinische Klinik II, University of Aachen, Aachen, Germany); A. Lupo (MD, Department of Nephrology, University of Verona, Verona, Italy); P. Bernich (MD, Department of Nephrology, University of Verona, Verona, Italy); P. Menè (Department of Nephrology,S. Andrea Hospital, Rome, Italy); M. Morosetti (Nephrology Unit, Grassi Hospital, Ostia, Italy); C. van Kooten, (MD, Department of Nephrology, Leiden University Medical Centre, Leiden, The Netherlands); T. Rabelink (MD, Department of Nephrology, Leiden University Medical Centre, Leiden, The Netherlands); M.E.J. Reinders (MD, Department of Nephrology, Leiden University Medical Centre, Leiden, The Netherlands); J.M. Boria Grinyo (Department of Nephrology, Hospital Bellvitge, Barcelona, Spain); S. Cusinato (MD, Nephrology Unit, Borgomanero Hospital, Borgomanero, Italy); L. Benozzi (MD, Nephrology Unit, Borgomanero Hospital, Borgomanero, Italy); S. Savoldi, (MD, Nephrology Unit, Civile Hospital, Ciriè, Italy); C. Licata (MD, Nephrology Unit, Civile Hospital, Ciriè, Italy); M. Mizerska-Wasiak (MD, Department of Pediatrics, Medical University ofWarsaw,Warsaw, Poland); G. Martina (MD, Nephrology Unit, Chivasso Hospital, Chivasso, Italy); A. Messuerotti (MD, Nephrology Unit, Chivasso Hospital, Chivasso, Italy); A. Dal Canton (MD, Nephrology Unit, S. Matteo Hospital, Pavia, Italy); C. Esposito (MD, Nephrology Unit, Maugeri Foundation, Pavia, Italy); C. Migotto (MD, Nephrology Unit, Maugeri Foundation, Pavia, Italy); G. Triolo MD, Nephrology Unit CTO, Turin, Italy); F.Mariano (MD, Nephrology Unit CTO, Turin, Italy); C. Pozzi (MD, Nephrology Unit, Bassini Hospital, Cinisello Balsamo, Italy); R. Boero (MD, Nephrology Unit, Martini Hospital, Turin, Italy);</p><p id="P53">VALIGA pathology investigators: S. Bellur (MD, Department of Cellular Pathology, Oxford University Hospitals NHS Foundation Trust, John Radcliffe Hospital, Oxford, United Kingdom); G.Mazzucco (MD, Pathology Department, University of Turin, Turin, Italy); C. Giannakakis (MD, Pathology Department, La Sapienza University, Rome, Italy); E. Honsova (MD, Department of Clinical and Transplant Pathology, Institute for Clinical and Experimental Medicine, Prague, Czech Republic); B. Sundelin (MD Department of Pathology and Cytology, Karolinska University Hospital, Karolinska Institute, Stockholm, Sweden); A.M. Di Palma (Nephrology Unit, Aldo Moro University, Foggia-Bari, Italy); F. Ferrario (MD, Nephropathology Unit, San Gerardo Hospital, Monza, Italy); E. Gutiérrez (MD, Renal, Vascular and Diabetes Research Laboratory, Fundación Instituto de Investigaciones Sanitarias-Fundación Jiménez Díaz, Universidad Autónoma de Madrid, Madrid, Spain); A.M. Asunis (MD, Department of Pathology, Brotzu Hospital, Cagliari, Italy); J. Barratt (MD, The JohnWalls Renal Unit, Leicester General Hospital, Leicester, United Kingdom); R. Tardanico (MD, Department of Pathology, Spedali Civili Hospital, University of Brescia, Brescia, Italy); A. Perkowska-Ptasinska (MD, Department of Transplantation Medicine, Nephrology and Internal Medicine, Medical University of Warsaw, Warsaw, Poland); J. Arce Terroba (MD, Pathology Department, Fundació Puigvert, Barcelona, Spain); M. Fortunato (MD, Pathology Department, S. Croce Hospital, Cuneo, Italy); A. Pantzaki (MD, Department of Pathology, Hippokration Hospital, Thessaloniki, Greece); Y. Ozluk (MD, Department of Pathology, Istanbul University, Istanbul Faculty of Medicine, Istanbul, Turkey); E. Steenbergen (MD, Radboud University Medical Center, Department of Pathology, Nijmegen, The Netherlands); M. Soderberg (MD, Department of Pathology, Drug Safety and Metabolism, Huddinge, Sweden); Z. Riispere (MD, Department of Pathology, University of Tartu, Tartu, Estonia); L. Furci (MD, Pathology Department, University of Modena, Italy); D. Orhan (MD, Department of Pediatrics, Division of Rheumatology, Hacettepe University Faculty of Medicine, Ankara, Turkey); D. Kipgen (MD,Pathology Department, Queen Elizabeth University Hospital, Glasgow, United Kingdom); D. Casartelli (Pathology Department, Manzoni Hospital, Lecco, Italy); D. Galesic Ljubanovic (MD, Nephrology Department, University Hospital, Zagreb, Croatia; Zagreb, Croatia); H Gakiopoulou (MD, Department of Pathology, National and Kapodistrian University of Athens, Athens, Greece); E. Bertoni (MD, Nephrology Department, Careggi Hospital, Florence, Italy); P. Cannata Ortiz (MD, Pathology Department, IIS-Fundacion Jimenez Diaz UAM, Madrid, Spain); H. KarkoszkaMD, (Nephrology, Endocrinology and Metabolic Diseases, Medical University of Silesia, Katowice, Katowice, Poland); H.J. Groene (MD, Cellular and Molecular Pathology, German Cancer Research Center, Heidelberg, Germany); A. Stoppacciaro (MD, Surgical Pathology Units, Department of Clinical and Molecular Medicine, Ospedale Sant’Andrea, Sapienza University of Rome, Rome, Italy); I. Bajema (MD, Department of Pathology, Leiden University Medical Center, Leiden, The Netherlands); J. Bruijn (MD, Department of Pathology, Leiden University Medical Center, Leiden, The Netherlands);X. Fulladosa Oliveras (MD, Nephrology Unit, Bellvitge University Hospital, Hospitalet de Llobregat, Barcelona, Spain); J. Maldyk (MD, Division of Pathomorphology, Children’s Clinical Hospital, Medical University ofWarsaw,Warsaw, Poland); and E. Ioachim (MD, Department of Pathology, Medical School, University of Ioannina, Ioannina, Greece); the Oxford derivation and North American validation investigators: Bavbek N (MD, Department of Pathology, Vanderbilt University, Nashville, Tennessee); Cook T (MD, Imperial College, London, England), Troyanov S (MD, Division of Nephrology, Department of Medicine, Hopital du Sacre-Coeur de Montreal, Montreal, Quebec, Canada); Alpers C (MD, Department of Pathology, University of Washington Medical Center, Seattle,Washington), Amore A (MD, Nephrology, Dialysis and Transplantation Unit, Regina Margherita Children’s Hospital, University of Turin, Turin, Italy), Barratt J (MD, The John Walls Renal Unit, Leicester General Hospital, Leicester, England); Berthoux F (MD, Department of Nephrology, Dialysis, and Renal Transplantation, Hôpital Nord, CHU de Saint-Etienne, Saint-Etienne, France); Bonsib S (MD, Department of Pathology, LSU Health Sciences Center, Shreveport, Los Angeles); Bruijn J (MD, Department of Pathology, Leiden University Medical Center, Leiden, The Netherlands); D’Agati V (MD, Department of Pathology, Columbia University College of Physicians Surgeons, New York, New York); D’Amico G (MD, Fondazione D’Amico per la Ricerca sulle Malattie Renali, Milan, Italy); Emancipator S (MD, Department of Pathology, Case Western Reserve University, Cleveland, Ohio); Emmal F (MD, Division of Nephrology and Dialysis, Department of Nephrology and Urology, Bambino Gesù Children’s Hospital and Research Institute, Piazza S Onofrio, Rome, Italy); Ferrario F (MD, Renal Immunopathology Center, San Carlo Borromeo Hospital, Milan, Italy); Fervenza F (MD PhD, Division of Nephrology and Hypertension, Mayo Clinic, Rochester); Florquin S (MD, Department of Pathology, Academic Medical Center, University of Amsterdam, Amsterdam, The Netherlands); Fogo A (MD, Department of Pathology, Vanderbilt University, Nashville, Tennessee); Geddes C (MD, The Renal Unit, Western Infirmary, Glasgow, Scotland); Groene H (MD, Department of Cellular and Molecular Pathology, German Cancer Research Center, Heidelberg, Germany); Haas M(MD, Department of Pathology and Laboratory Medicine, Cedars-Sinai Medical Center, Los Angeles, California); Hill P (MD, St Vincent’s Hospital, Melbourne, Australia); Hogg R (MD, Scott and White Medical Center, Temple, Texas (retired)); Hsu S (MD, Division of Nephrology, Hypertension and Renal Transplantation, College of Medicine, University of Florida, Gainesville, Florida); Hunley T (MD, Department of Pathology, Vanderbilt University, Nashville, Tennessee); Hladunewich (MD, Division of Nephrology, Sunnybrook Health Science Center, University of Toronto, Ontario, Canada M); Jennette C (MD, Department of Pathology and Laboratory Medicine, University of North Carolina, Chapel Hill, North Carolina); Joh K (MD, Division of Immunopathology, Clinical Research Center Chiba, East National Hospital, Chiba, Japan); Julian B (MD, Department of Medicine, University of Alabama at Birmingham, Birmingham, Alabama); Kawamura T (MD, Division of Nephrology and Hypertension, Jikei University School of Medicine, Tokyo, Japan); Lai F (MD, The Chinese University of Hong Kong, Hong Kong); Leung C (MD, Department of Medicine, Prince of Wales Hospital, Chinese University of Hong Kong, Hong Kong); Li L (MD, Research Institute of Nephrology, Jinling Hospital, Nanjing University School of Medicine, Nanjing, China); Li P (MD, Department of Medicine, Prince of Wales Hospital, Chinese University of Hong Kong, Hong Kong); Liu Z (MD, Research Institute of Nephrology, Jinling Hospital, Nanjing University School of Medicine, Nanjing, China); Massat A (MD, Division of Nephrology and Hypertension, Mayo Clinic, Rochester, Minnesota); Mackinnon B (MD, The Renal Unit,Western Infirmary, Glasgow, Scotland); Mezzano S (MD, Departamento de Nefrología, Escuela de Medicina, Universidad Austral, Valdivia, Chile); Schena F (MD, Renal, Dialysis and Transplant Unit, Policlinico, Bari, Italy); Tomino Y (MD, Division of Nephrology, Department of Internal Medicine, Juntendo University School of Medicine, Tokyo, Japan); Walker P (MD, Nephropathology Associates, Little Rock, Arkansas);Wang H (MD, Renal Division of Peking University First Hospital, Peking University Institute of Nephrology, Beijing, China (deceased)); Weening J (MD, Erasmus Medical Center, Rotterdam, The Netherlands); and Yoshikawa N (MD, Department of Pediatrics, Wakayama Medical University, Wakayama City, Japan); the International investigators: Cai-Hong Zeng (MD, Nanjing University School of Medicine, Nanjing, China); Sufang Shi (MD, Peking University Institute of Nephrology, Beijing, China); C.Nogi (MD, Juntendo University, Faculty of Medicine, Tokyo, Japan); H.Suzuki (MD, Juntendo University, Faculty of Medicine, Tokyo, Japan); K. Koike (MD, Division of Nephrology and Hypertension, Department of Internal Medicine, Jikei University School of Medicine, Tokyo, Japan); K. Hirano (MD, Division of Nephrology and Hypertension, Department of Internal Medicine, Jikei University School of Medicine, Tokyo, Japan); T. Kawamura (MD, Division of Nephrology and Hypertension, Department of Internal Medicine, Jikei University School of Medicine, Tokyo, Japan); T. Yokoo (MD, Division of Nephrology and Hypertension, Department of Internal Medicine, Jikei UniversitySchool of Medicine, Tokyo, Japan); M. Hanai (MD, Division of Nephrology, Department of Medicine, Kurume University School of Medicine, Fukuoka, Japan); K. Fukami (MD, Division of Nephrology, Department of Medicine, Kurume University School of Medicine, Fukuoka" Japan); K. Takahashi (MD, Department of Nephrology, Fujita Health University School of Medicne, Aichi, Japan); Y. Yuzawa (MD, Department of Nephrology, Fujita Health University School of Medicine, Aichi, Japan); M. Niwa (MD, Department of Nephrology, Nagoya University Graduate School of Medicine, Aichi, Japan); Y. Yasuda (MD, Department of Nephrology, Nagoya University Graduate School of Medicine, Aichi, Japan); S. Maruyama (MD, Department of Nephrology, Nagoya University Graduate School of Medicine, Aichi, Japan); D. Ichikawa (MD, Division of Nephrology and Hypertension, Department of Internal Medicine, St Marianna University School of Medicine, Kanagawa,Japan); T. Suzuki (MD, Division of Nephrology and Hypertension, Department of Internal Medicine, St Marianna University School of Medicine, Kanagawa, Japan); S. Shirai (MD, Division of Nephrology and Hypertension, Department of Internal Medicine, St Marianna University School of Medicine, Kanagawa, Japan); A. Fukuda (MD, First Department of Internal Medicine, Faculty of Medicine, University of Miyazaki, Miyazaki, Japan); S. Fujimoto (MD, Department of Hemovascular Medicine and Artificial Organs, Faculty of Medicine, University of Miyazaki, Miyazaki, Japan); H. Trimarchi (MD, Division of Nephrology, Hospital Britanico, Buenos Aires, Argentina).</p></fn><fn id="FN4"><label>1</label><p id="P54">This computing time of PhEMD also includes clustering of single cells, as this is a required step in PhEMD framework</p></fn><fn id="FN5"><label>2</label><p id="P55">For simplicity, we focus here on single cell data, but the same formalism applies to pathomics data</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cao</surname><given-names>J</given-names></name><etal/></person-group><article-title>A human cell atlas of fetal gene expression</article-title><source>Science</source><year>2020</year><volume>370</volume><elocation-id>eaba7721</elocation-id><pub-id pub-id-type="pmcid">PMC7780123</pub-id><pub-id pub-id-type="pmid">33184181</pub-id><pub-id pub-id-type="doi">10.1126/science.aba7721</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Consortium</surname><given-names>TS</given-names></name><etal/></person-group><article-title>The tabula sapiens: A multiple-organ, single-cell transcriptomic atlas of humans</article-title><source>Science</source><year>2022</year><volume>376</volume><elocation-id>eabl4896</elocation-id><pub-id pub-id-type="pmcid">PMC9812260</pub-id><pub-id pub-id-type="pmid">35549404</pub-id><pub-id pub-id-type="doi">10.1126/science.abl4896</pub-id></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sklavenitis-Pistofidis</surname><given-names>R</given-names></name><name><surname>Getz</surname><given-names>G</given-names></name><name><surname>Ghobrial</surname><given-names>I</given-names></name></person-group><article-title>Single-cell rna sequencing: one step closer to the clinic</article-title><source>Nat Medicine</source><year>2021</year><volume>27</volume><fpage>375</fpage><lpage>376</lpage><pub-id pub-id-type="pmid">33664491</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kuppe</surname><given-names>C</given-names></name><etal/></person-group><article-title>Spatial multi-omic map of human myocardial infarction</article-title><source>Nature</source><year>2022</year><fpage>1</fpage><lpage>12</lpage><pub-id pub-id-type="pmcid">PMC9364862</pub-id><pub-id pub-id-type="pmid">35948637</pub-id><pub-id pub-id-type="doi">10.1038/s41586-022-05060-x</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stephenson</surname><given-names>E</given-names></name><etal/></person-group><article-title>Single-cell multi-omics analysis of the immune response in covid-19</article-title><source>Nat medicine</source><year>2021</year><volume>27</volume><fpage>904</fpage><lpage>916</lpage><pub-id pub-id-type="pmcid">PMC8121667</pub-id><pub-id pub-id-type="pmid">33879890</pub-id><pub-id pub-id-type="doi">10.1038/s41591-021-01329-2</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peng</surname><given-names>J</given-names></name><etal/></person-group><article-title>Single-cell rna-seq highlights intra-tumoral heterogeneity and malignant progression in pancreatic ductal adenocarcinoma</article-title><source>Cell research</source><year>2019</year><volume>29</volume><fpage>725</fpage><lpage>738</lpage><pub-id pub-id-type="pmcid">PMC6796938</pub-id><pub-id pub-id-type="pmid">31273297</pub-id><pub-id pub-id-type="doi">10.1038/s41422-019-0195-y</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hölscher</surname><given-names>DL</given-names></name><etal/></person-group><article-title>Next-generation morphometry for pathomics-data mining in histopathology</article-title><source>Nat Commun</source><year>2023</year><volume>14</volume><fpage>470</fpage><pub-id pub-id-type="pmcid">PMC9884209</pub-id><pub-id pub-id-type="pmid">36709324</pub-id><pub-id pub-id-type="doi">10.1038/s41467-023-36173-0</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>WS</given-names></name><etal/></person-group><article-title>Uncovering axes of variation among single-cell cancer specimens</article-title><source>Nat Methods</source><year>2020</year><volume>17</volume><fpage>302</fpage><lpage>310</lpage><pub-id pub-id-type="pmcid">PMC7339867</pub-id><pub-id pub-id-type="pmid">31932777</pub-id><pub-id pub-id-type="doi">10.1038/s41592-019-0689-z</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Ravindra</surname><given-names>N</given-names></name><name><surname>Sehanobish</surname><given-names>A</given-names></name><name><surname>Pappalardo</surname><given-names>JL</given-names></name><name><surname>Hafler</surname><given-names>DA</given-names></name><name><surname>van Dijk</surname><given-names>D</given-names></name></person-group><source>Disease state prediction from single-cell data using graph attention networks</source><conf-name>Proceedings of the ACM Conference on Health, Inference, and Learning</conf-name><conf-sponsor>ACM</conf-sponsor><conf-loc>New York, NY, USA</conf-loc><year>2020</year><fpage>121</fpage><lpage>130</lpage><comment>2002.07128</comment><pub-id pub-id-type="doi">10.1145/3368555.3384449</pub-id></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lublin</surname><given-names>FD</given-names></name><name><surname>Reingold</surname><given-names>SC</given-names></name><etal/></person-group><article-title>Defining the clinical course of multiple sclerosis: results of an international survey</article-title><source>Neurology</source><year>1996</year><volume>46</volume><fpage>907</fpage><lpage>911</lpage><pub-id pub-id-type="pmid">8780061</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>L</given-names></name><etal/></person-group><article-title>SCANCell reveals diverse inter-cluster interaction patterns in systemic lupus erythematosus across the disease spectrum</article-title><source>Bioinformatics</source><year>2022</year><volume>38</volume><fpage>1361</fpage><lpage>1368</lpage><pub-id pub-id-type="pmid">34664638</pub-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kuchroo</surname><given-names>M</given-names></name><etal/></person-group><article-title>Multiscale phate identifies multimodal signatures of covid-19</article-title><source>Nat Biotechnol</source><year>2022</year><volume>40</volume><fpage>681</fpage><lpage>691</lpage><pub-id pub-id-type="pmcid">PMC10015653</pub-id><pub-id pub-id-type="pmid">35228707</pub-id><pub-id pub-id-type="doi">10.1038/s41587-021-01186-x</pub-id></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Flores</surname><given-names>ROR</given-names></name><name><surname>Lanzer</surname><given-names>JD</given-names></name><name><surname>Dimitrov</surname><given-names>D</given-names></name><name><surname>Velten</surname><given-names>B</given-names></name><name><surname>Saez-Rodriguez</surname><given-names>J</given-names></name></person-group><article-title>Multicellular factor analysis of single-cell data for a tissue-centric understanding of disease</article-title><source>bioRxiv</source><year>2023</year><comment>2023.02.23.529642</comment></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peyré</surname><given-names>G</given-names></name><name><surname>Cuturi</surname><given-names>M</given-names></name></person-group><article-title>Computational optimal transport</article-title><source>Foundations Trends Mach Learn</source><year>2019</year><volume>11</volume><fpage>1</fpage><lpage>257</lpage><comment>1803.00567</comment><pub-id pub-id-type="doi">10.1561/2200000073</pub-id></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Coifman</surname><given-names>RR</given-names></name><name><surname>Lafon</surname><given-names>S</given-names></name></person-group><article-title>Diffusion maps</article-title><source>Appl computational harmonic analysis</source><year>2006</year><volume>21</volume><fpage>5</fpage><lpage>30</lpage><pub-id pub-id-type="pmcid">PMC3134361</pub-id><pub-id pub-id-type="pmid">21765628</pub-id><pub-id pub-id-type="doi">10.1016/j.acha.2010.10.001</pub-id></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Albergante</surname><given-names>L</given-names></name><etal/></person-group><article-title>Robust and scalable learning of complex intrinsic dataset geometry via elpigraph</article-title><source>Entropy</source><year>2020</year><volume>22</volume><fpage>296</fpage><pub-id pub-id-type="pmcid">PMC7516753</pub-id><pub-id pub-id-type="pmid">33286070</pub-id><pub-id pub-id-type="doi">10.3390/e22030296</pub-id></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Traag</surname><given-names>VA</given-names></name><name><surname>Waltman</surname><given-names>L</given-names></name><name><surname>Van Eck</surname><given-names>NJ</given-names></name></person-group><article-title>From louvain to leiden: guaranteeing well-connected communities</article-title><source>Sci reports</source><year>2019</year><volume>9</volume><fpage>1</fpage><lpage>12</lpage><pub-id pub-id-type="pmcid">PMC6435756</pub-id><pub-id pub-id-type="pmid">30914743</pub-id><pub-id pub-id-type="doi">10.1038/s41598-019-41695-z</pub-id></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Huber</surname><given-names>PJ</given-names></name></person-group><article-title>A robust version of the probability ratio test</article-title><source>The Annals Math Stat</source><year>1965</year><fpage>1753</fpage><lpage>1758</lpage></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van den Berge</surname><given-names>K</given-names></name><etal/></person-group><article-title>Trajectory-based differential expression analysis for single-cell sequencing data</article-title><source>Nat Commun</source><year>2020</year><volume>11</volume><fpage>1201</fpage><pub-id pub-id-type="pmcid">PMC7058077</pub-id><pub-id pub-id-type="pmid">32139671</pub-id><pub-id pub-id-type="doi">10.1038/s41467-020-14766-3</pub-id></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Perez</surname><given-names>RK</given-names></name><etal/></person-group><article-title>Single-cell rna-seq reveals cell type-specific molecular and genetic associations to lupus</article-title><source>Science</source><year>2022</year><volume>376</volume><elocation-id>eabf1970</elocation-id><pub-id pub-id-type="pmcid">PMC9297655</pub-id><pub-id pub-id-type="pmid">35389781</pub-id><pub-id pub-id-type="doi">10.1126/science.abf1970</pub-id></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lake</surname><given-names>BB</given-names></name><etal/></person-group><article-title>An atlas of healthy and injured cell states and niches in the human kidney</article-title><source>bioRxiv</source><year>2021</year><elocation-id>2021–07</elocation-id></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Salcher</surname><given-names>S</given-names></name><etal/></person-group><article-title>High-resolution single-cell atlas reveals diversity and plasticity of tissue-resident neutrophils in non-small cell lung cancer</article-title><source>Cancer Cell</source><year>2022</year><volume>40</volume><fpage>1503</fpage><lpage>1520</lpage><pub-id pub-id-type="pmcid">PMC9767679</pub-id><pub-id pub-id-type="pmid">36368318</pub-id><pub-id pub-id-type="doi">10.1016/j.ccell.2022.10.008</pub-id></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Han</surname><given-names>G</given-names></name><etal/></person-group><article-title>Follicular lymphoma microenvironment characteristics associated with tumor cell mutations and mhc class ii expression</article-title><source>Blood cancer discovery</source><year>2022</year><volume>3</volume><fpage>428</fpage><lpage>443</lpage><pub-id pub-id-type="pmcid">PMC9894575</pub-id><pub-id pub-id-type="pmid">35687817</pub-id><pub-id pub-id-type="doi">10.1158/2643-3230.BCD-21-0075</pub-id></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hrovatin</surname><given-names>K</given-names></name><etal/></person-group><article-title>Delineating mouse b -cell identity during lifetime and in diabetes with a single cell atlas</article-title><source>bioRxiv</source><year>2022</year><elocation-id>2022–12</elocation-id></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Coppo</surname><given-names>R</given-names></name><etal/></person-group><article-title>Validation of the oxford classification of iga nephropathy in cohorts with different presentations and treatments</article-title><source>Kidney international</source><year>2014</year><volume>86</volume><fpage>828</fpage><lpage>836</lpage><pub-id pub-id-type="pmcid">PMC4184028</pub-id><pub-id pub-id-type="pmid">24694989</pub-id><pub-id pub-id-type="doi">10.1038/ki.2014.63</pub-id></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Witten</surname><given-names>DM</given-names></name></person-group><source>Classification and clustering of sequencing data using a poisson model</source><year>2011</year></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rand</surname><given-names>WM</given-names></name></person-group><article-title>Objective criteria for the evaluation of clustering methods</article-title><source>J Am Stat association</source><year>1971</year><volume>66</volume><fpage>846</fpage><lpage>850</lpage></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rousseeuw</surname><given-names>PJ</given-names></name></person-group><article-title>Silhouettes: a graphical aid to the interpretation and validation of cluster analysis</article-title><source>J computational applied mathematics</source><year>1987</year><volume>20</volume><fpage>53</fpage><lpage>65</lpage></element-citation></ref><ref id="R29"><label>29</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baghy</surname><given-names>K</given-names></name><etal/></person-group><article-title>Ablation of the decorin gene enhances experimental hepatic fibrosis and impairs hepatic healing in mice</article-title><source>Lab investigation; a journal technical methods pathology</source><year>2011</year><volume>91</volume><fpage>439</fpage><lpage>51</lpage><pub-id pub-id-type="pmcid">PMC5074558</pub-id><pub-id pub-id-type="pmid">20956977</pub-id><pub-id pub-id-type="doi">10.1038/labinvest.2010.172</pub-id></element-citation></ref><ref id="R30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Isaka</surname><given-names>Y</given-names></name><etal/></person-group><article-title>Gene therapy by skeletal muscle expression of decorin prevents fibrotic disease in rat kidney</article-title><source>Nat Medicine</source><year>1996</year><volume>2</volume><fpage>418</fpage><lpage>423</lpage><pub-id pub-id-type="pmid">8597951</pub-id></element-citation></ref><ref id="R31"><label>31</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hill</surname><given-names>KE</given-names></name><name><surname>Lovett</surname><given-names>BM</given-names></name><name><surname>Schwarzbauer</surname><given-names>JE</given-names></name></person-group><article-title>Heparan sulfate is necessary for the early formation of nascent fibronectin and collagen I fibrils at matrix assembly sites</article-title><source>J Biol Chem</source><year>2022</year><volume>298</volume><elocation-id>101479</elocation-id><pub-id pub-id-type="pmcid">PMC8801470</pub-id><pub-id pub-id-type="pmid">34890641</pub-id><pub-id pub-id-type="doi">10.1016/j.jbc.2021.101479</pub-id></element-citation></ref><ref id="R32"><label>32</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chang</surname><given-names>S</given-names></name><etal/></person-group><article-title>Histone deacetylases 5 and 9 govern responsiveness of the heart to a subset of stress signals and play redundant roles in heart development</article-title><source>Mol cellular biology</source><year>2004</year><volume>24</volume><fpage>8467</fpage><lpage>76</lpage><pub-id pub-id-type="pmcid">PMC516756</pub-id><pub-id pub-id-type="pmid">15367668</pub-id><pub-id pub-id-type="doi">10.1128/MCB.24.19.8467-8476.2004</pub-id></element-citation></ref><ref id="R33"><label>33</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vafiadaki</surname><given-names>E</given-names></name><name><surname>Arvanitis</surname><given-names>DA</given-names></name><name><surname>Sanoudou</surname><given-names>D</given-names></name></person-group><article-title>Muscle LIM Protein: Master regulator of cardiac and skeletal muscle functions</article-title><source>Gene</source><year>2015</year><volume>566</volume><fpage>1</fpage><lpage>7</lpage><pub-id pub-id-type="pmcid">PMC6660132</pub-id><pub-id pub-id-type="pmid">25936993</pub-id><pub-id pub-id-type="doi">10.1016/j.gene.2015.04.077</pub-id></element-citation></ref><ref id="R34"><label>34</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Taniguchi</surname><given-names>K</given-names></name><etal/></person-group><article-title>Mammalian Formin Fhod3 Regulates Actin Assembly and Sarcomere Organization in Striated Muscles</article-title><source>J Biol Chem</source><year>2009</year><volume>284</volume><fpage>29873</fpage><lpage>29881</lpage><pub-id pub-id-type="pmcid">PMC2785617</pub-id><pub-id pub-id-type="pmid">19706596</pub-id><pub-id pub-id-type="doi">10.1074/jbc.M109.059303</pub-id></element-citation></ref><ref id="R35"><label>35</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marx</surname><given-names>V</given-names></name></person-group><article-title>How single-cell multi-omics builds relationships</article-title><source>Nat methods</source><year>2022</year><volume>19</volume><fpage>142</fpage><lpage>146</lpage><pub-id pub-id-type="pmcid">PMC8805430</pub-id><pub-id pub-id-type="pmid">35105969</pub-id><pub-id pub-id-type="doi">10.1038/s41592-022-01392-8</pub-id></element-citation></ref><ref id="R36"><label>36</label><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Bonneel</surname><given-names>N</given-names></name><name><surname>Van De Panne</surname><given-names>M</given-names></name><name><surname>Paris</surname><given-names>S</given-names></name><name><surname>Heidrich</surname><given-names>W</given-names></name></person-group><source>Displacement interpolation using lagrangian mass transport</source><conf-name>Proceedings of the 2011 SIGGRAPH Asia conference</conf-name><year>2011</year><fpage>1</fpage><lpage>12</lpage></element-citation></ref><ref id="R37"><label>37</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Flamary</surname><given-names>R</given-names></name><etal/></person-group><article-title>Pot: Python optimal transport</article-title><source>J Mach Learn Res</source><year>2021</year><volume>22</volume><fpage>1</fpage><lpage>8</lpage></element-citation></ref><ref id="R38"><label>38</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rubner</surname><given-names>Y</given-names></name><name><surname>Tomasi</surname><given-names>C</given-names></name><name><surname>Guibas</surname><given-names>LJ</given-names></name></person-group><article-title>The earth mover’s distance as a metric for image retrieval</article-title><source>Int journal computer vision</source><year>2000</year><volume>40</volume><fpage>99</fpage><lpage>121</lpage></element-citation></ref><ref id="R39"><label>39</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Coifman</surname><given-names>RR</given-names></name><etal/></person-group><article-title>Geometric diffusions as a tool for harmonic analysis and structure definition of data: Diffusion maps</article-title><source>Proc Natl Acad Sci United States Am</source><year>2005</year><volume>102</volume><fpage>7426</fpage><lpage>7431</lpage><pub-id pub-id-type="pmcid">PMC1140422</pub-id><pub-id pub-id-type="pmid">15899970</pub-id><pub-id pub-id-type="doi">10.1073/pnas.0500334102</pub-id></element-citation></ref><ref id="R40"><label>40</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>J</given-names></name><name><surname>Vinck</surname><given-names>M</given-names></name></person-group><article-title>Improved visualization of high-dimensional data using the distance-of-distance transformation</article-title><source>PLoS computational biology</source><year>2022</year><volume>18</volume><elocation-id>e1010764</elocation-id><pub-id pub-id-type="pmcid">PMC9812310</pub-id><pub-id pub-id-type="pmid">36538561</pub-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1010764</pub-id></element-citation></ref><ref id="R41"><label>41</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Berry</surname><given-names>T</given-names></name><name><surname>Harlim</surname><given-names>J</given-names></name></person-group><article-title>Variable bandwidth diffusion kernels</article-title><source>Appl Comput Harmon Analysis</source><year>2016</year><volume>40</volume><fpage>68</fpage><lpage>96</lpage></element-citation></ref><ref id="R42"><label>42</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Huber</surname><given-names>PJ</given-names></name></person-group><chapter-title>Robust estimation of a location parameter</chapter-title><source>Breakthroughs in statistics</source><publisher-name>Springer</publisher-name><year>1992</year><fpage>492</fpage><lpage>518</lpage></element-citation></ref><ref id="R43"><label>43</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Frank</surname><given-names>E</given-names></name><name><surname>Harrell</surname><given-names>J</given-names></name></person-group><source>Regression Modeling Strategies</source><publisher-loc>New York</publisher-loc><publisher-name>Springer-Verlag</publisher-name><year>2001</year></element-citation></ref><ref id="R44"><label>44</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ren</surname><given-names>X</given-names></name><etal/></person-group><article-title>Covid-19 immune features revealed by a large-scale single-cell transcriptome atlas</article-title><source>Cell</source><year>2021</year><volume>184</volume><fpage>1895</fpage><lpage>1913</lpage><pub-id pub-id-type="pmcid">PMC8582084</pub-id><pub-id pub-id-type="pmid">34767776</pub-id><pub-id pub-id-type="doi">10.1016/j.cell.2021.10.023</pub-id></element-citation></ref><ref id="R45"><label>45</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hao</surname><given-names>Y</given-names></name><etal/></person-group><article-title>Integrated analysis of multimodal single-cell data</article-title><source>Cell</source><year>2021</year><volume>184</volume><fpage>3573</fpage><lpage>3587</lpage><pub-id pub-id-type="pmcid">PMC8238499</pub-id><pub-id pub-id-type="pmid">34062119</pub-id><pub-id pub-id-type="doi">10.1016/j.cell.2021.04.048</pub-id></element-citation></ref><ref id="R46"><label>46</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Trapnell</surname><given-names>C</given-names></name><etal/></person-group><article-title>The dynamics and regulators of cell fate decisions are revealed by pseudotemporal ordering of single cells</article-title><source>Nat biotechnology</source><year>2014</year><volume>32</volume><fpage>381</fpage><lpage>386</lpage><pub-id pub-id-type="pmcid">PMC4122333</pub-id><pub-id pub-id-type="pmid">24658644</pub-id><pub-id pub-id-type="doi">10.1038/nbt.2859</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>PILOT schematic and benchmarking</title><p><bold>A.</bold> PILOT receives as input clustered and integrated scRNA-seq data. Next, it estimates patient-specific cluster distribution and a cost function (similarity between clusters). These are used as input for an optimal transport algorithm<sup><xref ref-type="bibr" rid="R14">14</xref></sup>. The transport costs provide a distance (Wasserstein), which can be used for unsupervised analysis, such as a diffusion map and disease progression analysis. Finally, PILOT uses non-linear regression to find cellular, molecular, or morphological features associated with disease progression.</p></caption><graphic xlink:href="EMS158934-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><p><bold>A)</bold> Box plot with ARI values (y-axis) for distinct evaluated methods (x-axis) (left) and ranking distributions (x-axis) based on the Friedman-Nemenyi test for distinct methods (right). Methods with average ranking in the gray area are top performers. <bold>B)</bold> and <bold>C)</bold> are equivalent of <bold>A</bold> for Silhouette and AUPR statistics. <bold>D)</bold> Difusion maps (top) and fraction of patient labels vs. pseudotime (bottom) on lung cell atlas data set for distinct algorithms. For this data, labels COPD, SCLC, LA, and NSCLC corresponds to Chronic Obstructive Pulmonary Disease, Squamous Cell Lung Carcinoma, Lung Adenocarcinoma, and Non Small Cell Lung Carcinoma groups respectively. <bold>E)</bold> Difusion maps (top) and fraction of patient labels vs. pseudotime (bottom) for Kidney IgAN (Tubule).</p></caption><graphic xlink:href="EMS158934-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>Sample level analysis of myocardial infarction</title><p><bold>A.</bold> Diffusion map and disease progression trajectory in myocardial infarction. <bold>B.</bold> Fraction (y-axis) of top four cells (highest R2) vs. disease progression (x-axis). <bold>C.</bold> Expression (y-axis) of selected genes with significant changes in disease progression (x-axis) for healthy cardiomyocytes and myofibroblast cells.</p></caption><graphic xlink:href="EMS158934-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>Sample level analysis of kidney IgAN</title><p><bold>A.</bold> Diffusion map and disease progression trajectory in kidney IgAN. <bold>B.</bold> GFR values (y-axis) ver<ext-link ext-link-type="uri" xlink:href="https://www.overleaf.com/project/643d10d6312455328d1029d9sus">https://www.overleaf.com/project/643d10d6312455328d1029d9sus</ext-link> disease progression (x-axis). <bold>C.</bold> Morphometric values (y-axis) of kidney structures vs. disease progression (x-axis). <bold>D.</bold> Kaplan-meyer plot with the time to kidney failure from patients within the upper quartile (high progression score) vs. other samples (low progression score).</p></caption><graphic xlink:href="EMS158934-f004"/></fig><table-wrap id="T1" position="float" orientation="portrait"><label>Table 1</label><caption><title>Characteristics of data sets used for benchmarking.</title></caption><table frame="box" rules="all"><thead><tr><th align="center" valign="middle">Data</th><th align="center" valign="middle">Type</th><th align="center" valign="middle">#Cells</th><th align="center" valign="middle">#Samples</th><th align="center" valign="middle">#Cell_types</th><th align="center" valign="middle">#Classes</th></tr></thead><tbody><tr><td align="center" valign="middle">COVID-19 PBMC</td><td align="center" valign="middle">scRNA-seq</td><td align="center" valign="middle">993,171</td><td align="center" valign="middle">151</td><td align="center" valign="middle">10</td><td align="center" valign="middle">3</td></tr><tr><td align="center" valign="middle">Myocardial Infraction</td><td align="center" valign="middle">scRNA-seq</td><td align="center" valign="middle">115,517</td><td align="center" valign="middle">20</td><td align="center" valign="middle">11</td><td align="center" valign="middle">2</td></tr><tr><td align="center" valign="middle">Lupus PBMC</td><td align="center" valign="middle">scRNA-seq</td><td align="center" valign="middle">1,263,676</td><td align="center" valign="middle">261</td><td align="center" valign="middle">11</td><td align="center" valign="middle">2</td></tr><tr><td align="center" valign="middle">Pancreas (PDAC)</td><td align="center" valign="middle">scRNA-seq</td><td align="center" valign="middle">57,530</td><td align="center" valign="middle">35</td><td align="center" valign="middle">10</td><td align="center" valign="middle">2</td></tr><tr><td align="center" valign="middle">Kidney</td><td align="center" valign="middle">scRNA-seq</td><td align="center" valign="middle">76,020</td><td align="center" valign="middle">36</td><td align="center" valign="middle">57</td><td align="center" valign="middle">3</td></tr><tr><td align="center" valign="middle">Lung</td><td align="center" valign="middle">scRNA-seq</td><td align="center" valign="middle">941,504</td><td align="center" valign="middle">165</td><td align="center" valign="middle">33</td><td align="center" valign="middle">5</td></tr><tr><td align="center" valign="middle">Diabetes</td><td align="center" valign="middle">scRNA-seq</td><td align="center" valign="middle">264,235</td><td align="center" valign="middle">52</td><td align="center" valign="middle">13</td><td align="center" valign="middle">4</td></tr><tr><td align="center" valign="middle">Follicular lymphoma</td><td align="center" valign="middle">scRNA-seq</td><td align="center" valign="middle">137,147</td><td align="center" valign="middle">23</td><td align="center" valign="middle">18</td><td align="center" valign="middle">2</td></tr><tr><td align="center" valign="middle">Kidney IgAN (Glomeruli)</td><td align="center" valign="middle">Pathomics</td><td align="center" valign="middle">24,227</td><td align="center" valign="middle">634</td><td align="center" valign="middle">14</td><td align="center" valign="middle">3</td></tr><tr><td align="center" valign="middle">Kidney IgAN (Tubule)</td><td align="center" valign="middle">Pathomics</td><td align="center" valign="middle">64,493</td><td align="center" valign="middle">634</td><td align="center" valign="middle">15</td><td align="center" valign="middle">3</td></tr><tr><td align="center" valign="middle">Kidney AC (Glomeruli)</td><td align="center" valign="middle">Pathomics</td><td align="center" valign="middle">4,731</td><td align="center" valign="middle">57</td><td align="center" valign="middle">28</td><td align="center" valign="middle">2</td></tr><tr><td align="center" valign="middle">Kidney AC (Tubule)</td><td align="center" valign="middle">Pathomics</td><td align="center" valign="middle">56,998</td><td align="center" valign="middle">57</td><td align="center" valign="middle">7</td><td align="center" valign="middle">2</td></tr></tbody></table></table-wrap></floats-group></article>