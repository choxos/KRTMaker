<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS155795</article-id><article-id pub-id-type="doi">10.1101/2022.10.12.511870</article-id><article-id pub-id-type="archive">PPR558517</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">2</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title><italic>KmerAperture</italic>: Retaining <italic>k</italic>-mer synteny for alignment-free extraction of core and accessory differences between bacterial genomes</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Moore</surname><given-names>Matthew P.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Laager</surname><given-names>Mirjam</given-names></name><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Ribeca</surname><given-names>Paolo</given-names></name><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Didelot</surname><given-names>Xavier</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib></contrib-group><aff id="A1"><label>1</label>School of Life Sciences, University of Warwick, Coventry, UK</aff><aff id="A2"><label>2</label>Department of Statistics, University of Warwick, Coventry, UK</aff><aff id="A3"><label>3</label>Division of Transplant Immunology and Nephrology, University Hospital Basel, Basel, Switzerland</aff><aff id="A4"><label>4</label>UK Health Security Agency, London, UK</aff><pub-date pub-type="nihms-submitted"><day>18</day><month>10</month><year>2022</year></pub-date><pub-date pub-type="preprint"><day>16</day><month>10</month><year>2022</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">By decomposing genome sequences into <italic>k</italic>-mers, it is possible to estimate genome differences without alignment. Techniques such as <italic>k-</italic>mer minimisers (MinHash), have been developed and are often accurate approximations of distances based on full <italic>k</italic>-mer sets. These and other alignment-free methods avoid the large temporal and computational expense of alignment or mapping. However, these <italic>k</italic>-mer set comparisons are not entirely accurate within-species and can be completely inaccurate within-lineage. This is due, in part, to their inability to distinguish core polymorphism from accessory differences. Here we present a new approach, <italic>KmerAperture</italic>, which uses information on the <italic>k</italic>-mer relative genomic positions to determine the type of polymorphism causing differences in <italic>k</italic>-mer presence and absence between pairs of genomes. Single SNPs are expected to result in contiguous series of relative unique <italic>k</italic>-mers of length <italic>L</italic>= <italic>k</italic>. On the other hand, series of length <italic>L</italic> &gt; <italic>k</italic> may be caused by accessory differences of length <italic>L</italic>-<italic>k</italic>+1; when the start and end of the sequence are contiguous with homologous sequence. Alternatively, they may be caused by multiple SNPs within <italic>k</italic> bp from each other and <italic>KmerAperture</italic> can determine whether that is the case. To demonstrate use cases <italic>KmerAperture</italic> was benchmarked using datasets including a very low diversity simulated population with accessory content independent from the number of SNPs, a simulated population were SNPs are spatially dense, a moderately diverse real cluster of genomes (<italic>Escherichia coli</italic> ST1193) with a large accessory genome and a low diversity real genome cluster (<italic>Salmonella</italic> Typhimurium ST34). We show that <italic>KmerAperture</italic> can accurately distinguish both core and accessory sequence diversity without alignment, outperforming other <italic>k</italic>-mer based tools.</p></abstract></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P2">The increasing availability of whole genome sequencing provides us with an opportunity to transform our analytical approach to bacterial population genetics and infectious disease epidemiology<sup><xref ref-type="bibr" rid="R1">1</xref>,<xref ref-type="bibr" rid="R2">2</xref></sup>. This potential for genomic epidemiology is being investigated by public health organisations, such as the United Kingdom Health Security Agency (UKHSA), where routine surveillance involves whole genome sequencing, typing and detailed comparative and phylogenetic analysis<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. However, once collected and sequenced, the comparison of thousands of bacterial genomes poses a number of important difficulties and limitations, particularly the computational time and expense required to compute alignments. For example, the exhaustive comparison of all pairs within a set of 5,000 genomes would require &gt;12×10<sup>6</sup> pairwise alignments. This is often shortcut to 5,000 alignments by aligning each genome to a single reference genome and then comparing the genomes at each reference position<sup><xref ref-type="bibr" rid="R1">1</xref>,<xref ref-type="bibr" rid="R4">4</xref></sup>. This is much more efficient than comparing all pairs of genomes, but it still involves the computation of a large number of alignments. Furthermore, it can introduce a bias depending on which reference genome is used, and also loses any information about accessory regions not found in the reference.</p><p id="P3">A number of efficient alignment-free approaches have been developed to circumvent these issues. The most efficient of these involve decomposition of genomes into <italic>k</italic>-mers (<italic>k</italic>-mers/kmers/<italic>n</italic>-grams; unique sequences of length <italic>k</italic>), subsampling into ‘sketches’ and performing set analysis<sup><xref ref-type="bibr" rid="R5">5</xref>–<xref ref-type="bibr" rid="R8">8</xref></sup>. Methods such as the min-wise independent permutations local sensitivity hashing scheme (MinHash) algorithm, accurately approximate the full-set differences across genomes and are extremely fast<sup><xref ref-type="bibr" rid="R5">5</xref></sup>. However, the accuracy in estimating relatedness decreases the more closely related the genomes are for full <italic>k</italic>-mer set and MinHash distances. Alignment-free distance estimates tend to correlate primarily with quantities of differentially present sequences rather than SNP distances. For closely related genomes, up to the point of re-sequenced isolates, this won’t by definition correlate with polymorphism<sup><xref ref-type="bibr" rid="R9">9</xref></sup>.</p><p id="P4">Highly similar genomes are those that are most relevant for outbreak detection and further analysis for public health<sup><xref ref-type="bibr" rid="R10">10</xref>–<xref ref-type="bibr" rid="R12">12</xref></sup>. For instance, MinHash-based distance measures will not accurately discern clusters at a lower diversity level than an MLST-defined lineage. Ultimately, this is due to the inability to know whether mismatching <italic>k</italic>-mers result from polymorphism or relative presence/absence of the sequence. PopPUNK is one approach that uses MinHash for within-species differences by modelling the change in mismatches across different values of <italic>k</italic> in an attempt to differentiate diversity that is core to the population and diversity that is accessory<sup><xref ref-type="bibr" rid="R13">13</xref></sup>.</p><p id="P5">Two approaches have demonstrated an ability to estimate some within-lineage SNPs<sup><xref ref-type="bibr" rid="R14">14</xref></sup>: kSNP3.0<sup><xref ref-type="bibr" rid="R15">15</xref></sup> and Split K-mer Analysis (SKA)<sup><xref ref-type="bibr" rid="R16">16</xref></sup>, with similar benchmark performance<sup><xref ref-type="bibr" rid="R14">14</xref>,<xref ref-type="bibr" rid="R16">16</xref></sup>. These approaches successfully identify what, in set analysis-based methods, would be represented by mismatched <italic>k</italic>-mers resulting from SNPs indistinguishable from those resulting from accessory sequence.</p><p id="P6">Here, we present <italic>KmerAperture</italic>, a novel alignment-free algorithm with the ability to determine bacterial genetic differences at scale. Mismatching <italic>k</italic>-mers are linked to their original synteny, taking advantage of initial efficient <italic>k</italic>-mer set analysis to generate the relative <italic>k</italic>-mer complements. Contiguous <italic>k</italic>-mer series may then be investigated as to whether they’re generated by presence/absence of sequences, SNPs or repeats. Crucially, <italic>KmerAperture</italic> is also able to gather SNPs within <italic>k</italic> of one another on the genome, usually a confounding feature of <italic>k</italic>-mer comparisons.</p></sec><sec id="S2" sec-type="results"><title>Results</title><sec id="S3"><title>An illustrative example</title><p id="P7"><xref ref-type="fig" rid="F1">Figure 1</xref> provides a toy example of the <italic>KmerAperture</italic> algorithm compared with full set Jaccard similarity estimates. The reference sequence and query are separated by a single SNP and a further 5bp sequence present only in the query. The sequences are decomposed into <italic>k</italic>-mers where <italic>k</italic> =3. When there is an isolated unshared sequence of length <italic>L</italic> we can anticipate this to produce <italic>L-k+</italic>1 unique <italic>k</italic>-mers covering the unshared sequence. In the case, as in <xref ref-type="fig" rid="F1">Figure 1</xref>, that the unshared sequence is also contiguous with shared sequence it will generate a further <italic>k-</italic>1 unique <italic>k</italic>-mers for each contiguous side. Alternatively, we anticipate a SNP to generate <italic>k</italic> unique <italic>k</italic>-mers in each set except when the SNP is within <italic>k</italic> of another SNP or sequence start or end (such as the end of a contig).</p><p id="P8">In <xref ref-type="fig" rid="F1">Figure 1</xref>, <italic>KmerAperture</italic> would correctly discern mismatched <italic>k</italic>-mers resulting from SNPs vs accessory sequence. Both set complements would result in contiguous <italic>k</italic>-mers of serial length <italic>k</italic>. As a result, the mean estimated SNPs would be calculated and it would be determined that in the comparable sequence regions there is a single SNP. <italic>KmerAperture</italic> would additionally discern, from the five contiguous <italic>k</italic>-mers unique to the query sequence, that there was an accessory difference of 5bp (since these <italic>k</italic>-mers are contiguous with shared sequence on one side, they are expected to create (<italic>L</italic>-<italic>k</italic>+1)+(<italic>k</italic>-1)=<italic>L k</italic>-mers). For SNPs within <italic>k</italic> of another on the genome (<xref ref-type="fig" rid="F1">Figure 1</xref>), they will produce series of length <italic>L</italic>&gt;<italic>k</italic>+2 up to a maximum of <italic>S</italic>(<italic>k</italic>-1)+1 where <italic>S</italic> is the number of SNPs within <italic>k</italic> of one another.</p></sec><sec id="S4"><title>Rationale for benchmarks</title><p id="P9">To demonstrate its usefulness in a number of relevant use cases, we benchmarked <italic>KmerAperture</italic> in four scenarios: a very low diversity simulated population with accessory content independent from the number of SNPs; a simulated population were SNPs are spatially dense; a moderately diverse real cluster of genomes (<italic>Escherichia coli</italic> ST1193) with a large accessory genome; and a low diversity real genome cluster (<italic>Salmonella</italic> Typhimurium ST34).</p></sec><sec id="S5"><title>Application to simulated genomes with randomly distributed SNPs</title><p id="P10">The first simulated genome set includes 500 genomes with varying degrees of accessory difference to the reference and a range of 1-100 SNPs (median 11 SNPs). <italic>KmerAperture</italic> estimated a median (range) of 11 (0-100) SNPs with <italic>k</italic>=19, 25 and 31. SKA produced the same median (range) of 11 (0-100) across all sizes of <italic>k</italic>.</p><p id="P11">The ability of <italic>KmerAperture</italic> and SKA to identify SNP counts less than or equal to various thresholds was assessed (<xref ref-type="table" rid="T1">Table 1</xref>). <italic>KmerAperture</italic> produced high positive predictive values and specificity across SNP thresholds of ≤25,20,15,10 and 5. Across all choices of <italic>k</italic> and all thresholds with <italic>KmerAperture</italic> there were no false negatives (no overprediction of SNP values above a threshold), meaning sensitivity was 100% in all cases. There was a small number of false positives with between 2 and 5 for <italic>k</italic>=19 and 1-3 for <italic>k</italic>=31. With SKA there was a similarly small number of false positives with a maximum of 4 SNPs at <italic>k</italic>=19 and a threshold of ≤15 SNPs. With SKA the specificity and PPV was equivalent or greater in all cases. However, there was a single false negative with <italic>k</italic>=19 and 25 for the ≤5 SNP threshold.</p><p id="P12">For <italic>k</italic>=19, 25 and 31, <italic>KmerAperture</italic> estimated the accessory difference for each genome compared with the reference. Relative presence was estimated for each genome in each pair. In all cases, it was correctly estimated that there was no relative additional sequence in the reference genome (0bp estimated). The relative additional query sequence ranged from a total size of 4,139bp to 1,926,407bp with a median of 736,708. This included 169 genomes with &gt;1Mbp additional sequence. <italic>KmerAperture</italic> also attempts to identify these regions and extract them. The median absolute error as a percent of bp different to the real accessory size was 0.0017%, with a maximum error of 27.9% (of 827,256bp accessory).</p></sec><sec id="S6"><title>Application to simulated genomes with variably densely distributed SNPs</title><p id="P13">In the following, we define <italic>k</italic>-<italic>clustered SNPs</italic> as chains of SNPs such that each SNP belonging to the chain, within a genome, has at least one neighbouring SNP at ≤<italic>k</italic> nucleotides of distance.</p><p id="P14">Three genome sets were simulated with 50, 100 and 150 SNPs respectively (n=750 genomes total). Each set contained 250 genomes evenly divided (n=50 genomes) into those with 20%, 40%, 60%, 80% and 100% of their SNPs being clustered within <italic>k</italic>=25 of one another. It was randomly determined how many of the SNPs would form these SNP chains, for instance 50 SNPs being 100% <italic>k</italic>-clustered could involve three <italic>k</italic>-clusters of size 10, 10 and 30 SNPs within <italic>k</italic> of on another. Detecting <italic>k</italic>-clusters is a major weakness of <italic>k</italic>-mer based methods and we expect a degree of non-retrieval in these test conditions. Performance was better for <italic>KmerAperture</italic> than for SKA in the retrieval of SNPs and <italic>k</italic>-clustered SNPs, across all densities (20%-100%) and overall SNP number (50, 100 and 150 SNPs).</p><p id="P15">The median reduction in retrieval performance with increasing <italic>k</italic>-clustering was smaller for <italic>KmerAperture</italic>. There was a relative decrease of SNPs retrieved from 20% to 100% fraction of 2.78%, 10.95% and 1.8% for 50, 100 and 150 SNPs respectively. For comparison, the relative reduction in performance with SKA between 20% and 100% of <italic>k</italic>-clustered SNPs was 48.48%, 55.97% and 53% for 50, 100 and 150 SNPs respectively. The range in performance increased for <italic>KmerAperture</italic> with increased <italic>k</italic>-clustering with minimum retrieval as low as 8/50 SNPs and 20/100 SNPs retrieved at 100% <italic>k</italic>-clustering and 48/150 SNPs retrieved at 80% <italic>k</italic>-clustering. There was a greater range in performance with <italic>KmerAperture</italic>, however and SKA had a greater minimum retrieval in two categories (50 SNPs, 100% <italic>k</italic>-clustering and 100 SNPs, 20% <italic>k</italic>-clustering). In the remaining 13/15 the greater minimum retrieval was with <italic>KmerAperture</italic>. In all categories the median and max retrieval was with <italic>KmerAperture</italic> (<xref ref-type="table" rid="T2">Table 2</xref>, <xref ref-type="fig" rid="F2">Figure 2</xref>).</p></sec><sec id="S7"><title>Application to a cluster of <italic>Escherichia coli</italic> genomes</title><p id="P16">The genomes in the <italic>E. coli</italic> dataset were the most diverse analysed with a median (range) of 82 (29-870) SNPs relative to the reference and large accessory differences. Of 749 <italic>E. coli</italic> genomes 476 were &lt;100 SNPs and 53 were &lt;50 SNPs. By querying each <italic>E. coli</italic> genome against the reference, MCJCHV-1, <italic>KmerAperture</italic> predicted a median (range) of 84 (28-980), 85 (29-960) and 86 (29-892) SNPs for <italic>k</italic>=19, 25 and 31 respectively. SKA produced SNP estimates with a median (range) of 117 (54-465), 93 (38-398) and 84 (32-349) for <italic>k</italic>=19, 25 and 31 respectively. SKA trended towards overestimation in those with ≤150 SNPs and underestimation in those above (<xref ref-type="fig" rid="F3">Figure 3</xref>; <xref ref-type="supplementary-material" rid="SD1">Figure S1</xref>). This is reflected in the SNP ranges and median estimations at <italic>k</italic>=19 and 25, with an improvement on median SNPs at <italic>k</italic>=31.</p><p id="P17">In this moderately diverse genome dataset, the SNPs extracted by <italic>KmerAperture</italic> fit the real SNP counts closely, according to the to the root-mean-squared error performance (RMSE) on log10 values. Crucially, the performance was largely independent of choice of <italic>k</italic>, with little difference across RMSE values. The RMSE with <italic>KmerAperture</italic> was 0.06 for <italic>k</italic>=19 and 0.07 for <italic>k</italic>=25 and 31. The level of under- and overprediction appeared to also be independent of real SNP count values. For comparison, SKA systematically overpredicted SNP counts when real values were ≤150 SNPs and underpredicted for &gt;150 SNPs. The RMSE values were best for SKA at <italic>k</italic>=25 (0.15) followed by 0.17 for <italic>k</italic>=19 and 31. <italic>KmerAperture</italic> is designed to accurately extract SNPs within closely related genomes but the <italic>E. coli</italic> datasets shows good performance in those up to &gt;400 SNPs (n=95 genomes). The RMSE values for those with &gt;400 SNPs were 0.06 for <italic>k</italic>=19 and 31 and 0.08 for <italic>k</italic>=25 with <italic>KmerAperture</italic>, whereas SKA ranged from 0.28 to 0.34.</p><p id="P18">The spatial density of SNPs had a median of &gt;<italic>k</italic> for each size of <italic>k</italic> with the <italic>E. coli</italic> genomes and the majority of genomes did have a single pair of SNPs &lt;<italic>k</italic> apart. At <italic>k</italic>=19, 369/748 genomes had no SNPs within <italic>k</italic>, decreasing with <italic>k</italic>=25 and 31 to 356/748 and 344/748, respectively. However, significant proportions of SNPs in some genomes were <italic>k</italic>-clustered, i.e., within <italic>k</italic> of one another. For instance, at <italic>k</italic>=19, 19% (147/748) of the genomes had ≥25% of the SNPs being <italic>k</italic>-clustered, including one genome whose SNPs were 48% 19<italic>-</italic>clustered (i.e., with 99/207 couples of SNPs having distance ≤19). As <italic>k</italic> increases in size, the number of <italic>k</italic>-clustered chains also <italic>k</italic> increases. As such, the greatest proportion was recorded at <italic>k</italic>=31, whereby 27% (201/748) of genomes had ≥25% of SNPs being <italic>k</italic>-clustered. <italic>KmerAperture</italic> performance, however, was not reduced in the genomes having the highest SNP density (<xref ref-type="fig" rid="F3">Figure 3</xref>).</p><p id="P19">The minimum reference genome bases not present in the respective query genomes based on MUMmer (unaligned sequences &gt;60bp) was 273bp and maximum 920,525bp with a median of 47,186bp. <italic>KmerAperture</italic> recovered a per query genome median (range) of 46,952bp (98bp-914,782bp) with <italic>k</italic>=19 increasing with <italic>k</italic>=25 and 31 with a median (range) 48,746bp (210bp-921,213bp). The RMSE on log10 values reported a close fit for all values of <italic>k</italic> with 0.038 and 0.025 for <italic>k</italic>=19 and 25 respectively and the closest fit at <italic>k</italic>=31 with 0.023 (<xref ref-type="supplementary-material" rid="SD2">Figure S2</xref>).</p></sec><sec id="S8"><title>Application to a cluster of <italic>Salmonella</italic> Typhimurium genomes</title><p id="P20">The <italic>Salmonella</italic> Typhimurium dataset (n=1,264 genomes) represent a low diversity dataset with many highly similar genomes relative to the reference. The real SNP counts relative to the reference were median (range) 22 (1-164), with 1,176 genomes with &lt;50 SNPs and 149 with ≤10 SNPs. <italic>KmerAperture</italic> was run for all genomes and extracted a median (range) of 21 (1-520), 21 (1-519) and 22 (1-526) SNPs for <italic>k</italic>=19, 25 and 31 respectively. Median (range) SNP counts with SKA at <italic>k</italic>=31 were similar to <italic>KmerAperture</italic> and the true figures, with 25 (2-136) SNPs. On the other hand, the results produced by SKA for <italic>k</italic>=19 and 25 were less accurate based on their summary statistics with median (range) 58 (19-195) and 35 (9-160) respectively</p><p id="P21">The SNP counts determined by <italic>KmerAperture</italic> fit the real SNP counts closely. There was similar performance with RMSE on log10 values of 0.07 for <italic>k</italic>=19 and 0.08 for <italic>k</italic>=25 and 31. For <italic>k</italic>=31 SKA and real SNP counts RMSE was similar to <italic>KmerAperture</italic> with 0.09. It was sensitive of choice of <italic>k</italic> however, producing an RMSE of 0.27 for <italic>k</italic>=25 and 0.48 for <italic>k</italic>=19. SKA produced a consistent level of SNP count overprediction along the range of SNP diversity. SKA performance was best at <italic>k</italic>=31, with overprediction minimised and a small amount of underprediction of the highest values (<xref ref-type="fig" rid="F4">Figure 4</xref>).</p><p id="P22">A flexible core genome alignment was derived from the snippy, SKA and <italic>KmerAperture</italic> whole genome reference-anchored alignments and the pairwise SNP counts extracted. There were 798,216 exclusive pairs with a median (range) of 34 (0-822) pairwise cgSNPs. Graphs were constructed with edges between genomes (nodes) if they met a SNP threshold of ≤2, ≤5 or ≤10 SNPs. <italic>KmerAperture</italic> generated graphs with 646, 941 and 1187 nodes for ≤2, &lt;5, ≤10 respectively. These were comprised of single linkage clusters (connected components). At ≤2 SNPs, <italic>KmerAperture</italic> generated 145 connected components, 72 of which contained at least 3 genomes, compared with 152 real SNP clusters at ≤2 SNPs including 76 with at least 3 genomes. There was similar recovery of clusters for ≤5 and ≤10 SNPs with 82 and 34 clusters with &gt;2 genomes with <italic>KmerAperture</italic> respectively compared with 80 and 37 real SNP clusters. SKA reconstructed fewer SNP clusters (&gt;2 genomes) with 38 at ≤2SNPs, 65 at ≤5 SNPs and a greater number than with real SNPs with 65 at ≤10 SNPs.</p><p id="P23">It was determined by MUMmer that query genomes did not align to a median (range) of 45,020bp (6,917bp-216,154bp) of the reference genome. The median estimate for <italic>KmerAperture</italic> ranged from 43,480bp to 46,925bp for <italic>k</italic>=19 and 31 respectively (<xref ref-type="fig" rid="F5">Figure 5</xref>). The RMSE of the log10 values fit best with <italic>k</italic>=25 with 0.018 and fit closely for <italic>k</italic>=19 and 31 with 0.021 and 0.025 respectively. This represents recovery of the majority of invariant sites between query genomes and the reference. Additionally, as with SNP counts recovered by <italic>KmerAperture</italic> recovery of <italic>aligned</italic> reference sites is independent of <italic>k</italic> choice with the <italic>S</italic>. Typhimurium dataset.</p></sec><sec id="S9"><title><italic>KmerAperture</italic> runtime</title><p id="P24">The runtimes for <italic>KmerAperture</italic> and SKA were recorded as the mean per-genome runtime by dividing the overall runtime by the number of genomes. In all cases there was a slight increase in runtime with increase in size of <italic>k</italic>. Mean per genome runtime with the real genome dataseets was faster with <italic>KmerAperture</italic>. With <italic>KmerAperture</italic> runtime averaged between 10.41 and 13.87 seconds for the <italic>Salmonella</italic> Typhimurium genomes and between 13.57 and 14.82 for the <italic>E. coli</italic> genomes for <italic>k</italic>=19 to <italic>k</italic>=31 respectively. Whereas SKA averaged between 22.8 and 23.8 seconds for the <italic>Salmonella</italic> Typhimurium genomes and between 24.1 and 26.4 for the <italic>E. coli</italic> genomes for <italic>k</italic>=19 to <italic>k</italic>=31. Further with <italic>KmerAperture</italic>, query genomes may be analysed concurrently across multiple processors, making the time to extract an alignment from 1,256 <italic>Salmonella</italic> Typhimurium genomes (<italic>k</italic>=19) 21 minutes with 10 processors, or ∼1 second per genome.</p></sec></sec><sec id="S10" sec-type="discussion"><title>Discussion</title><p id="P25">The <italic>KmerAperture</italic> algorithm is based on the few axioms we have of how relative sequence differences are represented by comparing <italic>k</italic>-mers. In sequences of the same length, with &gt;<italic>k</italic> spaced SNP positions and no other variation, the number of unique <italic>k</italic>-mers / <italic>k</italic> will represent the number of variant positions. In reality, bacterial genomes have large unaligned regions, <italic>k</italic>-clustered SNPs, indels, structural rearrangements and other complexities. We demonstrated with simulated and real datasets that by retaining <italic>k</italic>-mer synteny we can accurately recover SNPs, including many of those that are <italic>k</italic>-clustered. Initially the algorithm filters mismatched <italic>k</italic>-mers by their original order, nominating contiguous series of length <italic>k</italic> as being generated by a single SNP difference between the genomes. This is followed, by matching the middle <italic>k</italic>-mers without the middle base. When several SNPs’ positions occur ≤<italic>k</italic> bp from each other, series of length &gt;<italic>k</italic> are generated. By pattern matching between same length series, we explicitly consider this possibility. The persistent problem in <italic>k</italic>-mer based alignment-free analyses is here resolved. Essentially, <italic>KmerAperture</italic> foregoes alignment as matching flanking regions to <italic>k</italic>-mer series are implicit in their presence in the <italic>k</italic>-mer set intersection, which can be rapidly determined. With <italic>KmerAperture</italic>, the entire relative diversity of genomes is encoded in the syntenic <italic>k</italic>-mer series. Methods may be improved further to types of diversity such as indels and sequence rearrangements.</p><p id="P26">Since <italic>KmerAperture</italic> determines the position of each SNP, it can be used to generate a reference-anchored alignment containing all the SNPs found in a set of genomes of interest. Unlike a simple SNP matrix with no notion of SNP locations, this <italic>KmerAperture</italic> output can be to used to perform a recombination-aware phylogenetic inference, for example using ClonalFrameML<sup><xref ref-type="bibr" rid="R17">17</xref></sup> or Gubbins<sup><xref ref-type="bibr" rid="R18">18</xref></sup>. In this context, it is especially important that <italic>KmerAperture</italic> attempts to reconstruct SNPs within <italic>k</italic> bp of each other, since bacterial homologous recombination, especially when the donor and recipient are distantly related, has a high potential to generate such clusters of SNPs<sup><xref ref-type="bibr" rid="R19">19</xref></sup>.</p><p id="P27">Unlike other tools that are focused on SNP detection, <italic>KmerAperture</italic> is also able to identify accessory regions, and may therefore be developed for pan-genome analyses<sup><xref ref-type="bibr" rid="R20">20</xref></sup>. It would also be possible to extract accessory sequence positions, prior to alignment. The computational and temporal challenge of alignment is related both to the number of sequence comparisons but also the diversity of the sequences under study. Reducing this diversity, especially in genome samples of unknown diversity, would reduce the cost of alignment. <italic>KmerAperture</italic> could also be adapted to progressively remove accessory regions as genomes are added, compare the genomes to a core genome alignment, or to a reference.</p><p id="P28">In the examples tested <italic>KmerAperture</italic> works as well in situations where genomes differ by &lt;50 SNPs as those with &gt;400. It could now be examined whether clustering on these SNPs, or construction of a phylogenetic tree from the alignment may be used as a scalable alternative to sub-MLST lineage discrimination. For instance, clustering the <italic>S</italic>. Typhimurium genomes by SNP thresholds suggest that this may be a viable tool to test on numerous species, to provide results comparable to alignment. This is crucial because whilst existing tools may be accurate once very similar genomes have been identified, this is the first alignment-free methodology able to discern clusters of very similar genomes.</p><p id="P29">The datasets were chosen to reflect real-life scenarios of the type of diversity according to which we might cluster genomes, either by genomic typing or by methods, such as MinHash, not involving alignment. Divergent genomes can be identified and removed, retaining only the low-diversity genomes to be analysed further, possibly using alignment-based comparison. In a scenario where there is a survey of bacterial genomes, for instance in a clinical setting, it is important to rapidly differentiate species, lineage, sub-lineage and possible outbreak clusters based on genetic distance. The size and diversity of these datasets can render alignment-based methods difficult and possibly intractable unless an excess amount of computational resources is used. <italic>KmerAperture</italic> runs in a few seconds on a laptop, and genomes may be compared concurrently, making it a scalable approach for genomic surveillance.</p></sec><sec id="S11" sec-type="methods"><title>Methods</title><sec id="S12"><title>Using synteny to distinguish core and accessory variation</title><p id="P30">The data for analysis consists of a single reference genome and several query genomes, all of which have been assembled <italic>de novo</italic> and may therefore be made of multiple contigs<sup><xref ref-type="bibr" rid="R21">21</xref></sup>. Both reference and query genomes are decomposed into <italic>k</italic>-mers and canonicalised, which involves reverse complementing each <italic>k</italic>-mer, comparing to the original and selecting the lesser <italic>k</italic>-mer. The <italic>k</italic>-mer window size (<italic>k</italic>) is defaulted to 19, whilst various other <italic>k</italic> sizes were also explored.</p><p id="P31">For each query genome the full set of <italic>k</italic>-mers is constructed for the query and reference (sets <italic>R</italic> and <italic>Q</italic> respectively). Next the relative complement of each set (<italic>R</italic><sup><italic>c</italic></sup> and <italic>Q</italic><sup><italic>c</italic></sup>) are determined by subtracting the sets from one another. The original lists of <italic>k</italic>-mers (which unlike the sets are not deduplicated) were enumerated. The <italic>k</italic>-mers of the relative complements were then matched back to their respective <italic>k</italic>-mer lists to derive their synteny. Each matched <italic>k</italic>-mer position is then stored and sorted as ranges or <italic>k</italic>-mer ‘series’. The length of these series is then used to evaluate the underlying comparative diversity that has generated these mismatching <italic>k</italic>-mers.</p><p id="P32">Series of <italic>k</italic>-mers that equal <italic>k</italic> in length (<italic>L</italic>) are provisionally taken to be the result of a SNP, whilst those greater than <italic>k</italic> in length are stored as accessory/other. It was enforced that <italic>k</italic> must be an odd number so that the middle <italic>k</italic>-mer may be extracted from all series of length <italic>k</italic>, the middle base removed and then the number of <italic>k</italic>-mers that would match without the middle base counted.</p><p id="P33">Whether there are SNPs within <italic>k</italic> of one another is evaluated next, including accounting for the possibility of chaining of multiple SNPs within <italic>k</italic>. Series of length <italic>L</italic> ranging from <italic>k</italic>+2 to <italic>S</italic>(<italic>k</italic>-1)+1 have their original sequences reconstructed, where <italic>S</italic> is the maximum number of ‘chained’ SNPs (defaulted to 10). Unlike with single SNPs there isn’t an explicit relationship expected between <italic>L</italic> and number of polymorphisms. Instead, all possible pairs of the same <italic>L</italic> are compared including the respective reverse complement pairings, mismatching bases counted and a filter of ≤25% divergence applied. All mismatches must not be contiguous in the sequence, with spacing of at least 1bp required.</p></sec><sec id="S13"><title>Implementation and benchmarking of <italic>KmerAperture</italic>
</title><p id="P34">
<italic>KmerAperture</italic> is written in python 3 and depends on the python packages numpy<sup><xref ref-type="bibr" rid="R22">22</xref></sup>, biopython<sup><xref ref-type="bibr" rid="R23">23</xref></sup> and the screed module of the khmer package<sup><xref ref-type="bibr" rid="R24">24</xref></sup>. An OCaml, compiled, parser processes input genomes in a computationally efficient manner, decomposing them into <italic>k</italic>-mers and canonicalising them. Visualisations were generated in python with the use of seaborn<sup><xref ref-type="bibr" rid="R25">25</xref></sup> and matplotlib<sup><xref ref-type="bibr" rid="R26">26</xref></sup> in the Jupyter Notebook environment<sup><xref ref-type="bibr" rid="R27">27</xref></sup>. Conda was used for package management<sup><xref ref-type="bibr" rid="R28">28</xref></sup>. <italic>KmerAperture</italic> was compared with SKA <italic>map</italic> SNP estimations. <italic>KmerAperture</italic> was run on assembled genomes across a range of values of <italic>k</italic> (<italic>k</italic>=19, 25 and 31), where <italic>k</italic> must be an odd number. SKA requires that the <italic>k</italic> value be generated by an integer divisible by 3, that represents the length of each sequence flanking a flexible base. As such, a range of flanking lengths was selected of 9, 12, and 15 to generate the same <italic>k</italic>=19, 25, and 31 as in <italic>KmerAperture</italic>. Real genome SNP counts were derived from the tool snippy<sup><xref ref-type="bibr" rid="R29">29</xref></sup>, whilst unshared sequences were determined by MUMmer dnadiff<sup><xref ref-type="bibr" rid="R30">30</xref></sup>.</p></sec><sec id="S14"><title>Data acquisition and processing</title><p id="P35">The reference genome <italic>Klebsiella pneumoniae</italic> HS11286 (NC_016845)<sup><xref ref-type="bibr" rid="R31">31</xref></sup> was downloaded and used as the template for each simulated genome. Two sets of simulated genomes were constructed: in the first set genomes relative to the reference have additional sequence and SNPs and in the second set all genomes are the same size as the reference with SNPs only.</p><p id="P36">For the first set, 500 genomes were simulated with between 1-100 SNPs and 1-30 accessory sequences of 1,000-10,000bp. The number of accessory sequences, the location where they were inserted and the genome positions to mutate, were all uniformly sampled at random whilst the number of SNPs were sampled from a log10 distribution. There was no relationship simulated between amount of accessory sequence and number of SNPs. All genomes were randomly assigned between 1,000 and 300,000bp of accessory sequence.</p><p id="P37">For the second set, genomes were simulated with SNPs relative to the reference only. Five subsets, each with 100 genomes were constructed. All genomes had 50 SNPs relative to the reference. The five subsets were constructed to contain 20%, 40%, 60%, 80% and 100% of the SNPs (n=10,20,30,40,50 SNPs respectively) to be within <italic>k</italic> of at least one other SNP. For each genome it was randomly determined how many SNPs, up to 10, would be within <italic>k</italic> and how large the spacing between each SNP was, up to <italic>k</italic>. The size of <italic>k</italic> was fixed to 25.</p><p id="P38">Real genome datasets were also used to assess <italic>KmerAperture</italic> performance, a low diversity and medium diversity within-lineage population. The first was a medium diversity cluster of genomes, subset of the pandemic <italic>Escherichia coli</italic>, MLST-defined cluster ST1193. The ST1193 population records were further subset to the HierCC<sup><xref ref-type="bibr" rid="R32">32</xref></sup> HC20-level cluster 571 (n=1,331), where they were filtered for those with NCBI ‘biosample’ identifiers (n=1,233), whereby 757 assemblies were successfully downloaded. Finally, 8 genomes were removed for being too diverse (&gt;1,000 SNPs including 6 at &gt;30,000) resulting in 749 for analysis. Within cluster HC20 level cluster 571, reference genome <italic>E. coli</italic> MCJCHV-1 sequence (chromosomal: CP030111.1), was selected for mapping and variant calling. EnteroBase<sup><xref ref-type="bibr" rid="R33">33</xref></sup> was accessed and searched for these criteria on 22/02/2023.</p><p id="P39">The second cluster of real genomes was a subset of the <italic>Salmonella enterica</italic> subsp. <italic>enterica</italic> Serovar Typhimurium (<italic>Salmonella</italic> Typhimurium) MLST defined cluster 34 (ST34). The ST34 population records were further subset to the HierCC<sup><xref ref-type="bibr" rid="R32">32</xref></sup> HC5-level cluster 302 (HC302, n=2,399). Within cluster HC302 cluster, the completely assembled genome <italic>S</italic>. Typhimurium S04698-09, was selected as the reference. EnteroBase<sup><xref ref-type="bibr" rid="R33">33</xref></sup> was accessed and searched for these criteria on 22/02/2023. All genomes with NCBI biosamples were selected for download (n=1,768), of which 1,283 successfully downloaded. A further, 3 genomes were excluded due to being too diverse (&gt;300 SNPs) whilst 16 were removed for containing non-{ATCGN} bases. Finally, 8 genomes were removed for reporting an MLST other than ST34, resulting in the final set of 1,256 genomes.</p><p id="P40">All genomes were downloaded from the NCBI genomes database (<xref ref-type="supplementary-material" rid="SD3">Supplementary Table 1</xref>).</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>SI1</label><caption><p id="P41">Results on <italic>E. coli</italic> ST1193 SNP distances. Scatterplot of <italic>KmerAperture</italic> and SKA SNP estimates vs real SNPs, for <italic>k</italic>=19, 25 and 31.</p></caption><media xlink:href="EMS155795-supplement-SI1.pdf" mimetype="application" mime-subtype="pdf" id="d31aAdEbC" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD2"><label>SI2</label><caption><p id="P42">Results on <italic>E. coli</italic> ST1193 number of reference sites not present in query genomes determined by KmerAperture compared with unaligned reference bases with MUMmer, at <italic>k</italic>=19, 25 and 31.</p></caption><media xlink:href="EMS155795-supplement-SI2.pdf" mimetype="application" mime-subtype="pdf" id="d31aAdEcC" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD3"><label>Supplementary table 1</label><media xlink:href="EMS155795-supplement-Supplementary_table_1.csv" mimetype="text" mime-subtype="csv; charset=utf-8" id="d31aAdEdB" position="anchor"/></supplementary-material></sec></body><back><ack id="S15"><title>Acknowledgements</title><p>This study is funded by the National Institute for Health and Care Research (NIHR) Health Protection Research Unit in Gastrointestinal Infections, a partnership between the UK Health Security Agency, the University of Liverpool and the University of Warwick. The views expressed are those of the author(s) and not necessarily those of the NIHR, the UK Health Security Agency or the Department of Health and Social Care.</p></ack><sec id="S16" sec-type="data-availability"><title>Data Availability</title><p id="P43">All genome data is publicly available and acquired from the National Centre for Biotechnology Information (NCBI) databases. All accession IDs are provided in supplementary information. Open-source code is available from: <ext-link ext-link-type="uri" xlink:href="https://github.com/moorembioinfo/KmerAperture">https://github.com/moorembioinfo/KmerAperture</ext-link>
</p></sec><fn-group><fn id="FN1" fn-type="conflict"><p id="P44"><bold>Competing Interests</bold></p><p id="P45">The authors declare that they have no competing interests.</p></fn><fn fn-type="con" id="FN2"><p id="P46"><bold>Author Contributions</bold></p><p id="P47">All authors contributed to this research and resulting manuscript. Their contributions are listed here in accordance with the Contributor Roles Taxonomy (CRediT). <bold><italic>Matthew P. Moore:</italic></bold> conceptualisation, methodology, software, validation, formal analysis, data curation, writing - original draft, visualisation. <bold><italic>Mirjam Laager:</italic></bold> conceptualisation, methodology. <bold><italic>Paolo Ribeca:</italic></bold> methodology, writing - review and editing, supervision. <bold><italic>Xavier Didelot:</italic></bold> conceptualisation, methodology, writing - review and editing, resources, supervision, project administration, funding acquisition.</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Didelot</surname><given-names>X</given-names></name><name><surname>Parkhill</surname><given-names>J</given-names></name></person-group><article-title>A scalable analytical approach from bacterial genomes to epidemiology</article-title><source>Philos Trans R Soc B Biol Sci</source><year>2022</year><volume>377</volume><elocation-id>20210246</elocation-id><pub-id pub-id-type="pmcid">PMC9393561</pub-id><pub-id pub-id-type="pmid">35989600</pub-id><pub-id pub-id-type="doi">10.1098/rstb.2021.0246</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Didelot</surname><given-names>X</given-names></name><name><surname>Bowden</surname><given-names>R</given-names></name><name><surname>Wilson</surname><given-names>DJ</given-names></name><name><surname>Peto</surname><given-names>TEA</given-names></name><name><surname>Crook</surname><given-names>DW</given-names></name></person-group><article-title>Transforming clinical microbiology with bacterial genome sequencing</article-title><source>Nat Rev Genet</source><year>2012</year><volume>13</volume><fpage>601</fpage><lpage>612</lpage><pub-id pub-id-type="pmcid">PMC5049685</pub-id><pub-id pub-id-type="pmid">22868263</pub-id><pub-id pub-id-type="doi">10.1038/nrg3226</pub-id></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dallman</surname><given-names>T</given-names></name><etal/></person-group><article-title>SnapperDB: a database solution for routine sequencing analysis of bacterial isolates</article-title><source>Bioinformatics</source><year>2018</year><pub-id pub-id-type="pmid">29659710</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname><given-names>Z</given-names></name><etal/></person-group><article-title>Neutral Genomic Microevolution of a Recently Emerged Pathogen, Salmonella enterica Serovar Agona</article-title><source>PLoS Genet</source><year>2013</year><pub-id pub-id-type="pmcid">PMC3630104</pub-id><pub-id pub-id-type="pmid">23637636</pub-id><pub-id pub-id-type="doi">10.1371/journal.pgen.1003471</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ondov</surname><given-names>BD</given-names></name><etal/></person-group><article-title>Mash: fast genome and metagenome distance estimation using MinHash</article-title><source>Genome Biol</source><year>2016</year><pub-id pub-id-type="pmcid">PMC4915045</pub-id><pub-id pub-id-type="pmid">27323842</pub-id><pub-id pub-id-type="doi">10.1186/s13059-016-0997-x</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Titus Brown</surname><given-names>C</given-names></name><name><surname>Irber</surname><given-names>L</given-names></name></person-group><article-title>sourmash: a library for MinHash sketching of DNA</article-title><source>J Open Source Softw</source><year>2016</year><pub-id pub-id-type="doi">10.21105/joss.00027</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhao</surname><given-names>X</given-names></name></person-group><article-title>BinDash, software for fast genome distance estimation on a typical personal laptop</article-title><source>Bioinformatics</source><year>2019</year><pub-id pub-id-type="pmid">30052763</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baker</surname><given-names>DN</given-names></name><name><surname>Langmead</surname><given-names>B</given-names></name></person-group><article-title>Dashing: Fast and Accurate Genomic Distances with HyperLogLog</article-title><source>bioRxiv</source><year>2019</year><pub-id pub-id-type="pmcid">PMC6892282</pub-id><pub-id pub-id-type="pmid">31801633</pub-id><pub-id pub-id-type="doi">10.1186/s13059-019-1875-0</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moore</surname><given-names>MP</given-names></name><name><surname>Wilcox</surname><given-names>MH</given-names></name><name><surname>Walker</surname><given-names>AS</given-names></name><name><surname>Eyre</surname><given-names>DW</given-names></name></person-group><article-title>K-mer based prediction of <italic>Clostridioides difficile</italic> relatedness and ribotypes</article-title><source>bioRxiv</source><year>2021</year><elocation-id>2021.05.17.444522</elocation-id><pub-id pub-id-type="pmcid">PMC9453075</pub-id><pub-id pub-id-type="pmid">35384833</pub-id><pub-id pub-id-type="doi">10.1099/mgen.0.000804</pub-id></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harris</surname><given-names>SR</given-names></name><etal/></person-group><article-title>Whole-genome sequencing for analysis of an outbreak of meticillin-resistant Staphylococcus aureus: A descriptive study</article-title><source>Lancet Infect Dis</source><year>2013</year><pub-id pub-id-type="pmcid">PMC3556525</pub-id><pub-id pub-id-type="pmid">23158674</pub-id><pub-id pub-id-type="doi">10.1016/S1473-3099(12)70268-2</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sherry</surname><given-names>NL</given-names></name><etal/></person-group><article-title>Genomics for molecular epidemiology and detecting transmission of carbapenemase-producing enterobacterales in Victoria, Australia, 2012 to 2016</article-title><source>J Clin Microbiol</source><year>2019</year><pub-id pub-id-type="pmcid">PMC6711911</pub-id><pub-id pub-id-type="pmid">31315956</pub-id><pub-id pub-id-type="doi">10.1128/JCM.00573-19</pub-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Didelot</surname><given-names>X</given-names></name><etal/></person-group><article-title>Microevolutionary analysis of Clostridium difficile genomes to investigate transmission</article-title><source>Genome Biol</source><year>2012</year><pub-id pub-id-type="pmcid">PMC4056369</pub-id><pub-id pub-id-type="pmid">23259504</pub-id><pub-id pub-id-type="doi">10.1186/gb-2012-13-12-r118</pub-id></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lees</surname><given-names>JA</given-names></name><etal/></person-group><article-title>Fast and flexible bacterial genomic epidemiology with PopPUNK</article-title><source>Genome Res</source><year>2019</year><pub-id pub-id-type="pmcid">PMC6360808</pub-id><pub-id pub-id-type="pmid">30679308</pub-id><pub-id pub-id-type="doi">10.1101/gr.241455.118</pub-id></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van der Putten</surname><given-names>BCL</given-names></name><name><surname>Huijsmans</surname><given-names>NAH</given-names></name><name><surname>Mende</surname><given-names>DR</given-names></name><name><surname>Schultsz</surname><given-names>C</given-names></name></person-group><article-title>Benchmarking the topological accuracy of bacterial phylogenomic workflows using in silico evolution</article-title><source>Microb Genomics</source><year>2022</year><pub-id pub-id-type="pmcid">PMC9176278</pub-id><pub-id pub-id-type="pmid">35290758</pub-id><pub-id pub-id-type="doi">10.1099/mgen.0.000799</pub-id></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gardner</surname><given-names>SN</given-names></name><name><surname>Slezak</surname><given-names>T</given-names></name><name><surname>Hall</surname><given-names>BG</given-names></name></person-group><article-title>kSNP3.0: SNP detection and phylogenetic analysis of genomes without genome alignment or reference genome</article-title><source>Bioinformatics</source><year>2015</year><pub-id pub-id-type="pmid">25913206</pub-id></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harris</surname><given-names>SR</given-names></name></person-group><article-title>SKA: Split Kmer Analysis Toolkit for Bacterial Genomic Epidemiology</article-title><source>BioRxiv</source><year>2018</year><pub-id pub-id-type="doi">10.1101/453142</pub-id></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Didelot</surname><given-names>X</given-names></name><name><surname>Wilson</surname><given-names>DJ</given-names></name></person-group><article-title>ClonalFrameML: Efficient Inference of Recombination in Whole Bacterial Genomes</article-title><source>PLoS Comput Biol</source><year>2015</year><pub-id pub-id-type="pmcid">PMC4326465</pub-id><pub-id pub-id-type="pmid">25675341</pub-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1004041</pub-id></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Croucher</surname><given-names>NJ</given-names></name><etal/></person-group><article-title>Rapid phylogenetic analysis of large samples of recombinant bacterial whole genome sequences using Gubbins</article-title><source>Nucleic Acids Res</source><year>2015</year><volume>43</volume><fpage>e15</fpage><pub-id pub-id-type="pmcid">PMC4330336</pub-id><pub-id pub-id-type="pmid">25414349</pub-id><pub-id pub-id-type="doi">10.1093/nar/gku1196</pub-id></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Didelot</surname><given-names>X</given-names></name><name><surname>Maiden</surname><given-names>MCJ</given-names></name></person-group><article-title>Impact of recombination on bacterial evolution</article-title><source>Trends in Microbiology</source><year>2010</year><pub-id pub-id-type="pmcid">PMC3985120</pub-id><pub-id pub-id-type="pmid">20452218</pub-id><pub-id pub-id-type="doi">10.1016/j.tim.2010.04.002</pub-id></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vernikos</surname><given-names>G</given-names></name><name><surname>Medini</surname><given-names>D</given-names></name><name><surname>Riley</surname><given-names>DR</given-names></name><name><surname>Tettelin</surname><given-names>H</given-names></name></person-group><article-title>Ten years of pan-genome analyses</article-title><source>Current Opinion in Microbiology</source><year>2015</year><pub-id pub-id-type="pmid">25483351</pub-id></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nagarajan</surname><given-names>N</given-names></name><name><surname>Pop</surname><given-names>M</given-names></name></person-group><article-title>Sequence assembly demystified</article-title><source>Nature Reviews Genetics</source><year>2013</year><pub-id pub-id-type="pmid">23358380</pub-id></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="book"><collab>NumPy</collab><source>NumPy</source><publisher-name>NumPy Website</publisher-name><year>2017</year><comment>© Copyright 2017 NumPy developers</comment></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cock</surname><given-names>PJA</given-names></name><etal/></person-group><article-title>Biopython: freely available Python tools for computational molecular biology and bioinformatics</article-title><source>Bioinformatics</source><year>2009</year><volume>25</volume><fpage>1422</fpage><lpage>1423</lpage><pub-id pub-id-type="pmcid">PMC2682512</pub-id><pub-id pub-id-type="pmid">19304878</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btp163</pub-id></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Crusoe</surname><given-names>MR</given-names></name><etal/></person-group><article-title>The khmer software package: enabling efficient nucleotide sequence analysis</article-title><source>F1000Research</source><year>2015</year><pub-id pub-id-type="pmcid">PMC4608353</pub-id><pub-id pub-id-type="pmid">26535114</pub-id><pub-id pub-id-type="doi">10.12688/f1000research.6924.1</pub-id></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Waskom</surname><given-names>M</given-names></name></person-group><article-title>seaborn: statistical data visualization</article-title><source>J Open Source Softw</source><year>2021</year><pub-id pub-id-type="doi">10.21105/joss.03021</pub-id></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hunter</surname><given-names>JD</given-names></name></person-group><article-title>Matplotlib: A 2D graphics environment</article-title><source>Comput Sci Eng</source><year>2007</year><pub-id pub-id-type="doi">10.1109/MCSE.2007.55</pub-id></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Kluyver</surname><given-names>T</given-names></name><etal/></person-group><source>Jupyter Notebooks—a publishing format for reproducible computational workflows Positioning and Power in Academic Publishing: Players, Agents and Agendas</source><year>2016</year><pub-id pub-id-type="doi">10.3233/978-1-61499-649-1-87</pub-id></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="other"><collab>Anaconda Software Distribution</collab><source>Anaconda Documentation</source><year>2020</year></element-citation></ref><ref id="R29"><label>29</label><element-citation publication-type="web"><person-group person-group-type="author"><name><surname>Seeman</surname><given-names>T</given-names></name></person-group><source>Snippy-20</source><comment>Available at: <ext-link ext-link-type="uri" xlink:href="http://www.vicbioinformatics.com/software.snippy.shtml">http://www.vicbioinformatics.com/software.snippy.shtml</ext-link></comment></element-citation></ref><ref id="R30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Delcher</surname><given-names>AL</given-names></name><name><surname>Phillippy</surname><given-names>A</given-names></name><name><surname>Carlton</surname><given-names>J</given-names></name><name><surname>Salzberg</surname><given-names>SL</given-names></name></person-group><article-title>MUMmer: comparative applications\nFast algorithms for large-scale genome alignment and comparison</article-title><source>Nucleic Acids Res</source><year>2002</year><volume>30</volume><fpage>2478</fpage><lpage>83</lpage><pub-id pub-id-type="pmcid">PMC117189</pub-id><pub-id pub-id-type="pmid">12034836</pub-id><pub-id pub-id-type="doi">10.1093/nar/30.11.2478</pub-id></element-citation></ref><ref id="R31"><label>31</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>P</given-names></name><etal/></person-group><article-title>Complete genome sequence of Klebsiella pneumoniae subsp. pneumoniae HS11286, a multidrug-resistant strain isolated from human sputum</article-title><source>Journal of Bacteriology</source><year>2012</year><pub-id pub-id-type="pmcid">PMC3302456</pub-id><pub-id pub-id-type="pmid">22408243</pub-id><pub-id pub-id-type="doi">10.1128/JB.00043-12</pub-id></element-citation></ref><ref id="R32"><label>32</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname><given-names>Z</given-names></name><name><surname>Charlesworth</surname><given-names>J</given-names></name><name><surname>Achtman</surname><given-names>M</given-names></name></person-group><article-title>HierCC: a multi-level clustering scheme for population assignments based on core genome MLST</article-title><source>Bioinformatics</source><year>2021</year><volume>37</volume><fpage>3645</fpage><lpage>3646</lpage><pub-id pub-id-type="pmcid">PMC8545296</pub-id><pub-id pub-id-type="pmid">33823553</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btab234</pub-id></element-citation></ref><ref id="R33"><label>33</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname><given-names>Z</given-names></name><name><surname>Alikhan</surname><given-names>NF</given-names></name><name><surname>Mohamed</surname><given-names>K</given-names></name><name><surname>Fan</surname><given-names>Y</given-names></name><name><surname>Achtman</surname><given-names>M</given-names></name></person-group><article-title>The EnteroBase user’s guide, with case studies on Salmonella transmissions, Yersinia pestis phylogeny, and Escherichia core genomic diversity</article-title><source>Genome Res</source><year>2020</year><pub-id pub-id-type="pmcid">PMC6961584</pub-id><pub-id pub-id-type="pmid">31809257</pub-id><pub-id pub-id-type="doi">10.1101/gr.251678.119</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><p>(Upper) Blue shading highlights unique <italic>k</italic>-mers generated as the result of a SNP and green shading indicates unique <italic>k</italic>-mers as the result of an accessory sequence. In the Jaccard similarity these types of mismatches are not differentiated. <italic>KmerAperture</italic> starts by considering the genomic position of the elements unique to <italic>R and Q</italic> respectively. As the blue shaded <italic>k</italic>-mer series equals <italic>k</italic> in length, this would be assessed as to whether the series is comprised of overlapping <italic>k</italic>-mers. Then, the middle <italic>k</italic>-mer with the middle base removed matched between reference and query <italic>k</italic>-mer series that equal <italic>k</italic> in length. In contrast, the green shading demonstrates how <italic>k</italic>-mer series of &gt;<italic>k</italic> may be generated by accessory sequences. (Lower) This example shows with orange shading 3 SNPs where the positions are within <italic>k. KmerAperture</italic> would correctly identify these as all possible pairs of all series of the same length between length <italic>k</italic> and 100<italic>k</italic> would be reconstructed into their original sequence and mismatches counted. This example, which is illustrative, would not however pass the sequence diversity filter of &lt;25%</p></caption><graphic xlink:href="EMS155795-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><p>Boxplots (left) showing the distribution and median SNPs recovered by SKA and <italic>KmerAperture</italic>. Upper to lower are datasets with 50, 100 and 150 SNPs respectively. Each boxplot contains the values for 250 genomes, each with the respective number of SNPs but varying from 20% to 100% of SNPs that are within <italic>k</italic>=25 of one another. Histograms (right) show the distribution of SNPs recovered across all percent SNP <italic>k</italic>-clustering fractions</p></caption><graphic xlink:href="EMS155795-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><p>(Upper) scatterplots of <italic>KmerAperture</italic> (upper left) and SKA (upper right) SNPs at <italic>k</italic>=31 vs snippy SNPs. Data points are coloured by the fraction of SNPs that are <italic>k</italic>-clustered. Lower, a histogram of the number of genomes with that fraction of SNPs that are <italic>k</italic>-clustered with <italic>k</italic>=31</p></caption><graphic xlink:href="EMS155795-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><p>Results on <italic>Salmonella</italic> Typhimurium SNP counts. Scatterplot of <italic>KmerAperture</italic> and SKA SNP estimates vs real SNPs, for <italic>k</italic>=19, 25 and 31</p></caption><graphic xlink:href="EMS155795-f004"/></fig><fig id="F5" position="float"><label>Figure 5</label><caption><p>Results on <italic>Salmonella</italic> Typhimurium number of reference sites not present in query genomes determined by <italic>KmerAperture</italic> compared with unaligned reference bases with MUMmer, at <italic>k</italic>=19, 25 and 31</p></caption><graphic xlink:href="EMS155795-f005"/></fig><table-wrap id="T1" orientation="portrait" position="float"><label>Table 1</label><caption><p>Performance of <italic>KmerAperture</italic> and SKA for identifying SNP distances below a threshold. True positives (<italic>TP</italic>) are those correctly found to be below the SNP thresholds (25, 20, 15, 10, 5), false positives (<italic>FP</italic>) those incorrectly found to be below the threshold, and true negatives (<italic>TN</italic>) those correctly found to be above the threshold. Performance was measured on specificity <italic>TN</italic>/(<italic>TN</italic>+<italic>FP</italic>) and positive predictive value (PPV) <italic>TP</italic>/(<italic>TP</italic>+<italic>FP</italic>)</p></caption><table frame="box" rules="all"><thead><tr><th valign="middle" align="center" rowspan="2">Algorithm</th><th valign="middle" align="center" rowspan="2"><italic>k</italic>-mer size</th><th valign="middle" align="center" rowspan="2">Accuracy</th><th valign="middle" align="center" colspan="5">SNP thresholds</th></tr><tr><th valign="middle" align="center"><italic>≤25</italic><break/><italic>(n=340)</italic></th><th valign="middle" align="center"><italic>≤20</italic><break/><italic>(n=316)</italic></th><th valign="middle" align="center"><italic>≤ 15</italic><break/><italic>(n=289)</italic></th><th valign="middle" align="center"><italic>≤ 10</italic><break/><italic>(n=242)</italic></th><th valign="middle" align="center"><italic>≤ 5</italic><break/><italic>(n=178)</italic></th></tr></thead><tbody><tr><td valign="middle" align="center" rowspan="6"><italic><bold>KmerAperture</bold></italic></td><td valign="middle" align="center" rowspan="2"><italic>k</italic>=19</td><td valign="middle" align="center"><italic>Specificity</italic></td><td valign="middle" align="center"><italic>0.939</italic></td><td valign="middle" align="center">0.947</td><td valign="middle" align="center">0.945</td><td valign="middle" align="center">0.969</td><td valign="middle" align="center">0.988</td></tr><tr><td valign="middle" align="center"><italic>PPV</italic></td><td valign="middle" align="center">0.986</td><td valign="middle" align="center">0.984</td><td valign="middle" align="center">0.98</td><td valign="middle" align="center">0.984</td><td valign="middle" align="center">0.989</td></tr><tr><td valign="middle" align="center" rowspan="2"><italic>k=25</italic></td><td valign="middle" align="center"><italic>Specificity</italic></td><td valign="middle" align="center">0.988</td><td valign="middle" align="center">0.989</td><td valign="middle" align="center">0.963</td><td valign="middle" align="center">0.992</td><td valign="middle" align="center">0.988</td></tr><tr><td valign="middle" align="center"><italic>PPV</italic></td><td valign="middle" align="center">0.997</td><td valign="middle" align="center">0.997</td><td valign="middle" align="center">0.986</td><td valign="middle" align="center">0.996</td><td valign="middle" align="center">0.989</td></tr><tr><td valign="middle" align="center" rowspan="2"><italic>k</italic>=31</td><td valign="middle" align="center"><italic>Specificity</italic></td><td valign="middle" align="center">0.988</td><td valign="middle" align="center">0.989</td><td valign="middle" align="center">0.972</td><td valign="middle" align="center">0.992</td><td valign="middle" align="center">0.988</td></tr><tr><td valign="middle" align="center"><italic>PPV</italic></td><td valign="middle" align="center">0.997</td><td valign="middle" align="center">0.997</td><td valign="middle" align="center">0.99</td><td valign="middle" align="center">0.996</td><td valign="middle" align="center">0.989</td></tr><tr><td valign="middle" align="center" rowspan="6"><italic><bold>SKA</bold></italic></td><td valign="middle" align="center" rowspan="2"><italic>k=19</italic></td><td valign="middle" align="center"><italic>Specificity</italic></td><td valign="middle" align="center">0.988</td><td valign="middle" align="center">0.978</td><td valign="middle" align="center">0.963</td><td valign="middle" align="center">0.992</td><td valign="middle" align="center">0.988</td></tr><tr><td valign="middle" align="center"><italic>PPV</italic></td><td valign="middle" align="center">0.997</td><td valign="middle" align="center">0.994</td><td valign="middle" align="center">0.986</td><td valign="middle" align="center">0.996</td><td valign="middle" align="center">0.989</td></tr><tr><td valign="middle" align="center" rowspan="2"><italic>k=25</italic></td><td valign="middle" align="center"><italic>Specificity</italic></td><td valign="middle" align="center">1.0</td><td valign="middle" align="center">0.989</td><td valign="middle" align="center">0.972</td><td valign="middle" align="center">0.992</td><td valign="middle" align="center">0.994</td></tr><tr><td valign="middle" align="center"><italic>PPV</italic></td><td valign="middle" align="center">1.0</td><td valign="middle" align="center">0.997</td><td valign="middle" align="center">0.99</td><td valign="middle" align="center">0.996</td><td valign="middle" align="center">0.994</td></tr><tr><td valign="middle" align="center" rowspan="2"><italic>k</italic>=31</td><td valign="middle" align="center"><italic>Specificity</italic></td><td valign="middle" align="center">1.0</td><td valign="middle" align="center">0.989</td><td valign="middle" align="center">0.972</td><td valign="middle" align="center">0.992</td><td valign="middle" align="center">0.994</td></tr><tr><td valign="middle" align="center"><italic>PPV</italic></td><td valign="middle" align="center">1.0</td><td valign="middle" align="center">0.997</td><td valign="middle" align="center">0.99</td><td valign="middle" align="center">0.994</td><td valign="middle" align="center">0.994</td></tr></tbody></table></table-wrap><table-wrap id="T2" orientation="portrait" position="float"><label>Table 2</label><caption><p>Performance by SNP retrieval for <italic>KmerAperture</italic> and SKA. There were three SNP amounts (50, 100, 150) and five fractions of <italic>k</italic>-clustering for each (20, 40, 60, 80 and 100% density). Within each category 50 genomes were simulated. The median retrieval is reported for each category with individual genome minimum and maximum retrieval</p></caption><table frame="box" rules="all"><thead><tr><th valign="middle" align="center" rowspan="2">Algorithm</th><th valign="middle" align="center" rowspan="2">Fraction of <italic>k -</italic>clustered SNPs</th><th valign="middle" align="center" colspan="3">Number of SNPs</th></tr><tr><th valign="middle" align="center">50</th><th valign="middle" align="center">100</th><th valign="middle" align="center">150</th></tr></thead><tbody><tr><td valign="middle" align="center" rowspan="5"><italic><bold>KmerAperture</bold></italic></td><td valign="middle" align="center"><italic>20%</italic></td><td valign="middle" align="center">36 (28-46)</td><td valign="middle" align="center">73 (52-83)</td><td valign="middle" align="center">111(97-120)</td></tr><tr><td valign="middle" align="center"><italic>40%</italic></td><td valign="middle" align="center">36 (24-42)</td><td valign="middle" align="center">73 (57-84)</td><td valign="middle" align="center">108 (90-122)</td></tr><tr><td valign="middle" align="center"><italic>60%</italic></td><td valign="middle" align="center">36.5 (19-44)</td><td valign="middle" align="center">69 (40-80)</td><td valign="middle" align="center">111 (80-124)</td></tr><tr><td valign="middle" align="center"><italic>80%</italic></td><td valign="middle" align="center">36 (13-44)</td><td valign="middle" align="center">67.5 (32-79)</td><td valign="middle" align="center">108.5 (48-125)</td></tr><tr><td valign="middle" align="center"><italic>100%</italic></td><td valign="middle" align="center">35 (8-43)</td><td valign="middle" align="center">65 (20-81)</td><td valign="middle" align="center">109 (79-122)</td></tr><tr><td valign="middle" align="center" rowspan="5"><italic><bold>SKA</bold></italic></td><td valign="middle" align="center"><italic>20%</italic></td><td valign="middle" align="center">33 (26-41)</td><td valign="middle" align="center">67 (53-77)</td><td valign="middle" align="center">100(82-110)</td></tr><tr><td valign="middle" align="center"><italic>40%</italic></td><td valign="middle" align="center">29 (21-36)</td><td valign="middle" align="center">56 (45-68)</td><td valign="middle" align="center">83 (72-96)</td></tr><tr><td valign="middle" align="center"><italic>60%</italic></td><td valign="middle" align="center">25 (18-34)</td><td valign="middle" align="center">49 (32-60)</td><td valign="middle" align="center">73 (62-87)</td></tr><tr><td valign="middle" align="center"><italic>80%</italic></td><td valign="middle" align="center">20 (13-30)</td><td valign="middle" align="center">40 (31-60)</td><td valign="middle" align="center">59 (43-73)</td></tr><tr><td valign="middle" align="center"><italic>100%</italic></td><td valign="middle" align="center">17 (10-24)</td><td valign="middle" align="center">29.5 (17-43)</td><td valign="middle" align="center">47 (35-63)</td></tr></tbody></table></table-wrap></floats-group></article>