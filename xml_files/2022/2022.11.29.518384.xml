<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS158008</article-id><article-id pub-id-type="doi">10.1101/2022.11.29.518384</article-id><article-id pub-id-type="archive">PPR578809</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">2</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Single cell gene set scoring with nearest neighbor graph smoothed data (gssnng)</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Gibbs</surname><given-names>David L</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib><contrib contrib-type="author"><name><surname>Strasser</surname><given-names>Michael K</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Huang</surname><given-names>Sui</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><aff id="A1"><label>1</label>Shmulevich Lab, Institute for Systems Biology, 401 Terry Ave N, 98106, WA, USA</aff><aff id="A2"><label>2</label>Huang Lab, Institute for Systems Biology, 401 Terry Ave N, 98106, WA, USA</aff></contrib-group><author-notes><corresp id="CR1"><label>*</label>Corresponding author. <email>david.gibbs@isbscience.org</email></corresp></author-notes><pub-date pub-type="nihms-submitted"><day>04</day><month>12</month><year>2022</year></pub-date><pub-date pub-type="preprint"><day>02</day><month>12</month><year>2022</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Gene set scoring (or enrichment) is a common dimension reduction task in bioinformatics that can be focused on differences between groups or at the single sample level. Gene sets can represent biological functions, molecular pathways, cell identities, and more. Gene set scores are context dependent values that are useful for interpreting biological changes following experiments or perturbations. Single sample scoring produces a set of scores, one for each member of a group, which can be analyzed with statistical models that can include additional clinically important factors such as gender or age. However, the sparsity and technical noise of single cell expression measures create difficulties for these methods, which were originally designed for bulk expression profiling (microarrays, RNAseq). This can be greatly remedied by first applying a smoothing transformation that shares gene measure information within transcriptomic neighborhoods. In this work, we use the nearest neighbor graph of cells for matrix smoothing to produce high quality gene set scores on a per-cell, per-group, level which is useful for visualization and statistical analysis.</p></abstract><kwd-group><kwd>Systems biology</kwd><kwd>Signal processing</kwd><kwd>Data analysis</kwd><kwd>Gene expression</kwd><kwd>Software engineering</kwd></kwd-group></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P2">In biological systems, groups of genes carry out biological functions via pathways, protein complexes, and signalling cascades. It is often informative to assess the activity of these transcriptional programs through examining the concerted expression of several genes together. Their individual expression may be weak, but co-expression of genes in a pathway is often a strong indication of activity. Using gene set enrichment techniques can shed light on how pathways and modules take part in the response to perturbations [<xref ref-type="bibr" rid="R1">1</xref>, <xref ref-type="bibr" rid="R2">2</xref>, <xref ref-type="bibr" rid="R3">3</xref>, <xref ref-type="bibr" rid="R4">4</xref>].</p><p id="P3">Recently, single sample methods have been developed to compute a gene set score independently for each sample. The matrix of scores (samples by gene set) are used as the basis of further analysis, such as in visualizations and statistical modeling [<xref ref-type="bibr" rid="R5">5</xref>, <xref ref-type="bibr" rid="R6">6</xref>]. With single sample scores, statistical models can be better specified since they can include not only gene set scores but also clinical, biospecimen, and technical variables. From single sample analysis, it is a natural extension to single cells.</p><p id="P4">Much of the previously mentioned methods were designed for bulk expression data like gene microarrays and RNA-seq, where millions of cells are batch processed. These experiments provide ample measures on practically all genes, but represent an unknown mixture of cells (i.e. a population average). Single cell transcriptomics provides more precise information on the mixture of cell types, the heterogeneity of those cells, and allows for the discovery of new subtypes. However, the data is shallow (few counts), sparse (many zeros in the expression matrix), and noisy with a much smaller collection of total genes measured in each cell [<xref ref-type="bibr" rid="R7">7</xref>]. This causes difficulties in standard types of analysis, such as differential expression, but also gene set analysis. For example, methods that rely on ranked expression profiles, like ssGSEA, will be operating on data that have shared rank across the high proportion of zeros or integer collisions (e.g. genes with 1 count). Due to frequent ties, ranking becomes highly unstable; small changes in a gene’s counts lead to large changes in rank, further leading to large changes in gene set scores.</p><p id="P5">In the related task of determining differential expression, recent studies have shown that these problems can be avoided by using “pseudobulk” profiles, created by summing across groups of cells [<xref ref-type="bibr" rid="R8">8</xref>]. The summation is a dimensional reduction (in the cell dimension) that creates higher abundances, lower noise floors, breaks many of the ties in expression counts, and allows for better overlap with gene sets. However, in applying this ‘pseudo-bulk’ transformation, most of what makes single cell data valued is lost; namely the heterogeneity and variability observed across cells and conditions. Other approaches have been developed that address the noise and sparsity and in many instances these focus on K-nearest neighbor graphs, which are a fundamental part of single cell data analysis and has thus been an attractive target for data processing, such as in MetaCell [<xref ref-type="bibr" rid="R9">9</xref>] which partitions subgraphs to model an archetypal cell. Also, other methods using nearest neighbor smoothing have been reported to be highly effective in single cell data sets [<xref ref-type="bibr" rid="R10">10</xref>, <xref ref-type="bibr" rid="R11">11</xref>]. Methods such as MAGIC [<xref ref-type="bibr" rid="R12">12</xref>] involve modeling the lower dimensional data manifold with diffusion on the KNN graph or in scGSEA [<xref ref-type="bibr" rid="R13">13</xref>] estimating latent spaces is used for gene set scoring.</p><p id="P6">With these approaches in mind, we have developed a python package that works with Scanpy AnnData objects to produce a gene set score for each cell [<xref ref-type="bibr" rid="R14">14</xref>]. Included are a collection of scoring functions from previously described single sample methods, similar to decoupleR [<xref ref-type="bibr" rid="R15">15</xref>], and functions that ingest gene sets from standard .gmt files or from OmniPath [<xref ref-type="bibr" rid="R16">16</xref>].</p><sec id="S2"><label>1</label><title>Overview of the method</title><p id="P7">Briefly, cells are grouped using user-specified attributes such as cell type, cluster label, batch, or condition. These groups are used to define collections of cells that form disjoint nearest neighbor graphs. After creating groups, the remainder of the process is done in parallel by group. The graphs, represented as a matrix, are used in smoothing the gene expression counts matrix. Lastly, the smoothed expression profile for each cell is passed to a selected gene set scoring function (<xref ref-type="fig" rid="F1">Figure 1A</xref>).</p></sec><sec id="S3"><label>2</label><title>Grouping cells with the “groupby”</title><p id="P8">When analyzing a combined or integrated dataset (e.g. contains several samples, patients, or batches), it may be beneficial to first group cells into phenotypically similar subsets before building the KNN graphs. The “groupby” parameter, is a list that maps to a set of categorical variables in the AnnData.obs table, and is used to sort the cells into chunks that can be processed in parallel. We use python’s multiprocessing starmap function to asynchronously process each “groupby-group”. This leads to a set of smoothed count matrices that are each specific to a selected phenotype. For example, one might group cells by cluster label, so smoothing is constrained to transcriptionally similar cells.</p></sec><sec id="S4"><label>3</label><title>The nearest neighbor graph</title><p id="P9">After grouping, a nearest neighbor graph of cells is constructed using scanpy.pp.neighbors, which in turn uses PyNNDescent [<xref ref-type="bibr" rid="R17">17</xref>]. To calculate distances between cells and to determine nearest neighbors, we use a density-adjusted Gaussian kernel, commonly used in graph based clustering and dimension reduction of scRNAseq [<xref ref-type="bibr" rid="R18">18</xref>]. The choice of K in building the KNN, will be context dependent, but in practice, setting K to around 32 works well. One suggestion to determine K, is to use the ‘geneset overlap’ function, which returns the size of the intersection between the gene set and the expressed genes (above a given threshold). When the ‘geneset overlap’ score plateaus, the limitations of the data become apparent (see <xref ref-type="fig" rid="F1">Figure 1</xref>).</p></sec><sec id="S5"><label>4</label><title>Matrix smoothing</title><p id="P10">To address the noisy and sparse nature of single cell expression data, we apply nearest neighbor smoothing to produce a smoothed gene expression profile for each cell based on its neighbors. This assumes that gene expression varies smoothly along the data manifold (approximated by the nearest neighbor graph) and hence we can use information from neighboring cells to denoise the expression profiles of cells (similar to Gaussian smoothing in images, which assumes that pixel intensities vary smoothly in space) [<xref ref-type="bibr" rid="R19">19</xref>, <xref ref-type="bibr" rid="R20">20</xref>]. The smoothed expression matrix of cells by genes is calculated via matrix multiplication <italic>AX</italic> = <italic>M</italic> where <italic>A</italic> represents a binary adjacency matrix or a weighted matrix of connectivities, and <italic>X</italic> is the cell by gene matrix of gene expression counts. Additionally, one can set the ‘smooth mode’ to ‘off’ in order to disable smoothing. As both A and X are typically sparse, our implementation uses the scipy sparse matrix library as an effort to be mindful of memory use [<xref ref-type="bibr" rid="R21">21</xref>].</p></sec><sec id="S6"><label>5</label><title>Scoring Functions</title><p id="P11">As part of the package, several functions are available for gene set scoring. These include ‘singscore’ [<xref ref-type="bibr" rid="R6">6</xref>], ‘ssgsea’ [<xref ref-type="bibr" rid="R5">5</xref>, <xref ref-type="bibr" rid="R22">22</xref>], ‘rank biased overlap’ [<xref ref-type="bibr" rid="R23">23</xref>], ‘mean z score’, ‘average score’, ‘median score’, ‘summed up’ [<xref ref-type="bibr" rid="R24">24</xref>] and a ‘geneset overlap’ count. For each gene set, the gene set scores are recorded in the AnnData.obs pandas table, with one column per gene set, facilitating visualization through compatibility with the Scanpy plotting system.</p></sec><sec id="S7"><label>6</label><title>Validation of GSSNNG</title><p id="P12">In order to validate the method, we used three data sets with known ‘ground truths’. First, we compare smoothed and non-smoothed gene set scoring to identify B cells in a mixture of PBMCs[<xref ref-type="bibr" rid="R25">25</xref>]. Second, we show how smoothed gene set scoring helps to identify cells with an immune response in a dataset of phagocytes treated with LPS [<xref ref-type="bibr" rid="R8">8</xref>]. Third, we assess smoothed and non-smoothed gene set scoring of cellular response genes in a dataset of endothelial cells exposed to spinal injury in mice [<xref ref-type="bibr" rid="R26">26</xref>].</p><sec id="S8"><label>6.1</label><title>10X genomics pbmc3k</title><p id="P13">In this data set, peripheral blood mononuclear cells (PBMCs) from a healthy donor were sequenced and annotated with cell type labels. The pre-processed data contains 2,638 cells with 1,838 genes. We applied the LM22 gene sets (cell type signatures) to produce cell type specific scores [<xref ref-type="bibr" rid="R27">27</xref>], focusing on the naive B cell signature (<xref ref-type="fig" rid="F1">Figure 1B</xref>). The ‘geneset overlap’ function was applied to non-smoothed data and smoothed data (K=8 or K=32 neighbors). This function returns the number (or fraction) of genes that have expression measures above the given threshold. Here we show that for previously annotated B cells the number of genes from the B.cell.naive signature was effectively doubled with smoothing. With the limited set of genes available, the increase in gene set overlap does not improve noticeably past 32 neighbors. But clearly, through the use of matrix smoothing, the B cell specific signal was improved without an effect to non-B cells and allows one to easily distinguish B-cells from other cells using the signature scores.</p></sec><sec id="S9"><label>6.2</label><title>Hagai et al</title><p id="P14">Murine phagocytic cells were treated with lipopolysaccharide (LPS) which causes a strong immune response. The OKUMURA INFLAMMATORY RESPONSE LPS gene set [<xref ref-type="bibr" rid="R28">28</xref>] contains genes related to this cellular warning system (see <xref ref-type="fig" rid="F2">Figure 2</xref>). The data set was subsampled to 2,340 lps4 treated cells and 2,104 untreated cells and scored using the ‘summed up’ ranks function, which simply sums up the smoothed and ranked expression of signature genes for each cell. The results are compared between no smoothing and smoothing with 4, 8, or 32 neighbors. It was observed that with increasing neighborhood size, the separation in the distribution of gene set scores increased, improving the prediction of treatment group (<xref ref-type="fig" rid="F2">Figure 2</xref>). Using sklearn’s roc auc score function, the area under the curve (AUC) was calculated to be 0.95 for unsmoothed data, and improved to 1.0 for smoothed data.</p></sec></sec><sec id="S10"><label>6.3</label><title>Squair et al</title><p id="P15">In this experiment, mice received spinal injuries which provoked a cellular response. The study reported that from all cells investigated, endothelial cells showed the greatest response. From the differential expression analysis on endothelial cells, 19 genes were validated using RNAscope. Because not all genes were validated, the gene sets were constructed from 12 of the 19 genes, with 7 showing higher expression in the injured mice and 5 showing lower expression for injured mice, thus making a two part gene set (both up and down). Gene set scoring was performed using the ‘rank biased overlap (RBO)’ and ‘ssGSEA’ functions on ranked expression on endothelial cells, and it was observed that with smoothing the gene set score distributions became separated, more clearly defining the the injured and the control groups (<xref ref-type="fig" rid="F3">Figure 3</xref>). In predicting exposure, the area under the curve (AUC) was 0.62 and 0.69 using unsmoothed data, which improved to 0.71 and 0.8 with smoothed data after applying the RBO and ssGSEA score functions respectively.</p></sec></sec></body><back><ack id="S11"><title>Acknowledgments</title><p>This work was supported by a Cancer Research UK Grand Challenge (CRUK grant 29068). Additional support from the Tlsty Lab at UCSF (PI Tlsty, CRUK grant 27145), McGill University Thoracic and Upper GI Cancer Research Laboratories (PI Ferri, CRUK grant 29071) and the Advanced Genomic Technologies Laboratory (PI Ragoussis, CRUK grant 29078) is greatly appreciated.</p></ack><fn-group><fn id="FN1" fn-type="conflict"><p id="P16"><bold>Competing interests</bold></p><p id="P17">No competing interest is declared.</p></fn><fn id="FN2" fn-type="con"><p id="P18"><bold>Author contributions statement</bold></p><p id="P19">D.G. and M.S. conceived of, and implemented, the method.</p><p id="P20">D.G. and M.S. produced and analysed the results. D.G., M.S.,</p><p id="P21">S.H. wrote and reviewed the manuscript.</p></fn><fn id="FN3"><p id="P22"><bold>Availability and implementation</bold></p><p id="P23">The gssnng software is available using the python package index (PyPI) and works with Scanpy AnnData objects. It can be installed using ‘pip install gssnng’. More information and demo notebooks: See <ext-link ext-link-type="uri" xlink:href="https://github.com/IlyaLab/gssnng">https://github.com/IlyaLab/gssnng</ext-link></p></fn><fn id="FN4"><p id="P24">Availability</p><p id="P25">The gssnng package is available on github (<ext-link ext-link-type="uri" xlink:href="https://github.com/IlyaLab/gssnng">https://github.com/IlyaLab/gssnng</ext-link>) and the PyPI index (<ext-link ext-link-type="uri" xlink:href="https://pypi.org/project/gssnng/">https://pypi.org/project/gssnng/</ext-link>).</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Subramanian</surname><given-names>Aravind</given-names></name><name><surname>Tamayo</surname><given-names>Pablo</given-names></name><name><surname>Mootha</surname><given-names>Vamsi K</given-names></name><name><surname>Mukherjee</surname><given-names>Sayan</given-names></name><name><surname>Ebert</surname><given-names>Benjamin L</given-names></name><name><surname>Gillette</surname><given-names>Michael A</given-names></name><name><surname>Paulovich</surname><given-names>Amanda</given-names></name><name><surname>Pomeroy</surname><given-names>Scott L</given-names></name><name><surname>Golub</surname><given-names>Todd R</given-names></name><name><surname>Lander</surname><given-names>Eric S</given-names></name><etal/></person-group><article-title>Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles</article-title><source>Proceedings of the National Academy of Sciences</source><year>2005</year><volume>102</volume><issue>43</issue><fpage>15545</fpage><lpage>15550</lpage><pub-id pub-id-type="pmcid">PMC1239896</pub-id><pub-id pub-id-type="pmid">16199517</pub-id><pub-id pub-id-type="doi">10.1073/pnas.0506580102</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Hung</surname><given-names>Jui-Hung</given-names></name><name><surname>Yang</surname><given-names>Tun-Hsiang</given-names></name><name><surname>Hu</surname><given-names>Zhenjun</given-names></name><name><surname>Weng</surname><given-names>Zhiping</given-names></name><name><surname>DeLisi</surname><given-names>Charles</given-names></name></person-group><article-title>Gene set enrichment analysis: performance evaluation and usage guidelines</article-title><source>Briefings in bioinformatics</source><publisher-name>Oxford University Press</publisher-name><year>2012</year><volume>13</volume><issue>3</issue><fpage>281</fpage><lpage>291</lpage><pub-id pub-id-type="pmcid">PMC3357488</pub-id><pub-id pub-id-type="pmid">21900207</pub-id><pub-id pub-id-type="doi">10.1093/bib/bbr049</pub-id></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maciejewski</surname><given-names>Henryk</given-names></name></person-group><article-title>Gene set analysis methods: statistical models and methodological differences</article-title><source>Briefings in Bioinformatics</source><year>2014</year><month>July</month><volume>15</volume><issue>4</issue><fpage>504</fpage><lpage>518</lpage><pub-id pub-id-type="pmcid">PMC4103537</pub-id><pub-id pub-id-type="pmid">23413432</pub-id><pub-id pub-id-type="doi">10.1093/bib/bbt002</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Maleki</surname><given-names>Farhad</given-names></name><name><surname>Ovens</surname><given-names>Katie</given-names></name><name><surname>Hogan</surname><given-names>Daniel J</given-names></name><name><surname>Kusalik</surname><given-names>Anthony J</given-names></name></person-group><article-title>Gene Set Analysis: Challenges, Opportunities, and Future Research</article-title><source>Frontiers in Genetics</source><year>2020</year><volume>11</volume><pub-id pub-id-type="pmcid">PMC7339292</pub-id><pub-id pub-id-type="pmid">32695141</pub-id><pub-id pub-id-type="doi">10.3389/fgene.2020.00654</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barbie</surname><given-names>David A</given-names></name><name><surname>Tamayo</surname><given-names>Pablo</given-names></name><name><surname>Boehm</surname><given-names>Jesse S</given-names></name><name><surname>Kim</surname><given-names>So Young</given-names></name><name><surname>Moody</surname><given-names>Susan E</given-names></name><name><surname>Dunn</surname><given-names>Ian F</given-names></name><name><surname>Schinzel</surname><given-names>Anna C</given-names></name><name><surname>Sandy</surname><given-names>Peter</given-names></name><name><surname>Meylan</surname><given-names>Etienne</given-names></name><name><surname>Scholl</surname><given-names>Claudia</given-names></name><name><surname>Fröohling</surname><given-names>Stefan</given-names></name><etal/></person-group><article-title>Systematic RNA interference reveals that oncogenic KRAS-driven cancers require TBK1</article-title><source>Nature</source><year>2009</year><month>November</month><volume>462</volume><issue>7269</issue><fpage>108</fpage><lpage>112</lpage><pub-id pub-id-type="pmcid">PMC2783335</pub-id><pub-id pub-id-type="pmid">19847166</pub-id><pub-id pub-id-type="doi">10.1038/nature08460</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Foroutan</surname><given-names>Momeneh</given-names></name><name><surname>Bhuva</surname><given-names>Dharmesh D</given-names></name><name><surname>Lyu</surname><given-names>Ruqian</given-names></name><name><surname>Horan</surname><given-names>Kristy</given-names></name><name><surname>Cursons</surname><given-names>Joseph</given-names></name><name><surname>Davis</surname><given-names>Melissa J</given-names></name></person-group><article-title>Single sample scoring of molecular phenotypes</article-title><source>BMC bioinformatics</source><year>2018</year><month>November</month><volume>19</volume><issue>1</issue><elocation-id>404</elocation-id><pub-id pub-id-type="pmcid">PMC6219008</pub-id><pub-id pub-id-type="pmid">30400809</pub-id><pub-id pub-id-type="doi">10.1186/s12859-018-2435-4</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kim</surname><given-names>Tae Hyun</given-names></name><name><surname>Zhou</surname><given-names>Xiang</given-names></name><name><surname>Chen</surname><given-names>Mengjie</given-names></name></person-group><article-title>Demystifying “drop-outs” in single-cell UMI data</article-title><source>Genome Biology</source><year>2020</year><month>August</month><volume>21</volume><issue>1</issue><elocation-id>196</elocation-id><pub-id pub-id-type="pmcid">PMC7412673</pub-id><pub-id pub-id-type="pmid">32762710</pub-id><pub-id pub-id-type="doi">10.1186/s13059-020-02096-y</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Squair</surname><given-names>Jordan W</given-names></name><name><surname>Gautier</surname><given-names>Matthieu</given-names></name><name><surname>Kathe</surname><given-names>Claudia</given-names></name><name><surname>Anderson</surname><given-names>Mark A</given-names></name><name><surname>James</surname><given-names>Nicholas D</given-names></name><name><surname>Hutson</surname><given-names>Thomas H</given-names></name><name><surname>Hudelle</surname><given-names>Rémi</given-names></name><name><surname>Qaiser</surname><given-names>Taha</given-names></name><name><surname>Matson</surname><given-names>Kaya JE</given-names></name><name><surname>Barraud</surname><given-names>Quentin</given-names></name><name><surname>Levine</surname><given-names>Ariel J</given-names></name><etal/></person-group><article-title>Confronting false discoveries in single-cell differential expression</article-title><source>Nature Communications</source><publisher-name>Nature Publishing Group</publisher-name><year>2021</year><month>September</month><volume>12</volume><issue>1</issue><elocation-id>5692</elocation-id><pub-id pub-id-type="pmcid">PMC8479118</pub-id><pub-id pub-id-type="pmid">34584091</pub-id><pub-id pub-id-type="doi">10.1038/s41467-021-25960-2</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baran</surname><given-names>Yael</given-names></name><name><surname>Bercovich</surname><given-names>Akhiad</given-names></name><name><surname>Sebe-Pedros</surname><given-names>Arnau</given-names></name><name><surname>Lubling</surname><given-names>Yaniv</given-names></name><name><surname>Giladi</surname><given-names>Amir</given-names></name><name><surname>Chomsky</surname><given-names>Elad</given-names></name><name><surname>Meir</surname><given-names>Zohar</given-names></name><name><surname>Hoichman</surname><given-names>Michael</given-names></name><name><surname>Lifshitz</surname><given-names>Aviezer</given-names></name><name><surname>Tanay</surname><given-names>Amos</given-names></name></person-group><article-title>Metacell: analysis of single-cell rna-seq data using k-nn graph partitions</article-title><source>Genome biology</source><year>2019</year><volume>20</volume><issue>1</issue><fpage>1</fpage><lpage>19</lpage><pub-id pub-id-type="pmcid">PMC6790056</pub-id><pub-id pub-id-type="pmid">31604482</pub-id><pub-id pub-id-type="doi">10.1186/s13059-019-1812-2</pub-id></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lun</surname><given-names>Aaron TL</given-names></name><name><surname>Bach</surname><given-names>Karsten</given-names></name><name><surname>Marioni</surname><given-names>John C</given-names></name></person-group><article-title>Pooling across cells to normalize single-cell rna sequencing data with many zero counts</article-title><source>Genome biology</source><year>2016</year><volume>17</volume><issue>1</issue><fpage>1</fpage><lpage>14</lpage><pub-id pub-id-type="pmcid">PMC4848819</pub-id><pub-id pub-id-type="pmid">27122128</pub-id><pub-id pub-id-type="doi">10.1186/s13059-016-0947-7</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wagner</surname><given-names>Florian</given-names></name><name><surname>Yan</surname><given-names>Yun</given-names></name><name><surname>Yanai</surname><given-names>Itai</given-names></name></person-group><article-title>K-nearest neighbor smoothing for high-throughput single-cell rna-seq data</article-title><source>BioRxiv</source><year>2017</year><elocation-id>217737</elocation-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>van Dijk</surname><given-names>David</given-names></name><name><surname>Sharma</surname><given-names>Roshan</given-names></name><name><surname>Nainys</surname><given-names>Juozas</given-names></name><name><surname>Yim</surname><given-names>Kristina</given-names></name><name><surname>Kathail</surname><given-names>Pooja</given-names></name><name><surname>Carr</surname><given-names>Ambrose J</given-names></name><name><surname>Burdziak</surname><given-names>Cassandra</given-names></name><name><surname>Moon</surname><given-names>Kevin R</given-names></name><name><surname>Chaffer</surname><given-names>Christine L</given-names></name><name><surname>Pattabiraman</surname><given-names>Diwakar</given-names></name><name><surname>Bierie</surname><given-names>Brian</given-names></name><etal/></person-group><article-title>Recovering Gene Interactions from Single-Cell Data Using Data Diffusion</article-title><source>Cell</source><publisher-name>Elsevier</publisher-name><year>2018</year><month>July</month><volume>174</volume><issue>3</issue><fpage>716</fpage><lpage>729</lpage><elocation-id>e27</elocation-id><pub-id pub-id-type="pmcid">PMC6771278</pub-id><pub-id pub-id-type="pmid">29961576</pub-id><pub-id pub-id-type="doi">10.1016/j.cell.2018.05.061</pub-id></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Franchini</surname><given-names>Melania</given-names></name><name><surname>Pellecchia</surname><given-names>Simona</given-names></name><name><surname>Viscido</surname><given-names>Gaetano</given-names></name><name><surname>Gambardella</surname><given-names>Gennaro</given-names></name></person-group><article-title>Single-cell gene set enrichment analysis and transfer learning for functional annotation of scrna-seq data</article-title><source>NAR Genomics and Bioinformatics</source><year>2023</year><volume>5</volume><issue>1</issue><elocation-id>qad024</elocation-id><pub-id pub-id-type="pmcid">PMC9985338</pub-id><pub-id pub-id-type="pmid">36879897</pub-id><pub-id pub-id-type="doi">10.1093/nargab/lqad024</pub-id></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wolf</surname><given-names>F Alexander</given-names></name><name><surname>Angerer</surname><given-names>Philipp</given-names></name><name><surname>Theis</surname><given-names>Fabian J</given-names></name></person-group><article-title>Scanpy: large-scale single-cell gene expression data analysis</article-title><source>Genome biology</source><year>2018</year><volume>19</volume><fpage>1</fpage><lpage>5</lpage><pub-id pub-id-type="pmcid">PMC5802054</pub-id><pub-id pub-id-type="pmid">29409532</pub-id><pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mompel</surname><given-names>Pau Badia-i</given-names></name><name><surname>Santiago</surname><given-names>Jesús Vélez</given-names></name><name><surname>Braunger</surname><given-names>Jana</given-names></name><name><surname>Geiss</surname><given-names>Celina</given-names></name><name><surname>Dimitrov</surname><given-names>Daniel</given-names></name><name><surname>Muüller-Dott</surname><given-names>Sophia</given-names></name><name><surname>Taus</surname><given-names>Petr</given-names></name><name><surname>Dugourd</surname><given-names>Aurelien</given-names></name><name><surname>Holland</surname><given-names>Christian H</given-names></name><name><surname>Flores</surname><given-names>Ricardo O Ramirez</given-names></name><etal/></person-group><article-title>decoupler: ensemble of computational methods to infer biological activities from omics data</article-title><source>Bioinformatics Advances</source><year>2022</year><volume>2</volume><issue>1</issue><elocation-id>vbac016</elocation-id><pub-id pub-id-type="pmcid">PMC9710656</pub-id><pub-id pub-id-type="pmid">36699385</pub-id><pub-id pub-id-type="doi">10.1093/bioadv/vbac016</pub-id></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Türei</surname><given-names>Dénes</given-names></name><name><surname>Korcsmáros</surname><given-names>Tamás</given-names></name><name><surname>Saez-Rodriguez</surname><given-names>Julio</given-names></name></person-group><article-title>Omnipath: guidelines and gateway for literature-curated signaling pathway resources</article-title><source>Nature methods</source><year>2016</year><volume>13</volume><issue>12</issue><fpage>966</fpage><lpage>967</lpage><pub-id pub-id-type="pmid">27898060</pub-id></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Dong</surname><given-names>Wei</given-names></name><name><surname>Moses</surname><given-names>Charikar</given-names></name><name><surname>Li</surname><given-names>Kai</given-names></name></person-group><source>Efficient k-nearest neighbor graph construction for generic similarity measures</source><conf-name>Proceedings of the 20th International Conference on World Wide Web, WWW ‘11</conf-name><conf-sponsor>Association for Computing Machinery</conf-sponsor><conf-loc>New York, NY, USA</conf-loc><year>2011</year><fpage>577</fpage><lpage>586</lpage></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McInnes</surname><given-names>Leland</given-names></name><name><surname>Healy</surname><given-names>John</given-names></name><name><surname>Melville</surname><given-names>James</given-names></name></person-group><article-title>Umap: Uniform manifold approximation and projection for dimension reduction</article-title><source>arXiv preprint</source><year>2018</year><elocation-id>arXiv:1802.03426</elocation-id></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Shapiro</surname><given-names>Linda G</given-names></name><name><surname>Stockman</surname><given-names>George C</given-names></name></person-group><source>Computer vision</source><publisher-name>Prentice Hall</publisher-name><publisher-loc>New Jersey</publisher-loc><year>2001</year><volume>3</volume></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ronen</surname><given-names>Jonathan</given-names></name><name><surname>Akalin</surname><given-names>Altuna</given-names></name></person-group><article-title>netSmooth: Network-smoothing based imputation for single cell RNA-seq</article-title><source>F1000Research</source><year>2018</year><month>July</month><volume>7</volume><fpage>8</fpage><pub-id pub-id-type="pmcid">PMC5814748</pub-id><pub-id pub-id-type="pmid">29511531</pub-id><pub-id pub-id-type="doi">10.12688/f1000research.13511.3</pub-id></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Becht</surname><given-names>Etienne</given-names></name><name><surname>McInnes</surname><given-names>Leland</given-names></name><name><surname>Healy</surname><given-names>John</given-names></name><name><surname>Dutertre</surname><given-names>Charles-Antoine</given-names></name><name><surname>Kwok</surname><given-names>Immanuel WH</given-names></name><name><surname>Ng</surname><given-names>Lai Guan</given-names></name><name><surname>Ginhoux</surname><given-names>Florent</given-names></name><name><surname>Newell</surname><given-names>Evan W</given-names></name></person-group><article-title>Dimensionality reduction for visualizing single-cell data using UMAP</article-title><source>Nature biotechnology</source><publisher-name>Nature Publishing Group</publisher-name><year>2019</year><volume>37</volume><issue>1</issue><fpage>38</fpage><lpage>44</lpage><pub-id pub-id-type="pmid">30531897</pub-id></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Abazeed</surname><given-names>Mohamed E</given-names></name><name><surname>Adams</surname><given-names>Drew J</given-names></name><name><surname>Hurov</surname><given-names>Kristen E</given-names></name><name><surname>Tamayo</surname><given-names>Pablo</given-names></name><name><surname>Creighton</surname><given-names>Chad J</given-names></name><name><surname>Sonkin</surname><given-names>Dmitriy</given-names></name><name><surname>Giacomelli</surname><given-names>Andrew O</given-names></name><name><surname>Du</surname><given-names>Charles</given-names></name><name><surname>Fries</surname><given-names>Daniel F</given-names></name><name><surname>Wong</surname><given-names>Kwok-Kin</given-names></name><name><surname>Mesirov</surname><given-names>Jill P</given-names></name><etal/></person-group><article-title>Integrative radiogenomic profiling of squamous cell lung cancer</article-title><source>Cancer Research</source><year>2013</year><month>October</month><volume>73</volume><issue>20</issue><fpage>6289</fpage><lpage>6298</lpage><pub-id pub-id-type="pmcid">PMC3856255</pub-id><pub-id pub-id-type="pmid">23980093</pub-id><pub-id pub-id-type="doi">10.1158/0008-5472.CAN-13-1616</pub-id></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Webber</surname><given-names>William</given-names></name><name><surname>Moffat</surname><given-names>Alistair</given-names></name><name><surname>Zobel</surname><given-names>Justin</given-names></name></person-group><article-title>A similarity measure for indefinite rankings</article-title><source>ACM Transactions on Information Systems</source><year>2010</year><month>November</month><volume>28</volume><issue>4</issue><fpage>1</fpage><lpage>38</lpage><elocation-id>20</elocation-id></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pont</surname><given-names>Frédéric</given-names></name><name><surname>Tosolini</surname><given-names>Marie</given-names></name><name><surname>Fournié</surname><given-names>Jean J</given-names></name></person-group><article-title>Single-Cell Signature Explorer for comprehensive visualization of single cell signatures across scRNA-seq datasets</article-title><source>Nucleic Acids Research</source><year>2019</year><month>December</month><volume>47</volume><issue>21</issue><fpage>e133</fpage><pub-id pub-id-type="pmcid">PMC6868346</pub-id><pub-id pub-id-type="pmid">31294801</pub-id><pub-id pub-id-type="doi">10.1093/nar/gkz601</pub-id></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="other"><source>3k PBMCs Single Cell Gene Expression Dataset by Cell Ranger 1.1.0 from 10x Genomics</source></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hagai</surname><given-names>Tzachi</given-names></name><name><surname>Chen</surname><given-names>Xi</given-names></name><name><surname>Miragaia</surname><given-names>Ricardo J</given-names></name><name><surname>Rostom</surname><given-names>Raghd</given-names></name><name><surname>Gomes</surname><given-names>Tomás</given-names></name><name><surname>Kunowska</surname><given-names>Natalia</given-names></name><name><surname>Henriksson</surname><given-names>Johan</given-names></name><name><surname>Park</surname><given-names>Jong-Eun</given-names></name><name><surname>Proserpio</surname><given-names>Valentina</given-names></name><name><surname>Donati</surname><given-names>Giacomo</given-names></name><etal/></person-group><article-title>Gene expression variability across cells and species shapes innate immunity</article-title><source>Nature</source><year>2018</year><volume>563</volume><issue>7730</issue><fpage>197</fpage><lpage>202</lpage><pub-id pub-id-type="pmcid">PMC6347972</pub-id><pub-id pub-id-type="pmid">30356220</pub-id><pub-id pub-id-type="doi">10.1038/s41586-018-0657-2</pub-id></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>Binbin</given-names></name><name><surname>Khodadoust</surname><given-names>Michael S</given-names></name><name><surname>Liu</surname><given-names>Chih Long</given-names></name><name><surname>Newman</surname><given-names>Aaron M</given-names></name><name><surname>Alizadeh</surname><given-names>Ash A</given-names></name></person-group><article-title>Profiling tumor infiltrating immune cells with cibersort</article-title><source>Cancer Systems Biology: Methods and Protocols</source><year>2018</year><fpage>243</fpage><lpage>259</lpage><pub-id pub-id-type="pmcid">PMC5895181</pub-id><pub-id pub-id-type="pmid">29344893</pub-id><pub-id pub-id-type="doi">10.1007/978-1-4939-7493-1_12</pub-id></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Okumura</surname><given-names>Shigeru</given-names></name><name><surname>Kashiwakura</surname><given-names>Jun-ichi</given-names></name><name><surname>Tomita</surname><given-names>Hisashi</given-names></name><name><surname>Matsumoto</surname><given-names>Kenji</given-names></name><name><surname>Nakajima</surname><given-names>Toshiharu</given-names></name><name><surname>Saito</surname><given-names>Hirohisa</given-names></name><name><surname>Okayama</surname><given-names>Yoshimichi</given-names></name></person-group><article-title>Identification of specific gene expression profiles in human mast cells mediated by toll-like receptor 4 and fceri</article-title><source>Blood</source><year>2003</year><volume>102</volume><issue>7</issue><fpage>2547</fpage><lpage>2554</lpage><pub-id pub-id-type="pmid">12855579</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Fig. 1</label><caption><p>Figure 1. (A.) Overview of the approach. (B.) Code examples to generate the results shown in next panel. (C.) Effect of neighborhood smoothing for PBMCs and a B-cell signature. Gene set overlap (cells from 10X 3kPBMC dataset) with smoothing turned off, or K-nearest neighbor smoothing(K=8 or K=32). B cells in the data set (orange) start with approximately 15% of their measured genes overlapping with the “B.cell.naive signature”. After data smoothing the gene set overlap grows to over 30%.</p></caption><graphic xlink:href="EMS158008-f001"/></fig><fig id="F2" position="float"><label>Fig. 2</label><caption><p>Figure 2. (A) Murine phagocytic cells were scored using the “Okumura inflammatory response LPS” gene set and the ‘summed up’ function. The histogram shows that by increasing the size of the neighborhood, the gene set score distributions separate between treated and untreated groups. The AUC was improved from 0.95 to 1.0 with smoothing. (B) UMAP plot of the cells in (A).</p></caption><graphic xlink:href="EMS158008-f002"/></fig><fig id="F3" position="float"><label>Fig. 3</label><caption><p>Figure 3. Endothelial cells from mice who received spinal injuries show a response to hypoxic environment. Scores are shown from no smoothing and smoothing with 32 neighbors using two methods, rank biased overlap (RBO) and single sample GSEA (ssGSEA). The AUC in predicting the cell label was improved with both scoring functions (0.62 to 0.71 for RBO and 0.69 to 0.80 for ssGSEA).</p></caption><graphic xlink:href="EMS158008-f003"/></fig></floats-group></article>