<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS157796</article-id><article-id pub-id-type="doi">10.1101/2022.11.27.518096</article-id><article-id pub-id-type="archive">PPR576830</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">2</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Prediction-error signals in anterior cingulate cortex drive task-switching</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Cole</surname><given-names>Nicholas</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Harvey</surname><given-names>Matthew</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Myers-Joseph</surname><given-names>Dylan</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Gilra</surname><given-names>Aditya</given-names></name><xref ref-type="aff" rid="A2">2</xref><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author" corresp="yes"><name><surname>Khan</surname><given-names>Adil G.</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><aff id="A1"><label>1</label>Centre for Developmental Neurobiology, King’s College London, London, UK</aff><aff id="A2"><label>2</label>Machine Learning Group, Centrum Wiskunde &amp; Informatica, Amsterdam, Netherlands</aff><aff id="A3"><label>3</label>Department of Computer Science, The University of Sheffield, Sheffield, UK</aff></contrib-group><author-notes><corresp id="CR1">Correspondence to Adil G. Khan: <email>khan.adil@kcl.ac.uk</email></corresp></author-notes><pub-date pub-type="nihms-submitted"><day>30</day><month>11</month><year>2022</year></pub-date><pub-date pub-type="preprint"><day>28</day><month>11</month><year>2022</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Task-switching is a fundamental cognitive ability that allows animals to update their knowledge of current rules or contexts. Detecting discrepancies between predicted and observed events is essential for this process. However, little is known about how the brain computes cognitive prediction-errors and whether neural prediction-error signals are causally related to task-switching behaviours. Here we trained mice to use a prediction-error to switch, in a single trial, between responding to the same stimuli using two distinct rules. Optogenetic silencing and un-silencing, together with widefield and two-photon calcium imaging revealed that the anterior cingulate cortex (ACC) was specifically required for this rapid task-switching, but only when it exhibited neural prediction-error signals. These prediction-error signals were projection-target dependent and were larger preceding successful behavioural transitions. An all-optical approach revealed a disinhibitory interneuron circuit required for successful prediction-error computation. These results reveal a circuit mechanism for computing prediction-errors and transitioning between distinct cognitive states.</p></abstract></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P2">Animals need to rapidly update their behaviour to survive in a changing environment, and such behavioural flexibility is studied experimentally using task-switching paradigms. Task-switching involves shifting between distinct cognitive rules or contexts, allowing flexible behaviour adapted to changing environmental demands <sup><xref ref-type="bibr" rid="R1">1</xref></sup>. The framework of predictive processing <sup><xref ref-type="bibr" rid="R2">2</xref>–<xref ref-type="bibr" rid="R4">4</xref></sup> provides a simple yet powerful way of describing flexible task-switching behaviour using three stages. First, animals maintain a previously learned prediction of what they expect to happen in the world at any given instant, i.e., a ‘model of the world’. Second, they may detect discrepancies between predicted and observed events, a ‘prediction error’. Third, the prediction error guides the updating of their model of the world and their ongoing behaviour. While this account has widespread support across humans, monkeys and rodents <sup><xref ref-type="bibr" rid="R2">2</xref>,<xref ref-type="bibr" rid="R5">5</xref>,<xref ref-type="bibr" rid="R6">6</xref></sup>, there is no clear link between the neural representations of prediction errors and their causal requirement in updating mental rules and subsequent behaviour.</p><p id="P3">There is evidence for cognitive prediction-error signalling in the prefrontal cortex (PFC) in tasks across humans, monkeys, and rodents <sup><xref ref-type="bibr" rid="R7">7</xref>–<xref ref-type="bibr" rid="R13">13</xref></sup>. The ACC in particular plays a central role in detecting the need for updating behavioural rules, and implementing the updated rules <sup><xref ref-type="bibr" rid="R7">7</xref>– <xref ref-type="bibr" rid="R10">10</xref>,<xref ref-type="bibr" rid="R14">14</xref>–<xref ref-type="bibr" rid="R25">25</xref></sup>. However, it is unclear how prediction-error signals are distributed across the cortex, how these signals are organised with respect to the projection targets of cortical neurons, and to what extent the amplitude of prediction-error responses is important in subsequent behaviour. Crucially, it is unclear whether prediction-error signals have any causal influence on the subsequent updating of an animal’s behavioural strategy. Finally, the inhibitory circuit basis for computing cognitive prediction errors is largely unknown.</p><p id="P4">Determining the neural basis of cognitive transitions is challenging because it requires experimental control over an animal’s internal model of the world. Animals need to demonstrably hold one rule in mind and transition to another distinct rule on noticing a violation of a prediction based on the current rule. Although animals can be trained on tasks which change or reverse rules in a block-wise manner <sup><xref ref-type="bibr" rid="R12">12</xref>,<xref ref-type="bibr" rid="R26">26</xref>–<xref ref-type="bibr" rid="R33">33</xref></sup>, these transitions typically involve several tens to hundreds of trials of intermediate performance, making it difficult to directly relate neural activity to an update of cognitive rules. One-shot block transitions provide a significant advantage in this regard. In one-shot block transitions <sup><xref ref-type="bibr" rid="R34">34</xref>,<xref ref-type="bibr" rid="R35">35</xref></sup>, a single error leads to a complete and persistent switch between distinct cognitive states. Thus, repeated one-shot block transitions within a session would allow directly relating neural prediction-error responses with the updating of mental rules.</p><p id="P5">The identification of temporally well-defined cognitive prediction errors would allow addressing a key question: What neural circuit compares predictions and observations to compute prediction errors? Computing prediction errors requires inhibition<sup><xref ref-type="bibr" rid="R2">2</xref></sup>, and distinct inhibitory cell classes with their specific connectivity patterns provide the basis for current models of prediction error circuits<sup><xref ref-type="bibr" rid="R36">36</xref></sup>. In particular, vasoactive intestinal peptide (VIP) expressing interneurons are crucial in shaping cortical activity<sup><xref ref-type="bibr" rid="R37">37</xref>–<xref ref-type="bibr" rid="R39">39</xref></sup> and provide unique computational opportunities through a disinhibitory motif involving somatostatin (SOM) expressing interneurons<sup><xref ref-type="bibr" rid="R40">40</xref></sup>. While VIP interneurons have been hypothesized to be a key player in prediction error computation<sup><xref ref-type="bibr" rid="R36">36</xref></sup>, directly testing this theory is challenging, as it would require measuring neural prediction errors while the activity of VIP interneurons is perturbed in animals performing a cognitive task. Importantly, any neural perturbation should not lead to a change in the task-switching behaviour itself, as this would confound any interpretation of the neural circuit consequences of the perturbation.</p><p id="P6">Here we studied the neural basis of cognitive prediction errors during task-switching in the mouse neocortex. We trained mice to perform largely one-shot block transitions triggered by cognitive prediction errors. The prediction error was an absence of an expected stimulus, allowing us to better isolate cognitive factors from reward and stimulus evoked factors <sup><xref ref-type="bibr" rid="R41">41</xref></sup>. Using behavioural modelling, widefield calcium imaging, and optogenetic silencing, we generated a cortex-wide map of prediction-error signals and established a specific role for the ACC in task-switching behaviour. Using two-photon imaging of the ACC we identified a population of prediction-error neurons and, crucially, established that the duration of the prediction-error signal corresponded with the requirement of the ACC in task-switching at timescales within and across trials. We finally use all-optical methods to bi-directionally modulate VIP interneuron activity and establish that VIP interneurons play a specific and causal role in the computation of prediction errors in the ACC. These results provide direct evidence for a causal role of prediction-error signals in the ACC in task switching, and identify a key inhibitory interneuron class required for cognitive prediction error computation.</p><p id="P7">The novelty of our findings is twofold, as described in detail below: First, no previous study has established a causal link between an identified neural prediction error signal and behavioural transitions. Second, we use this approach to identify an inhibitory interneuron class required for the successful computation of prediction-error signals. This provides the first experimental support for an inhibitory model of prediction-error computation in any cognitive task.</p></sec><sec id="S2" sec-type="results"><title>Results</title><p id="P8">We trained head-fixed mice to switch between blocks of discriminating two visual stimuli or discriminating two olfactory stimuli (<xref ref-type="fig" rid="F1">Figure 1A, B</xref>). During olfactory discrimination, a random subset (70%) of odour stimuli were preceded by the same visual stimuli, now irrelevant to the task. Mice repeatedly switched between attending to and accurately discriminating the visual stimuli (rule 1) and ignoring the same visual stimuli while accurately discriminating the odour stimuli (rule 2). Mice performed up to 15 behavioural switches, or block transitions per session (<xref ref-type="fig" rid="F1">Figure 1C</xref>, range 6 to 15, median 14 transitions across 13 sessions, 10 mice, one session per mouse shown. Number of trials per block, median ± IQR, 33±1 and 35±8 trials in visual and odour blocks respectively). Visual and odour stimuli were never presented simultaneously (<xref ref-type="fig" rid="F1">Figure 1B</xref>, <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 1</xref>).</p><sec id="S3"><title>One-shot cognitive task-switching behaviour</title><p id="P9">Our aim was to repeatedly capture the transition between two distinct and accurately applied task rules within a well-defined time period. Furthermore, to better separate cognitive processes from stimulus- or reward-evoked activity during the transition, we needed the block transitions to be inferred without any explicit stimulus or reward signal. Our task satisfied these requirements on the transitions from odour to visual blocks: mice noticed the absence of an expected odour stimulus (an odour prediction error) to switch their behaviour, and accurately responded to the now-relevant visual stimuli in subsequent trials (<xref ref-type="fig" rid="F1">Figure 1D-E</xref>). Thus, we focused on the transition from odour to visual blocks, triggered by the omission of an expected odour stimulus (but see below for visual to odour block transitions).</p><p id="P10">Animals typically require many trials to switch between blocks of distinct rules, transitioning through periods of intermediate performance <sup><xref ref-type="bibr" rid="R12">12</xref>,<xref ref-type="bibr" rid="R26">26</xref>–<xref ref-type="bibr" rid="R32">32</xref>,<xref ref-type="bibr" rid="R42">42</xref></sup>. This makes it difficult to precisely identify the behavioural and neural processes underlying a rule-switch. Optimal ‘one-shot’ transitions offer a significant advantage, since they involve animals switching between two accurately applied rules after a single error <sup><xref ref-type="bibr" rid="R34">34</xref>,<xref ref-type="bibr" rid="R35">35</xref></sup>. Most odour to visual block transitions in our task were indeed one-shot (<xref ref-type="fig" rid="F1">Figure 1D-F</xref>, 63.2% one-shot transitions, see Supplementary Movie 1 for an example). We used strict criteria to ensure that the one-shot block transitions captured a complete mental transition between two demonstrably applied rules (see <xref ref-type="sec" rid="S12">methods</xref>). A low probability of licking in response to irrelevant visual stimuli in the odour block led to a corresponding proportion of zero-shot block switches, or ‘fluke transitions’ (<xref ref-type="fig" rid="F1">Figure 1F</xref>, zero trial bin) which were removed from further analysis. The remaining transitions were dominated by one-shot transitions (<xref ref-type="fig" rid="F1">Figure 1F</xref> arrowhead) with a smaller fraction requiring two or more error trials.</p><p id="P11">To understand the processes underlying this rapid task-switching, we first fitted the behaviour to a basic reinforcement learning (RL) model (tabular SARSA, <xref ref-type="fig" rid="F1">Figure 1G</xref>, top) in which an agent continually updated its estimated value of licking in response to stimuli in each trial (the Q-value). This model was unable to reproduce the rapid block transitions observed in the data (<xref ref-type="fig" rid="F1">Figure 1H</xref>, top), and the best fit of learning and exploration rates produced slower block transitions (<xref ref-type="fig" rid="F1">Figure 1H</xref>, middle, see methods). We next built an RL model with a context belief state, hierarchically controlling subsequent choices (<xref ref-type="fig" rid="F1">Figure 1G</xref>, bottom). In this model the agent updated its belief about which context (or block) it was in by a context error signal. This model learnt two Q-value-tables for the distinct contexts, capturing the two rules of the task. Once the learning was complete, the agent was able to rapidly switch between these two Q-value-tables on accumulating a large enough context-error signal. This belief state model reproduced the rapid block transitions (<xref ref-type="fig" rid="F1">Figure 1H</xref>, bottom). Once the model had learnt the task, freezing all learning, i.e., Q-value updates, did not affect the block transitions (see <xref ref-type="sec" rid="S12">methods</xref>), demonstrating that switching between blocks did not involve any further learning. Instead, the agent inferred the block transitions using the context error. These results suggest that rapid task-switching behaviour involves transitioning between abstract representations of rules or contexts, driven by prediction errors.</p></sec><sec id="S4"><title>Map of prediction error signals</title><p id="P12">Which brain regions signal the prediction error at block transitions? We measured neural activity across the entire dorsal cortical surface using widefield calcium imaging (<xref ref-type="fig" rid="F2">Figure 2A</xref>) to identify the cortical regions which represent cognitive prediction-error signals at block transitions. Our task design provides a well-defined moment of prediction error at the odour to visual block transition: when, following the visual stimulus, an expected odour does not arrive (<xref ref-type="fig" rid="F1">Figure 1D</xref>). Any neural activity specific to this prediction error would be (1) absent in the final trials of the odour block when the odour was expected and actually delivered, (2) present when the odour was expected but absent (the prediction error), and (3) absent once again when the odour was no longer expected later in the visual block (schematic of the three conditions shown in <xref ref-type="fig" rid="F2">Figure 2B</xref>).</p><p id="P13">We aligned the hemodynamic-corrected and movement-corrected calcium activity to these three temporal epochs of odour onset, odour prediction error, and no odour predicted (<xref ref-type="fig" rid="F2">Figure 2b</xref>). The activity in these epochs evolved across the cortex over time, with higher activity apparent in the odour prediction-error condition (<xref ref-type="fig" rid="F2">Figure 2C</xref>, first three columns). We identified pixels at each time point which satisfied the criteria described above (see <xref ref-type="sec" rid="S12">methods</xref>) and mapped their activity (<xref ref-type="fig" rid="F2">Figure 2C</xref> final column, colour map represents t-statistic of comparison between first and second column). This revealed the precise spatio-temporal evolution of the prediction-error signal across dorsal cortex, which spread from anterior secondary motor regions to posterior parietal areas (average map from 1.2 to 2.7s shown in <xref ref-type="fig" rid="F2">Figure 2D</xref>). In particular, we found a strong prediction-error signal in areas superior to prefrontal cortex. Although the visual cortex and olfactory bulb showed robust sensory stimulus evoked responses to visual and odour stimuli respectively, they did not contain detectable prediction-error signals (<xref ref-type="fig" rid="F2">Figure 2D</xref>, averaged activity PSTHs shown in <xref ref-type="fig" rid="F2">Figure 2E</xref>). Together these results suggested that prefrontal cortical areas, not primary sensory areas, are involved in detecting the cognitive prediction error relevant for the rapid block transitions in this task.</p></sec><sec id="S5"><title>ACC is required for rapid block transitions</title><p id="P14">We next asked which specific region within prefrontal cortex was required for driving the task-switching behaviour. A number of studies have linked ACC activity to surprising events <sup><xref ref-type="bibr" rid="R9">9</xref>,<xref ref-type="bibr" rid="R42">42</xref></sup>, errors <sup><xref ref-type="bibr" rid="R10">10</xref>,<xref ref-type="bibr" rid="R23">23</xref></sup> or negative feedback <sup><xref ref-type="bibr" rid="R43">43</xref>,<xref ref-type="bibr" rid="R44">44</xref></sup>, which promote updating of behavioural policies <sup><xref ref-type="bibr" rid="R16">16</xref>,<xref ref-type="bibr" rid="R21">21</xref></sup>, or promote control <sup><xref ref-type="bibr" rid="R15">15</xref></sup>. In addition, the prelimbic (PL) cortex has been implicated in task-switching behaviour <sup><xref ref-type="bibr" rid="R45">45</xref></sup>. If prediction-error signalling in the ACC or PL is required for rapid task-switching, silencing these regions should disrupt the behaviour specifically at block transitions. To test this, we optogenetically silenced the ACC or PL bilaterally for the entire behavioural session in a group of mice (<xref ref-type="fig" rid="F3">Figure 3A</xref>). ACC silencing caused a strong deficit in switching from odour to visual blocks, when the mice needed to detect the absence of an expected odour to switch rules. Strikingly, with the ACC silenced, mice ignored the rewarded visual stimulus repeatedly in anticipation of an odour stimulus, reflecting the continuing application of the odour block rule (<xref ref-type="fig" rid="F3">Figure 3B</xref>). As a result, ACC silencing increased the number of trials taken to switch (<xref ref-type="fig" rid="F3">Figure 3C, D</xref>) and reduced the proportion of one-shot odour to visual block transitions (<xref ref-type="fig" rid="F3">Figure 3D, E</xref>). This was also the case when silencing the ACC using bilateral infusions of the GABA-A receptor agonist muscimol (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2C</xref>). The belief-state RL model could fit the ACC silencing data with the prediction-error signal reduced by a factor of 0.22, suggesting that the task-switching deficit could be explained by a partial reduction in the ACC prediction-error signal (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2D</xref>). These results demonstrate that the ACC is required for processing the omission of an expected event, a prediction error, during task-switching.</p><p id="P15">Interestingly, silencing PL in the same mice did not affect switching behaviour (<xref ref-type="fig" rid="F3">Figure 3C</xref>). Although we observed a cognitive prediction-error signal across a substantial portion of frontal cortex in our widefield experiment (<xref ref-type="fig" rid="F2">Figure 2D</xref>), the absence of any behavioural effect of silencing PL, adjacent to the ACC, reveals a striking specificity in the role of the ACC. These results indicate that the ACC has a specific role in rapidly updating behavioural rules or contexts within seconds, and this role is not widely shared with other prefrontal areas.</p><p id="P16">While the ACC is required for rapidly switching between task rules, does its role extend to applying these task rules once the animal has switched blocks? We found that even during continuous ACC silencing, once the mice did spontaneously switch from ignoring to discriminating the visual stimuli, the subsequent accuracy of visual discrimination was only slightly lower from unsilenced sessions (<xref ref-type="fig" rid="F3">Figure 3F</xref>). This suggests that the ACC plays a critical role in transitioning between task rules, and less so in maintaining these rules.</p><p id="P17">In addition to rapid task-switching, the ACC has been implicated in guiding slower learning processes <sup><xref ref-type="bibr" rid="R46">46</xref>–<xref ref-type="bibr" rid="R48">48</xref></sup>. We optogenetically silenced the ACC in a subset of mice as they first learned the switching task and found no difference relative to controls in either the rate of learning a novel stimulus-reward association, or learning to ignore irrelevant stimuli <sup><xref ref-type="bibr" rid="R49">49</xref></sup> (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2G</xref>). Thus, in this paradigm, the role of the ACC is specific to rapid task-switching and does not extend to slower learning.</p><p id="P18">Overall, these results established that the ACC is essential for rapid task switching driven by a cognitive prediction error. However, ACC projections become dispensable when task demands are reduced in an attentional task <sup><xref ref-type="bibr" rid="R50">50</xref></sup>. We asked if a similar result was true in task-switching behaviours, that is, if an animal could overcome the inhibition of the ACC if the block transition was marked by a more salient event than the absent expected odour. The opposite direction of block transition in our task, from visual to odour blocks, was marked by the unexpected arrival of an odour, a more salient prediction error. Most visual to odour block transitions (60%) were also one-shot (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3A, B</xref>) and were captured well by the belief-state RL model (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3C</xref>). Interestingly, silencing the ACC had no effect on the switching behaviour in these visual to odour block transitions (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3D-F</xref>). Thus, when task demands are reduced by using a highly salient event to mark block transitions, the ACC may become dispensable in task switching, similar to attentional tasks. Our study, however, focused on the odour to visual block transitions, which relied on the ACC.</p></sec><sec id="S6"><title>Prediction-error signals in ACC neurons</title><p id="P19">Since block transitions were typically complete within a single trial, this also meant that the neural activity in the ACC required for the block transitions must be present within the few seconds between the prediction error (absent predicted odour) and the next visual stimulus (<xref ref-type="fig" rid="F1">Figure 1D</xref>). We therefore asked what neural signals in the ACC during this period may account for its role in rapid block transitions. We recorded the activity of populations of ACC neurons during the behaviour using chronic two-photon calcium imaging through a microprism (<xref ref-type="fig" rid="F4">Figure 4A</xref>, <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 4A</xref>). As expected, we found that individual ACC neurons responded to many task-related variables. Subsets of neurons responded to visual and odour stimuli, locomotion onsets, reward delivery and licking (<xref ref-type="fig" rid="F4">Figure 4B, C</xref>). A binary classifier was able to accurately decode the identity of visual and odour stimuli after stimulus onsets from ACC neural population activity, and was further able to decode the block type both before and after stimulus onsets (<xref ref-type="fig" rid="F4">Figure 4D</xref>). Thus, ACC contained diverse signals relevant to the ongoing task.</p><p id="P20">To identify neurons representing prediction errors, we asked if a neuron showed responses which were (1) absent in the final trials of the odour block (2) present during the odour prediction error, and (3) absent once again when the odour was no longer expected later in the visual block (<xref ref-type="fig" rid="F4">Figure 4E</xref>, the same criteria as used in the widefield data). We found neurons in the ACC that satisfied these criteria, which we termed ‘prediction-error neurons’. <xref ref-type="fig" rid="F4">Figure 4F</xref> shows an example prediction-error neuron which was suppressed in trials when the expected odour did arrive, but responded strongly during the odour prediction error (when an odour was expected but did not arrive), and was not responsive later when an odour was no longer expected (see also <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 4B</xref>). Importantly, the prediction-error signal is a response to the non-occurrence of an expected stimulus, not a stimulus onset or offset, ensuring that the response originates from a violated stimulus expectation.</p><p id="P21">The average of all prediction-error neurons positively activated by the prediction error is shown in <xref ref-type="fig" rid="F4">Figure 4G</xref>. The percentage of all recorded neurons which showed any prediction-error responses was 9% (<xref ref-type="fig" rid="F4">Figure 4H</xref>). This group contained neurons with a positively activated response to the prediction error (<xref ref-type="fig" rid="F4">Figure 4F</xref>, g, 27% of prediction-error neurons), as well as a similar number of neurons with an inhibited response to the prediction error (30% of prediction-error neurons, <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 5A</xref>) and other combinations of activity profiles. Response inhibition by the arrival of the expected odour occurred for both rewarded and non-rewarded odours, suggesting that these neurons did not reflect a simple negative reward signal (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 5B</xref>). Crucially, changes in running and licking could not account for the identification of prediction-error neurons (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 5C, D</xref>).</p><p id="P22">To investigate whether prediction-error neurons were found widely across the brain, we conducted the same experiment using two-photon calcium imaging to record activity in the primary visual cortex (V1) (<xref ref-type="fig" rid="F4">Figure 4I</xref>, left). Consistent with the widefield calcium imaging results, our findings revealed a near absence of prediction-error neurons in V1 (<xref ref-type="fig" rid="F4">Figure 4I</xref>, right). This corroborated the widefield imaging results and, importantly, confirmed that our identification of prediction-error neurons in the ACC was statistically reliable.</p><p id="P23">We also studied the opposite direction of block transition, from visual to odour blocks, which was marked by the unexpected arrival of an odour stimulus. We again found prediction-error neurons in the ACC which responded differently to the unexpected odour, compared to the same odour when expected, or no odour (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 6A, B</xref>, similar proportions of prediction-error neurons were obtained when controlling for running and licking behaviours, data not shown). Crucially, however, we obtained a similar proportion of these neurons in V1 (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 6C</xref>). Thus, prediction-error neurons signalling an unexpected appearance of an odour are found both within and outside prefrontal cortex, consistent with the finding that the ACC is not necessary for this direction of transition (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3d-f</xref>). Interestingly, neurons which represented both directions of prediction error were present at a higher proportion than expected by chance (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 6D</xref>), suggesting the presence of generalist, in addition to specialist prediction-error neurons in the ACC.</p></sec><sec id="S7"><title>Striatal projections in the ACC exclude prediction errors</title><p id="P24">Prediction-error neurons may broadcast their activity widely across the brain, or they may be enriched or excluded from populations based on their projection target. We distinguished between these two scenarios in the same mice by selectively labelling the sub-population of ACC neurons which projected to the striatum, a major projection target of the PFC <sup><xref ref-type="bibr" rid="R51">51</xref></sup>. CTB-Alexa647 injections in the striatum identified striatal-projection neurons in the ACC (<xref ref-type="fig" rid="F4">Figure 4J</xref>), and non-retrolabelled neurons were enriched for non-striatal projecting neurons. Although striatal projecting neurons had mostly overlapping response properties with non-striatal projection neurons (<xref ref-type="fig" rid="F4">Figure 4K</xref>, <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 5E, F</xref>), they contained a significantly smaller proportion of prediction-error neurons (<xref ref-type="fig" rid="F4">Figure 4L</xref>, Chi-squared test of proportion P = 0.0015, striatal projecting prediction-error neurons = 21/410, 5%, non-striatal projecting prediction-error neurons = 463/4888, 9%). This lower proportion of striatal projecting prediction-error neurons was outside the 99% confidence intervals of the non-striatal projecting prediction-error neurons (<xref ref-type="fig" rid="F4">Figure 4M</xref>, bootstrap test). Thus, prediction-error responses in the ACC are not indiscriminately broadcast, but are significantly excluded from a major projection target.</p></sec><sec id="S8"><title>Prediction-error signals in the ACC coincide with effective silencing and un-silencing epochs</title><p id="P25">Having identified prediction-error neurons in the ACC, we next asked whether the duration of the neural prediction-error signal corresponded to the duration of causal involvement of the ACC in the task. We first asked how sustained the prediction-error response was within an individual trial. We focused on all ACC neurons with a positive prediction-error response and found that their response peaked soon after the time of expected odour onset, but remained significantly higher than both its baseline and the actual odour response until the beginning of the next trial (<xref ref-type="fig" rid="F5">Figure 5A</xref>, Wilcoxon signed-rank test prediction-error response vs baseline aligned to prediction error and next stimulus P = 2.98x10<sup>-15</sup>, P = 3.34x10<sup>-8</sup> respectively, prediction-error response vs odour response, P = 1.69x10<sup>-28</sup>, P = 5.45x10<sup>-15</sup> respectively). Indeed, this corresponded to the duration of the requirement of the ACC in the task, since silencing the ACC both during the ITI and peri-stimulus period on each trial (<xref ref-type="fig" rid="F5">Figure 5B</xref>) caused significant deficits in the switching behaviour, although each to a smaller degree than continuous silencing (<xref ref-type="fig" rid="F3">Figure 3C</xref>). Thus, ACC activity is required not only around the moment of expectation violation, when the largest prediction-error responses are present, but remains important until the start of the next trial as the animal updates its belief about the current rule.</p><p id="P26">Is the ACC required for multiple trials as a block transition occurs? To address this question, we first asked how sustained the prediction-error response in the ACC was across consecutive trials. We found that the prediction-error response was present only on the first prediction-error trial, and rapidly decayed to non-significant amplitudes on subsequent trials (<xref ref-type="fig" rid="F5">Figure 5D</xref>). If the ACC indeed enables block transitions through prediction-error signalling, the rapid decay of the prediction-error signal over trials would predict that the ACC is only required during the prediction-error trial, and not earlier or later. To directly test this prediction, we continuously silenced the ACC for the entire session and unsilenced it only on the first trial of a visual block when the prediction error occurs (<xref ref-type="fig" rid="F5">Figure 5E</xref>). The resulting behaviour showed no deficits in task switching, and mice rapidly switched between blocks (<xref ref-type="fig" rid="F5">Figure 5F</xref>, bottom, <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2E</xref>). Interestingly, the speed of behavioural switching in the un-silencing condition was significantly faster than controls, possibly due to enhanced ACC activity from the removal of inhibition (see also <xref ref-type="fig" rid="F6">Figure 6</xref>). Critically, after switching to the new block, the mice performed highly accurate discrimination for the rest of the block despite the ACC being continuously silenced (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2F</xref>). The rapid task switching could not be accounted for by a startle response to the light offset, since the mice did not lick in response to the light offset, or the visual stimulus immediately following the light offset (middle row in <xref ref-type="fig" rid="F5">Figure 5E</xref>), but instead licked in response to the subsequent visual stimulus, after the odour prediction error. Thus, the ACC is specifically required only for processing the prediction error and is thereafter no longer required for accurate task performance. These results provide direct evidence for prediction-error signals in the ACC driving task-switching <sup><xref ref-type="bibr" rid="R2">2</xref>,<xref ref-type="bibr" rid="R4">4</xref></sup>, and are consistent with a prominent theory suggesting that the PFC largely signals the non-occurrence of expected outcomes <sup><xref ref-type="bibr" rid="R52">52</xref></sup>.</p></sec><sec id="S9"><title>Larger prediction-error signals in ACC precede successful one-shot block transitions</title><p id="P27">Finally, to determine whether prediction-error neurons in the ACC actively contribute to the behavioural transitions across blocks, we asked if the amplitude of prediction-error responses at block transitions was related to the subsequent success in behavioural switching. We divided the odour to visual block transitions into one-shot and slower than one-shot block transitions (<xref ref-type="fig" rid="F6">Figure 6A</xref>, N = 51% one-shot and 49% slower transitions). Prediction-error neurons with a positive response were more active preceding one-shot block transitions, compared to slower transitions (<xref ref-type="fig" rid="F6">Figure 6B</xref>) when aligned to the prediction-error event (Wilcoxon signed-rank test, P = 0.0003) and also when aligned to the next stimulus onset (P = 0.019, N = 146 neurons). This result was also true when combining all prediction-error neurons (P = 8.57x10<sup>-9</sup>, N = 616 neurons). This result could not be accounted for by differences in running speed across the two conditions (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 7A</xref>). The pupil diameter also did not show significant differences between the one-shot and slower block transitions, and largely reflected running speed changes (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 7B</xref>).</p><p id="P28">Since our belief-state RL model of the behaviour included an explicit context-prediction-error signal, we asked if this signal also predicted one-shot block transitions across contexts. The model revealed a similar pattern, where the amplitude of the noisy prediction-error signal was predictive of future one-shot transitions (<xref ref-type="fig" rid="F6">Figure 6C</xref>, Wilcoxon rank sum test, P &lt; 10<sup>-8</sup>, N = 70 transitions). These results support the claim that prediction-error neurons in the ACC play a key role in driving rapid task-switching behaviour, particularly when they produce larger prediction-error signals.</p></sec><sec id="S10"><title>VIP interneurons contribute to prediction-error computation in the ACC</title><p id="P29">Local inhibitory circuits are crucial in shaping cortical activity<sup><xref ref-type="bibr" rid="R53">53</xref></sup>, and are believed to be necessary for computing prediction errors<sup><xref ref-type="bibr" rid="R2">2</xref></sup>. These circuits need to compare predictions and observations, with a mismatch between the two leading to prediction-error signals. While a diversity of inhibitory circuits may compute prediction-errors,<sup><xref ref-type="bibr" rid="R36">36</xref></sup> VIP interneuron disinhibition<sup><xref ref-type="bibr" rid="R37">37</xref>–<xref ref-type="bibr" rid="R39">39</xref></sup> is hypothesized to be key in this process<sup><xref ref-type="bibr" rid="R36">36</xref></sup> (<xref ref-type="fig" rid="F7">Fig 7A</xref>). Indeed, VIP driven disinhibition interacts with a perceptual prediction error during visuo-motor coupling mismatch in V1<sup><xref ref-type="bibr" rid="R54">54</xref></sup>. We asked whether VIP interneurons played a role in producing cognitive prediction-error responses in the ACC in our task. We employed an all-optical approach, where we photoactivated or photoinhibited VIP interneurons while simultaneously measuring the activity of VIP and non-VIP neurons in the same brain region with in-vivo two-photon calcium imaging (<xref ref-type="fig" rid="F7">Figure 7A, B</xref>). Importantly, the VIP perturbations were in one hemisphere only, and did not lead to any changes in the task-switching behaviour itself (Wilcoxon signed-rank test comparing behavioural d’ for the relevant visual stimuli, irrelevant visual stimuli, and odours between control and ITI VIP activation or inhibition sessions, all Ps &gt; 0.05, similar Wilcoxon signed-rank test comparing the number of trials to switch between blocks all Ps &gt; 0.05).</p><p id="P30">On photoactivating VIP cells in the ACC in passive mice with increasing light powers (<xref ref-type="fig" rid="F7">Figure 7C</xref> bottom, inset), we observed monotonically increasing population activity in non-VIP cells (<xref ref-type="fig" rid="F7">Figure 7C</xref>). Since non-VIP cells in cortex are predominantly excitatory pyramidal neurons, this experiment demonstrated the effective disinhibition induced by our all-optical approach. We next photoactivated VIP cells in the ACC as mice performed the task-switching behaviour. VIP cells were photoactivated on each trial only during the inter-trial-interval (ITI) period, which encompassed the prediction-error event at block transitions (<xref ref-type="fig" rid="F7">Figure 7D</xref>). We compared the proportion of prediction-error neurons in the VIP photoactivation sessions to control sessions and found that VIP activation during the ITI period strongly reduced the percentage of prediction-error neurons from 10% to 2% (<xref ref-type="fig" rid="F7">Figure 7E</xref>, Chi-squared test of proportion P &lt; 0.0001). To determine how VIP photoactivation affected the response of ACC neurons to prediction-errors, we measured the average response amplitude to the odour prediction-error event, and odour stimulus, from positively responding prediction-error neurons (<xref ref-type="fig" rid="F7">Figure 7F</xref>). We found that VIP photoactivation led to a significant reduction only in the response to the odour prediction-error, demonstrating that VIP photoactivation limits the prediction-error response amplitude (<xref ref-type="fig" rid="F7">Figure 7F</xref> bottom). Critically, we confirmed that our VIP activation did not lead to widespread deficits in ACC responses, since our perturbation did not affect representations of stimuli and block rules. A binary classifier as used in <xref ref-type="fig" rid="F4">Figure 4D</xref> was able to accurately decode the identity of visual and odour stimuli after stimulus onsets and the block type before and after stimulus onsets, both when VIP cells were photoactivated during the visual stimulus onsets (<xref ref-type="fig" rid="F7">Figure 7G</xref>) and during the ITI period (data not shown). Thus, inducing disinhibition through VIP interneuron activation specifically and heavily disrupted prediction error signalling in the ACC.</p><p id="P31">Finally, to prove their necessity in generating prediction error responses in the ACC, we optogenetically silenced VIP interneurons during the task. VIP inhibition during the ITI period strongly reduced the percentage of prediction-error neurons from 5% to 0.6% (<xref ref-type="fig" rid="F7">Figure 7H</xref>, Chisquared test of proportion P &lt; 0.0001). Again, a binary classifier was able to accurately decode visual and odour stimuli and block type, both when VIP cells were photoinhibited during the visual stimulus onsets (<xref ref-type="fig" rid="F7">Figure 7I</xref>) and during the ITI period (data not shown). Crucially, light-only control mice which did not express any opsin showed no change in the proportion of prediction-error neurons detected on presentation of the same optogenetic light (<xref ref-type="fig" rid="F7">Figure 7J</xref>, 3.6% to 4.3%, Chi-squared test of proportion P = 0.46). Together, these results demonstrate that bidirectional perturbation of VIP interneurons strongly and specifically disrupts prediction-error computations in the ACC. Future work may test the role of other cell classes such as PV interneurons, and the sources of prediction and observation signals in this computation (<xref ref-type="fig" rid="F7">Figure 7A</xref>).</p></sec></sec><sec id="S11" sec-type="discussion"><title>Discussion</title><p id="P32">In this study we demonstrate that mice can perform rapid and repeated block transitions in a cross-modal task switching paradigm. A theoretical RL model suggested that this behaviour was driven by a cognitive prediction-error signal, and in agreement with this prediction, we identified a neural signal which represented a cognitive prediction error in the ACC. Silencing and un-silencing the ACC in precise time windows demonstrated that this neural prediction-error signal was causally required for the mouse to update its behaviour between blocks. The amplitude of the prediction-error signal preceding a trial was related to whether or not a mouse would correctly switch its behaviour in the subsequent trial. Finally, VIP interneurons were identified as a key inhibitory cell class in the computation of cognitive prediction errors. Taken together, our results provide causal and mechanistic evidence for a longstanding idea, that the ACC computes cognitive prediction errors to guide flexible behaviour.</p><p id="P33">By training mice to perform repeated one-shot block transitions, we encapsulated a complete cognitive switch in a well-defined time window of a few seconds. Such rapid and complete cognitive transitions are akin to ‘Aha! moments’, where some information or insight allows an abrupt updating of one’s internal model of the world <sup><xref ref-type="bibr" rid="R55">55</xref></sup>. These rapid cognitive transitions are difficult to study experimentally – one-shot transitions have primarily been observed in primates <sup><xref ref-type="bibr" rid="R34">34</xref>,<xref ref-type="bibr" rid="R35">35</xref></sup>, and previous studies in rodents required tens to hundreds of trials to complete a behavioural transition <sup><xref ref-type="bibr" rid="R12">12</xref>,<xref ref-type="bibr" rid="R26">26</xref>–<xref ref-type="bibr" rid="R32">32</xref>,<xref ref-type="bibr" rid="R42">42</xref></sup>. Periods of intermediate accuracy which accompany these slower transitions prevent unambiguously relating a neural signal to its behavioural consequence. In our task, a well-defined prediction error leads to a demonstrable update in the animal’s cognitive model in the next few seconds. Moreover, when studying the moment of cognitive transition, multiple block transitions are required in a single session for sufficient statistical power. In addition, to be certain of an animal’s internal model of the world requires that the animal performs at high accuracy in the given task before the block transition, typically resulting in longer and fewer blocks. Our task provided an unprecedented number of repeated, highly rapid block transitions with mice switching between high accuracy behaviours, which was crucial for conclusively assigning a behaviourally relevant role to the neural prediction-error signal.</p><p id="P34">Cognitive prediction errors are distinct from prediction-error signals in other domains, such as reward prediction errors in dopaminergic neurons, sensory prediction errors in sensory cortex, or sensorimotor prediction errors in the cerebellum <sup><xref ref-type="bibr" rid="R2">2</xref>,<xref ref-type="bibr" rid="R56">56</xref>–<xref ref-type="bibr" rid="R59">59</xref></sup>. Cognitive prediction errors enable flexible cognition, where one needs to maintain an abstract cognitive context or model of the world in mind, which is updated when a prediction from the cognitive context or model is violated. This is a distinct problem to solve compared to other prediction-error computations and involves different brain regions <sup><xref ref-type="bibr" rid="R9">9</xref></sup>. Critically, the prediction-error responses we found in this study did not resemble classical negative reward signals such as those found in dopaminergic neurons. Instead, this signal resembles an outcome prediction error <sup><xref ref-type="bibr" rid="R52">52</xref></sup> which relates to errors in predicting outcomes based on the currently believed rules of the task.</p><p id="P35">The computation of a prediction-error signal in our task requires comparing an internally generated prediction signal with an external odour signal. The origin of the odour prediction signal is currently unclear, and may reach the ACC from other prefrontal areas <sup><xref ref-type="bibr" rid="R11">11</xref>,<xref ref-type="bibr" rid="R60">60</xref>–<xref ref-type="bibr" rid="R62">62</xref></sup>. However, the ACC itself robustly represents the ongoing task rules as well as external stimuli, and thus may compute the prediction error autonomously.</p><p id="P36">An important goal in understanding the neural circuit basis of cognition is to identify the circuit which compares predictions with observations. While this circuit has been studied in other contexts, such as for the dopaminergic reward-prediction system<sup><xref ref-type="bibr" rid="R57">57</xref></sup> or the visuomotor mismatch system<sup><xref ref-type="bibr" rid="R56">56</xref></sup>, it is poorly understood for cognitive rule-updating. In this study we took advantage of a temporally well-defined cognitive prediction-error signal to take the first steps in uncovering the circuit involved. We found VIP-driven disinhibition to be key, and expect future studies to reveal further details about the role of other inhibitory cell classes in this circuit.</p><p id="P37">The recurrently connected nature of cortical circuits may suggest that perturbation of any cell class will invariably lead to a disruption of processing in that region. However, VIP modulation can be orthogonal to cognitive modulations in other cortical regions<sup><xref ref-type="bibr" rid="R63">63</xref></sup>, and importantly, here we show that VIP perturbations in the ACC did not affect stimulus and context representations, while disrupting prediction-error signals.</p><p id="P38">Other cortical association areas may play a role in task switching, such as orbitofrontal cortex <sup><xref ref-type="bibr" rid="R12">12</xref>,<xref ref-type="bibr" rid="R27">27</xref></sup> and posterior parietal cortex <sup><xref ref-type="bibr" rid="R64">64</xref></sup>, as well as subcortical areas including higher-order thalamic nuclei <sup><xref ref-type="bibr" rid="R65">65</xref></sup>. Future work understanding the role of these and other regions, would need to establish both the nature of the prediction-error signal and its requirement in behaviour. Although we have ruled out a role for PL in our task, earlier studies have shown that PL circuits are involved in flexible behaviour <sup><xref ref-type="bibr" rid="R45">45</xref>,<xref ref-type="bibr" rid="R66">66</xref>.</sup> However, these studies investigated slower forms of behavioural transitions, compared to our largely one-shot transitions, possibly accounting for the difference with our results. Indeed, there are multiple types of surprise signals which may be processed differentially by different brain regions <sup><xref ref-type="bibr" rid="R9">9</xref>,<xref ref-type="bibr" rid="R67">67</xref></sup>.</p><p id="P39">Where is the prediction-error signal sent to in order to drive the behavioural changes? We have found that the striatum is an unlikely candidate, despite being a major projection target of the ACC, since the prediction-error signal is under-represented in ACC neurons projecting to the striatum. Other likely brain regions may include the locus coeruleus, which has been implicated in updating current strategies through norepinephrine signalling <sup><xref ref-type="bibr" rid="R17">17</xref>,<xref ref-type="bibr" rid="R18">18</xref>,<xref ref-type="bibr" rid="R68">68</xref>,<xref ref-type="bibr" rid="R69">69</xref></sup>, or the dorsal raphe nucleus, which promotes behavioural flexibility through serotonin and glutamate signalling <sup><xref ref-type="bibr" rid="R70">70</xref>,<xref ref-type="bibr" rid="R71">71</xref></sup>.</p><p id="P40">Disruption of cognitive flexibility in humans may lead to excessive transitioning between attentional states in ADHD, or excessive persistence in one or a few repetitive behaviours in ASD <sup><xref ref-type="bibr" rid="R72">72</xref></sup>. However, the neural circuit basis of these conditions is poorly understood. Our results provide a crucial insight regarding the role of the ACC in transitioning between, rather than maintaining, cognitive states. Thus, atypical ACC activity patterns may contribute to excessive or insufficient cognitive transitions in humans, and a more detailed understanding of how ACC circuits produce and transmit prediction errors may provide insights to better understand these conditions.</p></sec><sec id="S12" sec-type="methods" specific-use="web-only"><title>Methods</title><p id="P41">All experimental procedures were carried out in accordance with the institutional animal welfare guidelines and licensed by the UK Home Office.</p><sec id="S13"><title>Surgical Procedures</title><p id="P42">For all surgeries, mice were anaesthetised using isoflurane, at 4% concentration for induction and at 0.5-1% for maintenance. Additional drugs were used to provide analgesia (Metacam 5mg/kg), anti-inflammatory effects (dexamethasone 3.8mg/kg), and to reduce mucus secretions (Atropine 0.08mg/kg). Eye-cream (Maxitrol) was applied to the eyes to prevent drying and body temperature was maintained at 37°C using a heating mat and rectal temperature probe (Harvard Apparatus). Injections of antibiotic (Betamox 120mg/kg) and analgesia (methadone hydrochloride 10mg/kg) were given before the withdrawal of anaesthesia, and further analgesia was given daily for 1-2 days during recovery of the animal.</p><p id="P43">For the two-photon imaging experiments, 10 VIP-Cre mice (C57BL/6-VIP<sup>tm1(cre)zjh</sup>, The Jackson Laboratory, strain # 010908, P42-49, 6 males and 4 females) were used. An additional 4 mice of the same genotype (1 male, 3 females) were used together with the imaging mice for behavioural analysis. A circular piece of scalp was removed and the underlying skull was cleaned. Small holes were drilled in the skull above injection sites, located using stereotaxic co-ordinates. Injections of a mixture of viruses expressing GCaMP7f (pGP-AAV9-syn-jGCaMP7f-WPRE, Addgene) and Cre-dependent ChrimsonR (pAAV5-syn-FLEX-rc[ChrimsonR-tdTomato], Addgene) were made in the anterior cingulate cortex (ACC, +0.9mm AP, -1.3 rising to -0.8mm DV) of either the left or right hemisphere (+/- 0.55mm ML), using glass pipettes and a pressure micro-injection system (Picospritzer III, Parker). An injection of Cholera Toxin Subunit B (recombinant) conjugated to Alexa Fluor 647 (ThermoFisher) was made in the striatum of the same hemisphere (+1.2mm AP, +/- 1.5mm ML, -2.5 rising to -2.0mm DV) to retrogradely label cells projecting to the striatum. 8 out of the 10 mice had good enough quality z-stacks in the ACC to visualise CTB-Alexa647 and were used to identify striatal projecting ACC neurons. 8 out of the 10 mice exhibited sufficiently consistent behaviour to study the effects of VIP photoactivation. For the VIP silencing experiments (<xref ref-type="fig" rid="F7">Figure 7H</xref>) 3 VIP-Cre mice were injected with a mixture of viruses expressing GcaMP7f (pGP-AAV9-syn-jGCaMP7f-WPRE, Addgene) and Cre-dependent ArchT (pAAV-FLEX-ArchT-tdTomato (AAV5), Addgene). For the light-only control experiments (<xref ref-type="fig" rid="F7">Figure 7J</xref>), an additional 3 VIP-Cre mice were injected with a mixture of viruses expressing GCaMP7f and Cre-dependent tdTomato (pAAV-FLEX-tdTomato (AAV1), Addgene).</p><p id="P44">A circular craniotomy (diameter = 3mm) was made above the ACC imaging site, with a centre 300µm posterior to ACC injections. A 1.5mm x 1.5mm x 1.5mm right-angled microprism with a reflective hypotenuse (Tower Optical) fixed to a glass coverslip using ultraviolet light-cured glue (Thorlabs) was slowly lowered into the craniotomy, with the vertical face closest to the injection site. The glass coverslip was fixed in place using cyano-acrylic glue (Loctite) and a custom machined aluminium head-plate was cemented onto the skull using dental cement (C&amp;B Superbond). Imaging and behavioural training started approximately three weeks after surgery.</p><p id="P45">For the widefield imaging experiments, four male wildtype mice (C57BL/6;129-<italic>Nrxn1</italic><sup><italic>tm1Sud</italic></sup>) from the ages of 21 to 27 weeks were used (all mice were wildtype C57BL/6). At least four weeks before surgery mice were given an intravenous injection of AAV PHP.eB GCaMP7f (Zurich vector core). For the surgery, the skin overlying the skull was removed and the edges of the skin were secured with tissue adhesive (Vetbond, 3M). The overlying connective tissue on the skull was removed and a layer of transparent dental cement (C&amp;B Superbond) was applied to cover all exposed skull and to secure a custom aluminium headplate. Following this 5 layers of 2.5ul of cyanoacrylate glue (Zap-A-Gap CA+, Pacer Technology) were thinly applied onto the cement to increase the transparency. After recovery from surgery for at least 5 days mice began habituation and behavioural training.</p><p id="P46">For the optogenetic silencing experiments, 8 transgenic mice (P42-49, 4 males and 4 females) expressing Channelrhodopsin-2 in parvalbumin-expressing interneurons were used, obtained by crossing FLEX ChR2 mice (Gt(ROSA)26Sor<sup>tm32(CAG-COP4*H134R/EYFP)Hze</sup>) and PV-Cre mice (Pvalb<sup>tm1(cre)Arbr</sup>, The Jackson Laboratory, strain # 204109 and # 017320 respectively). Two small holes were drilled above the ACC and prelimbic cortex (PL) of each hemisphere. Dual-core cannulae with bilateral optical fibres (Thorlabs), each with a diameter of 200µm and 0.39NA, cut to a length of &lt; 3mm, were implanted in the ACC (+0.9mm AP, -1.2mm DV, +/-0.35mm ML) and PL (+2.6mm AP,-1.25mm DV, +/- 0.35mm ML), and the stainless steel ferrules were bonded to the skull using dental cement (C&amp;B Superbond), along with a custom machined head-plate. PL implants were inserted at a 25° angle (relative to vertical) through holes drilled 0.8mm anterior to PL. We performed light-only control experiments by comparing 3 PV-Cre mice (1 male and 2 females) with 3 PV-Cre crossed with FLEX-ChR2 mice (1 male and 2 females), which were implanted with optical fibre cannulae above ACC only. After recovery from surgery for at least 5 days mice began habituation and behavioural training.</p></sec><sec id="S14"><title>Imaging</title><p id="P47">Two-photon imaging was performed using a custom-built resonant scanning two-photon microscope (Cosys) and a Chameleon Vision S laser (Coherent) at 930nm using a 16X, .8NA objective (Nikon). Images were acquired using a 12 KHz resonant scanner (Cambridge Technology) and an FPGA module (PXIe-7965R FlexRIO, National Instruments). Two-photon calcium imaging of GCaMP7f-labelled neurons in the ACC was performed across 40 training sessions and 48 full task-switching sessions in these 10 mice. The microprism depth, injection coordinates and cell morphology indicated that the imaging sites were largely located in layer 5. Multi-plane imaging was performed using a piezoelectric objective scanner (Physik Instrumente). Depending on the depth of GCaMP7f expression, each imaging volume consisted of either 6 or 8 imaging planes, 40µm apart, giving an effective imaging rate of 6.4 or 4.8Hz per volume respectively.</p><p id="P48">Mice were trained first in the visual discrimination task, then had at least 3 training sessions in the visual-odour block switching task. Once mice had learned the switching task, at least 3 recordings of the mice performing the task were taken per mouse. Before each recording session the same imaging site was found by matching anatomical landmarks.</p><p id="P49">After all in-vivo imaging data had been collected, a final high-quality image stack was acquired under anaesthesia. Subcutaneous injections of ketamine (100mg/kg) and xylazine (16mg/kg) were used to induce anaesthesia, with further injections of ketamine to maintain anaesthesia if necessary. Eye-cream (Maxitrol) was used to prevent drying, and body temperature was maintained using a heating pad.</p><p id="P50">Widefield imaging was performed on a custom built inverted tandem lens macroscope (Cosys), with two photographic lenses (AF-S NIKKOR 85mm f/1.8G lens and AF NIKKOR 50mm f/1.4D Lens). The brain was illuminated with interleaved collimated blue (470nm, Thorlabs M470L4) and violet light (405nm, Thorlabs M405L4) at an irradiance of ~0.03mW/mm<sup>2</sup>. Images were recorded with a CMOS camera (Point Grey Research Grasshopper3) at frame rate of 54Hz. LEDs and camera frame acquisition were triggered using a digital microprocessor (Teensy 3.2).</p><p id="P51">Widefield data was pre-processed using the methods described in <sup><xref ref-type="bibr" rid="R73">73</xref></sup>. The widefield video underwent motion correction and the brain images were aligned within and across mice by manual rigid alignment to a number of anatomical landmarks. The video data was compressed and denoised by performing SVD on the matrix of pixels × time and retaining the top 500 components. The ΔF/F was computed for each pixel by taking the difference between F and F0, and dividing by F0, where F0 was the mean value across the entire session. Traces were filtered with a 0.0033 Hz high-pass second order Butterworth filter, and an additional 7Hz lowpass filter was applied to the violet illumination trace. To correct for haemodynamic artefacts, a scaled version of the violet illumination trace was subtracted from the blue illumination trace for each pixel. This scaling factor was found by regressing the violet trace onto the blue trace. To account for overt movement-related brain activity, we fit a ridge regression model to the data, predicting brain activity from a number of movement regressors. These included a binarized lick trace, with lags up to 500ms as well as instantaneous running speed and average face motion energy. Running speed and face motion energy were divided by twice their standard deviation to ensure all regressors had approximately the same scale and were penalised equally by ridge regularisation. Ridge penalties were selected using fivefold cross-validation from 36 values spaced logarithmically between 10<sup>-2</sup> and 10<sup>5</sup> selecting the ridge penalty which resulted in the lowest cross validated mean squared error. Penalties were selected independently for each pixel. We then subtracted this predicted activity and all subsequent analysis was performed on the model residuals.</p></sec><sec id="S15"><title>Behavioural training</title><p id="P52">The behaviour apparatus and training was similar to previous studies <sup><xref ref-type="bibr" rid="R74">74</xref>,<xref ref-type="bibr" rid="R75">75</xref></sup>. Mice were trained on a visual discrimination task for up to two weeks, until discrimination performance reached threshold, before training them on the switching task (see below). Mice had free access to water but were food restricted to maintain at least 85% of their free-feeding body weight (typically 85-90%, 2-3g of standard food pellets per animal per day). A reward delivery spout was positioned near the snout of the mouse, and licks to this spout were detected using a piezo disc sensor and custom electronics. The reward was a 10% solution of soy milk powder (SMA Wysoy) delivered by opening a pinch valve (NResearch) controlled through custom electronics. The mouse’s running speed on the cylinder was measured using an incremental rotary encoder (Kübler). Two luminance-corrected monitors (luminance meter LS-100, Konica Minolta) positioned at 45° angles and 25cm distance to the mouse delivered visual stimuli.</p><p id="P53">Animals were habituated to handling and gentle restraint over two to three days, before they were head-fixed and trained to run on a polystyrene cylinder (20cm diameter) for one to four days. This period was also used to find suitable imaging sites. After the habituation phase, mice performed one behaviour session in which the movement of the gratings was linked to the mouse’s movement on the wheel. Subsequently, mice were trained to self-initiate trials by sustained running on the wheel for at least 2.8s and an added random duration drawn from an exponential distribution with mean 0.4s (trial structure and all timings shown in <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 1A</xref>). At this point one of two drifting sinusoidal visual gratings were randomly presented, drifting in the opposite direction to the direction of running, with a fixed spatial and temporal frequency of 0.1 cycles per degree and 2Hz respectively. The rewarded and unrewarded gratings were oriented +/-20° relative to vertical, symmetrically on both screens. When the rewarded grating was displayed the mouse could trigger the delivery of a reward, a drop of soya milk, by licking the spout during the ‘reward period’, lasting from 1.0s after the appearance of the grating to its disappearance, maximum 0.8 s into the reward period. This was recorded as a ‘hit’. In some sessions, the duration of the reward period started at 1.5s and lasted up to 1.53 seconds, no difference in behaviour was observed with this minor change in timings. The visual stimulus stayed on for an additional 0.8s after reward onset while the mouse consumed the reward. If the mouse did not lick during this period, the trial was recorded as a ‘miss’, and a drop of soy milk was delivered shortly before the disappearance of the grating. When the unrewarded grating was presented, a single lick or more at any time until the stimulus disappearance was recorded as a ‘false alarm’, triggering a time-out period of 4s in which the unrewarded grating remained on screen, and any further licks restarted the time-out. During early training the probability of unrewarded trials was occasionally increased transiently up to 0.8 to discourage erroneous licking. All mice learned the visual discrimination task in 5-10 days, with post-learning defined as three consecutive days of discrimination with a behavioural d-prime score of 2 or above. Behavioural d-prime was calculated as: <italic>bd’</italic> = Φ<sup>-1</sup> (<italic>H</italic>) - Φ<sup>-1</sup> (<italic>F</italic>), where Φ<sup>-1</sup> is the normal inverse cumulative distribution function, H is the rate of hit trials, and F is the rate of false alarm trials.</p><p id="P54">Once mice had learned the visual discrimination task, they were trained in odour discrimination. After the same randomised period of sustained running, one of two odour stimuli were presented to the mouse via a polyethylene tubing positioned above the snout of the mouse. Odours were delivered through a custom-built flow dilution olfactometer calibrated with a mini PID (Aurora) at 10-20% saturated vapour concentration of two solutions, 10% soy milk (rewarded odour) and 10% soy milk with 0.1% p-Cymene mixture (unrewarded odour). The odour task structure was identical to the visual task.</p><p id="P55">Once animals were discriminating the odours accurately (typically after 30-40 trials), they were trained to switch between blocks of the olfactory and visual discrimination task. Mice typically learned to switch successfully in 1-3 days. In the olfactory blocks, 70% of odour stimuli were preceded with one of the two same visual gratings featured in the visual discrimination task (fixed duration of 1.8s, with an identical onset delay distribution as in the visual block). In this instance neither grating was rewarded or punished, and mice learned to ignore these irrelevant gratings while accurately discriminating the odours, which were presented after the irrelevant visual grating (delay between visual grating offset and odour onset 1.8s (in some two-photon imaging sessions this delay was 1.8s plus an added random duration drawn from an exponential distribution with mean 0.2s). In initial switching training sessions, a reward was delivered at the end of a rewarded grating in a visual block if the mouse had failed to lick, giving a clear indication that the grating was now relevant. By the end of early training, and for all data in this paper except <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2F</xref>, this feature was removed, requiring mice to switch between blocks through noticing unexpected stimuli alone. Block switches occurred automatically when a mouse had demonstrated a &gt; 80% discrimination performance to the relevant stimuli (visual gratings in visual block, odours in odour block) over the last 30 trials of a block. Additionally in odour blocks mice were required to have successfully ignored all irrelevant visual gratings over the previous 10 trials before a block transition was triggered. Blocks typically contained 30 to 40 trials. Mice were deemed to have learned the switching task when they could complete sessions at these parameters with at least 3 repeats of each block type.</p><p id="P56">In order to compare the speed of behavioural switching between blocks, we applied a transition period immediately after a block transition where visual stimuli were selected according to the following rules. For odour to visual block transitions, in the first trials of a visual block only the rewarded grating (visual stim 1) was shown. When a mouse responded correctly by licking to these grating stimuli on three consecutive trials this transition period ended and the block continued with the normal 50% probabilities of visual grating identities. In the visual to odour block transitions, we applied two variations of the transition period. In the first variation, the first irrelevant visual stimulus was the otherwise unrewarded visual stimulus 2, ensuring that that the block transition was indicated by the unexpected appearance of an odour, rather than a reward prediction error. The subsequent irrelevant stimuli were visual stimulus 1, and the transition period ended when a mouse responded correctly by not licking to these irrelevant visual stimuli on three consecutive trials. Odour stimuli selection itself was kept random. In the second variation, even the first irrelevant visual stimulus was visual stimulus 1, and the subsequent rules were the same. We confirmed that mice switched equally fast in both variants of the task (Wilcoxon rank sum test, P &gt; 0.05). These transition periods were used in all behaviour sessions except muscimol silencing experiments (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2C</xref>) and light-only controls (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2B</xref>), in which case either visual stimulus was presented from the start of the block with 50% probability.</p></sec><sec id="S16"><title>Reinforcement learning model</title><p id="P57">We modelled the experimental protocol of stimuli, and rewards based on mouse actions, as a reinforcement learning environment. The environment was written in Python with the OpenAI Gym interface for ease of use with other agents. Code for, and experimental data used to train the models is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/adityagilra/BeliefStateRL">https://github.com/adityagilra/BeliefStateRL</ext-link>. The environment had 5 states, two for visual cues, two for olfactory cues and an end of trial cue, and two possible actions that the agent could perform, lick and no-lick. Each trial comprised a number of steps.</p><p id="P58">In a visual block, each trial had 2 steps: in step 1, a needless lick (to the previous end of trial) was punished (-1 assuming an internal cost), and one of 2 visual stimuli were shown; in step 2: a lick led to reward (+1 corresponding to soy milk drop) if visual cue 1 was presented, or punishment (-1 corresponding to experimental timeout) if visual cue 2 was presented, and the end of trial was indicated. In an olfactory block, a trial had 2 time steps in 30% of the trials, corresponding to trials without irrelevant visual stimuli, and 3 time steps in 70% of the trials, corresponding to trials with irrelevant visual stimuli. In the 2 time steps case, in step 1, a needless lick was punished (-1), and one of the 2 odour stimuli were given. In step 2, a lick led to reward (+1) if odour 1 was delivered, or punishment (-1) if odour 2 was delivered in step 1, and end of trial was indicated. In the 3 time step case, in step 1, a needless lick was punished (-1), and one of the 2 visual stimuli were shown. In step 2, a needless lick was punished (-1), and one of the 2 odour stimuli were delivered. In step 3, a lick led to reward (+1) if odour 1 was delivered, or punishment (-1) if odour 2 was delivered in step 2, and end of trial was indicated. No lick always led to 0 reward. Overall, a correct response for a trial in either block is defined as a lick for cue 1 or a no lick for cue 2 in the final reward step, while requiring no-lick in all other time steps. Block switches occurred using the same transition rules as in the experiment, described above.</p><p id="P59">Basic RL agent (Tabular SARSA algorithm): Each of the 2 visual and 2 olfactory cues, as well as the end-of-trial cue, was considered a state. The possible actions were lick and no-lick. A Q-value <italic>Q</italic>(<italic>s, a</italic>) table was constructed with entries for each combination of 4 states and 2 actions, denoted by <italic>s</italic> and <italic>a</italic>, initialized to zeros. The Q-value <italic>Q</italic>(<italic>s, a</italic>) represented the expected total reward till the end of the trial, given the cue <italic>s</italic> and taking action <italic>a</italic> at the current step. The Q-value for the end of trial cue was set to 0. As each cue <italic>s</italic> was encountered, the agent responded with an action <italic>a</italic> according to an ∈-greedy policy. i.e. a random action was taken with probability ∈, otherwise the action that yielded the maximum Q-value for the current cue <italic>s</italic> was taken. The Q-table was updated as per the SARSA (State-Action-Reward-State-Action) algorithm using the temporal difference (TD) error <disp-formula id="FD1"><mml:math id="M1"><mml:mrow><mml:mi>δ</mml:mi><mml:mo>≡</mml:mo><mml:mi>r</mml:mi><mml:mo>+</mml:mo><mml:mi>Q</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msup><mml:mi>s</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>a</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> multiplied by a learning rate <italic>α</italic> <disp-formula id="FD2"><mml:math id="M2"><mml:mrow><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>←</mml:mo><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:mi>δ</mml:mi></mml:mrow></mml:math></disp-formula></p><p id="P60">Cues <italic>s</italic>′, <italic>s</italic> and actions <italic>a</italic>′, <italic>a</italic> correspond to the current, previous time steps respectively.</p><p id="P61">Belief State RL agent: Two Q-value tables were constructed and initialized to zero, corresponding to the visual and olfactory blocks, each of size 4 states by 2 actions. The agent also had a belief <italic>b</italic> about being in a visual block <italic>v</italic> versus an olfactory block <italic>o</italic>, which was represented as a discrete probability distribution <italic>b</italic> ≡ (<italic>p</italic>(<italic>v</italic>), <italic>p</italic>(<italic>o</italic>)). At every step of the trial, the agent assumed that the current block was either visual or olfactory depending on which probability <italic>p</italic>(<italic>v</italic>) or <italic>p</italic>(<italic>o</italic>) was higher, and took an action according to an ∈-greedy policy based on the Q-table corresponding to the assumed block. This Q-table was updated similar to the basic agent using the TD-error <italic>δ</italic> multiplied by a learning rate α.</p><p id="P62">At the end of every trial, a block mismatch signal <italic>χ</italic> ≡ <italic>d</italic> − <italic>b</italic> was computed as the difference between the detected block <italic>d</italic> (represented as (1,0) or (0,1) for visual or olfactory block respectively depending on whether the cue just before the end of the trial was a visual or odor cue), and the agent’s belief <italic>b</italic>. A noise-corrupted version of this block mismatch signal <italic>χ</italic>′ = <italic>χ</italic>(1 + <italic>βξ</italic>) was computed, where <italic>ξ</italic> was a Gaussian random variable with mean 0 and variance 1, and <italic>β</italic> was a noise factor parameter. The agent’s belief was updated as: <disp-formula id="FD3"><mml:math id="M3"><mml:mrow><mml:msup><mml:mi>b</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:mi>b</mml:mi><mml:mo>+</mml:mo><mml:mi>ζ</mml:mi><mml:msup><mml:mi>χ</mml:mi><mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:math></disp-formula> where <italic>χ</italic>′ was multiplied by a belief switching rate <italic>ζ</italic>, and then each component of <italic>b</italic>′ was clipped to be greater than 0 and clipped <italic>b</italic>′ was normalized to yield a probability distribution <italic>b</italic> which served as the belief for the next trial. After training, updating of Q-value tables was turned off, and only belief updates were carried out.</p><p id="P63">Model fitting: Each model was simulated with learning via SARSA for <italic>N</italic>/2 time steps. After this training, we obtained simulated behaviour data for a further <italic>N</italic>/2 time steps, for fitting to experimental data of trained mice. For Basic RL model fitting, exploration and updation of Q-value tables via SARSA parametrized by <italic>∈</italic> and <italic>α</italic> were kept the same as during training. For Belief-state RL model fitting, Q-values were no longer updated i.e. α = 0 after training, only the belief state was updated, and exploration was kept on. We confirmed that keeping Q-value updating on after learning, at <italic>α</italic> = 0.1 as during training, did not have a noticeable effect on the results.</p><p id="P64">We minimized the root mean squared error (RMSE) between the experimental and simulated <italic>p</italic>(<italic>lick</italic>|<italic>cue</italic>). For all fits, we performed a global grid search within reasonable parameter ranges, followed by a local minimization starting from the best parameter sets obtained from the grid search. The fits were performed using 5-fold cross validation, where for each fold, we fit the parameters of the model to 4/5th of the data and tested on the held out 1/5th of the data. RMSE mean for each fold i.e. each training and test split was calculated across 5 seeds (2 with the first variation + 3 seeds with the second variation in a similar ratio as the number of experimental sessions on the two variations of the block transitions described above). To select between the models, the RMSE mean ± SD across these 5 folds, computed on the above RMSE mean across seeds, were reported and compared as below.</p><p id="P65">For the default basic RL model, we fit 2 parameters: exploration rate <italic>∈</italic> and the learning rate <italic>α</italic>. This model was unable to reproduce the rapid block transitions observed in the data, since both the exploration rate and the learning rate needed to be very high to rapidly explore actions and learn a different reward structure after a transition, but a high exploration rate was inconsistent with the steady-state experimental data. For the default belief-state RL model, we fit 4 parameters: belief switching rate <italic>ζ</italic>, the noise factor <italic>β</italic> for the prediction-error signal, exploration rate <italic>∈</italic>, and a different exploration rate <italic>∈</italic>′ to account for enhanced licking to visual cue 2 in the olfactory block. The learning rate <italic>α</italic> was fixed at 0.1 during training, but was set to zero for the fitted data, as the belief switching rate played a much stronger role in rapid switching between blocks. The RMSE mean ± SD on training and test splits were 0.157438 ± 0.004906 and 0.193520 ± 0.010869 for the default basic RL agent with 2 parameters, and 0.087012 ± 0.005060 and 0.137714 ± 0.014658 for the default belief-state RL with 4 parameters, leading us to choose the Belief-state RL model over the Basic one.</p><p id="P66">We also fitted a Basic RL model with 3 parameters: exploration rate <italic>∈</italic>, learning rate <italic>α</italic>, and independent exploration rate <italic>∈</italic>′ on receiving visual cue 2, which yielded RMSE mean ± SD on 5-fold training and test splits as 0.161927 ± 0.006923 and 0.197955 ± 0.011329. Further, we fitted a Belief-state RL model with 3 parameters: belief switching rate <italic>ζ</italic>, noise factor <italic>β</italic>, and a common exploration rate <italic>∈</italic>, which yielded RMSEs as 0.095403 ± 0.006537 and 0.143631 ± 0.015731. This shows that <italic>∈</italic>′, the enhanced exploration rate to visual cue 2, does not play a major role in selecting between Basic vs Belief-state RL models.</p><p id="P67">Simulated <italic>p</italic>(<italic>lick</italic>|<italic>cue</italic>) using the best fit parameters (on the full dataset) for each model for one seed are shown in <xref ref-type="fig" rid="F1">Figure 1G</xref> and <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3C</xref> middle and bottom. The prediction-error signal for one-shot versus slower switches made by the agent, shown in <xref ref-type="fig" rid="F6">Figure 6C</xref>, was computed as the sum of the absolute values of the two components of the prediction-error signal <italic>χ</italic> at the end of the first trial following the block transition. For each of both types of transitions, only 70 transitions were chosen randomly from the simulated data, similar to the number of transitions in the experimental data, for plotting and significance testing.</p><p id="P68">For fitting the behaviour during ACC silencing, which was a separate experimental dataset, first we fitted the default 4 parameters for the belief-state RL model on the behaviour data without ACC silencing. Then keeping these parameters fixed, we fitted the behaviour data with ACC silenced (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figs. 2d and 3f</xref>), using two parameters – factors on the prediction-error signal for odour and visual trials. These factors signified how much the prediction-error signal reduced on silencing the ACC.</p><p id="P69">Fitted parameters are shown in <xref ref-type="table" rid="T1">Table 1</xref>. Since these fits were not for model selection, all of the data was fit, minimizing mean RMSE across 5 seeds (both variations of the task included as described above).</p></sec><sec id="S17"><title>Imaging data analysis</title><p id="P70">Image stacks were corrected for motion, and regions of interest (ROIs) were selected for each active neuron in each session using Suite2p <sup><xref ref-type="bibr" rid="R76">76</xref></sup>. Each site yielded between 129 and 925 neurons, median = 499 neurons. Raw fluorescence time series F(t) were obtained for each neuron by averaging across pixels within each ROI. Baseline fluorescence F0(t) was computed by smoothing F(t) (causal moving average of 0.75s) and determining for each time point the minimum value in the preceding 60 s time window. The change in fluorescence relative to baseline, ΔF/F, was computed by taking the difference between F and F0, and dividing by F0.</p><p id="P71">To identify prediction-error neurons, we selected neurons which responded significantly differently to the odour prediction-error event when compared to both the expected arrival of the odour and when no odour was expected (<xref ref-type="fig" rid="F2">Figure 2B</xref>). We defined three epochs each lasting 1.5s and measured the average neural activity in these epochs: 1) Odour prediction-error trials, starting 2.0s after the offset of the first visual stimulus following a switch from an odour block to a visual block, provided the mouse did not already lick to the preceding visual stimulus (2.0s was the average delay in the imaging sessions from the visual stimulus offset to the odour stimuli onset). 2) Stable odour block trials from the end of the preceding odour block (when an odour is expected and received) aligned to the onset of the odour stimuli, following a correctly ignored visual grating. 3) No odour expected trials, when no odour is expected following a visual stimulus, 2.0s following the offset of an unrewarded visual stimulus. Trials were taken from subsequent visual block up to 10 trials before the end of the block. In epochs 2 and 3, we averaged up to 7 trials of each condition for each block transition (median 7 trials). We compared the neural activity in different epochs with a Wilcoxon rank-sum test with the the number of samples equal to the number of block transitions. Prediction-error neurons were defined as neurons with significantly different activity in odour prediction-error trials, when compared to both of the other conditions. We repeated the analysis without averaging multiple trials in epochs 2 and 3 and still obtained a significantly larger fraction of prediction-error neurons in the ACC compared to V1 (Chi-squared test of proportions P &lt; 0.0001). Similar criteria were used for the visual to odour block transitions. Positively and negatively responsive prediction-error neurons were those in which the response to the odour prediction error was largest or smallest of the three conditions respectively. Two other combinations were observed, first with the odour condition significantly higher and no odour condition significantly lower compared to the prediction-error condition (99 neurons), and second, the reverse of this (163 neurons). To test whether activity in prediction-error neurons could predict subsequent switching, average activity between 0-1.5s in odour prediction-error trials was compared between one-shot switches (in which the mouse responded correctly to the subsequent visual grating) and slower switches (in which the mouse continued to miss at least the next visual grating) using a Wilcoxon signed-rank test.</p><p id="P72">Decoding analysis (<xref ref-type="fig" rid="F4">Figure 4D</xref>, <xref ref-type="fig" rid="F7">7G, I</xref>) was performed by training a binary logistic regression classifier to decode the stimulus or block identity from the vector of ΔF/F values at each frame. Decoding performance was assessed using stratified 5-fold cross validation and taking the mean accuracy across the 5 test sets. Stimuli classes were evenly balanced by randomly subsampling the larger class. We applied an L2 regularisation penalty to reduce overfitting.</p><p id="P73">For identification of striatal projecting neurons, a brief dual channel recording of the imaging planes was acquired before each imaging session at an excitation wavelength of 830nm. Following segmentation, imaged neurons co-expressing Alexa-647 were identified using this recording, and confirmed using a detailed anesthetised dual channel z-stack taken at the end of all imaging sessions. To calculate confidence intervals for the percentage of prediction-error neurons in the non-striatal projecting ROIs (<xref ref-type="fig" rid="F4">Figure 4M</xref>) a percentile bootstrap method was used, resampling with replacement a number of ROIs equivalent to the size of the striatal projecting ROI population 10,000 times. The proportion of prediction-error neurons was then calculated and the 0.5<sup>th</sup> and 99.5<sup>th</sup> percentiles of this distribution of proportions was calculated to obtain the 99% confidence interval.</p><p id="P74">To assess the proportion of neural activity which was attributable to overt behaviour recorded during our task (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 5C, D, E</xref>) a linear model was fit using ridge regression to predict neural activity. The model was constructed by combining multiple sets of variables into a design matrix, to capture signal modulation by the following different task or behavioural events: 2 visual stimuli, 2 odour stimuli, reward delivery, licks, running speed, block type, and an interaction term for visual stimuli and block type. Each stimulus/event variable was structured to capture a time-varying event kernel. Variables therefore consisted of a vector of the relevant stimulus/event, and copies of this vector, each shifted in time by one frame for specific durations. For sensory stimuli, the time-shifted copies ranged up to 2s after the original. For motor events (running and licking) the time-shifted copies spanned the frames from 0.5s before until 2s after the original. The model was fit with 5-fold cross validation and the coefficient of determination (R<sup>2</sup>) was calculated based on the predictions of the model on held out data not used during training. We then assessed the predictive power of the behavioural model variables by comparing the R<sup>2</sup> value for the full model to a model without the running and licking predictors.</p></sec><sec id="S18"><title>Optogenetic activation and inhibition of VIP interneurons during ACC imaging</title><p id="P75">To perturb VIP neurons expressing Chrimson, ArchT, or tdTomato concurrently with 2-photon imaging, a 639nm laser (OBIS, Coherent) was used to deliver light via a 200µm diameter, 0.39 NA optic fibre (Thorlabs) positioned around 3mm from the posterior edge of the microprism, at a 30° angle relative to the coverslip. The laser and stimulus monitors were blanked during the linear phase of the resonant scanner to allow quasi-simultaneous two-photon imaging and optogenetic activation. The effective maximum output power from the optic fibre was 5.3mW. During an optogenetic calibration session in the dark, 5 laser powers (20%, 40%, 60%, 80%, and 100% of maximum) were pseudorandomly applied to the coverslip for 1.5s, with a 5 second interval between each. During switching sessions, two laser epochs were used, with 5.3mW power only. In the peri-stimulus epoch, the laser began 0.1s before the visual stimulus and continued until the end of the visual stimulus. In the inter-trial-interval epoch, the laser began at the offset of each visual stimulus and continued until the onset of the next visual stimulus.</p></sec><sec id="S19"><title>Pupil tracking</title><p id="P76">Eye recordings were acquired using a monochrome USB2.0 video camera (The Imaging Source) with a 50mm 2/3” format 5-megapixel lens (Computar), set to acquire at 320x240 (Y800) resolution and 30 frames per second. Frames were triggered using an Arduino Uno microcontroller board (Arduino) to ensure a constant acquisition rate. Pupil data were extracted using DeepLabCut <sup><xref ref-type="bibr" rid="R77">77</xref></sup> for 2D marker tracking, with markers set to track vertical and horizontal boundaries of the eye and pupil throughout the recording. Frames that coincided with blinks were removed based on changed in vertical size of the eye, and pupil width was calculated from the remaining frames.</p></sec><sec id="S20"><title>Optogenetic silencing of ACC activity</title><p id="P77">Once mice had learned the full switching task, optogenetic silencing of ACC neurons was performed by connecting the optic fibre cannulae to a blue LED (470nm, Thorlabs), and delivering light while the mouse performed the task. Before implantation, each optic fibre was confirmed to have an effective power output of &gt;1mW after cutting. Light was delivered either throughout the session (pulsed at 40Hz <sup><xref ref-type="bibr" rid="R78">78</xref></sup>), 0.5s before each visual stimulus continuing to the end of the stimulus (‘peri-stimulus’), or from the end of each visual stimulus until the beginning of the next visual stimulus (‘inter-trial-interval’, ITI). These three epochs were used to silence both ACC and PL on different days, creating 6 silencing conditions. These conditions were pseudorandomly chosen across consecutive days, with the order different between mice but the time between repeated conditions kept constant, and with control no-light sessions interspersed every third session. For one-trial un-silencing, the light was continuously pulsed throughout the session as above, but this was paused at the end of the last trial in the odour block, and resumed at the start of the second trial of the visual block. In the peri-stimulus and ITI epochs, light power was ramped down for the final 200ms of each pulse. For ACC silencing during learning, the silencing group included all 8 optogenetic mice, and the non-silenced controls were the 10 imaging mice. Light-only controls were performed in PV-Cre mice not expressing channelrhodopsin (N = 3 mice). No differences were found in these mice in the number of trials to transition between blocks with and without the light stimulation (P &gt; 0.05, Wilcoxon rank sum test).</p></sec><sec id="S21"><title>Pharmacological silencing of ACC activity</title><p id="P78">For the muscimol silencing experiments, 4 male wildtype C57Bl/6j mice were implanted with bilateral infusion cannulae (-1.2mm DV, +0.7mm AP, ± 0.5mm ML, bilaterally). After training in the switching task, mice were infused bilaterally with 300nl muscimol (Sigma, 1µg/ µl) or saline at a rate of 0.25µl/min using a 1µl syringe (Hamilton) and syringe pump (World Precision Instruments SP100IZ) 30 minutes before the start of a switching session. We waited 5 minutes after the syringe pump had finished to allow full infusion of the drug before disconnecting the cannulae.</p></sec><sec id="S22"><title>Silencing data analysis</title><p id="P79">Behavioural d-primes in each silencing condition were calculated by taking performance in stable periods of blocks, outside of transition periods <sup><xref ref-type="bibr" rid="R74">74</xref>,<xref ref-type="bibr" rid="R75">75</xref></sup>. Switching speeds were defined as the number of trials that elapse before a mouse correctly responded to three rewarded visual gratings in a row, either licking to the grating after a switch to a visual block or by ignoring the grating after a switch to an odour block. A ‘fluke’ switch was defined as a switch in which the mouse correctly licked to the very first rewarded grating in a new visual block, before any evidence of the switch had been received. These were interpreted as exploratory licks, visible in the histograms in <xref ref-type="fig" rid="F1">Figure 1F</xref> and <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 3E</xref> at trial 0, and all such transitions were excluded from analysis of switching speeds.</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary Materials</label><media xlink:href="EMS157796-supplement-Supplementary_Materials.pdf" mimetype="application" mime-subtype="pdf" id="d12aAdEbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S23"><title>Acknowledgments</title><p>We thank John Duncan, Apoorva Bhandari, Dimitar Kostadinov and Sonja Hofer for discussions and comments on the manuscript, and Thomas Mrsic-Flogel, Petr Znamenskiy, Anil Seth, Jasper Poort and Juan Burrone for discussions of the results in this manuscript. We thank Marian Fernandez-Otero for technical assistance and Robert Taylor for assistance in pilot experiments. This work was supported by the Wellcome Trust (AGK, 206222/Z/17/Z), the BBSRC (AGK BB/S015809/1), start-up funds from the CDN, King’s College London (AGK), and the MRC CNDD PhD program (MH).</p></ack><fn-group><fn fn-type="con" id="FN1"><p id="P80"><bold>Author contributions</bold></p><p id="P81">NC and AGK designed the experiments. NC performed the experiments and analysed the data. MH performed the widefield imaging and contributed to imaging data analysis. DM-J performed the V1 recordings and contributed to imaging and behavioural data analysis. AG built and analysed the RL model. AGK and NC wrote the paper, with contributions from AG, MH and DM-J. All authors contributed to discussions and commented on the manuscript.</p></fn><fn fn-type="conflict" id="FN2"><p id="P82"><bold>Competing financial interests</bold></p><p id="P83">The authors declare no competing financial interests.</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Monsell</surname><given-names>S</given-names></name></person-group><article-title>Task switching</article-title><source>Trends in Cognitive Sciences</source><year>2003</year><volume>7</volume><fpage>134</fpage><lpage>140</lpage><pub-id pub-id-type="pmid">12639695</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Keller</surname><given-names>GB</given-names></name><name><surname>Mrsic-Flogel</surname><given-names>TD</given-names></name></person-group><article-title>Predictive Processing: A Canonical Cortical Computation</article-title><source>Neuron</source><year>2018</year><volume>100</volume><fpage>424</fpage><lpage>435</lpage><pub-id pub-id-type="pmcid">PMC6400266</pub-id><pub-id pub-id-type="pmid">30359606</pub-id><pub-id pub-id-type="doi">10.1016/j.neuron.2018.10.003</pub-id></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Clark</surname><given-names>A</given-names></name></person-group><article-title>Whatever next? Predictive brains, situated agents, and the future of cognitive science</article-title><source>Behav Brain Sci</source><year>2013</year><volume>36</volume><fpage>181</fpage><lpage>204</lpage><pub-id pub-id-type="pmid">23663408</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bastos</surname><given-names>AM</given-names></name><etal/></person-group><article-title>Canonical microcircuits for predictive coding</article-title><source>Neuron</source><year>2012</year><volume>76</volume><fpage>695</fpage><lpage>711</lpage><pub-id pub-id-type="pmcid">PMC3777738</pub-id><pub-id pub-id-type="pmid">23177956</pub-id><pub-id pub-id-type="doi">10.1016/j.neuron.2012.10.038</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>de Lange</surname><given-names>FP</given-names></name><name><surname>Heilbron</surname><given-names>M</given-names></name><name><surname>Kok</surname><given-names>P</given-names></name></person-group><article-title>How Do Expectations Shape Perception?</article-title><source>Trends in Cognitive Sciences</source><year>2018</year><volume>22</volume><fpage>764</fpage><lpage>779</lpage><pub-id pub-id-type="pmid">30122170</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Meirhaeghe</surname><given-names>N</given-names></name><name><surname>Sohn</surname><given-names>H</given-names></name><name><surname>Jazayeri</surname><given-names>M</given-names></name></person-group><article-title>A precise and adaptive neural mechanism for predictive temporal processing in the frontal cortex</article-title><source>Neuron</source><year>2021</year><volume>109</volume><fpage>2995</fpage><lpage>3011</lpage><elocation-id>e5</elocation-id><pub-id pub-id-type="pmcid">PMC9737059</pub-id><pub-id pub-id-type="pmid">34534456</pub-id><pub-id pub-id-type="doi">10.1016/j.neuron.2021.08.025</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sarafyazd</surname><given-names>M</given-names></name><name><surname>Jazayeri</surname><given-names>M</given-names></name></person-group><article-title>Hierarchical reasoning by neural circuits in the frontal cortex</article-title><source>Science</source><year>2019</year><volume>364</volume><elocation-id>eaav8911</elocation-id><pub-id pub-id-type="pmid">31097640</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shima</surname><given-names>K</given-names></name><name><surname>Tanji</surname><given-names>J</given-names></name></person-group><article-title>Role for cingulate motor area cells in voluntary movement selection based on reward</article-title><source>Science</source><year>1998</year><volume>282</volume><fpage>1335</fpage><lpage>1338</lpage><pub-id pub-id-type="pmid">9812901</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>O’Reilly</surname><given-names>JX</given-names></name><etal/></person-group><article-title>Dissociable effects of surprise and model update in parietal and anterior cingulate cortex</article-title><source>Proceedings of the National Academy of Sciences</source><year>2013</year><volume>110</volume><fpage>E3660</fpage><lpage>E3669</lpage><pub-id pub-id-type="pmcid">PMC3780876</pub-id><pub-id pub-id-type="pmid">23986499</pub-id><pub-id pub-id-type="doi">10.1073/pnas.1305373110</pub-id></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Narayanan</surname><given-names>NS</given-names></name><name><surname>Cavanagh</surname><given-names>JF</given-names></name><name><surname>Frank</surname><given-names>MJ</given-names></name><name><surname>Laubach</surname><given-names>M</given-names></name></person-group><article-title>Common medial frontal mechanisms of adaptive control in humans and rodents</article-title><source>Nat Neurosci</source><year>2013</year><volume>16</volume><fpage>1888</fpage><lpage>1895</lpage><pub-id pub-id-type="pmcid">PMC3840072</pub-id><pub-id pub-id-type="pmid">24141310</pub-id><pub-id pub-id-type="doi">10.1038/nn.3549</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bartolo</surname><given-names>R</given-names></name><name><surname>Averbeck</surname><given-names>BB</given-names></name></person-group><article-title>Prefrontal Cortex Predicts State Switches during Reversal Learning</article-title><source>Neuron</source><year>2020</year><volume>106</volume><fpage>1044</fpage><lpage>1054</lpage><elocation-id>e4</elocation-id><pub-id pub-id-type="pmcid">PMC7422923</pub-id><pub-id pub-id-type="pmid">32315603</pub-id><pub-id pub-id-type="doi">10.1016/j.neuron.2020.03.024</pub-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Banerjee</surname><given-names>A</given-names></name><etal/></person-group><article-title>Value-guided remapping of sensory cortex by lateral orbitofrontal cortex</article-title><source>Nature</source><year>2020</year><volume>585</volume><fpage>245</fpage><lpage>250</lpage><pub-id pub-id-type="pmid">32884146</pub-id></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Klein-Flügge</surname><given-names>MC</given-names></name><name><surname>Bongioanni</surname><given-names>A</given-names></name><name><surname>Rushworth</surname><given-names>MFS</given-names></name></person-group><article-title>Medial and orbital frontal cortex in decision-making and flexible behavior</article-title><source>Neuron</source><year>2022</year><pub-id pub-id-type="pmid">35705077</pub-id></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heilbronner</surname><given-names>SR</given-names></name><name><surname>Hayden</surname><given-names>BY</given-names></name></person-group><article-title>Dorsal Anterior Cingulate Cortex: A Bottom-Up View</article-title><source>Annu Rev Neurosci</source><year>2016</year><volume>39</volume><fpage>149</fpage><lpage>170</lpage><pub-id pub-id-type="pmcid">PMC5512175</pub-id><pub-id pub-id-type="pmid">27090954</pub-id><pub-id pub-id-type="doi">10.1146/annurev-neuro-070815-013952</pub-id></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shenhav</surname><given-names>A</given-names></name><name><surname>Cohen</surname><given-names>JD</given-names></name><name><surname>Botvinick</surname><given-names>MM</given-names></name></person-group><article-title>Dorsal anterior cingulate cortex and the value of control</article-title><source>Nat Neurosci</source><year>2016</year><volume>19</volume><fpage>1286</fpage><lpage>1291</lpage><pub-id pub-id-type="pmid">27669989</pub-id></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kolling</surname><given-names>N</given-names></name><etal/></person-group><article-title>Value, search, persistence and model updating in anterior cingulate cortex</article-title><source>Nat Neurosci</source><year>2016</year><volume>19</volume><fpage>1280</fpage><lpage>1285</lpage><pub-id pub-id-type="pmcid">PMC7116891</pub-id><pub-id pub-id-type="pmid">27669988</pub-id><pub-id pub-id-type="doi">10.1038/nn.4382</pub-id></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tervo</surname><given-names>DGR</given-names></name><etal/></person-group><article-title>Behavioral variability through stochastic choice and its gating by anterior cingulate cortex</article-title><source>Cell</source><year>2014</year><volume>159</volume><fpage>21</fpage><lpage>32</lpage><pub-id pub-id-type="pmid">25259917</pub-id></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tervo</surname><given-names>DGR</given-names></name><etal/></person-group><article-title>The anterior cingulate cortex directs exploration of alternative strategies</article-title><source>Neuron</source><year>2021</year><volume>109</volume><fpage>1876</fpage><lpage>1887</lpage><elocation-id>e6</elocation-id><pub-id pub-id-type="pmid">33852896</pub-id></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Williams</surname><given-names>ZM</given-names></name><name><surname>Bush</surname><given-names>G</given-names></name><name><surname>Rauch</surname><given-names>SL</given-names></name><name><surname>Cosgrove</surname><given-names>GR</given-names></name><name><surname>Eskandar</surname><given-names>EN</given-names></name></person-group><article-title>Human anterior cingulate neurons and the integration of monetary reward with motor responses</article-title><source>Nat Neurosci</source><year>2004</year><volume>7</volume><fpage>1370</fpage><lpage>1375</lpage><pub-id pub-id-type="pmid">15558064</pub-id></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kennerley</surname><given-names>SW</given-names></name><name><surname>Behrens</surname><given-names>TEJ</given-names></name><name><surname>Wallis</surname><given-names>JD</given-names></name></person-group><article-title>Double dissociation of value computations in orbitofrontal and anterior cingulate neurons</article-title><source>Nat Neurosci</source><year>2011</year><volume>14</volume><fpage>1581</fpage><lpage>1589</lpage><pub-id pub-id-type="pmcid">PMC3225689</pub-id><pub-id pub-id-type="pmid">22037498</pub-id><pub-id pub-id-type="doi">10.1038/nn.2961</pub-id></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hayden</surname><given-names>BY</given-names></name><name><surname>Pearson</surname><given-names>JM</given-names></name><name><surname>Platt</surname><given-names>ML</given-names></name></person-group><article-title>Neuronal basis of sequential foraging decisions in a patchy environment</article-title><source>Nat Neurosci</source><year>2011</year><volume>14</volume><fpage>933</fpage><lpage>939</lpage><pub-id pub-id-type="pmcid">PMC3553855</pub-id><pub-id pub-id-type="pmid">21642973</pub-id><pub-id pub-id-type="doi">10.1038/nn.2856</pub-id></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kolling</surname><given-names>N</given-names></name><name><surname>Behrens</surname><given-names>TEJ</given-names></name><name><surname>Mars</surname><given-names>RB</given-names></name><name><surname>Rushworth</surname><given-names>MFS</given-names></name></person-group><article-title>Neural mechanisms of foraging</article-title><source>Science</source><year>2012</year><volume>336</volume><fpage>95</fpage><lpage>98</lpage><pub-id pub-id-type="pmcid">PMC3440844</pub-id><pub-id pub-id-type="pmid">22491854</pub-id><pub-id pub-id-type="doi">10.1126/science.1216930</pub-id></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ito</surname><given-names>S</given-names></name><name><surname>Stuphorn</surname><given-names>V</given-names></name><name><surname>Brown</surname><given-names>JW</given-names></name><name><surname>Schall</surname><given-names>JD</given-names></name></person-group><article-title>Performance monitoring by the anterior cingulate cortex during saccade countermanding</article-title><source>Science</source><year>2003</year><volume>302</volume><fpage>120</fpage><lpage>122</lpage><pub-id pub-id-type="pmid">14526085</pub-id></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Quilodran</surname><given-names>R</given-names></name><name><surname>Rothé</surname><given-names>M</given-names></name><name><surname>Procyk</surname><given-names>E</given-names></name></person-group><article-title>Behavioral Shifts and Action Valuation in the Anterior Cingulate Cortex</article-title><source>Neuron</source><year>2008</year><volume>57</volume><fpage>314</fpage><lpage>325</lpage><pub-id pub-id-type="pmid">18215627</pub-id></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hyman</surname><given-names>JM</given-names></name><name><surname>Holroyd</surname><given-names>CB</given-names></name><name><surname>Seamans</surname><given-names>JK</given-names></name></person-group><article-title>A Novel Neural Prediction Error Found in Anterior Cingulate Cortex Ensembles</article-title><source>Neuron</source><year>2017</year><volume>95</volume><fpage>447</fpage><lpage>456</lpage><elocation-id>e3</elocation-id><pub-id pub-id-type="pmid">28689983</pub-id></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jaramillo</surname><given-names>S</given-names></name><name><surname>Zador</surname><given-names>AM</given-names></name></person-group><article-title>Mice and rats achieve similar levels of performance in an adaptive decision-making task</article-title><source>Front Syst Neurosci</source><year>2014</year><volume>8</volume><pub-id pub-id-type="pmcid">PMC4167002</pub-id><pub-id pub-id-type="pmid">25278849</pub-id><pub-id pub-id-type="doi">10.3389/fnsys.2014.00173</pub-id></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>Y</given-names></name><name><surname>Xin</surname><given-names>Y</given-names></name><name><surname>Xu</surname><given-names>N-L</given-names></name></person-group><article-title>A cortical circuit mechanism for structural knowledge-based flexible sensorimotor decision-making</article-title><source>Neuron</source><year>2021</year><volume>109</volume><fpage>2009</fpage><lpage>2024</lpage><elocation-id>e6</elocation-id><pub-id pub-id-type="pmid">33957065</pub-id></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Reinert</surname><given-names>S</given-names></name><name><surname>Hübener</surname><given-names>M</given-names></name><name><surname>Bonhoeffer</surname><given-names>T</given-names></name><name><surname>Goltstein</surname><given-names>PM</given-names></name></person-group><article-title>Mouse prefrontal cortex represents learned rules for categorization</article-title><source>Nature</source><year>2021</year><pub-id pub-id-type="pmcid">PMC8131197</pub-id><pub-id pub-id-type="pmid">33883745</pub-id><pub-id pub-id-type="doi">10.1038/s41586-021-03452-z</pub-id></element-citation></ref><ref id="R29"><label>29</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>T-Y</given-names></name><name><surname>Liu</surname><given-names>J</given-names></name><name><surname>Yao</surname><given-names>H</given-names></name></person-group><article-title>Control of adaptive action selection by secondary motor cortex during flexible visual categorization</article-title><source>eLife</source><year>2020</year><volume>9</volume><elocation-id>e54474</elocation-id><pub-id pub-id-type="pmcid">PMC7343391</pub-id><pub-id pub-id-type="pmid">32579113</pub-id><pub-id pub-id-type="doi">10.7554/eLife.54474</pub-id></element-citation></ref><ref id="R30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Siniscalchi</surname><given-names>MJ</given-names></name><name><surname>Phoumthipphavong</surname><given-names>V</given-names></name><name><surname>Ali</surname><given-names>F</given-names></name><name><surname>Lozano</surname><given-names>M</given-names></name><name><surname>Kwan</surname><given-names>AC</given-names></name></person-group><article-title>Fast and slow transitions in frontal ensemble activity during flexible sensorimotor behavior</article-title><source>Nat Neurosci</source><year>2016</year><volume>19</volume><fpage>1234</fpage><lpage>1242</lpage><pub-id pub-id-type="pmcid">PMC5003707</pub-id><pub-id pub-id-type="pmid">27399844</pub-id><pub-id pub-id-type="doi">10.1038/nn.4342</pub-id></element-citation></ref><ref id="R31"><label>31</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rodgers</surname><given-names>CC</given-names></name><name><surname>DeWeese</surname><given-names>MR</given-names></name></person-group><article-title>Neural Correlates of Task Switching in Prefrontal Cortex and Primary Auditory Cortex in a Novel Stimulus Selection Task for Rodents</article-title><source>Neuron</source><year>2014</year><volume>82</volume><fpage>1157</fpage><lpage>1170</lpage><pub-id pub-id-type="pmid">24908492</pub-id></element-citation></ref><ref id="R32"><label>32</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Karlsson</surname><given-names>MP</given-names></name><name><surname>Tervo</surname><given-names>DGR</given-names></name><name><surname>Karpova</surname><given-names>AY</given-names></name></person-group><article-title>Network resets in medial prefrontal cortex mark the onset of behavioral uncertainty</article-title><source>Science</source><year>2012</year><volume>338</volume><fpage>135</fpage><lpage>139</lpage><pub-id pub-id-type="pmid">23042898</pub-id></element-citation></ref><ref id="R33"><label>33</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Spellman</surname><given-names>T</given-names></name><name><surname>Svei</surname><given-names>M</given-names></name><name><surname>Kaminsky</surname><given-names>J</given-names></name><name><surname>Manzano-Nieves</surname><given-names>G</given-names></name><name><surname>Liston</surname><given-names>C</given-names></name></person-group><article-title>Prefrontal deep projection neurons enable cognitive flexibility via persistent feedback monitoring</article-title><source>Cell</source><year>2021</year><volume>184</volume><fpage>2750</fpage><lpage>2766</lpage><elocation-id>e17</elocation-id><pub-id pub-id-type="pmcid">PMC8684294</pub-id><pub-id pub-id-type="pmid">33861951</pub-id><pub-id pub-id-type="doi">10.1016/j.cell.2021.03.047</pub-id></element-citation></ref><ref id="R34"><label>34</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Harlow</surname><given-names>HF</given-names></name></person-group><article-title>The formation of learning sets</article-title><source>Psychol Rev</source><year>1949</year><volume>56</volume><fpage>51</fpage><lpage>65</lpage><pub-id pub-id-type="pmid">18124807</pub-id></element-citation></ref><ref id="R35"><label>35</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Achterberg</surname><given-names>J</given-names></name><etal/></person-group><article-title>A One-Shot Shift from Explore to Exploit in Monkey Prefrontal Cortex</article-title><source>J Neurosci</source><year>2022</year><volume>42</volume><fpage>276</fpage><lpage>287</lpage><pub-id pub-id-type="pmcid">PMC8802942</pub-id><pub-id pub-id-type="pmid">34782437</pub-id><pub-id pub-id-type="doi">10.1523/JNEUROSCI.1338-21.2021</pub-id></element-citation></ref><ref id="R36"><label>36</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hertäg</surname><given-names>L</given-names></name><name><surname>Clopath</surname><given-names>C</given-names></name></person-group><article-title>Prediction-error neurons in circuits with multiple neuron types: Formation, refinement, and functional implications</article-title><source>Proceedings of the National Academy of Sciences</source><year>2022</year><volume>119</volume><elocation-id>e2115699119</elocation-id><pub-id pub-id-type="pmcid">PMC9060484</pub-id><pub-id pub-id-type="pmid">35320037</pub-id><pub-id pub-id-type="doi">10.1073/pnas.2115699119</pub-id></element-citation></ref><ref id="R37"><label>37</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pi</surname><given-names>H-J</given-names></name><etal/></person-group><article-title>Cortical interneurons that specialize in disinhibitory control</article-title><source>Nature</source><year>2013</year><volume>503</volume><fpage>521</fpage><lpage>524</lpage><pub-id pub-id-type="pmcid">PMC4017628</pub-id><pub-id pub-id-type="pmid">24097352</pub-id><pub-id pub-id-type="doi">10.1038/nature12676</pub-id></element-citation></ref><ref id="R38"><label>38</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pfeffer</surname><given-names>CK</given-names></name><name><surname>Xue</surname><given-names>M</given-names></name><name><surname>He</surname><given-names>M</given-names></name><name><surname>Huang</surname><given-names>ZJ</given-names></name><name><surname>Scanziani</surname><given-names>M</given-names></name></person-group><article-title>Inhibition of inhibition in visual cortex: the logic of connections between molecularly distinct interneurons</article-title><source>Nat Neurosci</source><year>2013</year><volume>16</volume><fpage>1068</fpage><lpage>1076</lpage><pub-id pub-id-type="pmcid">PMC3729586</pub-id><pub-id pub-id-type="pmid">23817549</pub-id><pub-id pub-id-type="doi">10.1038/nn.3446</pub-id></element-citation></ref><ref id="R39"><label>39</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>S</given-names></name><name><surname>Kruglikov</surname><given-names>I</given-names></name><name><surname>Huang</surname><given-names>ZJ</given-names></name><name><surname>Fishell</surname><given-names>G</given-names></name><name><surname>Rudy</surname><given-names>B</given-names></name></person-group><article-title>A disinhibitory circuit mediates motor integration in the somatosensory cortex</article-title><source>Nat Neurosci</source><year>2013</year><volume>16</volume><fpage>1662</fpage><lpage>1670</lpage><pub-id pub-id-type="pmcid">PMC4100076</pub-id><pub-id pub-id-type="pmid">24097044</pub-id><pub-id pub-id-type="doi">10.1038/nn.3544</pub-id></element-citation></ref><ref id="R40"><label>40</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Letzkus</surname><given-names>JJ</given-names></name><name><surname>Wolff</surname><given-names>SBE</given-names></name><name><surname>Lüthi</surname><given-names>A</given-names></name></person-group><article-title>Disinhibition, a Circuit Mechanism for Associative Learning and Memory</article-title><source>Neuron</source><year>2015</year><volume>88</volume><fpage>264</fpage><lpage>276</lpage><pub-id pub-id-type="pmid">26494276</pub-id></element-citation></ref><ref id="R41"><label>41</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Braga</surname><given-names>A</given-names></name><name><surname>Schönwiesner</surname><given-names>M</given-names></name></person-group><article-title>Neural Substrates and Models of Omission Responses and Predictive Processes</article-title><source>Frontiers in Neural Circuits</source><year>2022</year><volume>16</volume><pub-id pub-id-type="pmcid">PMC8844463</pub-id><pub-id pub-id-type="pmid">35177967</pub-id><pub-id pub-id-type="doi">10.3389/fncir.2022.799581</pub-id></element-citation></ref><ref id="R42"><label>42</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Akam</surname><given-names>T</given-names></name><etal/></person-group><article-title>The Anterior Cingulate Cortex Predicts Future States to Mediate Model-Based Action Selection</article-title><source>Neuron</source><year>2021</year><volume>109</volume><fpage>149</fpage><lpage>163</lpage><elocation-id>e7</elocation-id><pub-id pub-id-type="pmcid">PMC7837117</pub-id><pub-id pub-id-type="pmid">33152266</pub-id><pub-id pub-id-type="doi">10.1016/j.neuron.2020.10.013</pub-id></element-citation></ref><ref id="R43"><label>43</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rushworth</surname><given-names>MFS</given-names></name><name><surname>Behrens</surname><given-names>TEJ</given-names></name></person-group><article-title>Choice, uncertainty and value in prefrontal and cingulate cortex</article-title><source>Nat Neurosci</source><year>2008</year><volume>11</volume><fpage>389</fpage><lpage>397</lpage><pub-id pub-id-type="pmid">18368045</pub-id></element-citation></ref><ref id="R44"><label>44</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Warren</surname><given-names>CM</given-names></name><name><surname>Hyman</surname><given-names>JM</given-names></name><name><surname>Seamans</surname><given-names>JK</given-names></name><name><surname>Holroyd</surname><given-names>CB</given-names></name></person-group><article-title>Feedback-related negativity observed in rodent anterior cingulate cortex</article-title><source>J Physiol Paris</source><year>2015</year><volume>109</volume><fpage>87</fpage><lpage>94</lpage><pub-id pub-id-type="pmid">25237010</pub-id></element-citation></ref><ref id="R45"><label>45</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bissonette</surname><given-names>GB</given-names></name><name><surname>Powell</surname><given-names>EM</given-names></name><name><surname>Roesch</surname><given-names>MR</given-names></name></person-group><article-title>Neural structures underlying set-shifting: roles of medial prefrontal cortex and anterior cingulate cortex</article-title><source>Behav Brain Res</source><year>2013</year><volume>250</volume><fpage>91</fpage><lpage>101</lpage><pub-id pub-id-type="pmcid">PMC3708542</pub-id><pub-id pub-id-type="pmid">23664821</pub-id><pub-id pub-id-type="doi">10.1016/j.bbr.2013.04.037</pub-id></element-citation></ref><ref id="R46"><label>46</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Botvinick</surname><given-names>MM</given-names></name></person-group><article-title>Conflict monitoring and decision making: reconciling two perspectives on anterior cingulate function</article-title><source>Cogn Affect Behav Neurosci</source><year>2007</year><volume>7</volume><fpage>356</fpage><lpage>366</lpage><pub-id pub-id-type="pmid">18189009</pub-id></element-citation></ref><ref id="R47"><label>47</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Passingham</surname><given-names>RE</given-names></name><etal/></person-group><article-title>Attention to action</article-title><source>Philosophical Transactions of the Royal Society of London Series B: Biological Sciences</source><year>1996</year><volume>351</volume><fpage>1473</fpage><lpage>1479</lpage></element-citation></ref><ref id="R48"><label>48</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Procyk</surname><given-names>E</given-names></name><name><surname>Tanaka</surname><given-names>YL</given-names></name><name><surname>Joseph</surname><given-names>JP</given-names></name></person-group><article-title>Anterior cingulate activity during routine and non-routine sequential behaviors in macaques</article-title><source>Nat Neurosci</source><year>2000</year><volume>3</volume><fpage>502</fpage><lpage>508</lpage><pub-id pub-id-type="pmid">10769392</pub-id></element-citation></ref><ref id="R49"><label>49</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hadland</surname><given-names>KA</given-names></name><name><surname>Rushworth</surname><given-names>MFS</given-names></name><name><surname>Gaffan</surname><given-names>D</given-names></name><name><surname>Passingham</surname><given-names>RE</given-names></name></person-group><article-title>The anterior cingulate and reward-guided selection of actions</article-title><source>J Neurophysiol</source><year>2003</year><volume>89</volume><fpage>1161</fpage><lpage>1164</lpage><pub-id pub-id-type="pmid">12574489</pub-id></element-citation></ref><ref id="R50"><label>50</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Norman</surname><given-names>KJ</given-names></name><etal/></person-group><article-title>Frontal-Sensory Cortical Projections Become Dispensable for Attentional Performance Upon a Reduction of Task Demand in Mice</article-title><source>Front Neurosci</source><year>2022</year><volume>15</volume><elocation-id>775256</elocation-id><pub-id pub-id-type="pmcid">PMC8787360</pub-id><pub-id pub-id-type="pmid">35087372</pub-id><pub-id pub-id-type="doi">10.3389/fnins.2021.775256</pub-id></element-citation></ref><ref id="R51"><label>51</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>S</given-names></name><etal/></person-group><article-title>Organization of long-range inputs and outputs of frontal cortex for top-down control</article-title><source>Nat Neurosci</source><year>2016</year><volume>19</volume><fpage>1733</fpage><lpage>1742</lpage><pub-id pub-id-type="pmcid">PMC5127741</pub-id><pub-id pub-id-type="pmid">27749828</pub-id><pub-id pub-id-type="doi">10.1038/nn.4417</pub-id></element-citation></ref><ref id="R52"><label>52</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Alexander</surname><given-names>WH</given-names></name><name><surname>Brown</surname><given-names>JW</given-names></name></person-group><article-title>Medial prefrontal cortex as an action-outcome predictor</article-title><source>Nat Neurosci</source><year>2011</year><volume>14</volume><fpage>1338</fpage><lpage>1344</lpage><pub-id pub-id-type="pmcid">PMC3183374</pub-id><pub-id pub-id-type="pmid">21926982</pub-id><pub-id pub-id-type="doi">10.1038/nn.2921</pub-id></element-citation></ref><ref id="R53"><label>53</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kuchibhotla</surname><given-names>KV</given-names></name><etal/></person-group><article-title>Parallel processing by cortical inhibition enables context-dependent behavior</article-title><source>Nat Neurosci</source><year>2017</year><volume>20</volume><fpage>62</fpage><lpage>71</lpage><pub-id pub-id-type="pmcid">PMC5191967</pub-id><pub-id pub-id-type="pmid">27798631</pub-id><pub-id pub-id-type="doi">10.1038/nn.4436</pub-id></element-citation></ref><ref id="R54"><label>54</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Attinger</surname><given-names>A</given-names></name><name><surname>Wang</surname><given-names>B</given-names></name><name><surname>Keller</surname><given-names>GB</given-names></name></person-group><article-title>Visuomotor Coupling Shapes the Functional Development of Mouse Visual Cortex</article-title><source>Cell</source><year>2017</year><volume>169</volume><fpage>1291</fpage><lpage>1302</lpage><elocation-id>e14</elocation-id><pub-id pub-id-type="pmid">28602353</pub-id></element-citation></ref><ref id="R55"><label>55</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kounios</surname><given-names>J</given-names></name><name><surname>Beeman</surname><given-names>M</given-names></name></person-group><article-title>The Aha! Moment: The Cognitive Neuroscience of Insight</article-title><source>Curr Dir Psychol Sci</source><year>2009</year><volume>18</volume><fpage>210</fpage><lpage>216</lpage></element-citation></ref><ref id="R56"><label>56</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Leinweber</surname><given-names>M</given-names></name><name><surname>Ward</surname><given-names>DR</given-names></name><name><surname>Sobczak</surname><given-names>JM</given-names></name><name><surname>Attinger</surname><given-names>A</given-names></name><name><surname>Keller</surname><given-names>GB</given-names></name></person-group><article-title>A Sensorimotor Circuit in Mouse Cortex for Visual Flow Predictions</article-title><source>Neuron</source><year>2017</year><volume>95</volume><fpage>1420</fpage><lpage>1432</lpage><elocation-id>e5</elocation-id><pub-id pub-id-type="pmid">28910624</pub-id></element-citation></ref><ref id="R57"><label>57</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Watabe-Uchida</surname><given-names>M</given-names></name><name><surname>Eshel</surname><given-names>N</given-names></name><name><surname>Uchida</surname><given-names>N</given-names></name></person-group><article-title>Neural circuitry of reward prediction error</article-title><source>Annu Rev Neurosci</source><year>2017</year><volume>40</volume><fpage>373</fpage><lpage>394</lpage><pub-id pub-id-type="pmcid">PMC6721851</pub-id><pub-id pub-id-type="pmid">28441114</pub-id><pub-id pub-id-type="doi">10.1146/annurev-neuro-072116-031109</pub-id></element-citation></ref><ref id="R58"><label>58</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rabinovich</surname><given-names>RJ</given-names></name><name><surname>Kato</surname><given-names>DD</given-names></name><name><surname>Bruno</surname><given-names>RM</given-names></name></person-group><article-title>Learning enhances encoding of time and temporal surprise in mouse primary sensory cortex</article-title><source>Nat Commun</source><year>2022</year><volume>13</volume><elocation-id>5504</elocation-id><pub-id pub-id-type="pmcid">PMC9489862</pub-id><pub-id pub-id-type="pmid">36127340</pub-id><pub-id pub-id-type="doi">10.1038/s41467-022-33141-y</pub-id></element-citation></ref><ref id="R59"><label>59</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sokolov</surname><given-names>AA</given-names></name><name><surname>Miall</surname><given-names>RC</given-names></name><name><surname>Ivry</surname><given-names>RB</given-names></name></person-group><article-title>The Cerebellum: Adaptive Prediction for Movement and Cognition</article-title><source>Trends in Cognitive Sciences</source><year>2017</year><volume>21</volume><fpage>313</fpage><lpage>332</lpage><pub-id pub-id-type="pmcid">PMC5477675</pub-id><pub-id pub-id-type="pmid">28385461</pub-id><pub-id pub-id-type="doi">10.1016/j.tics.2017.02.005</pub-id></element-citation></ref><ref id="R60"><label>60</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wilson</surname><given-names>RC</given-names></name><name><surname>Takahashi</surname><given-names>YK</given-names></name><name><surname>Schoenbaum</surname><given-names>G</given-names></name><name><surname>Niv</surname><given-names>Y</given-names></name></person-group><article-title>Orbitofrontal Cortex as a Cognitive Map of Task Space</article-title><source>Neuron</source><year>2014</year><volume>81</volume><fpage>267</fpage><lpage>279</lpage><pub-id pub-id-type="pmcid">PMC4001869</pub-id><pub-id pub-id-type="pmid">24462094</pub-id><pub-id pub-id-type="doi">10.1016/j.neuron.2013.11.005</pub-id></element-citation></ref><ref id="R61"><label>61</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Durstewitz</surname><given-names>D</given-names></name><name><surname>Vittoz</surname><given-names>NM</given-names></name><name><surname>Floresco</surname><given-names>SB</given-names></name><name><surname>Seamans</surname><given-names>JK</given-names></name></person-group><article-title>Abrupt Transitions between Prefrontal Neural Ensemble States Accompany Behavioral Transitions during Rule Learning</article-title><source>Neuron</source><year>2010</year><volume>66</volume><fpage>438</fpage><lpage>448</lpage><pub-id pub-id-type="pmid">20471356</pub-id></element-citation></ref><ref id="R62"><label>62</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vertechi</surname><given-names>P</given-names></name><etal/></person-group><article-title>Inference-Based Decisions in a Hidden State Foraging Task: Differential Contributions of Prefrontal Cortical Areas</article-title><source>Neuron</source><year>2020</year><pub-id pub-id-type="pmcid">PMC7146546</pub-id><pub-id pub-id-type="pmid">32048995</pub-id><pub-id pub-id-type="doi">10.1016/j.neuron.2020.01.017</pub-id></element-citation></ref><ref id="R63"><label>63</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Myers-Joseph</surname><given-names>D</given-names></name><name><surname>Wilmes</surname><given-names>KA</given-names></name><name><surname>Fernandez-Otero</surname><given-names>M</given-names></name><name><surname>Clopath</surname><given-names>C</given-names></name><name><surname>Khan</surname><given-names>AG</given-names></name></person-group><article-title>Disinhibition by VIP interneurons is orthogonal to cross-modal attentional modulation in primary visual cortex</article-title><source>Neuron</source><year>2024</year><volume>112</volume><fpage>628</fpage><lpage>645</lpage><elocation-id>e7</elocation-id><pub-id pub-id-type="pmid">38070500</pub-id></element-citation></ref><ref id="R64"><label>64</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fox</surname><given-names>MT</given-names></name><name><surname>Barense</surname><given-names>MD</given-names></name><name><surname>Baxter</surname><given-names>MG</given-names></name></person-group><article-title>Perceptual attentional set-shifting is impaired in rats with neurotoxic lesions of posterior parietal cortex</article-title><source>J Neurosci</source><year>2003</year><volume>23</volume><fpage>676</fpage><lpage>681</lpage><pub-id pub-id-type="pmcid">PMC6741897</pub-id><pub-id pub-id-type="pmid">12533627</pub-id><pub-id pub-id-type="doi">10.1523/JNEUROSCI.23-02-00676.2003</pub-id></element-citation></ref><ref id="R65"><label>65</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marton</surname><given-names>T</given-names></name><name><surname>Seifikar</surname><given-names>H</given-names></name><name><surname>Luongo</surname><given-names>FJ</given-names></name><name><surname>Lee</surname><given-names>AT</given-names></name><name><surname>Sohal</surname><given-names>VS</given-names></name></person-group><article-title>Roles of prefrontal cortex and mediodorsal thalamus in task engagement and behavioral flexibility</article-title><source>J Neurosci</source><year>2018</year><pub-id pub-id-type="pmcid">PMC5858597</pub-id><pub-id pub-id-type="pmid">29437889</pub-id><pub-id pub-id-type="doi">10.1523/JNEUROSCI.1728-17.2018</pub-id></element-citation></ref><ref id="R66"><label>66</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cho</surname><given-names>KKA</given-names></name><name><surname>Shi</surname><given-names>J</given-names></name><name><surname>Phensy</surname><given-names>AJ</given-names></name><name><surname>Turner</surname><given-names>ML</given-names></name><name><surname>Sohal</surname><given-names>VS</given-names></name></person-group><article-title>Long-range inhibition synchronizes and updates prefrontal task activity</article-title><source>Nature</source><year>2023</year><volume>617</volume><fpage>548</fpage><lpage>554</lpage><pub-id pub-id-type="pmcid">PMC10191848</pub-id><pub-id pub-id-type="pmid">37100905</pub-id><pub-id pub-id-type="doi">10.1038/s41586-023-06012-9</pub-id></element-citation></ref><ref id="R67"><label>67</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Modirshanechi</surname><given-names>A</given-names></name><name><surname>Brea</surname><given-names>J</given-names></name><name><surname>Gerstner</surname><given-names>W</given-names></name></person-group><article-title>A taxonomy of surprise definitions</article-title><source>Journal of Mathematical Psychology</source><year>2022</year><volume>110</volume><elocation-id>102712</elocation-id></element-citation></ref><ref id="R68"><label>68</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aston-Jones</surname><given-names>G</given-names></name><name><surname>Cohen</surname><given-names>JD</given-names></name></person-group><article-title>An integrative theory of locus coeruleus-norepinephrine function: adaptive gain and optimal performance</article-title><source>Annu Rev Neurosci</source><year>2005</year><volume>28</volume><fpage>403</fpage><lpage>450</lpage><pub-id pub-id-type="pmid">16022602</pub-id></element-citation></ref><ref id="R69"><label>69</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jordan</surname><given-names>R</given-names></name><name><surname>Keller</surname><given-names>GB</given-names></name></person-group><article-title>The locus coeruleus broadcasts prediction errors across the cortex to promote sensorimotor plasticity</article-title><source>Elife</source><year>2023</year><volume>12</volume><elocation-id>RP85111</elocation-id><pub-id pub-id-type="pmcid">PMC10328511</pub-id><pub-id pub-id-type="pmid">37285281</pub-id><pub-id pub-id-type="doi">10.7554/eLife.85111</pub-id></element-citation></ref><ref id="R70"><label>70</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Clarke</surname><given-names>HF</given-names></name><name><surname>Dalley</surname><given-names>JW</given-names></name><name><surname>Crofts</surname><given-names>HS</given-names></name><name><surname>Robbins</surname><given-names>TW</given-names></name><name><surname>Roberts</surname><given-names>AC</given-names></name></person-group><article-title>Cognitive inflexibility after prefrontal serotonin depletion</article-title><source>Science</source><year>2004</year><volume>304</volume><fpage>878</fpage><lpage>880</lpage><pub-id pub-id-type="pmid">15131308</pub-id></element-citation></ref><ref id="R71"><label>71</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ahmadlou</surname><given-names>M</given-names></name><etal/></person-group><article-title>A subcortical switchboard for exploratory, exploitatory, and disengaged states</article-title><year>2023</year><elocation-id>2023.12.20.572654</elocation-id><comment>Preprint at</comment><pub-id pub-id-type="doi">10.1101/2023.12.20.572654</pub-id></element-citation></ref><ref id="R72"><label>72</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Uddin</surname><given-names>LQ</given-names></name></person-group><article-title>Cognitive and behavioural flexibility: neural mechanisms and clinical considerations</article-title><source>Nature Reviews Neuroscience</source><year>2021</year><fpage>1</fpage><lpage>13</lpage><pub-id pub-id-type="pmcid">PMC7856857</pub-id><pub-id pub-id-type="pmid">33536614</pub-id><pub-id pub-id-type="doi">10.1038/s41583-021-00428-w</pub-id></element-citation></ref><ref id="R73"><label>73</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Couto</surname><given-names>J</given-names></name><etal/></person-group><article-title>Chronic, cortex-wide imaging of specific cell populations during behavior</article-title><source>Nat Protoc</source><year>2021</year><volume>16</volume><fpage>3241</fpage><lpage>3263</lpage><pub-id pub-id-type="pmcid">PMC8788140</pub-id><pub-id pub-id-type="pmid">34075229</pub-id><pub-id pub-id-type="doi">10.1038/s41596-021-00527-z</pub-id></element-citation></ref><ref id="R74"><label>74</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Poort</surname><given-names>J</given-names></name><etal/></person-group><article-title>Learning Enhances Sensory and Multiple Non-sensory Representations in Primary Visual Cortex</article-title><source>Neuron</source><year>2015</year><volume>86</volume><fpage>1478</fpage><lpage>1490</lpage><pub-id pub-id-type="pmcid">PMC4503798</pub-id><pub-id pub-id-type="pmid">26051421</pub-id><pub-id pub-id-type="doi">10.1016/j.neuron.2015.05.037</pub-id></element-citation></ref><ref id="R75"><label>75</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Poort</surname><given-names>J</given-names></name><etal/></person-group><article-title>Learning and attention increase visual response selectivity through distinct mechanisms</article-title><source>Neuron</source><year>2022</year><volume>110</volume><fpage>686</fpage><lpage>697</lpage><elocation-id>e6</elocation-id><pub-id pub-id-type="pmcid">PMC8860382</pub-id><pub-id pub-id-type="pmid">34906356</pub-id><pub-id pub-id-type="doi">10.1016/j.neuron.2021.11.016</pub-id></element-citation></ref><ref id="R76"><label>76</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pachitariu</surname><given-names>M</given-names></name><etal/></person-group><article-title>Suite2p: beyond 10,000 neurons with standard two-photon microscopy</article-title><year>2017</year><elocation-id>061507</elocation-id><comment>Preprint at</comment><pub-id pub-id-type="doi">10.1101/061507</pub-id></element-citation></ref><ref id="R77"><label>77</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mathis</surname><given-names>A</given-names></name><etal/></person-group><article-title>DeepLabCut: markerless pose estimation of user-defined body parts with deep learning</article-title><source>Nat Neurosci</source><year>2018</year><volume>21</volume><fpage>1281</fpage><lpage>1289</lpage><pub-id pub-id-type="pmid">30127430</pub-id></element-citation></ref><ref id="R78"><label>78</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>N</given-names></name><etal/></person-group><article-title>Spatiotemporal constraints on optogenetic inactivation in cortical circuits</article-title><source>Elife</source><year>2019</year><volume>8</volume><pub-id pub-id-type="pmcid">PMC6892606</pub-id><pub-id pub-id-type="pmid">31736463</pub-id><pub-id pub-id-type="doi">10.7554/eLife.48622</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>Mice perform rapid task-switching with one-shot block transitions.</title><p><bold>A</bold>. Experimental setup. <bold>B</bold>. Task schematic. Mice switched between blocks of discriminating two visual stimuli in the visual blocks or discriminating two olfactory stimuli while ignoring the same visual stimuli in the odour blocks. <bold>C</bold>. Behavioural discrimination performance (behavioural d′) across blocks (N = 10 mice). Shades of grey indicate individual mice. Odour discrimination performance is shown in brown circles. Mice performed up to 15 block transitions in a session. <bold>D</bold>. Schematic of a transition from an odour block to a visual block, showing the last trial of the odour block and first two trials of the visual block, indicating the moment of odour prediction error. Labels A-E refer to timepoints in E. During one-shot block transitions as in E, a complete cognitive rule update occurs in the time indicated. <bold>E</bold>. Example behaviour from an odour to visual block transition (lick raster) showing stimuli, lick, and reward times. In the odour block the mouse ignored both visual gratings while accurately discriminating odour stimuli, but switched rules after a single error trial and started accurately discriminating the same visual stimuli. <bold>F</bold>. Histogram showing the number of trials required to switch between the two blocks, with one-shot transitions indicated by an arrowhead. N = 95 transitions, 17 sessions, 14 mice. <bold>G</bold>. Schematic of reinforcement learning (RL) models. Top, basic RL, bottom, RL with belief state. In the RL model with belief state, Q-values were only updated while the agent learnt the task, following which only context belief was updated to switch between blocks. <bold>H</bold>. Average probability of licking the reward spout in response to Visual Stimulus 1 (rewarded only in visual blocks) and Visual Stimulus 2 (unrewarded in both blocks), aligned to the block transitions. Top, data from average of 95 odour to visual block transitions. Shading indicates SEM. Grey bar indicates the 10-trial duration where mice performed at 100% accuracy with no licks to either irrelevant visual stimulus, which was a condition for triggering a block transition. First 3 trials of each block were forced to be Visual Stimulus 1 (to assess the animal’s belief of which block it was in), resulting in a gap in the red curve depicting Visual Stimulus 2. Middle, basic RL model fit to data. Bottom, RL model with belief state fit to data.</p></caption><graphic xlink:href="EMS157796-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>Cortex-wide map of prediction-error signalling.</title><p><bold>A</bold>. Schematic of widefield calcium imaging. <bold>B</bold>. Schematic of behaviour during a one-shot transition from an odour to visual block, indicating the three trial types used to identify prediction-error pixels. The first trial of the visual block contains an odour prediction error, due to the absence of an expected odour stimulus, which mice can use to infer the change in block type. Prediction-error pixels were defined as pixels with significantly different activity between the odour prediction-error period and both the odour period and no odour predicted period. <bold>C</bold>. Mean activity (columns 1-3) and significant prediction-error pixels (column 4) across 6 timepoints, aligned to expected/actual odour onset (N = 11 sessions, 4 mice). Significance column shows pixels with activity significantly different between odour prediction error and odour trials, and between odour prediction error and no odour predicted trials, with the t-statistic values from the comparison of column 1 and 2 displayed in colour code. <bold>D</bold>. Pixels with significant prediction-error signalling, averaged across 1.2-2.7s relative to the expected/actual odour onset. <bold>E</bold>. Activity profiles from the secondary motor cortex (top), primary visual cortex (middle) and olfactory bulb (bottom, ROIs shown in insets). Black line indicates periods during which the odour prediction-error response was significantly different from both the odour and no odour conditions (paired t-test, P &lt; 0.01 for more than 500ms, N = 4 mice).</p></caption><graphic xlink:href="EMS157796-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>Optogenetic inhibition of ACC impairs task-switching.</title><p><bold>A</bold>. Schematic of bilateral optic fibre implantation targeting both ACC and PL in each mouse. <bold>B</bold>. Example lick raster showing stimuli, lick and reward times during a transition from an odour to visual block during ACC silencing leading to impaired switching behaviour. <bold>C</bold>. Average number of trials required in a session to switch from an odour to visual block, N = 30 sessions, 8 mice, 3-4 sessions per silencing condition per mouse, shades of grey indicate individual mice here and below. Median ± interquartile range (IQR) for control 2.83 ± 2.83 trials, continuous ACC silencing 5.4 ± 4.34 trials, continuous PL silencing 2.75 ± 3.37 trials. Wilcoxon signed-rank test comparing control and continuous ACC silencing P = 0.0006, control and continuous PRL silencing P = 0.78, continuous ACC silencing and continuous PRL silencing P = 0.02. <bold>D</bold>. Histogram of number of trials taken to switch from odour to visual blocks during control and continuous ACC silencing sessions. N = 136 and 131 control and ACC silencing transitions respectively. One-shot transitions indicated by arrowhead. <bold>E</bold>. Proportion of transitions from odour to visual blocks that were one-shot. Grey circles represent means for individual mice (N = 8), lines represent means ± STD across mice. Mean ±STD for control 0.39 ± 0.27, continuous ACC silencing 0.19 ± 0.14, continuous PL silencing 0.36 ± 0.28. Chi-squared test of proportions comparing control and continuous ACC silencing P = 0.001, control and continuous PL silencing P = 0.65, continuous ACC silencing and continuous PL silencing P = 0.005. <bold>F</bold>. Steady-state stimulus discrimination performance after each successful block transition. Behavioural d-primes to visual stimuli in a visual block: control, continuous ACC silencing and continuous PL silencing sessions, 2.64 ± 0.55, 2.44 ± 0.38 and 2.46 ± 0.55 respectively, visual stimuli in an odour block 0.44 ±0.5, 0.54 ± 1.19, and 0.54 ± 0.89 respectively, and odour stimuli 2.64 ± 0.63, 2.87 ± 1.0, and 2.79 ± 0.57 respectively. Wilcoxon signed-rank tests as indicated, all Ps &gt; 0.05.</p></caption><graphic xlink:href="EMS157796-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>ACC neurons encode prediction-error signals.</title><p><bold>A</bold>. Top, schematic depicting two-photon imaging of neurons expressing GCaMP7f in the ACC through a microprism implant. Bottom, example ACC imaging site. <bold>B</bold>. Responses from 5 example neurons to task stimuli and running onsets. Shading here and below indicates SEM. <bold>C</bold>. Mean responses of all ACC neurons (N = 6878 neurons) aligned to task stimuli and behaviour. Activity was aligned ™1s to 3s around task stimulus or behaviour onset and mean baseline (™0.5s to 0s) subtracted. Each condition is sorted by the averaged activity from 0 to 1s. <bold>D</bold>. Time course of decoding accuracy of a binary classifier using neuronal activity of simultaneously imaged neurons from the ACC, mean of 9 sessions from 8 mice. Grey, decoding the two visual stimuli in the visual block, brown, decoding the two odour stimuli in the odour block, and purple, decoding block-type from activity aligned to the non-rewarded visual stimulus onset in the two blocks. <bold>E</bold>. Schematic of behaviour during a one-shot transition from an odour to visual block, indicating the three trial types used to identify prediction-error neurons. <bold>F</bold>. Example prediction-error neuron with a significantly larger response to the odour prediction-error condition (red), compared to the actual delivery of the odour (green) or trials where odours were neither predicted nor delivered (blue). <bold>G</bold>. Average response of all prediction-error neurons with a positive response to the odour prediction-error condition, in the three conditions as described in <bold>F</bold> (N = 168 neurons, Wilcoxon signed-rank test between the prediction error and odour conditions averaged 0 to 1.5s, *** P = 1.69×10<sup>-28</sup>). <bold>H</bold>. Proportions of neurons with significantly different activity (averaged 0 to 1.5s) between the three trial types described in <bold>e</bold>. Type A and Type B were significantly different only when comparing odour prediction error to odour (N=2007 neurons, 29%) or to no odour predicted conditions (N = 567 neurons, 8%) respectively. Prediction-error neurons were defined as neurons significantly different in both comparisons (N = 616 neurons, 9%, total 6878 neurons, 10 mice). <bold>I</bold>. Left, schematic of two-photon calcium imaging from primary visual cortex (V1). Right, same comparisons as in <bold>H</bold> with neurons recorded from V1 (N = 18 Type A, 1%, 41 Type B, 2%, and 35 prediction-error neurons, 1.6%, total 2138 neurons, 4 mice) <bold>J</bold>. Top, schematic of retrograde labelling and imaging strategy. Bottom, example image of retrogradely labelled striatal-projecting (CTB-Alexa647 labelled) and non-striatal projecting neurons in the ACC. <bold>K</bold>. Percentages of recorded neurons significantly responsive to each of 9 task events. <bold>L</bold>. Proportion of prediction-error neurons from striatal-projecting and non-striatal projecting neurons in ACC. Striatal projecting: N =124 Type A (29%), 30 Type B (7%), 21 prediction-error neurons (5%), total 421 neurons. Non-striatal projecting: N = 1384 Type A (28%), 392 Type B (8%), 484 prediction-error neurons (10%), total 4888 neurons, 8 mice). <bold>M</bold>. Bootstrapped distribution of proportion of prediction-error neurons in non-striatal projecting neurons. Data for proportion of striatal projecting prediction-error neurons indicated as vertical line. Data is outside the 99% confidence intervals.</p></caption><graphic xlink:href="EMS157796-f004"/></fig><fig id="F5" position="float"><label>Figure 5</label><caption><title>ACC prediction-error signal duration corresponds to requirement of the ACC in task switching.</title><p><bold>A</bold>. Mean response of all positively responding prediction-error neurons (N = 168 neurons) aligned to the odour prediction-error event, and to the next visual stimulus onset (grey shading). Response shown to the odour prediction-error event (red) and actual odour delivery (green). Wilcoxon signed-rank test between the two conditions averaged 0 to 1.5s from prediction-error event and -0.5 to 0 s from the next stimulus onset, *** P = 1.69x10<sup>-28</sup> and P = 5.45x10<sup>-15</sup> respectively. <bold>B</bold>. Schematics depicting inter-trial-interval (ITI) and peri-stimulus silencing epochs. <bold>C</bold>. Number of trials required in a session to switch from an odour to visual block, median ± IQR here and below, control 2.83 ± 2.83 trials, ITI ACC silencing 3.8 ± 3.79 trials, and peri-stimulus ACC silencing 4.0 ± 6.98 trials. Wilcoxon signed-rank tests comparing control and ITI sessions P = 0.02, control and peri-stimulus sessions P = 0.009, ITI and peri-stimulus sessions P = 0.39. <bold>D</bold>. Mean odour prediction-error response relative to pre-event baseline aligned to the same temporal epoch over consecutive trials (T is first prediction-error event in an odour to visual block transition), shown up to 3 trials following first prediction-error event (Wilcoxon signed-rank test, average -0.5 to 0s compared to 0 to 1.5 s, *** P = 2.98x10<sup>-15</sup>). Bottom, example neuron responses showing the rapid decay of prediction-error response over trials. <bold>E</bold>. Schematic depicting silencing during the entire session except for one trial at each odour to visual block transition. <bold>F</bold>. Number of trials required in a session to switch from an odour to visual block, control 2.83 ± 2.25 trials, continuous ACC silencing 5.4 ± 4.34 trials, one trial un-silencing 1.0 ± 0.82 trials, Wilcoxon signed rank test comparing control and continuous ACC silencing sessions P = 0.0006, control and one trial un-silencing P = 0.0084, continuous ACC silencing and one trial un-silencing P = 0.0016.</p></caption><graphic xlink:href="EMS157796-f005"/></fig><fig id="F6" position="float"><label>Figure 6</label><caption><title>Larger prediction-error signals in ACC precede one-shot block transition behaviour.</title><p><bold>A</bold>. Schematic showing odour to visual block transitions and the prediction-error response preceding two scenarios, top, where the mouse executes a one-shot block transition, or switch, and bottom, where the block transition is slower than one-shot. Red and yellow responses are prediction-error responses from an example neuron, green shows the response to delivery of odour, shading indicates SEM here and below. <bold>B</bold>. Left, odour prediction-error response of two example neurons preceding a one-shot (red) or slower transition (yellow). Right, mean responses across all positively-responding prediction-error neurons (N = 146 neurons) preceding one-shot and slower transitions (Wilcoxon signed rank test between the two conditions averaged 0 to 1.5 s from prediction-error event and -0.5 to 0 s from the next stimulus onset, *** P = 0.0003, * P = 0.019). <bold>C</bold>. Prediction-error signal amplitude from the Belief-State RL model, preceding one-shot transitions and slower transitions, *** P &lt; 10<sup>-8</sup>, N = 70 transitions.</p></caption><graphic xlink:href="EMS157796-f006"/></fig><fig id="F7" position="float"><label>Figure 7</label><caption><title>All-optical VIP interneuron bidirectional perturbations in ACC disrupt prediction-error signalling.</title><p><bold>A</bold>. Hypothesis from theoretical work for a cortical circuit to compute prediction errors. The prediction-error neuron will respond (positive or negative responses) when predictions and observations do not cancel each other out. Part of this hypothesis is tested by activating and inhibiting VIP interneurons during task-switching. <bold>B</bold>. Left, example site with neurons expressing GCaMP7f in green and VIP interneurons expressing the excitatory opsin ChrimsonR in red. Right, schematic of our all-optical approach: simultaneous 2-photon imaging and optogenetic activation or inhibition of VIP interneurons in the ACC. <bold>C</bold>. Top, peri-stimulus time histograms of mean activity of all non-VIP neurons (N = 2467 neurons, 8 mice) aligned to light onset, at 5 different light powers, for 1.5s. Shading and error bars indicate mean ± SEM here and below. Bottom, average activity of all neurons across light presentation window (0-1.5s). Inset: Image of an example VIP interneuron (arrowhead) and its response to increasing light powers, demonstrating photoactivation. <bold>D</bold>. Schematic of inter-trial-interval (ITI) activation epoch. <bold>E</bold>. Proportions of cells showing prediction-error responses and other cell classes as in <xref ref-type="fig" rid="F4">Fig. 4H</xref>. Left, control and right, ITI VIP activation sessions from the same sites, performed on subsequent days. <bold>F</bold>. Top, average activity in each trial type of positively responding prediction-error cells identified from each session. Bottom, mean response (0 to 1.5s) of these cells to odour prediction error (left, red) and odour (right, green). Wilcoxon rank-sum tests comparing control vs ITI sessions, prediction-error responses P = 1.1x10<sup>-4</sup>, odour responses P = 0.93. <bold>G</bold>. Top, schematic of peri-stimulus activation/inhibition epoch. Bottom, time course of decoding accuracy of a binary classifier using neuronal activity during peri-stimulus VIP activation sessions (N = 4603 neurons, 8 mice), decoding task stimuli as in <xref ref-type="fig" rid="F4">Fig. 4D</xref>. H. Proportions of cells showing prediction-error responses and other cell classes as in <xref ref-type="fig" rid="F4">Fig. 4H</xref>. Left, control and right, ITI VIP inhibition sessions from the same sites, performed on subsequent days. <bold>I</bold>. Time course of decoding accuracy with a binary classifier using activity during peri-stimulus VIP inhibition sessions (N = 888 neurons, 3 mice). <bold>J</bold>. Proportions of cells showing prediction-error responses and other cell classes as in <xref ref-type="fig" rid="F4">Fig. 4H</xref>. Left, no light and right, ITI light only control sessions from the same sites, performed on subsequent days.</p></caption><graphic xlink:href="EMS157796-f007"/></fig><table-wrap id="T1" orientation="portrait" position="float"><label>Table 1</label><caption><title>Best-fit parameters for each model.</title></caption><table frame="box" rules="all"><thead><tr><th valign="top" align="left">Type of model / experimental data</th><th valign="top" align="left">Fixed parameters</th><th valign="top" align="left">Fitted parameters</th><th valign="top" align="left">Mean ± SD of RMSEs across 5 seeds</th></tr></thead><tbody><tr><td valign="top" align="left">Basic RL on primary dataset</td><td valign="top" align="left"><italic>N</italic> = 2,000,000<break/>(1,000,000 during fitting)</td><td valign="top" align="left"><italic>∈, α</italic> = 0.236, 0.9</td><td valign="top" align="left">0.158488 ± 0.018537</td></tr><tr><td valign="top" align="left">Belief-state RL on primary dataset</td><td valign="top" align="left"><italic>N</italic> = 500,000<break/><italic>α</italic> = 0.1 during training, = 0 during testing</td><td valign="top" align="left"><italic>ζ, β, ∈, ∈′</italic>=<break/>0.6858, 1.997, 0.049,<break/>0.280</td><td valign="top" align="left">0.080526 ± 0.004806</td></tr><tr><td valign="top" align="left">Belief-state RL on ACC silencing dataset with ACC not silenced</td><td valign="top" align="left">N=500,000<break/><italic>α</italic> = 0.1 during training, = 0 during testing</td><td valign="top" align="left"><italic>ζ, β, ∈, ∈′</italic>=<break/>0.7698, 1.987, 0.1072,<break/>0.4516</td><td valign="top" align="left">0.053635 ± 0.001487</td></tr><tr><td valign="top" align="left">Belief-state RL on ACC silencing dataset with ACC silenced</td><td valign="top" align="left">N=500,000<break/><italic>α</italic> = 0.1 during training, = 0 during testing<break/><italic>ζ, β, ∈, ∈′</italic>=<break/>0.7698, 1.987, 0.1072,<break/>0.4516</td><td valign="top" align="left">ACC inhibition factors on prediction error for visual and odour trials<break/>= 0.2143, 0.5016</td><td valign="top" align="left">0.0742734 ± 0.000907</td></tr></tbody></table></table-wrap></floats-group></article>