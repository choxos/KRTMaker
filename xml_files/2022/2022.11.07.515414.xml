<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS156800</article-id><article-id pub-id-type="doi">10.1101/2022.11.07.515414</article-id><article-id pub-id-type="archive">PPR567972</article-id><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Effective design and inference for cell sorting and sequencing based massively parallel reporter assays</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Gilliot</surname><given-names>Pierre-Aurélien</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Gorochowski</surname><given-names>Thomas E.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib></contrib-group><aff id="A1"><label>1</label>School of Biological Sciences, University of Bristol, Life Sciences Building, 24 Tyndall Avenue, Bristol, BS8 1TQ,UK</aff><aff id="A2"><label>2</label>BrisEngBio, School of Chemistry, University of Bristol, Cantock’s Close, Bristol, BS8 1TS,UK</aff><pub-date pub-type="nihms-submitted"><day>09</day><month>11</month><year>2022</year></pub-date><pub-date pub-type="preprint"><day>07</day><month>11</month><year>2022</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">The ability to measure the phenotype of millions of different genetic designs using Massively Parallel Reporter Assays (MPRAs) has revolutionised our understanding of genotype-to-phenotype relationships and opened avenues for data-centric approaches to biological design. However, our knowledge of how best to design these costly experiments and the effect that our choices have on the quality of the data produced is lacking. Here, we tackle this issue by developing FORECAST, a Python package that supports the accurate simulation of cell-sorting and sequencing based MPRAs and robust maximum likelihood based inference of genetic design function from MPRA data. We use FORECAST’s capabilities to reveal rules for MPRA experimental design that help ensure accurate genotype-to-phenotype links and show how the simulation of MPRA experiments can help us better understand the limits of prediction accuracy when this data is used for training deep learning based classifiers. As the scale and scope of MPRAs grows, tools like FORECAST will help ensure we make informed decisions during their development and the most of the data produced.</p></abstract><kwd-group><kwd>massively parallel reporter assay</kwd><kwd>fluorescence activated cell sorting</kwd><kwd>sequencing</kwd><kwd>synthetic biology</kwd></kwd-group></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P2">The falling costs of DNA synthesis and sequencing are enabling new approaches to understand how biological function is genetically encoded [<xref ref-type="bibr" rid="R1">1</xref>–<xref ref-type="bibr" rid="R3">3</xref>]. Many of these emerging techniques exploit our newly found ability to create large libraries of precisely designed DNA sequences (i.e., a diverse set of genotypes) and efficiently assess how each of these sequences is linked to a cellular behaviour (i.e., their individual phenotypes) [<xref ref-type="bibr" rid="R4">4</xref>–<xref ref-type="bibr" rid="R7">7</xref>]. Unravelling such genotype-to-phenotype maps (GP maps) via data-centric approaches has lead to the creation of statistical models that are able to effectively design <italic>de novo</italic> genetic regulatory elements [<xref ref-type="bibr" rid="R8">8</xref>–<xref ref-type="bibr" rid="R11">11</xref>] and better understand the principles of evolution [<xref ref-type="bibr" rid="R12">12</xref>, <xref ref-type="bibr" rid="R13">13</xref>].</p><p id="P3">Massively Parallel Reporter Assays (MPRAs) are a key development that has made this approach possible. This method involves generating a library of diverse genotypes whose phenotypes are linked to the expression of a fluorescence-based reporter. Using highly parallel measurement techniques, millions of genotype-to-phenotype relationships can then be established during a single experiment. Crucially, the scale of these assays ensures sufficient sampling of key areas in sequence space such that statistical models can capture or learn important features of the GP map.</p><p id="P4">One of the most popular MPRAs is based on Fluorescence Activated Cell Sorting (FACS) followed by deep sequencing and is commonly referred to as Flow-seq or Sort-seq (<xref ref-type="fig" rid="F1">Figure 1a</xref>) [<xref ref-type="bibr" rid="R5">5</xref>, <xref ref-type="bibr" rid="R8">8</xref>, <xref ref-type="bibr" rid="R10">10</xref>, <xref ref-type="bibr" rid="R12">12</xref>, <xref ref-type="bibr" rid="R14">14</xref>–<xref ref-type="bibr" rid="R19">19</xref>, <xref ref-type="bibr" rid="R19">19</xref>–<xref ref-type="bibr" rid="R23">23</xref>]. In a Flow-seq experiment, cells are engineered to link the phenotype of interest with the expression level of a fluorescent reporter protein. This pool of cells is then sorted into bins covering different levels of fluorescence, and the contents of each bin separately sequenced to determine the genotypes associated with that observed phenotype (i.e., fluorescence intensity). The ability to generate diverse genetic libraries with approaches like highly parallel chip-based oligo synthesis, and then sort and sequence hundreds of millions of cells has enabled GP maps to be produced in unprecedented detail for many genetic parts and systems [<xref ref-type="bibr" rid="R18">18</xref>].</p><p id="P5">While Flow-seq based MPRAs have revolutionised our ability to map out genotype-to-phenotype landscapes, the discrete binning by cell fluorescence that is necessary during the sorting phase raises issues when trying to recover a continuous fluorescence distribution for a genetic variant and accurately quantify the uncertainty in such measurements. This is problematic, as data sets exhibiting large levels of noise are ill-suited to data-driven model identification [<xref ref-type="bibr" rid="R24">24</xref>]. Some experimental studies have attempted to vary key experimental factors to assess and improve measurement accuracy (e.g., varying the number of sorting bins) [<xref ref-type="bibr" rid="R14">14</xref>, <xref ref-type="bibr" rid="R22">22</xref>, <xref ref-type="bibr" rid="R23">23</xref>]. However, these have not generally been systematic in their approach. Therefore, the numerous options available when developing a new Flow-seq based MPRA are typically chosen arbitrarily or to mimic previous studies. Furthermore, the methods used to infer fluorescence distributions from discretely binned Flow-seq data are often basic and can lead to biased results. More accurate estimators have been derived, but their complexity has hindered broad uptake. [<xref ref-type="bibr" rid="R10">10</xref>, <xref ref-type="bibr" rid="R25">25</xref>].</p><p id="P6">In this work, we aim to address these challenges by developing a Python package called FORECAST that implements an efficient Maximum Likelihood (ML) based inference method and a probabilistic model of Flow-seq experiments to allow for the systematic computational exploration of parameters associated with both the experimental and analysis procedures. We demonstrate the ability of FORECAST to uncover the most critical choices when designing a Flow-seq experiment to ensure accurate inference of fluorescence distributions, and show how we can more rigorously explain the performance and source of errors for deep learning based models trained using real Flow-seq data sets. The ability of FORECAST to both aid in the design of new Flow-seq experiments and accurately analyse existing data sets makes it a valuable tool for supporting the creation of accurate models to both engineer and understand the genetic encoding of biological functions.</p></sec><sec id="S2" sec-type="results"><title>Results</title><sec id="S3"><title>Overview of FORECAST</title><p id="P7">The FORECAST package implements two core functionalities (<xref ref-type="fig" rid="F1">Figure 1b</xref>). The first is a probabilistic simulator of Flow-seq experiments, where all major parameters for an experimental design can be varied. Each step in a Flow-seq experiment is considered covering: the diversity of the genetic library that acts as input (i.e., the number of unique genetic variants), the sampling and sorting of a mixed pool of cells harbouring this library, the amplification of sorted designs by cell growth or PCR, and the final sequencing step that captures for each genetic variant the number of reads recovered from each bin (<xref ref-type="sec" rid="S8">Methods</xref>).</p><p id="P8">In addition to the simulation of experiments, FORECAST also implements several inference methods for estimating precise fluorescence distributions from discretely binned Flow-seq data. We provide two options for inference that use either a Method of Moments (MOM) or Maximum Likelihood (ML) based approach (<xref ref-type="fig" rid="F1">Figure 1c</xref>). The MOM approach is mostly agnostic to the data-generating process, while the ML approach explicitly models the Flow-seq sorting and sequencing steps in its likelihood function. Practically, the MOM approach finds estimates by a weighted average of the binned data, whereas the ML approach minimises the likelihood function of an inhomogeneous Poisson process. Both estimators allow for fluorescence of a particular genetic variant to take the form of either a Gamma or Log-normal distribution to capture the inherent variation that is present in gene expression across a population of cells [<xref ref-type="bibr" rid="R26">26</xref>–<xref ref-type="bibr" rid="R28">28</xref>] (<xref ref-type="sec" rid="S8">Methods</xref>). These inference methods can be easily applied to existing Flow-seq data sets or FORECAST-generated computational simulations.</p></sec><sec id="S4"><title>Improved inference for Flow-seq data</title><p id="P9">A critical step in a Flow-seq experiment is the inference of a continuous fluorescence distribution from the discretely binned sequencing data. It is common for this step to make use of a simple MOM estimator where a mid-point fluorescence value for each sorting bin is weighted according to the relative read frequencies across them. Although this approach is known to be unreliable and susceptible to noise in fluorescence measurements, it is still a common method due to the ease of implementation [<xref ref-type="bibr" rid="R18">18</xref>, <xref ref-type="bibr" rid="R25">25</xref>, <xref ref-type="bibr" rid="R29">29</xref>]. An alternative and more robust method is to use an ML based approach [<xref ref-type="bibr" rid="R10">10</xref>, <xref ref-type="bibr" rid="R25">25</xref>], but efficient implementation of this method can be difficult and the benefits compared to MOM in this context are not well understood.</p><p id="P10">To better understand the impact of the inference method on the quality of the recovered distributions from Flow-seq experiments, we made use of the simulation capabilities of FORECAST to generate a large and biologically realistic Flow-seq data set with a known ground truth for every genetic variant in the library. We specifically simulated a Flow-seq experiment with a library containing 1018 genetic variants that had Gamma distributed fluorescence, mimicking biologically realistic protein expression characteristics [<xref ref-type="bibr" rid="R26">26</xref>] (<xref ref-type="sec" rid="S8">Methods</xref>). In this experiment, we sorted 10<sup>6</sup> cells into 8 bins, amplified the sorted cells by a factor of 1000, and performed sequencing using 10<sup>7</sup> reads. We then conducted inference on this synthetic Flow-seq data using both the MOM and ML estimators implemented in FORECAST.</p><p id="P11">The accuracy of both inference methods was assessed by comparing the mean and standard deviation (SD) of the estimated fluorescence distribution for each genetic variant with the known ground truth (<xref ref-type="fig" rid="F2">Figure 2a,b</xref>). We found that the ML estimates closely matched the ground truth with a Mean Absolute Percentage Error (MAPE) of 3% and 5% for the mean and SD, respectively. In contrast, the MOM estimates were continually higher than the ground truth with MAPE values of 42% and 81% for the mean and SD, respectively. Furthermore, the MOM estimates displayed a ‘staircase’ pattern that was highly pronounced for the SD estimates (<xref ref-type="fig" rid="F2">Figure 2b</xref>). More detailed analysis of this pattern revealed that MOM estimates of fluorescence SD are similar for genetic variants sorted in the same bins (<xref ref-type="fig" rid="F2">Figure 2b,f,g</xref>), but vary strongly when cells fall across multiple bins (<xref ref-type="fig" rid="F2">Figure 2b,h</xref>). This artifact results from the fact that the MOM method assumes a fixed (centre point) value of fluorescence for every design in a bin, which makes it highly sensitive to cells for a design falling near bin boundaries. We confirmed that binning was the cause of this feature by running additional simulations with an increasing number of bins. As expected, this resulted in a larger number of ‘stairs’ in the inferred mean and SD values across the library of designs (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 1</xref>).</p><p id="P12">To further characterize the statistical properties of the estimators, we measured the bias (i.e., the closeness between the estimates and the true value) and variance (i.e., the dispersion from the mean prediction) of each estimator by simulating a further 500 Flow-seq experiments for the same library and identical experimental parameters (<xref ref-type="sec" rid="S8">Methods</xref>). The sampled distributions for the fluorescence mean and SD estimators across these replicates consistently showed smaller bias when using the ML inference method. The mean ratio (ML/MOM) for the bias was found to be 0.005 for the mean and 0.016 for the SD. An example of the sampled variation for a specific genetic variant is shown in <xref ref-type="fig" rid="F2">Figure 2c,d</xref> and for the entire genetic library in <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2 a,b</xref>. The variance of both estimators was comparable between the methods, with a mean ratio (ML/MOM) of 0.86 and 1.17 for the fluorescence mean and SD, respectively (<xref ref-type="fig" rid="F2">Figure 2c,d</xref>; <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2</xref>).</p><p id="P13">We further investigated the ability of each inference method to globally recover the underlying fluorescence distributions by measuring the 1-Wasserstein distance (WD) between the inferred and ground truth distributions. Intuitively, the WD measures the minimum cost of transforming one distribution into another and indicates the closeness between them. Using this distance metric, ML-inferred fluorescence distributions were found to always be closer to the ground truth than MOM-inferred versions, with a maximum ratio (WD<sub>ML</sub>/WD<sub>MOM</sub>) of 0.34 between the two methods. An example of the WD sampled distribution for one genetic construct is shown in <xref ref-type="fig" rid="F2">Figure 2e</xref> and for the entire genetic library in <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 2</xref>.</p><p id="P14">An additional benefit of using the ML approach is that it provides uncertainty information in the form of confidence intervals (<xref ref-type="sec" rid="S8">Methods</xref>). We validated the theoretical derivation of the confidence intervals by using the replicate Flow-seq simulations (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 4</xref>) and measured the coverage rate (i.e., the number of times the confidence interval contains the true value) (<xref ref-type="sec" rid="S8">Methods</xref>; <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 5</xref>). We found that the simulation results reliably matched the confidence intervals produced from the limited number of cells and sequencing reads used.</p><p id="P15">While these results demonstrated that ML inference provides a more accurate estimation of a genetic construct’s fluorescence distribution, it comes at a computational cost. Comparing the run-time for MOM and ML estimators revealed that our ML estimator was approximately 4,000 times slower to compute. On average for a typical desktop computer, MOM inference took ~ 77 × 10<sup>–3</sup> ms to compute for a simple construct compared to ~ 340 ms when using the ML method (<xref ref-type="sec" rid="S8">Methods</xref>). To overcome potential run-time difficulties when millions of ML estimates are required, we implemented multiprocessing in FORECAST to allow for the ML computations to be parallelized. We tested the scaling characteristics of our code from 1 to 28 processor cores and found a linear scaling (factor = 0.6) with no decrease in the ability to utilize newly available cores (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 6</xref>).</p></sec><sec id="S5"><title>Optimal design of Flow-seq experiments</title><p id="P16">Flow-seq experiments are costly and time-consuming to perform. Yet, their design is often arbitrarily based on other studies, which provides no guarantee as to the quality or accuracy of the data that will be produced. This stems from difficulties in testing the effect that experimental parameters will have on the ability to infer accurate phenotypes from data. To address this, we again employed FORECAST’s ability to simulate Flow-seq experiments and systematically explored the experimental design space to better understand the influence of each experimental factor (<xref ref-type="sec" rid="S8">Methods</xref>). We varied the number of cells sorted and sequencing reads per genetic variant, as well as the number of logarithmically spaced bins used for cell sorting, as these are the key factors that map to common choices when carrying out an Flow-seq experiment (e.g., the types of sequencer used or setting on a FACS machine). We also used both the MOM and ML estimators to infer the fluorescence distribution for each experimental design and characterized the error between the inferred and ground truth for every genetic variant as a measure of accuracy.</p><p id="P17">We first explored the impact of varying each experimental parameter on the global accuracy of the two inference methods by computing the mean of the WD (MWD) across the entire genetic variant library. Increasing the number of cells sorted, sequencing reads, and sorting bins all improved the accuracy of the inferred values (i.e., lower MWD values; <xref ref-type="fig" rid="F3">Figure 3a–d</xref>). Furthermore, inference using ML consistently outperformed the MOM approach, with the gap in performance becoming reduced as the number of sorting bins increased. We also see a reduction in MWD for the ML estimates as the number of reads and cells per genetic variant increases. This is coherent with the asymptotic consistency of ML estimates, supporting the fact that this method can recover an underlying distribution with arbitrary precision [<xref ref-type="bibr" rid="R30">30</xref>].</p><p id="P18">Similar observations are seen for the local behavior of each inference method, which was assessed using the Mean Absolute Percentage Error (MAPE) of the fluorescence mean or SD (<xref ref-type="fig" rid="F3">Figure 3c,d</xref>). We found that the relative error made using the ML approach is always smaller compared with the MOM approach (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 7</xref>). Furthermore, we observed that estimating the fluorescence SD is more challenging than estimating the mean with the MAPE of the SD being 5 times larger than the MAPE of the mean for both inference methods (MAPE ratios across all sequencing reads and inference methods are provided in <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 7</xref>).</p><p id="P19">To quantify the relative importance of each experimental factor, we used a multiple linear regression model to capture the relationship between the MWD and the number of bins, sequencing reads, and cells sorted per genetic variant (<xref ref-type="sec" rid="S8">Methods</xref>). By extracting the coefficient for each predictor variable, we could compare the importance of every experimental factor for each inference method. We found that the number of bins was twice as important for accurate MOM inference compared to when ML was used. Furthermore, increases in the number of sequencing reads and cells per genetic variant improved the accuracy of inference for both methods, although with diminishing returns (<xref ref-type="fig" rid="F3">Figure 3a</xref>).</p><p id="P20">Our ability to observe how various experimental factors affect the accuracy of inference, offers the chance to provide rules that could help ensure a good accuracy of measurements when designing an MPRA experiment. To determine these ideal parameters, we analyzed the diminishing returns phenomena observed when increasing each experimental parameter (<xref ref-type="fig" rid="F3">Figure 3a,b</xref>). We found that a constant decrease in MWD required increasing resources. Therefore, we would expect a point where the relative cost in terms of the scale of an experiment is no longer worth the corresponding benefit in improved measurement accuracy. By assuming constant relative costs, we determined the optimal operating points for each experimental factor using the kneedle algorithm [<xref ref-type="bibr" rid="R31">31</xref>, <xref ref-type="bibr" rid="R32">32</xref>] (<xref ref-type="fig" rid="F3">Figure 3a</xref>; <xref ref-type="sec" rid="S8">Methods</xref>). It should be noted that this approach could be extended to account for varying costs of factors in the experimental design by weighting each of these accordingly.</p><p id="P21">To extract the optimal number of reads, we plotted the MWD as a function of the normalized number of reads and located the optimal operating point (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 8</xref>). The MWD was taken by averaging over all simulations from the factorial experiment (<xref ref-type="sec" rid="S8">Methods</xref>). Similarly, we extracted the optimal number of cells by plotting MWD as a function of the normalized number of cells and using the same procedure (<xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 8</xref>). Finally, we found the optimal number of bins by plotting the MWD as a function of the number of bins, while setting the number of cells and reads to their optimal value. This process was repeated across all simulated data from the factorial experiment, and we found that the most frequent operating point was 100 for both the number of cells and sequencing reads per genetic variant (<xref ref-type="fig" rid="F3">Figure 3f,g</xref>). This combination of parameters corresponds to sequencing on average all cells in the library before amplification. Using this operating point for the sequencing reads and cells, we found that 10 bins was optimal for cell sorting (<xref ref-type="sec" rid="S8">Methods</xref>; <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 9</xref>). While these general rules are useful for guiding future experiments, the response curves we have generated can also be used to select experimental parameters where specific costs and trade-offs exist for a particular experimental setup and a known level of accuracy is required.</p></sec><sec id="S6"><title>Unraveling sources of errors when using Flow-seq data</title><p id="P22">The large amounts of data produced by Flow-seq experiments are ideal for training deep learning-based models [<xref ref-type="bibr" rid="R10">10</xref>, <xref ref-type="bibr" rid="R22">22</xref>, <xref ref-type="bibr" rid="R33">33</xref>]. A challenge in this context is knowing what sort of accuracy can be achieved by a model given the inherent variability in the underlying biology and experimental procedures.</p><p id="P23">To show how FORECAST can help to answer this, we considered a recent study by Evfratov <italic>et al.</italic> that investigated how a messenger RNA’s 5’ untranslated region (5’UTR) regulates the translation initiation rate of an associated reporter gene [<xref ref-type="bibr" rid="R16">16</xref>]. This study involved a Flow-seq experiment in which a library of ~ 28,000 different genetic variants was tested. Using data from this experiment as our ground truth, we defined a classification task where the bin (1 to 8) in which the majority of cells were sorted (i.e., the ’mode bin’) needed to be predicted for each genetic variant. This task and the amount of available data are well suited to a deep learning-based classifier and provided an opportunity to systematically assess how experimental design choices might limit the predictive accuracy that could be achieved and pinpoint the sources of errors.</p><p id="P24">Due to the stochastic nature of the sorting and sequencing steps in a Flow-seq experiment, we would expect some mode bin measurements to potentially vary between experiments (especially for genetic variants whose mode fluorescence falls near bin boundaries). To estimate the experimental-level accuracy that can be achieved due to this effect, we simulated many Flow-seq experiments with a varying number of sequencing reads and sorted cells for each genetic variant (<xref ref-type="sec" rid="S8">Methods</xref>). For each genetic variant and combination of experimental factors, we measured the mode bin and compared it to the ground truth. We then obtained a frequency of correct mode bin measurements for each experimental factor by averaging over the genetic library and simulation replicates. We found that measuring the mode bin from Flow-seq data can be difficult, especially in regimes of low-experimental resources where the frequency of correct mode bin measurements can be as low as 50% (<xref ref-type="fig" rid="F4">Figure 4a</xref>; <xref ref-type="sec" rid="S8">Methods</xref>). Increasing the number of sequencing reads and cells sorted was found to improve the accuracy of mode bin measurements, although with diminishing returns.</p><p id="P25">These estimates for the frequency of correct mode bin assignments allow us to quantify the maximum accuracy that can be reached for any model trained or fitted to the data from this Flow-seq study. To empirically assess this, we split the data into a training set (80%), validation set (10 %), test set (10%), and then computed the maximum achievable accuracy of a model on each data split by pulling the corresponding frequency of correct mode bin measurements given the experimental resources it was calculated from. To ensure some differences in the achievable accuracies, the test set was selected to have a higher maximum accuracy (75% compared to 70% for both the training and validation sets) by selecting genetic variants with the most sequencing reads (<xref ref-type="sec" rid="S8">Methods</xref>).</p><p id="P26">Having selected appropriate data sets, we next needed a model to learn how 5’UTR sequence mapped to protein expression level. While mechanistic models of translation initiation do exist [<xref ref-type="bibr" rid="R34">34</xref>, <xref ref-type="bibr" rid="R35">35</xref>], they typically are not highly predictive when applied to data sets not used for fitting. In contrast, machinelearning based models using deep neural networks have made large strides in this domain, allowing for automatic feature extraction and the best predictive accuracies seen to date [<xref ref-type="bibr" rid="R36">36</xref>–<xref ref-type="bibr" rid="R38">38</xref>].</p><p id="P27">Here, we selected four common deep neural network architectures to learn the mapping between 5’UTR sequence and the translation efficiency (i.e. fluorescence) from data. In particular, we considered a Multi-Layer Perceptron (MLP), Convolutional Neural Network (CNN) using an MLP for feature expraction as a final step, Recurrent Neural Network (RNN) (<xref ref-type="fig" rid="F4">Figure 4b</xref>) and hybrid CNN+RNN. All of these neural network architectures were trained to predict the mode bin from the 5’UTR sequence on the training set, and a medium-sized hyperparameter optimization on the validation set was used to compare the performance of each architecture (<xref ref-type="sec" rid="S8">Methods</xref>). We found that the best-performing architecture was the hybrid CNN+RNN, with a validation accuracy of 48%, compared to a possible maximum accuracy of 70% (<xref ref-type="fig" rid="F4">Figure 4c</xref>).</p><p id="P28">At least two reasons could explain the 22% gap between the validation accuracy and the maximum achievable accuracy. Firstly, the approximations used to model Flow-seq experiments might be too simplistic, meaning the estimates for the maximum achievable accuracy are overly optimistic. Secondly, the neural network model might need further refinement and additional training data to better approximate the mapping between sequence and function.</p><p id="P29">To explore the first hypothesis, we evaluated the performance of the hybrid CNN+RNN model that had minimal model complexity (i.e., number of trainable parameters) while maximizing validation accuracy on the test data set (<xref ref-type="fig" rid="F4">Figure 4c</xref>). We found that this architecture achieves a~4% improvement in accuracy on the test set (51.8% accuracy on the test set compared to 48.3% on the validation set; <xref ref-type="supplementary-material" rid="SD1">Supplementary Figure 10</xref>), which closely matches the 5% increase in accuracy predicted by the simulations (maximum accuracy limit of 75% on the test set compared to 70% on the validations set). This suggests that the magnitude of the experimental-level accuracy estimates are likely correct and that further data is required for the model to better capture the complex relationship between sequence and function.</p><p id="P30">In addition, by plotting the confusion matrix, we observed that the distribution of errors was not random, with most errors corresponding to predictions ±1 bin away from the true mode bin (<xref ref-type="fig" rid="F4">Figure 4d</xref>). This type of error is coherent with our simulations, as inaccurate mode bin measurements are typically in a neighboring bin of the true mode bin. In summary, the ability to estimate limits on achievable accuracies by simulating actual Flow-seq experiments provides valuable insight into what we can expect to achieve with state-of-the-art models and how model performance is best assessed.</p></sec></sec><sec id="S7" sec-type="discussion"><title>Discussion</title><p id="P31">As data-centric approaches to biological design and understanding rise in popularity, it is vital to make the best use of the costly and time-consuming experiments that fuel them. Here, we have shown how FORECAST can support both effective experimental design and improved inference when using large-scale datasets from Flow-seq based MPRAs. Through extensive simulation, we demonstrated how increases in the scale of a Flow-seq experiment resulted in diminishing returns for the accuracy of inferred phenotypes. This allowed us to derive some simple advice to ensure good quality data is produced from an Flow-seq based MPRA: a library with <italic>n</italic> different genetic variants should at least be sorted in 10 bins, with 100 cells and sequencing reads per variant. We see this recommendation as an easy-to-apply rule to help design effective Flow-seq experiments that typically sets a limit on the size of the library that can be considered given the available sorting and sequencing resources. For example, a lab using a MiSeq sequencer offering 20 million reads per run can characterise a library containing a maximum of ’200,000 different genetic variants (assuming there is no bias in the initial library composition).</p><p id="P32">Ensuring the most is made of this data is also crucial and we have shown how the ML-based inference method implemented by FORECAST provides a 16.2-fold improvement in MAPE compared to widely used MOM based approaches. Such improvements are supported by other studies that have applied ML to inference to MPRAs, but which did not account for the stochasticity introduced by the sequencing step [<xref ref-type="bibr" rid="R25">25</xref>]. The use of our ML estimator is not only compelling due to its ability to reach high inference accuracy from smaller-scale experiments, but it is also able to provide valuable information on the uncertainty of the estimates in the form of confidence intervals. Furthermore, existing Flow-seq data sets can benefit from this easy to use ML inference functionality, offering the potential to refine our understanding of core biological processes like transcription [<xref ref-type="bibr" rid="R10">10</xref>, <xref ref-type="bibr" rid="R14">14</xref>, <xref ref-type="bibr" rid="R17">17</xref>, <xref ref-type="bibr" rid="R39">39</xref>–<xref ref-type="bibr" rid="R42">42</xref>] and translation [<xref ref-type="bibr" rid="R8">8</xref>, <xref ref-type="bibr" rid="R12">12</xref>, <xref ref-type="bibr" rid="R17">17</xref>, <xref ref-type="bibr" rid="R20">20</xref>, <xref ref-type="bibr" rid="R23">23</xref>, <xref ref-type="bibr" rid="R33">33</xref>, <xref ref-type="bibr" rid="R43">43</xref>] via reanalysis.</p><p id="P33">Although FORECAST offers many benefits, there are some limitations to its use. The most prominent of these is the limited number of distributions available for describing the inherent variability in reporter expression for simulation and inference. The Log-normal and Gamma distributions included will cover most use cases. However, some biological processes can lead to complex expression profiles with bimodal features that are difficult to capture in a parametric form [<xref ref-type="bibr" rid="R8">8</xref>]. The open source nature of FORECAST’s code allows for other distributions to be implemented for specific use cases (<xref ref-type="sec" rid="S28">Data Availability</xref>), and an interesting future direction would be to include goodness of fit functionality (e.g., using a chi-squared test) to fit the distribution most appropriate to the data at hand.</p><p id="P34">In summary, this work demonstrates how computational methods can support many aspects of experimental and model design, allowing for the exploration of design areas that would otherwise be impractical or too expensive to investigate physically. As the scale of MPRAs increases, making the best use of the resources available and the data generated will be critical for unraveling accurate GP maps and offering new approaches to rationally engineering biology.</p></sec><sec id="S8" sec-type="methods"><title>Methods</title><sec id="S9"><title>Data-generating process</title><p id="P35">We considered the following generating process for each Flow-seq simulation. Let <italic>D</italic> be the diversity of the library (the number of different genetic variants), <italic>N</italic> the number of FACS events (i.e., the total number of sorted cells), <italic>B</italic> the number of bins used to sort the cells, [<italic>F<sub>j</sub></italic>, <italic>F</italic><sub><italic>j</italic>+1</sub>] the fluorescence bounds of sorting bin <italic>j</italic> and <italic>R</italic> the total number of sequencing reads. We use the lowercase versions of each parameter to refer to any value in between. The cell sorting step is modelled by the first loop, while the second loop models the sequencing step.</p></sec><sec id="S10"><title>Verifying assumptions during simulation and inference</title><p id="P36">A multinomial sampling scheme (drawing with replacement) was used to model the sequencing step in the Flow-seq simulations. Although an hypergeometric sampling scheme (drawing without replacement) would be more appropriate, <boxed-text id="BX1" position="anchor" content-type="below"><caption><title>Algorithm 1 Generate Flow-Seq data</title></caption><p id="P37">1: Draw <italic>N</italic><sup>(1)</sup>,…,<italic>N</italic><sup>(<italic>D</italic>)</sup> ~ Multinomial(<inline-formula><mml:math id="M1"><mml:mrow><mml:mi>N</mml:mi><mml:mo>,</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>D</mml:mi></mml:mfrac><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>D</mml:mi></mml:mfrac></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>) to get the number of cells sorted for each genetic variant (<italic>d</italic>).</p><p id="P38">2: <bold>for</bold> each genetic variant (<italic>d</italic>) <bold>do</bold></p><p id="P39">3:       Draw <italic>N</italic><sup>(<italic>d</italic>)</sup> samples from the fluorescence distribution g<sup>(d)</sup><sub>θ</sub></p><p id="P40">4:       Sort samples in the appropriate fluorescence bin</p><p id="P41">5:       Count number of samples in each bin: <inline-formula><mml:math id="M2"><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msubsup><mml:mi>N</mml:mi><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>N</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>N</mml:mi><mml:mi>B</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:math></inline-formula></p><p id="P42">6:       Multiply each <inline-formula><mml:math id="M3"><mml:mrow><mml:msubsup><mml:mi>N</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> by the PCR amplification factor</p><p id="P43">7: <bold>end for</bold></p><p id="P44">&gt;8: <bold>for</bold> each bin <italic>b</italic>: <bold>do</bold></p><p id="P45">&gt;9:       Compute the total number of cells: <inline-formula><mml:math id="M4"><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mi>d</mml:mi></mml:msub><mml:mrow><mml:msubsup><mml:mi>N</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:mrow></mml:math></inline-formula></p><p id="P46">&gt;10:       Compute the event probabilities <inline-formula><mml:math id="M5"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>b</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msubsup><mml:mi>N</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>N</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula></p><p id="P47">&gt;11:        Draw <inline-formula><mml:math id="M6"><mml:mrow><mml:msubsup><mml:mi>S</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>S</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>~</mml:mo><mml:mtext>Multinomial</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mi>R</mml:mi><mml:mi>B</mml:mi></mml:mfrac><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula></p><p id="P48">&gt;12: <bold>end for</bold></p><p id="P49">13: return [<italic>S<sup>(d)</sup><sub>b</sub></italic>] and [<italic>N<sub>b</sub></italic>]</p></boxed-text> it would create a significant computational bottleneck during our simulations. Using a multinomial sampling scheme allows us to generate faster simulations, but we need to verify this approximation.</p><p id="P50">The validity of the multinomial approximation is controlled by the ratio <inline-formula><mml:math id="M7"><mml:mrow><mml:mfrac><mml:mi>N</mml:mi><mml:mi>R</mml:mi></mml:mfrac></mml:mrow></mml:math></inline-formula>, where <italic>N</italic> is the total number of cells sorted and <italic>R</italic> the total number of sequencing reads. Hence, conclusions should become particularly accurate as <italic>N</italic> &gt; 10<italic>R</italic>. We used a second approximation to derive the log-likelihood, which is to use a Poisson distribution instead of a bimonial distribution. This approximation requires to be valid: <disp-formula id="FD1"><mml:math id="M8"><mml:mrow><mml:mtext>large</mml:mtext><mml:mfrac><mml:mi>R</mml:mi><mml:mi>B</mml:mi></mml:mfrac><mml:mo>,</mml:mo><mml:mtext>low</mml:mtext><mml:mfrac><mml:mrow><mml:msup><mml:mi>N</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mi>N</mml:mi></mml:mfrac><mml:mo>~</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>C</mml:mi></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>B</italic> is the number of sorting bins, <italic>C</italic> the diversity of the library and <italic>N</italic><sup>(<italic>i</italic>)</sup> the number of cells sorted corresponding to the <italic>j</italic>-th genetic variant. This approximation is well founded because we typically have for common Flow-seq (and during our experiments): <disp-formula id="FD2"><mml:math id="M9"><mml:mrow><mml:mfrac><mml:mi>R</mml:mi><mml:mi>B</mml:mi></mml:mfrac><mml:mo>≥</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mn>3</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>C</mml:mi></mml:mfrac><mml:mo>≤</mml:mo><mml:msup><mml:mrow><mml:mn>10</mml:mn></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>3</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></disp-formula></p></sec><sec id="S11"><title>Fluorescence data and parameterization</title><p id="P51">Here we specify the origin of the fluorescence data we use for our simulations and the families of distributions used to model the fluorescence. To ensure resemblance with reality, we used experimental Flow-seq data and <italic>E. coli</italic> fluorescence distribution parameters to generate our simulations. Gamma and Log-normal distributions were used separately to model the fluorescence data of each genetic variant. We chose the shape/scale parameterization when using the gamma distribution to model the fluorescence. This means that the density function <italic>g</italic>(<italic>x</italic>), the mean <italic>μ</italic> and the standard deviation <italic>σ</italic> are given by: <disp-formula id="FD3"><label>(1)</label><mml:math id="M10"><mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>x</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mi>x</mml:mi><mml:mo>/</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>Γ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mi>b</mml:mi><mml:mi>a</mml:mi></mml:msup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD4"><label>(2)</label><mml:math id="M11"><mml:mrow><mml:mi>μ</mml:mi><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mi>b</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD5"><label>(3)</label><mml:math id="M12"><mml:mrow><mml:mi>σ</mml:mi><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:msup><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P52">Gamma distribution parameters (<italic>a, b</italic>) for each genetic variant were taken from existing data [<xref ref-type="bibr" rid="R26">26</xref>]. We simplified the analysis when using the Log-normal distribution modelling choice by first log-transforming the fluorescence data. As we operate on the log-fluorescence domain, the Log-normal distribution has the same parameterization as a Gaussian distribution. The density function <italic>g</italic>(<italic>x</italic>) is then given by, <disp-formula id="FD6"><label>(4)</label><mml:math id="M13"><mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>σ</mml:mi><mml:msqrt><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi></mml:mrow></mml:msqrt></mml:mrow></mml:mfrac><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:mi>μ</mml:mi></mml:mrow><mml:mi>σ</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>μ</italic> is the mean log fluorescence and <italic>σ</italic> is the standard deviation of the log fluorescence. Parameters were inferred from a previous Flow-Seq experiment [<xref ref-type="bibr" rid="R8">8</xref>].</p></sec><sec id="S12"><title>Inference using the Method of Moments</title><p id="P53">During the sorting step, the precise fluorescence information for each cell is lost. In the MOM inference procedure, each cell is assigned a fluorescence value depending on the bin it was sorted in; here we used the fluorescence midpoint of each bin. This enables us to compute the experimental mean <inline-formula><mml:math id="M14"><mml:mover accent="true"><mml:mi>F</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:math></inline-formula> and standard deviation <italic>σ<sub>F</sub></italic>. The MOM estimates <inline-formula><mml:math id="M15"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>MOM</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are then obtained by equating the experimental and theoretical moments: <disp-formula id="FD7"><label>(5)</label><mml:math id="M16"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>α</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>MOM</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>F</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD8"><label>(6)</label><mml:math id="M17"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>MOM</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mover accent="true"><mml:mi>F</mml:mi><mml:mo>¯</mml:mo></mml:mover></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> or <disp-formula id="FD9"><label>(7)</label><mml:math id="M18"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>MOM</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>log</mml:mi><mml:mi>F</mml:mi></mml:mrow><mml:mo stretchy="true">¯</mml:mo></mml:mover><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD10"><label>(8)</label><mml:math id="M19"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>MOM</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mrow><mml:mi>log</mml:mi></mml:mrow></mml:msub><mml:mi>F</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M20"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>a</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>MOM</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M21"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>b</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>MOM</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are the estimators for the shape and scale of the Gamma distribution in <xref ref-type="disp-formula" rid="FD3">Equation 1</xref> and <inline-formula><mml:math id="M22"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>a</mml:mi><mml:mo>μ</mml:mo></mml:mover><mml:mrow><mml:mtext>MOM</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M23"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>a</mml:mi><mml:mo>σ</mml:mo></mml:mover><mml:mrow><mml:mtext>MOM</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are the estimators for the parameters of the Gaussian distribution in <xref ref-type="disp-formula" rid="FD6">Equation 4</xref>.</p></sec><sec id="S13"><title>Deriving the model likelihood</title><p id="P54">We extended a previous formulation of the likelihood used to account for the stochasticity observed during the sequencing step [<xref ref-type="bibr" rid="R10">10</xref>, <xref ref-type="bibr" rid="R25">25</xref>]. A typical model to represent the sequencing count data is to use a Poisson distribution [<xref ref-type="bibr" rid="R44">44</xref>–<xref ref-type="bibr" rid="R46">46</xref>]. We denote the read count for genetic variant (d) observed when sequencing bin <italic>b</italic> by <inline-formula><mml:math id="M24"><mml:mrow><mml:msubsup><mml:mi>s</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula>. Noting that <inline-formula><mml:math id="M25"><mml:mrow><mml:msubsup><mml:mi>s</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mspace width="0.2em"/><mml:mo>~</mml:mo><mml:mspace width="0.2em"/><mml:mo>𝒫</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, the data generating procedure can then be written as, <disp-formula id="FD11"><label>(9)</label><mml:math id="M26"><mml:mrow><mml:mtext>latent</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>layer</mml:mtext><mml:msup><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mspace width="0.2em"/><mml:mo>~</mml:mo><mml:mspace width="0.2em"/><mml:mi>G</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.2em"/><mml:mtext>or</mml:mtext><mml:mspace width="0.2em"/><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mo>𝒩</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>σ</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD12"><label>(10)</label><mml:math id="M27"><mml:mrow><mml:mtext>observation</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>layer</mml:mtext><mml:mspace width="0.2em"/><mml:msubsup><mml:mi>s</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mspace width="0.2em"/><mml:mo>|</mml:mo><mml:mspace width="0.2em"/><mml:msubsup><mml:mi>n</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>~</mml:mo><mml:mspace width="0.2em"/><mml:mrow><mml:mo>𝒫</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p id="P55">Let <inline-formula><mml:math id="M28"><mml:mrow><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></inline-formula> be the rate of the Poisson distribution: <inline-formula><mml:math id="M29"><mml:mrow><mml:msubsup><mml:mi>s</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>~</mml:mo><mml:mo>𝒫</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. This rate is given by, <disp-formula id="FD13"><label>(11)</label><mml:math id="M30"><mml:mrow><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mtext>probability</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>of</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>sequencing</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>construct</mml:mtext><mml:mspace width="0.2em"/><mml:mi>i</mml:mi><mml:mspace width="0.2em"/><mml:mtext>in</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>bin</mml:mtext><mml:mspace width="0.2em"/><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>×</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mtext>reads</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>allocated</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mi>n</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo stretchy="false">)</mml:mo><mml:mo>×</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>n</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mstyle displaystyle="true"><mml:mrow><mml:msubsup><mml:mo>∫</mml:mo><mml:mrow><mml:msub><mml:mi>F</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>F</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:msubsup><mml:mi>g</mml:mi><mml:mi>θ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mrow></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>×</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>b</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M31"><mml:mrow><mml:msubsup><mml:mi>g</mml:mi><mml:mi>θ</mml:mi><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>d</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mi>x</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is either a gamma or lognormal density function, [<italic>F<sub>b</sub></italic>; <italic>F<sub>b+1</sub></italic>] are the fluorescence boundaries for sorting bin <italic>b</italic>, <inline-formula><mml:math id="M32"><mml:mrow><mml:mfrac><mml:mi>R</mml:mi><mml:mi>B</mml:mi></mml:mfrac></mml:mrow></mml:math></inline-formula> is the ratio of sequencing reads allocated per sorting bin, <italic>n<sup>(d)</sup></italic> the number of cells sorted for to the genetic variant (<italic>d</italic>) and <italic>n<sub>b</sub></italic> the number of cells sorted in bin <italic>b</italic>. A common estimate for <italic>n<sup>(d)</sup></italic> is, <disp-formula id="FD14"><label>(12)</label><mml:math id="M33"><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mi>b</mml:mi></mml:munder><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mi>B</mml:mi><mml:mi>R</mml:mi></mml:mfrac></mml:mrow></mml:mstyle><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mi>b</mml:mi></mml:munder><mml:mrow><mml:msubsup><mml:mi>s</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msub><mml:mi>n</mml:mi><mml:mi>b</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>n<sub>b</sub></italic> indicates the number of cells sorted in bin <italic>b</italic> [<xref ref-type="bibr" rid="R10">10</xref>].</p><p id="P56">The output of a Flow-seq experiment is the sequencing data, which can be represented by a <italic>D</italic> × <italic>B</italic> matrix of discrete values. The likelihood of observing one row of this matrix is the product of the probabilities that we sequenced <italic>s<sup>(d)</sup><sub>b</sub></italic> times the genetic variant (<italic>d</italic>) in bin <italic>b</italic>, thus, <disp-formula id="FD15"><label>(13)</label><mml:math id="M34"><mml:mrow><mml:msup><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>b</mml:mi></mml:munderover><mml:mrow><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:msubsup><mml:mi>s</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>!</mml:mo></mml:mrow></mml:mfrac><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P57">For numerical stability, we worked with the negative log-likelihood giving, <disp-formula id="FD16"><label>(14)</label><mml:math id="M35"><mml:mrow><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msup><mml:mo>ℒ</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>log</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>l</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>log</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mrow><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mrow><mml:msubsup><mml:mi>s</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>!</mml:mo></mml:mrow></mml:mfrac><mml:mi>exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>d</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>B</mml:mi></mml:munderover><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mi>log</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>λ</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>log</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>s</mml:mi><mml:mi>b</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>!</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p></sec><sec id="S14"><title>Finding the likelihood maximum</title><p id="P58">The point <italic>θ</italic><sub>ML</sub> in parameter space maximizing the likelihood function 13 corresponds to the maximum likelihood estimates <inline-formula><mml:math id="M36"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>ML</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>. However, the first-order conditions of the likelihood function cannot be solved analytically. Therefore, we obtained the maximum likelihood estimates for the fluorescence distribution parameters by numerically minimizing the negative log-likelihood function using the Nelder-Mead simplex algorithm. The starting point for the minimization procedure was initialized with the MOM estimates <inline-formula><mml:math id="M37"><mml:mrow><mml:msup><mml:mo>ℒ</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>. To make sure the estimates were positive after the final minimization step, we worked with the log-transformed variables log(<italic>θ</italic>) = (log(<italic>μ</italic>), log(<italic>σ</italic>))) when using the normal distribution and log(<italic>θ</italic>) = (log(<italic>α</italic>),log(<italic>b</italic>)) when using the gamma distribution. The invariance property of maximum likelihood [<xref ref-type="bibr" rid="R30">30</xref>] ensures the log-likelihood maximum is the same in log space. We then applied the exponential function to get the ML estimates <inline-formula><mml:math id="M38"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>ML</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>.</p></sec><sec id="S15"><title>Computing confidence intervals</title><p id="P59">The maximum likelihood framework provides additional information on the estimates in the form of confidence intervals [<xref ref-type="bibr" rid="R30">30</xref>]. To obtain the confidence intervals, we computed the observed Fischer information matrix I(θ<sub>ML</sub>) by evaluating the Hessian of the negative log-likelihood <inline-formula><mml:math id="M39"><mml:mrow><mml:mo>−</mml:mo><mml:mo>∇</mml:mo><mml:msup><mml:mo>∇</mml:mo><mml:mi>T</mml:mi></mml:msup><mml:msub><mml:mo>ℒ</mml:mo><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mrow><mml:mtext>ML</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> at the point maximizing the likelihood. We then computed the inverse of the observed Fischer information I(θ<sub>ML</sub>)<sup>–1</sup> and extracted its diagonals elements to get the 100(1 – α)% confidence intervals for each estimate <inline-formula><mml:math id="M40"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>ML</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>ML,1</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>ML,2</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. Specifically, <disp-formula id="FD17"><label>(15)</label><mml:math id="M41"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>ML,</mml:mtext><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>±</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mspace width="0.2em"/><mml:mtext>se</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>ML</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>±</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>a</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:msqrt><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>I</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>ML</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mi>i</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msqrt><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>z<sub>α/2</sub></italic> is the corresponding z-score for the 100(1 – <italic>α</italic>)% confidence interval. To compute the confidence intervals for the mean μ and the variance σ<sup>2</sup> when using the gamma distribution, we use the delta theorem and the transformation <italic>g</italic>: (<italic>a, b</italic>) → (<italic>ab, ab</italic><sup>2</sup>). This leads to the following 100(1 – <italic>α</italic>)% confidence interval, <disp-formula id="FD18"><label>(16)</label><mml:math id="M42"><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mover accent="true"><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>σ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>±</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>α</mml:mi><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msqrt><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>J</mml:mi></mml:mstyle><mml:mi>g</mml:mi></mml:msub><mml:mtext>I(</mml:mtext><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>ML</mml:mtext></mml:mrow></mml:msub><mml:msup><mml:mtext>)</mml:mtext><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>J</mml:mi></mml:mstyle><mml:mi>g</mml:mi><mml:mi>Τ</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mn>11</mml:mn></mml:mrow></mml:msqrt></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msqrt><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>J</mml:mi></mml:mstyle><mml:mi>g</mml:mi></mml:msub><mml:mtext>I(</mml:mtext><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mtext>ML</mml:mtext></mml:mrow></mml:msub><mml:msup><mml:mtext>)</mml:mtext><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msubsup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>J</mml:mi></mml:mstyle><mml:mi>g</mml:mi><mml:mi>Τ</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mn>22</mml:mn></mml:mrow></mml:msqrt></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula> with <bold>J</bold><sub><italic>g</italic></sub> the Jacobian of the transformation, <disp-formula id="FD19"><label>(17)</label><mml:math id="M43"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>J</mml:mi></mml:mstyle><mml:mi>g</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mi>b</mml:mi></mml:mtd><mml:mtd><mml:mi>a</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msup><mml:mi>b</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mn>2</mml:mn><mml:mi>a</mml:mi><mml:mi>b</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p></sec><sec id="S16"><title>Evaluation of estimates</title><p id="P60">After performing simulations and calculating the estimates, we considered several criteria to evaluate the performance of the inference at the genetic variant level. Assessment of global accuracy was conducted using the WD between the known ground truth and inferred distributions. WD was computed empirically by sampling 100,000 points from the inferred and ground-truth distributions. Parameter-level accuracy was assessed by measuring the percentage error (PE) given by, <disp-formula id="FD20"><label>(18)</label><mml:math id="M44"><mml:mrow><mml:mtext>PE(</mml:mtext><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mi>θ</mml:mi><mml:mtext>)=</mml:mtext><mml:mfrac><mml:mrow><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>−</mml:mo><mml:mi>θ</mml:mi></mml:mrow><mml:mi>θ</mml:mi></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M45"><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> is any estimate of interest (e.g., mean fluorescence or shape parameter) and θ the corresponding ground truth. Library-level performance was assessed by averaging the metrics over all genetic variants to compute the MWD and MAPE given by, <disp-formula id="FD21"><label>(18)</label><mml:math id="M46"><mml:mrow><mml:mtext>MWD</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:mi>W</mml:mi><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula>
<disp-formula id="FD22"><label>(20)</label><mml:math id="M47"><mml:mrow><mml:mtext>MAPE</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>n</mml:mi></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>n</mml:mi></mml:munderover><mml:mrow><mml:mo>|</mml:mo><mml:mi>P</mml:mi><mml:mi>E</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>θ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>|</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></disp-formula></p><p id="P61">Here, <italic>i</italic> is the index or the genetic variant and <italic>n</italic> is the size of the library. Coverage of the 95%-confidence interval was assessed by computing the proportion of times the confidence interval contained the correct parameter for 500 replicates. This coverage rate was deemed acceptable when it was within two Standard Errors (SE) of the nominal coverage probability. With 500 replicates, <inline-formula><mml:math id="M48"><mml:mrow><mml:mtext>SE</mml:mtext><mml:mo>=</mml:mo><mml:msqrt><mml:mrow><mml:mfrac><mml:mrow><mml:mn>0.95</mml:mn><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mn>0.95</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mn>500</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msqrt><mml:mo>~</mml:mo><mml:mn>1</mml:mn><mml:mi>%</mml:mi></mml:mrow></mml:math></inline-formula> and hence an acceptable coverage has to be within [95% – 1.96 × 1%, 95% + 1.96 × 1%] ~ [93%, 97%].</p></sec><sec id="S17"><title>Assessing inference quality</title><p id="P62">After the inference step, it was necessary to develop a systematic procedure to inspect the reliability of estimates. Border effects, where fluorescence values were near zero or near the maximum of the final sorting bin, were detected by computing the percentage of reads located in the first and last sorting bin. Only variants with percentage less than 70% were retained. Situations where only a few reads were recovered were addressed by removing constructs with sequencing reads falling exclusively in one sorting bin. Model specification/numerical issues were identified and removed by dropping genetic variants that had non-invertible Hessians or when the confidence intervals were bigger than the corresponding estimates.</p></sec><sec id="S18"><title>Experimental factors</title><p id="P63">Five experimental factors were selected for evaluation of their impact on the accuracy of the statistical inference: 1. the number of different genetic variants in the library <italic>D</italic>, 2. the number of sorted cells <italic>N</italic> in the library, 3. the number of reads <italic>R</italic> allocated during the sequencing step, 4. the number of bins <italic>B</italic> used during the sorting step, and 5. the fluorescence distribution modelling choice <italic>Z</italic>. Normalised versions of the number of reads and the number of sorted cells were obtained by taking their ratios with the diversity of the assay. These normalised values are indicated with tildes <inline-formula><mml:math id="M49"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>N</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mi>N</mml:mi><mml:mi>D</mml:mi></mml:mfrac><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mi>R</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mfrac><mml:mi>R</mml:mi><mml:mi>D</mml:mi></mml:mfrac><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> and remove the dependence of the assay diversity <italic>D</italic> on the conclusions.</p></sec><sec id="S19"><title>Pipeline to characterise inference methods</title><p id="P64">To characterize the statistical behaviour of both MOM and ML estimator in a simple setting, we performed one round of simulation+inference protocol with the following values for the experimental factors: Library of 1018 genetic variants with gamma fluorescence distributions, 10<sup>7</sup> sequencing reads, 10<sup>6</sup> cells sorted, 10<sup>2</sup> PCR amplification factor, 8 bins and maximum fluorescence (f<sub>max</sub> = 10<sup>5</sup>). Bias and variance of each estimator was measured by generating 499 additional synthetic Flow-seq datasets with identical experimental factors using a different random seed. We reported the sampling variation associated with the mob protein from the Taniguchi <italic>et al.</italic> dataset [<xref ref-type="bibr" rid="R26">26</xref>].</p></sec><sec id="S20"><title>Factorial experiment</title><p id="P65">To study both individual and interaction effects between experimental factors, we conducted a factorial experiment over a comprehensive range of experimental factors. The values we explored for the number of cells sorted and the number of sequencing reads were 10<sup>4</sup>, 2 × 10<sup>4</sup>, 5 × 10<sup>4</sup>, 8 × 10<sup>4</sup>, 10<sup>5</sup>, 2 × 10<sup>5</sup>, 5 × 10<sup>5</sup>, 10<sup>6</sup> and 10<sup>7</sup>. For cell sorting, we considered 6, 8, 10, 12, 14, 16, 18, 20, 32 bins and estimated the fluorescence distribution using both Log-normal and Gamma modeling choice. Each combination of experimental factors was replicated 15 times with a different random seed to account for sampling variation, which amounted to 21,870 simulated Flow-seq experiments assessing ~22 million genetic variants.</p></sec><sec id="S21"><title>Comparing experimental factors</title><p id="P66">We fitted two multiple linear regression models on a subset of the factorial experiment dataset to quantify the relative importance of each experimental factor to the accuracy of the estimates. The response variable was the MWD, using either the ML or MOM inference method. The predictor variables are the number of bins, the log-transformed number of reads per genetic variant and the log-transformed number of cells per genetic variant. The data used to fit the model was restricted to values where this relationship is approximately linear to satisfy the assumptions from linear regression. Each predictor variable was min-max normalized.</p></sec><sec id="S22"><title>Deep learning data</title><p id="P67">Flow-Seq sequencing data was extracted from a previous study [<xref ref-type="bibr" rid="R16">16</xref>], where the translational initiation rate of messenger RNAs across a library of constructs with different 5’UTRs was measured. Data was aggregated from experiments ‘20N’, ‘30N’ and ‘RML_eno’ and ultimately comprised of 28,402 different RNA sequences. The sequencing mode bin (between 1 and 8) was determined for each RNA sequence and served as the target output. Number of cells per sequence was estimated using Flow-Cytometer population events data for each experiment (private correspondence with the authors) and the <xref ref-type="disp-formula" rid="FD14">equation 12</xref>. 80/10/10% split was used to create Train/Validation/Test sets. Sequences with the most sequencing reads (cutoff at 40) were prioritized for the test set creation to ensure high-quality data is used for model evaluation. The input RNA sequences were one-encoded into a matrix of size 4 × 30. Data augmentation was performed on the training and validation set by zero-padding 20 nucleotide long sequences. 20 nucleotide long sequences from the test set were zero-padded on the right.</p></sec><sec id="S23"><title>Assessing the experimental-level accuracy of the Evfratov dataset</title><p id="P68">The target output for each genetic variant in the Evfratov dataset [<xref ref-type="bibr" rid="R16">16</xref>] is the sorting bin with the most cells (i.e., the ‘mode bin’). We extracted the mode bin from data for each genetic variant by computing an estimate for the number of cells sorted in each bin using <xref ref-type="disp-formula" rid="FD14">Equation 12</xref> and selecting the sorting bin corresponding to the biggest number of cells sorted. However, these estimates for the mode bin are unstable due to sampling variation occurring at the sorting and sequencing step.</p><p id="P69">To assess the accuracy of each target output from the Evfratov dataset, we used as proxy the frequency of correct mode bin measurement in a Flow-Seq with similar experimental parameters. For example, the attributed accuracy for the mode bin of a genetic variant from the Evfratov dataset characterized with 8 bins, 20 sequencing reads and 30 cells corresponds to the frequency of correct mode bin measurement of a Flow-seq experiment having on average 20 sequencing reads, 30 cells per genetic variant and using 8 sorting bins. We then averaged the accuracy of each target output to get the maximum achievable accuracy on each dataset split.</p><p id="P70">The frequency of correct mode bin measurement was measured by first simulating a Flow-seq experiment, and then counting the number of times each genetic variant was attributed the true mode bin. We used the fluorescence parameters from the Taniguchi library [<xref ref-type="bibr" rid="R26">26</xref>] and matched the experimental factors from the Evfratov experiment: cells were sorted into 8 bins with sequencing reads = 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 60, 65, 70, 75, 80, 85, 90, 95, 100, 105, 110, 115, 120, 125, 130, 135, 140, 145, 150, 155, 160, 165, 170, 175, 180, 185, 190, 195, 200, 205, 500 and 1000, and numbers of cells sorted = 1, 6, 11, 16, 21, 26, 31, 36, 41, 46, 51, 56, 72, 80, 100, 120, 140, 160, 180, 200, 500 and 1000. For each of the 22 × 62 = 1364 combinations of sequencing reads and cells sorted we generated 50 Flow-seq replicates to account for sampling variation.</p></sec><sec id="S24"><title>Deep learning architectures</title><p id="P71">Different neural networks architectures were implemented using PyTorch [<xref ref-type="bibr" rid="R47">47</xref>] and were systematically compared through a medium hyper-parameter optimisation (1000 examples using the Optuna default protocol [<xref ref-type="bibr" rid="R48">48</xref>], full details available in rebeca/hpo.py). The following architectures were considered: a multi-layer perceptron (MLP), a Convolutional Neural Network with an MLP used as a feature extractor in the final step, a Long Short Term Memory Recurrent Neural Network (RNN) and finally a hybrid CNN+RNN. The best performing model was a hybrid CNN+RNN with the following architecture: 2 layers of 1D CNN+maxpooling (256 channels, CNN kernel of size 4, max pooling kernel of size 2), followed by one biLSTM layer (hidden size 200). The output of the BiLSTM layer was flattened and followed by 2 fully-connected feed-forward layers with 512 units before the last layer comprising 8 units to predict the sequencing mode bin. Code for implementing architectures and model checkpoints are available in rebeca/model/sequence_model.py and rebeca/checkpoints/convbilstm (<xref ref-type="sec" rid="S28">Data Availability</xref>)</p></sec><sec id="S25"><title>Training and evaluation</title><p id="P72">A mini batch of 32 examples was used during training to minimize the cross-entropy loss using the Adam optimizer with a learning rate of 3 × 10<sup>–4</sup>. Early stopping was used to identify over-fitting for each model. Training was conducted using two NVIDIA RTX 6000 GPUs. Evaluation was carried out by computing accuracy, precision, recall, F1 score and the confusion matrix. For each sequence subjected to data augmentation, we selected during testing the most frequent target output.</p></sec><sec id="S26"><title>General computational tools</title><p id="P73">All analysis scripts and the FORECAST package were written in Python version 3.9, using the numpy version 1.19.15 [<xref ref-type="bibr" rid="R49">49</xref>] for matrix algebra, scipy version 1.4.1 for statistical functions [<xref ref-type="bibr" rid="R50">50</xref>], numdifftools version 0.9.40 [<xref ref-type="bibr" rid="R51">51</xref>] for computing finite differences, joblib version 1.1.0 for multiprocessing, Pytorch version 1.12 [<xref ref-type="bibr" rid="R47">47</xref>] for deep learning. Statistical inference speed comparisons between MOM and ML approaches were conducted on an Apple iMac computer with a 3 GHz 6-core Intel Core i5 processor and 16 GB of RAM.</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary information</label><media xlink:href="EMS156800-supplement-Supplementary_information.pdf" mimetype="application" mime-subtype="pdf" id="d102aAdEbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S27"><title>Acknowledgments</title><p>This work was supported by the EPSRC/BBSRC Centre for Doctoral Training in Synthetic Biology grant EP/L016494/1 (P.-A.G.), BrisEngBio, a UKRI-funded Engineering Biology Research Centre grant BB/W013959/1 (T.E.G.), UKRI grant BB/W012448/1 (T.E.G.), a Turing Fellowship from The Alan Turing Institute under EPSRC grant EP/N510129/1 (T.E.G.), and a Royal Society University Research Fellowship grant UF160357 (T.E.G.)</p></ack><sec id="S28" sec-type="data-availability"><title>Data Availability</title><p id="P74">Code for the FORECAST Python package is available at <ext-link ext-link-type="uri" xlink:href="https://gitlab.com/Pierre-Aurelien/forecast">https://gitlab.com/Pierre-Aurelien/forecast</ext-link>. Code for modelling the deep neural networks is available at <ext-link ext-link-type="uri" xlink:href="https://gitlab.com/Pierre-Aurelien/rebeca">https://gitlab.com/Pierre-Aurelien/rebeca</ext-link>.</p></sec><fn-group><fn id="FN1" fn-type="con"><p id="P75"><bold>Author Contributions</bold></p><p id="P76">P.-A.G. developed the methodology, carried out all computational work and performed the analysis. T.E.G. supervised the work. Both authors conceived of the study and wrote the manuscript.</p></fn><fn id="FN2" fn-type="conflict"><p id="P77"><bold>Competing Interests</bold></p><p id="P78">The authors declare no competing interests.</p></fn></fn-group><ref-list><ref id="R1"><label>[1]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kosuri</surname><given-names>S</given-names></name><name><surname>Church</surname><given-names>GM</given-names></name></person-group><article-title>Large-scale de novo DNA synthesis: technologies and applications</article-title><source>Nature Methods</source><year>2014</year><volume>11</volume><issue>5</issue><fpage>499</fpage><lpage>507</lpage><comment>URL <ext-link ext-link-type="uri" xlink:href="http://www.nature.com/articles/nmeth.2918">http://www.nature.com/articles/nmeth.2918</ext-link></comment><pub-id pub-id-type="doi">10.1038/nmeth.2918</pub-id></element-citation></ref><ref id="R2"><label>[2]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Almogy</surname><given-names>G</given-names></name><etal/></person-group><article-title>Cost-efficient whole genome-sequencing using novel mostly natural sequencing-by-synthesis chemistry and open fluidics platform</article-title><year>2022</year><elocation-id>2022.05.29.493900</elocation-id><comment>Section: New Results. URL <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/10.1101/2022.05.29.493900v4">https://www.biorxiv.org/content/10.1101/2022.05.29.493900v4</ext-link></comment></element-citation></ref><ref id="R3"><label>[3]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gilliot</surname><given-names>P-A</given-names></name><name><surname>Gorochowski</surname><given-names>TE</given-names></name></person-group><article-title>Sequencing enabling design and learning in synthetic biology</article-title><source>Current Opinion in Chemical Biology</source><year>2020</year><volume>58</volume><fpage>54</fpage><lpage>62</lpage><pub-id pub-id-type="doi">10.1016/j.cbpa.2020.06.002</pub-id></element-citation></ref><ref id="R4"><label>[4]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sarkisyan</surname><given-names>KS</given-names></name><etal/></person-group><article-title>Local fitness landscape of the green fluorescent protein</article-title><source>Nature</source><year>2016</year><volume>533</volume><issue>7603</issue><fpage>397</fpage><lpage>401</lpage><pub-id pub-id-type="doi">10.1038/nature17995</pub-id></element-citation></ref><ref id="R5"><label>[5]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peterman</surname><given-names>N</given-names></name><name><surname>Lavi-Itzkovitz</surname><given-names>A</given-names></name><name><surname>Levine</surname><given-names>E</given-names></name></person-group><article-title>Large-scale mapping of sequence-function relations in small regulatory RNAs reveals plasticity and modularity</article-title><source>Nucleic Acids Research</source><year>2014</year><volume>42</volume><issue>19</issue><fpage>12177</fpage><lpage>12188</lpage><pub-id pub-id-type="doi">10.1093/nar/gku863</pub-id></element-citation></ref><ref id="R6"><label>[6]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Melnikov</surname><given-names>A</given-names></name><etal/></person-group><article-title>Systematic dissection and optimization of inducible enhancers in human cells using a massively parallel reporter assay</article-title><source>Nature Biotechnology</source><year>2012</year><volume>30</volume><issue>3</issue><fpage>271</fpage><lpage>277</lpage><comment>URL <ext-link ext-link-type="uri" xlink:href="http://www.nature.com/articles/nbt.2137">http://www.nature.com/articles/nbt.2137</ext-link></comment><pub-id pub-id-type="doi">10.1038/nbt.2137</pub-id></element-citation></ref><ref id="R7"><label>[7]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Gorochowski</surname><given-names>TE</given-names></name><name><surname>Ellis</surname><given-names>T</given-names></name></person-group><article-title>Designing efficient translation</article-title><source>Nature Biotechnology</source><publisher-name>Nature Publishing Group</publisher-name><year>2018</year><volume>36</volume><issue>10</issue><fpage>934</fpage><lpage>935</lpage><pub-id pub-id-type="doi">10.1038/nbt.4257</pub-id></element-citation></ref><ref id="R8"><label>[8]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Cambray</surname><given-names>G</given-names></name><name><surname>Guimaraes</surname><given-names>Joao C</given-names></name><name><surname>Arkin</surname><given-names>AP</given-names></name></person-group><article-title>Evaluation of 244,000 synthetic sequences reveals design principles to optimize translation in Escherichia coli</article-title><source>Nature Biotechnology</source><publisher-name>Nature Publishing Group</publisher-name><year>2018</year><volume>36</volume><issue>10</issue><fpage>1005</fpage><lpage>1015</lpage><comment>number: 10</comment><pub-id pub-id-type="doi">10.1038/nbt.4238</pub-id></element-citation></ref><ref id="R9"><label>[9]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mutalik</surname><given-names>VK</given-names></name><etal/></person-group><article-title>Precise and reliable gene expression via standard transcription and translation initiation elements</article-title><source>Nature Methods</source><year>2013</year><volume>10</volume><issue>4</issue><fpage>354</fpage><lpage>360</lpage><comment>URL <ext-link ext-link-type="uri" xlink:href="https://www.nature.com/articles/nmeth.2404">https://www.nature.com/articles/nmeth.2404</ext-link></comment><pub-id pub-id-type="doi">10.1038/nmeth.2404</pub-id></element-citation></ref><ref id="R10"><label>[10]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Kotopka</surname><given-names>BJ</given-names></name><name><surname>Smolke</surname><given-names>CD</given-names></name></person-group><article-title>Model-driven generation of artificial yeast promoters</article-title><source>Nature Communications</source><publisher-name>Nature Publishing Group</publisher-name><year>2020</year><volume>11</volume><issue>1</issue><elocation-id>2113</elocation-id><pub-id pub-id-type="doi">10.1038/s41467-020-15977-4</pub-id></element-citation></ref><ref id="R11"><label>[11]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>LaFleur</surname><given-names>TL</given-names></name><name><surname>Hossain</surname><given-names>A</given-names></name><name><surname>Salis</surname><given-names>HM</given-names></name></person-group><article-title>Automated model-predictive design of synthetic promoters to control transcriptional profiles in bacteria</article-title><source>Nature Communications</source><publisher-name>Nature Publishing Group</publisher-name><year>2022</year><volume>13</volume><issue>1</issue><fpage>5159</fpage><comment>URL <ext-link ext-link-type="uri" xlink:href="https://www.nature.com/articles/s41467-022-32829-5">https://www.nature.com/articles/s41467-022-32829-5</ext-link></comment><pub-id pub-id-type="doi">10.1038/s41467-022-32829-5</pub-id></element-citation></ref><ref id="R12"><label>[12]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Kuo</surname><given-names>S-T</given-names></name><etal/></person-group><article-title>Global fitness landscapes of the Shine-Dalgarno sequence</article-title><source>Genome Research</source><publisher-name>Cold Spring Harbor Lab</publisher-name><year>2020</year><comment>URL <ext-link ext-link-type="uri" xlink:href="http://genome.cshlp.org/content/early/2020/05/18/gr.260182.119">http://genome.cshlp.org/content/early/2020/05/18/gr.260182.119</ext-link> company: Cold Spring Harbor Laboratory Press Distributor: Cold Spring Harbor Laboratory Press Institution: Cold Spring Harbor Laboratory Press Label: Cold Spring Harbor Laboratory Press</comment><pub-id pub-id-type="doi">10.1101/gr.260182.119</pub-id></element-citation></ref><ref id="R13"><label>[13]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vaishnav</surname><given-names>ED</given-names></name><etal/></person-group><article-title>The evolution, evolvability and engineering of gene regulatory DNA</article-title><source>Nature</source><year>2022</year><volume>603</volume><issue>7901</issue><fpage>455</fpage><lpage>463</lpage><comment>URL <ext-link ext-link-type="uri" xlink:href="https://www.nature.com/articles/s41586-022-04506-6">https://www.nature.com/articles/s41586-022-04506-6</ext-link>.</comment><pub-id pub-id-type="doi">10.1038/s41586-022-04506-6</pub-id></element-citation></ref><ref id="R14"><label>[14]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Sharon</surname><given-names>E</given-names></name><etal/></person-group><article-title>Inferring gene regulatory logic from high-throughput measurements of thousands of systematically designed promoters</article-title><source>Nature Biotechnology</source><publisher-name>Nature Publishing Group</publisher-name><year>2012</year><volume>30</volume><issue>6</issue><fpage>521</fpage><lpage>530</lpage><pub-id pub-id-type="doi">10.1038/nbt.2205</pub-id></element-citation></ref><ref id="R15"><label>[15]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dvir</surname><given-names>S</given-names></name><etal/></person-group><article-title>Deciphering the rules by which 5-UTR sequences affect pro tein expression in yeast</article-title><source>Proceedings of the National Academy of Sciences</source><year>2013</year><volume>110</volume><issue>30</issue><fpage>E2792</fpage><lpage>E2801</lpage><comment>Proceedings of the National Academy of Sciences</comment><pub-id pub-id-type="doi">10.1073/pnas.1222534110</pub-id></element-citation></ref><ref id="R16"><label>[16]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Evfratov</surname><given-names>SA</given-names></name><etal/></person-group><article-title>Application of sorting and next generation sequencing to study 5-UTR influence on translation efficiency in Escherichia coli</article-title><source>Nucleic Acids Research</source><year>2017</year><volume>45</volume><issue>6</issue><fpage>3487</fpage><lpage>3502</lpage><pub-id pub-id-type="doi">10.1093/nar/gkw1141</pub-id></element-citation></ref><ref id="R17"><label>[17]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kosuri</surname><given-names>S</given-names></name><etal/></person-group><article-title>Composability of regulatory sequences controlling transcription and translation in Escherichia coli</article-title><source>Proceedings of the National Academy of Sciences</source><year>2013</year><volume>110</volume><issue>34</issue><fpage>14024</fpage><lpage>14029</lpage><comment>National Academy of Sciences section: Biological Sciences</comment><pub-id pub-id-type="doi">10.1073/pnas.1301301110</pub-id></element-citation></ref><ref id="R18"><label>[18]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>de Boer</surname><given-names>CG</given-names></name><name><surname>Ray</surname><given-names>JP</given-names></name><name><surname>Hacohen</surname><given-names>N</given-names></name><name><surname>Regev</surname><given-names>A</given-names></name></person-group><article-title>MAUDE: infer vring expression changes in sorting-based CRISPR screens</article-title><source>Genome Biology</source><year>2020</year><volume>21</volume><issue>1</issue><elocation-id>134</elocation-id><pub-id pub-id-type="doi">10.1186/s13059-020-02046-8</pub-id></element-citation></ref><ref id="R19"><label>[19]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Komarova</surname><given-names>ES</given-names></name><etal/></person-group><article-title>Influence of the spacer region between the Shine-Dalgarno box and the start codon for fine-tuning of the translation efficiency in Escherichia coli</article-title><source>Microbial Biotechnology</source><year>2020</year><volume>13</volume><issue>4</issue><fpage>1254</fpage><lpage>1261</lpage><comment>URL <ext-link ext-link-type="uri" xlink:href="https://sfamjournals.onlinelibrary.wiley.com/doi/abs/10.1111/1751-7915.13561">https://sfamjournals.onlinelibrary.wiley.com/doi/abs/10.1111/1751-7915.13561</ext-link>.</comment><pub-id pub-id-type="doi">10.1111/1751-7915.13561</pub-id></element-citation></ref><ref id="R20"><label>[20]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bonde</surname><given-names>MT</given-names></name><etal/></person-group><article-title>Predictable tuning of protein expression in bacteria</article-title><source>Nature Methods</source><year>2016</year><volume>13</volume><issue>3</issue><fpage>233</fpage><lpage>236</lpage><comment>URL <ext-link ext-link-type="uri" xlink:href="https://www.nature.com/articles/nmeth.3727">https://www.nature.com/articles/nmeth.3727</ext-link>.</comment><pub-id pub-id-type="doi">10.1038/nmeth.3727</pub-id></element-citation></ref><ref id="R21"><label>[21]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Osterman</surname><given-names>IA</given-names></name><etal/></person-group><article-title>Translation at first sight: the influence of leading codons</article-title><source>Nucleic Acids Research</source><year>2020</year><volume>48</volume><issue>12</issue><fpage>6931</fpage><lpage>6942</lpage><comment>URL <ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/nar/article/48/12/6931/5840581">https://academic.oup.com/nar/article/48/12/6931/5840581</ext-link></comment><pub-id pub-id-type="doi">10.1093/nar/gkaa430</pub-id></element-citation></ref><ref id="R22"><label>[22]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Angenent-Mari</surname><given-names>NM</given-names></name><name><surname>Garruss</surname><given-names>AS</given-names></name><name><surname>Soenksen</surname><given-names>LR</given-names></name><name><surname>Church</surname><given-names>G</given-names></name><name><surname>Collins</surname><given-names>JJ</given-names></name></person-group><article-title>A deep learning approach to programmable RNA switches</article-title><source>Nature Communications</source><publisher-name>Nature Publishing Group</publisher-name><year>2020</year><volume>11</volume><issue>1</issue><elocation-id>5057</elocation-id><comment>number: 1</comment><pub-id pub-id-type="doi">10.1038/s41467-020-18677-1</pub-id></element-citation></ref><ref id="R23"><label>[23]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schmitz</surname><given-names>A</given-names></name><name><surname>Zhang</surname><given-names>F</given-names></name></person-group><article-title>Massively parallel gene expression variation measurement of a synonymous codon library</article-title><source>BMC Genomics</source><year>2021</year><volume>22</volume><issue>1</issue><elocation-id>149</elocation-id><comment>URL <ext-link ext-link-type="uri" xlink:href="https://bmcgenomics.biomedcentral.com/articles/10.1186/s12864-021-07462-z">https://bmcgenomics.biomedcentral.com/articles/10.1186/s12864-021-07462-z</ext-link>.</comment><pub-id pub-id-type="doi">10.1186/s12864-021-07462-z</pub-id></element-citation></ref><ref id="R24"><label>[24]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fajardo-Fontiveros</surname><given-names>O</given-names></name><etal/></person-group><article-title>Fundamental limits to learning closed-form mathematical models from data</article-title><source>ArXiv:2204.02704 [cond-mat, physics:physics]</source><year>2022</year><comment>URL <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/2204.02704">http://arxiv.org/abs/2204.02704</ext-link></comment></element-citation></ref><ref id="R25"><label>[25]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peterman</surname><given-names>N</given-names></name><name><surname>Levine</surname><given-names>E</given-names></name></person-group><article-title>Sort-seq under the hood: implications of design choices on large-scale characterization of sequence-function relations</article-title><source>BMC Genomics</source><year>2016</year><volume>17</volume><issue>1</issue><elocation-id>206</elocation-id><pub-id pub-id-type="doi">10.1186/s12864-016-2533-5</pub-id></element-citation></ref><ref id="R26"><label>[26]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Taniguchi</surname><given-names>Y</given-names></name><etal/></person-group><article-title>Quantifying E. coli Proteome and Transcriptome with Single-Molecule Sensitivity in Single Cells</article-title><source>Science</source><publisher-name>American Association for the Advancement</publisher-name><year>2010</year><volume>329</volume><issue>5991</issue><fpage>533</fpage><lpage>538</lpage><comment>Science section: Research Article</comment><pub-id pub-id-type="doi">10.1126/science.1188308</pub-id></element-citation></ref><ref id="R27"><label>[27]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Friedman</surname><given-names>N</given-names></name><name><surname>Cai</surname><given-names>L</given-names></name><name><surname>Xie</surname><given-names>XS</given-names></name></person-group><article-title>Linking Stochastic Dynamics to Population Distribution: An Analytical Framework of Gene Expression</article-title><source>Physical Review Letters</source><year>2006</year><volume>97</volume><issue>16</issue><elocation-id>168302</elocation-id><pub-id pub-id-type="doi">10.1103/PhysRevLett.97.168302</pub-id></element-citation></ref><ref id="R28"><label>[28]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Beal</surname><given-names>J</given-names></name><etal/></person-group><article-title>Meeting Measurement Precision Requirements for Effective Engineering of Genetic Regulatory Networks</article-title><source>ACS Synthetic Biology</source><publisher-name>American Chemical Society</publisher-name><year>2022</year><pub-id pub-id-type="doi">10.1021/acssynbio.1c00488</pub-id></element-citation></ref><ref id="R29"><label>[29]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Trippe</surname><given-names>BL</given-names></name><etal/></person-group><article-title>Randomized gates eliminate bias in sort-seq assays</article-title><source>Protein Science</source><year>2022</year><volume>31</volume><issue>9</issue><elocation-id>e4401</elocation-id><pub-id pub-id-type="doi">10.1002/pro.4401</pub-id></element-citation></ref><ref id="R30"><label>[30]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Pawitan</surname><given-names>Y</given-names></name></person-group><source>In all likelihood: statistical modelling and inference using likelihood</source><publisher-name>Oxford University Press</publisher-name><publisher-loc>Oxford</publisher-loc><year>2013</year></element-citation></ref><ref id="R31"><label>[31]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Satopaa</surname><given-names>V</given-names></name><name><surname>Albrecht</surname><given-names>J</given-names></name><name><surname>Irwin</surname><given-names>D</given-names></name><name><surname>Raghavan</surname><given-names>B</given-names></name></person-group><source>Finding a ”Knee-dle” in a Haystack: Detecting Knee Points in System Behavior</source><publisher-name>IEEE</publisher-name><publisher-loc>Minneapolis, MN, USA</publisher-loc><year>2011</year><fpage>166</fpage><lpage>171</lpage><comment>URL <ext-link ext-link-type="uri" xlink:href="http://ieeexplore.ieee.org/document/5961514/">http://ieeexplore.ieee.org/document/5961514/</ext-link>.</comment></element-citation></ref><ref id="R32"><label>[32]</label><element-citation publication-type="web"><person-group person-group-type="author"><name><surname>Arvai</surname><given-names>K</given-names></name></person-group><source>kneed</source><year>2020</year><comment>URL <ext-link ext-link-type="uri" xlink:href="https://github.com/arvkevi/kneed">https://github.com/arvkevi/kneed</ext-link>.</comment></element-citation></ref><ref id="R33"><label>[33]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sample</surname><given-names>PJ</given-names></name><etal/></person-group><article-title>Human 5 UTR design and variant effect prediction from a massively parallel translation assay</article-title><source>Nature Biotechnology</source><year>2019</year><volume>37</volume><issue>7</issue><fpage>803</fpage><lpage>809</lpage><comment>URL <ext-link ext-link-type="uri" xlink:href="http://www.nature.com/articles/s41587-019-0164-5">http://www.nature.com/articles/s41587-019-0164-5</ext-link>.</comment><pub-id pub-id-type="doi">10.1038/s41587-019-0164-5</pub-id></element-citation></ref><ref id="R34"><label>[34]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Salis</surname><given-names>HM</given-names></name><name><surname>Mirsky</surname><given-names>EA</given-names></name><name><surname>Voigt</surname><given-names>CA</given-names></name></person-group><article-title>Automated design of synthetic ribosome binding sites to control protein expression</article-title><source>Nature Biotechnology</source><publisher-name>Nature Publishing Group</publisher-name><year>2009</year><volume>27</volume><issue>10</issue><fpage>946</fpage><lpage>950</lpage><comment>URL <ext-link ext-link-type="uri" xlink:href="https://www.nature.com/articles/nbt.1568">https://www.nature.com/articles/nbt.1568</ext-link>.</comment><pub-id pub-id-type="doi">10.1038/nbt.1568</pub-id></element-citation></ref><ref id="R35"><label>[35]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Seo</surname><given-names>SW</given-names></name><etal/></person-group><article-title>Predictive combinatorial design of mRNA translation initiation regions for systematic optimization of gene expression levels</article-title><source>Scientific Reports</source><publisher-name>Nature Publishing Group</publisher-name><year>2014</year><volume>4</volume><issue>1</issue><elocation-id>4515</elocation-id><comment>URL <ext-link ext-link-type="uri" xlink:href="https://www.nature.com/articles/srep04515">https://www.nature.com/articles/srep04515</ext-link>.</comment><pub-id pub-id-type="doi">10.1038/srep04515</pub-id></element-citation></ref><ref id="R36"><label>[36]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Zou</surname><given-names>J</given-names></name><etal/></person-group><article-title>A primer on deep learning in genomics</article-title><source>Nature Genetics</source><publisher-name>Nature Publishing Group</publisher-name><year>2019</year><volume>51</volume><issue>1</issue><fpage>12</fpage><lpage>18</lpage><comment>number: 1. URL <ext-link ext-link-type="uri" xlink:href="https://www.nature.com/articles/s41588-018-0295-5">https://www.nature.com/articles/s41588-018-0295-5</ext-link>.</comment><pub-id pub-id-type="doi">10.1038/s41588-018-0295-5</pub-id></element-citation></ref><ref id="R37"><label>[37]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Quang</surname><given-names>D</given-names></name><name><surname>Xie</surname><given-names>X</given-names></name></person-group><article-title>DanQ: a hybrid convolutional and recurrent deep neural network for quantifying the function of DNA sequences</article-title><source>Nucleic Acids Research</source><year>2016</year><volume>44</volume><issue>11</issue><elocation-id>e107</elocation-id><pub-id pub-id-type="doi">10.1093/nar/gkw226</pub-id></element-citation></ref><ref id="R38"><label>[38]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zrimec</surname><given-names>J</given-names></name><name><surname>Buric</surname><given-names>F</given-names></name><name><surname>Kokina</surname><given-names>M</given-names></name><name><surname>Garcia</surname><given-names>V</given-names></name><name><surname>Zelezniak</surname><given-names>A</given-names></name></person-group><article-title>Learning the Regulatory Code of Gene Expression</article-title><source>Frontiers in Molecular Biosciences</source><year>2021</year><volume>8</volume><pub-id pub-id-type="doi">10.3389/fmolb.2021.673363</pub-id></element-citation></ref><ref id="R39"><label>[39]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Boer</surname><given-names>CG</given-names></name><etal/></person-group><article-title>Deciphering eukaryotic gene-regulatory logic with 100 million random promoters</article-title><source>Nature Biotechnology</source><publisher-name>Nature Publishing Group</publisher-name><year>2020</year><volume>38</volume><issue>1</issue><fpage>56</fpage><lpage>65</lpage><pub-id pub-id-type="doi">10.1038/s41587-019-0315-8</pub-id></element-citation></ref><ref id="R40"><label>[40]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Urtecho</surname><given-names>G</given-names></name><name><surname>Tripp</surname><given-names>AD</given-names></name><name><surname>Insigne</surname><given-names>KD</given-names></name><name><surname>Kim</surname><given-names>H</given-names></name><name><surname>Kosuri</surname><given-names>S</given-names></name></person-group><article-title>Systematic Dissection of Sequence Elements Controlling 70 Promoters Using a Genomically Encoded Multiplexed Reporter Assay in Escherichia coli</article-title><source>Biochemistry</source><publisher-name>American Chemical Society</publisher-name><year>2019</year><volume>58</volume><issue>11</issue><fpage>1539</fpage><lpage>1551</lpage><pub-id pub-id-type="doi">10.1021/acs.biochem.7b01069</pub-id></element-citation></ref><ref id="R41"><label>[41]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kinney</surname><given-names>JB</given-names></name><name><surname>Murugan</surname><given-names>A</given-names></name><name><surname>Callan</surname><given-names>CG</given-names></name><name><surname>Cox</surname><given-names>EC</given-names></name></person-group><article-title>Using deep sequencing to characterize the biophysical mechanism of a transcriptional regulatory sequence</article-title><source>Proceedings of the National Academy of Sciences</source><year>2010</year><volume>107</volume><issue>20</issue><fpage>9158</fpage><lpage>9163</lpage><comment>Proceedings of the National Academy of Sciences</comment><pub-id pub-id-type="doi">10.1073/pnas.1004290107</pub-id></element-citation></ref><ref id="R42"><label>[42]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Belliveau</surname><given-names>NM</given-names></name><etal/></person-group><article-title>Systematic approach for dissecting the molecular mechanisms of transcriptional regulation in bacteria</article-title><source>Proceedings of the National Academy of Sciences</source><year>2018</year><volume>115</volume><issue>21</issue><fpage>E4796</fpage><lpage>E4805</lpage><pub-id pub-id-type="doi">10.1073/pnas.1722055115</pub-id></element-citation></ref><ref id="R43"><label>[43]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Townshend</surname><given-names>B</given-names></name><name><surname>Kennedy</surname><given-names>AB</given-names></name><name><surname>Xiang</surname><given-names>JS</given-names></name><name><surname>Smolke</surname><given-names>CD</given-names></name></person-group><article-title>High-throughput cellular RNA device engineering</article-title><source>Nature Methods</source><publisher-name>Nature Publishing Group</publisher-name><year>2015</year><volume>12</volume><issue>10</issue><fpage>989</fpage><lpage>994</lpage><comment>number: 10. URL <ext-link ext-link-type="uri" xlink:href="https://www.nature.com/articles/nmeth.3486">https://www.nature.com/articles/nmeth.3486</ext-link>.</comment><pub-id pub-id-type="doi">10.1038/nmeth.3486</pub-id></element-citation></ref><ref id="R44"><label>[44]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>L</given-names></name><name><surname>Feng</surname><given-names>Z</given-names></name><name><surname>Wang</surname><given-names>X</given-names></name><name><surname>Wang</surname><given-names>X</given-names></name><name><surname>Zhang</surname><given-names>X</given-names></name></person-group><article-title>DEGseq: an R package for identifying differentially expressed genes from RNA-seq data</article-title><source>Bioinformatics (Oxford, England)</source><year>2010</year><volume>26</volume><issue>1</issue><fpage>136</fpage><lpage>138</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btp612</pub-id></element-citation></ref><ref id="R45"><label>[45]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Marioni</surname><given-names>JC</given-names></name><name><surname>Mason</surname><given-names>CE</given-names></name><name><surname>Mane</surname><given-names>SM</given-names></name><name><surname>Stephens</surname><given-names>M</given-names></name><name><surname>Gilad</surname><given-names>Y</given-names></name></person-group><article-title>RNA-seq: An assessment of technical reproducibility and comparison with gene expression arrays</article-title><source>Genome Research</source><publisher-name>Cold Spring Harbor Lab</publisher-name><year>2008</year><volume>18</volume><issue>9</issue><fpage>1509</fpage><lpage>1517</lpage><comment>URL <ext-link ext-link-type="uri" xlink:href="https://genome.cshlp.org/content/18/9/1509">https://genome.cshlp.org/content/18/9/1509</ext-link>.company: Cold Spring Harbor Laboratory Press Distributor: Cold Spring Harbor Laboratory Press Institution: Cold Spring Harbor Laboratory Press Label: Cold Spring Harbor Laboratory Press</comment><pub-id pub-id-type="doi">10.1101/gr.079558.108</pub-id></element-citation></ref><ref id="R46"><label>[46]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jiang</surname><given-names>H</given-names></name><name><surname>Wong</surname><given-names>WH</given-names></name></person-group><article-title>Statistical inferences for isoform expression in RNA-Seq</article-title><source>Bioinformatics</source><year>2009</year><volume>25</volume><issue>8</issue><fpage>1026</fpage><lpage>1032</lpage><pub-id pub-id-type="doi">10.1093/bioinformatics/btp113</pub-id></element-citation></ref><ref id="R47"><label>[47]</label><element-citation publication-type="report"><person-group person-group-type="author"><name><surname>Paszke</surname><given-names>A</given-names></name><etal/></person-group><source>PyTorch: An Imperative Style, High-Performance Deep Learning Library Tech Rep</source><year>2019</year><elocation-id>arXiv:1912.01703</elocation-id><comment>arXiv, URL <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1912.01703">http://arxiv.org/abs/1912.01703</ext-link></comment></element-citation></ref><ref id="R48"><label>[48]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Akiba</surname><given-names>T</given-names></name><name><surname>Sano</surname><given-names>S</given-names></name><name><surname>Yanase</surname><given-names>T</given-names></name><name><surname>Ohta</surname><given-names>T</given-names></name><name><surname>Koyama</surname><given-names>M</given-names></name></person-group><source>Optuna: A Next-generation Hyperparameter Optimization Framework KDD ’19</source><publisher-name>Association for Computing Machinery</publisher-name><publisher-loc>New York, NY, USA</publisher-loc><year>2019</year><fpage>2623</fpage><lpage>2631</lpage><pub-id pub-id-type="doi">10.1145/3292500.3330701</pub-id></element-citation></ref><ref id="R49"><label>[49]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Harris</surname><given-names>CR</given-names></name><etal/></person-group><article-title>Array programming with NumPy</article-title><source>Nature</source><publisher-name>Nature Publishing Group</publisher-name><year>2020</year><volume>585</volume><issue>7825</issue><fpage>357</fpage><lpage>362</lpage><comment>URL <ext-link ext-link-type="uri" xlink:href="https://www.nature.com/articles/s41586-020-2649-2">https://www.nature.com/articles/s41586-020-2649-2</ext-link>.</comment><pub-id pub-id-type="doi">10.1038/s41586-020-2649-2</pub-id></element-citation></ref><ref id="R50"><label>[50]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Virtanen</surname><given-names>P</given-names></name><etal/></person-group><article-title>SciPy 1.0: fundamental algorithms for scientific computing in Python</article-title><source>Nature Methods</source><publisher-name>Nature Publishing Group</publisher-name><year>2020</year><volume>17</volume><issue>3</issue><fpage>261</fpage><lpage>272</lpage><comment>number: 3. URL <ext-link ext-link-type="uri" xlink:href="https://www.nature.com/articles/s41592-019-0686-2">https://www.nature.com/articles/s41592-019-0686-2.</ext-link></comment><pub-id pub-id-type="doi">10.1038/s41592-019-0686-2</pub-id></element-citation></ref><ref id="R51"><label>[51]</label><element-citation publication-type="web"><person-group person-group-type="author"><name><surname>Brodtkorb</surname><given-names>PA</given-names></name></person-group><source>numdifftools</source><year>2022</year><comment>URL <ext-link ext-link-type="uri" xlink:href="https://github.com/pbrod/numdifftools">https://github.com/pbrod/numdifftools</ext-link>. Original-date: 2014-03-12T17:31:06Z.</comment></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>Overview of the FORECAST Python package and core functionality.</title><p>(<bold>a</bold>) Main steps of a Flow-seq experiment. Experimental factors included in FORECAST’s probabilistic model are shown below each step. (<bold>b</bold>) Schematic of the FORECAST package. FORECAST allows for the definition of experimental designs that can then be simulated to generate synthetic Flow-seq data. Inference of phenotype (i.e., fluorescence distribution) from real and synthetic Flow-seq data can be performed using either a Method of Moments (MOM) or Maximum Likelihood (ML) approach. (<bold>c</bold>) Negative log-likelihood surface computed from synthetic Flow-seq data of an example genetic variant. The ML inference method starts from the MOM estimate (blue point) and minimise the negative log-likelihood to find more accurate estimate (grey point) of the true parameter value (yellow point).</p></caption><graphic xlink:href="EMS156800-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>Characterizing the performance of the inference methods.</title><p>(<bold>a</bold>) Scatter plot of estimated versus true mean fluorescence values from a simulated Flow-seq experiment of 1018 genetic variants. Each filled point corresponds to a genetic variant, blue for MOM estimates and grey for ML estimates. Black dashed lines denotes <italic>x</italic> = <italic>y</italic> (i.e., perfect accuracy). (<bold>b</bold>) Scatter plot of estimated versus true standard deviation (SD) in fluorescence for the same Flow-seq simulation. Each filled point corresponds to a genetic variant, blue for MOM estimates and grey for ML estimates. Black dashed lines denotes <italic>x</italic> = <italic>y</italic> (i.e., perfect accuracy). Pairs of annotated points highlighted by an unfilled black circle and connected by a line correspond to the MOM (top) and ML (bottom) estimates for the same genetic variant. Annotation corresponds to panel displaying the underlying distributions (<bold>f–h</bold>). (<bold>c</bold>) Sampled distribution of the fluorescence mean inferred using the MOM (blue) and ML (grey) approach for 500 separate Flow-seq experiments with the true value shown as a black dashed line for the ‘mob’ genetic variant. (<bold>d</bold>) Sampled distribution of the fluorescence SD inferred using the MOM (blue) and ML (grey) approach for the same replicate Flow-seq experiments with the true value shown as a black dashed line for the ‘mob’ genetic variant. (<bold>e</bold>) Sampled distribution of the 1-Wasserstein distance inferred using the MOM (blue) and ML (grey) approach for the same replicate Flow-seq experiments for the ‘mob’ genetic variant. (<bold>f</bold>, <bold>g</bold>, <bold>e</bold>) Inferred (blue line for MOM and grey line for ML) and true (black dashed line) density distributions plotted on top of the discrete histogram of cells sorted (light orange) for the highlighted genetic variants in panel b.</p></caption><graphic xlink:href="EMS156800-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>Effect of experimental design parameters on the accuracy of phenotype inference for Flow-seq experiments.</title><p>(<bold>a</bold>) Global accuracy given by the Mean 1-Wasserstein distance (MWD) of a simulated Flow-seq experiments with 8 bins used for cell sorting and varying numbers of sequencing reads per genetic variant and numbers of cells sorted per variant. MWD shown for inference using Method of Moments (MOM; blue lines) and Maximum Likelihood (ML; grey lines) and standard deviation in these measurements shown by shared regions around each line. (<bold>b</bold>) Global accuracy in terms of MWD shown for same experiments as in panel a, but using 32 bins for cell sorting. (<bold>c</bold>) Mean Absolute Percentage Error (MAPE) when estimating the fluorescence mean using either MOM (blue) or ML (grey) inference methods. Averages were taken over the full library of genetic variants and Flow-seq simulation replicates. Black dashed line denotes the general optimal operating point. (<bold>d</bold>) MAPE when estimating the fluorescence standard deviation (SD) using either MOM (blue) or ML (grey) inference methods. Averages were taken over the full library of genetic variants and Flow-seq simulation replicates. (<bold>e</bold>) Coefficients of the multiple linear regression (MLR) used to fit the MWD as a function of the number of sorting bins (‘Bins’), the log-number of reads (‘Reads’) and log-number of cells per genetic variant (‘Cells’). (f) Distribution of the optimal operating point in terms of the number of sequencing reads per genetic variant in a Flow-seq experiment for MOM (blue, bottom) and ML (grey, top) inference methods. (g) Distribution of the optimal operating point in terms of the number of cells sorted per genetic variant in a Flow-seq experiment for MOM (blue, bottom) and ML (grey, top) inference methods.</p></caption><graphic xlink:href="EMS156800-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>Understanding the limits to prediction accuracy from Flow-seq experiments.</title><p>(<bold>a</bold>) Accuracy upper limit when predicting the mode bin as a function of the number of sequencing reads and cells sorted per genetic variant. Cells sorted per variant took the values 1, 6, 11, 16, 21, 26, 31, 36, 41, 46, 51, 56, 72, 80, 100, 120, 140, 160, 180, 200 (light to dark blue lines). Each value was estimated by running FORECAST simulations with different experimental factors. (<bold>b</bold>) Neural network architectures used to predict the mode bin from 5’ untranslated region (5’UTR) sequence. <bold>(c)</bold> Scatter plot of the validation set accuracy against the number of trainable parameters in the model. Each point corresponds to a particular combination of hyperparameters for a class of neural network (MLP = blue; CNN = orange; RNN = purple, Hybrid = green). (d) Confusion matrix of the hybrid CNN+RNN architecture with the best performance and fewest trained parameters evaluated on a previous Flow-seq study [<xref ref-type="bibr" rid="R16">16</xref>]. Global accuracy is 51.8%.</p></caption><graphic xlink:href="EMS156800-f004"/></fig></floats-group></article>