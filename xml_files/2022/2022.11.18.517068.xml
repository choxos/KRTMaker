<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS157425</article-id><article-id pub-id-type="doi">10.1101/2022.11.18.517068</article-id><article-id pub-id-type="archive">PPR573817</article-id><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title><italic>Dandelion</italic> utilizes single cell adaptive immune receptor repertoire to explore lymphocyte developmental origins</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Suo</surname><given-names>Chenqu</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref><xref ref-type="fn" rid="FN1">8</xref></contrib><contrib contrib-type="author"><name><surname>Polanski</surname><given-names>Krzysztof</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="fn" rid="FN1">8</xref></contrib><contrib contrib-type="author"><name><surname>Dann</surname><given-names>Emma</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Lindeboom</surname><given-names>Rik G.H.</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Vilarrasa-Blasi</surname><given-names>Roser</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Vento-Tormo</surname><given-names>Roser</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Haniffa</surname><given-names>Muzlifah</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Meyer</surname><given-names>Kerstin B.</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Dratva</surname><given-names>Lisa M.</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Tuong</surname><given-names>Zewen Kelvin</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A5">5</xref><xref ref-type="aff" rid="A7">7</xref><xref ref-type="fn" rid="FN2">9</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib><contrib contrib-type="author"><name><surname>Clatworthy</surname><given-names>Menna R.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A5">5</xref><xref ref-type="fn" rid="FN2">9</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib><contrib contrib-type="author"><name><surname>Teichmann</surname><given-names>Sarah A.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A6">6</xref><xref ref-type="fn" rid="FN2">9</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib></contrib-group><aff id="A1"><label>1</label>Wellcome Sanger Institute; Wellcome Genome Campus, Hinxton, Cambridge, UK</aff><aff id="A2"><label>2</label>Department of Paediatrics, Cambridge University Hospitals; Hills Road, Cambridge, UK</aff><aff id="A3"><label>3</label>Biosciences Institute, Newcastle University; Newcastle upon Tyne, UK</aff><aff id="A4"><label>4</label>Department of Dermatology and NIHR Newcastle Biomedical Research Centre, Newcastle upon Tyne Hospitals NHS Foundation Trust; Newcastle upon Tyne, UK</aff><aff id="A5"><label>5</label>Molecular Immunity Unit, University of Cambridge Department of Medicine; Cambridge, UK</aff><aff id="A6"><label>6</label>Theory of Condensed Matter, Cavendish Laboratory, Department of Physics, University of Cambridge; Cambridge, UK</aff><aff id="A7"><label>7</label>Frazer Institute, Faculty of Medicine, The University of Queensland, Brisbane, Australia</aff><author-notes><corresp id="CR1">
<label>*</label>Corresponding authors. <email>z.tuong@uq.edu.au</email> (Z.K.T.), <email>mrc38@cam.ac.uk</email> (M.R.C.), <email>st9@sanger.ac.uk</email> (S.A.T.).</corresp><fn id="FN1" fn-type="equal"><label>8</label><p id="P1">These authors contributed equally to this work.</p></fn><fn id="FN2" fn-type="equal"><label>9</label><p id="P2">These senior authors contributed equally to this work.</p></fn></author-notes><pub-date pub-type="nihms-submitted"><day>21</day><month>11</month><year>2022</year></pub-date><pub-date pub-type="preprint"><day>19</day><month>11</month><year>2022</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P3">Assessment of single-cell gene expression (scRNA-seq) and adaptive immune receptor sequencing (scVDJ-seq) has been invaluable in studying lymphocyte biology. Here, we introduce <italic>Dandelion</italic>, a computational pipeline for scVDJ-seq analysis. It enables the application of standard V(D)J analysis workflows to single-cell datasets, delivering improved V(D)J contig annotation and the identification of non-productive and partially spliced contigs. We devised a novel strategy to create an adaptive immune receptor feature space that can be used for both differential V(D)J usage analysis and pseudotime trajectory inference. The application of <italic>Dandelion</italic> improved the alignment of human thymic development trajectories of double positive T cells to mature single-positive CD4/CD8 T cells, with important new predictions of factors regulating lineage commitment. <italic>Dandelion</italic> analysis of other cell compartments provided novel insights into the origins of human B1 cells and ILC/NK cell development, illustrating the power of our approach. <italic>Dandelion</italic> is an open access resource (<ext-link ext-link-type="uri" xlink:href="https://www.github.com/zktuong/dandelion">https://www.github.com/zktuong/dandelion</ext-link>) that will enable future discoveries.</p></abstract></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P4">Recent developments in single-cell genomics have significantly advanced our understanding of human immunology<sup><xref ref-type="bibr" rid="R1">1</xref>,<xref ref-type="bibr" rid="R2">2</xref></sup>. Paired adaptive immune receptor (AIR) sequencing with mRNA expression in the same cell allows for direct linkage of AIR repertoire with cellular phenotypes, and has proven to be a powerful tool in understanding lymphocyte development and function in healthy and disease contexts<sup><xref ref-type="bibr" rid="R3">3</xref>–<xref ref-type="bibr" rid="R6">6</xref></sup>.</p><p id="P5">Multi-omics analysis leverages data from different modalities and has been successfully applied in recent years to study cellular biology at an unprecedented resolution. Examples include integration of paired single-cell RNA sequencing (scRNA-seq) and Assay for Transposase-Accessible Chromatin with high-throughput sequencing (ATAC-seq) data or Cellular Indexing of Transcriptomes and Epitopes by Sequencing (CITE-seq) data<sup><xref ref-type="bibr" rid="R7">7</xref>,<xref ref-type="bibr" rid="R8">8</xref></sup>. However, unlike many other sequencing modalities, which largely consist of continuous data, AIR repertoire sequencing data are a mixture of categorical and continuous data which pose additional challenges for integration. AIR data consist of annotations of variable (V), diversity (D) and joining (J) genes, which are recombined and selected during B/T cell development<sup><xref ref-type="bibr" rid="R9">9</xref></sup>. The Adaptive Immune Receptor Repertoire (AIRR) community was formed in 2015 to help address the issues and challenges related to the curation and analysis of AIR data generated with high throughput sequencing technologies<sup><xref ref-type="bibr" rid="R10">10</xref>–<xref ref-type="bibr" rid="R12">12</xref></sup>. This has led to the standardization of repertoire data representation across various modes of AIR data, including single-cell V(D)J sequencing data. There are established options and packages that can deal with single-cell AIR repertoire data and they provide a variety of methods for downstream analyses (non-exhaustive list of some popular tools shown in <bold>Supplementary Fig. 1</bold>). The functions include re-annotation of genes in AIR contigs, quality control checks, matching contigs to cells, clonotype definition, mutation quantification and diversity estimation and many more (<bold>Supplementary Fig. 1</bold>). The single-cell AIR softwares are often designed to interact with a single-cell gene expression software package of choice, e.g. <italic>scirpy<sup><xref ref-type="bibr" rid="R13">13</xref></sup></italic> with <italic>scanpy<sup><xref ref-type="bibr" rid="R14">14</xref></sup></italic> and <italic>scRepertoire<sup><xref ref-type="bibr" rid="R15">15</xref></sup></italic> with <italic>Seurat<sup><xref ref-type="bibr" rid="R16">16</xref></sup></italic>, providing valuable visualization options. There are also tools for predicting antigen specificity of T cell receptors (TCRs) (e.g. <italic>TcellMatch<sup><xref ref-type="bibr" rid="R17">17</xref></sup></italic>), annotating TCRs that recognize known epitopes (e.g. Platypus<sup><xref ref-type="bibr" rid="R18">18</xref></sup>, Immunarch<sup><xref ref-type="bibr" rid="R19">19</xref></sup>) and extraction of significant motifs and motif groups (e.g. <italic>ALICE<sup><xref ref-type="bibr" rid="R20">20</xref></sup></italic>). There have also been developments in joint-embedding of single-cell gene expression and AIR complementarity-determining region 3 (CDR3) sequences, which have been used for correlating TCRs with T cell transcriptomes (e.g. <italic>CoNGA<sup><xref ref-type="bibr" rid="R21">21</xref></sup>, mvTCR<sup><xref ref-type="bibr" rid="R22">22</xref></sup></italic>). There remains opportunities for new methods to realize the full potential of paired scRNA-seq and scVDJ-seq data.</p><p id="P6">To that end, we developed <italic>Dandelion</italic>, a holistic analysis framework within the context of single-cell lymphocyte biology. It offers a B cell receptor (BCR) and TCR contig annotation pipeline, integrative analysis with single cell RNA-seq data and a novel V(D)J feature space for differential V(D)J usage and pseudotime trajectory inference. Here, using two immune development datasets, we showcase how <italic>Dandelion</italic> can be applied to improve alignment of cells along the double positive (DP) T cell to mature T cell development trajectory, and provide novel insights into human B1 cell origin and innate lymphoid cell (ILC) and natural killer (NK) cell development.</p></sec><sec id="S2" sec-type="results"><title>Results</title><sec id="S3"><title><italic>Dandelion</italic> enables holistic scVDJ-seq analysis</title><p id="P7">As <italic>Dandelion</italic> operates on the AIRR data format, it has high interoperability with existing tools in the AIRR community<sup><xref ref-type="bibr" rid="R13">13</xref>,<xref ref-type="bibr" rid="R23">23</xref></sup> and can serve as a bridge between these tools and single-cell gene expression analysis software ecosystem e.g. <italic>scverse<sup><xref ref-type="bibr" rid="R14">14</xref>,<xref ref-type="bibr" rid="R24">24</xref></sup></italic> (<xref ref-type="fig" rid="F1">Fig. 1a</xref>). <italic>Dandelion</italic> has also been certified by the AIRR Software Working Group to be compliant with the software standards that encourage collaboration and reproducibility.</p><p id="P8"><italic>Dandelion</italic> can be used to analyze single-cell BCR, αβTCR and γδTCR data, allowing for BCR mutation calling, improved γδTCR mapping, extraction of both productive and non-productive V(D)J contigs and identification of unspliced J gene alignments (‘multi-J mapping’) (<xref ref-type="fig" rid="F1">Fig. 1b</xref>). <italic>Dandelion</italic> then performs quality control checks, clonotype calling and clonotype network generation for downstream analyses, and is designed to work with any AIRR formatted input or 10X Genomics’ <italic>cellranger vdj</italic> output. A main novel feature of <italic>Dandelion</italic> is the creation of a ‘V(D)J feature space’ that can be used to visualize TCR/BCR usage across cell pseudo-bulks or neighborhoods, perform differential V(D)J usage analysis and pseudotime trajectory inference. A summary list of features of <italic>Dandelion</italic> and a non-exhaustive list of other existing pipelines is shown in <bold>Supplementary Fig. 1</bold>. A subset of the functionalities of <italic>Dandelion</italic> was previously applied to a large COVID-19 study<sup><xref ref-type="bibr" rid="R4">4</xref></sup> which showcased its network-based repertoire diversity analysis method.</p></sec><sec id="S4"><title><italic>Dandelion</italic> provides a streamlined contig re-annotations pipeline</title><p id="P9">For optional re-annotation of contigs, <italic>Dandelion</italic> expects 10X Genomics’ <italic>cellranger vdj</italic> output files, specifically the contig annotation spreadsheet and fasta file (e.g. <italic>all_contig_annotations.csv</italic> and <italic>all_contig.fasta</italic>).</p><p id="P10">Similar to <italic>Change-O<sup><xref ref-type="bibr" rid="R23">23</xref></sup></italic>, <italic>Dandelion</italic> re-annotates V(D)J contigs using <italic>igblastn<sup><xref ref-type="bibr" rid="R25">25</xref></sup></italic> with reference sequences contained in the international ImMunoGeneTics information system (IMGT) database<sup><xref ref-type="bibr" rid="R26">26</xref></sup>. The individual contigs are then checked with <italic>blastn</italic> for the D and J gene separately, using the same settings as per <italic>igblastn<sup><xref ref-type="bibr" rid="R25">25</xref></sup></italic>. The additional <italic>blastn</italic> step allows us to: i) apply an e-value cut off for D and J calls to ensure only high confidence calls are retained; ii) identify multi-J mapping contigs (see below); and iii) recover contigs without V gene calls (removed by <italic>igblastn</italic>). We packaged this pre-processing workflow into a single-line command implemented via a <italic>singularity</italic> container to streamline and improve the user experience, circumventing the difficulty of setting up the various software environments and dependencies.</p><p id="P11">Non-productive contigs, which are contigs that cannot be translated into a functional protein, are often filtered out by other scVDJ-seq analysis pipelines e.g. <italic>scirpy<sup><xref ref-type="bibr" rid="R13">13</xref></sup>, scRepertoire<sup><xref ref-type="bibr" rid="R15">15</xref></sup></italic>, <italic>Platypus<sup><xref ref-type="bibr" rid="R18">18</xref></sup></italic> (<bold>Supplementary Fig. 1</bold>). In the <italic>Immcantation/changeo<sup><xref ref-type="bibr" rid="R23">23</xref></sup></italic> workflow, non-productive contigs are preserved and there are specific instructions for filtering or retention during annotation and clone definition steps. Moreover, <italic>igblastn</italic> is a V gene annotation tool<sup><xref ref-type="bibr" rid="R25">25</xref></sup> and would filter contigs without V gene presence. We found that a significant proportion of contigs were non-productive in αβTCR, γδTCR and BCR data from fetal human tissues<sup><xref ref-type="bibr" rid="R3">3</xref></sup> and the majority were due to absent V genes, with the exception of the TRA locus where most non-productive contigs were annotated due to presence of premature stop codons (<xref ref-type="fig" rid="F2">Fig. 2a</xref>). This pattern was consistent even after excluding thymic samples to remove the influence of developing T cells (<bold>Supplementary Fig. 2a</bold>). These non-productive contigs without V genes were captured in scVDJ-seq because the rapid amplification of 5′ complementary DNA (cDNA) ends (5′ RACE) technology used in the protocol does not require primers against V genes for targeted enrichment, in contrast to the previous multiplex PCR approach (<bold>Supplementary Fig. 2b</bold>). Although these contigs are not translated into functional proteins, they likely represent products of partial or failed recombination that we reasoned are still biologically meaningful, reflecting a cell’s history and origin. The <italic>Immcantation</italic> workflow would divert these contigs into a <italic>“failed”</italic> file and this file is not typically exposed to the user unless specified explicitly. Therefore, <italic>Dandelion</italic> does not automatically filter out non-productive contigs, and this data has utility, as later discussed, when we used it to track B1 cell origin and ILC/NK development.</p><p id="P12">We have also discovered that multiple J genes can be sequentially mapped onto different regions in the same messenger RNA (mRNA) contig, a phenomenon we termed ‘multi-J mapping’. Looking at the most frequent multi-J mapping contigs in each locus (<xref ref-type="supplementary-material" rid="SD1">Supplementary Table 1</xref>), we found that the majority were two to four neighboring J genes on the genome interspersed with introns. As the process of linking the chosen J to C genes is achieved through RNA splicing rather than DNA recombination, contigs with multi-J mapping are likely products of partially spliced transcripts (<xref ref-type="fig" rid="F2">Fig. 2c</xref>). Nevertheless, it is biologically plausible that the J gene nearest to the 5′ end is the intended exon that would be expressed in the mature mRNA.</p><p id="P13">We next investigated factors that might contribute to multi-J mapping. We first noted that non-productive contigs without V genes appeared to be more likely to have multi-J mapping (<xref ref-type="fig" rid="F2">Fig. 2c</xref>). This difference could be due to nonsense-mediated decay (NMD), an RNA degradation process that is triggered when translation encounters a premature stop codon<sup><xref ref-type="bibr" rid="R27">27</xref></sup>. Multi-J mapping contigs that contain a V gene will initiate translation from the V gene, which will trigger degradation by NMD due to premature stop codons in J gene introns. Transcripts of multi-J mapping without a V gene cannot be translated and will therefore evade degradation by NMD. To test the contribution of NMD to multi-J mapping, we treated peripheral blood mononuclear cells (PBMCs) with cycloheximide to block NMD and analyzed treated and untreated cells by scRNA-seq with scVDJ-seq. This resulted in an increase in the proportion of multi-J mapping in TCR contigs with V genes (<bold>Supplementary Fig. 2c</bold>), supporting the conclusion that NMD recognises and degrades V-gene containing multi-J mapping contigs.</p><p id="P14">We used a logistic regression model to look for additional factors associated with multi-J mapping (<xref ref-type="fig" rid="F2">Fig. 2d</xref>) in both the Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup> dataset (<xref ref-type="supplementary-material" rid="SD2">Supplementary Table 2</xref>) and the new control/cycloheximide-treated PBMC dataset that we generated for this study (<xref ref-type="supplementary-material" rid="SD3">Supplementary Table 3</xref>). The above finding was further supported by a significant interaction (Benjamini–Hochberg (BH) adjusted <italic>P</italic>-value 7.07e-04) between V gene presence and cycloheximide treatment, although the significant non-interacting V gene term (BH adjusted <italic>P</italic>-value 5.73e-182) in the regression fit suggests that NMD may only partially account for the effect of V genes on multi-J mapping. Furthermore, we compared the sequences of 5′ end J genes positively and negatively associated with multi-J mapping and found the known consensus motif for splicing, ‘GTAAGT’ in +1 to +6 position of adjacent intron<sup><xref ref-type="bibr" rid="R28">28</xref></sup>, was disrupted in J genes associated with more multi-J mapping (<xref ref-type="fig" rid="F2">Fig. 2e</xref>, <xref ref-type="supplementary-material" rid="SD4">Supplementary Table 4</xref>). In conclusion, the factors that might contribute to multi-J mapping include specific cell types and J gene identity, which potentially affect splicing efficiencies; as well as V gene presence, which might be partially explained by NMD (illustrated by <bold>Supplementary Fig. 2d)</bold>.</p><p id="P15">An additional application of <italic>Dandelion</italic>’s contig annotation functionality is that it allows for γδTCR contig annotation. There are two existing methods for sc-γδTCR mapping: i) the <italic>cellranger vdj</italic> pipeline developed by 10X Genomics, although this is primarily tailored for αβTCR contigs; ii) the <italic>TRUST4<sup><xref ref-type="bibr" rid="R29">29</xref></sup></italic> software which performs <italic>de novo</italic> contig assembly and annotation. The <italic>cellranger</italic> software is capable of reconstructing the γδTCR contigs, but most versions struggle with annotating them, a problem 10X was aware of and addressed with user-side workaround instructions (see <xref ref-type="supplementary-material" rid="SD7">Supplementary Note 1</xref>). While <italic>TRUST4 can yield</italic> sc-TCR annotations, including γδTCR, it relies on the presence of a V gene in the contig thus unable to handle non-productive contigs without V genes. Supplying the reconstructed contigs into <italic>Dandelion</italic>’s pre-processing pipeline from the cellranger output yields reannotated output that can be used for downstream analysis. We processed 33 γδTCR libraries<sup><xref ref-type="bibr" rid="R3">3</xref></sup>; One mapping was done with <italic>cellranger</italic> 6.1.2 to the 10X GRCh38 5.0.0 V(D)J reference, with the contigs identified by <italic>cellranger</italic> as high confidence subsequently reannotated with <italic>Dandelion</italic>. Another mapping was done with <italic>cellranger</italic> 6.1.2 to the 5.0.0 reference modified to obtain annotated γδTCR contigs as per 10X Genomics’ workaround instructions. We see a consistent higher recovery rate of both high confidence γδTCR contigs and high confidence productive γδTCR contigs in the mapping post-processed with <italic>Dandelion</italic>, verified as statistically significant by the Wilcoxon signed-rank test (<italic>P</italic>-value for high confidence contigs: 5.39e-7, <italic>P</italic>-value for high confidence productive contigs: 3.14e-6) and showing a large effect size (rank correlations equal to 1 and 0.98 for all high confidence contigs and high confidence productive contigs respectively) (<xref ref-type="fig" rid="F2">Fig. 2f</xref>). While 10X Genomics has introduced some γδTCR support with <italic>cellranger</italic> 7.0.0, the results were inferior to the prior workaround from version 6 (<bold>Supplementary Fig. 2e</bold>).</p></sec><sec id="S5"><title>Creating a V(D)J feature space</title><p id="P16">To better leverage the combined gene expression and AIR repertoire data, we introduced a novel analysis strategy to create a pseudo-bulk V(D)J feature space, which transforms V(D)J data from categorical to continuous format for downstream applications (<xref ref-type="fig" rid="F3">Fig. 3a</xref>). Transcriptionally similar cells are first grouped into pseudo-bulks, which can be based on metadata features, or partially overlapping cell neighborhoods<sup><xref ref-type="bibr" rid="R30">30</xref></sup>. For instance, cells can be pseudobulked by annotated cell type, donor and organ to perform differential gene usage analysis across cell types while appropriately controlling for donor and organ differences. For trajectory analysis, we recommend pseudo-bulking cells by partially overlapping cell neighborhoods sampled from gene expression space e.g. using <italic>Milo<sup><xref ref-type="bibr" rid="R30">30</xref></sup></italic> to model a more continuous cell state. For each pseudo-bulk, we compute the fraction of cells using each of the genes within the same segment (e.g. TRAJ1 to TRAJ61 in the TRAJ segment). These vectors of fractions are concatenated across V(D)J segments of interest to form the feature vector in the V(D)J space. This can then be used with conventional dimension reduction techniques such as principal component analysis (PCA) or uniform manifold approximation and projection (UMAP).</p><p id="P17">The utility of this V(D)J feature space is demonstrated on a dataset containing adult human T cells<sup><xref ref-type="bibr" rid="R5">5</xref></sup> (<xref ref-type="fig" rid="F3">Fig. 3b</xref>). We pseudo-bulked cells by cell types and donors to explore differential usage that is consistent across different donors. On the new UMAP computed from the V(D)J feature space, pseudo-bulks containing mucosal-associated invariant T (MAIT) cells formed a distinct cluster away from the others, in contrast to the single-cell gene expression space UMAP, indicating its unique V(D)J usage (<xref ref-type="fig" rid="F3">Fig. 3b</xref>, <bold>Supplementary Fig. 3a-b</bold>). This is expected due to the semi-invariant nature of MAIT TCRs and illustrates the power of V(D)J feature space. Although there is no clear clustering in other cell types apart from MAIT (<bold>Supplementary Fig. 3b</bold>), there is a distinct separation between cell types that belong to CD4+T cells with those of CD8+T cells (<xref ref-type="fig" rid="F3">Fig. 3b</xref>). The differential V(D)J usage for each cell type can be computed similarly to differentially expressed gene calculation e.g. with non-parametric statistical tests implemented within <italic>scanpy<sup><xref ref-type="bibr" rid="R14">14</xref></sup></italic> (<xref ref-type="fig" rid="F3">Fig. 3b</xref>, <xref ref-type="supplementary-material" rid="SD5">Supplementary Table 5</xref>).</p></sec><sec id="S6"><title>Leveraging V(D)J usage in pseudotime trajectory inference</title><p id="P18">We also developed a novel usage for V(D)J data by performing pseudotime inference in lymphocytes with the cell neighborhood-based V(D)J feature space. Many pseudotime inference methods have been proposed to infer cell development based on transcriptomic similarity<sup><xref ref-type="bibr" rid="R31">31</xref></sup>. However, the current approaches remain problematic in immune cell development because the differentiation process is often interspersed with waves of proliferation, and transcriptomic convergence e.g. between NKT cells and NK cells can be misleading. Because usage of V(D)J genes in AIRs changes definitively as a result of cycles of recombination and selection during lymphocyte development, the AIR repertoire acts as a natural ‘time-keeper’ for developing T and B cells. A developing T cell’s fate towards CD8 <italic>versus</italic> CD4 T cells is determined by whether its TCR interacts with antigen presented on MHC class I or class II during positive selection. Therefore, it is biologically conceivable that the TCR gives more accurate predictions on the branch probability to each T cell lineage. This is the motivation for leveraging V(D)J data in pseudotime inference. For this task, we chose to pseudo-bulk by cell neighborhoods as modeling cell states with partially overlapping cell neighborhoods has advantages over clustering into discrete groups; clusters do not always provide the appropriate resolution and might miss important transition states.</p><p id="P19">We sampled cell neighborhoods on a k-nearest neighbor (KNN) graph built with gene expression data using <italic>Milo<sup><xref ref-type="bibr" rid="R30">30</xref></sup></italic>. An example is shown in <bold>Supplementary Fig. 3c</bold> and <xref ref-type="fig" rid="F3">Fig. 3c</xref> using the dataset from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup> showing cells with paired productive αβTCR from double positive (DP) T cells to mature CD4+T and CD8+T. This neighborhood V(D)J feature space was the input to compute pseudotime with <italic>palantir<sup><xref ref-type="bibr" rid="R32">32</xref></sup></italic>. It outputs pseudotime and branch probabilities (<xref ref-type="fig" rid="F3">Fig. 3c</xref>) to each terminal state with a predefined starting point and terminal states (<bold>Supplementary Fig. 3d</bold>). The inferred pseudotime follows from proliferating DP (DP(P)) to quiescent DP (DP(Q)) T cells, to abT(entry) which splits into CD8+T and CD4+T lineages. Trends of TCR usage can also be visualized along the pseudotime trajectory (<bold>Supplementary Fig. 3e</bold>). Pseudotime and branch probabilities can then be projected back from neighborhoods to cells (<xref ref-type="fig" rid="F4">Fig. 4a</xref>) by averaging the parameters from all neighborhoods a given cell belongs to, weighted by the inverse of the neighborhood size.</p><p id="P20">There are two alternative tools, <italic>CoNGA<sup><xref ref-type="bibr" rid="R21">21</xref></sup></italic> and <italic>mvTCR<sup><xref ref-type="bibr" rid="R22">22</xref></sup></italic>, that also offer integration of transcriptional profiles with TCR information. Both of them were created to detect clonally expanded cell phenotypes with CDR3 sequences being the input. We tested whether they could also be used to reveal developmental relationships with the same dataset above. With <italic>CoNGA</italic>, the relationships between cell types were not preserved (<bold>Supplementary Fig. 4a</bold>). Same applies to mvTCR (<bold>Supplementary Fig. 4b</bold>), which failed to separate CD4+T cells from CD8+T cells. This is not surprising, as what is changing during recombination is selection of different V(D)J genes, while CDR3 junctional sequence diversity can additionally be influenced by random nucleotide insertions. This likely explains why the sequence-based methods do not capture the intercellular relationships as faithfully as the V(D)J feature space.</p></sec><sec id="S7"><title>V(D)J trajectory accurately orders DP T cells and reveals early CD4/CD8 lineage decision genes</title><p id="P21">We next compared the pseudotime and branch probabilities inferred from the neighborhood V(D)J feature space with the same parameters inferred from either single-cell gene expression or neighborhood gene expression feature space.</p><p id="P22">Pseudotime inferred directly from single-cell gene expression performed unsatisfactorily, as a large proportion of CD8+T and CD4+T cells were misclassified with higher branch probabilities to the opposite terminal state (<bold>Supplementary Fig. 5a-b</bold>). We mainly focused our comparison with results from pseudo-bulked neighborhood gene expression (GEX) space, which produced more biologically meaningful pseudotime and branch probabilities (<xref ref-type="fig" rid="F4">Fig. 4a</xref>). To construct the pseudo-bulked neighborhood GEX space, raw gene counts were pseudo-bulked by the same neighborhoods used to construct the V(D)J feature space (<bold>Supplementary Fig. 3c</bold>), and then normalized and logarithmically transformed. Pseudotime and branch probabilities were computed on this neighborhood GEX feature space and projected back to cells (<bold>Supplementary Fig. 5c and d</bold>). The inferred pseudotime in the pseudo-bulked space better reflected the known biology of DP(P)_T to DP(Q)_T, to abT(entry) and subsequent splits into CD8+T and CD4+T lineages. This suggests that pseudotime inference with pseudo-bulked cells work better than directly from single cells, potentially due to more stable transcriptomic profiles compared to more noisy single-cell data.</p><p id="P23">We observed two major differences when comparing the pseudotime inferred from neighborhood V(D)J feature space <italic>versus</italic> that from neighborhood GEX space (<xref ref-type="fig" rid="F4">Fig. 4a</xref>). First, DP(Q) T cells appeared to dwell for a longer ‘time’ in the V(D)J trajectory as compared to the GEX trajectory. Second, the branching point of CD8+T and CD4+T cell lineages happened earlier in abT(entry) cells in the V(D)J trajectory (<bold>Supplementary Fig. 6c</bold>). In order to assess the fidelity of the V(D)J trajectory, we used the known fact that V-J recombination in the TRA locus happens processively<sup><xref ref-type="bibr" rid="R33">33</xref></sup> using genes in the middle of the genomic locus and progressing to the two distal ends in an orderly manner. We have therefore encoded the genomic order numerically for each TRAV and TRAJ gene, and looked at the average TRAV and TRAJ relative locations for each DP(Q) neighborhood against their pesudotime ordering (<xref ref-type="fig" rid="F4">Fig. 4b</xref>). V(D)J pseudotime showed a substantially better monotonic relationship with TRAV relative locations. Local Pearson’s correlations were computed over sliding windows of 30 adjacent neighborhoods on the pseudotime order (<bold>Supplementary Fig. 6a</bold>), and V(D)J pseudotime had higher absolute correlation coefficients on average (-0.67 <italic>versus</italic> -0.43 for TRAV). A smaller improvement was also observed for TRAJ, with the average local Pearson’s correlations improved from 0.42 to 0.50 (<bold>Supplementary Fig. 6b</bold>).</p><p id="P24">CD4 <italic>versus</italic> CD8 T cell lineage commitment is a classical immunological binary lineage decision that has been intensely investigated over many years<sup><xref ref-type="bibr" rid="R34">34</xref></sup> but remains challenging to study as the selection intermediates have been difficult to observe directly<sup><xref ref-type="bibr" rid="R35">35</xref></sup>. We examined which genes in abT(entry) cells showed expression patterns that are correlated with branch probabilities to CD8+T lineage (<xref ref-type="fig" rid="F4">Fig. 4c</xref>). This approach actually allows us to subdivide the abT(entry) cell population into two subsets, associated with higher probability of CD4 <italic>versus</italic> CD8 differentiation respectively.</p><p id="P25">When considering the top genes that were positively correlated with the CD8+ T cell lineage choice, these included <italic>CD8A</italic> and <italic>CD8B</italic>, which are markers for CD8+T cells<sup><xref ref-type="bibr" rid="R6">6</xref></sup>. The top genes that were negatively correlated included <italic>CD40LG</italic>, which is a marker for CD4+T helper cells<sup><xref ref-type="bibr" rid="R6">6</xref></sup>, and <italic>ITM2A</italic> which is found to be induced during positive selection and causes CD8 downregulation<sup><xref ref-type="bibr" rid="R36">36</xref></sup>. Other markers of CD4+T cells such as <italic>CD4<sup><xref ref-type="bibr" rid="R6">6</xref></sup></italic>, together with highly validated transcription factors (TFs) that are known to be involved in CD8+T or CD4+T lineage decisions<sup><xref ref-type="bibr" rid="R34">34</xref></sup>, including <italic>RUNX3<sup><xref ref-type="bibr" rid="R37">37</xref>,<xref ref-type="bibr" rid="R38">38</xref></sup>, ZBTB7B<sup><xref ref-type="bibr" rid="R39">39</xref>,<xref ref-type="bibr" rid="R40">40</xref></sup>, TOX<sup><xref ref-type="bibr" rid="R41">41</xref></sup></italic> and <italic>GATA3<sup><xref ref-type="bibr" rid="R42">42</xref>,<xref ref-type="bibr" rid="R43">43</xref></sup></italic> all displayed significant correlations in the expected directions. In contrast, when we performed the same test with CD8+T branch probabilities from GEX pseudotime, the magnitude of the correlation coefficients were notably reduced and some (e.g. <italic>TOX</italic> and <italic>RUNX3</italic>) were no longer statistically significant (<xref ref-type="fig" rid="F4">Fig. 4c</xref>). In the case of <italic>TOX</italic>, the direction of the correlation was wrongly inverted (<xref ref-type="fig" rid="F4">Fig. 4c</xref>). In addition, the V(D)J pseudotime also revealed novel associations between the trajectories and TFs such as <italic>ZNF496, MBNL2</italic> and <italic>RORC</italic> for CD8+T, and <italic>SATB1, STAT5A</italic> and <italic>STAT1</italic> for CD4+T (<bold>Supplementary Fig. 6d</bold>, full gene list in <xref ref-type="supplementary-material" rid="SD6">Supplementary Table 6</xref>). These new insights into TFs predicted to be involved in lineage commitment merit future investigations and validations.</p><p id="P26">We have also used different pseudotime inference methods to ensure the robustness of the results. Pseudotime inferred from neighborhood V(D)J space using <italic>palantir<sup><xref ref-type="bibr" rid="R32">32</xref></sup>, monocle3<sup><xref ref-type="bibr" rid="R44">44</xref></sup></italic>, and <italic>diffusion pseudotime<sup><xref ref-type="bibr" rid="R45">45</xref></sup></italic> was very similar (<bold>Supplementary Fig. 7a</bold>) and they all showed a better monotonic relationship with TRAV or TRAJ relative locations compared to pseudotime inferred from neighborhood GEX space (<bold>Supplementary Fig. 7b</bold>). However, <italic>palantir</italic> is preferred as the only method allowing output of branch probability to each terminal state, which is useful in deciphering CD4/8 lineage decisions as shown above.</p><p id="P27">Taken together, we showed that V(D)J-based pseudotime inference gives more accurate DP(Q) T cell alignment, improves association of CD8/CD4 branch probabilities within abT(entry) cells allowing us to subdivide this cell state. We can use this approach to recapitulate known regulators, and uncover novel candidate regulators underlying CD8+T/CD4+T fate choice.</p></sec><sec id="S8"><title>New insights into lymphocyte development using non-productive recombination as a “fossil record”</title><p id="P28">Based on our earlier observations of high proportions of non-productive contigs being represented in the single-cell V(D)J data (<xref ref-type="fig" rid="F2">Fig. 2a</xref>), we next explored whether different lymphoid cell types expressed different proportions of non-productive contigs. While non-productive BCR contigs were restricted to B lineage cells (<bold>Supplementary Fig. 8a-b</bold>) as expected, we were surprised to find that non-productive TRB contigs were not only expressed in developing DN T cells, but also in the ILC/NK lineage, and some B lineage cells (<xref ref-type="fig" rid="F5">Fig. 5a</xref>, <bold>Supplementary Fig. 8c</bold>). The majority of the non-productive TRB contigs within ILC/NK/B cells were contigs without V gene (<bold>Supplementary Fig. 8d</bold>).</p><p id="P29">The B lineage cells with non-productive TRB contigs included pre-pro B and B1 cells but not pro- or pre-B cells (<xref ref-type="fig" rid="F5">Fig. 5a</xref>, <bold>Supplementary Fig. 8c</bold>). Pre-pro B and B1 cells expressed only non-productive TRB but not TRG/D contigs (<bold>Supplementary Fig. 9a-c</bold>), suggesting that pre- pro B and B1 cells share a common development route (<xref ref-type="fig" rid="F5">Fig. 5b</xref> schematic illustration) while bypassing pro- or pre-B cell stages. This clarifies that B1 cells in human fetal development stages can emerge through an alternative route to the rest of mature B cells (B2 cells). The conventional B cell differentiation route is thought to start from pre-pro B cells, the earliest cells that are committed to B lineage. The cells then progress through the pro- and pre-B cell stages, rearranging their BCR heavy and light chains respectively, while expressing the pre-BCR, and then emerge as immature B cells with a productive BCR and then finally differentiate into mature naive B cells<sup><xref ref-type="bibr" rid="R46">46</xref></sup>. Our observations are consistent with findings in murine B1s, which were shown to bypass the pre-BCR selection stage<sup><xref ref-type="bibr" rid="R47">47</xref>,<xref ref-type="bibr" rid="R48">48</xref></sup> that normally happens in pre-B cells to remove self-reactive B cells. This may also explain why B1 cells have BCRs with shorter non-coded/palindromic (N/P) nucleotide insertions<sup><xref ref-type="bibr" rid="R3">3</xref></sup>, due to negligible expression of DNTT in pre-pro B but much higher expression in pro- and late pro-B cells<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. In addition, as pre-pro B cells are almost undetectable in adult bone marrow<sup><xref ref-type="bibr" rid="R49">49</xref></sup>, this potentially explains why we were unable to definitively locate B1-like cells in adult human tissues<sup><xref ref-type="bibr" rid="R3">3</xref></sup>.</p><p id="P30">The ILC/NK lineage also expressed non-productive TRG/D contigs with some TRA contigs (<bold>Supplementary Fig. 9a-c</bold>), similar to DN T cells. With the V(D)J feature space described above (<xref ref-type="fig" rid="F3">Fig. 3</xref>), we used TRBJ frequency as the input to delineate T/ILC/NK developmental trajectories, since all of them express TRBJ (<xref ref-type="fig" rid="F5">Fig. 5b</xref>, <bold>Supplementary Fig. 10a</bold>). The inferred trajectory suggests that ILC/NK cells deviate away from T cell development between DN(early) and DN(Q) stage (<xref ref-type="fig" rid="F5">Fig. 5b</xref>-<bold>c</bold>).</p><p id="P31">Previous literature on the ILC/NK lineage has also demonstrated partial recombination of TRG/D in murine lung ILC2<sup><xref ref-type="bibr" rid="R50">50</xref></sup>, and of TRB/G in murine thymic ILC2<sup><xref ref-type="bibr" rid="R51">51</xref></sup>, leading to the hypothesis of ‘aborted’ DNs for ILC/NK development<sup><xref ref-type="bibr" rid="R52">52</xref></sup>. Our observation of the expression of non-productive TRB/G/D in ILC/NK cells partially supports this theory. Notably, we also observed non-productive TRB expression in ILC/NK cells in other fetal organs, with no overt differences in frequencies between organs (<bold>Supplementary Fig. 9d</bold>). This potentially suggests that T cells and ILC/NK cells might share the same initial stage of development, and then deviate away from each other before productive TRB/G/D is made.</p><p id="P32">In addition, by examining the expression patterns of transcription factors (<xref ref-type="fig" rid="F5">Fig. 5c</xref>) and genes encoding cell surface proteins (<bold>Supplementary Fig. 10b</bold>) that changed along the TRBJ-inferred pseudotime, we can define stages for DN development at higher resolution than previously reported in the literature. We observed that expression levels of genes such as <italic>SPI1, RAG1, HHEX, TCF12, CD34, CD3D, CD8A, CD8B</italic> followed an expected pattern along the trajectory<sup><xref ref-type="bibr" rid="R53">53</xref></sup>. At the same time, we also discovered many novel genes that could redefine DN stages. We further noted that there were some discordances in expression patterns of selected transcription factors between human and mouse DN development<sup><xref ref-type="bibr" rid="R53">53</xref></sup> (<bold>Supplementary Fig. 10c</bold>). However, this discrepancy could be due to age mismatch i.e. fetal human to adult mouse, and the murine data was mainly learnt from transcription factor knockout instead of scRNA-seq studies. Comparison across different human age groups, as well as a detailed comparison with mouse thymic scRNA-seq with paired scVDJ-seq data need to be performed in the future.</p><p id="P33">Finally, we have also explored BCR expression in plasmacytoid dendritic cells (pDC). Several papers have reported that pDC can be derived from both myeloid and lymphoid progenitors<sup><xref ref-type="bibr" rid="R54">54</xref>,<xref ref-type="bibr" rid="R55">55</xref></sup> and there is IgH D-J rearrangement in some pDCs<sup><xref ref-type="bibr" rid="R54">54</xref>,<xref ref-type="bibr" rid="R56">56</xref>–<xref ref-type="bibr" rid="R59">59</xref></sup>. The question is whether the pDCs that have initiated BCR rearrangements are derived from lymphoid progenitors<sup><xref ref-type="bibr" rid="R54">54</xref>,<xref ref-type="bibr" rid="R55">55</xref></sup>. We have repeated the analysis in all the myeloid cells in the human fetal dataset<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. There are indeed some non-productive BCR in pDC (both heavy and light chain as shown in <bold>Supplementary Fig. 11a and b</bold>), in agreement with previously reported IgH D-J rearrangement in pDC<sup><xref ref-type="bibr" rid="R54">54</xref>,<xref ref-type="bibr" rid="R56">56</xref>–<xref ref-type="bibr" rid="R59">59</xref></sup>. However, pDC itself expresses RAG and DNTT (<bold>Supplementary Fig. 11c</bold>). This means that the presence of non-productive BCR does not necessarily indicate that pDCs are derived from lymphoid progenitors as BCR rearrangement can be carried by RAG in pDC itself, similar to what has been claimed in Shigematsu et al. 2004<sup><xref ref-type="bibr" rid="R57">57</xref></sup>. While it may be interesting to use our VDJ-based trajectory to explore whether the development of pDC overlaps with early B cell development, the current dataset is limited by the cell number as only 51 pDC and cycling pDC cells have non-productive IGH. This is certainly worth future investigations when the data becomes available.</p><p id="P34">In summary, the unexpected finding of expression of non-productive TCR contigs in specific cell types has the potential to shed new light on the origin and history of lymphocyte development. We have utilized this information and suggested that B1 potentially arises directly from pre-pro B cells, and provided support for the ‘aborted’ DN theory for the origin of ILC/NK cells.</p></sec></sec><sec id="S9" sec-type="discussion"><title>Discussion</title><p id="P35">Overall, <italic>Dandelion</italic> improves upon existing methods with more refined contig annotations, recognising non-productive contigs, identifying multi-J mapping and recovering more γδTCR contigs. In conjunction with our novel V(D)J feature space approach with pseudotime trajectory inference, it has allowed us to better align CD4 <italic>versus</italic> CD8 T cell lineage commitment processes, and further identify developmental origins of innate-like lymphocyte cells.</p><p id="P36">Our improved data processing workflow revealed two unexpected data challenges and opportunities with scVDJ-seq. First, the surprising observation that a high proportion of TCR/BCR contigs are non-productive suggests that these are unique data challenges in the single-cell space due to choice of library construction. However, it is not unexpected as V(D)J rearrangement is a ‘wasteful’ exercise, a price that comes with the generation of effective and diverse immune response; for example, two out of three rearrangement events for immunoglobulins are destined to be non-productive<sup><xref ref-type="bibr" rid="R60">60</xref>,<xref ref-type="bibr" rid="R61">61</xref></sup>. While non-productive TCRs and BCRs from high-throughput ‘bulk’ AIR sequencing data have previously been used in conjunction with productive contigs to estimate the generation probabilities and diversities of AIRs during affinity maturation and infection<sup><xref ref-type="bibr" rid="R62">62</xref>,<xref ref-type="bibr" rid="R63">63</xref></sup>, these would only have factored in those with V gene annotation due to library construction limitations. Through scVDJ-seq and analysis using <italic>Dandelion</italic>, we now have the ability to corroborate this at the single-cell level, including partially rearranged contigs, as outlined in our analysis of innate lymphocyte development. This suggests that the presence of the non-productive contigs may have important biological implications in a cell-type specific manner.</p><p id="P37">Second, detection of multi-J mapping suggests that these are naturally occurring and likely represent products of partial splicing events at the transcript level. A few factors were identified to be associated with multi-J mapping, including J gene identities, which potentially affect splicing efficiencies with their disrupted splicing site, as well as V gene presence, which might be partially explained by NMD<sup><xref ref-type="bibr" rid="R27">27</xref></sup>. The biological implications of the presence of these multi-J mapping contigs are unclear at this stage and require future experimental validation to understand how and why they arise.</p><p id="P38">We introduced a novel way of analyzing the single-cell V(D)J modality in <italic>Dandelion</italic> with the pseudo-bulk V(D)J feature space, which can be used for visualization and differential V(D)J usage testing. In addition, when the pseudo-bulking is done by gene expression neighborhoods, the V(D)J feature space is anchored to the underlying gene expression feature space where cell neighborhoods are sampled. We utilized this approach for pseudotime trajectory inference and demonstrated its advantages in both of our case studies.</p><p id="P39">The first case study examined the processes underlying T cell development in the thymus. Our approach allowed us to discover that fate commitment starts earlier than expected with the inclusion of TCR information. It was previously suggested that abT(entry) cells were likely to be a point of divergence due to its position as an intermediary cell state between DP T cells and mature single positive T cells<sup><xref ref-type="bibr" rid="R6">6</xref></sup>. With this new technique that includes TCR information, we are now able to better delineate the branching point to a much earlier point within the abT(entry) cells. The gene expression patterns of marker genes and transcription factors known to be associated with CD4 <italic>versus</italic> CD8 T cell fate were better aligned with the new trajectories. Our analysis has further revealed novel CD4/8 associations with other transcription factors that remain to be explored.</p><p id="P40">Similar approaches can be applied to other TCR trajectories in different contexts e.g. across different developmental stages in human lifespan, diseases and <italic>in vitro</italic> settings. It remains to be seen whether a VDJ-based trajectory can be utilized in T cell activation. Furthermore, this approach has not been optimized for BCR trajectories, as we are limited by the small number of B progenitors in the existing dataset collections. Further, BCRs have additional rearrangement rules that need to be considered e.g. somatic hypermutation, differential rearrangement events leading to asymmetric usage of kappa and lambda light chains and light chain editing processes<sup><xref ref-type="bibr" rid="R64">64</xref></sup>, as well as recently described light chain coherence in functional antibodies<sup><xref ref-type="bibr" rid="R65">65</xref></sup>. We hope to improve on these aspects in a future iteration of <italic>Dandelion</italic> when more single-cell V(D)J data become available.</p><p id="P41">The second case study extended the observations of non-productive V(D)J contig representation in 10X Genomics’ single-cell data, which has been largely ignored and/or not easily accessible with other existing workflows e.g. <italic>scirpy<sup><xref ref-type="bibr" rid="R13">13</xref></sup></italic> and <italic>immcantation<sup><xref ref-type="bibr" rid="R23">23</xref></sup></italic>. Our unexpected finding that B1 cells and pre-pro B cells were expressing relatively higher levels of non-productive TRB contigs suggest that B1 lineage commitment diverged earlier than expected, some time between the pre-pro B stage and pro-B stage. Two competing models have been described with regard to B1 origin<sup><xref ref-type="bibr" rid="R66">66</xref></sup>. The lineage model, or layered immune system hypothesis<sup><xref ref-type="bibr" rid="R67">67</xref></sup> proposed that B1 cells compared to B2 cells arise from distinct progenitors emerging at different times during development<sup><xref ref-type="bibr" rid="R68">68</xref>–<xref ref-type="bibr" rid="R71">71</xref></sup>; while the selection model hypothesized that they originate from the same progenitors but after differential signaling depending on self-reactivity<sup><xref ref-type="bibr" rid="R72">72</xref>,<xref ref-type="bibr" rid="R73">73</xref></sup>. Our finding here potentially offers a reconciliation of both models, with fetal specific pre-pro B cells being B1 progenitors supporting the layered immune system model, and the skipping of pre-BCR selection presumably allows formation of self-reactive BCR in support of the selection model.</p><p id="P42">The enrichment of the non-productive TRB contigs is not just found in the pre-pro B and B1 cells, but also in NK and ILC lineage cells along with non-productive TRG and TRD. The latter lineage is easier to explain as partial recombination of TCR has been reported in murine ILC<sup><xref ref-type="bibr" rid="R50">50</xref>,<xref ref-type="bibr" rid="R51">51</xref></sup> and our findings support the ‘abandoned’ DN theory<sup><xref ref-type="bibr" rid="R52">52</xref></sup>. The hypothesis is that ILC/NK cells are originally on a canonical T cell development trajectory, but subsequently influenced to abort this process, resulting in sustained expression of non-productive TCR rearrangements whilst developing into ILC/NK. Perhaps this is driven by overexpression of key transcription factors such as <italic>ID2</italic> and <italic>ZBTB16<sup><xref ref-type="bibr" rid="R52">52</xref>,<xref ref-type="bibr" rid="R53">53</xref></sup></italic>, or lack of NOTCH signaling<sup><xref ref-type="bibr" rid="R52">52</xref></sup>. While we cannot rule out other routes of ILC/NK development, our new insights do support the notion that T and NK/ILC developments partially overlap but diverge before productive TCRs are rearranged. Our analysis offers new insights into transcription factors and surface marker genes that define DN T cell stages at high resolution, opening avenues for future indepth investigation.</p><p id="P43">In summary, we present <italic>Dandelion</italic> as an easy-to-use package/pipeline for integrative analyses of single-cell GEX and V(D)J data modality. The package is freely available online at <ext-link ext-link-type="uri" xlink:href="https://github.com/zktuong/dandelion">https://github.com/zktuong/dandelion</ext-link> with tutorials and demo cases and is actively updated for further improvements. The pseudo-bulk V(D)J data is also publicly available for use as a reference to project or align new query data e.g. for disease samples such as cancers that originate from T cells. We hope that the software and the resource will be useful to the community for exploring lymphocyte biology in the single-cell space, generating new insights that will help advance our understanding of immune cell development and function in health and disease.</p></sec><sec id="S10" sec-type="methods" specific-use="web-only"><title>Methods</title><sec id="S11"><title>Dandelion</title><sec id="S12"><title>Pre-processing</title><p id="P44"><italic>Dandelion</italic> can run the pre-processing of data using the standard outputs from all <italic>cellranger vdj</italic> versions. In this manuscript, single-cell V(D)J data from the 5′ Chromium 10X kit were initially processed with <italic>cellranger vdj</italic> pipeline (v6.1.2) with <italic>cellranger vdj</italic> reference (v5.0.0). TCR and BCR contigs contained in ‘<italic>all_contigs.fasta</italic>’ and ‘<italic>all_contig_annotations.csv</italic>’ from all three library types (αβTCR, γδTCR and BCR) were then reannotated using an <italic>immcantation-inspired<sup><xref ref-type="bibr" rid="R23">23</xref></sup></italic> pre-processing pipeline contained in the <italic>Dandelion</italic> singularity container (v0.3.0).</p><p id="P45">The pre-processing pipeline includes the following steps: <list list-type="simple" id="L1"><list-item><label>i)</label><p id="P46">adjust cell and contig barcodes by adding user-supplied suffixes and/or prefixes to ensure that there are no overlapping barcodes between samples;</p></list-item><list-item><label>ii)</label><p id="P47">optionally subset to contigs deemed high confidence in the <italic>cellranger</italic> output; this was done in the analysis performed here;</p></list-item><list-item><label>iii)</label><p id="P48">re-annotation of contigs with <italic>igblastn</italic> (v1.19.0) against IMGT (international ImMunoGeneTics) reference sequences (last downloaded: 01/08/2021) with the following parameters: minimum D gene nucleotide match = 9, V gene e-value cutoff = 10<sup>-4</sup>; rearrangements missing the CDR3/junction sequences are enforced to be nonproductive (productive = “F”) and incomplete (complete_vdj = “F”).</p></list-item><list-item><label>iv)</label><p id="P49">re-annotation of D and J genes separately using <italic>blastn</italic> with similar parameters as per <italic>igblastn<sup><xref ref-type="bibr" rid="R25">25</xref></sup></italic> (dust =“no”, word size (J = 7; D = 9)) but with an additional e-value cutoff (J = 10<sup>-4</sup> in contrast to <italic>igblastn</italic>’s default cut off of 10; D = 10<sup>-3</sup>). This is to enable annotation of contigs without the V gene present;</p></list-item><list-item><label>v)</label><p id="P50">identification and recovery of non-overlapping individual J gene segments (under associated ‘<italic>j_chain_multimapper</italic>’ columns). In the list of all mapped J genes (<italic>all_contig_j_blast.tsv</italic>) from <italic>blastn</italic>, the J gene with the highest score (<italic>j_support</italic>) was chosen. <italic>Dandelion</italic> then looks for the next J gene with the highest ‘<italic>j_support</italic>’ value, and with start (<italic>j_sequence_start</italic>) and end (<italic>j_sequence_end</italic>) position not overlapping with the selected J gene, and does so iteratively until the list of all mapped J genes is exhausted. In contigs without V gene annotations, we then select the 5′ end leftmost J gene and update the ‘<italic>j_call</italic>’ column in the final AIRR table. For contigs with V gene annotations, but with multiple J gene calls, we use the annotations provided by <italic>igblastn</italic> (NCBI IgBLAST Release 1.19.0’s release notes states that they <italic>“*Added logic to handle the case where there is an unrearranged J gene downstream of the VDJ rearrangement</italic>.”).</p></list-item></list></p><p id="P51">For BCRs, there are two additional steps: <list list-type="simple" id="L2"><list-item><label>vi)</label><p id="P52">additional re-annotation of heavy-chain constant (C) region calls using <italic>blastn</italic> (v2.13.0+) against curated sequences from CH1 regions of respective isotype class;</p></list-item><list-item><label>vii)</label><p id="P53">heavy chain V gene allele correction using tigger (v1.0.0)<sup><xref ref-type="bibr" rid="R75">75</xref></sup>. The final outputs are then parsed into AIRR format with <italic>change-o</italic> scripts<sup><xref ref-type="bibr" rid="R23">23</xref></sup>.</p></list-item></list></p><p id="P54">All the outputs from each step are saved in a subfolder which the user can elect to retain or remove as per their requirements. Typically a user would proceed with the file ending with the suffix ‘<italic>_contig_dandelion.tsv</italic>’ as this represents the rearrangement sequences that pass standard quality control checks. In this manuscript, we used the data found in the ‘<italic>all_contig_db-all.tsv</italic>’ as it also contains the multi-J mapping.</p></sec><sec id="S13"><title>Post-processing</title><p id="P55">In addition to the pre-processing steps at the contig level, post-processing, or integrating celllevel quality control, is performed using <italic>Dandelion</italic>’s ‘<italic>check_contig</italic>’ function. The function checks through whether a rearrangement is annotated with consistent V, D, J and C gene calls and performs special operations when a cell has multiple contigs. All contigs in a cell are sorted according to the unique molecular identifier (UMI) count in a descending order and productive contigs are ordered higher than non-productive contigs. For cells with other than one pair of productive contigs (one VDJ and one VJ), the function will assess if the cell is to be flagged with having orphan (no paired VDJ or VJ chain), extra pair(s) or ambiguous (biologically irreconcilable e.g. both TCRs and BCRs in the same cell) status with some exceptions: ii) IgM and IgD are allowed to co-exist in the same B cell if no other isotypes are detected; ii) TRD and TRB contigs are allowed in the same cell because rearrangement of TRB and TRD loci happens at the same time during development and TRD variable region genes exhibits allelic inclusion<sup><xref ref-type="bibr" rid="R76">76</xref></sup>. The function also asserts a library type restriction with the rationale that the choice of the library type should mean that the primers used would most likely amplify only relevant sequences to a particular loci. Therefore, if there are any annotations to unexpected loci, these contigs likely represent artifacts and will be filtered away. A more stringent version of ‘<italic>check_contigs</italic>’ is implemented in a separate function, ‘<italic>filter_contigs</italic>’, which only considers productive VDJ contigs, asserts a single-cell should only have one VDJ and one VJ pair, or only an orphan VDJ chain, and explicitly removes contigs that fail these checks (with the same exceptions for IgM/IgD and TRB/TRD as per above). If a single-cell gene expression object (<italic>AnnData</italic>) is provided to the functions, it will also remove contigs that do not match to any cell barcodes in the gene expression data. Lastly, <italic>Dandelion</italic> can accept any AIRR-formatted data formats e.g. BDRhapsody VDJ data.</p></sec><sec id="S14"><title>Clonotype definition and diversity</title><p id="P56"><italic>Dandelion</italic>’s mode of clonotype definition and network based diversity analysis has been previously described<sup><xref ref-type="bibr" rid="R4">4</xref></sup>. Briefly, TCRs and BCRs are grouped into clones/clonotypes based on the following sequential criteria that apply to both heavy-chain and light-chain contigs: (1) identical V and J gene usage; (2) identical junctional CDR3 amino acid length; (3) CDR3 sequence similarity: for TCRs, 100% nucleotide sequence identity at the CDR3 junction is recommended while the default setting for BCRs is to use 85% amino acid sequence similarity (based on Hamming distance). Single-cell V(D)J networks are constructed using adjacency matrices computed from pairwise Levenshtein distance of the full amino acid sequence alignment for TCR/BCR(s) on a per cell basis. A minimum-spanning tree is then constructed on the adjacency matrix for each clone/clonotype, creating a simple graph with edges indicating the shortest total edit distance between a cell and its neighbor. Cells with total pairwise edit distance of zero are then connected to the graph to recover edges trimmed off during the minimum-spanning-tree construction step. A graph layout is then computed either using the Fruchterman–Reingold algorithm in <italic>networkx</italic> (≥ v2.5) or Scalable Force-Directed Placement algorithm implemented through <italic>graph-tool</italic> package<sup><xref ref-type="bibr" rid="R77">77</xref>,<xref ref-type="bibr" rid="R78">78</xref></sup>. Visualization of the resulting single-cell V(D)J network is achieved via transfer of the graph to relevant ‘<italic>AnnData</italic>’ slots, allowing for access to plotting tools in <italic>scanpy</italic>. The resulting V(D)J network enables computation of Gini coefficients based on cluster/cell size/centrality distributions, as discussed previously<sup><xref ref-type="bibr" rid="R4">4</xref></sup>.</p></sec><sec id="S15"><title>Pseudo-bulk V(D)J feature space</title><p id="P57">Pseudo-bulk construction requires pseudo-bulk assignment information of cells, along with V and J genes for the cells’ identified primary TCR/BCR contigs (selected based on productive status and highest UMI count). The former is a cell by pseudo-bulk binary matrix which can be either explicitly provided by the user or inferred from unique combinations of cell level discrete metadata. While the code is calibrated to work with <italic>Dandelion</italic>’s structuring by default, it can work with any V(D)J processing provided it stores cell level information on primary per-locus V/D/J calls. The input is used to generate a pseudo-bulk by V(D)J feature space, with the V(D)J calls converted to a binary matrix, added up for each pseudo-bulk, and normalized to a unit sum on a per-pseudo-bulk, per-locus, per-segment basis. The cell by pseudo-bulk information is stored in the resulting object for potential communication with the original cell space. Utility functions are provided for compatibility with <italic>palantir<sup><xref ref-type="bibr" rid="R32">32</xref></sup></italic> output for trajectory inference.</p></sec></sec><sec id="S16"><title>Non-productive TCR/BCR contigs</title><p id="P58">Single-cell BCR, αβTCR and γδTCR data from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup> were remapped with <italic>cellranger vdj</italic> (v6.1.2) and processed further using <italic>Dandelion</italic> as described above. For all samples, contigs were extracted from ‘<italic>all_contig_igblast_db-all.tsv</italic>’ or in the case whereby ‘<italic>all_contig_igblast_db-all.tsv</italic>’ was empty, <italic>‘all_contig_igblast_db-fail.tsv</italic>’ was used. Preprocessed and annotated scRNA-seq data was downloaded from <ext-link ext-link-type="uri" xlink:href="https://developmental.cellatlas.io/fetal-immune">https://developmental.cellatlas.io/fetal-immune</ext-link>. Only contigs from annotated cells were kept for downstream analysis. For each contig, productive status was obtained from the column ‘<italic>productive</italic>’, and the causes for non-productive contigs were extracted from <italic>‘vj_in_frame’</italic> (is ‘F’ if there is a frameshift), ‘<italic>stop_codon</italic>’ (is ‘T’ if there is a premature stop codon) and <italic>‘v_gene_present</italic>’ (is ‘False’ if V gene is absent) columns.</p></sec><sec id="S17"><title>Cycloheximide treatment on PBMC</title><p id="P59">A vial of frozen PBMCs was acquired from Stemcell Technologies with informed consent (as stated by Stemcell Technologies) and approval from the Yorkshire &amp; The Humber - Leeds East Research Ethics Committee (19/YH/0441). Frozen PBMCs were thawed in pre-warmed RF10 media, which was RPMI (Sigma-Aldrich) supplemented with 10% fetal bovine serum (FBS; Gibco) and penicillin/streptomycin (Sigma-Aldrich). Cells were pelleted by centrifugation at 500g for 5 min and resuspended in RF10 media, and split between two 10 cm petri dishes. Control PBMCs were then incubated in a total of 10 ml RF10 media at 37°C for 2 hr, whereas treated PBMCs were incubated in RF10 supplemented with cycloheximide (Sigma-Aldrich; final concentration of 100 μg/ml). After incubation, control and treated PBMCs were washed with ice cold RF10 and resuspended in 2% FBS in phosphate buffered saline (PBS; Gibco). For treated PBMCs, both the washing and resuspension buffer contained 100 μg/ml cycloheximide.</p><p id="P60">Control and treated PBMCs were then loaded onto two separate channels of the Chromium chip from Chromium single cell V(D)J kit (10X Genomics 5′ v2) following the manufacturer’s instructions before droplet encapsulation on the Chromium controller. Single-cell cDNA synthesis, amplification, gene expression (GEX) and targeted BCR and αβTCR libraries were generated. Sequencing was performed on the Illumina Novaseq 6000 system. The gene expression libraries were sequenced at a target depth of 50,000 reads per cell using the following parameters: Read1: 26 cycles, i7: 8 cycles, i5: 0 cycles; Read2: 91 cycles to generate 75-bp paired-end reads. BCR and TCR libraries were sequenced at a target depth of 5000 reads per cell.</p><p id="P61">Raw scRNA-seq reads were mapped with <italic>cellranger</italic> 3.0.2 with Ensembl 93 based GRCh38 reference. Low quality cells were filtered out (minimum number of reads &gt; 2000, minimum number of genes &gt; 500, maximum number of genes &lt; 7000, maximum mitochondrial reads fraction &lt; 0.2, maximum <italic>scrublet<sup><xref ref-type="bibr" rid="R79">79</xref></sup></italic> (v0.2.1) doublet score ≤ 0.5). Data normalization and log transformation were performed using <italic>scanpy<sup><xref ref-type="bibr" rid="R14">14</xref></sup></italic> (v1.9.1) (<italic>scanpy.pp.normalize_per_cell(counts_per_cell_after=10e4</italic>) and <italic>scanpy.pp.log1p</italic>). Highly variable genes were then selected (<italic>scanpy.pp.highly_variable_genes</italic>), and PCA (<italic>scanpy.pp.pca</italic>), neighborhood graph (<italic>scanpy.pp.neighbors</italic>) and UMAP (<italic>scanpy.tl.umap</italic>) were computed. Automatic annotation was done using <italic>celltypist</italic> (v1.2.0) (<italic>celltypist.annotate(model = 'Immune_All_Low.pkl', majority_voting = True)</italic>).</p><p id="P62">Single-cell αβTCR and BCR sequencing data was mapped with <italic>cellranger vdj</italic> (v6.1.2) and processed further using <italic>Dandelion</italic> as described above. For all samples, contigs were extracted from ‘<italic>all_contig_igblast_db-all.tsv’</italic> or in the case whereby ‘<italic>all_contig_igblast_db-all.tsv</italic>’ was empty, <italic>‘all_contig_igblast_db-fail.tsv’</italic> was used. Only contigs from annotated cells were kept for downstream analysis.</p></sec><sec id="S18"><title>Factors associated with multi-J mapping</title><sec id="S19"><title>Logistic regression analysis</title><p id="P63">We used the following logistic regression model to look for factors associated with multi-J mapping: <disp-formula id="FD1"><mml:math id="M1"><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mfrac><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi><mml:mi>l</mml:mi><mml:mi>l</mml:mi><mml:mo>,</mml:mo><mml:mi>c</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mi>J</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mi>V</mml:mi></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>y</mml:mi><mml:mi>c</mml:mi><mml:mi>l</mml:mi><mml:mi>o</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>V</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>x</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>y</mml:mi><mml:mi>c</mml:mi><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></disp-formula> where <italic>p<sub>i</sub></italic> is the probability of multi-J mapping present in the <italic>i</italic>th contig, c(i) and j(i) are the cell type and the 5′ end J gene of the <italic>i</italic>th contig respectively, <italic>x<sub>v,i</sub></italic> is the indicator of whether V gene is present in the <italic>i</italic>th contig and <italic>x<sub>cyclo,i</sub></italic> is the indicator of whether <italic>i</italic>th contig belongs to a cell that had cycloheximide treatment. Here, (<italic>β<sub>cell,c</sub></italic>: <italic>c</italic> ∈ <italic>cell types</italic>), (<italic>β<sub>j,j</sub></italic>: <italic>j</italic> ∈ 5′ <italic>end J genes</italic>), <italic>β<sub>v</sub></italic> and <italic>β<sub>cyclo</sub></italic> are parameters to be estimated.</p><p id="P64">To control for multiple testing, <italic>P</italic>-values were adjusted with Benjamini–Hochberg procedure<sup><xref ref-type="bibr" rid="R80">80</xref></sup>. This was applied on all contigs from the γδTCR, αβTCR and BCR sequencing data that were identified within high-quality annotated cells from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup> and results are shown in <xref ref-type="supplementary-material" rid="SD2">Supplementary Table 2</xref>; and it was also applied on contigs from the αβTCR and BCR sequencing data that were identified within high-quality annotated cells from control/cycloheximide-treated PBMCs and results are shown in <xref ref-type="supplementary-material" rid="SD3">Supplementary Table 3</xref>.</p></sec><sec id="S20"><title>Splicing site motif analysis</title><p id="P65">For the lists of 5′ end J genes that had significant (BH adjusted <italic>P</italic>-value &lt; 0.05) association with increased or decreased multi-J mapping from <xref ref-type="supplementary-material" rid="SD2">Supplementary Table 2</xref>, the sequences of the last 11 nucleotides at each gene’s 3′ ends with the first 10 nucleotides of its 3′ end intron were extracted from the 10X GRCh38 2020-A reference. Sequence logos shown in <xref ref-type="fig" rid="F2">Fig. 2e</xref> were generated on <ext-link ext-link-type="uri" xlink:href="https://weblogo.berkeley.edu/logo.cgi">https://weblogo.berkeley.edu/logo.cgi</ext-link><sup><xref ref-type="bibr" rid="R81">81</xref></sup>.</p></sec></sec><sec id="S21"><title>γδTCR annotation comparison</title><p id="P66">To compare our γδTCR annotations against the 10X <italic>cellranger vdj</italic> output in the 33 γδTCR libraries<sup><xref ref-type="bibr" rid="R3">3</xref></sup>, we performed two additional mappings following 10X γδTCR support instructions. In one, the 5.0.0 reference was modified according to 10X instructions by replacing all instances of TRG with TRA and TRD with TRB. The reference was filtered to just TRG/TRD sequences prior to this replacement to avoid erroneous sequence overlaps. For the other, we performed the alignment with <italic>cellranger</italic> v7.0.0 with the accompanying reference (v7.0.0). The output of these two mappings was compared with the <italic>cellranger</italic> - <italic>Dandelion</italic> pre-processing pipeline described above. The number of high confidence γδTCR contigs and high confidence productive γδTCR contigs were determined for each mapping and each sample, and mappings were compared with the Wilcoxon signed-rank test. The effect size r is the rank correlation, which is the signed-rank test statistic divided by the total rank sum<sup><xref ref-type="bibr" rid="R82">82</xref></sup>.</p></sec><sec id="S22"><title>Differential V(D)J usage in adult T cell subsets</title><p id="P67">Preprocessed and annotated scRNA-seq data of T and innate lymphoid cells with paired αβTCR information from Conde et al. 2022<sup><xref ref-type="bibr" rid="R5">5</xref></sup> was downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.tissueimmunecellatlas.org/">https://www.tissueimmunecellatlas.org/</ext-link>. Only cells within the T cell subsets with paired αβTCR were included in the downstream analysis. T_CD4/CD8 was excluded as a low quality cell cluster. The cells were then pseudo-bulked by donor ID and cell type, and the pseudo-bulk V(D)J feature space was created with TRAV, TRAJ, TRBV and TRBJ. Only pseudo-bulks with at least 10 cells were kept. PCA, neighborhood graph and UMAP of the pseudo-bulk V(D)J feature space were computed using <italic>scanpy<sup><xref ref-type="bibr" rid="R14">14</xref></sup></italic> (v1.9.1) with default settings (<italic>scanpy.pp.pca, scanpy.pp.neighbors, scanpy.tl.umap</italic>).</p><p id="P68">For low-level cell type annotations, Tem/emra_CD8, Tnaive/CM_CD8, Trm/em_CD8, Trm_gut_CD8 were grouped into CD8+T, and Teffector/EM_CD4, Tfh, Tnaive/CM_CD4, Tnaive/CM_CD4_activated, Tregs, Trm_Th1/Th17 were grouped into CD4+T, while MAIT was left as a separate annotation. For differential V(D)J usage, Wilcoxon rank-sum test was performed using <italic>scanpy.tl.rank_genes_groups(method=‘wilcoxon’</italic>).</p></sec><sec id="S23"><title>Pseudotime inference from DP to mature T cells</title><sec id="S24"><title>Data integration and filtering</title><p id="P69">scRNA-seq data of human fetal lymphoid cells from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup> was integrated with <italic>Dandelion</italic> preprocessed αβTCR, BCR and γδTCR data (see section on <bold>Non-productive TCR/BCR contigs</bold>, using <italic>all_contig_igblast_db-all.tsv</italic> for all samples) with <italic>dandelion.tl.transfer</italic>. Two samples from F67, F67_TH_CD137_FCAImmP7851896 and F67_TH_MAIT_FCAImmP7851897 were excluded from the analysis as they were sorted for specific T cell subpopulations, instead of the CD45 sorting in all other donor samples, and inclusion might result in biased TCR sampling within this donor. Only DP(P)_T, DP(Q)_T, ABT(ENTRY), CD8+T, CD4+T cells with productive TRA and TRB were included for the trajectory analysis. Neighborhood graph (<italic>scanpy.pp.neighbors(n_neighbors = 50)</italic>) and UMAP (<italic>scanpy.tl.umap</italic>) was re-calculated using scVI latent factors as the initial data was integrated with <italic>scVI<sup><xref ref-type="bibr" rid="R83">83</xref></sup></italic>.</p></sec><sec id="S25"><title>Pseudotime inference from neighborhood V(D)J feature space</title><p id="P70">Neighborhoods were sampled using <italic>Milo<sup><xref ref-type="bibr" rid="R30">30</xref></sup></italic> (milopy v0.1.0) (<italic>milo.make_nhoods</italic>). Cells were pseudo-bulked by the sampled neighborhoods and the V(D)J feature space was created with cells’ primary TRAV, TRAJ, TRBV and TRBJ genes. The cell type annotation of each neighborhood was assigned to be the most frequent annotation of the cells within that neighborhood. PCA, neighborhood graph and UMAP of the neighborhood V(D)J feature space were computed using <italic>scanpy<sup><xref ref-type="bibr" rid="R14">14</xref></sup></italic> (v1.9.1) with default settings (<italic>scanpy.pp.pca, scanpy.pp.neighbors, scanpy.tl.umap</italic>).</p><p id="P71">For pseudotime trajectory analysis, <italic>palantir<sup><xref ref-type="bibr" rid="R32">32</xref></sup></italic> (v1.0.1) was used and diffusion map was computed using the first five principal components (PCs) (<italic>palantir.utils.run_diffusion_maps(n_components=5), palantir.utils.determine_multiscale_space</italic>). The root cell was chosen to be the DP(P) T neighborhood with the smallest value on UMAP1 axis, and the two terminal states were chosen with the largest and smallest values on the UMAP2 axis for CD4+T and CD8+T neighborhoods respectively (<bold>Supplementary Fig. 3d</bold>). Pseudotime and branch probabilities to the terminal states were then computed with <italic>palantir.core.run_palantir(num_waypoints=500)</italic>.</p><p id="P72">Imputed pseudotime and branch probabilities were then projected back from neighborhoods (<xref ref-type="fig" rid="F3">Fig. 3c</xref>) to cells (<xref ref-type="fig" rid="F4">Fig. 4a</xref> top panel) by averaging the parameters from all neighborhoods a given cell belongs to, weighted by the inverse of the neighborhood size. Cells that did not belong to any neighborhood were removed (91 out of 17248).</p><p id="P73">For pseudotime inferred with other trajectory inference methods as shown in <bold>Supplementary Fig. 7,</bold> <italic>monocle3<sup><xref ref-type="bibr" rid="R44">44</xref></sup></italic> (0.2.3.0) was applied on the UMAP embedding of the neighborhood V(D)J feature space and <italic>diffusion pseudotime<sup><xref ref-type="bibr" rid="R45">45</xref></sup></italic> was applied using <italic>scanpy.tl.dpt</italic> function with default settings. The same root cell neighborhood was used as above.</p></sec><sec id="S26"><title>Pseudotime inference from neighborhood GEX feature space</title><p id="P74">Raw gene counts from scRNA-seq data were pseudo-bulked by the same cell neighborhoods as above. Data normalization and log transformation were performed using <italic>scanpy<sup><xref ref-type="bibr" rid="R14">14</xref></sup></italic> (v1.9.1) (<italic>scanpy.pp.normalize_per_cell(counts_per_cell_after=10e4</italic>) and <italic>scanpy.pp.log1p</italic>). Highly variable genes were then selected (<italic>scanpy.pp.highly_variable_genes</italic>), and PCA (<italic>scanpy.pp.pca</italic>), neighborhood graph (<italic>scanpy.pp.neighbors</italic>) and UMAP (<italic>scanpy.tl.umap</italic>) of the neighborhood GEX feature space were computed. Pseudotime trajectory inference was done similar to above with the first five PCs. The root cell was chosen to be the DP(P) T neighborhood with the smallest value on UMAP1 axis, and the two terminal states were chosen with the smallest and largest values on the UMAP2 axis for CD4+T and CD8+T neighborhoods respectively (<bold>Supplementary Fig. 5c</bold>). Imputed pseudotime and branch probabilities were then projected back from neighborhoods (<bold>Supplementary Fig. 5d</bold>) to cells (<xref ref-type="fig" rid="F4">Fig. 4a</xref> bottom right panel).</p></sec><sec id="S27"><title>Pseudotime inference from single cell GEX</title><p id="P75">Pseudotime trajectory inference was performed with <italic>palantir<sup><xref ref-type="bibr" rid="R32">32</xref></sup></italic> (v1.0.1) using the first 20 scVI latent factors. The root cell was chosen to be the DP(P) T cell with the largest value on UMAP2 axis, and the two terminal states were chosen with the largest value on the UMAP2 axis for CD8+T and smallest value on the UMAP1 axis for CD4+T cells respectively (<bold>Supplementary Fig. 5a</bold>). Results of the inferred pseudotime and branch probabilities are shown in <bold>Supplementary Fig. 5b</bold>.</p></sec><sec id="S28"><title>Correlation between pseudotime ordering and relative TRAV/TRAJ locations</title><p id="P76">The relative genomic location of each TRAV gene was encoded numerically based on its order among all TRAV genes from 5′ to 3′ on the genome, and similarly for TRAJ. For each neighborhood, its relative TRAV or TRAJ location was computed by the average relative locations of all cells within that neighborhood. Only neighborhoods that had more than 90% cells being DP(Q) T cells were selected. The relative pseudotime order was plotted against the average relative TRAV or TRAJ location for each neighborhood in <xref ref-type="fig" rid="F4">Fig. 4b</xref>. Local Pearson’s correlations were then computed over sliding windows of 30 adjacent neighborhoods on the pseudotime order (<bold>Supplementary Fig. 6a-b</bold>).</p></sec><sec id="S29"><title>Correlation between gene expression and branch probabilities to CD8+T in abT(entry) cells</title><p id="P77">Pearson’s correlations were computed between gene expression and branch probabilities to CD8+T lineage within abT(entry) cells for all genes. <italic>P</italic>-values were adjusted for multiple testing with Benjamini–Hochberg procedure. Results are shown in <xref ref-type="fig" rid="F4">Fig. 4c</xref>, <bold>Supplementary Fig. 6d</bold> and <xref ref-type="supplementary-material" rid="SD6">Supplementary Table 6</xref>.</p></sec></sec><sec id="S30"><title>VDJ-based dimensionality reduction with <italic>CoNGA<sup><xref ref-type="bibr" rid="R21">21</xref></sup></italic></title><p id="P78">Preprocessed and annotated scRNA-seq data of human fetal lymphoid cells from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup> was downloaded from <ext-link ext-link-type="uri" xlink:href="https://developmental.cellatlas.io/fetal-immune">https://developmental.cellatlas.io/fetal-immune</ext-link>. Matching αβTCR samples had their <italic>all_contig_annotations.csv cellranger</italic> output files flagged with the sample IDs for both cell and contig IDs, and were subsequently merged into a single file and subset to just high confidence contigs for cells present in the scRNA-seq object. This file was used on input for <italic>CoNGA</italic>’s (v0.1.1) setup_10x_for_conga.py script, which produced a tcrdist-based PCA representation of the cells’ VDJ data. The PCA coordinates were used to compute a neighborhood graph and UMAP representation (<bold>Supplementary Fig. 4a</bold>), using default <italic>scanpy</italic> settings.</p></sec><sec id="S31"><title>Joint embedding of single cell gene expression and TCR with <italic>mvTCR<sup><xref ref-type="bibr" rid="R22">22</xref></sup></italic></title><p id="P79">The same cells for which we performed pseudotime inference from DP to mature T cells above were used in the <italic>mvTCR</italic> (version under development, cloned from the repo at commit 528d3e11a360fc4b0f09d782b88f5ec7de9283d6) trial. Clonotypes were called based on CDR3 nucleotide sequence identity of the cells’ primary TRA and TRB chains (<italic>scirpy.pp.ir_dist</italic>, and <italic>scirpy.tl.define_clonotypes(receptor_arms= “all”, dual_ir=”primary_only”)</italic>).</p><p id="P80">Normalized and log transformed data was used as recommended in <italic>mvTCR</italic>’s tutorial. The donor ID was one-hot encoded and supplied as a conditional variable. 80% of cells were used as training data, the remaining 20% for validation. The models were trained for 200 epochs. Three runs were performed with the GEX to TCR ratio varying between 1:1, 2:1 and 3:1. Each run produced 15 trials and each trial had a different combination of model hyperparameters resulting from an automated hyperparameter grid search. The ‘best’ trial (lowest validation loss) was indicated at the end of each run, however when we manually inspected all the trial results, we found the ‘best’ trials showed strong variations between different donors. Thus, we selected one representative result from each run with minimal cross-donor batch effects for <bold>Supplementary Fig. 4b</bold>.</p></sec><sec id="S32"><title>Pseudotime inference combining ILC/NK and T cells</title><sec id="S33"><title>Pseudotime inference using TRBJ</title><p id="P81">scRNA-seq data of human fetal lymphoid cells from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup> was integrated with αβTCR data as described above. Only DN(early)_T, DN(P)_T, DN(Q)_T, DP(P)_T, DP(Q)_T, ILC2, ILC3, CYCLING_ILC, NK, CYCLING_NK cells with TRBJ were included for the trajectory analysis. Neighborhood graph (k=50) and UMAP was re-calculated using scVI latent factors similar to above.</p><p id="P82">For pseudotime trajectory analysis, <italic>palantir<sup><xref ref-type="bibr" rid="R32">32</xref></sup></italic> (v1.0.1) was used and a diffusion map was computed using the first five PCs. The root cell was chosen to be the neighborhood with the highest CD34 expression, and the two terminal states were chosen with the largest and smallest values on the UMAP1 axis for T and NK/ILC cell neighborhoods respectively (<bold>Supplementary Fig. 10a</bold>). Pseudotime and branch probabilities to the terminal states were then computed and projected back from neighborhoods (<xref ref-type="fig" rid="F5">Fig. 5b</xref>) to cells (<xref ref-type="fig" rid="F5">Fig. 5c</xref> top panel).</p></sec><sec id="S34"><title>Gene expression trend in DN T cells along pseudotime</title><p id="P83">Chatterjee’s correlations<sup><xref ref-type="bibr" rid="R74">74</xref></sup> were computed between gene expression and inferred pseudotime within DN T cells for all genes that were expressed in at least 50 cells. Chatterjee’s correlation was chosen instead of Pearson’s or Spearman’s correlation to look for any functional change and not restricted to a monotonic change. TFs<sup><xref ref-type="bibr" rid="R84">84</xref></sup> and genes encoding cell surface proteins that had significantly high Chatterjee’s correlation with pseudotime (BH adjusted P-value &lt; 0.05, and correlation coefficient &gt; 0.1) were shown in <xref ref-type="fig" rid="F5">Fig. 5c</xref> and <bold>Supplementary Fig. 10b</bold> respectively.</p></sec></sec></sec><sec id="S35" sec-type="extended-data"><title>Extended Data</title><fig id="F6" position="anchor"><label>Extended Data Fig. 1</label><caption><title>List of features included in AIR repertoire analysis pipelines.</title><p id="P84">A table outlining the features of a non-exhaustive list of other methods compared to <italic>Dandelion</italic>. Handling of non-productive contigs (with or without V gene annotation) is not common across the various software packages. While the <italic>Immcantation</italic> workflow is capable of handling the data, contigs without V genes are typically diverted to a “failed” file but can be retrieved separately. The output from <italic>Dandelion</italic> is compatible with any AIRR-compliant softwares e.g. <italic>Dandelion</italic> output can be passed to <italic>Immcantation</italic> to perform phylogenetic lineage inference.</p></caption><graphic xlink:href="EMS157425-f006"/></fig><fig id="F7" position="anchor"><label>Extended Data Fig. 2</label><caption><title><italic>Dandelion</italic> offers improved contig annotations.</title><p id="P85"><bold>a,</bold> Left: barplot of proportion of contigs that are productive or non-productive in each locus. Right: barplot showing the causes of non-productive contigs in each locus. For both plots, sc-γδTCR, - αβTCR and -BCR data were taken from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup> excluding thymus samples. <bold>b,</bold> Schematic illustration showing that mRNA without V genes would be captured by 5′RACE + Switch oligo technique but not by multiplex PCR strategy. <bold>c,</bold> Pointplot of proportion of contigs with multi-J mapping in the presence of V gene in control and cycloheximide-treated PBMC samples. Points are colored by locus of TCR/BCR. For both IGH and IGL/IGK, the proportions were 0% in control and treated. <bold>d,</bold> Schematic illustration showing the factors associated with multi-J mapping and the proposed mechanisms. <bold>e,</bold> Boxplots of sc-γδTCR contig counts annotated by 10X <italic>cellranger vdj</italic> v6.1.2 <italic>versus</italic> v7.0.0 using data from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. Left: all high confidence contigs (<italic>P</italic>-value 5.43e-6, r 0.91 in the Wilcoxon signed-rank test). Right: high confidence productive contigs (<italic>P</italic>-value 1.69e-6, r 0.96 in the Wilcoxon signed-rank test).</p></caption><graphic xlink:href="EMS157425-f007"/></fig><fig id="F8" position="anchor"><label>Extended Data Fig. 3</label><caption><title>V(D)J feature space.</title><p id="P86"><bold>a,</bold> Gene expression UMAP of all T cells from Conde et al. 2022<sup><xref ref-type="bibr" rid="R5">5</xref></sup>, colored by donor ID (left) or high-level cell type annotations (right). Each point represents a cell. <bold>b,</bold> UMAP of the pseudo-bulk V(D)J feature space of the same cells as in <bold>a</bold>, colored by donor ID (left) or high-level cell type annotations (right). Each point represents a cell pseudo-bulk. <bold>c,</bold> Left: UMAP of DP to mature T cells with paired productive αβTCR in data from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. Each point represents a cell, colored by cell types. Right: cell neighborhood graph on the same UMAP embedding. Each point represents a cell neighborhood, colored by cell types. The point size represents neighborhood size, with connecting edges representing overlapping cell numbers between any two neighborhoods. Only edges with more than 30 overlapping cells are shown. The layout of nodes is determined by the position of the neighborhood index cell in the UMAP on the left. <bold>d,</bold> The root cell and terminal states selected for pseudotime inference in <xref ref-type="fig" rid="F3">Fig. 3c</xref>. <bold>e,</bold> Gene expression trends over CD8+T pseudotime imputed with <italic>palantir<sup><xref ref-type="bibr" rid="R32">32</xref></sup></italic>. Only the top 10 most frequently used TRAV or TRAJ genes are shown.</p></caption><graphic xlink:href="EMS157425-f008"/></fig><fig id="F9" position="anchor"><label>Extended Data Fig. 4</label><caption><title>Embedding with alternative methods.</title><p id="P87"><bold>a,</bold> UMAP representation of tcrdist-derived PCA coordinates of VDJ data computed by CoNGA<sup><xref ref-type="bibr" rid="R21">21</xref></sup>, with the same dataset as used in <bold>Supplementary Fig. 3c</bold>, colored by cell types. <bold>b,</bold> UMAP representation of joint gene expression and TCR embedding computed by mvTCR<sup><xref ref-type="bibr" rid="R22">22</xref></sup> with varying weights for GEX and VDJ input, on the same dataset as used in <bold>Supplementary Fig. 3c</bold>. Cells are colored by donor ID (top panel) or cell types (bottom panel).</p></caption><graphic xlink:href="EMS157425-f009"/></fig><fig id="F10" position="anchor"><label>Extended Data Fig. 5</label><caption><title>T cell development pseudotime inference comparison.</title><p id="P88"><bold>a,</bold> DP to mature T cells with paired productive αβTCR in data from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>, on the same UMAP embedding as in <xref ref-type="fig" rid="F4">Fig. 4a</xref> and <bold>Supplementary Fig. 3c</bold>. The first two panels show the root cell and terminal states selected for pseudotime inferred directly from single-cell gene expression. The last panel shows the cell types. <bold>b,</bold> Top: pseudotime and branch probabilities inferred directly from single-cell gene expression on the same UMAP embedding as in <bold>a</bold>. Bottom: scatterplot of branch probability to CD8+T against pseudotime. Each point represents a cell. <bold>c,</bold> UMAP of neighborhood GEX space, with the same neighborhoods as sampled in <bold>Supplementary Fig. 3c</bold> and UMAP embedding computed on gene expression pseudo-bulked by neighborhoods. Each point represents a cell neighborhood. The first two panels show the root cell and terminal states selected for pseudotime inferred from neighborhood GEX space. The last panel shows the cell types. <bold>d,</bold> Inferred pseudotime, and branch probabilities to CD8+T and to CD4+T respectively overlaid onto the same UMAP embedding in <bold>c</bold>.</p></caption><graphic xlink:href="EMS157425-f010"/></fig><fig id="F11" position="anchor"><label>Extended Data Fig. 6</label><caption><title>Comparing pseudotime inferred from neighborhood V(D)J space or GEX space.</title><p id="P89"><bold>a,</bold> Pearson’s correlation coefficients of pseudotime order and average relative TRAV location over sliding windows of 30 adjacent neighborhoods on the pseudotime order (left: pseudotime inferred from neighborhood V(D)J space; right: pseudotime inferred from neighborhood GEX space). <italic>Y</italic>-axis is the correlation coefficient and the x-axis is the median pseudotime order of the 30 adjacent neighborhoods. The color of the points represents statistical significance (orange: <italic>P</italic>-value from the Pearson’s correlation &lt; 0.05; blue: <italic>P</italic>-value ≥ 0.05). The red dashed lines mark the correlation coefficient of 0. <bold>b,</bold> The same plot as in <bold>a</bold> but for TRAJ. <bold>c,</bold> Scatterplots of branch probability to CD8+T against pseudotime in abT(entry) cells. Each point represents a cell. Top panel: pseudotime inferred from neighborhood V(D)J space as in <xref ref-type="fig" rid="F4">Fig. 4a</xref> top panel. Bottom panel: pseudotime inferred from neighborhood GEX space as in <xref ref-type="fig" rid="F4">Fig. 4a</xref> bottom right panel. <bold>d,</bold> Volcano plot summarizing results of TFs that are correlated with branch probabilities to CD8+T lineage in V(D)J pseudotime within abT(entry) cells. The <italic>y</italic>-axis is the -log<sub>10</sub>(BH adjusted <italic>P</italic>-value) and the <italic>x-</italic>axis is the correlation coefficient. Labeled TFs that had significant (BH adjusted <italic>P</italic>-value &lt; 0.05) positive correlations (correlation coefficient &gt; 0.1) were colored in red, the ones with significant negative correlations (correlation coefficient &lt; -0.1) were colored in blue, and the rest were colored in black.</p></caption><graphic xlink:href="EMS157425-f011"/></fig><fig id="F12" position="anchor"><label>Extended Data Fig. 7</label><caption><title>Pseudotime inferred with different trajectory inference methods.</title><p id="P90"><bold>a,</bold> First three panels display pseudotime inferred from neighborhood V(D)J space using <italic>palantir<sup><xref ref-type="bibr" rid="R32">32</xref></sup>, monocle3<sup><xref ref-type="bibr" rid="R44">44</xref></sup></italic>, and <italic>diffusion pseudotime<sup><xref ref-type="bibr" rid="R45">45</xref></sup></italic> respectively, overlaid onto the same UMAP embedding as in Fig. 3c with each point represents a cell neighborhood. The fourth panel represents the pseudotime inferred from neighborhood GEX space using <italic>palantir<sup><xref ref-type="bibr" rid="R32">32</xref></sup></italic>. The last panel represents the dominant cell type in each neighborhood. <bold>b,</bold> Scatterplots of the pseudotime ordering against the average relative TRAV (top) and TRAJ (bottom) location. Each point represents a cell neighborhood. Each TRAV or TRAJ gene is encoded numerically for its relative genomic order. The <italic>x</italic>-axis represents the average TRAV/TRAJ relative location for each cell neighborhood. The <italic>y</italic>-axis represents the pseudotime order inferred from neighborhood V(D)J space using <italic>palantir<sup><xref ref-type="bibr" rid="R32">32</xref></sup>, monocle3<sup><xref ref-type="bibr" rid="R44">44</xref></sup></italic>, and <italic>diffusion pseudotime<sup><xref ref-type="bibr" rid="R45">45</xref></sup></italic>, and the pseudotime order inferred from neighborhood GEX space using <italic>palantir<sup><xref ref-type="bibr" rid="R32">32</xref></sup></italic> respectively. The Pearson’s correlations are -0.95, -0.91, -0.95, and -0.90 respectively (<italic>P</italic>-values of 4.8e-76, 4.9e-56, 2.1e-74, and 7.4e-54) for TRAV, and 0.93, 0.90, 0.93, and 0.89 respectively (<italic>P</italic>-values of 1.7e-62, 3.8e-54, 7.6e-65, and 4.2e-52) for TRAJ.</p></caption><graphic xlink:href="EMS157425-f012"/></fig><fig id="F13" position="anchor"><label>Extended Data Fig. 8</label><caption><title>Non-productive BCR and TCR.</title><p id="P91"><bold>a,b,c,</bold> Boxplot of the proportion of cells with productive (blue) or non-productive (orange) BCR light chain (<bold>a</bold>) and heavy chain (<bold>b</bold>), and TRB (<bold>c</bold>) in different fetal lymphocyte subsets. Each point represents a sample and data were taken from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. Only samples with at least 20 cells are shown. Boxes capture the first to third quartiles and whisks span a further 1.5X interquartile range on each side of the box. <bold>d,</bold> Barplot showing the VDJ composition of non-productive TRB contigs in selected lymphocyte subsets from <xref ref-type="fig" rid="F5">Fig. 5a</xref>.</p></caption><graphic xlink:href="EMS157425-f013"/></fig><fig id="F14" position="anchor"><label>Extended Data Fig. 9</label><caption><title>Non-productive TCR.</title><p id="P92"><bold>a,b,c,</bold> Boxplot of the proportion of cells with productive (blue) or non-productive (orange) TRA (<bold>a</bold>), TRG (<bold>b</bold>) and TRD (<bold>c</bold>) in different fetal lymphocyte subsets. Each point represents a sample and data were taken from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. Only samples with at least 20 cells are shown. Boxes capture the first to third quartiles and whisks span a further 1.5X interquartile range on each side of the box. <bold>d,</bold> Boxplot of the proportion of cells with non-productive TRB in different fetal lymphocyte subsets, colored by organs. Each point represents a sample. Only samples with at least 20 cells are shown. Boxes capture the first to third quartiles and whisks span a further 1.5X interquartile range on each side of the box.</p></caption><graphic xlink:href="EMS157425-f014"/></fig><fig id="F15" position="anchor"><label>Extended Data Fig. 10</label><caption><title>TRBJ-based trajectory for ILC/NK/T cell lineage.</title><p id="P93"><bold>a,</bold> Neighborhood V(D)J feature space covering ILC, NK and developing T cells with TRBJ on the same UMAP embedding as in <xref ref-type="fig" rid="F5">Fig. 5b</xref>. The first two panels show the root cell and terminal states selected for pseudotime inference. The last panel shows the cell types. <bold>b,</bold> Heatmap of gene expression for genes encoding cell surface proteins across pseudotime in DN T cells. Pseudotime is equally divided into 100 bins, and the average gene expression is calculated for DN T cells with pseudotime that falls within each bin. Genes selected here had significantly high Chatterjee’s correlation with pseudotime (BH adjusted <italic>P</italic>-value &lt; 0.05, and correlation coefficient &gt; 0.1). <bold>c,</bold> Heatmap of gene expression for TFs known to be important in mouse DN T cell development<sup><xref ref-type="bibr" rid="R53">53</xref></sup>, across pseudotime in human fetal DN T cells. TFs that showed discordant expression patterns between mouse and human are highlighted in red.</p></caption><graphic xlink:href="EMS157425-f015"/></fig><fig id="F16" position="anchor"><label>Extended Data Fig. 11</label><caption><title>Non-productive BCR in pDC.</title><p id="P94"><bold>a,b,</bold> Boxplot of the proportion of cells with productive (blue) or non-productive (orange) BCR heavy chain (<bold>a</bold>) and light chain (<bold>b</bold>) in different fetal myeloid subsets. Each point represents a sample and data were taken from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. Only samples with at least 20 cells are shown. Boxes capture the first to third quartiles and whisks span a further 1.5X interquartile range on each side of the box. <bold>c,</bold> Expression of genes involved in V(D)J rearrangement in pDCs and cycling pDCs. Data was taken from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>.</p></caption><graphic xlink:href="EMS157425-f016"/></fig></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary Table 1</label><media xlink:href="EMS157425-supplement-Supplementary_Table_1.csv" mimetype="text" mime-subtype="csv; charset=utf-8" id="d77aAdFbB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD2"><label>Supplementary Table 2</label><media xlink:href="EMS157425-supplement-Supplementary_Table_2.csv" mimetype="text" mime-subtype="csv; charset=utf-8" id="d77aAdFcB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD3"><label>Supplementary Table 3</label><media xlink:href="EMS157425-supplement-Supplementary_Table_3.csv" mimetype="text" mime-subtype="csv; charset=utf-8" id="d77aAdFdB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD4"><label>Supplementary Table 4</label><media xlink:href="EMS157425-supplement-Supplementary_Table_4.csv" mimetype="text" mime-subtype="csv; charset=utf-8" id="d77aAdFeB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD5"><label>Supplementary Table 5</label><media xlink:href="EMS157425-supplement-Supplementary_Table_5.csv" mimetype="text" mime-subtype="csv; charset=utf-8" id="d77aAdFfB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD6"><label>Supplementary Table 6</label><media xlink:href="EMS157425-supplement-Supplementary_Table_6.csv" mimetype="text" mime-subtype="csv; charset=utf-8" id="d77aAdFgB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD7"><label>Supplementary Material</label><media xlink:href="EMS157425-supplement-Supplementary_Material.pdf" mimetype="application" mime-subtype="pdf" id="d77aAdFhB" position="anchor"/></supplementary-material></sec></body><back><ack id="S37"><title>Acknowledgements</title><p>We acknowledge the Cellular Genetics IT, New Pipeline Group and DNA pipelines of Sanger Institute. K.B.M. and S.A.T. are supported by Wellcome (WT211276/Z/18/Z, 108413/A/15/D and Sanger core grant WT206194). K.B.M. acknowledges funding from the MRC (MR/S035907/1). M.H. is supported by Wellcome (grant WT107931/Z/15/Z), the Lister Institute for Preventive Medicine, NIHR, and the Newcastle Biomedical Research Centre. S.A.T. is supported by an ERC Consolidator Grant ThDEFINE (646794). C.S. is supported by a Wellcome Trust Ph.D. Fellowship for Clinicians. Z.K.T. and M.R.C. are supported by a Medical Research Council Research Project Grant (MR/S035842/1). M.R.C. is supported by the National Institute of Health Research (NIHR) Research Professorship (RP-2017-08-ST2-002), a Wellcome Investigator Award (220268/Z/20/Z), the Blood and Transplant Research Unit in Organ Donation and the NIHR Cambridge Biomedical Research Centre. This publication is part of the Human Cell Atlas (<ext-link ext-link-type="uri" xlink:href="https://www.humancellatlas.org/publications/#">www.humancellatlas.org/publications</ext-link>). We would like to thank reviewers for their thoughtful comments and suggestions, which helped us to improve the quality of the manuscript.</p></ack><sec id="S38" sec-type="data-availability"><title>Code and data availability</title><p id="P95"><italic>Dandelion</italic> is implemented as an open-source package in Python 3 (<ext-link ext-link-type="uri" xlink:href="https://github.com/zktuong/dandelion">https://github.com/zktuong/dandelion</ext-link>) with tutorials available at <ext-link ext-link-type="uri" xlink:href="https://sc-dandelion.readthedocs.io/en/latest/">https://sc-dandelion.readthedocs.io/en/latest/</ext-link>. The tool and workflow is also available through an interactive online Google Colab notebook at <ext-link ext-link-type="uri" xlink:href="https://colab.research.google.com/github/zktuong/dandelion/blob/master/container/dandelion_singularity.ipynb">https://colab.research.google.com/github/zktuong/dandelion/blob/master/container/dandelion_singularity.ipynb</ext-link>. Code and data used to generate figures and perform analyses in the manuscript are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/zktuong/dandelion-demo-files/dandelion_manuscript">https://github.com/zktuong/dandelion-demo-files/dandelion_manuscript</ext-link>. Raw sequencing data for newly generated sequencing libraries have been deposited in ArrayExpress (accession number E-MTAB-12524).</p></sec><fn-group><fn id="FN3" fn-type="con"><p id="P96"><bold>Author contributions</bold></p><p id="P97">C.S., Z.K.T., M.R.C. and S.A.T. conceived the initial project. C.S. and Z.K.T. set up and directed the study. C.S., K.P., E.D., L.M.D. and Z.K.T. performed bioinformatic analyses. C.S., K.P. and Z.K.T developed the software. C.S. and R.V.B. performed cell culture experiments. E.D., R.G.H.L., R.V.B., R.V., M.H., K.B.M., M.R.C., and S.A.T. provided intellectual input. M.R.C. and S.A.T. acquired funding. C.S., K.P. and Z.K.T. wrote the manuscript. All authors read and/or edited the manuscript.</p></fn><fn id="FN4" fn-type="conflict"><p id="P98"><bold>Competing interests</bold></p><p id="P99">In the past three years, S.A.T. has received remuneration for Scientific Advisory Board Membership from Sanofi, GlaxoSmithKline, Foresite Labs and Qiagen. S.A.T. is a cofounder and holds equity in Transition Bio. Z.K.T. has received consulting fees from Synteny Biotechnologies Ltd on activities unrelated to this manuscript.</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Papalexi</surname><given-names>E</given-names></name><name><surname>Satija</surname><given-names>R</given-names></name></person-group><article-title>Single-cell RNA sequencing to explore immune cell heterogeneity</article-title><source>Nat Rev Immunol</source><year>2018</year><volume>18</volume><fpage>35</fpage><lpage>45</lpage><pub-id pub-id-type="pmid">28787399</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Efremova</surname><given-names>M</given-names></name><name><surname>Vento-Tormo</surname><given-names>R</given-names></name><name><surname>Park</surname><given-names>J-E</given-names></name><name><surname>Teichmann</surname><given-names>SA</given-names></name><name><surname>James</surname><given-names>KR</given-names></name></person-group><article-title>Immunology in the Era of Single-Cell Technologies</article-title><source>Annu Rev Immunol</source><year>2020</year><volume>38</volume><fpage>727</fpage><lpage>757</lpage><pub-id pub-id-type="pmid">32075461</pub-id></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Suo</surname><given-names>C</given-names></name><etal/></person-group><article-title>Mapping the developing human immune system across organs</article-title><source>Science</source><year>2022</year><volume>376</volume><elocation-id>eabo0510</elocation-id><pub-id pub-id-type="pmcid">PMC7612819</pub-id><pub-id pub-id-type="pmid">35549310</pub-id><pub-id pub-id-type="doi">10.1126/science.abo0510</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stephenson</surname><given-names>E</given-names></name><etal/></person-group><article-title>Single-cell multi-omics analysis of the immune response in COVID-19</article-title><source>Nat Med</source><year>2021</year><volume>27</volume><fpage>904</fpage><lpage>916</lpage><pub-id pub-id-type="pmcid">PMC8121667</pub-id><pub-id pub-id-type="pmid">33879890</pub-id><pub-id pub-id-type="doi">10.1038/s41591-021-01329-2</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Domínguez Conde</surname><given-names>C</given-names></name><etal/></person-group><article-title>Cross-tissue immune cell analysis reveals tissue-specific features in humans</article-title><source>Science</source><year>2022</year><volume>376</volume><elocation-id>eabl5197</elocation-id><pub-id pub-id-type="pmcid">PMC7612735</pub-id><pub-id pub-id-type="pmid">35549406</pub-id><pub-id pub-id-type="doi">10.1126/science.abl5197</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Park</surname><given-names>J-E</given-names></name><etal/></person-group><article-title>A cell atlas of human thymic development defines T cell repertoire formation</article-title><source>Science</source><year>2020</year><volume>367</volume><pub-id pub-id-type="pmcid">PMC7611066</pub-id><pub-id pub-id-type="pmid">32079746</pub-id><pub-id pub-id-type="doi">10.1126/science.aay3224</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lance</surname><given-names>C</given-names></name><etal/></person-group><article-title>Multimodal single cell data integration challenge: results and lessons learned</article-title><source>bioRxiv</source><year>2022</year><elocation-id>2022.04.11.487796</elocation-id><pub-id pub-id-type="doi">10.1101/2022.04.11.487796</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>J</given-names></name><name><surname>Hyeon</surname><given-names>DY</given-names></name><name><surname>Hwang</surname><given-names>D</given-names></name></person-group><article-title>Single-cell multiomics: technologies and data analysis methods</article-title><source>Exp Mol Med</source><year>2020</year><volume>52</volume><fpage>1428</fpage><lpage>1442</lpage><pub-id pub-id-type="pmcid">PMC8080692</pub-id><pub-id pub-id-type="pmid">32929225</pub-id><pub-id pub-id-type="doi">10.1038/s12276-020-0420-2</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Roth</surname><given-names>DB</given-names></name></person-group><article-title>V(D)J Recombination: Mechanism, Errors, and Fidelity</article-title><source>Microbiol Spectr</source><year>2014</year><volume>2</volume><pub-id pub-id-type="pmcid">PMC5089068</pub-id><pub-id pub-id-type="pmid">26104458</pub-id><pub-id pub-id-type="doi">10.1128/microbiolspec.MDNA3-0041-2014</pub-id></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vander Heiden</surname><given-names>JA</given-names></name><etal/></person-group><article-title>AIRR Community Standardized Representations for Annotated Immune Repertoires</article-title><source>Front Immunol</source><year>2018</year><volume>9</volume><pub-id pub-id-type="pmcid">PMC6173121</pub-id><pub-id pub-id-type="pmid">30323809</pub-id><pub-id pub-id-type="doi">10.3389/fimmu.2018.02206</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rubelt</surname><given-names>F</given-names></name><etal/></person-group><article-title>Adaptive Immune Receptor Repertoire Community recommendations for sharing immune-repertoire sequencing data</article-title><source>Nat Immunol</source><year>2017</year><volume>18</volume><fpage>1274</fpage><lpage>1278</lpage><pub-id pub-id-type="pmcid">PMC5790180</pub-id><pub-id pub-id-type="pmid">29144493</pub-id><pub-id pub-id-type="doi">10.1038/ni.3873</pub-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Breden</surname><given-names>F</given-names></name><etal/></person-group><article-title>Reproducibility and Reuse of Adaptive Immune Receptor Repertoire Data</article-title><source>Front Immunol</source><year>2017</year><volume>8</volume><elocation-id>1418</elocation-id><pub-id pub-id-type="pmcid">PMC5671925</pub-id><pub-id pub-id-type="pmid">29163494</pub-id><pub-id pub-id-type="doi">10.3389/fimmu.2017.01418</pub-id></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sturm</surname><given-names>G</given-names></name><etal/></person-group><article-title>Scirpy: a Scanpy extension for analyzing single-cell T-cell receptor-sequencing data</article-title><source>Bioinformatics</source><year>2020</year><volume>36</volume><fpage>4817</fpage><lpage>4818</lpage><pub-id pub-id-type="pmcid">PMC7751015</pub-id><pub-id pub-id-type="pmid">32614448</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btaa611</pub-id></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wolf</surname><given-names>FA</given-names></name><name><surname>Angerer</surname><given-names>P</given-names></name><name><surname>Theis</surname><given-names>FJ</given-names></name></person-group><article-title>SCANPY: large-scale single-cell gene expression data analysis</article-title><source>Genome Biol</source><year>2018</year><volume>19</volume><elocation-id>15</elocation-id><pub-id pub-id-type="pmcid">PMC5802054</pub-id><pub-id pub-id-type="pmid">29409532</pub-id><pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Borcherding</surname><given-names>N</given-names></name><name><surname>Bormann</surname><given-names>NL</given-names></name><name><surname>Kraus</surname><given-names>G</given-names></name></person-group><article-title>scRepertoire: An R-based toolkit for single-cell immune receptor analysis</article-title><source>F1000Res</source><year>2020</year><volume>9</volume><elocation-id>47</elocation-id><pub-id pub-id-type="pmcid">PMC7400693</pub-id><pub-id pub-id-type="pmid">32789006</pub-id><pub-id pub-id-type="doi">10.12688/f1000research.22139.2</pub-id></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Butler</surname><given-names>A</given-names></name><name><surname>Hoffman</surname><given-names>P</given-names></name><name><surname>Smibert</surname><given-names>P</given-names></name><name><surname>Papalexi</surname><given-names>E</given-names></name><name><surname>Satija</surname><given-names>R</given-names></name></person-group><article-title>Integrating single-cell transcriptomic data across different conditions, technologies, and species</article-title><source>Nat Biotechnol</source><year>2018</year><volume>36</volume><fpage>411</fpage><lpage>420</lpage><pub-id pub-id-type="pmcid">PMC6700744</pub-id><pub-id pub-id-type="pmid">29608179</pub-id><pub-id pub-id-type="doi">10.1038/nbt.4096</pub-id></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fischer</surname><given-names>DS</given-names></name><name><surname>Wu</surname><given-names>Y</given-names></name><name><surname>Schubert</surname><given-names>B</given-names></name><name><surname>Theis</surname><given-names>FJ</given-names></name></person-group><article-title>Predicting antigen specificity of single T cells based on TCR CDR3 regions</article-title><source>Mol Syst Biol</source><year>2020</year><volume>16</volume><elocation-id>e9416</elocation-id><pub-id pub-id-type="pmcid">PMC7418512</pub-id><pub-id pub-id-type="pmid">32779888</pub-id><pub-id pub-id-type="doi">10.15252/msb.20199416</pub-id></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yermanos</surname><given-names>A</given-names></name><etal/></person-group><article-title>Platypus: an open-access software for integrating lymphocyte single-cell immune repertoires with transcriptomes</article-title><source>NAR Genom Bioinform</source><year>2021</year><volume>3</volume><elocation-id>lqab023</elocation-id><pub-id pub-id-type="pmcid">PMC8046018</pub-id><pub-id pub-id-type="pmid">33884369</pub-id><pub-id pub-id-type="doi">10.1093/nargab/lqab023</pub-id></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Popov</surname><given-names>A</given-names></name></person-group><article-title>immunomind/immunarch: Immunarch 070</article-title><year>2022</year><pub-id pub-id-type="doi">10.5281/zenodo.6984421</pub-id></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pogorelyy</surname><given-names>MV</given-names></name><etal/></person-group><article-title>Detecting T cell receptors involved in immune responses from single repertoire snapshots</article-title><source>PLoS Biol</source><year>2019</year><volume>17</volume><elocation-id>e3000314</elocation-id><pub-id pub-id-type="pmcid">PMC6592544</pub-id><pub-id pub-id-type="pmid">31194732</pub-id><pub-id pub-id-type="doi">10.1371/journal.pbio.3000314</pub-id></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schattgen</surname><given-names>SA</given-names></name><etal/></person-group><article-title>Integrating T cell receptor sequences and transcriptional profiles by clonotype neighbor graph analysis (CoNGA)</article-title><source>Nat Biotechnol</source><year>2022</year><volume>40</volume><fpage>54</fpage><lpage>63</lpage><pub-id pub-id-type="pmcid">PMC8832949</pub-id><pub-id pub-id-type="pmid">34426704</pub-id><pub-id pub-id-type="doi">10.1038/s41587-021-00989-2</pub-id></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Drost</surname><given-names>F</given-names></name><etal/></person-group><article-title>Integrating T-cell receptor and transcriptome for large-scale single-cell immune profiling analysis</article-title><source>bioRxiv</source><year>2021</year><pub-id pub-id-type="doi">10.1101/2021.06.24.449733</pub-id></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gupta</surname><given-names>NT</given-names></name><etal/></person-group><article-title>Change-O: a toolkit for analyzing large-scale B cell immunoglobulin repertoire sequencing data</article-title><source>Bioinformatics</source><year>2015</year><volume>31</volume><fpage>3356</fpage><lpage>3358</lpage><pub-id pub-id-type="pmcid">PMC4793929</pub-id><pub-id pub-id-type="pmid">26069265</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btv359</pub-id></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Virshup</surname><given-names>I</given-names></name><name><surname>Rybakov</surname><given-names>S</given-names></name><name><surname>Theis</surname><given-names>FJ</given-names></name><name><surname>Angerer</surname><given-names>P</given-names></name><name><surname>Alexander Wolf</surname><given-names>F</given-names></name></person-group><article-title>anndata: Annotated data</article-title><source>bioRxiv</source><year>2021</year><elocation-id>2021.12.16.473007</elocation-id><pub-id pub-id-type="doi">10.1101/2021.12.16.473007</pub-id></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ye</surname><given-names>J</given-names></name><name><surname>Ma</surname><given-names>N</given-names></name><name><surname>Madden</surname><given-names>TL</given-names></name><name><surname>Ostell</surname><given-names>JM</given-names></name></person-group><article-title>IgBLAST: an immunoglobulin variable domain sequence analysis tool</article-title><source>Nucleic Acids Res</source><year>2013</year><volume>41</volume><fpage>W34</fpage><lpage>40</lpage><pub-id pub-id-type="pmcid">PMC3692102</pub-id><pub-id pub-id-type="pmid">23671333</pub-id><pub-id pub-id-type="doi">10.1093/nar/gkt382</pub-id></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lefranc</surname><given-names>MP</given-names></name><etal/></person-group><article-title>IMGT, the international ImMunoGeneTics database</article-title><source>Nucleic Acids Res</source><year>1999</year><volume>27</volume><fpage>209</fpage><lpage>212</lpage><pub-id pub-id-type="pmcid">PMC148137</pub-id><pub-id pub-id-type="pmid">9847182</pub-id><pub-id pub-id-type="doi">10.1093/nar/27.1.209</pub-id></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Le Hir</surname><given-names>H</given-names></name><name><surname>Gatfield</surname><given-names>D</given-names></name><name><surname>Izaurralde</surname><given-names>E</given-names></name><name><surname>Moore</surname><given-names>MJ</given-names></name></person-group><article-title>The exon–exon junction complex provides a binding platform for factors involved in mRNA export and nonsense-mediated mRNA decay</article-title><source>EMBO J</source><year>2001</year><volume>20</volume><fpage>4987</fpage><lpage>4997</lpage><pub-id pub-id-type="pmcid">PMC125616</pub-id><pub-id pub-id-type="pmid">11532962</pub-id><pub-id pub-id-type="doi">10.1093/emboj/20.17.4987</pub-id></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Irimia</surname><given-names>M</given-names></name><etal/></person-group><article-title>Complex selection on 5’ splice sites in intron-rich organisms</article-title><source>Genome Res</source><year>2009</year><volume>19</volume><fpage>2021</fpage><lpage>2027</lpage><pub-id pub-id-type="pmcid">PMC2775602</pub-id><pub-id pub-id-type="pmid">19745111</pub-id><pub-id pub-id-type="doi">10.1101/gr.089276.108</pub-id></element-citation></ref><ref id="R29"><label>29</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Song</surname><given-names>L</given-names></name><etal/></person-group><article-title>TRUST4: immune repertoire reconstruction from bulk and single-cell RNA-seq data</article-title><source>Nat Methods</source><year>2021</year><volume>18</volume><fpage>627</fpage><lpage>630</lpage><pub-id pub-id-type="pmcid">PMC9328942</pub-id><pub-id pub-id-type="pmid">33986545</pub-id><pub-id pub-id-type="doi">10.1038/s41592-021-01142-2</pub-id></element-citation></ref><ref id="R30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dann</surname><given-names>E</given-names></name><name><surname>Henderson</surname><given-names>NC</given-names></name><name><surname>Teichmann</surname><given-names>SA</given-names></name><name><surname>Morgan</surname><given-names>MD</given-names></name><name><surname>Marioni</surname><given-names>JC</given-names></name></person-group><article-title>Differential abundance testing on single-cell data using k-nearest neighbor graphs</article-title><source>Nat Biotechnol</source><year>2022</year><volume>40</volume><fpage>245</fpage><lpage>253</lpage><pub-id pub-id-type="pmid">34594043</pub-id></element-citation></ref><ref id="R31"><label>31</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Saelens</surname><given-names>W</given-names></name><name><surname>Cannoodt</surname><given-names>R</given-names></name><name><surname>Todorov</surname><given-names>H</given-names></name><name><surname>Saeys</surname><given-names>Y</given-names></name></person-group><article-title>A comparison of single-cell trajectory inference methods</article-title><source>Nat Biotechnol</source><year>2019</year><volume>37</volume><fpage>547</fpage><lpage>554</lpage><pub-id pub-id-type="pmid">30936559</pub-id></element-citation></ref><ref id="R32"><label>32</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Setty</surname><given-names>M</given-names></name><etal/></person-group><article-title>Characterization of cell fate probabilities in single-cell data with Palantir</article-title><source>Nat Biotechnol</source><year>2019</year><volume>37</volume><fpage>451</fpage><lpage>460</lpage><pub-id pub-id-type="pmcid">PMC7549125</pub-id><pub-id pub-id-type="pmid">30899105</pub-id><pub-id pub-id-type="doi">10.1038/s41587-019-0068-4</pub-id></element-citation></ref><ref id="R33"><label>33</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carico</surname><given-names>ZM</given-names></name><name><surname>Roy Choudhury</surname><given-names>K</given-names></name><name><surname>Zhang</surname><given-names>B</given-names></name><name><surname>Zhuang</surname><given-names>Y</given-names></name><name><surname>Krangel</surname><given-names>MS</given-names></name></person-group><article-title>Tcrd Rearrangement Redirects a Processive Tcra Recombination Program to Expand the Tcra Repertoire</article-title><source>Cell Rep</source><year>2017</year><volume>19</volume><fpage>2157</fpage><lpage>2173</lpage><pub-id pub-id-type="pmcid">PMC5529038</pub-id><pub-id pub-id-type="pmid">28591585</pub-id><pub-id pub-id-type="doi">10.1016/j.celrep.2017.05.045</pub-id></element-citation></ref><ref id="R34"><label>34</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Singer</surname><given-names>A</given-names></name><name><surname>Adoro</surname><given-names>S</given-names></name><name><surname>Park</surname><given-names>J-H</given-names></name></person-group><article-title>Lineage fate and intense debate: myths, models and mechanisms of CD4-versus CD8-lineage choice</article-title><source>Nat Rev Immunol</source><year>2008</year><volume>8</volume><fpage>788</fpage><lpage>801</lpage><pub-id pub-id-type="pmcid">PMC2760737</pub-id><pub-id pub-id-type="pmid">18802443</pub-id><pub-id pub-id-type="doi">10.1038/nri2416</pub-id></element-citation></ref><ref id="R35"><label>35</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Karimi</surname><given-names>MM</given-names></name><etal/></person-group><article-title>The order and logic of CD4 versus CD8 lineage choice and differentiation in mouse thymus</article-title><source>Nat Commun</source><year>2021</year><volume>12</volume><fpage>1</fpage><lpage>14</lpage><pub-id pub-id-type="pmcid">PMC7782583</pub-id><pub-id pub-id-type="pmid">33397934</pub-id><pub-id pub-id-type="doi">10.1038/s41467-020-20306-w</pub-id></element-citation></ref><ref id="R36"><label>36</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kirchner</surname><given-names>J</given-names></name><name><surname>Bevan</surname><given-names>MJ</given-names></name></person-group><article-title>ITM2A is induced during thymocyte selection and T cell activation and causes downregulation of CD8 when overexpressed in CD4(+)CD8(+) double positive thymocytes</article-title><source>J Exp Med</source><year>1999</year><volume>190</volume><fpage>217</fpage><lpage>228</lpage><pub-id pub-id-type="pmcid">PMC2195576</pub-id><pub-id pub-id-type="pmid">10432285</pub-id><pub-id pub-id-type="doi">10.1084/jem.190.2.217</pub-id></element-citation></ref><ref id="R37"><label>37</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Taniuchi</surname><given-names>I</given-names></name><etal/></person-group><article-title>Differential requirements for Runx proteins in CD4 repression and epigenetic silencing during T lymphocyte development</article-title><source>Cell</source><year>2002</year><volume>111</volume><fpage>621</fpage><lpage>633</lpage><pub-id pub-id-type="pmid">12464175</pub-id></element-citation></ref><ref id="R38"><label>38</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sato</surname><given-names>T</given-names></name><etal/></person-group><article-title>Dual functions of Runx proteins for reactivating CD8 and silencing CD4 at the commitment process into CD8 thymocytes</article-title><source>Immunity</source><year>2005</year><volume>22</volume><fpage>317</fpage><lpage>328</lpage><pub-id pub-id-type="pmid">15780989</pub-id></element-citation></ref><ref id="R39"><label>39</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>He</surname><given-names>X</given-names></name><etal/></person-group><article-title>The zinc finger transcription factor Th-POK regulates CD4 versus CD8 T-cell lineage commitment</article-title><source>Nature</source><year>2005</year><volume>433</volume><fpage>826</fpage><lpage>833</lpage><pub-id pub-id-type="pmid">15729333</pub-id></element-citation></ref><ref id="R40"><label>40</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sun</surname><given-names>G</given-names></name><etal/></person-group><article-title>The zinc finger protein cKrox directs CD4 lineage differentiation during intrathymic T cell positive selection</article-title><source>Nat Immunol</source><year>2005</year><volume>6</volume><fpage>373</fpage><lpage>381</lpage><pub-id pub-id-type="pmid">15750595</pub-id></element-citation></ref><ref id="R41"><label>41</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aliahmad</surname><given-names>P</given-names></name><name><surname>Kaye</surname><given-names>J</given-names></name></person-group><article-title>Development of all CD4 T lineages requires nuclear factor TOX</article-title><source>J Exp Med</source><year>2008</year><volume>205</volume><fpage>245</fpage><lpage>256</lpage><pub-id pub-id-type="pmcid">PMC2234360</pub-id><pub-id pub-id-type="pmid">18195075</pub-id><pub-id pub-id-type="doi">10.1084/jem.20071944</pub-id></element-citation></ref><ref id="R42"><label>42</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hernández-Hoyos</surname><given-names>G</given-names></name><name><surname>Anderson</surname><given-names>MK</given-names></name><name><surname>Wang</surname><given-names>C</given-names></name><name><surname>Rothenberg</surname><given-names>EV</given-names></name><name><surname>Alberola-Ila</surname><given-names>J</given-names></name></person-group><article-title>GATA-3 expression is controlled by TCR signals and regulates CD4/CD8 differentiation</article-title><source>Immunity</source><year>2003</year><volume>19</volume><fpage>83</fpage><lpage>94</lpage><pub-id pub-id-type="pmid">12871641</pub-id></element-citation></ref><ref id="R43"><label>43</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pai</surname><given-names>S-Y</given-names></name><etal/></person-group><article-title>Critical roles for transcription factor GATA-3 in thymocyte development</article-title><source>Immunity</source><year>2003</year><volume>19</volume><fpage>863</fpage><lpage>875</lpage><pub-id pub-id-type="pmid">14670303</pub-id></element-citation></ref><ref id="R44"><label>44</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cao</surname><given-names>J</given-names></name><etal/></person-group><article-title>The single-cell transcriptional landscape of mammalian organogenesis</article-title><source>Nature</source><year>2019</year><volume>566</volume><fpage>496</fpage><lpage>502</lpage><pub-id pub-id-type="pmcid">PMC6434952</pub-id><pub-id pub-id-type="pmid">30787437</pub-id><pub-id pub-id-type="doi">10.1038/s41586-019-0969-x</pub-id></element-citation></ref><ref id="R45"><label>45</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Haghverdi</surname><given-names>L</given-names></name><name><surname>Büttner</surname><given-names>M</given-names></name><name><surname>Wolf</surname><given-names>FA</given-names></name><name><surname>Buettner</surname><given-names>F</given-names></name><name><surname>Theis</surname><given-names>FJ</given-names></name></person-group><article-title>Diffusion pseudotime robustly reconstructs lineage branching</article-title><source>Nat Methods</source><year>2016</year><volume>13</volume><fpage>845</fpage><lpage>848</lpage><pub-id pub-id-type="pmid">27571553</pub-id></element-citation></ref><ref id="R46"><label>46</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Clark</surname><given-names>MR</given-names></name><name><surname>Mandal</surname><given-names>M</given-names></name><name><surname>Ochiai</surname><given-names>K</given-names></name><name><surname>Singh</surname><given-names>H</given-names></name></person-group><article-title>Orchestrating B cell lymphopoiesis through interplay of IL-7 receptor and pre-B cell receptor signalling</article-title><source>Nat Rev Immunol</source><year>2014</year><volume>14</volume><fpage>69</fpage><lpage>80</lpage><pub-id pub-id-type="pmcid">PMC4276135</pub-id><pub-id pub-id-type="pmid">24378843</pub-id><pub-id pub-id-type="doi">10.1038/nri3570</pub-id></element-citation></ref><ref id="R47"><label>47</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wong</surname><given-names>JB</given-names></name><etal/></person-group><article-title>B-1a cells acquire their unique characteristics by bypassing the pre-BCR selection stage</article-title><source>Nat Commun</source><year>2019</year><volume>10</volume><elocation-id>4768</elocation-id><pub-id pub-id-type="pmcid">PMC6802180</pub-id><pub-id pub-id-type="pmid">31628339</pub-id><pub-id pub-id-type="doi">10.1038/s41467-019-12824-z</pub-id></element-citation></ref><ref id="R48"><label>48</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kitamura</surname><given-names>D</given-names></name><etal/></person-group><article-title>A critical role of λ5 protein in B cell development</article-title><source>Cell</source><year>1992</year><volume>69</volume><fpage>823</fpage><lpage>831</lpage><pub-id pub-id-type="pmid">1591779</pub-id></element-citation></ref><ref id="R49"><label>49</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>O’Byrne</surname><given-names>S</given-names></name><etal/></person-group><article-title>Discovery of a CD10-negative B-progenitor in human fetal life identifies unique ontogeny-related developmental programs</article-title><source>Blood</source><year>2019</year><volume>134</volume><fpage>1059</fpage><lpage>1071</lpage><pub-id pub-id-type="pmid">31383639</pub-id></element-citation></ref><ref id="R50"><label>50</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shin</surname><given-names>SB</given-names></name><etal/></person-group><article-title>Abortive γδTCR rearrangements suggest ILC2s are derived from T-cell precursors</article-title><source>Blood Adv</source><year>2020</year><volume>4</volume><fpage>5362</fpage><lpage>5372</lpage><pub-id pub-id-type="pmcid">PMC7656916</pub-id><pub-id pub-id-type="pmid">33137203</pub-id><pub-id pub-id-type="doi">10.1182/bloodadvances.2020002758</pub-id></element-citation></ref><ref id="R51"><label>51</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Qian</surname><given-names>L</given-names></name><etal/></person-group><article-title>Suppression of ILC2 differentiation from committed T cell precursors by E protein transcription factors</article-title><source>Journal of Experimental Medicine</source><year>2019</year><volume>216</volume><fpage>884</fpage><lpage>899</lpage><pub-id pub-id-type="pmcid">PMC6446881</pub-id><pub-id pub-id-type="pmid">30898894</pub-id><pub-id pub-id-type="doi">10.1084/jem.20182100</pub-id></element-citation></ref><ref id="R52"><label>52</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shin</surname><given-names>SB</given-names></name><name><surname>McNagny</surname><given-names>KM</given-names></name></person-group><article-title>ILC-You in the Thymus: A Fresh Look at Innate Lymphoid Cell Development</article-title><source>Front Immunol</source><year>2021</year><volume>12</volume><elocation-id>681110</elocation-id><pub-id pub-id-type="pmcid">PMC8136430</pub-id><pub-id pub-id-type="pmid">34025680</pub-id><pub-id pub-id-type="doi">10.3389/fimmu.2021.681110</pub-id></element-citation></ref><ref id="R53"><label>53</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hosokawa</surname><given-names>H</given-names></name><name><surname>Rothenberg</surname><given-names>EV</given-names></name></person-group><article-title>How transcription factors drive choice of the T cell fate</article-title><source>Nat Rev Immunol</source><year>2021</year><volume>21</volume><fpage>162</fpage><lpage>176</lpage><pub-id pub-id-type="pmcid">PMC7933071</pub-id><pub-id pub-id-type="pmid">32918063</pub-id><pub-id pub-id-type="doi">10.1038/s41577-020-00426-6</pub-id></element-citation></ref><ref id="R54"><label>54</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Musumeci</surname><given-names>A</given-names></name><name><surname>Lutz</surname><given-names>K</given-names></name><name><surname>Winheim</surname><given-names>E</given-names></name><name><surname>Krug</surname><given-names>AB</given-names></name></person-group><article-title>What Makes a pDC: Recent Advances in Understanding Plasmacytoid DC Development and Heterogeneity</article-title><source>Front Immunol</source><year>2019</year><volume>10</volume><elocation-id>1222</elocation-id><pub-id pub-id-type="pmcid">PMC6548821</pub-id><pub-id pub-id-type="pmid">31191558</pub-id><pub-id pub-id-type="doi">10.3389/fimmu.2019.01222</pub-id></element-citation></ref><ref id="R55"><label>55</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Popescu</surname><given-names>D-M</given-names></name><etal/></person-group><article-title>Decoding human fetal liver haematopoiesis</article-title><source>Nature</source><year>2019</year><volume>574</volume><fpage>365</fpage><lpage>371</lpage><pub-id pub-id-type="pmcid">PMC6861135</pub-id><pub-id pub-id-type="pmid">31597962</pub-id><pub-id pub-id-type="doi">10.1038/s41586-019-1652-y</pub-id></element-citation></ref><ref id="R56"><label>56</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Corcoran</surname><given-names>L</given-names></name><etal/></person-group><article-title>The lymphoid past of mouse plasmacytoid cells and thymic dendritic cells</article-title><source>J Immunol</source><year>2003</year><volume>170</volume><fpage>4926</fpage><lpage>4932</lpage><pub-id pub-id-type="pmid">12734335</pub-id></element-citation></ref><ref id="R57"><label>57</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shigematsu</surname><given-names>H</given-names></name><etal/></person-group><article-title>Plasmacytoid dendritic cells activate lymphoid-specific genetic programs irrespective of their cellular origin</article-title><source>Immunity</source><year>2004</year><volume>21</volume><fpage>43</fpage><lpage>53</lpage><pub-id pub-id-type="pmid">15345219</pub-id></element-citation></ref><ref id="R58"><label>58</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pelayo</surname><given-names>R</given-names></name><etal/></person-group><article-title>Derivation of 2 categories of plasmacytoid dendritic cells in murine bone marrow</article-title><source>Blood</source><year>2005</year><volume>105</volume><fpage>4407</fpage><lpage>4415</lpage><pub-id pub-id-type="pmcid">PMC1850236</pub-id><pub-id pub-id-type="pmid">15728131</pub-id><pub-id pub-id-type="doi">10.1182/blood-2004-07-2529</pub-id></element-citation></ref><ref id="R59"><label>59</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sathe</surname><given-names>P</given-names></name><name><surname>Vremec</surname><given-names>D</given-names></name><name><surname>Wu</surname><given-names>L</given-names></name><name><surname>Corcoran</surname><given-names>L</given-names></name><name><surname>Shortman</surname><given-names>K</given-names></name></person-group><article-title>Convergent differentiation: myeloid and lymphoid pathways to murine plasmacytoid dendritic cells</article-title><source>Blood</source><year>2013</year><volume>121</volume><fpage>11</fpage><lpage>19</lpage><pub-id pub-id-type="pmid">23053574</pub-id></element-citation></ref><ref id="R60"><label>60</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mak</surname><given-names>TW</given-names></name><name><surname>Saunders</surname><given-names>ME</given-names></name></person-group><article-title>The immune response</article-title><source>Part I: Basic Immunology</source><year>2006</year><fpage>373</fpage><lpage>401</lpage></element-citation></ref><ref id="R61"><label>61</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Charles</surname><given-names>A</given-names></name><name><surname>Janeway</surname><given-names>J</given-names></name><name><surname>Travers</surname><given-names>P</given-names></name><name><surname>Walport</surname><given-names>M</given-names></name></person-group><source>Immunobiology: the immune system in health and disease</source><publisher-name>Current Biology Ltd/Garland</publisher-name></element-citation></ref><ref id="R62"><label>62</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Elhanati</surname><given-names>Y</given-names></name><etal/></person-group><article-title>Inferring processes underlying B-cell repertoire diversity</article-title><source>Philos Trans R Soc Lond B Biol Sci</source><year>2015</year><volume>370</volume><pub-id pub-id-type="pmcid">PMC4528420</pub-id><pub-id pub-id-type="pmid">26194757</pub-id><pub-id pub-id-type="doi">10.1098/rstb.2014.0243</pub-id></element-citation></ref><ref id="R63"><label>63</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sethna</surname><given-names>Z</given-names></name><etal/></person-group><article-title>Population variability in the generation and selection of T-cell repertoires</article-title><source>PLoS Comput Biol</source><year>2020</year><volume>16</volume><elocation-id>e1008394</elocation-id><pub-id pub-id-type="pmcid">PMC7725366</pub-id><pub-id pub-id-type="pmid">33296360</pub-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1008394</pub-id></element-citation></ref><ref id="R64"><label>64</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Okoreeh</surname><given-names>MK</given-names></name><etal/></person-group><article-title>Asymmetrical forward and reverse developmental trajectories determine molecular programs of B cell antigen receptor editing</article-title><source>Sci Immunol</source><year>2022</year><volume>7</volume><elocation-id>eabm1664</elocation-id><pub-id pub-id-type="pmcid">PMC9636592</pub-id><pub-id pub-id-type="pmid">35930652</pub-id><pub-id pub-id-type="doi">10.1126/sciimmunol.abm1664</pub-id></element-citation></ref><ref id="R65"><label>65</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jaffe</surname><given-names>DB</given-names></name><etal/></person-group><article-title>Functional antibodies exhibit light chain coherence</article-title><source>Nature</source><year>2022</year><pub-id pub-id-type="pmcid">PMC9607724</pub-id><pub-id pub-id-type="pmid">36289331</pub-id><pub-id pub-id-type="doi">10.1038/s41586-022-05371-z</pub-id></element-citation></ref><ref id="R66"><label>66</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Montecino-Rodriguez</surname><given-names>E</given-names></name><name><surname>Dorshkind</surname><given-names>K</given-names></name></person-group><article-title>B-1 B cell development in the fetus and adult</article-title><source>Immunity</source><year>2012</year><volume>36</volume><fpage>13</fpage><lpage>21</lpage><pub-id pub-id-type="pmcid">PMC3269035</pub-id><pub-id pub-id-type="pmid">22284417</pub-id><pub-id pub-id-type="doi">10.1016/j.immuni.2011.11.017</pub-id></element-citation></ref><ref id="R67"><label>67</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Herzenberg</surname><given-names>LA</given-names></name><name><surname>Herzenberg</surname><given-names>LA</given-names></name></person-group><article-title>Toward a layered immune system</article-title><source>Cell</source><year>1989</year><volume>59</volume><fpage>953</fpage><lpage>954</lpage><pub-id pub-id-type="pmid">2688900</pub-id></element-citation></ref><ref id="R68"><label>68</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Solvason</surname><given-names>N</given-names></name><name><surname>Lehuen</surname><given-names>A</given-names></name><name><surname>Kearney</surname><given-names>JF</given-names></name></person-group><article-title>An embryonic source of Ly1 but not conventional B cells</article-title><source>Int Immunol</source><year>1991</year><volume>3</volume><fpage>543</fpage><lpage>550</lpage><pub-id pub-id-type="pmid">1679664</pub-id></element-citation></ref><ref id="R69"><label>69</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Montecino-Rodriguez</surname><given-names>E</given-names></name><name><surname>Leathers</surname><given-names>H</given-names></name><name><surname>Dorshkind</surname><given-names>K</given-names></name></person-group><article-title>Identification of a B-1 B cell-specified progenitor</article-title><source>Nat Immunol</source><year>2006</year><volume>7</volume><fpage>293</fpage><lpage>301</lpage><pub-id pub-id-type="pmid">16429139</pub-id></element-citation></ref><ref id="R70"><label>70</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Esplin</surname><given-names>BL</given-names></name><name><surname>Welner</surname><given-names>RS</given-names></name><name><surname>Zhang</surname><given-names>Q</given-names></name><name><surname>Borghesi</surname><given-names>LA</given-names></name><name><surname>Kincade</surname><given-names>PW</given-names></name></person-group><article-title>A differentiation pathway for B1 cells in adult bone marrow</article-title><source>Proc Natl Acad Sci U S A</source><year>2009</year><volume>106</volume><fpage>5773</fpage><lpage>5778</lpage><pub-id pub-id-type="pmcid">PMC2666989</pub-id><pub-id pub-id-type="pmid">19307589</pub-id><pub-id pub-id-type="doi">10.1073/pnas.0811632106</pub-id></element-citation></ref><ref id="R71"><label>71</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yoshimoto</surname><given-names>M</given-names></name><etal/></person-group><article-title>Embryonic day 9 yolk sac and intra-embryonic hemogenic endothelium independently generate a B-1 and marginal zone progenitor lacking B-2 potential</article-title><source>Proc Natl Acad Sci U S A</source><year>2011</year><volume>108</volume><fpage>1468</fpage><lpage>1473</lpage><pub-id pub-id-type="pmcid">PMC3029764</pub-id><pub-id pub-id-type="pmid">21209332</pub-id><pub-id pub-id-type="doi">10.1073/pnas.1015841108</pub-id></element-citation></ref><ref id="R72"><label>72</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kreslavsky</surname><given-names>T</given-names></name><name><surname>Wong</surname><given-names>JB</given-names></name><name><surname>Fischer</surname><given-names>M</given-names></name><name><surname>Skok</surname><given-names>JA</given-names></name><name><surname>Busslinger</surname><given-names>M</given-names></name></person-group><article-title>Control of B-1a cell development by instructive BCR signaling</article-title><source>Curr Opin Immunol</source><year>2018</year><volume>51</volume><fpage>24</fpage><lpage>31</lpage><pub-id pub-id-type="pmcid">PMC5943138</pub-id><pub-id pub-id-type="pmid">29414528</pub-id><pub-id pub-id-type="doi">10.1016/j.coi.2018.01.001</pub-id></element-citation></ref><ref id="R73"><label>73</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Graf</surname><given-names>R</given-names></name><etal/></person-group><article-title>BCR-dependent lineage plasticity in mature B cells</article-title><source>Science</source><year>2019</year><volume>363</volume><fpage>748</fpage><lpage>753</lpage><pub-id pub-id-type="pmid">30765568</pub-id></element-citation></ref><ref id="R74"><label>74</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chatterjee</surname><given-names>S</given-names></name></person-group><article-title>A New Coefficient of Correlation</article-title><source>J Am Stat Assoc</source><year>2021</year><volume>116</volume><fpage>2009</fpage><lpage>2022</lpage></element-citation></ref><ref id="R75"><label>75</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gadala-Maria</surname><given-names>D</given-names></name><name><surname>Yaari</surname><given-names>G</given-names></name><name><surname>Uduman</surname><given-names>M</given-names></name><name><surname>Kleinstein</surname><given-names>SH</given-names></name></person-group><article-title>Automated analysis of high-throughput B-cell sequencing data reveals a high frequency of novel immunoglobulin V gene segment alleles</article-title><source>Proc Natl Acad Sci U S A</source><year>2015</year><volume>112</volume><fpage>E862</fpage><lpage>70</lpage><pub-id pub-id-type="pmcid">PMC4345584</pub-id><pub-id pub-id-type="pmid">25675496</pub-id><pub-id pub-id-type="doi">10.1073/pnas.1417683112</pub-id></element-citation></ref><ref id="R76"><label>76</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sleckman</surname><given-names>BP</given-names></name><name><surname>Khor</surname><given-names>B</given-names></name><name><surname>Monroe</surname><given-names>R</given-names></name><name><surname>Alt</surname><given-names>FW</given-names></name></person-group><article-title>Assembly of productive T cell receptor delta variable region genes exhibits allelic inclusion</article-title><source>J Exp Med</source><year>1998</year><volume>188</volume><fpage>1465</fpage><lpage>1471</lpage><pub-id pub-id-type="pmcid">PMC2213415</pub-id><pub-id pub-id-type="pmid">9782123</pub-id><pub-id pub-id-type="doi">10.1084/jem.188.8.1465</pub-id></element-citation></ref><ref id="R77"><label>77</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hu</surname><given-names>Y</given-names></name></person-group><article-title>Efficient, high-quality force-directed graph drawing</article-title><source>Mathematica journal</source><year>2005</year></element-citation></ref><ref id="R78"><label>78</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peixoto</surname><given-names>TP</given-names></name></person-group><article-title>The graph-tool python library</article-title><year>2017</year><pub-id pub-id-type="doi">10.6084/M9.FIGSHARE.1164194</pub-id></element-citation></ref><ref id="R79"><label>79</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wolock</surname><given-names>SL</given-names></name><name><surname>Lopez</surname><given-names>R</given-names></name><name><surname>Klein</surname><given-names>AM</given-names></name></person-group><article-title>Scrublet: Computational Identification of Cell Doublets in Single-Cell Transcriptomic Data</article-title><source>Cell Syst</source><year>2019</year><volume>8</volume><fpage>281</fpage><lpage>291</lpage><elocation-id>e9</elocation-id><pub-id pub-id-type="pmcid">PMC6625319</pub-id><pub-id pub-id-type="pmid">30954476</pub-id><pub-id pub-id-type="doi">10.1016/j.cels.2018.11.005</pub-id></element-citation></ref><ref id="R80"><label>80</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Benjamini</surname><given-names>Y</given-names></name><name><surname>Hochberg</surname><given-names>Y</given-names></name></person-group><article-title>Controlling the false discovery rate: A practical and powerful approach to multiple testing</article-title><source>J R Stat Soc</source><year>1995</year><volume>57</volume><fpage>289</fpage><lpage>300</lpage></element-citation></ref><ref id="R81"><label>81</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Crooks</surname><given-names>GE</given-names></name><name><surname>Hon</surname><given-names>G</given-names></name><name><surname>Chandonia</surname><given-names>J-M</given-names></name><name><surname>Brenner</surname><given-names>SE</given-names></name></person-group><article-title>WebLogo: a sequence logo generator</article-title><source>Genome Res</source><year>2004</year><volume>14</volume><fpage>1188</fpage><lpage>1190</lpage><pub-id pub-id-type="pmcid">PMC419797</pub-id><pub-id pub-id-type="pmid">15173120</pub-id><pub-id pub-id-type="doi">10.1101/gr.849004</pub-id></element-citation></ref><ref id="R82"><label>82</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kerby</surname><given-names>DS</given-names></name></person-group><article-title>The Simple Difference Formula: An Approach to Teaching Nonparametric Correlation</article-title><source>Comprehensive Psychology</source><year>2014</year><volume>3</volume><elocation-id>11.IT.3.1</elocation-id></element-citation></ref><ref id="R83"><label>83</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lopez</surname><given-names>R</given-names></name><name><surname>Regier</surname><given-names>J</given-names></name><name><surname>Cole</surname><given-names>MB</given-names></name><name><surname>Jordan</surname><given-names>MI</given-names></name><name><surname>Yosef</surname><given-names>N</given-names></name></person-group><article-title>Deep generative modeling for single-cell transcriptomics</article-title><source>Nat Methods</source><year>2018</year><volume>15</volume><fpage>1053</fpage><lpage>1058</lpage><pub-id pub-id-type="pmcid">PMC6289068</pub-id><pub-id pub-id-type="pmid">30504886</pub-id><pub-id pub-id-type="doi">10.1038/s41592-018-0229-2</pub-id></element-citation></ref><ref id="R84"><label>84</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lambert</surname><given-names>SA</given-names></name><etal/></person-group><article-title>The Human Transcription Factors</article-title><source>Cell</source><year>2018</year><volume>175</volume><fpage>598</fpage><lpage>599</lpage><pub-id pub-id-type="pmid">30290144</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Fig. 1</label><caption><title>Holistic scVDJ-seq analysis pipeline.</title><p><bold>a,</bold> Schematic illustration showing that <italic>Dandelion</italic> bridges methods from single-cell V(D)J workflows such as AIRR standards and the single-cell gene expression analysis software, and combines with them additional novel methods of its own to create a holistic pipeline for analysis. <bold>b,</bold> Schematic illustration of the <italic>Dandelion</italic> workflow. Paired single-cell gene expression (scRNA-seq) and AIR repertoire (scVDJ-seq) data is generated, followed by mapping of the sequencing reads. From the mapped results, <italic>Dandelion</italic> provides refined contig annotations with BCR mutation calling, improved γδTCR mapping and identification of multi-J mapping contigs. It also provides downstream analysis after integration with scRNA-seq results. Apart from allowing the users to explore clonotype networks and V(D)J usage, <italic>Dandelion</italic> also supports building a V(D)J feature space on pseudo-bulked cells, that can be used for differential V(D)J usage and pseudotime inference. Additional unique features provided by <italic>Dandelion</italic> are boxed in orange.</p></caption><graphic xlink:href="EMS157425-f001"/></fig><fig id="F2" position="float"><label>Fig. 2</label><caption><title><italic>Dandelion</italic> offers improved contig annotations.</title><p><bold>a,</bold> Left: barplot of proportion of contigs that are productive or non-productive in each locus. Right: barplot showing the causes of non-productive contigs in each locus. For both plots, sc-γδTCR, -αβTCR and -BCR data were taken from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. <bold>b,</bold> Schematic illustration of the V(D)J rearrangement process and the potential cause of multi-J mapping with sequential mapped J genes on the same contig. <bold>c,</bold> Boxplot of the proportion of contigs with multi-J mapping, in the presence (blue) or absence (orange) of V genes. Each point represents a sample and data were taken from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. Only samples with at least 10 contigs are shown. Boxes capture the first to third quartiles and whisks span a further 1.5X interquartile range on each side of the box. For each locus, the proportions in contigs with and without V genes were compared by the Wilcoxon rank sum test. <italic>P</italic>-values less than 0.001 were marked with *** (<italic>P</italic>-value for TRA: 8.78e-10; TRB: 4.96e-19; TRG: 1.47e-5; TRD: 0.68; IGH: 3.60e-11; IGL: 0.84; IGK: 0.073). <bold>d,</bold> Top: logistic regression formula to explore factors associated with multi-J mapping. Bottom: volcano plot summarizing logistic regression results using data from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. The <italic>y</italic>-<monospace>axis is the – log</monospace><sub>10</sub>(BH adjusted <italic>P</italic>-value) and the <italic>x</italic>-axis is log(odds ratio). The variables that were also significant in our control/cycloheximide-treated PBMC dataset were highlighted in red (associated with increased multi-J mapping) or blue (associated with decreased multi-J mapping). <bold>e,</bold> Sequence logos of sequences covering the last 11 nucleotides at 3′ ends (position 1 to 11) and the first 10 nucleotides of the neighboring intron (position 12 to 21) for genes associated with increased (top) or decreased (bottom) multi-J mapping. J genes associated with increased multi-J mapping were less likely to have T in position 17 (<italic>P</italic>-value 0.059 in logistic regression) and ‘GTAAGT’ is a known consensus motif for splicing in position 12 to 17 i.e. +1 to +6 in the intron. They were also more likely to have T in position 6 (<italic>P</italic>-value 0.022 in logistic regression) although the effect on splicing is unknown. <bold>f,</bold> Swarmplots of fraction difference of sc-γδTCR contigs annotated by <italic>Dandelion</italic> versus 10X <italic>cellranger vdj</italic> (v6.1.2) using data from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. Each dot represents a sample. The red dashed line marks the threshold of 0, above which <italic>Dandelion</italic> recovers more γδTCR contigs than 10X. Left: all high confidence contigs. Right: high confidence productive contigs.</p></caption><graphic xlink:href="EMS157425-f002"/></fig><fig id="F3" position="float"><label>Fig. 3</label><caption><title>Creating a V(D)J feature space.</title><p><bold>a,</bold> Schematic illustration of the workflow of creating a V(D)J feature space. Step 1: cells are assigned to pseudo-bulks, which can be based on metadata features, or partially overlapping cell neighborhoods. Step 2: V(D)J usage frequency per pseudo-bulk is computed for each gene, and used as input of the V(D)J feature space. Step 3: the V(D)J feature space can be visualized with conventional dimension reduction techniques such as PCA or UMAP, and it can then be utilized for differential V(D)J usage analysis and pseudotime inference. <bold>b,</bold> Top left: gene expression UMAP of all T cells from adult human tissues in Conde et al. 2022<sup><xref ref-type="bibr" rid="R5">5</xref></sup>, colored by low-level cell type annotations. Each point represents a cell. Top middle: V(D)J usage frequency per celltype_donor pseudo-bulk is computed for each gene, and used as input of the V(D)J feature space. Top right: UMAP of the pseudo-bulk V(D)J feature space of the same cells. Each point represents a cell pseudo-bulk. Bottom panel: top two differentially expressed TCR genes in CD4+T cells, CD8+T cells and MAIT cells. c, Left: UMAP of neighborhood V(D)J feature space covering DP to mature T cells with paired productive αβTCR in data from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. Each point represents a cell neighborhood, colored by the dominant cell type in each neighborhood. The point size represents neighborhood size, with connecting edges representing overlapping cell numbers between any two neighborhoods. Only edges with more than 30 overlapping cells are shown. Right top: inferred pseudotime, and branch probabilities to CD8+T and to CD4+T respectively overlaid onto the same UMAP embedding on the left. Right bottom: scatterplot of branch probability to CD8+T against pseudotime. Each point represents a cell neighborhood, colored by the dominant cell type in each neighborhood.</p></caption><graphic xlink:href="EMS157425-f003"/></fig><fig id="F4" position="float"><label>Fig. 4</label><caption><title>Comparing pseudotime inferred from V(D)J space or gene expression (GEX) space.</title><p><bold>a,</bold> Top: pseudotime and branch probability to CD8+T inferred from neighborhood V(D)J space in Fig. 3c, projected back to the cells, overlaid onto the same UMAP embedding as in the top left panel. Left bottom: UMAP of DP to mature T cells with paired productive αβTCR in data from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. Each point represents a cell, colored by cell types. Underneath the UMAP is a schematic showing the T cell differentiation process. Right bottom: pseudotime and branch probability to CD8+T inferred from neighborhood GEX space, projected back to the cells, overlaid onto the same UMAP embedding as in the top left panel. <bold>b,</bold> Scatterplots of the pseudotime ordering against the average relative TRAV or TRAJ location. Each point represents a cell neighborhood. Each TRAV or TRAJ gene is encoded numerically for its relative genomic order. The <italic>x</italic>-axis represents the average TRAV/TRAJ relative location for each cell neighborhood. Top: results from pseudotime inferred from neighborhood V(D)J space. Bottom: results from pseudotime inferred from neighborhood GEX space. c, Stripplot of correlation coefficients of gene expression with branch probabilities to CD8+T within abT(entry) cells, for branch probabilities inferred from neighborhood V(D)J space and neighborhood GEX space separately. Only genes that are known CD4+/CD8+T cell markers or TFs involved in CD8+T/CD4+T lineage decision are labeled, and colored. The rest of the genes are grayed out. Labeled genes that had significant (BH adjusted <italic>P</italic>-value &lt; 0.05) positive correlations were colored in red, the ones with significant negative correlations were colored in blue, and those without significant correlations were colored in orange.</p></caption><graphic xlink:href="EMS157425-f004"/></fig><fig id="F5" position="float"><label>Fig. 5</label><caption><title>Insights into lymphocyte development from non-productive TCR.</title><p><bold>a,</bold> Boxplot of the proportion of cells with productive (blue) or non-productive (orange) TRB in different fetal lymphocyte subsets. Each point represents a sample and data were taken from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. Only samples with at least 20 cells are shown. Boxes capture the first to third quartiles and whisks span a further 1.5X interquartile range on each side of the box. The annotations used here were based on the version whereby the exact identity of cycling B cells was predicted to be immature B, mature B, B1 or plasma B cells using <italic>Celltypist<sup><xref ref-type="bibr" rid="R3">3</xref>,<xref ref-type="bibr" rid="R5">5</xref></sup></italic>. The equivalent boxplot using the original annotations is shown in <bold>Supplementary Fig. 8a</bold>. <bold>b,</bold> Top left: schematic illustration showing the proposed development of B cells (top panel), and relationship between ILC/NK and T cell lineages. Top right: UMAP of neighborhood V(D)J feature space covering ILC, NK and developing T cells with TRBJ in data from Suo et al. 2022<sup><xref ref-type="bibr" rid="R3">3</xref></sup>. Each point represents a cell neighborhood, colored by cell types. The point size represents neighborhood size, with connecting edges representing overlapping cell numbers between any two neighborhoods. Only edges with more than 30 overlapping cells are shown. Bottom: inferred pseudotime, and branch probabilities to ILC/NK and T lineage respectively overlaid onto the same UMAP embedding on the top right. <bold>c,</bold> Top: scatterplot of branch probability to ILC/NK lineage against pseudotime. The pseudotime was inferred from neighborhood V(D)J space shown in Fig. 5b and projected back cells. Each point represents a cell, colored by cell types. Bottom: heatmap of TF expressions across pseudotime in DN T cells. Pseudotime is equally divided into 100 bins, and the average gene expression is calculated for DN T cells with pseudotime that falls within each bin. Genes selected here are TFs that had significantly high Chatterjee’s correlation<sup><xref ref-type="bibr" rid="R74">74</xref></sup> with pseudotime (BH adjusted <italic>P</italic>-value &lt; 0.05, and correlation coefficient &gt; 0.1).</p></caption><graphic xlink:href="EMS157425-f005"/></fig></floats-group></article>