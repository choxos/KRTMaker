<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS157366</article-id><article-id pub-id-type="doi">10.1101/2022.11.17.516980</article-id><article-id pub-id-type="archive">PPR573070</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">2</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group><subj-group subj-group-type="europepmc-category"><subject>Covid-19</subject></subj-group></article-categories><title-group><article-title>Cell-type Annotation with Accurate Unseen Cell-type Identification Using Multiple References</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Xiong</surname><given-names>Yi-Xuan</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Wang</surname><given-names>Meng-Guo</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Chen</surname><given-names>Luonan</given-names></name><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref><xref ref-type="aff" rid="A5">5</xref><xref ref-type="aff" rid="A6">6</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib><contrib contrib-type="author"><name><surname>Zhang</surname><given-names>Xiao-Fei</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib></contrib-group><aff id="A1"><label>1</label>School of Mathematics and Statistics, Central China Normal University, Wuhan, China</aff><aff id="A2"><label>2</label>Hubei Key Laboratory of Mathematical Sciences, Central China Normal University, Wuhan, China</aff><aff id="A3"><label>3</label>State Key Laboratory of Cell Biology, Shanghai Institute of Biochemistry and Cell Biology, Center for Excellence in Molecular Cell Science, Chinese Academy of Sciences, Shanghai, China</aff><aff id="A4"><label>4</label>School of Life Science and Technology, ShanghaiTech University, Shanghai, China</aff><aff id="A5"><label>5</label>Key Laboratory of Systems Health Science of Zhejiang Province, Hangzhou Institute for Advanced Study, University of Chinese Academy of Sciences, Chinese Academy of Sciences, Hangzhou, China</aff><aff id="A6"><label>6</label>Guangdong Institute of Intelligence Science and Technology, Hengqin, Zhuhai, Guangdong, China</aff><author-notes><corresp id="CR1">
<label>*</label><email>zhangxf@mail.ccnu.edu.cn</email>, <email>lnchen@sibs.ac.cn</email></corresp></author-notes><pub-date pub-type="nihms-submitted"><day>20</day><month>11</month><year>2022</year></pub-date><pub-date pub-type="preprint"><day>18</day><month>11</month><year>2022</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nd/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nd/4.0/">CC BY-ND 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">The recent advances in single-cell RNA sequencing (scRNA-seq) techniques have stimulated efforts to identify and characterize the cellular composition of complex tissues. With the advent of various sequencing techniques, automated cell-type annotation using a well-annotated scRNA-seq reference becomes popular but relies on the diversity of cell types in the reference. There are generally unseen cell types in the query data of interest because most data atlases are obtained for different purposes and techniques. When annotating new query data, identifying unseen cell types is fundamental not only for improving annotation accuracy but also for novel biological discoveries. Here, we propose mtANN (multiple-reference-based scRNA-seq data annotation), a new method to automatically annotate query data while accurately identifying unseen cell types with the aid of multiple references. Key innovations of mtANN include the integration of deep learning and ensemble learning to improve prediction accuracy, and the introduction of a new metric defined from three complementary aspects to distinguish between unseen cell types and shared cell types. In addition, a data-driven method is provided to adaptively select threshold for unseen cell-type identification. We demonstrate the advantages of mtANN over state-of-the-art methods for unseen cell-type identification and cell-type annotation on two benchmark dataset collections, as well as its predictive power on a collection of COVID-19 datasets. The source code and tutorial are available at <ext-link ext-link-type="uri" xlink:href="https://github.com/Zhangxf-ccnu/mtANN">https://github.com/Zhangxf-ccnu/mtANN</ext-link>.</p></abstract></article-meta></front><body><sec id="S1" sec-type="intro"><title>Introduction</title><p id="P2">Single-cell RNA sequencing (scRNA-seq) technologies can measure the gene expression profile of a sample at single-cell resolution. Their recent advances have stimulated efforts to identify and characterize the cellular composition of tissues, revolutionizing the understanding of the heterogeneity of complex tissues. With the various sequencing technologies, like 10x Genomics Chromium, Drop-seq, and Smart-seq2, having emerged, understanding the complex tissues has turned into a task of cell-type annotation for new sequencing data [<xref ref-type="bibr" rid="R1">1</xref>–<xref ref-type="bibr" rid="R3">3</xref>].</p><p id="P3">There are two typical solutions for cell-type annotation tasks. One of the solutions is to unsupervised cluster cells into groups based on the similarity of their gene expression profiles, and annotate cell populations by assigning labels to each cluster according to cluster-specific marker genes [<xref ref-type="bibr" rid="R4">4</xref>–<xref ref-type="bibr" rid="R8">8</xref>]. However, such methods require extensive literature review and manual testing of various combinations of marker genes, which is not only time-consuming but also not reproducible across different experiments within and across research groups [<xref ref-type="bibr" rid="R9">9</xref>, <xref ref-type="bibr" rid="R10">10</xref>]. Another solution is to learn the intrinsic relationship between gene expression profiles and cell types based on a well-annotated reference atlas, and transfer the learned relationship to query data for cell-type annotation. There are two main types of approaches to this reference-based strategy, one is to learn the similarity between the reference atlas and the query data based on statistical metrics, as the basis for cell-type label transfer [<xref ref-type="bibr" rid="R11">11</xref>–<xref ref-type="bibr" rid="R14">14</xref>]. The other is to model a classifier on the reference atlas, which can make predictions directly on the query data [<xref ref-type="bibr" rid="R15">15</xref>–<xref ref-type="bibr" rid="R19">19</xref>]. The reference-based method can avoid manual selection of marker genes, and the trained classifier can be used for any new query data, providing convenience for practical applications.</p><p id="P4">Previous reference-based methods rarely take into account the following two issues. The first one is the selection of the reference atlas. Noise from the reference data and incorrectly annotated cell types may lead to inaccurate annotations on the query data, and the selection of input features of the classification model also has an impact on the annotation performance of different methods [<xref ref-type="bibr" rid="R20">20</xref>, <xref ref-type="bibr" rid="R21">21</xref>]. This issue is expected to be partially addressed by integrating multiple well-annotated reference datasets and multiple gene selection methods [<xref ref-type="bibr" rid="R22">22</xref>–<xref ref-type="bibr" rid="R25">25</xref>], where an appropriate integration strategy is needed. Most of previous related methods first integrate multiple well-labeled datasets into a comprehensive reference atlas, and then annotate the cell types of the query data according to the integrated reference atlas, which makes the annotation results dependent on the removal of batch effects between different reference datasets [<xref ref-type="bibr" rid="R26">26</xref>, <xref ref-type="bibr" rid="R27">27</xref>]. Another issue is that there is a difference in the joint distribution of gene expression and cell type between the reference and query datasets due to the difference in the marginal distributions. Distributional differences in gene expression, known as batch effects, have been extensively addressed in previous studies [<xref ref-type="bibr" rid="R28">28</xref>, <xref ref-type="bibr" rid="R29">29</xref>], while differences in the distribution of cell types have been rarely considered. Discrepancies in cell types indicate that there are cell types in the query data that are not seen in the reference atlas, which can be called “unseen” cell types. Unseen cell types may suggest new biological discoveries that cannot be neglected. Additionally, ignoring the presence of unseen cell types biases the classifier learned on the reference atlas to known cell types, resulting in false predictions on the query data. These two issues are potentially related. Integrating multiple reference datasets can enrich the cell type information of reference data, but how to integrate reference datasets containing different cell types is difficult. In addition, how to identify cell types in the query data that are not seen in the reference data also requires effective methods.</p><p id="P5">In order to address the above two issues, we propose mtANN (multiple-reference-based scRNA-seq data annotation), a novel method that automatically identifies unseen cell types while accurately annotating query dataset by integrating multiple well-annotated scRNA-seq datasets as references. The main idea of mtANN is first to learn multiple deep classification models from multiple reference datasets to obtain multiple prediction results. These results are then used to vote on metaphase annotations and to compute metrics from three complementary aspects to identify unseen cell types. Final annotations are made based on metaphase annotation and unseen cell type identification results. mtANN has the following characteristics: (i) it utilizes the diversity of multiple reference datasets and avoids the selection of a single reference dataset; (ii) it combines the ideas of deep learning and ensemble learning to improve prediction accuracy; (iii) it proposes a new metric from three complementary aspects to measure whether a cell belongs to an unseen cell-type; and (iv) it introduces a new data-driven approach to automatically determine thresholds for unseen cell type identification. We benchmark mtANN using two collections of benchmark datasets, each from different tissues, sequencing technologies, and containing different cell types. We prepare a total of 75 benchmark tests, including annotations across different technologies and unseen type belonging to different cell types. We also use a COVID-19 dataset and prepare a total of 249 tests to assess the performance. Experimental results demonstrate that mtANN outperforms state-of-the-art methods in both unseen cell-type identification and cell-type annotation.</p></sec><sec id="S2" sec-type="results"><title>Results</title><sec id="S3"><title>Overview of mtANN</title><p id="P6">The workflow of mtANN is illustrated in <xref ref-type="fig" rid="F1">Fig 1</xref> and <xref ref-type="supplementary-material" rid="SD1">S1 Text</xref>. To simultaneously annotate the query data and identify unseen cell types, mtANN first adopts eight gene selection methods to generate a series of subsets that retain distinct genes for each reference dataset (<xref ref-type="fig" rid="F1">Fig 1A</xref>). This step facilitates the detection of biologically important genes and increases data diversity for effective ensemble learning. Second, mtANN trains a series of neural network-based deep classification models based on all reference subsets. These base classification models characterize different relationships between gene expression and cell types which are complementary in identifying unseen cell types. (<xref ref-type="fig" rid="F1">Fig 1A</xref>). Third, mtANN annotates the query dataset by integrating the outputs of all base classification models (<xref ref-type="fig" rid="F1">Fig 1B</xref>). Fourth, mtANN defines a new metric from three complementary aspects to identify cells that may belong to unseen cell types (<xref ref-type="fig" rid="F1">Fig 1C</xref>). Finally, we provide a data-driven method for threshold selection, which helps to mark cells belonging as “unassigned” (<xref ref-type="fig" rid="F1">Fig 1C</xref>).</p></sec><sec id="S4"><title>Validation of the rationale of mtANN</title><p id="P7">mtANN integrates multiple well-annotated scRNA-seq datasets as references and applies eight gene selection methods to select informative genes. To validate the effectiveness of integrating multiple reference datasets and gene selection methods, we use two collections of datasets from two tissues: peripheral blood mononuclear cells (PBMC) collection which contains 7 datasets sequenced by 7 different technologies [<xref ref-type="bibr" rid="R20">20</xref>] and Pancreas collection containing 4 datasets sequenced by 4 different technologies [<xref ref-type="bibr" rid="R30">30</xref>–<xref ref-type="bibr" rid="R33">33</xref>] (Methods Datasets section). In each collection, we alternately select one dataset as a query dataset and the rest as reference datasets. The eight gene selection methods denoted as DE, DV, DD, DP, BI, GC, Disp, and Vst (Methods Gene selection section) are applied to these reference datasets separately, obtaining multiple reference subsets. Classification models trained on a single reference subset are compared with mtANN that integrates the results from different models to show the effectiveness of ensemble learning.</p><p id="P8">As an illustrative example, we first demonstrate the effectiveness of mtANN using the “Celseq” dataset from the PBMC collection and the “Baron” dataset from the Pancreas collection. When “Celseq” is used as the query data, the remaining “Drops”, “inDrop”, “Seq-Well”, “Smart-seq2”, “10X v2”, and “10X v3” are all used as reference datasets. In the Pancreas collection, the “Muraro”, “Segerstolpe”, and “Xin” are used as reference datasets while “Baron” is used as the query dataset.To show the difference in gene selection methods, we present the performance of different gene selection methods with different colored points. In <xref ref-type="fig" rid="F2">Fig 2</xref>, it is clear that the red line is higher than all the points, indicating that mtANN’s strategy of integrating all reference datasets and gene selection methods is consistently superior to a single classification model. It is worth noting that the performance of different gene selection methods varies across reference datasets, and no single gene selection method always wins on all datasets. Similar results are also observed in experiments with other datasets from both data collections (<xref ref-type="supplementary-material" rid="SD1">S1 Fig</xref>). These results demonstrate the necessity and effectiveness of integrating multiple reference datasets and gene selection methods to annotate cell types.</p></sec><sec id="S5"><title>Benchmarking mtANN for unseen cell-type identification</title><p id="P9">mtANN is specifically designed for unseen cell type identification when annotating cell types. To demonstrate its ability in identifying unseen cell types, we also use the two data collections: PBMC and Pancreas. Within each data collection, each dataset is alternately used as a query dataset and the rest are used as reference datasets. To simulate unseen cell type in the query dataset, we perform a leave-one-cell-type-out setting in every references-query pair. In doing so, we obtain a total of 50 tests in the PBMC collection and 25 tests in the Pancreas collection (for details, please refer to <xref ref-type="supplementary-material" rid="SD1">S2 Fig and S5 Table-S6 Table</xref>). We compare mtANN with several existing popular methods, including scmap-clust, scmap-cell [<xref ref-type="bibr" rid="R11">11</xref>], Seurat v3 [<xref ref-type="bibr" rid="R12">12</xref>], ItClust [<xref ref-type="bibr" rid="R15">15</xref>], scGCN (entropy), scGCN (enrichment) [<xref ref-type="bibr" rid="R16">16</xref>], and scANVI [<xref ref-type="bibr" rid="R17">17</xref>] (S1 Text Methods for benchmark section) as they also provide metrics for unseen cell-type identification. To evaluate each method in distinguishing unseen cell types from shared cell types, we compare the performance of each method in terms of AUPRC scores (S1 Text Performance assessment section).</p><p id="P10">The results are presented in <xref ref-type="fig" rid="F3">Fig 3A</xref> and <xref ref-type="supplementary-material" rid="SD1">S3 Fig</xref>. <xref ref-type="fig" rid="F3">Fig 3A</xref> shows that mtANN is superior to the compared methods when the “10X v3” dataset is the query. The results on other datasets also show the superior performance of mtANN (<xref ref-type="supplementary-material" rid="SD1">S3 Fig</xref>). Across all the experiments, we count the number of times each method ranks first in terms of AUPRC scores. We observe that the performance of scmap-clust, ItClust, and scGCN (enrichment) vary widely between different data collections (<xref ref-type="supplementary-material" rid="SD1">S4 Fig</xref>). They may rank first in some datasets, but have a large performance drop in others. This may be due to the difference in the distribution of cell types in the query and reference datasets. Take ItClust as an example, missing cell types in the reference data may lead to misalignment of cell labels and clusters, resulting in over-fitting of the model. mtANN effectively addresses this issue by borrowing complementary information between different reference datasets to define the uncertainty of cell annotation at different aspects, thereby accurately distinguishing between shared cell types and unseen cell types (<xref ref-type="fig" rid="F3">Fig 3B</xref> and <xref ref-type="supplementary-material" rid="SD1">S5 Fig-S7 Fig</xref>).</p><p id="P11">Another important issue in the identification of unseen cell types is the choice of thresholds. Most methods for identifying unseen cell types choose a fixed threshold (scmap) or a fixed ratio (Seurat v3) as the threshold, which may not generalize well on new datasets. To test the performance of the threshold selection methods, mtANN is compared with scmap-clust, scmap-cell and Seurat v3, which have provided threshold selection methods, in terms of F1 score. The results are presented in <xref ref-type="fig" rid="F3">Fig 3C</xref> and <xref ref-type="supplementary-material" rid="SD1">S8 Fig</xref>. It can be seen that mtANN performs better than other methods in most cases, scmap-cell performs the worst in PBMC collection, and the relative performance of scmap-clust, scmap-cell and Seurat v3 varies by dataset. To further investigate the reasons for the differences in the performance of these methods, we compare the proportion of true unseen cell types with the proportion of cells identified as “unassigned” by each method (<xref ref-type="supplementary-material" rid="SD1">S9 Fig</xref>). We take an experiment where “10X v3” is the query dataset, as an example (<xref ref-type="fig" rid="F3">Fig 3D</xref>). When the unseen cell type is B cell, the true proportion of the unseen cell type is 11%, and the proportion of cells predicted by mtANN as “unassigned” is close to 11%. While the “unassigned” cell proportion predicted by scmap-cell is much higher than the true proportion, and the proportion of “unassigned” cells identified by Seurat v3, fixed at 20%, is also higher than the true proportion. When the unseen cell type is Dendritic cell, the proportion of unseen cell types is small. The proportion of cells predicted by mtANN as “unassigned” decreases and is close to the true proportion, while the proportions of cells predicted by scmap-clust, scmap-cell, and Seurat v3 as “unassigned” are much higher than the true proportion. With default thresholds, we count the number of times each method ranks first in terms of F1 score across all the experiments, and find that mtANN is consistently able to accurately identify unseen cell types when the proportion of unseen cell types is varied (<xref ref-type="supplementary-material" rid="SD1">S4 Fig</xref>).</p></sec><sec id="S6"><title>Benchmarking mtANN for cell-type annotation</title><p id="P12">In addition to identifying unseen cell types, annotation of new query data requires label annotation of cells belonging to shared types. To evaluate the performance of mtANN for annotating query datasets when there are unseen cell types, we also use the PBMC and Pancreas collections to conduct the experiments. For each experiment, one dataset is selected as the query dataset and the rest are used as reference datasets. Since the presence of unseen cell types may affect the annotation of shared cell types, we still use the leave-one-cell-type-out setting in each experiment. As threshold selection will affect the annotation accuracy of the query dataset, we conduct two ways to determine the thresholds: the real proportion of unseen cells and the default threshold provided by each method.</p><p id="P13">When using the real proportion of unseen cell types in the query dataset as the threshold to assign unseen cells, the annotation accuracy of mtANN and other methods are presented in <xref ref-type="fig" rid="F4">Fig 4A</xref> and <xref ref-type="supplementary-material" rid="SD1">S10 Fig</xref>. It can be observed that in different experiments with different proportions of unseen cell types, mtANN always achieves higher annotation accuracy than other methods (<xref ref-type="supplementary-material" rid="SD1">S4 Fig</xref>).The performance of scmap, Seurat v3, and ItClust varies greatly across different experiments. This may be due to the presence of unseen cell types in the query dataset, leading to annotation bias towards shared cell types. To validate this, we calculate the Pearson correlation coefficient between the true proportional distribution of cell type in each experiment and the proportional distribution of the predicted results of each method (<xref ref-type="supplementary-material" rid="SD1">S11 Fig</xref>). The results show that mtANN has the highest correlation in both PBMC and Pancreas collections. We also use 10X v3 datasets being the query dataset and B cell being the real unseen cell type as an example. <xref ref-type="fig" rid="F4">Fig 4B</xref> shows that the proportion of cell types obtained from mtANN’s prediction is more similar to the true proportion. In detail, we find that mtANN identifies most B cells as “unassigned”, whereas all other comparison methods annotate most B cells as a similar cell type (CD4+ T cells) as they are all derived from lymphoid progenitors (<xref ref-type="fig" rid="F4">Fig 4C</xref>). For shared cell types, mtANN performs better at distinguishing the two monocyte subtypes, while scmap-clust, scmap-cell, and Seurat v3 tend to confuse CD16+ monocyte cells with CD14+ monocyte cells. scGCN (enrichment), scGCN (entropy), and scANVI fail to annotate monocytes and other rare cell types (Dendritic cell, Megakaryocyte, Natural killer cell, and Plasmacytoid dendritic cell). Overall, mtANN performs better than other methods in annotating new query data containing unseen cell types.</p><p id="P14">In reality, we cannot obtain the real proportion of unseen cell types, so the default threshold provided by each method is more practical and essential. When using the default method to select threshold, the prediction accuracies of mtANN, scmap-clust, scmap-cell and Seurat v3 in all the tests are presented in <xref ref-type="supplementary-material" rid="SD1">S12 Fig</xref>. We can observe that the accuracy of mtANN is higher than those of the compared methods when “Celseq”, “Drops”, “inDrop”, “Smart-seq2”, “10X v2”, and “10X v3” are evaluated as the query datasets (<xref ref-type="supplementary-material" rid="SD1">S12 FigA</xref>). <xref ref-type="supplementary-material" rid="SD1">S12 FigB</xref> shows that mtANN also has the best performance when “Baron human” and “Xin” are used as the query datasets. In addition, the result of mtANN at the default threshold is similar to the result at the actual proportion (<xref ref-type="supplementary-material" rid="SD1">S13 Fig</xref>), indicating that the threshold selected by mtANN is comparable to the actual proportion of unseen cells.</p></sec><sec id="S7"><title>Cell-type annotation of COVID-19 patients with different symptoms</title><p id="P15">Coronavirus disease 2019 (COVID-19) has caused more than 647 million infections and more than 6.6 million deaths, according to World Health Organization (WHO) statistics as of December 16, 2022. It is thus important to annotate the cell types of the sequencing data from COVID-19 patients for understanding the disease mechanism. With many scRNA-seq data from COVID-19 patients available, we select the study of COVID-19 that offers a comprehensive immune landscape [<xref ref-type="bibr" rid="R34">34</xref>], including 284 samples from 196 COVID-19 patients and controls to assess the performance of mtANN on real data. We use the dataset from PBMC cells in the COVID-19 dataset as the query datasets and the PBMC collection we used above [<xref ref-type="bibr" rid="R20">20</xref>] as references to evaluate the performance of mtANN and other methods.</p><p id="P16">We group the cells according to samples’ id, resulting in 249 query datasets. mtANN is compared with scmap-clust, scmap-cell, and Seurat v3 under the default threshold parameters for identifying unseen cell types. The accuracies of mtANN and other methods on the 249 query datasets are presented in <xref ref-type="fig" rid="F5">Fig 5A</xref>. It can be seen that the accuracies of mtANN for patients with different symptoms are higher than other methods, and scmap-cell suffers a decrease. We further conduct a one-to-one comparison and find that mtANN significantly (two-sided paired Wilcoxon test, p-value &lt; 0.01) outperforms the compared methods (<xref ref-type="fig" rid="F5">Fig 5B</xref>). We compare the composition of cell types between patients with different symptoms and find that the proportion of B cells increases in patients with severe symptoms, and the percentage of dendritic cells and T cells decreases, particularly in patients with severe symptoms (<xref ref-type="fig" rid="F5">Fig 5C</xref>), which is consistent with the lymphopenia phenomenon previously reported [<xref ref-type="bibr" rid="R35">35</xref>]. We also find that the percentage of megakaryocyte and CD14+ monocyte elevates in patients with severe symptoms, which is agreement with the original study [<xref ref-type="bibr" rid="R34">34</xref>]. Compared with scmap-clust and Seurat v3, mtANN can more accurately reflect the difference in the proportion of Dendritic cell and Megakaryocyte cells between different populations, which is instructive for the study of the development process of COVID-19.</p></sec></sec><sec id="S8" sec-type="discussion"><title>Discussion</title><p id="P17">With the development of single-cell sequencing technology, traditional unsupervised clustering-based cell-type annotation methods are difficult to adapt to rapidly generated datasets since they are time-consuming [<xref ref-type="bibr" rid="R36">36</xref>, <xref ref-type="bibr" rid="R37">37</xref>]. Another method for automatic cell-type annotation based on a reference atlas has been widely studied, but these methods are rarely able to discover unseen cell types in the query data [<xref ref-type="bibr" rid="R23">23</xref>, <xref ref-type="bibr" rid="R38">38</xref>, <xref ref-type="bibr" rid="R39">39</xref>]. The identification of unseen cell types may lead to new biological discoveries, while erroneous identification may lead to missing new biological discoveries or lead improper biological conclusions. Only some of the previous methods for automatically annotating cell types address the problem of identifying unseen cell types, and all of them only set a default threshold instead of proposing a methodology to automatically select a threshold. The choice of threshold can determine the accuracy and usability of the method.</p><p id="P18">In this study, we propose a novel ensemble learning-based cell-type annotation method, mtANN, to annotate cell-type labels for a query dataset automatically. Our method mainly has three innovations: (i) it integrates multiple reference datasets not only to enrich cell types in the reference atlas but also to provide complementary information to annotate cell types; (ii) it proposes a new metric from three complementary aspects to effectively measure whether a cell belongs to unseen cell types; and (iii) it proposes a data-driven approach to adaptively determine the threshold for unseen cell-type identification. Through the 75 sets of experiments we constructed, we demonstrate the annotation ability of mtANN for new sequencing data, and validate that mtANN can also accurately distinguish between unseen cell types and shared cell types when the proportion of unseen cell types in the query dataset varies. In particular, mtANN also has excellent discrimination between two similar cell types in the shared cell types. The application on the real data verifies the annotation performance of mtANN for COVID-19 patients, and its annotation results can show the difference in the proportions of different immune cells between different populations. Our comprehensive benchmark and application on an extensive set of publicly available benchmark datasets indicate that mtANN has achieved state-of-the-art performance for unseen cell-type identification and cell-type annotation in the meantime.</p><p id="P19">There may be two limitations in integrating multiple reference datasets for unseen cell-type identification that we have not addressed well in this work. One limitation of our method is the inconsistent terminology of cell types across different reference datasets. In this work, we avoid this problem by manually checking the cell-type annotations. For example, the cell type “PP” in the Xin dataset is changed to “gamma”, as “gamma” is the name used by all other datasets. Several approaches can be attempted in the future to match cell types between datasets, such as matching based on marker genes of cell types or matching by mutual prediction between datasets. In this work, we only mark the cells that are considered to belong to unseen cell types as “unassigned”. Thus, another limitation is that we do not provide a further biological interpretation of these cells. A straightforward way to determine the identities of these cells is to use unsupervised annotation methods. In addition, integrating Cell Ontology [<xref ref-type="bibr" rid="R40">40</xref>, <xref ref-type="bibr" rid="R41">41</xref>] into the method may be instructive for annotation of “unassigned” cells. For example, when Plasmacytoid dendritic cells are absent from reference dataset, they can be assigned to supertypes of Dendritic cells with the help of Cell Ontology. In the future, we will extend our method to implement this functionality.</p></sec><sec id="S9" sec-type="materials | methods"><title>Materials and Methods</title><sec id="S10"><label>Module I</label><title>Gene selection</title><p id="P20">mtANN uses five supervised gene selection methods collected by scClassify [<xref ref-type="bibr" rid="R23">23</xref>] and three widely used unsupervised methods for highly variable gene selection (for details, please refer to S1 Text). For each reference dataset (<italic>X<sup>r<sub>i</sub></sup>, Y<sup>r<sub>i</sub></sup></italic>), we adopt the eight gene selection methods to pick genes from different perspectives, including Limma, Bartlett’s test, Kolmogorov-Smirnov test, Chi-squared test, Bimodality index, Gini index-based clustering [<xref ref-type="bibr" rid="R42">42</xref>], Dispersion and Variance-stabilizing transformation [<xref ref-type="bibr" rid="R12">12</xref>]. The first five methods select differentially expressed genes (DE), differential variable genes (DV), differentially distributed genes (DD), differentially proportioned genes (DP), and bimodally distributed genes (BI) respectively, and the latter three methods pick highly variable genes based on Gini index-based clustering (GC), dispersion (Disp), and variance (Vst). We index these gene selection methods using <italic>j</italic> = 1, …, 8. Let <italic>G<sup>r<sub>ij</sub></sup></italic> denotes the gene set selected by the <italic>j</italic>-th gene selection method for the <italic>i</italic>-th reference dataset, where <italic>r<sub>ij</sub></italic>, <italic>i</italic> = 1, …, <italic>M, j</italic> = 1, …, 8 is the index of reference subsets, and <italic>G<sup>q</sup></italic> denote all genes in the query dataset. In doing so, we can obtain 8<italic>M</italic> reference subsets to expand the diversity of references. In each reference subset, we can train a deep classification model with <italic>G<sup>r<sub>ij</sub></sup></italic> ⋂ <italic>G<sup>q</sup></italic> as the input features. We denote <italic>X<sup>r<sub>ij</sub></sup></italic> and <italic>X<sup>q<sub>ij</sub></sup></italic> as the gene expression matrix after gene selection for the <italic>ij</italic>-th reference subset and query dataset. For convenience, we still denote the preprocessed data by <italic>X<sup>r<sub>ij</sub></sup></italic> and <italic>X<sup>q<sub>ij</sub></sup></italic>. Based on preprocessed data, we construct a dataset pair (<italic>X<sup>r<sub>ij</sub></sup>, Y<sup>r<sub>i</sub></sup>, X<sup>q<sub>ij</sub></sup></italic>), as the training dataset for the next step to train a base classification model.</p></sec><sec id="S11"><label>Module II</label><title>Deep classification model training</title><p id="P21">Based on each dataset pair (<italic>X<sup>r<sub>ij</sub></sup>, Y<sup>r<sub>i</sub></sup>, X<sup>q<sub>ij</sub></sup></italic>), we train a classification model based on deep learning. The classification model involves two components: the embedding component for extracting cell type-related features and the linear classifier layer for classification. Let <italic>E<sup>ij</sup></italic> and <italic>C<sup>ij</sup></italic> denote the embedding component and the linear classifier layer separately. The forward propagation result of the classification model after softmax transformation can be defined as <inline-formula><mml:math id="M1"><mml:msup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>s</mml:mi><mml:mi>o</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>E</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>X</mml:mi><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="M2"><mml:msup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula> is an assignment probability matrix with rows representing cells and columns representing cell types. The (<italic>c, k</italic>)-th element of <inline-formula><mml:math id="M3"><mml:msup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula> can be regarded as the predicted probability of cell <italic>c</italic> in <italic>i</italic>-th reference subset belonging to cell type <italic>k</italic>. The cross-entropy loss <disp-formula id="FD1"><label>(1)</label><mml:math id="M4"><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msup><mml:mi>n</mml:mi><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:mstyle displaystyle="true"><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msup><mml:mi>n</mml:mi><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:munderover><mml:mrow><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mn>1</mml:mn><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle><mml:mi>log</mml:mi><mml:msubsup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>c</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mo>.</mml:mo></mml:math></disp-formula> is used to train the classification model, where <bold>1</bold><sub>[.]</sub> denote the indicative function, and <italic>n<sup>r<sub>i</sub></sup></italic> is the number of cells in <italic>i</italic>-th reference dataset.</p><p id="P22">To enable the embedding component <italic>E<sup>ij</sup></italic> to fully capture the characteristics of cells and make the classification model better fit the query dataset, we employ the embedding component as an encoder and use a mirror image of the embedding component as a decoder to construct an autoencoder. The reconstruction loss of cells both from the reference subset and the query subset is taken into consideration when training the classification model. Let <italic>D<sup>ij</sup></italic> denote the decoder component. The forward propagation results of the autoencoder can be defined as <inline-formula><mml:math id="M5"><mml:msup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mi>D</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>E</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>X</mml:mi><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M6"><mml:msup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mi>D</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>E</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>X</mml:mi><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>, where <inline-formula><mml:math id="M7"><mml:msup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula> and <inline-formula><mml:math id="M8"><mml:msup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula> denote the reconstruction of <italic>X<sup>r<sub>ij</sub></sup></italic> and <italic>X<sup>q<sub>ij</sub></sup></italic> separately. The reconstruction loss is measured by the mean squared error, which can be formulated as <disp-formula id="FD2"><label>(2)</label><mml:math id="M9"><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msup><mml:mi>n</mml:mi><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msup><mml:msup><mml:mi>p</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:msubsup><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mi>X</mml:mi><mml:mrow><mml:msub><mml:mi>r</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mo>‖</mml:mo></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msup><mml:mi>n</mml:mi><mml:mi>q</mml:mi></mml:msup><mml:msup><mml:mi>p</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfrac><mml:msubsup><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:msup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mo>−</mml:mo><mml:msup><mml:mi>X</mml:mi><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mo>‖</mml:mo></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo></mml:math></disp-formula> where <italic>p<sup>ij</sup></italic> represents the number of genes in this dataset pair, and ||·||<sub><italic>F</italic></sub> denote the Frobenius norm of a matrix.</p><p id="P23">Therefore, the final optimization problem for training the classification model for dataset pair (<italic>X<sup>r<sub>ij</sub></sup>, Y<sup>r<sub>i</sub></sup>, X<sup>q<sub>ij</sub></sup></italic>) can be written as <disp-formula id="FD3"><label>(3)</label><mml:math id="M10"><mml:munder><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:msup><mml:mi>E</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>D</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub></mml:mrow></mml:munder><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>λ</mml:mi><mml:msub><mml:mi>ℒ</mml:mi><mml:mrow><mml:mi>r</mml:mi><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math></disp-formula> where λ is the tuning parameter and the default value is 1. Details of the neural network architecture, hyperparameter settings, and initialization can be found in S1 Text. For all the reference-query pairs, we can have 8<italic>M</italic> base classification models denoted by {(<italic>E<sup>ij</sup>,C<sup>ij</sup></italic>)}<sub><italic>i</italic>=1,…,<italic>M</italic>,<italic>j</italic>=1,…,8</sub>.</p></sec><sec id="S12"><label>Module III</label><title>Query dataset annotation</title><p id="P24">Based on one base classification model (<italic>E<sup>ij</sup>, C<sup>ij</sup></italic>), we take the corresponding query subset <italic>X<sup>q<sub>ij</sub></sup></italic> as input. The forward propagation result along the model after softmax transformation can be formulated as <inline-formula><mml:math id="M11"><mml:msup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi>s</mml:mi><mml:mi>o</mml:mi><mml:mi>f</mml:mi><mml:mi>t</mml:mi><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>C</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>E</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>X</mml:mi><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>. The (<italic>c, k</italic>)-th element of <inline-formula><mml:math id="M12"><mml:msup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula> can be regarded as the predicted probability of cell <italic>c</italic> in the query dataset belonging to cell type <italic>k</italic>. For each cell in the query dataset, we obtain <italic>q<sub>ij</sub></italic>-th base prediction label <inline-formula><mml:math id="M13"><mml:msup><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula> according to <inline-formula><mml:math id="M14"><mml:msup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup></mml:math></inline-formula>. For cell <italic>c</italic>, <disp-formula id="FD4"><label>(4)</label><mml:math id="M15"><mml:msubsup><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>c</mml:mi><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>arg</mml:mi><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:munder><mml:msubsup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>c</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mo>.</mml:mo></mml:math></disp-formula></p><p id="P25">Then, based on the majority voting principle we integrate all these predictions for consensus annotation, denoted by <inline-formula><mml:math id="M16"><mml:msup><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>q</mml:mi></mml:msup></mml:math></inline-formula>. For cell <italic>c</italic>, we calculate <disp-formula id="FD5"><label>(5)</label><mml:math id="M17"><mml:msubsup><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>c</mml:mi><mml:mi>q</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>arg</mml:mi><mml:mi>max</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>M</mml:mi></mml:msubsup><mml:mrow><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mn>8</mml:mn></mml:msubsup><mml:mrow><mml:msub><mml:mstyle mathvariant="bold"><mml:mn>1</mml:mn></mml:mstyle><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>c</mml:mi><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow></mml:mstyle></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math></disp-formula> where <inline-formula><mml:math id="M18"><mml:mi>L</mml:mi><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mi>K</mml:mi></mml:msup></mml:math></inline-formula>, and <italic>L<sub>k</sub></italic> indicates the number of reference subsets which contain cells belong to cell type <italic>k</italic>. The numerator represents the number of times that cell <italic>c</italic> is predicted to belong to cell type <italic>k</italic> across all base predictions and the denominator represents the number of reference subsets containing cell type <italic>k</italic>. The role of the denominator is to handle the situation where a cell is predicted as a single-reference-specific cell type and indeed belongs to that cell type in the query dataset. It is worth stating that the setting of the denominator increases the prediction probability of the single-reference-specific cell type, making full use of the diversity of the reference datasets. Details of the integration can be found in S1 Text.</p></sec><sec id="S13"><label>Module IV</label><title>Metrics for unseen cell identification</title><p id="P26">Since there is no training data in reference datasets for the unseen cell types, the predictions for the cells belonging to these cell types can be more uncertain. We define the uncertainty from two perspectives based on the outputs of all the classification models, including the intra-model perspective and inter-model perspective. For the former, no one cell type dominates the probability when making predictions based on a single classification model. For the latter, there is a large inconsistency among the predictions obtained by different classification models. Therefore, we design three entropy-based measures, denoted by <italic>m</italic><sup>(1)</sup>, <italic>m</italic><sup>(2)</sup> and <italic>m</italic><sup>(3)</sup>, to quantitatively characterize the uncertainty, where <italic>m</italic><sup>(1)</sup> is from the intra-model perspective, and <italic>m</italic><sup>(2)</sup> and <italic>m</italic><sup>(3)</sup> are from the inter-model perspective.</p><sec id="S14"><title>Intra-model measurement from each single classification model</title><p id="P27">The first metric <italic>m</italic><sup>(1)</sup> calculates the entropy of the probability that a cell belongs to different cell types by each classification model, and then averages these entropy values as a final uncertainty measure. Higher <italic>m</italic><sup>(1)</sup> indicates higher uncertainty. For cell <italic>c</italic>, this metric is defined as <disp-formula id="FD6"><label>(6)</label><mml:math id="M19"><mml:msubsup><mml:mi>m</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mn>8</mml:mn><mml:mi>M</mml:mi></mml:mrow></mml:mfrac><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:munder><mml:mi>H</mml:mi></mml:mstyle><mml:mtext>,</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>c</mml:mi><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>H</italic>(·) represents the function to compute an entropy and is defined as <inline-formula><mml:math id="M20"><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>c</mml:mi><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>∈</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>c</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle><mml:msub><mml:mi>log</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>c</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>. The larger <inline-formula><mml:math id="M21"><mml:msubsup><mml:mi>m</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> is, the more uncertain the predictions is, and thus the more likely the cell <italic>c</italic> is of unseen cell types.</p></sec><sec id="S15"><title>Inter-model measurement from the overall output of classification models</title><p id="P28">The second measure <italic>m</italic><sup>(2)</sup> characterizes uncertainty from the inter-model perspective by first averaging the prediction probabilities of all classification models and then calculating the entropy. We compute the average of prediction probabilities <italic>Q</italic><sup>(2)</sup> as <disp-formula id="FD7"><label>(7)</label><mml:math id="M22"><mml:msubsup><mml:mi>Q</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>P</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:mi>c</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math></disp-formula> where <inline-formula><mml:math id="M23"><mml:msubsup><mml:mi>Q</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> represents the average of the prediction probability that cell <italic>c</italic> belongs to cell type <italic>k</italic> across all classification models. Then, <italic>Q</italic><sup>(2)</sup> is transformed into a probability matrix <inline-formula><mml:math id="M24"><mml:msup><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> by dividing each value by the row sum. If the different base prediction labels for cell <italic>c</italic> are inconsistent, no one cell type dominates the probability in <inline-formula><mml:math id="M25"><mml:msup><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula>. Therefore, we define <italic>m</italic><sup>(2)</sup> as the entropy of the average of the prediction probability to characterize inconsistency. For cell <italic>c</italic>, it is defined as <disp-formula id="FD8"><label>(8)</label><mml:math id="M26"><mml:msubsup><mml:mi>m</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:math></disp-formula></p><p id="P29">The larger <inline-formula><mml:math id="M27"><mml:msubsup><mml:mi>m</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> indicates less consistent predictions, and thus cell <italic>c</italic> is more likely to be of an unseen cell type.</p></sec><sec id="S16"><title>Inter-model measurement from the overall hard-assignment labels</title><p id="P30">The third measure <italic>m</italic><sup>(3)</sup> is similar to <italic>m</italic><sup>(2)</sup>. The difference is that it integrates the hard-assignment labels of all classification models rather than the prediction probabilities. Let <italic>Q</italic><sup>(3)</sup> denotes the integration result for this measure. The (<italic>c, k</italic>)-th element of <italic>Q</italic><sup>(3)</sup> is defined as <disp-formula id="FD9"><label>(9)</label><mml:math id="M28"><mml:msubsup><mml:mi>Q</mml:mi><mml:mrow><mml:mi>c</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mn>1</mml:mn><mml:mrow><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>Y</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>c</mml:mi><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:mstyle></mml:mrow><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:math></disp-formula></p><p id="P31">Then, as before, we transform <italic>Q</italic><sup>(3)</sup> into a probability matrix <inline-formula><mml:math id="M29"><mml:msup><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> by dividing each value by the row sum. If the hard-assignment labels for cell <italic>c</italic> are inconsistent, then none of cell types dominate the row <italic>c</italic> of <inline-formula><mml:math id="M30"><mml:msup><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula>. Similarly, we calculate the entropy to define <italic>m</italic><sup>(3)</sup>, i.e., for cell <italic>c</italic>, <disp-formula id="FD10"><label>(10)</label><mml:math id="M31"><mml:msubsup><mml:mi>m</mml:mi><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>H</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:math></disp-formula></p><p id="P32">After obtaining the three complementary metrics, <italic>m</italic><sup>(1)</sup>, <italic>m</italic><sup>(2)</sup> and <italic>m</italic><sup>(3)</sup>, the values are scaled to [0, 1] linearly through Min-Max scaling separately, denoted by <inline-formula><mml:math id="M32"><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula>, <inline-formula><mml:math id="M33"><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula> and<inline-formula><mml:math id="M34"><mml:msup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:math></inline-formula>. The ensemble uncertainty measure m is defined as the average of these three measures for each cell, i.e., for cell <italic>c</italic>, <disp-formula id="FD11"><label>(11)</label><mml:math id="M35"><mml:msub><mml:mi>m</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msubsup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>m</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mi>c</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mn>3</mml:mn></mml:mfrac><mml:mo>.</mml:mo></mml:math></disp-formula></p><p id="P33">Generally, a larger value of <italic>m<sub>c</sub></italic> indicates a higher probability that cell <italic>c</italic> belongs to an unseen cell type. Details of the calculation of each measurement can be found in S1 Text.</p></sec></sec><sec id="S17"><label>Module V</label><title>Data-driven method for default threshold selection</title><p id="P34">Determining the threshold to distinguish cells belonging to unseen cell types remains subjective in previous studies, and a method to automatically determine the exact threshold is required. Instead of using a fixed value as a threshold as in previous studies, we provide a new method to automatically identify cells with higher uncertainty. We first fit a Gaussian mixture model to the uncertainty metric <italic>m</italic> with the number of mixture components <italic>S</italic> set to 1, 2,…, 5 and determined according to the Akaike information criterion (AIC). If the suitable value of S determined by AIC is 1, we consider that no cells are assigned as “unassigned”. Otherwise, all the cells are divided into different groups according to the posterior probability of the estimated Gaussian mixture model, and then the mean of the metric m of cells within each group is calculated. If there are groups with a mean greater than or equal to 0.6, these groups are considered to be uncertain groups. Meanwhile, the group with the largest mean is considered to be the uncertain group. All the cells in the uncertain groups are annotated as “unassigned”.</p></sec><sec id="S18"><title>Datasets</title><p id="P35">We use two collections of publicly available scRNA-seq datasets and a study of COVID-19 patients (<xref ref-type="supplementary-material" rid="SD1">S3 Table-S4 Table</xref>) varying from tissues (peripheral blood mononuclear cells (PBMC) and Pancreas), cell populations and sequencing technologies to benchmark mtANN and other methods.</p><p id="P36">The PBMC collection, including seven datasets curated from Butler et al. [<xref ref-type="bibr" rid="R43">43</xref>], are sequenced by Cel-seq, Drops, inDrop, Seq-Well, Smart-seq2, 10X v2, and 10X v3. The datasets are downloaded from <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.5281/zenodo.3357167">https://doi.org/10.5281/zenodo.3357167</ext-link> [<xref ref-type="bibr" rid="R20">20</xref>]. The Pancreas collection, including four datasets curated from Baron et al. [<xref ref-type="bibr" rid="R30">30</xref>], Muraro et al. [<xref ref-type="bibr" rid="R31">31</xref>], Segerstolpe et al. [<xref ref-type="bibr" rid="R32">32</xref>], and Xin et al. [<xref ref-type="bibr" rid="R33">33</xref>], are sequenced by inDrop, Cel-seq2, Smart-seq2, and SMARTer. We obtain all the datasets from <ext-link ext-link-type="uri" xlink:href="https://hemberg-lab.github.io/scRNA.seq.datasets/human/Pancreas/">https://hemberg-lab.github.io/scRNA.seq.datasets/human/Pancreas/</ext-link>. Following the study of scClassify [<xref ref-type="bibr" rid="R23">23</xref>], we manually check the cell-type labels that are provided by the original authors of each dataset and remove the cell types that are labeled as “unclear” in the Muraro dataset, “co-expression”, “not applicable”, “unclassified” and “unclassified endocrine” in Segerstolpe dataset, and “alpha.contaminated”, “beta.contaminated”, “delta.contaminated” and “gamma.contaminated” in Xin dataset.</p><p id="P37">The study of COVID-19 [<xref ref-type="bibr" rid="R34">34</xref>] provides a scRNA-seq atlas including 284 samples from PBMC, bronchoalveolar lavage fluid (BALF), sputum, and pleural fluid mononuclear cells (PFMCs) which is available at GEO database: GSE158055. In this study, we only take 249 of these samples from PBMC. We manually renamed CD8+ T cells to Cytotoxic T cells to be consistent with the previous PBMC collection.</p><p id="P38">For the PBMC and Pancreas data collections, we first remove cell types with less than 10 cells, then genes expressed in less than 100 cells are removed, and cells expressing less than 100 genes are later removed. These datasets are selected to be either the reference or the query datasets in the following experiments. For details about the reference and query datasets used in the benchmark tests, please refer to <xref ref-type="supplementary-material" rid="SD1">S5 Table-S6 Table</xref>.</p></sec><sec id="S19"><title>Data preprocessing</title><p id="P39">For each scRNA-seq dataset, preprocessing consists of four steps. Firstly, the library size normalization is performed, i.e., dividing the expression of each gene in a cell by the total expression of the cell and then multiplying it by a scale factor of 10000 in order to make the total expression values of all cells after being transformed the same. Secondly, logarithmic transformation is applied to the dataset to make each expression value <italic>x</italic> be log<sub>2</sub> (<italic>x</italic> + 1). Thirdly, z-score standardization is performed for each gene so that the mean of each gene on all cells is equal to 0 and the standard deviation of each gene is equal to 1. Lastly, the expression values of each gene are scaled to [0, 1] linearly through Min-Max scaling. It is worth noting that the first step is applied to the raw datasets, while the last three steps are applied to the datasets after gene selection.</p></sec></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplemental information</label><media xlink:href="EMS157366-supplement-Supplemental_information.zip" mimetype="application" mime-subtype="zip" id="d21aAdEbB" position="anchor"/></supplementary-material><supplementary-material content-type="local-data" id="SD2"><label>Supporting information Caption</label><media xlink:href="EMS157366-supplement-Supporting_information_Caption.pdf" mimetype="application" mime-subtype="pdf" id="d21aAdEcB" position="anchor"/></supplementary-material></sec></body><back><ack id="S20"><title>Acknowledgments</title><p>We acknowledge all members of the Xiao-Fei Zhang laboratory for helpful suggestions.</p></ack><fn-group><fn id="FN1" fn-type="con"><p id="P40"><bold>Author Contributions</bold></p><p id="P41">Conceptualization: Yi-Xuan Xiong, Luonan Chen, Xiao-Fei Zhang.</p><p id="P42">Data curation: Yi-Xuan Xiong, Meng-Guo Wang.</p><p id="P43">Formal analysis: Yi-Xuan Xiong.</p><p id="P44">Funding acquisition: Luonan Chen, Xiao-Fei Zhang. Investigation: Meng-Guo Wang, Xiao-Fei Zhang.</p><p id="P45">Methodology: Yi-Xuan Xiong, Xiao-Fei Zhang. Software: Yi-Xuan Xiong, Meng-Guo Wang.</p><p id="P46">Supervision: Luonan Chen, Xiao-Fei Zhang. Visualization: Yi-Xuan Xiong.</p><p id="P47">Writing - original draft: Yi-Xuan Xiong.</p><p id="P48">Writing - review &amp; editing: Yi-Xuan Xiong, Luonan Chen, Xiao-Fei Zhang.</p></fn></fn-group><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lähnemann</surname><given-names>D</given-names></name><name><surname>Köster</surname><given-names>J</given-names></name><name><surname>Szczurek</surname><given-names>E</given-names></name><name><surname>McCarthy</surname><given-names>DJ</given-names></name><name><surname>Hicks</surname><given-names>SC</given-names></name><name><surname>Robinson</surname><given-names>MD</given-names></name><etal/></person-group><article-title>Eleven grand challenges in single-cell data science</article-title><source>Genome Biol</source><year>2020</year><volume>21</volume><issue>1</issue><fpage>1</fpage><lpage>35</lpage><pub-id pub-id-type="pmcid">PMC7007675</pub-id><pub-id pub-id-type="pmid">32033589</pub-id><pub-id pub-id-type="doi">10.1186/s13059-020-1926-6</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>PH</given-names></name><name><surname>Kong</surname><given-names>XY</given-names></name><name><surname>He</surname><given-names>YZ</given-names></name><name><surname>Liu</surname><given-names>Y</given-names></name><name><surname>Peng</surname><given-names>X</given-names></name><name><surname>Li</surname><given-names>ZH</given-names></name><etal/></person-group><article-title>Recent developments in application of single-cell RNA sequencing in the tumour immune microenvironment and cancer therapy</article-title><source>Mil Med Res</source><year>2022</year><volume>9</volume><issue>1</issue><fpage>1</fpage><lpage>19</lpage><pub-id pub-id-type="pmcid">PMC9511789</pub-id><pub-id pub-id-type="pmid">36154923</pub-id><pub-id pub-id-type="doi">10.1186/s40779-022-00414-y</pub-id></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dhapola</surname><given-names>P</given-names></name><name><surname>Rodhe</surname><given-names>J</given-names></name><name><surname>Olofzon</surname><given-names>R</given-names></name><name><surname>Bonald</surname><given-names>T</given-names></name><name><surname>Erlandsson</surname><given-names>E</given-names></name><name><surname>Soneji</surname><given-names>S</given-names></name><etal/></person-group><article-title>Scarf enables a highly memory-efficient analysis of large-scale single-cell genomics data</article-title><source>Nat Commun</source><year>2022</year><volume>13</volume><issue>1</issue><fpage>1</fpage><lpage>14</lpage><pub-id pub-id-type="pmcid">PMC9360040</pub-id><pub-id pub-id-type="pmid">35941103</pub-id><pub-id pub-id-type="doi">10.1038/s41467-022-32097-3</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kiselev</surname><given-names>VY</given-names></name><name><surname>Kirschner</surname><given-names>K</given-names></name><name><surname>Schaub</surname><given-names>MT</given-names></name><name><surname>Andrews</surname><given-names>T</given-names></name><name><surname>Yiu</surname><given-names>A</given-names></name><name><surname>Chandra</surname><given-names>T</given-names></name><etal/></person-group><article-title>SC3: consensus clustering of single-cell RNA-seq data</article-title><source>Nat Methods</source><year>2017</year><volume>14</volume><issue>5</issue><fpage>483</fpage><lpage>486</lpage><pub-id pub-id-type="pmcid">PMC5410170</pub-id><pub-id pub-id-type="pmid">28346451</pub-id><pub-id pub-id-type="doi">10.1038/nmeth.4236</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>B</given-names></name><name><surname>Zhu</surname><given-names>J</given-names></name><name><surname>Pierson</surname><given-names>E</given-names></name><name><surname>Ramazzotti</surname><given-names>D</given-names></name><name><surname>Batzoglou</surname><given-names>S</given-names></name></person-group><article-title>Visualization and analysis of single-cell RNA-seq data by kernel-based similarity learning</article-title><source>Nat Methods</source><year>2017</year><volume>14</volume><issue>4</issue><fpage>414</fpage><lpage>416</lpage><pub-id pub-id-type="pmid">28263960</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Brbić</surname><given-names>M</given-names></name><name><surname>Zitnik</surname><given-names>M</given-names></name><name><surname>Wang</surname><given-names>S</given-names></name><name><surname>Pisco</surname><given-names>AO</given-names></name><name><surname>Altman</surname><given-names>RB</given-names></name><name><surname>Darmanis</surname><given-names>S</given-names></name><etal/></person-group><article-title>MARS: discovering novel cell types across heterogeneous single-cell experiments</article-title><source>Nat Methods</source><year>2020</year><volume>17</volume><issue>12</issue><fpage>1200</fpage><lpage>1206</lpage><pub-id pub-id-type="pmid">33077966</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Shao</surname><given-names>X</given-names></name><name><surname>Liao</surname><given-names>J</given-names></name><name><surname>Lu</surname><given-names>X</given-names></name><name><surname>Xue</surname><given-names>R</given-names></name><name><surname>Ai</surname><given-names>N</given-names></name><name><surname>Fan</surname><given-names>X</given-names></name></person-group><article-title>scCATCH: automatic annotation on cell types of clusters from single-cell RNA sequencing data</article-title><source>Iscience</source><year>2020</year><volume>23</volume><issue>3</issue><elocation-id>100882</elocation-id><pub-id pub-id-type="pmcid">PMC7031312</pub-id><pub-id pub-id-type="pmid">32062421</pub-id><pub-id pub-id-type="doi">10.1016/j.isci.2020.100882</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liang</surname><given-names>Z</given-names></name><name><surname>Li</surname><given-names>M</given-names></name><name><surname>Zheng</surname><given-names>R</given-names></name><name><surname>Tian</surname><given-names>Y</given-names></name><name><surname>Yan</surname><given-names>X</given-names></name><name><surname>Chen</surname><given-names>J</given-names></name><etal/></person-group><article-title>SSRE: cell type detection based on sparse subspace representation and similarity enhancement</article-title><source>Genomics, proteomics &amp; bioinformatics</source><year>2021</year><volume>19</volume><issue>2</issue><fpage>282</fpage><lpage>291</lpage><pub-id pub-id-type="pmcid">PMC8602764</pub-id><pub-id pub-id-type="pmid">33647482</pub-id><pub-id pub-id-type="doi">10.1016/j.gpb.2020.09.004</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Miao</surname><given-names>Z</given-names></name><name><surname>Moreno</surname><given-names>P</given-names></name><name><surname>Huang</surname><given-names>N</given-names></name><name><surname>Papatheodorou</surname><given-names>I</given-names></name><name><surname>Brazma</surname><given-names>A</given-names></name><name><surname>Teichmann</surname><given-names>SA</given-names></name></person-group><article-title>Putative cell type discovery from single-cell gene expression data</article-title><source>Nat Methods</source><year>2020</year><volume>17</volume><issue>6</issue><fpage>621</fpage><lpage>628</lpage><pub-id pub-id-type="pmid">32424270</pub-id></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kiselev</surname><given-names>VY</given-names></name><name><surname>Andrews</surname><given-names>TS</given-names></name><name><surname>Hemberg</surname><given-names>M</given-names></name></person-group><article-title>Challenges in unsupervised clustering of single-cell RNA-seq data</article-title><source>Nat Rev Genet</source><year>2019</year><volume>20</volume><issue>5</issue><fpage>273</fpage><lpage>282</lpage><pub-id pub-id-type="pmid">30617341</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kiselev</surname><given-names>VY</given-names></name><name><surname>Yiu</surname><given-names>A</given-names></name><name><surname>Hemberg</surname><given-names>M</given-names></name></person-group><article-title>scmap: projection of single-cell RNA-seq data across data sets</article-title><source>Nat Methods</source><year>2018</year><volume>15</volume><issue>5</issue><fpage>359</fpage><lpage>362</lpage><pub-id pub-id-type="pmid">29608555</pub-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stuart</surname><given-names>T</given-names></name><name><surname>Butler</surname><given-names>A</given-names></name><name><surname>Hoffman</surname><given-names>P</given-names></name><name><surname>Hafemeister</surname><given-names>C</given-names></name><name><surname>Papalexi</surname><given-names>E</given-names></name><name><surname>Mauck</surname><given-names>WM</given-names><suffix>III</suffix></name><etal/></person-group><article-title>Comprehensive integration of single-cell data</article-title><source>Cell</source><year>2019</year><volume>177</volume><issue>7</issue><fpage>1888</fpage><lpage>1902</lpage><pub-id pub-id-type="pmcid">PMC6687398</pub-id><pub-id pub-id-type="pmid">31178118</pub-id><pub-id pub-id-type="doi">10.1016/j.cell.2019.05.031</pub-id></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Aran</surname><given-names>D</given-names></name><name><surname>Looney</surname><given-names>AP</given-names></name><name><surname>Liu</surname><given-names>L</given-names></name><name><surname>Wu</surname><given-names>E</given-names></name><name><surname>Fong</surname><given-names>V</given-names></name><name><surname>Hsu</surname><given-names>A</given-names></name><etal/></person-group><article-title>Reference-based analysis of lung single-cell sequencing reveals a transitional profibrotic macrophage</article-title><source>Nat Immunol</source><year>2019</year><volume>20</volume><issue>2</issue><fpage>163</fpage><lpage>172</lpage><pub-id pub-id-type="pmcid">PMC6340744</pub-id><pub-id pub-id-type="pmid">30643263</pub-id><pub-id pub-id-type="doi">10.1038/s41590-018-0276-y</pub-id></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>De Kanter</surname><given-names>JK</given-names></name><name><surname>Lijnzaad</surname><given-names>P</given-names></name><name><surname>Candelli</surname><given-names>T</given-names></name><name><surname>Margaritis</surname><given-names>T</given-names></name><name><surname>Holstege</surname><given-names>FC</given-names></name></person-group><article-title>CHETAH: a selective, hierarchical cell type identification method for single-cell RNA sequencing</article-title><source>Nucleic Acids Res</source><year>2019</year><volume>47</volume><issue>16</issue><fpage>e95</fpage><pub-id pub-id-type="pmcid">PMC6895264</pub-id><pub-id pub-id-type="pmid">31226206</pub-id><pub-id pub-id-type="doi">10.1093/nar/gkz543</pub-id></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hu</surname><given-names>J</given-names></name><name><surname>Li</surname><given-names>X</given-names></name><name><surname>Hu</surname><given-names>G</given-names></name><name><surname>Lyu</surname><given-names>Y</given-names></name><name><surname>Susztak</surname><given-names>K</given-names></name><name><surname>Li</surname><given-names>M</given-names></name></person-group><article-title>Iterative transfer learning with neural network for clustering and cell type classification in single-cell RNA-seq analysis</article-title><source>Nat Mach Intell</source><year>2020</year><volume>2</volume><issue>10</issue><fpage>607</fpage><lpage>618</lpage><pub-id pub-id-type="pmcid">PMC8009055</pub-id><pub-id pub-id-type="pmid">33817554</pub-id><pub-id pub-id-type="doi">10.1038/s42256-020-00233-7</pub-id></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Song</surname><given-names>Q</given-names></name><name><surname>Su</surname><given-names>J</given-names></name><name><surname>Zhang</surname><given-names>W</given-names></name></person-group><article-title>scGCN is a graph convolutional networks algorithm for knowledge transfer in single cell omics</article-title><source>Nat Commun</source><year>2021</year><volume>12</volume><issue>1</issue><fpage>1</fpage><lpage>11</lpage><pub-id pub-id-type="pmcid">PMC8219725</pub-id><pub-id pub-id-type="pmid">34158507</pub-id><pub-id pub-id-type="doi">10.1038/s41467-021-24172-y</pub-id></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xu</surname><given-names>C</given-names></name><name><surname>Lopez</surname><given-names>R</given-names></name><name><surname>Mehlman</surname><given-names>E</given-names></name><name><surname>Regier</surname><given-names>J</given-names></name><name><surname>Jordan</surname><given-names>MI</given-names></name><name><surname>Yosef</surname><given-names>N</given-names></name></person-group><article-title>Probabilistic harmonization and annotation of single-cell transcriptomics data with deep generative models</article-title><source>Mol Syst Biol</source><year>2021</year><volume>17</volume><issue>1</issue><fpage>e9620</fpage><pub-id pub-id-type="pmcid">PMC7829634</pub-id><pub-id pub-id-type="pmid">33491336</pub-id><pub-id pub-id-type="doi">10.15252/msb.20209620</pub-id></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Alquicira-Hernandez</surname><given-names>J</given-names></name><name><surname>Sathe</surname><given-names>A</given-names></name><name><surname>Ji</surname><given-names>HP</given-names></name><name><surname>Nguyen</surname><given-names>Q</given-names></name><name><surname>Powell</surname><given-names>JE</given-names></name></person-group><article-title>scPred: accurate supervised method for cell-type classification from single-cell RNA-seq data</article-title><source>Genome Biol</source><year>2019</year><volume>20</volume><issue>1</issue><fpage>1</fpage><lpage>17</lpage><pub-id pub-id-type="pmcid">PMC6907144</pub-id><pub-id pub-id-type="pmid">31829268</pub-id><pub-id pub-id-type="doi">10.1186/s13059-019-1862-5</pub-id></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ma</surname><given-names>F</given-names></name><name><surname>Pellegrini</surname><given-names>M</given-names></name></person-group><article-title>ACTINN: automated identification of cell types in single cell RNA sequencing</article-title><source>Bioinformatics</source><year>2020</year><volume>36</volume><issue>2</issue><fpage>533</fpage><lpage>538</lpage><pub-id pub-id-type="pmid">31359028</pub-id></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Abdelaal</surname><given-names>T</given-names></name><name><surname>Michielsen</surname><given-names>L</given-names></name><name><surname>Cats</surname><given-names>D</given-names></name><name><surname>Hoogduin</surname><given-names>D</given-names></name><name><surname>Mei</surname><given-names>H</given-names></name><name><surname>Reinders</surname><given-names>MJ</given-names></name><etal/></person-group><article-title>A comparison of automatic cell identification methods for single-cell RNA sequencing data</article-title><source>Genome Biol</source><year>2019</year><volume>20</volume><issue>1</issue><fpage>1</fpage><lpage>19</lpage><pub-id pub-id-type="pmcid">PMC6734286</pub-id><pub-id pub-id-type="pmid">31500660</pub-id><pub-id pub-id-type="doi">10.1186/s13059-019-1795-z</pub-id></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xie</surname><given-names>B</given-names></name><name><surname>Jiang</surname><given-names>Q</given-names></name><name><surname>Mora</surname><given-names>A</given-names></name><name><surname>Li</surname><given-names>X</given-names></name></person-group><article-title>Automatic cell type identification methods for single-cell RNA sequencing</article-title><source>Comput Struct Biotechnol J</source><year>2021</year><volume>19</volume><fpage>5874</fpage><lpage>5887</lpage><pub-id pub-id-type="pmcid">PMC8572862</pub-id><pub-id pub-id-type="pmid">34815832</pub-id><pub-id pub-id-type="doi">10.1016/j.csbj.2021.10.027</pub-id></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Duan</surname><given-names>B</given-names></name><name><surname>Chen</surname><given-names>S</given-names></name><name><surname>Chen</surname><given-names>X</given-names></name><name><surname>Zhu</surname><given-names>C</given-names></name><name><surname>Tang</surname><given-names>C</given-names></name><name><surname>Wang</surname><given-names>S</given-names></name><etal/></person-group><article-title>Integrating multiple references for single-cell assignment</article-title><source>Nucleic Acids Res</source><year>2021</year><volume>49</volume><issue>14</issue><fpage>e80</fpage><pub-id pub-id-type="pmcid">PMC8373058</pub-id><pub-id pub-id-type="pmid">34037791</pub-id><pub-id pub-id-type="doi">10.1093/nar/gkab380</pub-id></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lin</surname><given-names>Y</given-names></name><name><surname>Cao</surname><given-names>Y</given-names></name><name><surname>Kim</surname><given-names>HJ</given-names></name><name><surname>Salim</surname><given-names>A</given-names></name><name><surname>Speed</surname><given-names>TP</given-names></name><name><surname>Lin</surname><given-names>DM</given-names></name><etal/></person-group><article-title>scClassify: sample size estimation and multiscale classification of cells using single and multiple reference</article-title><source>Mol Syst Biol</source><year>2020</year><volume>16</volume><issue>6</issue><fpage>e9389</fpage><pub-id pub-id-type="pmcid">PMC7306901</pub-id><pub-id pub-id-type="pmid">32567229</pub-id><pub-id pub-id-type="doi">10.15252/msb.20199389</pub-id></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>X</given-names></name><name><surname>Chen</surname><given-names>S</given-names></name><name><surname>Jiang</surname><given-names>R</given-names></name></person-group><article-title>EnClaSC: a novel ensemble approach for accurate and robust cell-type classification of single-cell transcriptomes</article-title><source>BMC bioinformatics</source><year>2020</year><volume>21</volume><issue>13</issue><fpage>1</fpage><lpage>16</lpage><pub-id pub-id-type="pmcid">PMC7496207</pub-id><pub-id pub-id-type="pmid">32938367</pub-id><pub-id pub-id-type="doi">10.1186/s12859-020-03679-z</pub-id></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yin</surname><given-names>Q</given-names></name><name><surname>Wang</surname><given-names>Y</given-names></name><name><surname>Guan</surname><given-names>J</given-names></name><name><surname>Ji</surname><given-names>G</given-names></name></person-group><article-title>scIAE: an integrative autoencoder-based ensemble classification framework for single-cell RNA-seq data</article-title><source>Brief Bioinformatics</source><year>2022</year><volume>23</volume><issue>1</issue><elocation-id>bbab508</elocation-id><pub-id pub-id-type="pmid">34913057</pub-id></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Liu</surname><given-names>Y</given-names></name><name><surname>Yan</surname><given-names>H</given-names></name><name><surname>Shen</surname><given-names>LC</given-names></name><name><surname>Yu</surname><given-names>DJ</given-names></name></person-group><article-title>Learning Cell Annotation under Multiple Reference Datasets by Multisource Domain Adaptation</article-title><source>J Chem Inf Model</source><year>2022</year><pub-id pub-id-type="pmid">36579851</pub-id></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>M</surname><given-names>Y</given-names></name><name><surname>L</surname><given-names>C</given-names></name><name><surname>M</surname><given-names>D</given-names></name></person-group><article-title>scMRA: a robust deep learning method to annotate scRNA-seq data with multiple reference datasets</article-title><source>Bioinformatics</source><year>2022</year><volume>38</volume><issue>3</issue><fpage>738</fpage><lpage>745</lpage><pub-id pub-id-type="pmid">34623390</pub-id></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>X</given-names></name><name><surname>Wang</surname><given-names>K</given-names></name><name><surname>Lyu</surname><given-names>Y</given-names></name><name><surname>Pan</surname><given-names>H</given-names></name><name><surname>Zhang</surname><given-names>J</given-names></name><name><surname>Stambolian</surname><given-names>D</given-names></name><etal/></person-group><article-title>Deep learning enables accurate clustering with batch effect removal in single-cell RNA-seq analysis</article-title><source>Nat Commun</source><year>2020</year><volume>11</volume><issue>1</issue><fpage>1</fpage><lpage>14</lpage><pub-id pub-id-type="pmcid">PMC7214470</pub-id><pub-id pub-id-type="pmid">32393754</pub-id><pub-id pub-id-type="doi">10.1038/s41467-020-15851-3</pub-id></element-citation></ref><ref id="R29"><label>29</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tran</surname><given-names>HTN</given-names></name><name><surname>Ang</surname><given-names>KS</given-names></name><name><surname>Chevrier</surname><given-names>M</given-names></name><name><surname>Zhang</surname><given-names>X</given-names></name><name><surname>Lee</surname><given-names>NYS</given-names></name><name><surname>Goh</surname><given-names>M</given-names></name><etal/></person-group><article-title>A benchmark of batch-effect correction methods for single-cell RNA sequencing data</article-title><source>Genome Biol</source><year>2020</year><volume>21</volume><issue>1</issue><fpage>1</fpage><lpage>32</lpage><pub-id pub-id-type="pmcid">PMC6964114</pub-id><pub-id pub-id-type="pmid">31948481</pub-id><pub-id pub-id-type="doi">10.1186/s13059-019-1850-9</pub-id></element-citation></ref><ref id="R30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Baron</surname><given-names>M</given-names></name><name><surname>Veres</surname><given-names>A</given-names></name><name><surname>Wolock</surname><given-names>SL</given-names></name><name><surname>Faust</surname><given-names>AL</given-names></name><name><surname>Gaujoux</surname><given-names>R</given-names></name><name><surname>Vetere</surname><given-names>A</given-names></name><etal/></person-group><article-title>A single-cell transcriptomic map of the human and mouse pancreas reveals inter-and intra-cell population structure</article-title><source>Cell Syst</source><year>2016</year><volume>3</volume><issue>4</issue><fpage>346</fpage><lpage>360</lpage><pub-id pub-id-type="pmcid">PMC5228327</pub-id><pub-id pub-id-type="pmid">27667365</pub-id><pub-id pub-id-type="doi">10.1016/j.cels.2016.08.011</pub-id></element-citation></ref><ref id="R31"><label>31</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Muraro</surname><given-names>MJ</given-names></name><name><surname>Dharmadhikari</surname><given-names>G</given-names></name><name><surname>Grün</surname><given-names>D</given-names></name><name><surname>Groen</surname><given-names>N</given-names></name><name><surname>Dielen</surname><given-names>T</given-names></name><name><surname>Jansen</surname><given-names>E</given-names></name><etal/></person-group><article-title>A single-cell transcriptome atlas of the human pancreas</article-title><source>Cell Syst</source><year>2016</year><volume>3</volume><issue>4</issue><fpage>385</fpage><lpage>394</lpage><pub-id pub-id-type="pmcid">PMC5092539</pub-id><pub-id pub-id-type="pmid">27693023</pub-id><pub-id pub-id-type="doi">10.1016/j.cels.2016.09.002</pub-id></element-citation></ref><ref id="R32"><label>32</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Segerstolpe</surname><given-names>Å</given-names></name><name><surname>Palasantza</surname><given-names>A</given-names></name><name><surname>Eliasson</surname><given-names>P</given-names></name><name><surname>Andersson</surname><given-names>EM</given-names></name><name><surname>Andréasson</surname><given-names>AC</given-names></name><name><surname>Sun</surname><given-names>X</given-names></name><etal/></person-group><article-title>Single-cell transcriptome profiling of human pancreatic islets in health and type 2 diabetes</article-title><source>Cell Metabolism</source><year>2016</year><volume>24</volume><issue>4</issue><fpage>593</fpage><lpage>607</lpage><pub-id pub-id-type="pmcid">PMC5069352</pub-id><pub-id pub-id-type="pmid">27667667</pub-id><pub-id pub-id-type="doi">10.1016/j.cmet.2016.08.020</pub-id></element-citation></ref><ref id="R33"><label>33</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Xin</surname><given-names>Y</given-names></name><name><surname>Kim</surname><given-names>J</given-names></name><name><surname>Okamoto</surname><given-names>H</given-names></name><name><surname>Ni</surname><given-names>M</given-names></name><name><surname>Wei</surname><given-names>Y</given-names></name><name><surname>Adler</surname><given-names>C</given-names></name><etal/></person-group><article-title>RNA sequencing of single human islet cells reveals type 2 diabetes genes</article-title><source>Cell Metabolism</source><year>2016</year><volume>24</volume><issue>4</issue><fpage>608</fpage><lpage>615</lpage><pub-id pub-id-type="pmid">27667665</pub-id></element-citation></ref><ref id="R34"><label>34</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ren</surname><given-names>X</given-names></name><name><surname>Wen</surname><given-names>W</given-names></name><name><surname>Fan</surname><given-names>X</given-names></name><name><surname>Hou</surname><given-names>W</given-names></name><name><surname>Su</surname><given-names>B</given-names></name><name><surname>Cai</surname><given-names>P</given-names></name><etal/></person-group><article-title>COVID-19 immune features revealed by a large-scale single-cell transcriptome atlas</article-title><source>Cell</source><year>2021</year><volume>184</volume><issue>7</issue><fpage>1895</fpage><lpage>1913</lpage><pub-id pub-id-type="pmcid">PMC7857060</pub-id><pub-id pub-id-type="pmid">33657410</pub-id><pub-id pub-id-type="doi">10.1016/j.cell.2021.01.053</pub-id></element-citation></ref><ref id="R35"><label>35</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>Z</given-names></name><name><surname>John Wherry</surname><given-names>E</given-names></name></person-group><article-title>T cell responses in patients with COVID-19</article-title><source>Nat Rev Immunol</source><year>2020</year><volume>20</volume><issue>9</issue><fpage>529</fpage><lpage>536</lpage><pub-id pub-id-type="pmcid">PMC7389156</pub-id><pub-id pub-id-type="pmid">32728222</pub-id><pub-id pub-id-type="doi">10.1038/s41577-020-0402-6</pub-id></element-citation></ref><ref id="R36"><label>36</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>JTH</given-names></name><name><surname>Hemberg</surname><given-names>M</given-names></name></person-group><article-title>Supervised clustering for single-cell analysis</article-title><source>Nat Methods</source><year>2019</year><volume>16</volume><issue>10</issue><fpage>965</fpage><lpage>966</lpage><pub-id pub-id-type="pmid">31501544</pub-id></element-citation></ref><ref id="R37"><label>37</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ranjan</surname><given-names>B</given-names></name><name><surname>Schmidt</surname><given-names>F</given-names></name><name><surname>Sun</surname><given-names>W</given-names></name><name><surname>Park</surname><given-names>J</given-names></name><name><surname>Honardoost</surname><given-names>MA</given-names></name><name><surname>Tan</surname><given-names>J</given-names></name><etal/></person-group><article-title>scConsensus: combining supervised and unsupervised clustering for cell type identification in single-cell RNA sequencing data</article-title><source>BMC bioinformatics</source><year>2021</year><volume>22</volume><issue>1</issue><fpage>1</fpage><lpage>15</lpage><pub-id pub-id-type="pmcid">PMC8042883</pub-id><pub-id pub-id-type="pmid">33845760</pub-id><pub-id pub-id-type="doi">10.1186/s12859-021-04028-4</pub-id></element-citation></ref><ref id="R38"><label>38</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>Y</given-names></name><name><surname>Zhang</surname><given-names>F</given-names></name><name><surname>Wang</surname><given-names>Z</given-names></name><name><surname>Wu</surname><given-names>S</given-names></name><name><surname>Tian</surname><given-names>W</given-names></name></person-group><article-title>scMAGIC: accurately annotating single cells using two rounds of reference-based classification</article-title><source>Nucleic Acids Res</source><year>2022</year><volume>50</volume><issue>8</issue><fpage>e43</fpage><pub-id pub-id-type="pmcid">PMC9071478</pub-id><pub-id pub-id-type="pmid">34986249</pub-id><pub-id pub-id-type="doi">10.1093/nar/gkab1275</pub-id></element-citation></ref><ref id="R39"><label>39</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>L</given-names></name><name><surname>He</surname><given-names>Q</given-names></name><name><surname>Zhai</surname><given-names>Y</given-names></name><name><surname>Deng</surname><given-names>M</given-names></name></person-group><article-title>Single-cell RNA-seq data semi-supervised clustering and annotation via structural regularized domain adaptation</article-title><source>Bioinformatics</source><year>2021</year><volume>37</volume><issue>6</issue><fpage>775</fpage><lpage>784</lpage><pub-id pub-id-type="pmid">33098418</pub-id></element-citation></ref><ref id="R40"><label>40</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Diehl</surname><given-names>AD</given-names></name><name><surname>Meehan</surname><given-names>TF</given-names></name><name><surname>Bradford</surname><given-names>YM</given-names></name><name><surname>Brush</surname><given-names>MH</given-names></name><name><surname>Dahdul</surname><given-names>WM</given-names></name><name><surname>Dougall</surname><given-names>DS</given-names></name><etal/></person-group><article-title>The Cell Ontology 2016: enhanced content, modularization, and ontology interoperability</article-title><source>J Biomed Semantics</source><year>2016</year><volume>7</volume><issue>1</issue><fpage>1</fpage><lpage>10</lpage><pub-id pub-id-type="pmcid">PMC4932724</pub-id><pub-id pub-id-type="pmid">27377652</pub-id><pub-id pub-id-type="doi">10.1186/s13326-016-0088-7</pub-id></element-citation></ref><ref id="R41"><label>41</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bernstein</surname><given-names>MN</given-names></name><name><surname>Ma</surname><given-names>Z</given-names></name><name><surname>Gleicher</surname><given-names>M</given-names></name><name><surname>Dewey</surname><given-names>CN</given-names></name></person-group><article-title>CellO: Comprehensive and hierarchical cell type classification of human cells with the Cell Ontology</article-title><source>Iscience</source><year>2021</year><volume>24</volume><issue>1</issue><elocation-id>101913</elocation-id><pub-id pub-id-type="pmcid">PMC7753962</pub-id><pub-id pub-id-type="pmid">33364592</pub-id><pub-id pub-id-type="doi">10.1016/j.isci.2020.101913</pub-id></element-citation></ref><ref id="R42"><label>42</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jiang</surname><given-names>L</given-names></name><name><surname>Chen</surname><given-names>H</given-names></name><name><surname>Pinello</surname><given-names>L</given-names></name><name><surname>Yuan</surname><given-names>GC</given-names></name></person-group><article-title>GiniClust: detecting rare cell types from single-cell gene expression data with Gini index</article-title><source>Genome Biol</source><year>2016</year><volume>17</volume><issue>1</issue><fpage>1</fpage><lpage>13</lpage><pub-id pub-id-type="pmcid">PMC4930624</pub-id><pub-id pub-id-type="pmid">27368803</pub-id><pub-id pub-id-type="doi">10.1186/s13059-016-1010-4</pub-id></element-citation></ref><ref id="R43"><label>43</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ding</surname><given-names>J</given-names></name><name><surname>Adiconis</surname><given-names>X</given-names></name><name><surname>Simmons</surname><given-names>SK</given-names></name><name><surname>Kowalczyk</surname><given-names>MS</given-names></name><name><surname>Hession</surname><given-names>CC</given-names></name><name><surname>Marjanovic</surname><given-names>ND</given-names></name><etal/></person-group><article-title>Systematic comparison of single-cell and single-nucleus RNA-sequencing methods</article-title><source>Nat Biotechnol</source><year>2020</year><volume>38</volume><issue>6</issue><fpage>737</fpage><lpage>746</lpage><pub-id pub-id-type="pmcid">PMC7289686</pub-id><pub-id pub-id-type="pmid">32341560</pub-id><pub-id pub-id-type="doi">10.1038/s41587-020-0465-8</pub-id></element-citation></ref></ref-list></back><floats-group><boxed-text id="BX1" position="float" orientation="portrait"><caption><title>Author summary</title></caption><p>Single-cell transcriptomics is rapidly advancing our understanding of the cellular composition of complex tissues and organisms. With the advent of various sequencing techniques, automatic cell-type annotation using well-annotated single-cell RNA sequencing (scRNA-seq) references has become popular. Compared with unsupervised cell-type annotation methods, it can be more easily applied to different data, saving labor and time costs. However, it relies on the diversity of cell types in the reference so there are generally unseen cell types in the query data. These unseen cell types need to be identified when annotating new sequencing data not only for improving annotation accuracy but also for novel biological discoveries. To address these issues, we propose mtANN, a new method to automatically annotate query data while accurately identify unseen cell types with the help of multiple references. We demonstrate the annotation performance of mtANN in PBMC and Pancreas collections when different proportions of unseen cell types are present in the query dataset. We also verify the practical application of mtANN in a collection of COVID-19 datasets for patients with different symptoms. When there are unseen cell types in the query dataset, mtANN is able to identify the unseen cell types and accurately annotate the shared cell types, especially the two cell types that are biologically similar.</p></boxed-text><fig id="F1" position="float"><label>Fig 1</label><caption><title>Overview of mtANN.</title><p>(A) The training process of mtANN includes two modules: gene selection (Module I) and deep classification model training (Module II). The labeled data <italic>i</italic> is used as an example. In Module I, eight gene selection methods are applied on data i, obtaining multiple reference subsets. The gene sets selected by the eight gene selection methods intersect with all the genes in the query dataset, determining the input genes of multiple deep classification models. In Module II, pairs of reference subset and query dataset after gene selection are used as input to train each deep classification model. We conduct theses two modules for every labeled data, thus obtaining multiple deep classification models. (B) The prediction process of mtANN (Module III) first makes predictions for the query data based on deep classification models learned by Module II and then conducts a majority vote to obtain a metaphase annotation. (C) Unseen cell type identification process, consisting of two modules: quantifying the likelihood of a cell belonging to an unseen cell type (Module IV) and using a data-driven threshold determination method to identify unseen cell types (Module V). In Module IV, we define an unseen cell type identification metric by averaging three uncertainty measures calculated from the results obtained from III. In Module V, we derive a new a data-driven method based on Gaussian mixture model to determine the threshold for unseen type identification. If a cell is identified as belonging to an unseen cell type, mtANN annotates it as “unassigned”; otherwise mtANN annotates it as the result of module III.</p></caption><graphic xlink:href="EMS157366-f001"/></fig><fig id="F2" position="float"><label>Fig 2</label><caption><title>Accuracy comparison between mtANN and each base classification model.</title><p>The “Celseq” dataset in the PBMC collection and the “Baron” dataset in the Pancreas collection used as query datasets are displayed. In each plot, each column represents a reference dataset. Each point is the performance of a base classification model, and points of different colors represent different gene selection methods. The red line indicates the performance of mtANN that integrates different reference datasets and gene selection methods.</p></caption><graphic xlink:href="EMS157366-f002"/></fig><fig id="F3" position="float"><label>Fig 3</label><caption><title>The performance in unseen cell-type identification.</title><p>(A) The boxplot of the AUPRC for mtANN and other methods when “10X v3” in PBMC collection is the query dataset. (B) The distribution of each metric that measures cell prediction uncertainty when the “10X v3” dataset in the PBMC collection is the query dataset and “B cell” is the real unseen cell type. The color of the histogram distinguishes unseen cell types from shared cell types. The black dotted line represents the subpopulations of the Gaussian mixture model fitted by mtANN. The red solid line represents the default threshold selected by each method. Cells with a metric greater than the threshold are identified as “unassigned” in mtANN and cells with a score less than the threshold are identified as “unassigned” in scmap-clust, scmap-cell, and Seurat v3. (C) The boxplot of the F1 score for mtANN and other methods when “10X v3” in PBMC collection is the query dataset. We use the default threshold provided by each method to select “unassigned” cells. (D) The bar plot of the proportion of unseen cell types and “unassigned” cells predicted by each method when the “10X v3” dataset in the PBMC collection is the query dataset. The name of each plot indicates the real unseen cell type.</p></caption><graphic xlink:href="EMS157366-f003"/></fig><fig id="F4" position="float"><label>Fig 4</label><caption><title>The performance in cell-type annotation when there are unseen cell types in query dataset.</title><p>(A) The boxplot of the accuracy for mtANN and other methods when the “10X v3” dataset in the PBMC collection is the query dataset. (B) The bar plot of the real proportion of cell types and the proportion of cell types annotated by each method when the “10X v3” dataset in the PBMC collection is the query dataset and “B cell” is the real unseen cell type. (C) Heatmaps of the confusion matrices of mtANN and other methods when the “10X v3” dataset is the query dataset and “B cell” is the real unseen cell type. In a confusion matrix, the row and column names correspond to the true cell labels and the predicted cell labels of the query dataset, where the element represents the proportion of cells belonging to one cell type that is predicted to be of other cell types. NK cell and pDC are abbreviations for the Natural killer cell and the Plasmacytoid dendritic cell.</p></caption><graphic xlink:href="EMS157366-f004"/></fig><fig id="F5" position="float"><label>Fig 5</label><caption><title>The application of different methods on COVID-19 dataset.</title><p>(A) The boxplots of the accuracy of different methods on samples in different symptoms. (B) One-to-one comparison between mtANN and scmap-clust, scmap-cell, and Seurat v3. Each point represents a query dataset. P-values of two-sided paired Wilcoxon signed-rank tests used to test for significance of differences in performance are reported. (C) The boxplots of the compositions of B cells, T cells, Dendritic cells, Megakaryocyte cells, and CD14+ monocyte between samples with different symptoms. The significance of the two-sided T-test is represented by stars where one star, two stars and, three stars mean the corresponding p-value less than 0.05, 0.01 and, 0.001, respectively, and ns means the corresponding p-value greater than 0.05.</p></caption><graphic xlink:href="EMS157366-f005"/></fig></floats-group></article>