<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS192794</article-id><article-id pub-id-type="doi">10.1101/2023.12.14.571623</article-id><article-id pub-id-type="archive">PPR773549</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Machine learning approaches to predicting whether muscles can be elicited via TMS</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Jin</surname><given-names>Fang</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Bruijn</surname><given-names>Sjoerd M.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Daffertshofer</surname><given-names>Andreas</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib></contrib-group><aff id="A1"><label>1</label>Department of Human Movement Sciences, Faculty of Behavioural and Movement Sciences, Vrije Universiteit Amsterdam, Amsterdam, Netherlands</aff><aff id="A2"><label>2</label>Institute Brain and Behavior Amsterdam, Vrije Universiteit Amsterdam, Amsterdam, Netherlands</aff><author-notes><corresp id="CR1">
<label>*</label>Corresponding author: <email>a.daffertshofer@vu.nl</email>
</corresp></author-notes><pub-date pub-type="nihms-submitted"><day>15</day><month>12</month><year>2023</year></pub-date><pub-date pub-type="preprint"><day>14</day><month>12</month><year>2023</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0 International license</ext-link>.</license-p></license></permissions><abstract><sec id="S1"><title>Background</title><p id="P1">Transcranial magnetic stimulation (TMS) is a valuable technique for assessing the function of the motor cortex and cortico-muscular pathways. TMS activates the motoneurons in the cortex, and this activation is transmitted through the cortico-muscular pathway, after which it can be measured as a motor evoked potential (MEP) in the muscles. The position and orientation of the TMS coil and the intensity used to deliver a TMS pulse are considered central TMS setup parameters influencing the presence/absence of MEPs.</p></sec><sec id="S2"><title>New Method</title><p id="P2">We sought to predict the presence of MEPs from TMS setup parameters using machine learning. We trained different machine learners using either within-subject or between-subject designs.</p></sec><sec id="S3"><title>Results</title><p id="P3">We obtained prediction accuracies of on average 77% and 65% with maxima up to up to 90% and 72% within and between subjects, respectively. Across the board, a bagging ensemble appeared to be the most suitable approach to predict the presence of MEPs, although a comparably simple logistic regression model also performed well.</p></sec><sec id="S4"><title>Conclusions</title><p id="P4">While the prediction between subjects clearly leaves room for improvement, the within-subject performance encourages to supplement TMS by machine learning to improve its diagnostic capacity with respect to motor impairment.</p></sec></abstract><kwd-group><kwd>TMS</kwd><kwd>MEP</kwd><kwd>machine learning</kwd><kwd>bagging ensemble</kwd><kwd>SVM</kwd></kwd-group></article-meta></front><body><sec id="S5" sec-type="intro"><label>1</label><title>Introduction</title><p id="P5">Transcranial magnetic stimulation (TMS), a non-invasive brain stimulation technique, is a popular and well-established tool, both for experimental assessments and in the clinic (<xref ref-type="bibr" rid="R8">Kobayashi and Pascual-Leone, 2003</xref>). The first TMS-induced muscle activation (magnetic evoked potential, MEP) was captured in 1985 (<xref ref-type="bibr" rid="R1">Barker et al., 1985</xref>). The activation originated from depolarisation of the upper motoneurons due to a TMS pulse, which passed via the descending neural pathway to the muscle, where it can be recorded by conventional electromyography (EMG). The assessment of motor neurophysiological outcomes like the active area of TMS motor mapping is guided by the stimulation of sites on the (motor) cortex from which an MEP can be elicited, coined active points (<xref ref-type="bibr" rid="R9">Krieg et al., 2017</xref>). Quite recently, however, we showed that incorporating so-called non-active points, i.e., sites on the (motor) cortex from which no MEP can be elicited, can improve estimates of these motor neurophysiological outcomes.</p><p id="P6">The position of the TMS coil, or more precisely the position of the focal point of the induced magnetic field, is a prime parameter determining whether a certain muscle is activated. For instance, stimulation in the hand-knob region of the motor cortex can trigger finger muscles (<xref ref-type="bibr" rid="R4">Dechent and Frahm, 2003</xref>). Apart from position, however, coil orientation and stimulation intensity also determine whether an MEP will be elicited (<xref ref-type="bibr" rid="R10">Laakso et al., 2013</xref>; <xref ref-type="bibr" rid="R11">Opitz et al., 2013</xref>; <xref ref-type="bibr" rid="R18">Weise et al., 2020</xref>). <xref ref-type="bibr" rid="R17">Vink et al. (2018)</xref> showed that MEP amplitudes altered with changing coil orientation even when the stimulation occurred in the same position. Here we asked to what extent one can predict whether a TMS stimulation with a certain intensity and at a certain position and orientation does (or does not) elicit an MEP in a muscle. If possible, this may greatly facilitate performing TMS-based assessments of the motor cortex.</p><p id="P7">One way to achieve this would be to define a very detailed biophysical model of the neural tissue in the cortex and to estimate the induced electric field for every possible location, orientation, and intensity of the TMS stimulation. Not only will that be a laborious endeavour, but this approach will also come with unavoidable uncertainties about the neural responses to TMS. Therefore, we considered a blind alternative: Supervised machine learning uses existing data for training a model to predict the unseen output given some input. We adopt this approach to classify the presence of MEPs (= output response) from TMS setup parameters, namely position, orientation, and intensity (= input predictors).</p><p id="P8">We tested the predictive capacity of different machine learners using data for N=20 subjects in two distinct settings. (1) We adopted a within-subject design by utilising parts of the data from a single subject as a training set used to predict the remaining data from the same subject. (2) We tried to predict the presence of MEPs from an unseen subject using the data of other the subjects, that is, we considered a between-subject design. For both designs we anticipated challenges. For the within-subject case the amount of data of an individual subject may not suffice to reach maximal prediction accuracy. We return to this in the discussion section as sample size is crucial for machine learning to be successful. In the between-subject case one faces pronounced inter-individual differences in brain morphology that we sought to minimise by warping the coil position (<xref ref-type="bibr" rid="R7">Jin et al., 2023</xref>) and orientation from specific-subject MRI to a standard anatomical template.</p><p id="P9">If within-subject prediction is feasible, it may help streamlining motor mapping procedures for identifying the motor region in general but especially in patients prior to surgery (<xref ref-type="bibr" rid="R9">Krieg et al., 2017</xref>). To ensure the precision of motor mapping, more than 100 stimulation points are typically required (<xref ref-type="bibr" rid="R16">Van De Ruit et al., 2015</xref>). Reducing that number by any means will decrease valuable time needed otherwise in the operating theatre. The potential benefits of between-subject prediction are more abundant. For example, the active area induced by TMS is a biomarker in stroke (<xref ref-type="bibr" rid="R12">Sawaki et al., 2008</xref>). Using healthy controls as training set one may generate a reference area of excitability that may serve as a target when evaluating therapeutical interventions in stroke survivors.</p></sec><sec id="S6" sec-type="methods"><label>2</label><title>Methods</title><sec id="S7"><label>2.1</label><title>Data collection</title><p id="P10">The data were collected in a previously described study (<xref ref-type="bibr" rid="R6">Jin et al., 2022</xref>). In brief, N=20 subjects underwent TMS motor mapping. We used a Magstim 200<sup>2</sup> stimulator (Magstim Company Ltd., Whitland, Dyfed, United Kingdom) with neuro-navigation (Neural Navigator, Brain Science Tools BV, De Bilt, The Netherlands). Bipolar EMG signals (Porti, TMSi, Oldenzaal, the Netherlands) were recorded from the muscles of the first dorsal interosseous (FDI), abductor digiti minimi (ADM), flexor pollicis brevis (FPB), abductor pollicis brevis (APB), extensor digitorum communis (EDC), flexor digitorum superficialis (FDS), extensor carpi radialis (ECR), and flexor carpi radialis (FCR). Prior to the measurement, each subject underwent an anatomical T1 MRI (3 Tesla Philips Achieva System, Philips, Best, Netherlands). We mapped the motor cortex using a pseudo-random walk method (<xref ref-type="bibr" rid="R16">Van De Ruit et al., 2015</xref>) at intensities of 105% RMT of FDI, EDC and FCR and recorded the EMG signals simultaneously. At each of the three intensities about 120 stimulations interleaved by 5s rest were performed. All the measurement procedures were carried out twice, yielding a total of about 120·3·2 = 720 stimulation per subject.</p></sec><sec id="S8"><label>2.2</label><title>Predictors and response data</title><p id="P11">We selected TMS setup parameters (intensity, position, and orientation of TMS) as the input data (predictors) and the presence/absence of MEPs as the output data (categorical response) for our machine learners. The presence of (= MEP) was defined as equal to 1 if the stimulation yielded an MEP in any of the eight muscles, whereas if none of them was elicited we considered MEPs to be absent (= no MEP). Please note that all the details about determining MEP from EMG can be found in (<xref ref-type="bibr" rid="R6">Jin et al., 2022</xref>). In brief, we considered MEPs proper if their amplitude exceeded 20 times the EMG-baseline’s standard deviation but stayed below 10 mV, and if the peak’s latency fell within the range of 5 to 50 ms after stimulation. All other stimulations were marked as no MEPs.</p><p id="P12">To standardise the input variables, we expressed the intensity relative to the FDI resting motor threshold (RMT) rather than in stimulator output. We also converted the Cartesian position data into spherical coordinates, i.e., (<italic>x, y, z</italic>) ⟶ (<italic>r, φ</italic>, <italic>ϑ</italic>), where <italic>r</italic> denotes the radius and <italic>φ</italic> and <italic>ϑ</italic> the azimuth and elevation, respectively. And we expressed the rotation matrix that quantifies the coil orientation via the corresponding Euler angle (<italic>α, β, γ</italic>). For all angular variables we computed the corresponding sine- and cosine-coefficient to account for their 2π-periodicity. That is, we used a total of twelve input variables: intensity (in RMT units), the radius <italic>r</italic>, and 2·5 = 10 sine- and cosine-coefficients of the five angular variables.</p></sec><sec id="S9"><label>2.3</label><title>Machine learners</title><p id="P13">We considered four types of machine learners. The first two, (1) a logistic regression model with ridge-regression for regularisation and (2) a regular support vector machine (SVM), assess whether the data sets are linearly separable, for (2) after embedding the data in a (much) higher-dimensional space (<xref ref-type="bibr" rid="R13">Steinwart and Christmann, 2008</xref>). The other two are non-linear approaches: (3) A support vector machine using Gaussian kernel functions when embedding the predictor data; and (4) random decision trees combined into a so-called bootstrap aggregating (bagging) ensemble model (<xref ref-type="bibr" rid="R2">Breiman, 1996</xref>). In a nutshell, data are subsampled yielding bootstraps with which different decision trees are trained whose outcomes are aggregated based on a majority vote. Bagging is known to reduce overfitting and appears robust against random fluctuations in training data.</p><p id="P14">For every type of machine learner, we first estimated a basic set of hyperparameters by pooling data and fitting the respective model via Bayesian optimisation and 20-fold cross-validation; see <xref ref-type="supplementary-material" rid="SD1">Table A1</xref> for the resulting sets. Subsequently we used them for the training/validation steps before testing the resulting models on unseen data.</p></sec><sec id="S10"><label>2.4</label><title>Within-subject design</title><p id="P15">As said, we first pooled the data, here, of an individual subject. With that we estimated the optimal hyperparameters via 20-fold cross-validation and fixed them for the subsequent testing. To guarantee that both MEP and no MEP stimulations were properly represented, for each of the 20 folds we stratified the data accordingly. For testing the models, we used a holdout validation, i.e., we used 80% of the data for training and validation (Bayesian optimisation with 10-fold cross-validation with fixed hyperparameters, again with proper data stratification) and estimated the predictive capacity of the trained model using the held-out 20% data as test set. As illustrated in <xref ref-type="fig" rid="F1">Figure 1</xref>, we repeated this for every of N=20 subjects 25 times and computed the resulting confusion chart.</p><p id="P16">This is generally characterised via the percentage of true positives (TP), false positives (FP), false negatives (FN), and true negatives (TN). Here, the ‘true positive’ refers to predicting the presence of a MEP if a MEP had been elicited, whereas a ‘false positive’ implies predicting its absence although a MEP had been elicited. Likewise, a ‘true negative’ implies the prediction of the absence of a MEP when it had not been elicited and a ‘false negative’ refers to the prediction of a MEP in that case.</p><p id="P17">We averaged the confusion charts over 25 repetitions per subject and report the mean over subjects as main outcome. The number of correct predictions (TP+TN) divided by the number of all predictions (TP+FP+FN+TN) served as a measure of the model’s accuracy and/or predictive capacity. We chose this measure of accuracy over the overall k-fold loss, because it avoids a potential bias in case the numbers of stimulations with and without MEPs differ substantially. For example, if 80% of all stimulations elicited MEPs, then always predicting the presence of an MEP would yield a 20% k-fold loss, i.e. 80% accuracy.</p></sec><sec id="S11"><label>2.4</label><title>Between-subject and within-subject design</title><p id="P18">With the between-subject models we tested for the capacity to predict the MEP/no-MEP outcome after training our machine learners using the data of all-but-one subjects. Otherwise, our approach largely corresponded to the within-subject design, i.e. we pooled the data, here of all subjects, to fix the hyperparameters of the four different types of machine learners, before training the models using the data of N-1=19 subjects and testing them on the single remaining subject; see <xref ref-type="fig" rid="F2">Figure 2</xref>. We repeated this for all the twenty hold-one-out combinations and report below the average confusion chart as well as the corresponding model accuracy/predictive capacity. The results for the individual subjects are given in the <xref ref-type="supplementary-material" rid="SD1">Appendix</xref>.</p><p id="P19">Given the substantial anatomical differences of our subjects, the between-subjects approach required additional pre-processing steps: The coil positions and orientations had to be ‘normalised’. As shown in detail in (<xref ref-type="bibr" rid="R7">Jin et al., 2023</xref>), <italic>i</italic> = 1, …, <italic>N</italic> positional data <inline-formula><mml:math id="M1"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> of individual subjects can be readily compared by mapping them on a template MRI yielding <inline-formula><mml:math id="M2"><mml:msubsup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>x</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>y</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>z</mml:mi><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:math></inline-formula> The mapping <inline-formula><mml:math id="M3"><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>→</mml:mo><mml:msubsup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:math></inline-formula> can be defined through warping the cortex-surface of subject-specific MRI to that of the template; we used the MNI152 template (<xref ref-type="bibr" rid="R15">Tadel et al., 2011</xref>) and the FreeSurfer-based pial surface (<xref ref-type="bibr" rid="R5">Fischl, 2012</xref>). A similar mapping of the coil orientation given as rotation matrix <italic>R</italic> can also be found, at least to some approximation. For this, we estimated the best-fitting affine transform <italic>A</italic> between <inline-formula><mml:math id="M4"><mml:msub><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> and <inline-formula><mml:math id="M5"><mml:msubsup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:math></inline-formula> for all <italic>i</italic> = 1, …, <italic>N</italic> and used its rotational component <italic>A</italic><sub>rot</sub> to transform <italic>R</italic> ′ =<italic>A</italic><sub>rot</sub><italic>R</italic>. We illustrate this for a single subject in <xref ref-type="fig" rid="F3">Figure 3</xref>. The positional data <inline-formula><mml:math id="M6"><mml:msubsup><mml:mover accent="true"><mml:mi>X</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>i</mml:mi><mml:mo>′</mml:mo></mml:msubsup></mml:math></inline-formula> were expressed in spherical coordinates and the rotation matrix <italic>R</italic>′ in Euler angles prior to entering the training/validation/testing procedures.</p></sec></sec><sec id="S12" sec-type="results"><label>3</label><title>Results</title><sec id="S13"><label>3.1</label><title>Input and response data</title><p id="P20">We collected 13,851 stimulations from 20 subjects, with an average count of 693 per subject, ranging from 581 to 732; some stimulations were excluded from the current analysis because they accidentally targeted subcortical regions or the ipsilateral hemisphere.</p><p id="P21">Of the included stimulations about 57% (= 7,896) successfully elicited MEPs in either or several of the eight recorded muscles. For the individual subjects this varied between 37% and 84% (average = 395, range = 258 to 570) as shown in <xref ref-type="fig" rid="F4">Figure 4</xref>.</p></sec><sec id="S14"><label>3.2</label><title>Within-subject design</title><p id="P22">
<xref ref-type="fig" rid="F5">Figure 5</xref> depicts the averaged confusion matrices of the four different machine learners trained and tested in the within-subject design. For all, the predictive capacity exceeded 70%, with the bagging ensemble models showing the maximum performance (77% accuracy). The arguably simple logistic regression model almost reached the same accuracy level (76%), while the more involved support vector machines performed worse (74% for the linear version and 71% for the nonlinear extension via Gaussian kernels). The comparably poor performance of the kernel SVM came as a surprise given that it entails more degrees-of-freedom than its linear counterpart, let alone more than the logistic regression model.</p><p id="P23">We also generated the confusion matrices per subject from the within-subject design and show this in the Appendix in <xref ref-type="supplementary-material" rid="SD1">Figure B1</xref>. As expected, we found a substantial between-subject variability that largely matched the variability observed in <xref ref-type="fig" rid="F4">Figure 4</xref>. The maximum accuracy reached 90% while the minimum was a low as 54%, i.e. almost prediction by chance. Since these discrepancies surprised us, we estimated the predictor importance in the case of the tree-based bagging ensemble for all individual subjects and show the corresponding averages in <xref ref-type="fig" rid="F6">Figure 6</xref>; results of the individuals can be found in the Appendix in <xref ref-type="supplementary-material" rid="SD1">Figure E1</xref>. The predictor importance differed significantly across subjects which possibly influenced results when using the between-subject design.</p></sec><sec id="S15"><label>3.3</label><title>Between-subject model</title><p id="P24">The performance in the between-subject design was clearly less than in the within-subject design. Again, the bagging ensemble turned out to be best, but did only reach a predictive capacity of about 65%, which was very similar to the logistic regression, as shown in <xref ref-type="fig" rid="F7">Figure 7</xref>. Again, both SVM approaches performed less although the conventional SVM displayed the highest true positives prediction (almost 88%; see top right panel in <xref ref-type="fig" rid="F7">Figure 7</xref>).</p><p id="P25">The corresponding confusion matrices for each subject in the between-subject design can be found as <xref ref-type="supplementary-material" rid="SD1">Figure B2</xref> in the Appendix. The maximum prediction accuracy reached a maximum of 72%, i.e., it was clearly lower than when training any of the models in the within-subject design.</p></sec></sec><sec id="S16" sec-type="discussion"><label>4</label><title>Discussion</title><p id="P26">We predicted the presence of MEPs using different machine learning approaches. The machine learners were either trained separately on every of the N = 20 participating subjects (within-subject design) or via hold-one-out partitioning, i.e. training using data of N-1 = 19 subjects and testing on the remainder (between-subject design). While the within-subject design yielded acceptable prediction accuracy (acceptable since the amount of data for training was limited), the results of the between-subject design were disappointing (here the amount of data for training was about 20 times larger and deemed sufficient).</p><p id="P27">For both within and between subject designs, the decision tree approach combined as a bagging ensemble showed the maximum performance. This is not surprising as this machine learner is known for its rich predictive capacity and – when it comes to boosting alternatives (see around <xref ref-type="supplementary-material" rid="SD1">Table A1</xref>), it is considered particularly robust against random variability that we observed in our data (see <xref ref-type="fig" rid="F4">Figures 4</xref> &amp; <xref ref-type="fig" rid="F6">6</xref> as well as <xref ref-type="supplementary-material" rid="SD1">C1 &amp; E1</xref> in the Appendix). Interestingly though, the performance gain over, e.g., the arguably simple logistic ridge regression, was not spectacular, suggesting that either the sample size did not suffice to train the ensemble well enough or that the data really did not contain sufficient information to make the desired predictions.</p><p id="P28">The performances of (most of) the subject-specific models speak against the latter. This brings us to potential limitations when combining our data to suit for between-subject comparisons. Essential here is the warping of the subject-specific anatomy to a template head. While this is common practice in, e.g., MRI-assessments, integrating the concomitant transforms in TMS is rarely done; see (<xref ref-type="bibr" rid="R7">Jin et al., 2023</xref>) for an exception. We chose to define the transform by matching pial rather than grey matter surfaces. This has the advantage to not suggest spatial resolutions that TMS cannot provide, it does limits estimates of ‘really’ excitable areas in the cortex. In a way this limitation suggests replacing this pre-processing step by proper estimates of the induced electric fields, though when doing so, one must extract selected scalar values of these fields to-be-used as predictors in a machine learning approach.</p><p id="P29">Unlike previous work, here, we not only transformed the focal point of the magnetic field, i.e., its position, but also its orientation. We follow a ‘poor man’s’ approach and simply estimated an affine transform based on the original and transformed positional data. While this guaranteed the smoothness of the transform, it ignored that warping may, for example, cause a point that was originally on top of a gyrus to end-up close to a sulcus. In that case the change in curvature may be substantial and may require more than the global affine transform to ‘correct’ coil orientation. Implementing such a more local transform comes with challenges as only two of the three orientational angles are uniquely defined. Here we tested for the possibly deteriorating effect of transforming the data to MNI-space by comparing the results in <xref ref-type="fig" rid="F5">Figure 5</xref> that were determined using the original subject-specific MRIs with those computed on the MNI-template following the within-subject design. <xref ref-type="supplementary-material" rid="SD1">Figures D1/2</xref> clearly show that transforming TMS stimulation points to a template hardly comes with information loss and, consequently, does not lead to a reduced prediction accuracy of our machine learners.</p><p id="P30">Given the challenges in transforming coil orientation one may wonder whether one may ignore it altogether when seeking for prediction models for TMS. We tested this by rerunning our machine learning procedures without any information about coil orientation. As shown in <xref ref-type="supplementary-material" rid="SD1">Figures F1/2</xref>, it is appropriate to the include coil orientation to attain (slightly) better prediction accuracy. This is consistent with earlier findings about the relevance of TMS orientation when eliciting MEPs (<xref ref-type="bibr" rid="R11">Opitz et al., 2013</xref>; <xref ref-type="bibr" rid="R17">Vink et al. (2018)</xref>.</p><p id="P31">As said, we are disappointed by the low accuracy of the between-subject models. The substantial individual differences in MEPs occurrence may be seen as a possible cause for the limited performance (cf. <xref ref-type="fig" rid="F4">Figure 4</xref>). The pronounced differences in predictor importance between subjects supports this impression (cf. <xref ref-type="fig" rid="F6">Figure 6</xref>). By the same token current (non-linear) machine learners should have the capacity to cope with this variability provided the input data do contain sufficient information to form the to-be-identified classes and to train the classifier. While incorporating more than 10,000 data points when training our model sounds like a lot, we must admit that they stemmed from only 19 subjects. In previous studies, predictions using machine learning were made using a larger set of training data. For example, <xref ref-type="bibr" rid="R19">Zheng et al. (2015)</xref> aimed to identify Alzheimer’s disease (AD) and mild cognitive impairment (MCI) in subjects by using the connectivity networks of MRI to differentiate and diagnose these diseases. They trained a machine learning model on MRI data from 163 patients with Alzheimer’s disease and 189 patients with MCI, and they achieved accuracies of 92.1% and 86.9%, respectively. Previous research with smaller subject numbers produced much lower accuracies. <xref ref-type="bibr" rid="R3">Dayan et al. (2018)</xref> employed machine learning to classify large- or small-amplitude MEP classes using the cortical structural characteristics of MRI. Based on data from 25 subject, the accuracy of the MEP categorisation did not exceed 66.67%. Although there the research question and input data differed entirely from ours, it suggests that with a sufficiently large sample size, the between-subject variability might become of minor importance when predicting scalar, categorical outcome measures.</p><p id="P32">While the results for the within-subject design are more encouraging, also in this case there is room for improvement. For example, one may add additional features to the original input data, which in our study only consisted of the position, orientation, and intensity of TMS. For instance, <xref ref-type="bibr" rid="R14">Stokes et al. (2007)</xref> reported that the motor threshold rose with the coil-cortex distance, i.e., that distance could be one of these additional features. Moreover, the individual hand-knob curvature also correlates with the presence of MEPs <xref ref-type="bibr" rid="R11">Opitz et al. (2013)</xref>. Future studies may consider further features including morphological characteristics of the subject’s MRI (as, e.g., in <xref ref-type="bibr" rid="R3">Dayan et al. 2018</xref>) as such one can expect most such additions have the potential to improve the predictability of MEPs when added as input in a machine learner.</p></sec><sec id="S17" sec-type="conclusions"><label>5</label><title>Conclusion</title><p id="P33">We used the TMS intensity and coil position and orientation to predict the presence of MEPs in a group of hand and forearm muscles. Compared to more traditional machine learners, we achieve maximum higher accuracy when using decision tree-based bagging ensembles, especially when adding coil orientation to the set of predictors. Predicting TMS response within a subject appears in reach of machine learning approaches despite the limited sample size. Predicting a subject’s responses by training machine learners with data of other subjects, however, remains a challenge.</p></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Appendix</label><media xlink:href="EMS192794-supplement-Appendix.pdf" mimetype="application" mime-subtype="pdf" id="d212aAdFbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S18"><title>Acknowledgements</title><p>FJ would like to thank the Chinese Scholarship Council for financial support [201706210060]. SMB was funded by a VIDI grant from the Dutch Research Council [016.Vidi.178.014].</p></ack><ref-list><ref id="R1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Barker</surname><given-names>AT</given-names></name><name><surname>Jalinous</surname><given-names>R</given-names></name><name><surname>Freeston</surname><given-names>IL</given-names></name></person-group><article-title>Non-invasive magnetic stimulation of human motor cortex</article-title><source>The Lancet</source><year>1985</year><volume>325</volume><fpage>1106</fpage><lpage>1107</lpage><pub-id pub-id-type="pmid">2860322</pub-id></element-citation></ref><ref id="R2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Breiman</surname><given-names>L</given-names></name></person-group><article-title>Bagging predictors</article-title><source>Machine learning</source><year>1996</year><volume>24</volume><fpage>123</fpage><lpage>140</lpage><pub-id pub-id-type="doi">10.1007/BF00058655</pub-id></element-citation></ref><ref id="R3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dayan</surname><given-names>E</given-names></name><name><surname>López-Alonso</surname><given-names>V</given-names></name><name><surname>Liew</surname><given-names>S-L</given-names></name><name><surname>Cohen</surname><given-names>LG</given-names></name></person-group><article-title>Distributed cortical structural properties contribute to motor cortical excitability and inhibition</article-title><source>Brain Structure and Function</source><year>2018</year><volume>223</volume><fpage>3801</fpage><lpage>3812</lpage><pub-id pub-id-type="pmid">30078148</pub-id></element-citation></ref><ref id="R4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dechent</surname><given-names>P</given-names></name><name><surname>Frahm</surname><given-names>J</given-names></name></person-group><article-title>Functional somatotopy of finger representations in human primary motor cortex</article-title><source>Human Nrain Mapping</source><year>2003</year><volume>18</volume><fpage>272</fpage><lpage>283</lpage><pub-id pub-id-type="pmcid">PMC6872002</pub-id><pub-id pub-id-type="pmid">12632465</pub-id><pub-id pub-id-type="doi">10.1002/hbm.10084</pub-id></element-citation></ref><ref id="R5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fischl</surname><given-names>B</given-names></name></person-group><article-title>FreeSurfer</article-title><source>Neuroimage</source><year>2012</year><volume>62</volume><fpage>774</fpage><lpage>781</lpage><pub-id pub-id-type="pmcid">PMC3685476</pub-id><pub-id pub-id-type="pmid">22248573</pub-id><pub-id pub-id-type="doi">10.1016/j.neuroimage.2012.01.021</pub-id></element-citation></ref><ref id="R6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jin</surname><given-names>F</given-names></name><name><surname>Bruijn</surname><given-names>SM</given-names></name><name><surname>Daffertshofer</surname><given-names>A</given-names></name></person-group><article-title>Accounting for stimulations that do not elicit motor-evoked potentials when mapping cortical representations of multiple muscles</article-title><source>Frontiers in Human Neuroscience</source><year>2022</year><volume>16</volume><elocation-id>920538</elocation-id><pub-id pub-id-type="pmcid">PMC9263445</pub-id><pub-id pub-id-type="pmid">35814946</pub-id><pub-id pub-id-type="doi">10.3389/fnhum.2022.920538</pub-id></element-citation></ref><ref id="R7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jin</surname><given-names>F</given-names></name><name><surname>Bruijn</surname><given-names>SM</given-names></name><name><surname>Daffertshofer</surname><given-names>A</given-names></name></person-group><article-title>Overlap in the cortical representation of hand and forearm muscles as assessed by navigated TMS</article-title><source>Neuroimage: Reports</source><year>2023</year><volume>3</volume><elocation-id>100183</elocation-id><pub-id pub-id-type="doi">10.1016/j.ynirp.2023.100183</pub-id></element-citation></ref><ref id="R8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kobayashi</surname><given-names>M</given-names></name><name><surname>Pascual-Leone</surname><given-names>A</given-names></name></person-group><article-title>Transcranial magnetic stimulation in neurology</article-title><source>The Lancet Neurology</source><year>2003</year><volume>2</volume><fpage>145</fpage><lpage>156</lpage><pub-id pub-id-type="pmid">12849236</pub-id></element-citation></ref><ref id="R9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Krieg</surname><given-names>SM</given-names></name><name><surname>Lioumis</surname><given-names>P</given-names></name><name><surname>Mäkelä</surname><given-names>JP</given-names></name><name><surname>Wilenius</surname><given-names>J</given-names></name><name><surname>Karhu</surname><given-names>J</given-names></name><name><surname>Hannula</surname><given-names>H</given-names></name><name><surname>Savolainen</surname><given-names>P</given-names></name><name><surname>Lucas</surname><given-names>CW</given-names></name><name><surname>Seidel</surname><given-names>K</given-names></name><name><surname>Laakso</surname><given-names>A</given-names></name></person-group><article-title>Protocol for motor and language mapping by navigated TMS in patients and healthy volunteers; workshop report</article-title><source>Acta Neurochirurgica</source><year>2017</year><volume>159</volume><fpage>1187</fpage><lpage>1195</lpage><pub-id pub-id-type="pmid">28456870</pub-id></element-citation></ref><ref id="R10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Laakso</surname><given-names>I</given-names></name><name><surname>Hirata</surname><given-names>A</given-names></name><name><surname>Ugawa</surname><given-names>Y</given-names></name></person-group><article-title>Effects of coil orientation on the electric field induced by TMS over the hand motor area</article-title><source>Physics in Medicine &amp; Biology</source><year>2013</year><volume>59</volume><elocation-id>203</elocation-id><pub-id pub-id-type="pmid">24334481</pub-id></element-citation></ref><ref id="R11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Opitz</surname><given-names>A</given-names></name><name><surname>Legon</surname><given-names>W</given-names></name><name><surname>Rowlands</surname><given-names>A</given-names></name><name><surname>Bickel</surname><given-names>WK</given-names></name><name><surname>Paulus</surname><given-names>W</given-names></name><name><surname>Tyler</surname><given-names>WJ</given-names></name></person-group><article-title>Physiological observations validate finite element models for estimating subject-specific electric field distributions induced by transcranial magnetic stimulation of the human motor cortex</article-title><source>Neuroimage</source><year>2013</year><volume>81</volume><fpage>253</fpage><lpage>264</lpage><pub-id pub-id-type="pmid">23644000</pub-id></element-citation></ref><ref id="R12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sawaki</surname><given-names>L</given-names></name><name><surname>Butler</surname><given-names>AJ</given-names></name><name><surname>Leng</surname><given-names>X</given-names></name><name><surname>Wassenaar</surname><given-names>PA</given-names></name><name><surname>Mohammad</surname><given-names>YM</given-names></name><name><surname>Blanton</surname><given-names>S</given-names></name><name><surname>Sathian</surname><given-names>K</given-names></name><name><surname>Nichols-Larsen</surname><given-names>DS</given-names></name><name><surname>Wolf</surname><given-names>SL</given-names></name><name><surname>Good</surname><given-names>DC</given-names></name></person-group><article-title>Constraint-induced movement therapy results in increased motor map area in subjects 3 to 9 months after stroke</article-title><source>Neurorehabilitation and Neural Repair</source><year>2008</year><volume>22</volume><fpage>505</fpage><lpage>513</lpage><pub-id pub-id-type="pmcid">PMC3234527</pub-id><pub-id pub-id-type="pmid">18780885</pub-id><pub-id pub-id-type="doi">10.1177/1545968308317531</pub-id></element-citation></ref><ref id="R13"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Steinwart</surname><given-names>I</given-names></name><name><surname>Christmann</surname><given-names>A</given-names></name></person-group><source>Support vector machines</source><publisher-name>Springer Science &amp; Business Media</publisher-name><year>2008</year><pub-id pub-id-type="doi">10.1007/978-0-387-77242-4</pub-id></element-citation></ref><ref id="R14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stokes</surname><given-names>MG</given-names></name><name><surname>Chambers</surname><given-names>CD</given-names></name><name><surname>Gould</surname><given-names>IC</given-names></name><name><surname>English</surname><given-names>T</given-names></name><name><surname>McNaught</surname><given-names>E</given-names></name><name><surname>McDonald</surname><given-names>O</given-names></name><name><surname>Mattingley</surname><given-names>JB</given-names></name></person-group><article-title>Distance-adjusted motor threshold for transcranial magnetic stimulation</article-title><source>Clinical Neurophysiology</source><year>2007</year><volume>118</volume><fpage>1617</fpage><lpage>1625</lpage><pub-id pub-id-type="pmid">17524764</pub-id></element-citation></ref><ref id="R15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tadel</surname><given-names>F</given-names></name><name><surname>Baillet</surname><given-names>S</given-names></name><name><surname>Mosher</surname><given-names>JC</given-names></name><name><surname>Pantazis</surname><given-names>D</given-names></name><name><surname>Leahy</surname><given-names>RM</given-names></name></person-group><article-title>Brainstorm: a user-friendly application for MEG/EEG analysis</article-title><source>Computational Intelligence and Neuroscience</source><year>2011</year><volume>2011</volume><fpage>1</fpage><lpage>13</lpage><pub-id pub-id-type="pmcid">PMC3090754</pub-id><pub-id pub-id-type="pmid">21584256</pub-id><pub-id pub-id-type="doi">10.1155/2011/879716</pub-id></element-citation></ref><ref id="R16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van De Ruit</surname><given-names>M</given-names></name><name><surname>Perenboom</surname><given-names>MJ</given-names></name><name><surname>Grey</surname><given-names>MJ</given-names></name></person-group><article-title>TMS brain mapping in less than two minutes</article-title><source>Brain Stimulation</source><year>2015</year><volume>8</volume><fpage>231</fpage><lpage>239</lpage><pub-id pub-id-type="pmid">25556004</pub-id></element-citation></ref><ref id="R17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vink</surname><given-names>JJ</given-names></name><name><surname>Petrov</surname><given-names>PI</given-names></name><name><surname>Mandija</surname><given-names>S</given-names></name><name><surname>Dijkhuizen</surname><given-names>RM</given-names></name><name><surname>Neggers</surname><given-names>SF</given-names></name></person-group><article-title>Outcome of TMS-based motor mapping depends on TMS current direction</article-title><source>bioRxiv</source><year>2018</year><elocation-id>371997</elocation-id><pub-id pub-id-type="doi">10.1101/371997</pub-id></element-citation></ref><ref id="R18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Weise</surname><given-names>K</given-names></name><name><surname>Numssen</surname><given-names>O</given-names></name><name><surname>Thielscher</surname><given-names>A</given-names></name><name><surname>Hartwigsen</surname><given-names>G</given-names></name><name><surname>Knösche</surname><given-names>TR</given-names></name></person-group><article-title>A novel approach to localise cortical TMS effects</article-title><source>Neuroimage</source><year>2020</year><volume>209</volume><elocation-id>116486</elocation-id><pub-id pub-id-type="pmid">31877374</pub-id></element-citation></ref><ref id="R19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zheng</surname><given-names>W</given-names></name><name><surname>Yao</surname><given-names>Z</given-names></name><name><surname>Hu</surname><given-names>B</given-names></name><name><surname>Gao</surname><given-names>X</given-names></name><name><surname>Cai</surname><given-names>H</given-names></name><name><surname>Moore</surname><given-names>P</given-names></name><collab>Initiative, AsDN</collab></person-group><article-title>Novel cortical thickness pattern for accurate detection of Alzheimer’s disease</article-title><source>Journal of Alzheimer’s Disease</source><year>2015</year><volume>48</volume><fpage>995</fpage><lpage>1008</lpage><pub-id pub-id-type="pmid">26444768</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><p>Flow chart of the within-subject assessment, from left to right: After an initial training/validation step to fix the models’ hyperparameters, we adopted a 10-fold cross-validation to train the model on 80% of the data and used the remaining 20% for testing. Twenty-five repetitions of this procedure resulted in a confusion chart illustrating how many false/true positives/negatives were predicted. In the Results section, we report the corresponding averages over N=20 subjects.</p></caption><graphic xlink:href="EMS192794-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><p>Flow chart of the between-subject assessment, from left to right: After a 20-fold cross-validation initial training/validation step to fix the models’ hyperparameters, we adopted to train the model on the data of one subject and used the remaining data of other 19 subjects for testing. This procedure was repeated for every of the 20 subjects. The resulting confusion chart illustrates how many true/false positives/negatives were predicted, e.g. how often the presences of a MEP was predicted when it had been predicted (= ‘true positive’). In the Results section we report the corresponding averages over N = 20 subjects.</p></caption><graphic xlink:href="EMS192794-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><p>Illustration of the warping position and orientation of stimulations from a single subject’s surface (A) to the MNI template surface (B). The top row details the mapping for a single stimulation whilst the bottom row shows the pattern of all stimulations (here N = 237). The orientation of the flag indicates the TMS coil handle’s opposite direction, while the turquoise dot shows the position of the stimulation.</p></caption><graphic xlink:href="EMS192794-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><p>Numbers of successfully elicited MEPs relative to the total number of stimulations per subject. The percentages vary from 37% (subject 11) to 84% (subject 13) readily indicating a substantial between-subject variability in responding to TMS.</p></caption><graphic xlink:href="EMS192794-f004"/></fig><fig id="F5" position="float"><label>Figure 5</label><caption><p>The confusion matrices obtained for the within-subject design. The upper left rectangles (blue) represent ‘true positives’, i.e. prediction of MEPs if they were present, the pink lower left ones indicate false positives (predicting MEPs when non was elicited). The upper right pink rectangles indicate false negatives (predicting no MEPs while MEPs were elicited) and the lower right blue ones represent true negatives. The bagging ensemble approach (lower right panel) displayed maximum performance; see text for details about estimating the model accuracy.</p></caption><graphic xlink:href="EMS192794-f005"/></fig><fig id="F6" position="float"><label>Figure 6</label><caption><p>Mean importance for each of the twelve predictors. We computed accumulating changes in the node risk due to splits in the tree, and then dividing the sum by the total number of branch nodes. There the change in node risk is the difference between the risk for the parent node and the total risk for the two children. Error bars indicate the standard error over subjects.</p></caption><graphic xlink:href="EMS192794-f006"/></fig><fig id="F7" position="float"><label>Figure 7</label><caption><p>The confusion matrices obtained from the between-subject design; cf. <xref ref-type="fig" rid="F5">Figure 5</xref>. Again, the bagging ensemble approach yielded on average the maximum accuracy, but performance clearly deteriorated when compared to the within-subject design arguably due to the pronounced between-subject differences despite standardising data to the MNI template MRI.</p></caption><graphic xlink:href="EMS192794-f007"/></fig></floats-group></article>