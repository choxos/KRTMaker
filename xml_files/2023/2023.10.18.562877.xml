<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS189893</article-id><article-id pub-id-type="doi">10.1101/2023.10.18.562877</article-id><article-id pub-id-type="archive">PPR744752</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>DynaMight: estimating molecular motions with improved reconstruction from cryo-EM images</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Schwab</surname><given-names>Johannes</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">2</xref></contrib><contrib contrib-type="author"><name><surname>Kimanius</surname><given-names>Dari</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Burt</surname><given-names>Alister</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Dendooven</surname><given-names>Tom</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Scheres</surname><given-names>Sjors H.W.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="corresp" rid="CR1">2</xref></contrib><aff id="A1"><label>1</label>MRC Laboratory of Molecular Biology, CB2 0QH, Cambridge, UK</aff></contrib-group><author-notes><corresp id="CR1">
<label>2</label>Correspondence to: <email>schwab@mrc-lmb.cam.ac.uk</email> and <email>scheres@mrc-lmb.cam.ac.uk</email>
</corresp></author-notes><pub-date pub-type="nihms-submitted"><day>21</day><month>10</month><year>2023</year></pub-date><pub-date pub-type="preprint"><day>19</day><month>10</month><year>2023</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">How to deal with continuously flexing molecules is one of the biggest outstanding challenges in single-particle analysis of proteins from cryo-EM images. Here, we present DynaMight, a new software tool that estimates a continuous space of conformations in a cryo-EM data set by learning 3D deformations of a Gaussian pseudo-atomic model of a consensus structure for every particle image. Inversion of the learnt deformations is then used to obtain an improved reconstruction of the consensus structure. We illustrate the performance of DynaMight for several experimental cryo-EM data sets. We also show how error estimates on the deformations may be obtained by independently training two variational autoencoders (VAEs) on half sets of the cryo-EM data, and how regularisation of the 3D deformations through the use of atomic models may lead to important artefacts due to model bias. DynaMight is distributed as free, open-source software, as part of RELION-5.</p><p id="P2">Structure determination of biological macromolecules by single-particle analysis of electron cryo-microscopy (cryo-EM) images is, at heart, a single-molecule imaging technique. Together, many images of individual complexes in a cryo-EM data set contain information about the full extent of molecular dynamics that existed in the sample when it was plunge frozen. However, stringent low-dose imaging conditions, necessary to limit radiation damage, lead to high levels of experimental noise. Averaging over multiple individual images is thus necessary to extract detailed information about the underlying three-dimensional structures of the macromolecules. Because averaging projection images of distinct structures leads to blurring in the corresponding three-dimensional reconstruction, image classification algorithms are often used to separate cryo-EM data sets into a user-defined number of structurally homogeneous subsets [<xref ref-type="bibr" rid="R1">1</xref>]. Despite their effectiveness in handling cryo-EM data sets with a discrete number of conformations, classification algorithms face challenges when continuous molecular motion is present in the sample. Therefore, continuous molecular motions in cryo-EM data sets is often considered a nuisance, rather than a rich source of information about protein dynamics.</p><p id="P3">Manifold embedding [<xref ref-type="bibr" rid="R2">2</xref>] represented an early attempt to describe continuous molecular motions in cryo-EM data sets, although application of this approach has been limited to a few macromolecular complexes [<xref ref-type="bibr" rid="R3">3</xref>, <xref ref-type="bibr" rid="R4">4</xref>]. A more widely used approach to deal with continuously flexing complexes has been multi-body refinement [<xref ref-type="bibr" rid="R5">5</xref>]. Multi-body refinement divides complexes into independently moving rigid bodies through partial signal subtraction [<xref ref-type="bibr" rid="R6">6</xref>, <xref ref-type="bibr" rid="R7">7</xref>, <xref ref-type="bibr" rid="R8">8</xref>]. Independent image alignment and reconstruction for each of the individual bodies leads to better maps than a reconstruction of the entire complex that does not take the structural variability into account. However, image alignment requires a minimum size of the individual bodies, which limits the applicability of multi-body refinement to relatively large complexes. More recently, deep convolutional neural networks in the form of variational auto-encoders (VAEs) have been proposed to map projection images into a continuous multi-dimensional latent space [<xref ref-type="bibr" rid="R9">9</xref>, <xref ref-type="bibr" rid="R10">10</xref>, <xref ref-type="bibr" rid="R11">11</xref>]. This mapping no longer assumes the presence of a discrete, user-defined number of structures in the data. Moreover, a corresponding decoder network can be used to reconstruct three-dimensional structures for each point in latent space, allowing the creation of movies that describe three-dimensional protein motions by traversing latent space. These approaches have proven useful in exploring continuous molecular motions. However, in contrast to multibody refinement, the majority of them do not lead to improved reconstructed densities for the moving parts.</p><p id="P4">Two methods have been proposed that aim to analyze continuous molecular motions, while also improving the reconstructed density of the underlying consensus structure. 3D flexible refinement in cryoSPARC uses an auto-decoder to learn deformations that are applied straight to the cryo-EM map [<xref ref-type="bibr" rid="R12">12</xref>]. A quasi-Newtonian optimisation algorithm then uses the learnt deformations to improve a reconstruction of the consensus structure. Alternatively, the Zernike3D approach expresses the cryo-EM map in a basis of 3D Zernike polynomials and uses Powell optimisation to find the deformations for each individual particle image [<xref ref-type="bibr" rid="R13">13</xref>]. These deformations are then used in a modified algebraic reconstruction technique (ART) algorithm to obtain an improved reconstruction for the consensus structure.</p><p id="P5">In this study, we present a new approach, coined DynaMight (for ’exploring protein <bold>Dyna</bold>mics that <bold>Might</bold> improve your map’). Inspired by [<xref ref-type="bibr" rid="R10">10</xref>], DynaMight uses Gaussian pseudo-atoms to model the cryo-EM density. The estimation of the conformational variability in the cryo-EM data set is performed by a VAE, where an encoder maps individual cryo-EM images to latent space and a decoder outputs 3D deformations of the Gaussian pseudo-atoms to infer the different conformational states. We introduce a novel decoder architecture that takes the latent vector alongside spatial coordinates as an input and outputs actual displacements. Compared to [<xref ref-type="bibr" rid="R10">10</xref>], given a latent representation, the decoder directly represents the function of interest, namely a deformation field. This enables the opportunity to apply priors directly to the deformation field, for which we explore both benefits and pitfalls. A modified filtered backprojection algorithm, that back-projects individual particle images along curves derived from these deformations, then yields an improved density map of the consensus structure.</p></abstract></article-meta></front><body><sec id="S1"><title>Approach</title><sec id="S2"><title>Description of conformational variability</title><p id="P6">We describe the <italic>i</italic>th of <italic>N</italic><sub><italic>d</italic></sub> particle images, <italic>y</italic><sub><italic>i</italic></sub>, with the following forward model: <disp-formula id="FD1"><label>(1)</label><mml:math id="M1"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi mathvariant="script">C</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>∗</mml:mo><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>P</mml:mi></mml:mstyle><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mtext>Γ</mml:mtext><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mtext>x</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where 𝒞<sub><italic>i</italic></sub> denotes the contrast transfer function, <inline-formula><mml:math id="M2"><mml:mrow><mml:msub><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>P</mml:mi></mml:mstyle><mml:mrow><mml:msub><mml:mi>ϕ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> the projection of a particle that is rotated and shifted by its pose <italic>ϕ</italic><sub><italic>i</italic></sub> ∈ <italic>SE</italic>(3). We choose to represent the function <italic>f</italic> by a sum of <italic>N</italic><sub><italic>g</italic></sub> three-dimensional Gaussian basis functions, or pseudo-atoms: <disp-formula id="FD2"><label>(2)</label><mml:math id="M3"><mml:mrow><mml:mi>f</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>x</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>≈</mml:mo><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:mtext>x</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msub><mml:mi mathvariant="script">G</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mtext>x</mml:mtext><mml:mo>−</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M4"><mml:mrow><mml:msub><mml:mi mathvariant="script">G</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>:</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mo>→</mml:mo><mml:mi>ℝ</mml:mi><mml:mspace width="0.2em"/><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mspace width="0.2em"/><mml:msub><mml:mi mathvariant="script">G</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>x</mml:mi></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>∥</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>x</mml:mi></mml:mstyle><mml:msup><mml:mo>∥</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mo>/</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Here <italic>a</italic><sub><italic>j</italic></sub> &gt; 0 denote the amplitudes, <italic>s</italic><sub><italic>j</italic></sub> &gt; 0 the widths, and <italic>c</italic><sub><italic>j</italic></sub> the central positions of the Gaussian functions.</p><p id="P7">We assume that all particle images are conformational variations of a single, consensus structure that is described by the <italic>N</italic><sub><italic>g</italic></sub> three-dimensional Gaussian basis functions, and <italic>z</italic><sub><italic>i</italic></sub> in <xref ref-type="disp-formula" rid="FD1">equation (1)</xref> is the conformational encoding for the <italic>i</italic>th image. We describe the deformation of individual particles as a deviation from the consensus coordinates <bold>x</bold>: Γ(<bold>x</bold>) = <bold>x</bold> − <italic>δ</italic>(<bold>x</bold>), so that: <disp-formula id="FD3"><label>(3)</label><mml:math id="M5"><mml:mrow><mml:mtable equalrows="true" equalcolumns="true"><mml:mtr><mml:mtd><mml:mrow><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:mtext>Γ</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mtext>x</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msub><mml:mi mathvariant="script">G</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mtext>Γ</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mtext>x</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mrow/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd><mml:mtd><mml:mrow><mml:mo>=</mml:mo><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msub><mml:mi mathvariant="script">G</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mtext>x</mml:mtext><mml:mo>−</mml:mo><mml:mi>δ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mtext>x</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd><mml:mtd><mml:mrow/></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow/></mml:mtd><mml:mtd><mml:mrow><mml:mo>≈</mml:mo><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:msub><mml:mi>a</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msub><mml:mi mathvariant="script">G</mml:mi><mml:mrow><mml:msub><mml:mi>s</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mtext>x</mml:mtext><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mi>δ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd><mml:mrow/></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p><p id="P8">where the last approximation assumes that the deformation field is locally constant and that the density surrounding <italic>c</italic><sub><italic>j</italic></sub> moves in a similar manner. This enables us to describe the deformations as displacements of the Gaussian centers, which is a computationally tractable representation. Furthermore, the widths <italic>s</italic><sub><italic>j</italic></sub> and amplitudes <italic>a</italic><sub><italic>j</italic></sub> of all Gaussian pseudo-atoms are kept the same for the entire dataset. This means that DynaMight is by design constrained to only model mass-conserving heterogeneity and cannot handle non-stoichiometric mixtures. Therefore, compositional heterogeneity should be removed from the data set by alternative approaches, prior to running DynaMight.</p></sec><sec id="S3"><title>Estimation of conformational variability</title><p id="P9">For learning the deformations we use a VAE that consist of two neural networks, namely an encoder ℰ that predicts an <italic>l</italic>-dimensional latent representation <italic>z</italic><sub><italic>i</italic></sub> per particle image, and a decoder 𝒟 that predicts the displacement of all Gaussian pseudo-atoms in the model. The encoder is a fully connected neural network with three linear layers and ReLU activation functions. The input is a (real-space) experimental image <italic>y</italic><sub><italic>i</italic></sub> and the output are two vectors <inline-formula><mml:math id="M6"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>σ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:mrow></mml:msup><mml:mo>×</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>l</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, which describe the mean and standard deviation used to generate a sample <italic>z</italic><sub><italic>i</italic></sub> that serves as input for the decoder.</p><p id="P10">The decoder 𝒟(<italic>z</italic><sub><italic>i</italic></sub>, <italic>c</italic><sub><italic>j</italic></sub>) then approximates the term <italic>c</italic><sub><italic>j</italic></sub> + <italic>δ</italic><sub><italic>j</italic></sub> for each <italic>z</italic><sub><italic>i</italic></sub>. We define the decoder for the entire set of <italic>N</italic><sub><italic>g</italic></sub> positions as: <disp-formula id="FD4"><label>(4)</label><mml:math id="M7"><mml:mrow><mml:mi mathvariant="script">D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>c</mml:mi></mml:mstyle><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mn>0</mml:mn></mml:mstyle></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>c</mml:mi></mml:mstyle><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mn>0</mml:mn></mml:mstyle></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mi>δ</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>c</mml:mi></mml:mstyle><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mn>0</mml:mn></mml:mstyle></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula>
</p><p id="P11">In the above, <bold>c</bold><sup><bold>0</bold></sup> is all the consensus positions and <italic>δ</italic><sub><italic>θ</italic></sub> is a differentiable function, <inline-formula><mml:math id="M8"><mml:mrow><mml:msub><mml:mi>δ</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msup><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mi>c</mml:mi></mml:mstyle><mml:mn>0</mml:mn></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mtext> </mml:mtext><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>δ</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>δ</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>
, with parameters <italic>θ</italic>, that approximates <italic>δ</italic> for each position. In practice, we evaluate the decoder for each position <italic>c</italic><sub><italic>j</italic></sub> and query <italic>δ</italic><sub><italic>θ</italic></sub> with a positional encoding of <italic>c</italic><sub><italic>j</italic></sub>, concatenated with the latent representation <italic>z</italic><sub><italic>i</italic></sub> that describes the conformation of each particle.</p><p id="P12">The output positions are used to generate a projection image <italic>p</italic><sub><italic>i</italic></sub> of the deformed model in the pose of the particle, and the difference with the experimental image <inline-formula><mml:math id="M9"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msubsup><mml:mrow/><mml:mtext>Σ</mml:mtext><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> is minimized during training of the neural networks. Once trained, for a latent embedding of the whole data set, one obtains a family of deformation fields <inline-formula><mml:math id="M10"><mml:mrow><mml:mi mathvariant="script">D</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mo>⋅</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>≈</mml:mo><mml:msub><mml:mtext>Γ</mml:mtext><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> that is defined over the entire three-dimensional space.</p></sec><sec id="S4"><title>Regularisation and Model Bias</title><p id="P13">Because of high levels of experimental noise, cryo-EM reconstruction is an ill-posed problem. Even for standard, structurally homogeneous refinement, there are many possible rotational and translational assignments for each image. When estimating conformational variability the poses are known, but many deformed density maps may explain each experimental image equally well. Therefore, in both cases regularisation is essential for robust reconstruction.</p><p id="P14">The most common form of regularisation in VAEs is to constrain the distribution of latent variables to follow a Gaussian distribution, which lead to the model learning more meaningful and structured representations. The design of the decoder in <xref ref-type="fig" rid="F1">Figure 1</xref> allows an additional form of regularisation that imposes prior knowledge on its output of real-space deformation fields. A wide range of physically and biologically inspired penalties can be incorporated as priors on the deformations, also see [<xref ref-type="bibr" rid="R12">12</xref>, <xref ref-type="bibr" rid="R14">14</xref>, <xref ref-type="bibr" rid="R15">15</xref>]. Possibly a powerful source of prior information would come from an atomic model of the consensus structure, which could provide constraints on chemical bonds, maintain secondary structure elements, etc.</p><p id="P15">To explore direct regularisation of the deformation fields, we tested two approaches. The first approach aims to use prior information from an atomic model that is built in the consensus map, prior to running DynaMight. It generates a coarse-grained Gaussian representation of the atom positions, and then minimizes changes in the distances between these Gaussians according to the bonds that exist in the atomic model: <disp-formula id="FD5"><label>(5)</label><mml:math id="M11"><mml:mrow><mml:mi mathvariant="script">R</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mo stretchy="false">{</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo stretchy="false">}</mml:mo></mml:mrow></mml:munder><mml:msup><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>d</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="script">D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>z</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi mathvariant="script">D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>z</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>E</italic><sub><italic>i</italic>,<italic>j</italic></sub> = 1 if there is a bond between the two pseudo-atoms <italic>c</italic><sub><italic>i</italic></sub> and <italic>c</italic><sub><italic>j</italic></sub> and <italic>d</italic> denotes Euclidian distance. The deformations with this regularisation scheme result in Gaussians that remain close to a coarse-grained representation of the original atomic model.</p><p id="P16">The second regularisation approach uses less prior information and does not require an atomic model. Instead, Gaussians are placed to fill densities in the consensus map, and connections <italic>E</italic> in <xref ref-type="disp-formula" rid="FD5">equation 5</xref> are for all pairs of Gaussians that are within a distance of 1.5 times the average distance between all Gaussians and their two nearest neighbours. This regularisation enforces overall smoothness in the deformations. Additional penalties that prevent Gaussians coming too close to each other, or moving too far away from other Gaussians, also exist to ensure a physically plausible distribution of Gaussians.</p></sec><sec id="S5"><title>Improved 3D reconstruction</title><p id="P17">We propose an algorithm that uses the estimated deformation fields Γ to obtain an improved reconstruction of the consensus structure that incorporates information from all experimental images. To map back individual particle images to a hypothetical consensus state, one needs to estimate the inverse deformations, which represents a challenge. Whereas the inverse deformation on the displaced Gaussians is given by the negative displacement vector, i.e. Γ<sub>−1</sub>(Γ(<italic>c</italic><sub><italic>i</italic></sub>)) = <italic>c</italic><sub><italic>i</italic></sub>, the inverse deformation field needs to be inferred at all Cartesian grid positions of the improved reconstruction. We train a neural network as a regression function to estimate a deformation field that coincides on the given sampling points Γ(<italic>c</italic><sub><italic>i</italic></sub>), but can be evaluated on arbitrary positions. This network consists of an MLP with 6 layers and a single additive residual connection to the original coordinates of the consensus model <bold>c</bold><sup><bold>0</bold></sup>. Similar to the forward deformation model, the network takes the latent code <italic>z</italic><sub><italic>i</italic></sub> and the deformed positions Γ(<italic>c</italic><sub><italic>i</italic></sub>) as inputs and aims to output the original positions <italic>c</italic><sub><italic>i</italic></sub>. In addition to the inversion of the forward fields on the sampling points, we force the inverse field to be smooth by adding a regularisation term to the loss function.</p><p id="P18">The algorithm aims to improve the reconstruction of the density <italic>f</italic>, using the known deformations Γ, i.e. we aim to find the minimizer <inline-formula><mml:math id="M12"><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>
 of the data fidelity <disp-formula id="FD6"><label>(6)</label><mml:math id="M13"><mml:mrow><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>a</mml:mi><mml:mi>r</mml:mi><mml:mi>g</mml:mi><mml:mi>m</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi></mml:mrow><mml:mi>f</mml:mi></mml:munder><mml:munder><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:munder><mml:mo stretchy="false">‖</mml:mo><mml:mrow/><mml:msub><mml:mi mathvariant="script">C</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:msub><mml:mtext>Γ</mml:mtext><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mi>f</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msup><mml:mrow><mml:mrow/><mml:mo stretchy="false">‖</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula>
</p><p id="P19">This minimizer can be computed using the reconstruction formula <disp-formula id="FD7"><label>(7)</label><mml:math id="M14"><mml:mrow><mml:mtable equalrows="true" equalcolumns="true"><mml:mtr><mml:mtd><mml:mrow><mml:mover accent="true"><mml:mi>f</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:munder><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:munder><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:msub><mml:mtext>Γ</mml:mtext><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup><mml:mo>∘</mml:mo><mml:msubsup><mml:mi mathvariant="script">C</mml:mi><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>∘</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:msub><mml:mtext>Γ</mml:mtext><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>[</mml:mo><mml:mrow><mml:munder><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:munder><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:msub><mml:mtext>Γ</mml:mtext><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mi mathvariant="script">C</mml:mi><mml:mi>i</mml:mi><mml:mo>∗</mml:mo></mml:msubsup><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mo>=</mml:mo><mml:msup><mml:mi>D</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>[</mml:mo><mml:mrow><mml:munder><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:munder><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:msub><mml:mtext>Γ</mml:mtext><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mi mathvariant="script">C</mml:mi><mml:mi>i</mml:mi><mml:mo>∗</mml:mo></mml:msubsup><mml:msub><mml:mi>y</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula> to get an estimate of the unknown density <italic>f</italic>. Here <italic>D</italic> is a matrix that depends on the estimated deformations, and <inline-formula><mml:math id="M15"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mrow><mml:msub><mml:mtext>Γ</mml:mtext><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>∗</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> sis the composition of the backprojection operator</p><p id="P20">and the inverse deformation corresponding to the <italic>i</italic>th particle. (<xref ref-type="fig" rid="F1">Figure 1</xref>). For the structurally homogeneous case, Γ is the identity operator and <italic>D</italic> is diagonal in Fourier space and therefore the inverse can be computed simply by division, given that the distribution of projection directions covers the whole frequency domain and <italic>D</italic> has no zeros in the diagonal. In the presence of deformations, this matrix is not diagonal anymore and would be too expensive to compute or store. We approximate <xref ref-type="disp-formula" rid="FD7">equation (7)</xref> by using the filter that would correspond to the homogeneous case. Although even in the optimal scenario of having complete data of clean projection images, this method does not yield a minimum of functional (6), it still allows to correct for the deformation to some degree. When the deformation fields are not smooth, for example when two nearby domains move in opposite directions, reconstruction with the proposed algorithm may introduce artifacts at the interface between the domains.</p></sec><sec id="S6"><title>Implementation details</title><p id="P21">The initial positions of the Gaussians for the VAE are obtained by approximating a map from a consensus refinement with a Gaussian model. This initial consensus map does not correspond to an actual state of the complex, but rather to a mixture of different conformations. Therefore, parts of the map will have regions of poorly defined density, and correspondingly fewer Gaussians. To overcome this limitation, we update the positions of the consensus Gaussian model throughout the estimation of the deformations, such that the positions <italic>c</italic><sub><italic>j</italic></sub> may correspond to a single conformation at the end of the iterative process.</p><p id="P22">After initialisation of the Gaussians, in the first epochs of the training of the VAE, we only optimize the global Gaussian parameters, i.e. their widths, amplitudes and positions. These parameters are optimized with the ADAM optimizer and a learning rate of 0.0001. After this initial warm-up phase we start optimisation of the network parameters of the VAEs, again using the ADAM optimizer with a learning rate of 0.0001. During the second phase, the parameters of the Gaussians continue to be updated. Training of the VAEs is stopped when the updates of the consensus model don’t yield improvements anymore or a fixed, userdefined number of epochs are completed.</p><p id="P23">Training of the VAE is performed on two half sets, where two encoder-decoder pairs are trained independently, as illustrated in <xref ref-type="fig" rid="F1">Figure 1</xref>. This procedure yields two independent families of deformation fields, one for each half-set. The approximate inverse of these deformations are then used using the deformed weighted backprojection algorithm to generate two independent maps with improved estimates for the consensus structure. These half-maps can than be used in conventional post-processing and resolution estimation routines. As described in the Discussion section, by setting aside a small validation set of images, the two independent decoders also allow an error estimation of the displacement fields.</p><p id="P24">DynaMight has been implemented in pyTorch [<xref ref-type="bibr" rid="R16">16</xref>], and is accessible as a separate jobtype from the RELION-5 GUI. DynaMight uses the Napari viewer [<xref ref-type="bibr" rid="R17">17</xref>] to visualise the distribution of particles in latent space, as well as the corresponding deformation fields. The same viewer also allows real-time generation of densities from points in latent space, movie generation, and the selection of particle subsets in latent space.</p></sec></sec><sec id="S7" sec-type="results"><title>Results</title><sec id="S8"><title>Regularisation of the deformations is necessary but can lead to model bias</title><p id="P25">We first analyzed the different options for regularisation of the deformations on a well characterised data set on the yeast <italic>Saccharomyces cerevisiae</italic> pre-catalytic B complex spliceosome [<xref ref-type="bibr" rid="R18">18</xref>](EMPIAR-10180, [<xref ref-type="bibr" rid="R19">19</xref>]). The same data, or subsets of it, have also been analyzed using multi-body refinement [<xref ref-type="bibr" rid="R5">5</xref>] cryoDRGN [<xref ref-type="bibr" rid="R9">9</xref>], Zernike3D [<xref ref-type="bibr" rid="R13">13</xref>] and [<xref ref-type="bibr" rid="R10">10</xref>]. To minimize computational costs and to ensure structural homogeneity [<xref ref-type="bibr" rid="R9">9</xref>], we used 3D classification in RELION [<xref ref-type="bibr" rid="R20">20</xref>] to select ∼ 45<italic>k</italic> particles with reasonable density for the head region. Training of the VAEs on this subset with a box size of 320 took about 2.5 minutes per epoch on a single NVIDIA A100 GPU. This resulted in training times between 8 and 12 hours for estimating the deformations. Further estimation of the inverse deformations took ∼ 4 hours and reconstruction with the deformed backprojection ∼ 3 hours on the same GPU.</p><p id="P26">Without any regularisation of the deformations, estimated deformation fields displayed rapidly changing directions for neighbouring Gaussians, and deformed backprojection yielded reconstructions for which the local resolution did not improve with respect to the original consensus reconstruction (<italic>cf</italic> <xref ref-type="fig" rid="F2">Figs 2A-B</xref>). A consensus reconstruction with better local resolutions was obtained using the regularisation scheme that enforces smoothness in the deformations, but without using an atomic model (<xref ref-type="fig" rid="F2">Fig 2C</xref>). The map with the highest local resolutions was obtained using the regularisation scheme that enforces distances between bonded atoms of an atomic model (PDB-ID: 5nrl) (<xref ref-type="fig" rid="F2">Fig 2D</xref>). It thus appeared that incorporation of prior knowledge from the atomic model into the VAE had been beneficial.</p><p id="P27">However, because the neural networks in our approach comprise many parameters, we were worried that there would be scope for ”Einstein-from-noise” artefacts, similar to those described for orientational assignments in single-particle analysis [<xref ref-type="bibr" rid="R21">21</xref>, <xref ref-type="bibr" rid="R22">22</xref>, <xref ref-type="bibr" rid="R23">23</xref>]. To test this, we performed two control experiments.</p><p id="P28">In the first control experiment, we replaced the atomic model of the U2 3’ domain/SF3a domain with a different protein domain of similar size (PDB-ID 7YUY) [<xref ref-type="bibr" rid="R24">24</xref>]). The U2 3’ domain/SF3a showed only weak density in the consensus map, indicating large amounts of structural heterogeneity in this region. Although using the incorrect atomic model to estimate the deformation fields led to a similar improvement in local resolution compared to using the correct model (<italic>cf</italic> <xref ref-type="fig" rid="F3">Figs 3A-B</xref>), the reconstructed density from the deformed backprojection resembled the incorrect model, rather than the correct model (<xref ref-type="fig" rid="F3">Fig 3C</xref>).</p><p id="P29">In the second control experiment, we replaced the atomic model of the SF3b domain with PDB-ID 1G88 [<xref ref-type="bibr" rid="R25">25</xref>]. The density for the SF3b domain in the consensus map was stronger than the density for the SF3a region, indicating that this region in the spliceo-some is less flexible. In this case, using the incorrect atomic model yielded a map with lower local resolutions in the SF3b region than using the correct model (<italic>cf</italic> <xref ref-type="fig" rid="F3">Figs 3D-E</xref>). But still, the reconstructed density from the deformed backprojection resembled the incorrect model more than the correct model (<xref ref-type="fig" rid="F3">Fig 3F</xref>).</p><p id="P30">These results suggest that estimation of deformation fields may lead to model bias, to the extent that reconstructed density may reproduce features of an incorrect atomic model. The scope for model bias to affect the deformed backprojection reconstruction is larger in regions of the map with higher levels of structural heterogeneity. Because it would be difficult to distinguish correct atomic models from incorrect ones, we caution against the use of this type of regularisation in DynaMight. Therefore, in what follows, we only used the less informative, smoothness prior on the deformations.</p></sec><sec id="S9"><title>DynaMight estimates motion and improves maps of inner kinetochore complexes</title><p id="P31">Next, we demonstrate the usefulness of DynaMight on two cryo-EM data sets of the yeast inner kinetochore [<xref ref-type="bibr" rid="R26">26</xref>].</p><p id="P32">The first data set comprises 100,311 particles of the monomeric constitutive centromere associated network (CCAN) complex bound to a CENP-A nucleosome. For this data set, we trained the half-set VAEs for 220 epochs and we used a 10-dimensional latent space. The estimated 3D deformations are distributed uniformly in latent space (<xref ref-type="fig" rid="F4">Fig 4A</xref>), without specifically clustered conformational states, suggesting that the motions in the data set are mainly of a continuous nature. Analysis of the motions revealed that the nucleosome is rotating in different directions relative to the rest of the complex, and that these rotations co-exist with the up and down bending of the Nkp1, Nkp2, CENP-Q and CENP-U subunits (arrows in <xref ref-type="fig" rid="F4">Figure 4B</xref> and Supplementary Video 1). The reconstruction from deformed backprojection improved local resolutions compared to the consensus map from standard RELION refinement, with clear improvements in the features for both protein and DNA (<xref ref-type="fig" rid="F4">Fig 4C</xref>).</p><p id="P33">The second data comprises 108,672 particles of the complete yeast inner kinetochore complex assembled onto the CENP-A nucleosome. Training of the VAE was done for 290 epochs, and the dimensionality of the latent space was again set to 10. Again, a continuous distribution of deformations in latent space suggests continuous structural flexibility (<xref ref-type="fig" rid="F5">Fig 5A</xref>). Analysis of the deformations revealed large relative motions between different regions of the complex. Different states of the complex are depicted in <xref ref-type="fig" rid="F5">Fig 5A</xref> and Supplementary Video 2. Deformed backprojection resulted in a map with improved local resolution and protein and DNA features compared to the map from consensus refinement (<italic>cf</italic>. <xref ref-type="fig" rid="F5">Fig 5B-C</xref>).</p><p id="P34">Because this complex, with a molecular weight of 1.5 MDa, is large enough to divide into multiple independently moving rigid bodies, we also applied multi-body refinement [<xref ref-type="bibr" rid="R5">5</xref>] to this data set. We used the four bodies illustrated in <xref ref-type="fig" rid="F5">Fig 5D</xref>; body 1 (orange): CCAN<sub>Topo</sub>, body 2 (light green): <inline-formula><mml:math id="M16"><mml:mrow><mml:msup><mml:mrow><mml:mtext>CCAN</mml:mtext></mml:mrow><mml:mrow><mml:mtext>Non</mml:mtext><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mtext>topo</mml:mtext></mml:mrow><mml:mtext>Δ</mml:mtext></mml:msub><mml:mtext>CENP</mml:mtext><mml:mo>−</mml:mo><mml:mtext>I</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mtext>Body</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.2em"/></mml:mrow></mml:msup></mml:mrow></mml:math></inline-formula>, body 3 (yellow): CBF3<sub>Core</sub>+CENP-I<sub>Body</sub> and body 4 (dark green): CENP-A<sub>Nuc</sub>). The local resolutions resulting from multi-body refinement (<xref ref-type="fig" rid="F5">Fig 5D</xref>) are better than those from the deformed backprojection reconstruction of DynaMight, illustrating that there is still room for fur-ther development of the latter.</p><p id="P35">Training of the VAEs took around 17 and 27 hours on an NVIDIA A100 GPU for the monomeric and dimeric datasets with particle box sizes of 320 and 360. Estimating the inverse deformations took ∼ 6 hours and performing the reconstruction ∼ 9 and ∼ 13 hours respectively.</p></sec></sec><sec id="S10" sec-type="discussion"><title>Discussion</title><p id="P36">How to deal with continuous conformational heterogeneity remains a rapidly developing topic in cryo-EM single-particle analysis. As outlined in the Introduction, and recently reviewed in [<xref ref-type="bibr" rid="R27">27</xref>], multiple approaches from different labs have been proposed. In this paper we present a new approach, called DynaMight, which consists of two VAEs that are trained independently on half-sets to estimate displacements of a Gaussian model and a modified weighted backprojection algorithm to correct for the estimated deformations. We show for two data sets on the yeast inner kinetochore that DynaMight is useful in improving cryo-EM maps of macromolecular complexes that exhibit large amounts of flexibility. However, as we also show in this paper, there is still obvious scope for further improvements, of DynaMight in particular, and how to deal with continuous structural heterogeneity in general.</p><p id="P37">Because of the high levels of experimental noise and the large amount of parameters needed to describe continuous structural flexibility in the particles, an obvious way to improve these methods is the incorporation of prior knowledge. However, our results on the spliceosomal B complex show that such approaches are not without risk. We observe that there are enough parameters in DynaMight’s neural networks to result in deformation fields that, when used in deformed backprojection, will reproduce incorrect features from the consensus model that is used to regularise these deformations. That model bias may play a role is perhaps not surprising, given that similar observations have been made for standard (structurally homogeneous) refinement, where only five parameters (three rotations and two translations) are used for every particle. The total number of parameters in DynaMight’s VAE is approximately 10 million, which results in considerably higher numbers of parameter per particle for typical data sets. We do not believe that the risk of overfitting exists only in DynaMight. Other approaches that describe structural heterogeneity in the data set with large neural networks, or other approaches with high numbers of parameters per particle, like cryoDRGN [<xref ref-type="bibr" rid="R9">9</xref>], Zernike3D [<xref ref-type="bibr" rid="R13">13</xref>], Flex3D [<xref ref-type="bibr" rid="R12">12</xref>], will probably also be susceptible to these problems. The development of validation procedures will thus be important. In DynaMight, we chose to not use atomic models for regularisation of the deformations, as potential model bias towards those models takes away the possibility to validate the map by the appearance of protein-like features. The exploration of more sophisticated methods, where part of the information of atomic models is used and other parts are set aside for validation, may yield better methods, while still allowing proper validation.</p><p id="P38">Because model bias may affect the estimation of deformation fields, over-estimation of the resolution of reconstructions that correct for these deformations may represent another pitfall. Resolutions are typically measured by Fourier shell correlation between two half-sets. However, if deformations have been estimated jointly for both half-sets, with the same reference map as origin, then incorrect features from the reference model may be reproduced in both half-reconstructions, resulting in inflated FSC curves and over-estimation of resolution. By training two independent VAEs with separate consensus models for both half-sets, similar to ”gold-standard” approaches in standard refinement [<xref ref-type="bibr" rid="R28">28</xref>, <xref ref-type="bibr" rid="R29">29</xref>], this risk is avoided in DynaMight.</p><p id="P39">Training two VAEs independently on two half-sets of the data also offers an opportunity to estimate the uncertainty in the estimated deformations. Although in recent years multiple methods have been proposed to analyse molecular motions in cryo-EM data sets, less consideration has been given to what extent these motions can be trusted. Error estimates on the deformations can be obtained for a subset of the particles (we used 10% in <xref ref-type="fig" rid="F6">Figure 6</xref>), by excluding this subset from the training of the decoders, and only using it for training its embedding to latent space. For each particle in this subset, one obtains an embedding with both separate encoders to obtain a latent representation for the corresponding decoder. Applying both decoders to get the displacements of either of the consensus models then leads to two independent estimates of the deformations for the particles in the subset. The difference between these two estimates provide an estimate of the errors in them. We illustrate this procedure in <xref ref-type="fig" rid="F6">Fig 6B</xref>, where we observe that the errors in the deformations vary among particles and among different regions of the monomeric CCAN-CENP-A nucleosome complex. Future developments in regularisation methods as described above may benefit from considering estimated errors in the deformations.</p><p id="P40">Besides estimation of deformations, DynaMight also implements a new reconstruction algorithm that aims to correct for the deformations through the reconstruction of an improved consensus map. Reconstruction via (7) only gives an approximation of the minimizer of the convex problem (6). Although it is therefore not guaranteed to yield a useful solution, in practice we observe that DynaMight results in maps with improved local resolutions compared to the standard RELION reconstruction algorithm that assumes structural homogeneity. Nevertheless, our observations that multi-body refinement yields better local resolutions for the complete inner kinetochore complex suggest that there is still room for improvement. It is possible that iterative real-space methods like stochastic gradient descent or algebraic reconstruction techniques, as im-plemented in Flex3D [<xref ref-type="bibr" rid="R12">12</xref>] or Zernike 3D [<xref ref-type="bibr" rid="R13">13</xref>], may yield better results. But the iterative approaches would be even more computationally expensive than our weighted backpro-jection approach, as they may require multiple sweeps through the data and often need optimisation of hyperparameters like the step size. Alternatively, the results with multibody refinement suggest that it may be possible to divide each particle into many smaller “bodies”, and to insert Fourier slices of each of these bodies using orientations that are a combination of the consensus orientation and the average deformation field at that region.</p><p id="P41">Although many possibilities for improvements still exist, we believe that the current implementation of DynaMight will already be useful. Unlike multi-body refinement, there is no clear minimum of size of moving parts in DynaMight and there is no need for the design of masks that delineate the bodies. In fact, analysis of deformations estimated by DynaMight may assist users to define those masks for subsequent multi-body refinements. The implementation inside RELION-5 will make DynaMight easily accessible to many users, and its wider application will provide feedback for future developments of even better tools to analyse molecular motions in biological macromolecules. The unresolved challenges of how to exploit more prior knowledge, while preventing the pitfalls of model bias, as explored in this paper, imply that this topic will remain an active area of research.</p></sec></body><back><ack id="S11"><title>Acknowledgements</title><p>We thank Jake Grimmett, Toby Darling and Ivan Clayson for help with high-performance computing; Carlos Esteve Yagüe, Willem Dieperveen, Carola Schönlieb, Ozan Öktem and Kiarash Jamali for helpful discussions; and David Barford for critical reading of the manuscript. This work was supported by the Medical Research Council (MRC), as part of United Kingdom Research and Innovation (UKRI) (MC UP A025 1013 to S.H.W.S.); and by Wave 1 of The UKRI Strategic Priorities Fund under the EPSRC Grant EP/W006022/1, particularly the ”AI for Science” theme within that grant &amp; The Alan Turing Institute. The contribution of T.D. was funded by Cancer Research UK (C576/A14109) and UKRI (MC UP 1201/6) to David Barford. For the purpose of open access, the MRC Laboratory of Molecular Biology has applied a CC BY public copyright licence to any Author Accepted Manuscript version arising.</p></ack><sec id="S12" sec-type="data-availability"><title>Code availability</title><p id="P42">DynaMight is distributed for free under a BSD license and can be downloaded from <ext-link ext-link-type="uri" xlink:href="https://github.com/3dem/DynaMight">https://github.com/3dem/DynaMight</ext-link>. It is installed automatically with RELION-5.</p></sec><fn-group><fn fn-type="con" id="FN1"><p id="P43"><bold>Author contributions</bold></p><p id="P44">J.S. designed and implemented Dynamight, ran all experiments and analysed results; D.K. helped with the design and implementation of Dynamight; A.B. provided help with Python and Napari; T.D. and D.B. provided and analysed yeast kinetochore data; S.H.W.S. provided help with RELION and supervised the project. All authors contributed to writing of the manuscript.</p></fn><fn fn-type="conflict" id="FN2"><p id="P45"><bold>Competing interests</bold></p><p id="P46">The authors declare no competing interests.</p></fn></fn-group><ref-list><ref id="R1"><label>[1]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname><given-names>SH</given-names></name></person-group><article-title>Processing of structurally heterogeneous cryo-em data in relion</article-title><source>Methods in enzymology</source><year>2016</year><volume>579</volume><fpage>125</fpage><lpage>157</lpage><pub-id pub-id-type="pmid">27572726</pub-id></element-citation></ref><ref id="R2"><label>[2]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Frank</surname><given-names>J</given-names></name><name><surname>Ourmazd</surname><given-names>A</given-names></name></person-group><article-title>Continuous changes in structure mapped by manifold embedding of single-particle data in cryo-em</article-title><source>Methods</source><year>2016</year><volume>100</volume><fpage>61</fpage><lpage>67</lpage><pub-id pub-id-type="pmcid">PMC4848141</pub-id><pub-id pub-id-type="pmid">26884261</pub-id><pub-id pub-id-type="doi">10.1016/j.ymeth.2016.02.007</pub-id></element-citation></ref><ref id="R3"><label>[3]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dashti</surname><given-names>A</given-names></name><name><surname>Schwander</surname><given-names>P</given-names></name><name><surname>Langlois</surname><given-names>R</given-names></name><name><surname>Fung</surname><given-names>R</given-names></name><name><surname>Li</surname><given-names>W</given-names></name><name><surname>Hosseinizadeh</surname><given-names>A</given-names></name><name><surname>Liao</surname><given-names>HY</given-names></name><name><surname>Pallesen</surname><given-names>J</given-names></name><name><surname>Sharma</surname><given-names>G</given-names></name><name><surname>Stupina</surname><given-names>VA</given-names></name><etal/></person-group><article-title>Trajectories of the ribosome as a brownian nanomachine</article-title><source>Proceedings of the National Academy of Sciences</source><year>2014</year><volume>111</volume><issue>49</issue><fpage>17492</fpage><lpage>17497</lpage><pub-id pub-id-type="pmcid">PMC4267381</pub-id><pub-id pub-id-type="pmid">25422471</pub-id><pub-id pub-id-type="doi">10.1073/pnas.1419276111</pub-id></element-citation></ref><ref id="R4"><label>[4]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dashti</surname><given-names>A</given-names></name><name><surname>Mashayekhi</surname><given-names>G</given-names></name><name><surname>Shekhar</surname><given-names>M</given-names></name><name><surname>Ben Hail</surname><given-names>D</given-names></name><name><surname>Salah</surname><given-names>S</given-names></name><name><surname>Schwander</surname><given-names>P</given-names></name><name><surname>des Georges</surname><given-names>A</given-names></name><name><surname>Singharoy</surname><given-names>A</given-names></name><name><surname>Frank</surname><given-names>J</given-names></name><name><surname>Ourmazd</surname><given-names>A</given-names></name></person-group><article-title>Retrieving functional pathways of biomolecules from single-particle snapshots</article-title><source>Nature communications</source><year>2020</year><volume>11</volume><issue>1</issue><elocation-id>4734</elocation-id><pub-id pub-id-type="pmcid">PMC7501871</pub-id><pub-id pub-id-type="pmid">32948759</pub-id><pub-id pub-id-type="doi">10.1038/s41467-020-18403-x</pub-id></element-citation></ref><ref id="R5"><label>[5]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nakane</surname><given-names>T</given-names></name><name><surname>Kimanius</surname><given-names>D</given-names></name><name><surname>Lindahl</surname><given-names>E</given-names></name><name><surname>Scheres</surname><given-names>SH</given-names></name></person-group><article-title>Characterisation of molecular motions in cryo-em single-particle data by multi-body refinement in relion</article-title><source>elife</source><year>2018</year><volume>7</volume><elocation-id>e36861</elocation-id><pub-id pub-id-type="pmcid">PMC6005684</pub-id><pub-id pub-id-type="pmid">29856314</pub-id><pub-id pub-id-type="doi">10.7554/eLife.36861</pub-id></element-citation></ref><ref id="R6"><label>[6]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bai</surname><given-names>X-c</given-names></name><name><surname>Rajendra</surname><given-names>E</given-names></name><name><surname>Yang</surname><given-names>G</given-names></name><name><surname>Shi</surname><given-names>Y</given-names></name><name><surname>Scheres</surname><given-names>SH</given-names></name></person-group><article-title>Sampling the conformational space of the catalytic subunit of human γ-secretase</article-title><source>elife</source><year>2015</year><volume>4</volume><elocation-id>e11182</elocation-id><pub-id pub-id-type="pmcid">PMC4718806</pub-id><pub-id pub-id-type="pmid">26623517</pub-id><pub-id pub-id-type="doi">10.7554/eLife.11182</pub-id></element-citation></ref><ref id="R7"><label>[7]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhou</surname><given-names>Q</given-names></name><name><surname>Huang</surname><given-names>X</given-names></name><name><surname>Sun</surname><given-names>S</given-names></name><name><surname>Li</surname><given-names>X</given-names></name><name><surname>Wang</surname><given-names>H-W</given-names></name><name><surname>Sui</surname><given-names>S-F</given-names></name></person-group><article-title>Cryo-em structure of snap-snare assembly in 20s particle</article-title><source>Cell Research</source><year>2015</year><volume>25</volume><issue>5</issue><fpage>551</fpage><lpage>560</lpage><pub-id pub-id-type="pmcid">PMC4423085</pub-id><pub-id pub-id-type="pmid">25906996</pub-id><pub-id pub-id-type="doi">10.1038/cr.2015.47</pub-id></element-citation></ref><ref id="R8"><label>[8]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ilca</surname><given-names>SL</given-names></name><name><surname>Kotecha</surname><given-names>A</given-names></name><name><surname>Sun</surname><given-names>X</given-names></name><name><surname>Poranen</surname><given-names>MM</given-names></name><name><surname>Stuart</surname><given-names>DI</given-names></name><name><surname>Huisko-nen</surname><given-names>JT</given-names></name></person-group><article-title>Localized reconstruction of subunits from electron cryomicroscopy images of macromolecular complexes</article-title><source>Nature communications</source><year>2015</year><volume>6</volume><issue>1</issue><elocation-id>8843</elocation-id><pub-id pub-id-type="pmcid">PMC4667630</pub-id><pub-id pub-id-type="pmid">26534841</pub-id><pub-id pub-id-type="doi">10.1038/ncomms9843</pub-id></element-citation></ref><ref id="R9"><label>[9]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhong</surname><given-names>ED</given-names></name><name><surname>Bepler</surname><given-names>T</given-names></name><name><surname>Berger</surname><given-names>B</given-names></name><name><surname>Davis</surname><given-names>JH</given-names></name></person-group><article-title>Cryodrgn: reconstruction of heterogeneous cryo-em structures using neural networks</article-title><source>Nature methods</source><year>2021</year><volume>18</volume><issue>2</issue><fpage>176</fpage><lpage>185</lpage><pub-id pub-id-type="pmcid">PMC8183613</pub-id><pub-id pub-id-type="pmid">33542510</pub-id><pub-id pub-id-type="doi">10.1038/s41592-020-01049-4</pub-id></element-citation></ref><ref id="R10"><label>[10]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>M</given-names></name><name><surname>Ludtke</surname><given-names>SJ</given-names></name></person-group><article-title>Deep learning-based mixed-dimensional gaussian mixture model for characterizing variability in cryo-em</article-title><source>Nature methods</source><year>2021</year><volume>18</volume><issue>8</issue><fpage>930</fpage><lpage>936</lpage><pub-id pub-id-type="pmcid">PMC8363932</pub-id><pub-id pub-id-type="pmid">34326541</pub-id><pub-id pub-id-type="doi">10.1038/s41592-021-01220-5</pub-id></element-citation></ref><ref id="R11"><label>[11]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kimanius</surname><given-names>D</given-names></name><name><surname>Jamali</surname><given-names>K</given-names></name><name><surname>Scheres</surname><given-names>S</given-names></name></person-group><article-title>Sparse fourier backpropagation in cryoem reconstruction</article-title><source>Advances in Neural Information Processing Systems</source><year>2022</year><volume>35</volume><fpage>12395</fpage><lpage>12408</lpage></element-citation></ref><ref id="R12"><label>[12]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Punjani</surname><given-names>A</given-names></name><name><surname>Fleet</surname><given-names>DJ</given-names></name></person-group><article-title>3dflex: determining structure and motion of flexible proteins from cryo-em</article-title><source>Nature Methods</source><year>2023</year><fpage>1</fpage><lpage>11</lpage><pub-id pub-id-type="pmcid">PMC10250194</pub-id><pub-id pub-id-type="pmid">37169929</pub-id><pub-id pub-id-type="doi">10.1038/s41592-023-01853-8</pub-id></element-citation></ref><ref id="R13"><label>[13]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Herreros</surname><given-names>D</given-names></name><name><surname>Lederman</surname><given-names>R</given-names></name><name><surname>Krieger</surname><given-names>J</given-names></name><name><surname>Jiménez-Moreno</surname><given-names>A</given-names></name><name><surname>Martínez</surname><given-names>M</given-names></name><name><surname>Myška</surname><given-names>D</given-names></name><name><surname>Strelak</surname><given-names>D</given-names></name><name><surname>Filipovic</surname><given-names>J</given-names></name><name><surname>Sorzano</surname><given-names>C</given-names></name><name><surname>Carazo</surname><given-names>J</given-names></name></person-group><article-title>Estimating conformational landscapes from cryo-em particles by 3d zernike polynomials</article-title><source>Nature Communications</source><year>2023</year><volume>14</volume><issue>1</issue><fpage>154</fpage><pub-id pub-id-type="pmcid">PMC9832421</pub-id><pub-id pub-id-type="pmid">36631472</pub-id><pub-id pub-id-type="doi">10.1038/s41467-023-35791-y</pub-id></element-citation></ref><ref id="R14"><label>[14]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhong</surname><given-names>ED</given-names></name><name><surname>Lerer</surname><given-names>A</given-names></name><name><surname>Davis</surname><given-names>JH</given-names></name><name><surname>Berger</surname><given-names>B</given-names></name></person-group><article-title>Exploring generative atomic models in cryo-em reconstruction</article-title><source>arXiv preprint</source><year>2021</year><elocation-id>arXiv:2107.01331</elocation-id></element-citation></ref><ref id="R15"><label>[15]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>M</given-names></name><name><surname>Toader</surname><given-names>B</given-names></name><name><surname>Lederman</surname><given-names>R</given-names></name></person-group><article-title>Integrating molecular models into cryoem heterogeneity analysis using scalable high-resolution deep gaussian mixture models</article-title><source>Journal of Molecular Biology</source><year>2023</year><volume>435</volume><issue>9</issue><elocation-id>168014</elocation-id><pub-id pub-id-type="pmcid">PMC10164680</pub-id><pub-id pub-id-type="pmid">36806476</pub-id><pub-id pub-id-type="doi">10.1016/j.jmb.2023.168014</pub-id></element-citation></ref><ref id="R16"><label>[16]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Paszke</surname><given-names>A</given-names></name><name><surname>Gross</surname><given-names>S</given-names></name><name><surname>Massa</surname><given-names>F</given-names></name><name><surname>Lerer</surname><given-names>A</given-names></name><name><surname>Bradbury</surname><given-names>J</given-names></name><name><surname>Chanan</surname><given-names>G</given-names></name><name><surname>Killeen</surname><given-names>T</given-names></name><name><surname>Lin</surname><given-names>Z</given-names></name><name><surname>Gimelshein</surname><given-names>N</given-names></name><name><surname>Antiga</surname><given-names>L</given-names></name><etal/></person-group><article-title>Pytorch: An imperative style, high-performance deep learning library</article-title><source>Advances in neural information processing systems</source><year>2019</year><volume>32</volume></element-citation></ref><ref id="R17"><label>[17]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chiu</surname><given-names>C-L</given-names></name><name><surname>Clack</surname><given-names>N</given-names></name><etal/></person-group><article-title>napari: a python multi-dimensional image viewer plat-form for the research community</article-title><source>Microscopy and Microanalysis</source><year>2022</year><volume>28</volume><issue>S1</issue><fpage>1576</fpage><lpage>1577</lpage></element-citation></ref><ref id="R18"><label>[18]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Plaschka</surname><given-names>C</given-names></name><name><surname>Lin</surname><given-names>P-C</given-names></name><name><surname>Nagai</surname><given-names>K</given-names></name></person-group><article-title>Structure of a pre-catalytic spliceosome</article-title><source>Nature</source><year>2017</year><volume>546</volume><issue>7660</issue><fpage>617</fpage><lpage>621</lpage><pub-id pub-id-type="pmcid">PMC5503131</pub-id><pub-id pub-id-type="pmid">28530653</pub-id><pub-id pub-id-type="doi">10.1038/nature22799</pub-id></element-citation></ref><ref id="R19"><label>[19]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Iudin</surname><given-names>A</given-names></name><name><surname>Korir</surname><given-names>PK</given-names></name><name><surname>Salavert-Torres</surname><given-names>J</given-names></name><name><surname>Kleywegt</surname><given-names>GJ</given-names></name><name><surname>Patwardhan</surname><given-names>A</given-names></name></person-group><article-title>Empiar: a public archive for raw electron microscopy image data</article-title><source>Nature methods</source><year>2016</year><volume>13</volume><issue>5</issue><fpage>387</fpage><lpage>388</lpage><pub-id pub-id-type="pmid">27067018</pub-id></element-citation></ref><ref id="R20"><label>[20]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kimanius</surname><given-names>D</given-names></name><name><surname>Dong</surname><given-names>L</given-names></name><name><surname>Sharov</surname><given-names>G</given-names></name><name><surname>Nakane</surname><given-names>T</given-names></name><name><surname>Scheres</surname><given-names>SH</given-names></name></person-group><article-title>New tools for automated cryo-em single-particle analysis in relion-4.0</article-title><source>Biochemical Journal</source><year>2021</year><volume>478</volume><issue>24</issue><fpage>4169</fpage><lpage>4185</lpage><pub-id pub-id-type="pmcid">PMC8786306</pub-id><pub-id pub-id-type="pmid">34783343</pub-id><pub-id pub-id-type="doi">10.1042/BCJ20210708</pub-id></element-citation></ref><ref id="R21"><label>[21]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Henderson</surname><given-names>R</given-names></name></person-group><article-title>Avoiding the pitfalls of single particle cryo-electron microscopy: Einstein from noise</article-title><source>Proceedings of the National Academy of Sciences</source><year>2013</year><volume>110</volume><issue>45</issue><fpage>18037</fpage><lpage>18041</lpage><pub-id pub-id-type="pmcid">PMC3831464</pub-id><pub-id pub-id-type="pmid">24106306</pub-id><pub-id pub-id-type="doi">10.1073/pnas.1314449110</pub-id></element-citation></ref><ref id="R22"><label>[22]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Subramaniam</surname><given-names>S</given-names></name></person-group><article-title>Structure of trimeric hiv-1 envelope glycoproteins</article-title><source>Proceedings of the National Academy of Sciences</source><year>2013</year><volume>110</volume><issue>45</issue><fpage>E4172</fpage><lpage>E4174</lpage><pub-id pub-id-type="pmcid">PMC3831457</pub-id><pub-id pub-id-type="pmid">24106302</pub-id><pub-id pub-id-type="doi">10.1073/pnas.1313802110</pub-id></element-citation></ref><ref id="R23"><label>[23]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van Heel</surname><given-names>M</given-names></name></person-group><article-title>Finding trimeric hiv-1 envelope glycoproteins in random noise</article-title><source>Proceedings of the National Academy of Sciences</source><year>2013</year><volume>110</volume><issue>45</issue><fpage>E4175</fpage><lpage>E4177</lpage><pub-id pub-id-type="pmcid">PMC3831429</pub-id><pub-id pub-id-type="pmid">24106301</pub-id><pub-id pub-id-type="doi">10.1073/pnas.1314353110</pub-id></element-citation></ref><ref id="R24"><label>[24]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hu</surname><given-names>X</given-names></name><name><surname>Yang</surname><given-names>P</given-names></name><name><surname>Chai</surname><given-names>C</given-names></name><name><surname>Liu</surname><given-names>J</given-names></name><name><surname>Sun</surname><given-names>H</given-names></name><name><surname>Wu</surname><given-names>Y</given-names></name><name><surname>Zhang</surname><given-names>M</given-names></name><name><surname>Zhang</surname><given-names>M</given-names></name><name><surname>Liu</surname><given-names>X</given-names></name><name><surname>Yu</surname><given-names>H</given-names></name></person-group><article-title>Structural and mechanistic insights into fungal β-1, 3-glucan synthase fks1</article-title><source>Nature</source><year>2023</year><volume>616</volume><issue>7955</issue><fpage>190</fpage><lpage>198</lpage><pub-id pub-id-type="pmcid">PMC10032269</pub-id><pub-id pub-id-type="pmid">36949198</pub-id><pub-id pub-id-type="doi">10.1038/s41586-023-05856-5</pub-id></element-citation></ref><ref id="R25"><label>[25]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chacko</surname><given-names>BM</given-names></name><name><surname>Qin</surname><given-names>B</given-names></name><name><surname>Correia</surname><given-names>JJ</given-names></name><name><surname>Lam</surname><given-names>SS</given-names></name><name><surname>de Caestecker</surname><given-names>MP</given-names></name><name><surname>Lin</surname><given-names>K</given-names></name></person-group><article-title>The l3 loop and c-terminal phosphorylation jointly define smad protein trimerization</article-title><source>Nature structural biology</source><year>2001</year><volume>8</volume><issue>3</issue><fpage>248</fpage><lpage>253</lpage><pub-id pub-id-type="pmid">11224571</pub-id></element-citation></ref><ref id="R26"><label>[26]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dendooven</surname><given-names>T</given-names></name><name><surname>Zhang</surname><given-names>Z</given-names></name><name><surname>Yang</surname><given-names>J</given-names></name><name><surname>McLaughlin</surname><given-names>SH</given-names></name><name><surname>Schwab</surname><given-names>J</given-names></name><name><surname>Scheres</surname><given-names>SH</given-names></name><name><surname>Yatskevich</surname><given-names>S</given-names></name><name><surname>Barford</surname><given-names>D</given-names></name></person-group><article-title>Cryo-em structure of the complete inner kinetochore of the budding yeast point centromere</article-title><source>Science Advances</source><year>2023</year><volume>9</volume><issue>30</issue><elocation-id>eadg7480</elocation-id><pub-id pub-id-type="pmcid">PMC10381965</pub-id><pub-id pub-id-type="pmid">37506202</pub-id><pub-id pub-id-type="doi">10.1126/sciadv.adg7480</pub-id></element-citation></ref><ref id="R27"><label>[27]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Toader</surname><given-names>B</given-names></name><name><surname>Sigworth</surname><given-names>FJ</given-names></name><name><surname>Lederman</surname><given-names>RR</given-names></name></person-group><article-title>Methods for cryo-em single particle reconstruction of macromolecules having continuous heterogeneity</article-title><source>Journal of Molecular Biology</source><year>2023</year><volume>435</volume><issue>9</issue><elocation-id>168020</elocation-id><pub-id pub-id-type="pmcid">PMC10164696</pub-id><pub-id pub-id-type="pmid">36863660</pub-id><pub-id pub-id-type="doi">10.1016/j.jmb.2023.168020</pub-id></element-citation></ref><ref id="R28"><label>[28]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Henderson</surname><given-names>R</given-names></name><name><surname>Sali</surname><given-names>A</given-names></name><name><surname>Baker</surname><given-names>ML</given-names></name><name><surname>Carragher</surname><given-names>B</given-names></name><name><surname>Devkota</surname><given-names>B</given-names></name><name><surname>Downing</surname><given-names>KH</given-names></name><name><surname>Egelman</surname><given-names>EH</given-names></name><name><surname>Feng</surname><given-names>Z</given-names></name><name><surname>Frank</surname><given-names>J</given-names></name><name><surname>Grigorieff</surname><given-names>N</given-names></name><etal/></person-group><article-title>Outcome of the first electron microscopy validation task force meeting</article-title><source>Structure</source><year>2012</year><volume>20</volume><issue>2</issue><fpage>205</fpage><lpage>214</lpage><pub-id pub-id-type="pmcid">PMC3328769</pub-id><pub-id pub-id-type="pmid">22325770</pub-id><pub-id pub-id-type="doi">10.1016/j.str.2011.12.014</pub-id></element-citation></ref><ref id="R29"><label>[29]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheres</surname><given-names>SH</given-names></name><name><surname>Chen</surname><given-names>S</given-names></name></person-group><article-title>Prevention of overfitting in cryo-em structure determination</article-title><source>Nature methods</source><year>2012</year><volume>9</volume><issue>9</issue><fpage>853</fpage><lpage>854</lpage><pub-id pub-id-type="pmcid">PMC4912033</pub-id><pub-id pub-id-type="pmid">22842542</pub-id><pub-id pub-id-type="doi">10.1038/nmeth.2115</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>Schematic illustration of DynaMight.</title><p>Two separate encoders take experimental images from each half set as input, and output a latent vector describing their conformational state. The decoders take the latent vectors together with the coordinates of Gaussian models for the consensus structures for each half set and generate a 3D deformation field for those Gaussians. The deformed models are then projected and compared to the experimental image in the loss function. At the end of the procedure, an approximation to the inverse deformation is used for reconstruction of an improved consensus map for each half set.</p></caption><graphic xlink:href="EMS189893-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>DynaMight reconstructions of the spliceosome subset.</title><p><bold>a</bold> Standard RELION consensus refinement; <bold>b</bold> DynaMight without regularisation; <bold>c</bold> Dy-naMight with smoothness regularisation on the Gaussians; <bold>d</bold> DynaMight with regularisation from an atomic model. All maps are coloured according to local resolution, as indicated by the colour bar.</p></caption><graphic xlink:href="EMS189893-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>Using incorrect atomic models in DynaMight.</title><p><bold>A</bold> Reconstruction after deformed backprojection using the correct atomic model for the SF3a region, colored by local resolution (right). The correct atomic model for the SF3a region is shown in green in the top left; an overlay of that model with the reconstructed density after deformed backprojection is shown in the bottom left. <bold>B</bold>: As in A, but using an incorrect atomic model for the SF3a region (shown in red). <bold>C</bold>: FSC curves between the maps in panels A or B, masked around the SF3a region, and the correct (green) or incorrect (red) atomic models. <bold>D-F</bold> As in A-C, but using different atomic models for the SF3b region.</p></caption><graphic xlink:href="EMS189893-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>DynaMight results for the monomeric CCAN complex.</title><p><bold>a:</bold> PCA of the conformational latent space, with coloured dots indicating the positions of the five maps in panel b. <bold>b</bold> Five conformational states of the complex. One state, in red, is shown in all four panels. The colours of the five maps are the same as the colours of their corresponding dots in panel a. The <bold>c:</bold> Reconstructions from standard RELION consensus refinement (left) and the improved reconstruction using DynaMight (right). Both maps are coloured according to local resolution, as indicated by the colour bar.</p></caption><graphic xlink:href="EMS189893-f004"/></fig><fig id="F5" position="float"><label>Figure 5</label><caption><title>DynaMight results for the complete kinetochore complex.</title><p><bold>a:</bold> PCA of the conformational space (on the left) with highlighted positions of five conformation states, the maps of which are shown in the same colours on the right. <bold>b:</bold> Maps from standard RELION consensus refinement, <bold>c:</bold> DynaMight reconstruction, and <bold>d:</bold> reconstruction using RELION multibody refinement. The outline regions in the latter show the four bodies that were used for multibody refinement. The maps in <bold>b-d</bold> are colored by local resolution, as indicated by the colour bar.</p></caption><graphic xlink:href="EMS189893-f005"/></fig><fig id="F6" position="float"><label>Figure 6</label><caption><title>Error estimation for the deformations.</title><p><bold>a:</bold> Particles of a validation subset (here 10% of the particles) are fed into both encoders. The encoders are updated, whereas these images are not used for training the decoder. At evaluation time both decoders can be evaluated for the consensus models (purple for the consensus model of half set 1 and blue for the consensus model of half set 2). The resulting displacements can be compared. <bold>b:</bold> Example deformation fields for four particles. The radius of the sphere (coloured by size from blue to pink) at the end of the deformations (black arrows) is determined by the norm of the difference of the deformations from the two decoders.</p></caption><graphic xlink:href="EMS189893-f006"/></fig></floats-group></article>