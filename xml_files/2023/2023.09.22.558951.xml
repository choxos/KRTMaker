<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS188460</article-id><article-id pub-id-type="doi">10.1101/2023.09.22.558951</article-id><article-id pub-id-type="archive">PPR729547</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">2</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>The evolution of environmentally mediated social interactions and posthumous spite under isolation by distance</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Mullon</surname><given-names>Charles</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Peña</surname><given-names>Jorge</given-names></name><xref ref-type="aff" rid="A2">2</xref><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Lehmann</surname><given-names>Laurent</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><aff id="A1"><label>1</label>Department of Ecology and Evolution, University of Lausanne, Switzerland</aff><aff id="A2"><label>2</label>Department of Social and Behavioral Sciences, Toulouse School of Economics, France</aff><aff id="A3"><label>3</label>Institute for Advanced Study in Toulouse, France</aff><aff id="A4"><label>4</label>Department of Human Behavior, Ecology and Culture, Max Planck Institute for Evolutionary Anthropology, Germany</aff></contrib-group><pub-date pub-type="nihms-submitted"><day>25</day><month>09</month><year>2023</year></pub-date><pub-date pub-type="preprint"><day>23</day><month>09</month><year>2023</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Many social interactions happen indirectly via modifications of the environment, e.g. through the secretion of functional compounds or the depletion of renewable resources. Here, we derive the selection gradient on a quantitative trait affecting dynamical environmental variables that feed back on reproduction and survival in a finite patch-structured population subject to isolation by distance. Our analysis shows that the selection gradient depends on how a focal individual influences the fitness of all future individuals in the population through modifications of the environmental variables they experience, weighted by the neutral relatedness between recipients and the focal. The evolutionary relevant trait-driven environmental modifications are formalized as the extended phenotypic effects of an individual, quantifying how a trait change in an individual in the present affects the environmental variables in all patches at all future times. When the trait affects reproduction and survival through a payoff function, the selection gradient can be expressed in terms of extended phenotypic effects weighted by scaled-relatedness. We show how to compute extended phenotypic effects, relatedness, and scaled-relatedness using Fourier analysis, which allow us to investigate a broad class of environmentally mediated social interactions in a tractable way. We use our approach to study the evolution of a trait controlling the costly production of some lasting commons (e.g. a common-pool resource or a toxic compound) that can diffuse in space and persist in time. We show that indiscriminate posthumous spite can evolve readily in this scenario, though more generally whether selection favours environmentally mediated altruism or spite is determined by the spatial correlation between an individual’s lineage and the commons originating from its patch. The sign of this correlation depends on interactions between dispersal patterns and the commons’ renewal dynamics. More broadly, we suggest that selection can favour a wide range of social behaviours when these have carry-over effects in space and time.</p></abstract><kwd-group><kwd>Adaptive dynamics</kwd><kwd>Inclusive Fitness</kwd><kwd>Metacommunity</kwd><kwd>Extended Phenotype</kwd><kwd>Altruism</kwd><kwd>Spite</kwd></kwd-group></article-meta></front><body><sec id="S1" sec-type="intro"><label>1</label><title>Introduction</title><p id="P2">Organisms continually interact with one another in ways that significantly impact their survival and reproduction. Such social interactions are incredibly diverse. Still, they can usefully be classified as to whether they occur directly between individuals, such as grooming or fighting over resources, or as to whether they are indirectly mediated by environmental modifications, such as through the depletion or enrichment of resources, or the release or detoxification of pollutants [<xref ref-type="bibr" rid="R1">1</xref>]. Direct social interactions thus take place among contemporaries who are physically close to one another, while environmentally mediated interactions can extend much further in space and time. When environmental modifications have long-lasting and long-ranging effects, indirect social interactions may occur between individuals whose lifetimes show little or no overlap. This may lead to forms of trans-generational helping (e.g. when the underconsumption of a slowly renewable resource ensures healthy stock maintenance for future generations) or harming (e.g. when overconsumption leads to stock collapse and poor harvest in the future). An extreme form of such trans-generational social behaviour is posthumous altruism, which is a behaviour that results in a net reduction of the survival and/or reproduction of an actor to benefit only recipients living beyond the actor’s death. While several biological scenarios can lead to the evolution of posthumous altruism [<xref ref-type="bibr" rid="R2">2</xref>, <xref ref-type="bibr" rid="R3">3</xref>], it remains unclear which conditions may favour posthumous spite (i.e. a behaviour that results in a net reduction of the survival and/or reproduction of an actor to harm only recipients living beyond the actor’s death). Understanding this, and the evolution of other extreme forms of environmentally mediated social behaviour, requires describing how selection shapes traits that underlie both direct and indirect social interactions.</p><p id="P3">The theory devoted to the evolution of quantitative traits influencing direct social interactions is well established (see, e.g. [<xref ref-type="bibr" rid="R4">4</xref>, <xref ref-type="bibr" rid="R5">5</xref>, <xref ref-type="bibr" rid="R6">6</xref>, <xref ref-type="bibr" rid="R7">7</xref>, <xref ref-type="bibr" rid="R8">8</xref>, <xref ref-type="bibr" rid="R9">9</xref>]). One of the main contributions of this body of work has been to highlight the importance of limited dispersal for determining how selection shapes social traits in populations that are subdivided into finite groups and spatially structured [<xref ref-type="bibr" rid="R4">4</xref>, <xref ref-type="bibr" rid="R5">5</xref>]. Under limited dispersal, stochastic demographic effects resulting from finite group (or patch or deme) size generate genetic associations, whereby individuals expressing the same traits may be more or less likely to interact directly with one another than with individuals expressing alternative traits. The importance of such associations is enshrined in the fact that the selection gradient on a quantitative trait can be expressed as a marginal (or gradient) form of Hamilton’s rule [<xref ref-type="bibr" rid="R4">4</xref>, <xref ref-type="bibr" rid="R5">5</xref>]. This gradient, which captures the first-order effects of selection, is sufficient to determine the trait values towards which a population converges under mutation-limited evolution ([<xref ref-type="bibr" rid="R7">7</xref>], i.e. to characterise convergence stability [<xref ref-type="bibr" rid="R10">10</xref>]).</p><p id="P4">The marginal form of Hamilton’s rule is computationally attractive because all the necessary information about interactions is summarized in pairwise relatedness coefficients evaluated under neutrality (i.e. in the absence of selection or trait variation). This remarkable simplification makes the selection gradient tractable under realistic demographic assumptions, particularly in populations exhibiting isolation by distance (e.g. lattice models [<xref ref-type="bibr" rid="R11">11</xref>, <xref ref-type="bibr" rid="R12">12</xref>, <xref ref-type="bibr" rid="R5">5</xref>]). This has opened the door to understanding the evolution of multiple types of direct social interactions in such populations (e.g. helping and harming [<xref ref-type="bibr" rid="R13">13</xref>, <xref ref-type="bibr" rid="R14">14</xref>, <xref ref-type="bibr" rid="R15">15</xref>, <xref ref-type="bibr" rid="R16">16</xref>, <xref ref-type="bibr" rid="R17">17</xref>, <xref ref-type="bibr" rid="R18">18</xref>, <xref ref-type="bibr" rid="R19">19</xref>, <xref ref-type="bibr" rid="R20">20</xref>]; sex ratio [<xref ref-type="bibr" rid="R21">21</xref>]; and dispersal [<xref ref-type="bibr" rid="R22">22</xref>, <xref ref-type="bibr" rid="R23">23</xref>, <xref ref-type="bibr" rid="R11">11</xref>, <xref ref-type="bibr" rid="R24">24</xref>]).</p><p id="P5">In contrast, modelling the evolution of social interactions mediated by abiotic or biotic environmental variables is significantly more challenging in spatially structured populations. This is because computing the selection gradient in this case also requires computing the joint distribution of pairwise relatedness and environmental variables in the population (under neutrality [<xref ref-type="bibr" rid="R25">25</xref>, <xref ref-type="bibr" rid="R5">5</xref>]). Generally, this distribution is the stationary solution to a high-dimensional stochastic dynamical system that is difficult to analyse or, in some cases, even to characterise. The challenge is apparent in models that allow for trait-driven changes in local demography. Even in the island model of dispersal, where the spatial structure is only implicit [<xref ref-type="bibr" rid="R26">26</xref>], there is typically no analytical solution to the distribution of demographic states within groups. As a result, analyses of the selection gradient heavily rely on numerical methods (e.g. [<xref ref-type="bibr" rid="R27">27</xref>, <xref ref-type="bibr" rid="R28">28</xref>, <xref ref-type="bibr" rid="R25">25</xref>, <xref ref-type="bibr" rid="R29">29</xref>, <xref ref-type="bibr" rid="R30">30</xref>]). This “curse of dimensionality” becomes even more acute under isolation by distance, as the size of the state space on which relevant environmental (or demographic) variables fluctuate blows up exponentially, with the selection gradient now requiring the distribution of states among as well as within groups (e.g. <xref ref-type="disp-formula" rid="FD22">eq. 22</xref> in [<xref ref-type="bibr" rid="R25">25</xref>]).</p><p id="P6">To circumvent this challenge, two approximations have been suggested. One is the pair approximation developed for lattice-structured populations, where typically at most one individual lives in sites connected by stepping-stone dispersal [<xref ref-type="bibr" rid="R31">31</xref>, <xref ref-type="bibr" rid="R32">32</xref>, <xref ref-type="bibr" rid="R33">33</xref>, <xref ref-type="bibr" rid="R34">34</xref>, <xref ref-type="bibr" rid="R35">35</xref>, <xref ref-type="bibr" rid="R36">36</xref>, <xref ref-type="bibr" rid="R37">37</xref>, <xref ref-type="bibr" rid="R38">38</xref>]. Pair approximation is based on moment equations of the demographic state distribution that ignore third and higher-order moments. Under this approximation, the selection gradient can be written in the form of Hamilton’s marginal rule, thus allowing for a sharp understanding of some of the effects of demography on the evolution of social behaviour ([<xref ref-type="bibr" rid="R19">19</xref>, <xref ref-type="bibr" rid="R20">20</xref>] see also [<xref ref-type="bibr" rid="R39">39</xref>]). However, pair approximation is not straightforward when considering arbitrarily complex dispersal patterns (e.g. [<xref ref-type="bibr" rid="R40">40</xref>]), patches with more than one individual, or trait-driven environmental state variables.</p><p id="P7">Another approximation relies on considering the dynamics of environmental state variables to be deterministic with a stable fixed point, so that there are no environmental stochastic fluctuations in the absence of genetic variation [<xref ref-type="bibr" rid="R41">41</xref>]. The selection gradient can then be readily expressed as a marginal Hamilton’s rule with inter-temporal fitness effects arising through trait-driven environmental modifications at different temporal distances. In addition to being simpler to compute than the original problem, this decomposition allows the delineation between a component of selection resulting from direct social interactions and a component arising indirectly through changes in the environmental dynamics. So far, this approach has been applied only to the island model—hence, in the absence of isolation by distance ([<xref ref-type="bibr" rid="R41">41</xref>, <xref ref-type="bibr" rid="R42">42</xref>]. For populations exhibiting isolation by distance, there exist general marginal Hamilton’s rule like formulas for the selection gradient in terms of inter-temporal and spatial effects of trait expression on the fitness of all possible recipients [<xref ref-type="bibr" rid="R43">43</xref>, <xref ref-type="bibr" rid="R44">44</xref>]. However, how environmental modifications mediate the long-lasting and long-ranging fitness effects due to trait expression remains implicit in these general formulas. To better understand selection resulting from indirect social interactions via environmental feedback, fitness effects must be unpacked in terms of trait-driven environmental modifications at different temporal and spatial distances.</p><p id="P8">Here, we do exactly that. In a nutshell, we fully characterise the selection gradient on a trait that impacts the deterministic dynamics of environmental state variables that can be abiotic or biotic, and which feed back on the survival and reproduction of the evolving species in a general model of isolation by distance. Using Fourier analysis, we express this gradient in terms of extended phenotypic effects and relatedness coefficients scaled to local competition, both of which provide biological insights about the nature of selection and are straightforward to compute for a wide range of classical evolutionary models (e.g. the Wright-Fisher model and the Cannings model). We use our results to investigate the evolution of environmentally mediated helping and harming through space and time, such as via the production of a lasting common-pool resource or the release of a durable toxic compound. Our analyses indicate that indiscriminate spite where individuals suffer a cost to harm others living in the future, even beyond the actor’s death, readily evolves by natural selection. This result is in contrast with previous findings suggesting that indiscriminate spite rarely evolves when it occurs through direct interactions. More broadly, our model and results suggest that selection can favour a wide range of social behaviours when these are mediated in space and time through environmental feedbacks.</p></sec><sec id="S2"><label>2</label><title>Biological scenario and general assumptions</title><sec id="S3"><label>2.1</label><title>Spatial structure, life cycle, traits and environmental variables</title><p id="P9">We consider a population of homogeneous individuals subdivided among <italic>D</italic> homogeneous patches (or demes or groups), each carrying <italic>N</italic> adult individuals (see <xref ref-type="table" rid="T1">Table 1</xref> for a list of the key symbols used). The population is censused at discrete demographic time steps between which the following events occur in cyclic order: (a) reproduction and adult survival; (b) dispersal among patches; and (c) density-dependent regulation within patches such that each patch contains <italic>N</italic> adult individuals at the beginning of the next demographic time step.</p><p id="P10">Patches are arranged homogeneously in <italic>d</italic> dimensions, with <italic>D</italic><sub><italic>j</italic></sub> patches in dimension <italic>j</italic> ∈ {1, …, <italic>d</italic>}. For example, under a lattice structure in a one-dimensional habitat, <italic>D</italic> = <italic>D</italic><sub>1</sub> patches are arranged on a circle, while in a two-dimensional habitat, <italic>D</italic> = <italic>D</italic><sub>1</sub> × <italic>D</italic><sub>2</sub> patches are arranged on a torus. We denote by <inline-formula><mml:math id="M1"><mml:mrow><mml:mo>𝔾</mml:mo><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>d</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>:</mml:mo><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>&lt;</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:math></inline-formula> the set of all patches. The fact that patches are arranged homogeneously means that, at a technical level, we can endow the set <inline-formula><mml:math id="M2"><mml:mo>𝔾</mml:mo></mml:math></inline-formula> with an abelian group structure (see e.g. [<xref ref-type="bibr" rid="R45">45</xref>] for the use of such group structure in evolutionary biology), which will allow us to leverage techniques from Fourier analysis on finite abelian groups (<xref ref-type="boxed-text" rid="BX1">Box I</xref>).</p><p id="P11">Each patch is characterized by a quantitative state variable representing a biotic or abiotic environmental factor, which we refer to as an environmental state variable (e.g., density of a common-pool resource or pollutant, habitat quality). Meanwhile, each individual in the population is characterised by a genetically determined quantitative trait (e.g. consumption of a resource, release of a pollutant, investment into habitat maintenance) that influences the environment and the individual’s survival and reproduction. We are interested in the evolution of this trait under the following three assumptions. <list list-type="order" id="L1"><list-item><p id="P12"><italic>Trait and environmentally mediated reproduction and survival</italic>. By expressing the evolving trait, individuals can directly affect the survival and/or reproduction of any other individual in the population. For example, individuals may engage in costly fights for resources in other patches and return to their own patch to share these resources with patch neighbours. The effects of trait expression on others are assumed to be: (a) spatially invariant, i.e. the marginal effect of an individual from patch <inline-formula><mml:math id="M3"><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">i</mml:mtext></mml:mstyle><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>i</mml:mi><mml:mi>d</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:math></inline-formula> on the survival and/or reproduction of an individual in patch <inline-formula><mml:math id="M4"><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>j</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>j</mml:mi><mml:mi>d</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:math></inline-formula> only depends on the “distance” <bold>j</bold> − <bold>i</bold> between the two patches (where <bold>j</bold> − <bold>i</bold> is calculated from the abelian group operation, see <xref ref-type="boxed-text" rid="BX1">Box I</xref>); and (b) spatially symmetric, i.e. the marginal effect of an individual from patch <bold>i</bold> on an individual in patch <bold>j</bold> is equal to the effect from <bold>j</bold> to <bold>i</bold>. We refer to these two characteristics (a) and (b) together as spatial homogeneity. The survival and reproduction of an individual may also depend on the environmental state variable of each patch, also in a spatially homogeneous way (i.e. the marginal effect of the environmental state variable of a patch <bold>i</bold> on the survival and reproduction of an individual residing in patch <bold>j</bold> only depends on the distance <bold>j</bold> − <bold>i</bold>, and is equal to the effect from <bold>j</bold> to <bold>i</bold>).</p></list-item><list-item><p id="P13"><italic>Dispersal</italic>. Each individual either stays in its natal patch or disperses to another patch. Dispersal occurs with non-zero probability so that patches are never completely isolated. We assume that dispersal is spatially homogeneous, i.e. that the probability of dispersal from one patch <bold>i</bold> to another <bold>j</bold> depends only on the distance <bold>j</bold> − <bold>i</bold> = <bold>k</bold> between the two patches (spatial invariance), and is equal to the probability of dispersing the distance <bold>i</bold> − <bold>j</bold> = −<bold>k</bold> (spatial symmetry). We can thus write <italic>m</italic><sub><bold>k</bold></sub> = <italic>m</italic><sub>−<bold>k</bold></sub> for the probability that an individual disperses to a patch at a distance <bold>k</bold> from its natal patch. (with <inline-formula><mml:math id="M5"><mml:mstyle displaystyle="true"><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mi>m</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula>),</p></list-item><list-item><p id="P14"><italic>Trait and environmentally mediated environmental dynamics</italic>. Through trait expression, individuals can affect environmental state variables from one demographic time step to the next. For example, the environmental variable may be a common-pool resource that individuals absorb locally, or a pollutant produced by individuals which then diffuses in the environment. Such trait effects on the environment are also spatially homogeneous (i.e. the marginal effect of an individual from patch <bold>i</bold> on the environmental state variable of patch <bold>j</bold> only depends on the distance <bold>j</bold> – <bold>I</bold> and is equal to the effect from <bold>j</bold> to <bold>i</bold>). These trait-driven environmental modifications can thus lead to inter-temporal, environmentally mediated social interactions.</p></list-item></list></p></sec><sec id="S4"><label>2.2</label><title>The focal individual, its fitness, and environmental dynamics</title><p id="P15">The spatial homogeneity underlying all processes described above means that the patch indexed as <bold>0</bold> ∈ 𝔾 can be taken as a representative patch, and that any individual in this patch can be taken as a representative individual from the population. We refer to this patch and to this individual as, respectively, the focal patch and the focal individual. In general, we refer to patch <bold>k</bold> ∈ 𝔾 at time (or “generation”) <italic>t</italic> ≥ 0 prior to the focal generation as patch “<bold>k</bold>, <italic>t</italic>”. Thus, the focal patch corresponds to patch <bold>0</bold>, 0. In the following, we introduce some notation to describe trait and environmental variation in the population (see <xref ref-type="fig" rid="F1">Fig. 1C</xref> for a summary diagram of our model). We denote by <italic>z</italic><sub>•</sub> the realized value of the trait of the focal individual, and by <italic>z</italic><sub><bold>k</bold>,<italic>t</italic></sub> the realized average trait of individuals <italic>other</italic> than the focal individual living in patch <bold>k</bold>, <italic>t</italic> [e.g. for a one-dimensional habitat, <italic>z</italic><sub>1,1</sub> is the average trait expressed in the adjacent patch (patch 1) one time point before the focal generation]. Hence, <italic>z</italic><sub><bold>0</bold>,0</sub> denotes the average phenotype among the patch neighbours of the focal individual in the focal generation (thus excluding the focal from the average). We use <inline-formula><mml:math id="M6"><mml:mrow><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">D</mml:mtext></mml:mstyle><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> to denote the vector collecting all such realized phenotypes in 𝔾 in lexicographic order, finishing with position <bold>D</bold><sub>−1</sub> = (<italic>D</italic><sub>1</sub> − 1, <italic>D</italic><sub>2</sub> − 1, …, <italic>D</italic><sub><italic>d</italic></sub> − 1). Finally, we use <italic>n</italic><sub><bold>k</bold>,<italic>t</italic></sub> to denote the environmental state variable in patch <bold>k</bold>, <italic>t</italic>; we collect the environmental state variables across all patches in the vector <inline-formula><mml:math id="M7"><mml:mrow><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">D</mml:mtext></mml:mstyle><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>.</p><p id="P16">The fitness of the focal individual is determined by the function <italic>w</italic> : ℝ × ℝ<sup><italic>D</italic></sup> × ℝ<sup><italic>D</italic></sup> → ℝ<sub>+</sub> such that <disp-formula id="FD1"><label>(1)</label><mml:math id="M8"><mml:mrow><mml:mi>w</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></disp-formula> is the expected number of successful offspring (i.e. offspring that establish as adults, including the surviving self) produced over one demographic time by the focal individual with trait <italic>z</italic><sub>•</sub>, when the trait average among other individuals at the different spatial positions is <bold>z</bold><sub><bold>0</bold>,0</sub>, and environmental state variables are <bold>n</bold><sub><bold>0</bold>,0</sub>. These state variables are obtained from the solution to the system of equations <disp-formula id="FD2"><label>(2)</label><mml:math id="M9"><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="2.5em"/><mml:mtext>for</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>all</mml:mtext><mml:mspace width="0.2em"/><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.2em"/></mml:math></disp-formula> where <italic>g</italic> : ℝ<sup><italic>D</italic></sup> × ℝ<sup><italic>D</italic></sup> → ℝ is a transition map determining the dynamics of the environmental state variables <bold>n</bold><sub><bold>k</bold>,<italic>t</italic></sub> of all patches, which is a circular permutation of <bold>n</bold><sub><bold>0</bold>,<italic>t</italic></sub> with <italic>n</italic><sub><bold>k</bold>,<italic>t</italic></sub> as first element [e.g. for a one-dimensional lattice where <italic>d</italic> = 1, <bold>n</bold><sub>0,<italic>t</italic></sub> = (<italic>n</italic><sub>0,<italic>t</italic></sub>, <italic>n</italic><sub>1,<italic>t</italic></sub>, …, <italic>n</italic><sub><italic>D</italic>−1,<italic>t</italic></sub>), <bold>n</bold><sub>1,<italic>t</italic></sub> = (<italic>n</italic><sub>1,<italic>t</italic></sub>, <italic>n</italic><sub>2,<italic>t</italic></sub>, …, <italic>n</italic><sub>0,<italic>t</italic></sub>), <bold>n</bold><sub>2,<italic>t</italic></sub> = (<italic>n</italic><sub>2,<italic>t</italic></sub>, <italic>n</italic><sub>3,<italic>t</italic></sub>, …, <italic>n</italic><sub>0,<italic>t</italic></sub>, <italic>n</italic><sub>1,<italic>t</italic></sub>), and so on]. The map <italic>g</italic> depends on (i) the traits in the whole population expressed at the previous generation via <bold>z</bold><sub><bold>k</bold>,<italic>t</italic>+1</sub> (recall that <italic>t</italic> goes back in time), which is a circular permutation of the elements of <bold>z</bold><sub><bold>0</bold>,<italic>t</italic>+1</sub> with <italic>z</italic><sub><bold>k</bold>,<italic>t</italic>+1</sub> as first element [e.g. for a one dimensional lattice, <bold>z</bold><sub>0,<italic>t</italic>+1</sub> = (<italic>z</italic><sub>0,<italic>t</italic>+1</sub>, <italic>z</italic><sub>1,<italic>t</italic>+1</sub>, …, <italic>z</italic><sub><italic>D</italic>−1,<italic>t</italic>+1</sub>), <bold>z</bold><sub>1,<italic>t</italic>+1</sub> = (<italic>z</italic><sub>1,<italic>t</italic>+1</sub>, <italic>z</italic><sub>2,<italic>t</italic>+1</sub>, …, <italic>z</italic><sub>0,<italic>t</italic>+1</sub>), <bold>z</bold><sub>2,<italic>t</italic>+1</sub> = (<italic>z</italic><sub>2,<italic>t</italic>+1</sub>, <italic>z</italic><sub>3,<italic>t</italic>+1</sub>, …, <italic>z</italic><sub>0,<italic>t</italic>+1</sub>, <italic>z</italic><sub>1,<italic>t</italic>+1</sub>), and so on]; and (ii) the environmental state variables of all patches at the previous generation via <bold>n</bold><sub><bold>k</bold>,<italic>t</italic>+1</sub>. Due to the recursive nature of <xref ref-type="disp-formula" rid="FD2">eq. (2)</xref>, the environmental state variables in the focal generation, <bold>n</bold><sub><bold>0</bold>,0</sub>, depend on the whole history of traits <bold>z</bold><sub>H</sub> = (<bold>z</bold><sub><bold>0</bold>,1</sub>, <bold>z</bold><sub><bold>0</bold>,2</sub>, …) expressed in the population prior to the focal generation. As a result, the fitness of a focal individual may also depend on the traits expressed by all other previous individuals across space and time. To make this dependence explicit, we write the fitness of the focal individual as <italic>w</italic>(<italic>z</italic><sub>•</sub>, <bold>z</bold><sub><bold>0</bold>,0</sub>, <bold>n</bold><sub><bold>0</bold>,0</sub>(<bold>z</bold><sub>H</sub>)).</p><p id="P17">We make the additional assumption that in a monomorphic population where all individuals express the same resident phenotype <italic>z</italic>, the deterministic environmental dynamics described by the map <italic>g</italic> have a unique hyperbolically stable equilibrium point, identical in each patch, and satisfying <disp-formula id="FD3"><label>(3)</label><mml:math id="M10"><mml:mrow><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <bold>z</bold> = (<italic>z</italic>, …, <italic>z</italic>) and <inline-formula><mml:math id="M11"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mstyle><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> are vectors of dimension <italic>D</italic> whose entries are all equal to trait value <italic>z</italic> and environmental state variable <inline-formula><mml:math id="M12"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, respectively. This is sometimes called the spatially homogeneous or flat solution in multi-patch ecological systems (p. 235 in [<xref ref-type="bibr" rid="R46">46</xref>]). The existence of such a solution entails that, in the absence of genetic variation, all patches converge to the same environmental equilibrium <inline-formula><mml:math id="M13"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula>, which may depend on the resident trait <italic>z</italic>. One useful property of a monomorphic population at such an equilibrium is that fitness must be equal to one, i.e. <inline-formula><mml:math id="M14"><mml:mrow><mml:mi>w</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo>,</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></inline-formula> holds. This is because the total population size is constant, and consequently, each individual exactly replaces itself on average.</p><p id="P18">The fitness function (1) and the recursion (2) assume that fitness and the environmental dynamics can be written as functions of trait averages within patches. This said, this assumption does not limit us to only considering situations where effects within patches are additive. Indeed, because we are interested in convergence stability and thus in the first-order effects of selection (i.e. the first-order effects of trait variation), <xref ref-type="disp-formula" rid="FD1">eqs. (1)</xref> and <xref ref-type="disp-formula" rid="FD2">(2)</xref> are sufficient to model biological scenarios with arbitrary complicated non-additive effects among individuals within patches, for instance through complementarity or antagonism. Just a little care may be required when defining these expressions from an individual-based model (p. 95 in [<xref ref-type="bibr" rid="R5">5</xref>]).</p></sec><sec id="S5"><label>2.3</label><title>Evolutionary dynamics</title><p id="P19">We assume that the quantitative trait evolves through rare mutations of small phenotypic effects, such that the evolutionary dynamics proceeds as a trait substitution sequence on the state space Ƶ ⊆ ℝ (i.e. the process of “long-term evolution” described in [<xref ref-type="bibr" rid="R7">7</xref>] for finite populations). We are interested in characterising convergence stable trait values, which are local attractors of the trait substitution sequence. To do so, we base ourselves on the first-order effects of selection on the fixation probability of a mutant that arises as a single copy in a population monomorphic for a resident trait value [<xref ref-type="bibr" rid="R11">11</xref>, <xref ref-type="bibr" rid="R12">12</xref>, <xref ref-type="bibr" rid="R7">7</xref>]. Technical details about our derivations can be found in the appendices and accompanying boxes. Our main findings are summarized below.</p></sec></sec><sec id="S6" sec-type="results"><label>3</label><title>Results</title><sec id="S7"><label>3.1</label><title>Recipient-centered perspective: intra- and inter-temporal fitness effects</title><p id="P20">A trait value <italic>z</italic><sup>∗</sup> in the interior of <italic>Ƶ</italic> is convergence stable if and only if <disp-formula id="FD4"><label>(4)</label><mml:math id="M15"><mml:mrow><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msup><mml:mi>z</mml:mi><mml:mo>∗</mml:mo></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mspace width="1.5em"/><mml:mtext>and</mml:mtext><mml:mspace width="1.5em"/><mml:msub><mml:mrow><mml:mrow><mml:mspace width="0.2em"/><mml:mfrac><mml:mrow><mml:mtext>d</mml:mtext><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mtext>d</mml:mtext><mml:mi>z</mml:mi></mml:mrow></mml:mfrac></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mi>z</mml:mi><mml:mo>=</mml:mo><mml:msup><mml:mi>z</mml:mi><mml:mo>∗</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></disp-formula> holds, where the function <disp-formula id="FD5"><label>(5)</label><mml:math id="M16"><mml:mrow><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mtext>W</mml:mtext></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mtext>e</mml:mtext></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> referred to as the selection gradient, can be written as the sum of two terms, given by <disp-formula id="FD6"><label>(6a)</label><mml:math id="M17"><mml:msub><mml:mi>s</mml:mi><mml:mi>W</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>w</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mi>H</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>w</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mi>H</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.2em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.2em"/></mml:math></disp-formula> <disp-formula id="FD7"><label>(6b)</label><mml:math id="M18"><mml:msub><mml:mi>s</mml:mi><mml:mtext>e</mml:mtext></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>∞</mml:mi></mml:munderover><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mspace width="0.2em"/><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>w</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mtext>H</mml:mtext></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></disp-formula> (see <xref ref-type="supplementary-material" rid="SD1">Appendix A</xref> for a derivation). Here, all quantities are evaluated in a monomorphic population with all individuals expressing the resident trait value <italic>z</italic>, and the environmental state variable in all patches are at the environmental equilibrium <inline-formula><mml:math id="M19"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></inline-formula> (<xref ref-type="disp-formula" rid="FD3">eq. 3</xref>). A trait value <italic>z</italic><sup>∗</sup> satisfying condition (4) constitutes a candidate end-point of evolution. More specifically, <italic>z</italic><sup>∗</sup> is a mode of the stationary phenotypic distribution under the trait substitution sequence (see <xref ref-type="supplementary-material" rid="SD1">eq. A-5</xref> and e.g. [<xref ref-type="bibr" rid="R7">7</xref>] for details).</p><p id="P21">Both <italic>s</italic><sub>w</sub>(<italic>z</italic>) and <italic>s</italic><sub>e</sub>(<italic>z</italic>) depend on (i) marginal fitness effects, i.e. on derivatives of focal fitness (that we interpret below), and (ii) the relatedness <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> between the focal individual and another randomly sampled individual from patch <bold>k</bold>, <italic>t</italic>. Such relatedness coefficient is defined as <disp-formula id="FD8"><label>(7)</label><mml:math id="M20"><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>lim</mml:mi></mml:mrow><mml:mrow><mml:mi>μ</mml:mi><mml:mo>→</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>μ</italic> is the mutation rate at the evolving locus; <italic>Q</italic><sub><bold>k</bold>,<italic>t</italic></sub> is the stationary probability that an allele sampled in the focal individual is identical by descent with a homologous allele sampled in another individual chosen at random from patch <bold>k</bold>, <italic>t</italic> under neutrality (i.e. in a population monomorphic for <italic>z</italic>); and <inline-formula><mml:math id="M21"><mml:msub><mml:mover accent="true"><mml:mi>Q</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>Q</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mi>D</mml:mi></mml:math></inline-formula> is the average probability of identity by descent between two homologous alleles sampled in two individuals living <italic>t</italic> generations apart. The probability of identity by descent <italic>Q</italic><sub><bold>k</bold>,<italic>t</italic></sub>, and thus the relatedness coefficient <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub>, may depend on the resident phenotype <italic>z</italic>, but we leave this dependence implicit for readability.</p><p id="P22">Relatedness <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> quantifies the extent to which an individual that is sampled from patch <bold>k</bold>, <italic>t</italic> is more (when <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> &gt; 0) or less (when <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> &lt; 0) likely than a randomly sampled individual to carry an allele identical by descent to one carried by the focal individual at a homologous locus. To illustrate this notion, consider a Wright-Fisher process (where there is no adult survival and individuals are semelparous), which is the reference model for probabilities of identity by descent under isolation by distance (e.g. [<xref ref-type="bibr" rid="R47">47</xref>, <xref ref-type="bibr" rid="R48">48</xref>, <xref ref-type="bibr" rid="R5">5</xref>]). For this model, the relatedness coefficients <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> for <italic>t</italic> = 1, 2, 3, … can be shown to be given by <disp-formula id="FD9"><label>(8)</label><mml:math id="M22"><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mtext>k,</mml:mtext><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mspace width="0.2em"/><mml:mo>=</mml:mo><mml:mspace width="0.2em"/><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>D</mml:mi><mml:mi>N</mml:mi><mml:mo>+</mml:mo><mml:mi>M</mml:mi></mml:mrow></mml:mfrac><mml:mstyle displaystyle="true"><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:munder><mml:mrow><mml:mfrac><mml:mrow><mml:mi>ℳ</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>t</mml:mi></mml:msup></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ℳ</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac><mml:msub><mml:mover accent="true"><mml:mi>χ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:math></disp-formula> where <inline-formula><mml:math id="M23"><mml:mrow><mml:mi>M</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo><mml:mo>∖</mml:mo><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle></mml:mrow></mml:msub><mml:mi>ℳ</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ℳ</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, and ℳ (<bold>h</bold>) is the Fourier transform (or characteristic function) of the dispersal distribution (see <xref ref-type="boxed-text" rid="BX1">Box I</xref> for definitions of Fourier transforms, character functions <italic>χ</italic><sub><bold>k</bold></sub>(<bold>h</bold>), and their inverses <inline-formula><mml:math id="M24"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>χ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> ; <xref ref-type="supplementary-material" rid="SD1">Appendix B</xref> for an example of the characteristic function of a dispersal distribution; and [<xref ref-type="bibr" rid="R49">49</xref>] for a derivation of <xref ref-type="disp-formula" rid="FD8">eq. 8</xref>). The relatedness coefficient between two individuals in the same generation, <italic>R</italic><sub><bold>k</bold>,0</sub>, is given by <xref ref-type="disp-formula" rid="FD8">eq. (8)</xref> with <italic>t</italic> = 2 (i.e. <italic>R</italic><sub><bold>k</bold>,0</sub> = <italic>R</italic><sub><bold>k</bold>,2</sub> holds for all <bold>k</bold>). In a panmictic or randomly mixing population (where <italic>m</italic><sub><bold>k</bold></sub> = 1/<italic>D</italic> for all <bold>k</bold>), relatedness between any two individuals is zero (i.e. <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> = 0 for all <bold>k</bold> and all <italic>t</italic>; as the Fourier transform reduces to ℳ (<bold>h</bold>) = 1 if <bold>h</bold> = <bold>0</bold> and 0 otherwise using property I.F in <xref ref-type="boxed-text" rid="BX1">Box I</xref>). However, as soon as dispersal is non-uniform (i.e. if <italic>m</italic><sub><bold>k</bold></sub> ≠ <italic>m</italic><sub><bold>j</bold></sub> for some <bold>k</bold> ≠ <bold>j</bold>), relatedness varies among individuals from different patches according to spatial and temporal distance. In particular, when dispersal is limited so that individuals have a tendency to remain in their natal patch, relatedness between the focal individual and individuals in the same patch from the same generation increases (<italic>R</italic><sub><bold>0</bold>,0</sub> &gt; 0). Because the average relatedness is zero (i.e. <inline-formula><mml:math id="M25"><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mi>D</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:math></inline-formula> holds from <xref ref-type="disp-formula" rid="FD7">eq. 7</xref>), the focal individual must also be negatively related to individuals residing in at least one other patch (i.e. <italic>R</italic><sub><bold>k</bold>,0</sub> &lt; 0 must hold for some <bold>k</bold> ≠ <bold>0</bold>). Which patches those are depends on patterns of dispersal. Under short-range dispersal, the focal individual tends to be positively related to individuals in patches nearby and negatively related to individuals further away (<xref ref-type="fig" rid="F2">Fig. 2C</xref> and <xref ref-type="fig" rid="F3">Fig. 3C</xref>). Under long-range dispersal, relatedness can be negative between individuals living in patches at intermediate distances (<xref ref-type="fig" rid="F2">Fig. 2D</xref> and <xref ref-type="fig" rid="F3">Fig. 3D</xref>).</p><p id="P23">In <xref ref-type="disp-formula" rid="FD6">eq. (6)</xref>, the derivative <italic>∂w</italic>/<italic>∂z</italic><sub>•</sub> is the effect of a trait change in the focal individual on its own fitness. Likewise, <italic>∂w</italic>/<italic>∂z</italic><sub><bold>k</bold>,<italic>t</italic></sub> is the effect of a trait change in the whole set of individuals living in patch <bold>k</bold>, <italic>t</italic> on the fitness of the focal individual. Such effect is weighted by relatedness <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> in the expressions given by <xref ref-type="disp-formula" rid="FD6">eq. (6)</xref>. As such, <italic>s</italic><sub>w</sub>(<italic>z</italic>) (<xref ref-type="disp-formula" rid="FD6">eq. 6a</xref>) is the net effect of all intra-temporal effects on fitness, while <italic>s</italic><sub>e</sub>(<italic>z</italic>) (<xref ref-type="disp-formula" rid="FD6">eq. 6b</xref>) is the net effect of all inter-temporal effects (i.e. all effects within and between demographic periods, respectively). More broadly, <xref ref-type="disp-formula" rid="FD6">eq. (6)</xref> consists in the sum of effects on the fitness of a focal individual stemming from all individuals that currently live (<xref ref-type="disp-formula" rid="FD6">eq. 6a</xref>) or have lived (<xref ref-type="disp-formula" rid="FD6">eq. 6b</xref>) in the population. Here, the focal individual is the recipient of phenotypic effects, present and past (recipient-centered perspective). How past phenotypic effects are mediated by environmental dynamics is left implicit in <xref ref-type="disp-formula" rid="FD6">eq. (6)</xref>, contained in <xref ref-type="disp-formula" rid="FD6">eq. (6b)</xref> through <bold>n</bold><sub><bold>0</bold>,0</sub>(<bold>z</bold><sub>H</sub>). In the next section, we expose such environmental effects by unpacking <xref ref-type="disp-formula" rid="FD6">eq. (6b)</xref> and shifting from a recipient-centered to an actor-centered perspective.</p></sec><sec id="S8"><label>3.2</label><title>Actor-centered perspective: environmentally mediated extended phenotypic effects</title><p id="P24">To understand natural selection on social traits, it is often helpful to see the focal individual as the actor, rather than the recipient, of phenotypic effects [<xref ref-type="bibr" rid="R50">50</xref>, <xref ref-type="bibr" rid="R4">4</xref>, <xref ref-type="bibr" rid="R5">5</xref>]. To shift to this perspective, we can leverage the space-time homogeneity of our model to see that <italic>∂w</italic>/<italic>∂z</italic><sub><bold>k</bold>,<italic>t</italic></sub> in <xref ref-type="disp-formula" rid="FD6">eq. (6)</xref> is equivalent to the total effect of the focal individual on the fitness of the individuals in a patch at distance <bold>k</bold> at <italic>t</italic> steps in the future, and that relatedness <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> (<xref ref-type="disp-formula" rid="FD8">eq. 8</xref>) quantifies the extent to which an individual sampled in a patch at distance <bold>k</bold> at <italic>t</italic> steps in the future is more (or less) likely than a randomly sampled individual to carry an allele identical by descent to one in the focal individual at a homologous locus [<xref ref-type="bibr" rid="R43">43</xref>]. These considerations readily lead to an actor-centered perspective for selection on intra-temporal effects, <italic>s</italic><sub>w</sub>(<italic>z</italic>) (<xref ref-type="disp-formula" rid="FD6">eq. 6a</xref>).</p><p id="P25">For selection on inter-temporal effects, <italic>s</italic><sub>e</sub>(<italic>z</italic>), we further need to unpack the phenotypic effects through the environmental dynamics in <xref ref-type="disp-formula" rid="FD6">eq. (6b)</xref>. To do so, we now let the time index <italic>t</italic> ≥ 0 denote time forward so that <bold>n</bold><sub><bold>k</bold>,<italic>t</italic></sub> is the value of the environmental state variable in patch <bold>k</bold> at <italic>t</italic> time steps in the future of the focal generation (<italic>t</italic> = 0), and likewise let <bold>z</bold><sub><bold>k</bold>,<italic>t</italic></sub> denote the collection of population phenotypes at time <italic>t</italic> in the future. Environmental dynamics forward in time are characterised by rewriting <xref ref-type="disp-formula" rid="FD2">eq. (2)</xref> as <disp-formula id="FD10"><label>(9)</label><mml:math id="M26"><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="1.5em"/><mml:mtext>for</mml:mtext><mml:mspace width="0.2em"/><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="1.5em"/><mml:mtext>for</mml:mtext><mml:mspace width="0.2em"/><mml:mi>t</mml:mi><mml:mo>≥</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M27"><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula> is equal to <bold>z</bold><sub><bold>k</bold>,0</sub> except that the component <italic>z</italic><sub><bold>0</bold>,0</sub> in this vector is replaced with <inline-formula><mml:math id="M28"><mml:mrow><mml:msubsup><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>/</mml:mo><mml:mi>N</mml:mi><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:math></inline-formula>, i.e. the average phenotype in the focal patch including the focal individual (e.g. for a one-dimensional lattice,<inline-formula><mml:math id="M29"><mml:mrow><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>D</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula>. <xref ref-type="disp-formula" rid="FD9">Eq. (9)</xref> brings upfront the potential complexity of characterising the environmental consequences of a trait change in the focal individual. This is because the trait of the focal individual, <italic>z</italic><sub>•</sub>, influences the environmental state variable of potentially any patch <bold>k</bold> over one generation, <italic>n</italic><sub><bold>k</bold>,1</sub>, which can in turn have knock-on effects in the future on <italic>n</italic><sub><bold>k</bold>,2</sub>, <italic>n</italic><sub><bold>k</bold>,3</sub>, and so on throughout space in an interactive way. To characterise such effects, we write <disp-formula id="FD11"><label>(10)</label><mml:math id="M30"><mml:mrow><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula> for the extended phenotypic effect of the focal individual on the environmental state variable in patch <bold>k</bold> at <italic>t</italic> generations in the future. Selection on inter-temporal effects <italic>s</italic><sub>e</sub>(<italic>z</italic>) (<xref ref-type="disp-formula" rid="FD6">eq. 6b</xref>) can then be written in terms of these extended phenotypic effects as <disp-formula id="FD12"><label>(11)</label><mml:math id="M31"><mml:msub><mml:mi>s</mml:mi><mml:mtext>e</mml:mtext></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>∞</mml:mi></mml:munderover><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="true">︸</mml:mo></mml:munder><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>effect</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>of</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>focal</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>on</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>environment</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>in</mml:mtext><mml:mspace width="0.2em"/><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:munder><mml:mo>×</mml:mo><mml:munder><mml:munder><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>w</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo stretchy="true">︸</mml:mo></mml:munder><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>effect</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>of</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>environmental</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>perturbation</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>in</mml:mtext><mml:mspace width="0.2em"/><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>on</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>fitness</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>in</mml:mtext><mml:mspace width="0.2em"/><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:munder><mml:mo>×</mml:mo><mml:munder><mml:munder><mml:mrow><mml:mi>N</mml:mi><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="true">︸</mml:mo></mml:munder><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>total</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>genetic</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>value</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>of</mml:mtext><mml:mspace width="0.2em"/><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>for</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>focal</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:munder></mml:math></disp-formula></p><p id="P26">(see <xref ref-type="supplementary-material" rid="SD1">Appendix C.1</xref> for a derivation). <xref ref-type="disp-formula" rid="FD11">Eq. (11)</xref> indicates that <italic>s</italic><sub>e</sub>(<italic>z</italic>) consists in the total effect of the focal individual on the fitness of individuals in each patch <bold>k</bold>, <italic>t</italic> in the future, via a change in the environmental state of possibly all patches <bold>j</bold> − <bold>k</bold>, <italic>t</italic>, where fitness is weighted by their relatedness <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> to the focal individual. From the point of view of the focal individual, relatedness <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> can then be thought of as the “genetic value” of an individual randomly sampled in patch <bold>k</bold>, <italic>t</italic> in units of fitness. More specifically, <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> can be interpreted as the number of units of its own fitness that the focal individual is willing to exchange with an individual from patch <bold>k</bold>, <italic>t</italic> against one unit of theirs without changing the mutant’s probability of fixation at <italic>z</italic><sup>∗</sup>. Selection thus favours the focal individual sacrificing some of its own fitness to increase fitness in patch <bold>k</bold>, <italic>t</italic> when <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> &gt; 0, and to decrease fitness when <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> &lt; 0. How such sacrifice impacts the environment encountered by recipients is quantified by the extended phenotypic effect <italic>e</italic><sub><bold>j</bold>−<bold>k</bold>,<italic>t</italic></sub> in <xref ref-type="disp-formula" rid="FD11">eq. (11)</xref>.</p><p id="P27">The remaining challenge is how to compute <italic>e</italic><sub><bold>k</bold>,<italic>t</italic></sub>, given the complex repercussions that a perturbation has in time and space (i.e. how to quantify a perturbation in the coupled dynamical system defined by <xref ref-type="disp-formula" rid="FD9">eq. 9</xref>). We show in <xref ref-type="supplementary-material" rid="SD1">Appendix C.2</xref> that this can be achieved through Fourier analysis using the following building blocks. First, we let <italic>ψ</italic><sub><bold>k</bold></sub> be the focal individual’s effect on the environmental state variable of patch <bold>k</bold> over one generation. Owing to our space-time homogeneity assumptions, this effect can equivalently be calculated as <disp-formula id="FD13"><label>(12)</label><mml:math id="M32"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>g</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mrow><mml:mtable equalrows="true" equalcolumns="true"><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msubsup><mml:mi>z</mml:mi><mml:mrow><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup></mml:mrow></mml:mfrac><mml:mspace width="1.5em"/><mml:mtext>for</mml:mtext><mml:mspace width="0.2em"/><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>=</mml:mo><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mspace width="2.5em"/><mml:mtext>otherwise</mml:mtext><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></disp-formula></p><p id="P28">The rightmost expression is often more useful in applications (as it only requires characterising the environmental map <inline-formula><mml:math id="M33"><mml:mrow><mml:mi>g</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></inline-formula> of the focal patch, e.g. <xref ref-type="disp-formula" rid="FD26">eq. 26</xref> below). Similarly, we let <disp-formula id="FD14"><label>(13)</label><mml:math id="M34"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula> be the effect of the environmental state variable of one patch on the environmental state variable of another patch at distance <bold>k</bold> over one generation. With the above notation, and writing Ψ(<bold>h</bold>) and C(<bold>h</bold>) for the Fourier transforms of, respectively, <italic>ψ</italic><sub><bold>k</bold></sub> and <italic>c</italic><sub><bold>k</bold></sub>, the extended phenotypic effect can be efficiently computed as the inverse Fourier transform of 𝒞(<bold>h</bold>)<sup><italic>t</italic>−1</sup>Ψ(<bold>h</bold>) = <italic>ε</italic><sub><italic>t</italic></sub>(<bold>h</bold>) (see <xref ref-type="boxed-text" rid="BX1">Box I</xref> for the definition of inverse Fourier transforms), namely <disp-formula id="FD15"><label>(14)</label><mml:math id="M35"><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ℒ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ℰ</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>D</mml:mi></mml:mfrac><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:munder><mml:munder><mml:mrow><mml:mo>Ψ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>𝒞</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo stretchy="true">︸</mml:mo></mml:munder><mml:mrow><mml:msub><mml:mi>ε</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>h</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:munder><mml:msub><mml:mover accent="true"><mml:mi>χ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>h</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:math></disp-formula></p><p id="P29">The form of ε<sub><italic>t</italic></sub>(<bold>h</bold>) indicates that <italic>e</italic><sub><bold>k</bold>,<italic>t</italic></sub> can be considered a perturbation in the dynamics of an environmental state variable that ripples into the future. This perturbation has its origin in a focal individual whose trait affects the environmental state variables of possibly multiple patches over one generation (captured by Ψ(<bold>h</bold>) in <xref ref-type="disp-formula" rid="FD14">eq. 14</xref>). This one-generational change then propagates through space over <italic>t</italic> − 1 generations owing to the environmental dynamics, finally impacting the environment of individuals <italic>t</italic> generations downstream of the focal individual (captured by 𝒞(<bold>h</bold>)<sup><italic>t</italic>−1</sup> in <xref ref-type="disp-formula" rid="FD14">eq. 14</xref>). In <xref ref-type="boxed-text" rid="BX2">Box II</xref>, we generalize <xref ref-type="disp-formula" rid="FD11">eqs. (11)</xref>-<xref ref-type="disp-formula" rid="FD14">(14)</xref> to multi-dimensional environmental dynamics, that is, when multiple environmental state variables can be affected by the evolving trait and whose dynamics can interact with one another.</p><p id="P30"><xref ref-type="disp-formula" rid="FD11">Eq. (11)</xref> together with <xref ref-type="disp-formula" rid="FD12">eqs. (12)</xref>-<xref ref-type="disp-formula" rid="FD14">(14)</xref> constitutes a basis to quantify and understand selection on traits that have inter-temporal effects through the environment under isolation by distance. These equations formalise the intuition behind inclusive fitness arguments for environmentally mediated social interactions, saying that natural selection tends to favor traits whose environmental effects benefit the fitness of relatives (i.e. individuals more likely to carry genes that are identical by descent). Here, the fundamental currency is individual fitness, and its exchange rate among individuals is given by relatedness. However, in many cases it is not fitness that is directly impacted by traits or the environment, but rather some intermediate payoff, such as energy, the amount of prey caught, or the size of a breeding territory. In turn, this payoff influences survival and reproduction, which together determine fitness. We next explore such scenarios.</p></sec><sec id="S9"><label>3.3</label><title>Payoff-mediated fitness: scaled relatedness or the genetic value of others in payoff units</title><sec id="S10"><label>3.3.1</label><title>Payoff and fitness</title><p id="P31">Following much of evolutionary game theory (see e.g. [<xref ref-type="bibr" rid="R8">8</xref>] for a textbook treatment), we now consider cases where fitness depends on a payoff function summarizing social interactions (e.g. a case where the energy that an individual accrues depends on its foraging behaviour, the foraging behaviour of others, and how resources are distributed in the environment). We let this payoff function be <italic>π</italic> : ℝ × ℝ<sup><italic>D</italic></sup> × ℝ<sup><italic>D</italic></sup> → ℝ<sub>+</sub>, such that <italic>π</italic>(<italic>z</italic><sub>•</sub>, <bold>z</bold><sub><bold>0</bold>,0</sub>, <bold>n</bold><sub><bold>0</bold>,0</sub>) is the payoff to the focal individual with phenotype <italic>z</italic><sub>•</sub> when the collection of average phenotypes among all other individuals is <bold>z</bold><sub><bold>0</bold>,0</sub> and the collection of environmental state variables across all patches is <bold>n</bold><sub><bold>0</bold>,0</sub>. We assume that the fitness of this focal individual can, in turn, be written as a function <inline-formula><mml:math id="M36"><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo>:</mml:mo><mml:msub><mml:mi>ℝ</mml:mi><mml:mo>+</mml:mo></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mi>ℝ</mml:mi><mml:mo>+</mml:mo></mml:msub><mml:mo>×</mml:mo><mml:msubsup><mml:mi>ℝ</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:mi>D</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>→</mml:mo><mml:msub><mml:mi>ℝ</mml:mi><mml:mo>+</mml:mo></mml:msub></mml:math></inline-formula> of the payoff to self, the average payoff to a patch neighbour, and the average payoff to an individual from each patch other than the focal, i.e. as <disp-formula id="FD16"><label>(15)</label><mml:math id="M37"><mml:mrow><mml:mi>w</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo>(</mml:mo><mml:mrow><mml:mi>π</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P32">Where <disp-formula id="FD17"><label>(16)</label><mml:math id="M38"><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:munder><mml:munder><mml:mrow><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>⋅</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow><mml:mo stretchy="true">︸</mml:mo></mml:munder><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mo>•</mml:mo></mml:msub></mml:mrow></mml:munder><mml:munder><mml:munder><mml:mrow><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow><mml:mo stretchy="true">︸</mml:mo></mml:munder><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:munder><mml:mn>...</mml:mn><mml:mo>,</mml:mo><mml:munder><mml:munder><mml:mrow><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mi>R</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="true">︸</mml:mo></mml:munder><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub></mml:mrow></mml:munder><mml:mo>,</mml:mo><mml:mn>...</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:math></disp-formula> is a (<italic>D</italic> + 1)-dimensional vector collecting the payoff <italic>π</italic><sub>•</sub> to the focal individual, the average payoff <italic>π</italic><sub><bold>0</bold></sub> to a patch neighbour, and the average payoff <italic>π</italic><sub><bold>k</bold></sub> to an individual from each patch <bold>k</bold> ≠ <bold>0</bold>. As an argument to <italic>π</italic><sub><bold>0</bold></sub> in <xref ref-type="disp-formula" rid="FD16">eq. (16)</xref>, we used <inline-formula><mml:math id="M39"><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>n</mml:mtext></mml:msubsup></mml:mrow></mml:math></inline-formula> to denote a vector that is equal to <bold>z</bold><sub><bold>0</bold>,0</sub> except for its first entry, which is given by <inline-formula><mml:math id="M40"><mml:mrow><mml:msubsup><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>n</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>, i.e. by the average trait among the neighbours of a neighbour of the focal individual. This captures the notion that the focal individual can influence the payoff of its neighbours.</p><p id="P33"><xref ref-type="disp-formula" rid="FD15">eq. (15)</xref> allows individual fitness to depend on the payoff of all the individuals of its generation in an arbitrary way. This said, in most applications the survival and fecundity of an individual depend only on its own payoff. In this case, fitness may be written as <disp-formula id="FD18"><label>(17)</label><mml:math id="M41"><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mspace width="0.2em"/><mml:mo>=</mml:mo><mml:mspace width="0.2em"/><mml:munder><mml:munder><mml:mrow><mml:mi>s</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mo>•</mml:mo></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo stretchy="true">︸</mml:mo></mml:munder><mml:mrow><mml:mtext>survival</mml:mtext></mml:mrow></mml:munder><mml:mspace width="0.2em"/><mml:mo>+</mml:mo><mml:mspace width="0.2em"/><mml:munder><mml:munder><mml:mrow><mml:munder><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mi>𝔾</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>m</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msup><mml:mi>s</mml:mi><mml:mtext>R</mml:mtext></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mfrac><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mo>•</mml:mo></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:munder><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mi>𝔾</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>m</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle></mml:mrow></mml:msub><mml:msup><mml:mtext>f</mml:mtext><mml:mtext>R</mml:mtext></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>π</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow><mml:mo stretchy="true">︸</mml:mo></mml:munder><mml:mrow><mml:mtext>reproduction</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>into</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>spots</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>left</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>open</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>by</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>deaths</mml:mtext></mml:mrow></mml:munder></mml:math></disp-formula> where s : ℝ<sub>+</sub> → ℝ<sub>+</sub> and f : ℝ<sub>+</sub> → ℝ<sub>+</sub> are survival and fecundity functions, respectively, and quantities with R as a superscript are defined so that s<sup>R</sup>(<italic>π</italic><sub><bold>0</bold></sub>) = s(<italic>π</italic><sub>•</sub>)/<italic>N</italic> + (<italic>N</italic> − 1)s(<italic>π</italic><sub><bold>0</bold></sub>)/<italic>N</italic> is the average survival in the focal patch, otherwise s<sup>R</sup>(<italic>π</italic><sub><bold>k</bold></sub>) = s(<italic>π</italic><sub><bold>k</bold></sub>) for <bold>k</bold> ≠ <bold>0</bold>; and f<sup>R</sup>(<italic>π</italic><sub><bold>0</bold></sub>) = f(<italic>π</italic><sub>•</sub>)/<italic>N</italic> + (<italic>N</italic> − 1)f(<italic>π</italic><sub><bold>0</bold></sub>)/<italic>N</italic> is the average fecundity in the focal patch, otherwise f<sup>R</sup>(<italic>π</italic><sub><bold>k</bold></sub>) = f(<italic>π</italic><sub><bold>k</bold></sub>) for <bold>k</bold> ≠ <bold>0</bold>. Suppose we set survival to zero in <xref ref-type="disp-formula" rid="FD17">eq. (17)</xref>. In that case, we obtain the fitness function of the classical Wright-Fisher process (e.g. <xref ref-type="disp-formula" rid="FD3">eq. 3</xref> in [<xref ref-type="bibr" rid="R51">51</xref>], in the absence of environmental effects and for a circular stepping-stone model). More generally, if s is a positive constant and payoffs only influence fecundity f, <xref ref-type="disp-formula" rid="FD17">eq. (17)</xref> implements a form of “death–birth” updating protocol (i.e. where individuals sampled at random to die are replaced by the offspring of selected individuals according to payoff, e.g. [<xref ref-type="bibr" rid="R36">36</xref>, <xref ref-type="bibr" rid="R52">52</xref>]). Conversely, a “birth-death” updating is obtained by setting f to a positive constant and letting payoff influence survival s only. <xref ref-type="disp-formula" rid="FD17">Eq. (17)</xref> will constitute a useful platform to explore more specific examples later, even though many of our results hold for the more general relationship between payoff and fitness given by <xref ref-type="disp-formula" rid="FD15">eq. (15)</xref>.</p></sec><sec id="S11"><label>3.3.2</label><title>Selection under payoff-mediated fitness</title><p id="P34">If fitness is of the form of <xref ref-type="disp-formula" rid="FD15">eq. (15)</xref>, the selection gradient can be written as <disp-formula id="FD19"><label>(18)</label><mml:math id="M42"><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∝</mml:mo><mml:munder><mml:mrow><mml:munder><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:msub><mml:mi>κ</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>︸</mml:mo></mml:munder></mml:mrow><mml:mrow><mml:mo>∝</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>w</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:munder><mml:mo>+</mml:mo><mml:munder><mml:mrow><mml:munder><mml:mrow><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>∞</mml:mi></mml:munderover><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:mi>N</mml:mi><mml:msub><mml:mi>κ</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow><mml:mo>︸</mml:mo></mml:munder></mml:mrow><mml:mrow><mml:mo>∝</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:munder></mml:math></disp-formula> where <disp-formula id="FD20"><label>(19)</label><mml:math id="M43"><mml:mrow><mml:msub><mml:mi>κ</mml:mi><mml:mrow><mml:mtext>k</mml:mtext><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:msub><mml:mi>λ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>λ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>λ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mspace width="1.5em"/><mml:mtext>if</mml:mtext><mml:mspace width="0.2em"/><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mspace width="0.2em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.2em"/><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:msub><mml:mi>λ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>λ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>λ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mspace width="1.5em"/><mml:mtext>if</mml:mtext><mml:mspace width="0.2em"/><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mspace width="0.2em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.2em"/><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>λ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>λ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle></mml:msub><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mspace width="4.5em"/><mml:mtext>otherwise</mml:mtext><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula> and <disp-formula id="FD21"><label>(20)</label><mml:math id="M44"><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub></mml:mrow></mml:mfrac><mml:mo>/</mml:mo><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mover accent="true"><mml:mi>w</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>π</mml:mi><mml:mo>•</mml:mo></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p id="P35">(see <xref ref-type="supplementary-material" rid="SD1">Appendix D</xref> for a derivation). To understand <xref ref-type="disp-formula" rid="FD18">eq. (18)</xref>, it is first useful to interpret <italic>λ</italic><sub><bold>k</bold></sub> (<xref ref-type="disp-formula" rid="FD20">eq. 20</xref>) as a coefficient of fitness interdependence through payoffs. Specifically, <italic>λ</italic><sub><bold>k</bold></sub> measures the effect on the fitness of the focal individual of a change in the payoff of an individual at a distance <bold>k</bold>, relative to the effect of the payoff of the focal individual on its own fitness. When positive, <italic>λ</italic><sub><bold>k</bold></sub> can thus be interpreted as the strength of competition, as it indicates how much an increase in the payoffs of an individual at distance <bold>k</bold> reduces the fitness of the focal individual. With this in mind, the coefficient <italic>κ</italic><sub><bold>k</bold>,<italic>t</italic></sub> (<xref ref-type="disp-formula" rid="FD19">eq. 19</xref>) can be seen as a measure of relatedness scaled to competition (or scaled relatedness for short, e.g. [<xref ref-type="bibr" rid="R53">53</xref>, <xref ref-type="bibr" rid="R54">54</xref>, <xref ref-type="bibr" rid="R7">7</xref>]; with <xref ref-type="disp-formula" rid="FD19">eq. 19</xref> extending to isolation by distance the formalization of this concept found in [<xref ref-type="bibr" rid="R55">55</xref>]). Indeed, <italic>κ</italic><sub><bold>k</bold>,<italic>t</italic></sub> can be interpreted as the number of units of its own payoff that the focal individual is willing to exchange with a unit of payoff accruing to a randomly sampled individual from patch <bold>k</bold>, <italic>t</italic> without changing the mutant’s probability of fixation at the singular value <italic>z</italic><sup>∗</sup>. The scaled-relatedness coefficient <italic>κ</italic><sub><bold>k</bold>,<italic>t</italic></sub> can thus be seen as the genetic value of other individuals in patch <bold>k</bold>, <italic>t</italic> from the point of view of the focal individual in units of payoff. For (<bold>k</bold>, <italic>t</italic>) ≠ (<bold>0</bold>, 0), <italic>κ</italic><sub><bold>k</bold>,<italic>t</italic></sub> then measures the net social discount rate of temporally delayed and spatially extended fitness effects [<xref ref-type="bibr" rid="R44">44</xref>].</p><p id="P36">From the considerations above, <xref ref-type="disp-formula" rid="FD18">eq. (18)</xref> can be read as an inclusive fitness effect at the payoff level. That is, selection depends on how the focal individual influences its own payoff and the payoff of all other individuals across patches, now and in the future, weighted by their scaled relatedness <italic>κ</italic><sub><bold>k</bold>,<italic>t</italic></sub>. For recipients in the future (<italic>t</italic> ≥ 1), payoff effects are mediated by how the focal individual perturbs the environment in each patch (via <italic>e</italic><sub><bold>k</bold>−<bold>j</bold>,<italic>t</italic></sub> in <xref ref-type="disp-formula" rid="FD18">eq. 18</xref>), and in turn by how such environmental perturbation influences payoffs (via <italic>∂π</italic>/(<italic>∂n</italic><sub><bold>j</bold>,0</sub>) in <xref ref-type="disp-formula" rid="FD18">eq. 18</xref>).</p><p id="P37">In <xref ref-type="supplementary-material" rid="SD1">Appendix E</xref>, we use Fourier analysis to compute scaled relatedness <italic>κ</italic><sub><bold>k</bold>,<italic>t</italic></sub> for the fitness model given by <xref ref-type="disp-formula" rid="FD17">eq. (17)</xref> and an arbitrary dispersal distribution <italic>m</italic><sub><bold>k</bold></sub>. Our results are summarized in <xref ref-type="boxed-text" rid="BX3">Box III</xref>. For example, we obtain that under a Wright-Fisher process, <disp-formula id="FD22"><label>(21)</label><mml:math id="M45"><mml:mrow><mml:msub><mml:mi>κ</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>{</mml:mo><mml:mrow><mml:mtable equalrows="true" equalcolumns="true"><mml:mtr><mml:mtd><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>D</mml:mi><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mspace width="1.2em"/><mml:mtext>if</mml:mtext><mml:mspace width="0.2em"/><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mrow><mml:mi>D</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>D</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>D</mml:mi><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mspace width="1.2em"/><mml:mtext>otherwise</mml:mtext><mml:mspace width="0.2em"/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></disp-formula> holds, where <disp-formula id="FD23"><label>(22)</label><mml:math id="M46"><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ℒ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mi>ℳ</mml:mi><mml:mi>t</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>D</mml:mi></mml:mfrac><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:mi>ℳ</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>t</mml:mi></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>χ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></disp-formula> is the probability that, under neutrality, a gene descending from the focal individual is in patch <bold>k</bold> at <italic>t</italic> &gt; 0 steps in the future (which depends on the characteristic function ℳ (<bold>h</bold>) of the dispersal distribution, <xref ref-type="table" rid="T1">Table 1</xref>). The collection of these probabilities, <inline-formula><mml:math id="M47"><mml:msub><mml:mi>p</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub></mml:math></inline-formula>, can thus be seen as the distribution of a standard random walk on the set of patches with step distribution characterized by the dispersal probabilities <italic>m</italic><sub><bold>k</bold></sub>. When such a random walk leads to a probability <italic>p</italic><sub><bold>k</bold>,<italic>t</italic></sub> that is greater than under a uniform distribution (i.e. when <italic>p</italic><sub><bold>k</bold>,<italic>t</italic></sub> &gt; 1/<italic>D</italic> holds), <xref ref-type="disp-formula" rid="FD21">eq. (21)</xref> indicates that scaled relatedness <italic>κ</italic><sub><bold>k</bold>,<italic>t</italic></sub> is positive, so that selection favours environmental transformations that increase payoffs in patch <bold>k</bold>, <italic>t</italic>. Conversely, selection favours environmental transformations that decrease payoffs in patches where <italic>p</italic><sub><bold>k</bold>,<italic>t</italic></sub> is smaller than under a uniform distribution (i.e. when <italic>p</italic><sub><bold>k</bold>,<italic>t</italic></sub> &lt; 1/<italic>D</italic> holds). Which patches are those depends on the dispersal distribution (compare <xref ref-type="fig" rid="F2">Fig. 2E</xref> with <xref ref-type="fig" rid="F2">Fig. 2F</xref> for short and long-range dispersal in a 1D lattice, and <xref ref-type="fig" rid="F3">Fig. 3E</xref> with <xref ref-type="fig" rid="F3">Fig. 3F</xref> for short and long-range dispersal in a 2D lattice).</p><p id="P38">The selection gradient (18) recovers previous results of social evolution theory, which provides a robustness check of our calculations. To see these connections, assume that there are no ecologically meditated interactions, that is, that <italic>∂π</italic>(<italic>z</italic><sub>•</sub>, <bold>z</bold><sub><bold>0</bold>,0</sub>, <bold>n</bold><sub><bold>0</bold>,0</sub>)/<italic>∂n</italic><sub><bold>0</bold>,0</sub> = 0 holds, that −<italic>C</italic>(<italic>z</italic>) = <italic>∂π</italic>(<italic>z</italic><sub>•</sub>, <bold>z</bold><sub><bold>0</bold>,0</sub>, <bold>n</bold><sub><bold>0</bold>,0</sub>)/<italic>∂z</italic><sub>•</sub> &lt; 0 is a net payoff cost to self, and that <italic>B</italic><sub><bold>k</bold></sub>(<italic>z</italic>) = <italic>∂π</italic>(<italic>z</italic><sub>•</sub>, <bold>z</bold><sub><bold>0</bold>,0</sub>, <bold>n</bold><sub><bold>0</bold>,0</sub>)/<italic>∂z</italic><sub><bold>k</bold>,0</sub> is a payoff benefit to individuals at distance <bold>k</bold>, which is typical of models under the heading of the evolution of “cooperation” or “altruism”. Further, suppose that individuals interact only with other individuals at a single distance <bold>k</bold> so that the selection gradient is proportional to −<italic>C</italic>(<italic>z</italic>) + <italic>κ</italic><sub><bold>k</bold>,0</sub><italic>B</italic><sub><bold>k</bold></sub>(<italic>z</italic>). Then, <xref ref-type="disp-formula" rid="FD18">eq. (18)</xref> entails that selection favours such a helping behaviour if <italic>κ</italic><sub><bold>k</bold>,0</sub> &gt; <italic>C</italic>(<italic>z</italic>)/<italic>B</italic><sub><bold>k</bold></sub>(<italic>z</italic>) holds, that is, if the scaled-relatedness coefficient is greater than the cost-to-benefit ratio. For a Wright-Fisher process, whose hallmark is no survival and fecundity effects, <italic>κ</italic><sub><bold>k</bold>,0</sub> reduces to −1/(<italic>DN</italic> − 1) (<xref ref-type="disp-formula" rid="FD21">eq. 21</xref>). Thus, helping cannot spread regardless of population structure because <italic>κ</italic><sub><bold>k</bold>,0</sub> &gt; <italic>C</italic>(<italic>z</italic>)/<italic>B</italic><sub><bold>k</bold></sub>(<italic>z</italic>) cannot be satisfied as long as <italic>B</italic><sub><bold>k</bold></sub>(<italic>z</italic>) &gt; 0. Yet, we also see that harming recipients, i.e. <italic>B</italic><sub><bold>k</bold></sub>(<italic>z</italic>) &lt; 0, can be favored by selection when <italic>D</italic> is finite. This result was first derived for a lattice-structured population for <italic>D</italic> → ∞ and <bold>k</bold> = <bold>0</bold> in [<xref ref-type="bibr" rid="R56">56</xref>], and for finite <italic>D</italic> and any <bold>k</bold> under a circular one-dimensional habitat in [<xref ref-type="bibr" rid="R5">5</xref>] (chapter 8, and generalized to other abelian group structures in [<xref ref-type="bibr" rid="R45">45</xref>] and [<xref ref-type="bibr" rid="R44">44</xref>]). More generally, the scaled-relatedness coefficient given in <xref ref-type="boxed-text" rid="BX3">Box III</xref> recovers established conditions for the spread of helping and harming behaviour in lattice-structured populations under different biological assumptions, such as for survival effects or for fecundity effects with overlapping generations (e.g. [<xref ref-type="bibr" rid="R57">57</xref>, <xref ref-type="bibr" rid="R15">15</xref>, <xref ref-type="bibr" rid="R36">36</xref>, <xref ref-type="bibr" rid="R52">52</xref>]; see [<xref ref-type="bibr" rid="R44">44</xref>] for the explicit connections to this literature). Finally, in the presence of ecologically mediated interactions, so that <italic>∂π</italic>(<italic>z</italic><sub>•</sub>, <italic>z</italic><sub><bold>0</bold>,0</sub>, <italic>n</italic><sub><bold>0</bold>,0</sub>)/<italic>∂n</italic><sub><bold>0</bold>,0</sub> ≠ 0, <xref ref-type="disp-formula" rid="FD18">eq. (18)</xref> recovers <xref ref-type="supplementary-material" rid="SD1">eq. (A.21)</xref> in [<xref ref-type="bibr" rid="R43">43</xref>] which holds for a Wright-Fisher process (to see this correspondence, set <italic>s</italic><sub><bold>k</bold>,<italic>t</italic></sub> = <italic>N</italic> (<italic>∂π</italic>(<italic>z</italic><sub>•</sub>, <italic>z</italic><sub><bold>0</bold>,0</sub>, <italic>n</italic><sub><bold>0</bold>,0</sub>)/<italic>∂n</italic><sub><bold>0</bold>,0</sub>) <italic>e</italic><sub><bold>k</bold>,<italic>t</italic></sub> in <xref ref-type="disp-formula" rid="FD18">eq. 18</xref>).</p></sec><sec id="S12"><label>3.3.3</label><title>Local interactions</title><p id="P39">In <xref ref-type="disp-formula" rid="FD18">eq. (18)</xref>, payoffs can depend on the traits expressed in and the environmental variables of all patches. In many instances, payoff effects can reasonably be assumed to be local, i.e. the payoff of an individual depends only on the traits and the environment of its patch. In this case, the payoff to the focal individual can be written as <italic>π</italic>(<italic>z</italic><sub>•</sub>, <bold>z</bold><sub><bold>0</bold>,0</sub>, <bold>n</bold><sub><bold>0</bold>,0</sub>) = <italic>π</italic>(<italic>z</italic><sub>•</sub>, <italic>z</italic><sub><bold>0</bold>,0</sub>, <italic>n</italic><sub><bold>0</bold>,0</sub>), and the selection gradient <xref ref-type="disp-formula" rid="FD18">eq. (18)</xref> reduces to <disp-formula id="FD24"><label>(23)</label><mml:math id="M48"><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∝</mml:mo><mml:munder><mml:munder><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:msub><mml:mi>κ</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="true">︸</mml:mo></mml:munder><mml:mrow><mml:mo>∝</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mtext>w</mml:mtext></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:munder><mml:mo>+</mml:mo><mml:munder><mml:munder><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mi>N</mml:mi><mml:mi>K</mml:mi><mml:mo>,</mml:mo></mml:mrow><mml:mo stretchy="true">︸</mml:mo></mml:munder><mml:mrow><mml:mo>∝</mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mtext>e</mml:mtext></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:munder></mml:math></disp-formula> where <disp-formula id="FD25"><label>(24)</label><mml:math id="M49"><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:munderover><mml:mi>∑</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>∞</mml:mi></mml:munderover><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>κ</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:math></disp-formula> summarizes selection on environmentally mediated social interactions (see <xref ref-type="supplementary-material" rid="SD1">Appendix F</xref> for a derivation and <xref ref-type="disp-formula" rid="FD53">eq. III.C</xref> in <xref ref-type="boxed-text" rid="BX3">Box III</xref> for more details). When <italic>K</italic> = 0, selection is blind to the effects of the trait on the environment, even if the environment affects payoffs (i.e. even if <italic>∂π</italic>(<italic>z</italic><sub>•</sub>, <italic>z</italic><sub><bold>0</bold>,0</sub>, <italic>n</italic><sub><bold>0</bold>,0</sub>)/(<italic>∂n</italic><sub><bold>0</bold>,0</sub>) ≠ 0). When <italic>K</italic> &gt; 0, selection favours trait values that improve the environment (i.e. the payoff in the future increases). Conversely, when <italic>K</italic> &lt; 0, selection favours trait values that deteriorate the environment (i.e. the payoff in the future decreases). Which of these outcomes unfolds depends on the interaction between extended phenotypic effects <italic>e</italic><sub><bold>k</bold>,<italic>t</italic></sub> and scaled relatedness coefficients <italic>κ</italic><sub><bold>k</bold>,<italic>t</italic></sub>, with <italic>K</italic> &gt; 0 when <italic>e</italic><sub><bold>k</bold>,<italic>t</italic></sub> and <italic>κ</italic><sub><bold>k</bold>,<italic>t</italic></sub> tend to be of the same sign (i.e. when <inline-formula><mml:math id="M50"><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>∞</mml:mi></mml:msubsup><mml:mrow><mml:munder><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mi>G</mml:mi></mml:mrow></mml:munder><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>κ</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> holds), and <italic>K</italic> &gt; 0 when they tend to be of opposite sign (i.e. when <inline-formula><mml:math id="M51"><mml:mstyle displaystyle="true"><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>∞</mml:mi></mml:msubsup><mml:mrow><mml:munder><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>κ</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mstyle></mml:math></inline-formula> holds). In the next section, we explore through an example how this interaction depends on dispersal and how environmental state variables of different patches influence one another.</p></sec></sec><sec id="S13"><label>3.4</label><title>Inter-temporal helping and harming through a lasting commons</title><p id="P40">To gain more specific insights into how isolation by distance influences the way selection shapes environmentally mediated interactions, consider a scenario where the environmental variable is some lasting commons (e.g. a common-pool resource or a toxic compound) that can move in space, and whose production depends on an evolving trait that is individually costly to express. We assume that the commons is a “good” when the environmental variable takes positive values (<inline-formula><mml:math id="M52"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>&gt;</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>) and a “bad” when it takes negative values <inline-formula><mml:math id="M53"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>&lt;</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula>. We also assume that the trait leads to the former when <italic>z</italic> &gt; 0 and to the latter when <italic>z</italic> &lt; 0, where the trait space is assumed to be Ƶ = (−∞, ∞). The trait can thus be broadly thought of as environmentally mediated helping (increasing survival and reproduction to recipients) when <italic>z</italic> &gt; 0, and as environmentally mediated harming (decreasing survival and reproduction to recipients) when <italic>z</italic> &lt; 0.</p><p id="P41">We assume that fitness takes the form of <xref ref-type="disp-formula" rid="FD17">eq. (17)</xref> with payoff given by <disp-formula id="FD26"><label>(25)</label><mml:math id="M54"><mml:mrow><mml:mi>π</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>exp</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi>B</mml:mi><mml:msubsup><mml:mi>n</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mtext>B</mml:mtext></mml:msub></mml:mrow></mml:msubsup><mml:mo>−</mml:mo><mml:mi>C</mml:mi><mml:msubsup><mml:mi>z</mml:mi><mml:mo>•</mml:mo><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mtext>C</mml:mtext></mml:msub></mml:mrow></mml:msubsup></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> where <italic>B</italic> &gt; 0 and <italic>C</italic> &gt; 0 are parameters that respectively tune the effects of the environmental variable in the focal patch <italic>n</italic><sub><bold>0</bold>,0</sub> and of the modifying trait <italic>z</italic><sub>•</sub> of the focal individual on the payoff of the focal individual. These effects also depend on the shape parameters <italic>α</italic><sub>B</sub> and <italic>α</italic><sub>C</sub>, which we assume are positive integers, with <italic>α</italic><sub>B</sub> odd (e.g. <italic>α</italic><sub>B</sub> = 1) and <italic>α</italic><sub>C</sub> even (e.g. <italic>α</italic><sub>C</sub> = 2). Thus, the local commons increases (resp. decreases) payoffs when <italic>n</italic><sub><bold>0</bold>,0</sub> &gt; 0 (resp. <italic>n</italic><sub><bold>0</bold>,0</sub> &lt; 0) holds, but any trait expression, that is, any <italic>z</italic><sub>•</sub> away from 0, is individually costly and reduces individual payoff. We also assume that costs increase more steeply than benefits, i.e. that <italic>α</italic><sub>C</sub> &gt; <italic>α</italic><sub>B</sub> holds.</p><p id="P42">Meanwhile, how the trait modifies the commons is determined by the environmental map <italic>g</italic> (<xref ref-type="disp-formula" rid="FD2">eq. 2</xref>), which we assume is given by <disp-formula id="FD27"><label>(26)</label><mml:math id="M55"><mml:mrow><mml:mi>g</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>d</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mi>z</mml:mi><mml:mrow><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>≠</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:munder><mml:msub><mml:mi>d</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P43"><xref ref-type="disp-formula" rid="FD26">Eq. (26)</xref> states that the commons changes from one demographic time point to the next due to three processes. First, the commons is modified or “produced” in a patch according to a function <italic>P</italic> : ℝ → ℝ of the average trait expressed in that patch, i.e. <inline-formula><mml:math id="M56"><mml:mrow><mml:msubsup><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>/</mml:mo><mml:mi>N</mml:mi><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>/</mml:mo><mml:mi>N</mml:mi></mml:mrow></mml:math></inline-formula> in the focal patch and <italic>z</italic><sub><bold>k</bold>,0</sub> otherwise (with <bold>k</bold> ≠ <bold>0</bold>). We assume that <italic>P</italic>(0) = 0 holds, and that <italic>P</italic> is monotonically increasing, i.e. <italic>P</italic><sup>′</sup>(<italic>z</italic>) &gt; 0 for all <italic>z</italic> ∈ ℝ, where <italic>P</italic><sup>′</sup>(<italic>z</italic>) denotes the derivative of <italic>P</italic> with respect to <italic>z</italic>. Second, each unit of commons “diffuses” or moves with probability <italic>d</italic><sub><bold>k</bold></sub> to a patch at a distance <bold>k</bold> from its source patch, where the probability distribution defined by <italic>d</italic><sub><bold>k</bold></sub> can be thought of as the environmental equivalent of the dispersal probability distribution <italic>m</italic><sub><bold>k</bold></sub>. We let 𝒟 (<bold>h</bold>) denote the Fourier transform of this distribution for future use (i.e. 𝒟 (<bold>h</bold>) is to <italic>d</italic><sub><bold>k</bold></sub> what ℳ (<bold>h</bold>) is to <italic>m</italic><sub><bold>k</bold></sub>, <xref ref-type="table" rid="T1">Table 1</xref>). Third, a unit of commons decays with rate 0 &lt; <italic>ϵ</italic> ≤ 1 from one time step to the next. Substituting <xref ref-type="disp-formula" rid="FD26">eq. (26)</xref> into <xref ref-type="disp-formula" rid="FD3">eq. (3)</xref> indicates that in a monomorphic population for <italic>z</italic>, the dynamics of the commons stabilises to <disp-formula id="FD28"><label>(27)</label><mml:math id="M57"><mml:mrow><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>/</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> which is positive when <italic>z</italic> &gt; 0, negative when <italic>z</italic> &lt; 0, and whose absolute value increases as the rate of decay <italic>ϵ</italic> decreases, as expected. This equilibrium is unique because <italic>g</italic> is linear in <italic>P</italic>, and stable because <italic>ϵ</italic> &gt; 0 holds.</p><p id="P44">With fitness of the form of <xref ref-type="disp-formula" rid="FD17">eq. (17)</xref> and payoff <xref ref-type="disp-formula" rid="FD25">eq. (25)</xref> only depending on local interactions (as in <xref ref-type="sec" rid="S12">section 3.3.3</xref>), we can use <xref ref-type="disp-formula" rid="FD23">eqs. (23)</xref> and <xref ref-type="disp-formula" rid="FD24">(24)</xref> to characterise selection. With <italic>κ</italic><sub><bold>k</bold>,<italic>t</italic></sub> as given in <xref ref-type="boxed-text" rid="BX3">Box III</xref>, all that remains to be computed are the extended phenotypic effects, <italic>e</italic><sub><bold>k</bold>,<italic>t</italic></sub>. To do so, we start by substituting <xref ref-type="disp-formula" rid="FD26">eq. (26)</xref> into <xref ref-type="disp-formula" rid="FD12">eqs. (12)</xref> and <xref ref-type="disp-formula" rid="FD13">(13)</xref>, to obtain <italic>ψ</italic><sub><bold>k</bold></sub> = <italic>P</italic><sup>′</sup>(<italic>z</italic>)<italic>d</italic><sub><bold>k</bold></sub>/<italic>N</italic>, and <italic>c</italic><sub><bold>k</bold></sub> = (1 − <italic>ϵ</italic>)<italic>d</italic><sub><bold>k</bold></sub>, which in turn yield Ψ(<bold>h</bold>) = <italic>P</italic><sup>′</sup>(<italic>z</italic>) 𝒟 (<bold>h</bold>)/<italic>N</italic> and C(<bold>h</bold>) = (1 − <italic>ϵ</italic>) 𝒟 (<bold>h</bold>). Substituting these expressions into <xref ref-type="disp-formula" rid="FD14">eq. (14)</xref> then gives <italic>ε</italic><sub><italic>t</italic></sub>(<bold>h</bold>) = (1 − <italic>ϵ</italic>)<sup><italic>t</italic>−1</sup><italic>P</italic><sup>′</sup>(<italic>z</italic>) 𝒟 (<bold>h</bold>)<sup><italic>t</italic></sup>/<italic>N</italic>, which leads to <disp-formula id="FD29"><label>(28)</label><mml:math id="M58"><mml:mrow><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mi>P</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>N</mml:mi></mml:mfrac><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> for the extended phenotypic effect <italic>e</italic><sub><bold>k</bold>,<italic>t</italic></sub> on patch <bold>k</bold>, <italic>t</italic>, where <disp-formula id="FD30"><label>(29)</label><mml:math id="M59"><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ℒ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msup><mml:mo>𝒟</mml:mo><mml:mi>t</mml:mi></mml:msup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>D</mml:mi></mml:mfrac><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:mo>𝒟</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>t</mml:mi></mml:msup><mml:msub><mml:mover accent="true"><mml:mi>χ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P45">Equation <xref ref-type="disp-formula" rid="FD28">eq. (28)</xref> can be understood as follows. By marginally changing its trait value, a focal individual produces <italic>P</italic><sup>′</sup>(<italic>z</italic>)/<italic>N</italic> additional units of commons. Each such unit decays with time according to (1 − <italic>ϵ</italic>)<sup><italic>t</italic>−1</sup>, and ends up in patch <bold>k</bold>, <italic>t</italic> according to <italic>q</italic><sub><bold>k</bold>,<italic>t</italic></sub> (<xref ref-type="disp-formula" rid="FD29">eq. 29</xref>), which can be interpreted as the probability that a non-decaying unit of the commons modified in the focal patch is located in patch <bold>k</bold> <italic>t</italic> generations in the future. In fact, the collection <inline-formula><mml:math id="M60"><mml:msub><mml:mi>q</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub></mml:math></inline-formula> yields the distribution of a standard random walk on the set of patches with step distribution characterised by the <italic>d</italic><sub><bold>k</bold></sub>’s. Extended phenotypic effects thus depend critically on the way the commons moves in space as captured by <italic>d</italic><sub><bold>k</bold></sub> (see <xref ref-type="fig" rid="F4">Fig. 4</xref> for examples of <italic>e</italic><sub><bold>k</bold>,<italic>t</italic></sub> in a 1D model).</p><p id="P46">In turn, how selection depends on extended phenotypic effects is found by substituting <xref ref-type="disp-formula" rid="FD25">eq. (25)</xref> and <xref ref-type="disp-formula" rid="FD28">eq. (28)</xref> into <xref ref-type="disp-formula" rid="FD23">eq. (23)</xref>. From this, we obtain <disp-formula id="FD31"><label>(30)</label><mml:math id="M61"><mml:mrow><mml:mi>s</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∝</mml:mo><mml:mo>−</mml:mo><mml:mi>C</mml:mi><mml:msub><mml:mi>α</mml:mi><mml:mi>C</mml:mi></mml:msub><mml:msup><mml:mi>z</mml:mi><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>C</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mtext>Ω</mml:mtext><mml:mi>B</mml:mi><mml:msub><mml:mi>α</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msup><mml:mi>P</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>ϵ</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>ϵ</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>B</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P47">Where <disp-formula id="FD32"><label>(31)</label><mml:math id="M62"><mml:mrow><mml:mo>Ω</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>∞</mml:mi></mml:munderover><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:mi>ϵ</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:msub><mml:mi>κ</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></disp-formula> can be thought of as the total expected genetic value in units of payoff of all the individuals in the future that are affected by a unit of the commons in the focal patch. Since the term multiplying Ω in <xref ref-type="disp-formula" rid="FD30">eq. (30)</xref> is positive (recall that <italic>α</italic><sub>B</sub> is odd and hence <italic>α</italic><sub>B</sub> − 1 is even), the selection gradient increases with Ω, and the greater Ω is, the greater the <italic>z</italic> favoured by selection. In fact, the selection gradient reduces to <italic>s</italic>(0) ∝ Ω at <italic>z</italic> = 0 (under our assumptions about parameters and the commons production function <italic>P</italic>).</p><p id="P48">This shows that in a population where the trait is initially absent (so that individuals have no effect on the commons), selection favours environmental modifications leading to a common good (<italic>z</italic> &gt; 0) when Ω &gt; 0, or to a common bad (<italic>z</italic> &lt; 0) when Ω &lt; 0. Put differently, selection favours environmentally mediated inter-temporal helping when, in the eyes of the focal individual, the recipient of such help on average has positive genetic value in units of payoff, and conversely, inter-temporal harming when it has negative genetic value.</p><p id="P49">Further insights can be generated if we assume the simple functional form <italic>P</italic>(<italic>z</italic>) = <italic>P</italic><sub>0</sub><italic>z</italic>. In this case, we obtain <disp-formula id="FD33"><label>(32)</label><mml:math id="M63"><mml:mrow><mml:msup><mml:mi>z</mml:mi><mml:mo>∗</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mfrac><mml:mi>B</mml:mi><mml:mi>C</mml:mi></mml:mfrac><mml:mo>⋅</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mtext>B</mml:mtext></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mtext>C</mml:mtext></mml:msub></mml:mrow></mml:mfrac><mml:mo>⋅</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>P</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mi>ϵ</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mtext>B</mml:mtext></mml:msub></mml:mrow></mml:msup><mml:mo>⋅</mml:mo><mml:mtext>Ω</mml:mtext></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mtext>C</mml:mtext></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mtext>B</mml:mtext></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P50">The singular value <italic>z</italic><sup>∗</sup> (32) is convergence stable under our assumption that the cost of trait expression increases faster than the benefits (i.e. <italic>α</italic><sub>C</sub> &gt; <italic>α</italic><sub>B</sub>). Therefore, <italic>z</italic><sup>∗</sup> is the mode of the stationary phenotypic distribution of the trait substitution sequence (we compute this distribution for the Wright-Fisher model in <xref ref-type="supplementary-material" rid="SD1">eq. A-135</xref>). From <xref ref-type="disp-formula" rid="FD32">eq. (32)</xref> it is clear that the absolute value of <italic>z</italic><sup>∗</sup> increases with the benefit-to-cost ratio <italic>B</italic>/<italic>C</italic>, with <italic>α</italic><sub>B</sub>/<italic>α</italic><sub>C</sub>, and with the environmental effect of the trait <italic>P</italic><sub>0</sub>. However, whether <italic>z</italic><sup>∗</sup> is positive or negative (and thus whether helping or harming evolves), ultimately depends on the sign of Ω, i.e. whether the expected genetic value Ω of a modification to the commons is positive or negative in payoff units.</p><p id="P51">The impact of species dispersal and commons movement on Ω can be understood most easily by assuming that payoff influences fecundity under a Wright-Fisher process (i.e. f<sup>′</sup> &gt; 0 and s′ = s = 0 in <xref ref-type="boxed-text" rid="BX3">Box III</xref>). In this case, Ω can be expressed as (see <xref ref-type="supplementary-material" rid="SD1">Appendix G.1</xref>) <disp-formula id="FD34"><label>(33)</label><mml:math id="M64"><mml:mrow><mml:mtext>Ω</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>ϵ</mml:mi><mml:msup><mml:mi>D</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mi>D</mml:mi><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:munderover><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>∞</mml:mi></mml:munderover><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mi>cov</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>q</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula> where cov(<italic>p</italic><sub><italic>t</italic></sub>, <italic>q</italic><sub><italic>t</italic></sub>) is the covariance between the distributions of the random walks of genes <inline-formula><mml:math id="M65"><mml:msub><mml:mi>p</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>p</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub></mml:math></inline-formula> (<xref ref-type="disp-formula" rid="FD22">eq. 22</xref>) and commons <inline-formula><mml:math id="M66"><mml:msub><mml:mi>q</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>q</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub></mml:math></inline-formula> (<xref ref-type="disp-formula" rid="FD29">eq. 29</xref>). This covariance is positive when there is a positive association between gene lineages and the commons these lineages modify. In other words, Ω is positive and helping is favoured when an environmental modification owing to the expression of a gene is most likely to be experienced by individuals living in the future and carrying identical-by-descent copies of that gene. Conversely, Ω tends to be negative and harming is favoured when this environmental modification is less likely to be experienced by future carriers.</p><p id="P52">While <xref ref-type="disp-formula" rid="FD33">eq. (33)</xref> offers intuition on the biological conditions leading to positive or negative values of Ω, this quantity is more readily computed by noting that Ω = <italic>ϵKN</italic>/<italic>P</italic><sup>′</sup>(<italic>z</italic>) holds, where <italic>K</italic> is defined in <xref ref-type="disp-formula" rid="FD24">eq. (24)</xref>, and by substituting <xref ref-type="supplementary-material" rid="SD1">eqs. (A-126) and (A-127)</xref> into <xref ref-type="disp-formula" rid="FD55">eq. (III.E)</xref> in <xref ref-type="boxed-text" rid="BX3">Box III</xref>. Doing so, we obtain <disp-formula id="FD35"><label>(34)</label><mml:math id="M67"><mml:mrow><mml:mtext>Ω</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mi>ϵ</mml:mi><mml:mrow><mml:mi>D</mml:mi><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>≠</mml:mo><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mo>𝒟</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>𝒟</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ϵ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>𝒟</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>𝒟</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p id="P53"><xref ref-type="fig" rid="F5">Figures 5AB</xref> give the sign of Ω under a binomial model for the distance of both the dispersal of the focal species and the movement of the commons (see <xref ref-type="supplementary-material" rid="SD1">Appendix G.5</xref> for details). These figures show that such model of dispersal allows for both positive and negative values of Ω and thus for the evolution of both inter-temporal helping and harming. Here, helping corresponds to altruism and harming to spite (<italic>sensu</italic> chapter 7 in [<xref ref-type="bibr" rid="R5">5</xref>]) since an individual can never obtain direct benefits from its own trait expression through the environment (as generations are non-overlapping under a Wright-Fisher process).</p><p id="P54">More generally, numerical explorations of Ω (<xref ref-type="fig" rid="F5">Fig. 5AB</xref>) indicate that spite tends to be favoured by: (i) high levels of dispersal in the evolving species; (ii) high levels of movement of the commons; (iii) high environmental decay <italic>ϵ</italic>; and (iv) significant differences in the dispersal distance of the species and of the commons (e.g. when individuals disperse short distances but the commons move far away from their original patch). These conditions lead to a negative association between gene lineages and the commons these lineages modify. Conversely, altruism tends to be favoured when dispersal and movement are weak, environmental decay is low, and the distributions of the species’ dispersal and of the commons’ movement are similar (<xref ref-type="fig" rid="F5">Figure 5AB</xref>, white region). In fact, under weak dispersal and movement (so that <italic>m</italic><sub><bold>0</bold></sub> = 1 − <italic>m</italic> and <italic>d</italic><sub><bold>0</bold></sub> = 1 − <italic>d</italic> with <italic>m</italic> and <italic>d</italic> close to zero), and regardless of the dispersal and movement distributions, we have <disp-formula id="FD36"><label>(35)</label><mml:math id="M68"><mml:mrow><mml:mtext>Ω</mml:mtext><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>D</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>D</mml:mi><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>ϵ</mml:mi><mml:mo>−</mml:mo><mml:mi>m</mml:mi><mml:mo>−</mml:mo><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mi>ϵ</mml:mi><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> which is always positive when <italic>m</italic> and <italic>d</italic> are sufficiently small (see <xref ref-type="supplementary-material" rid="SD1">Appendix G.2</xref> for a derivation of <xref ref-type="disp-formula" rid="FD35">eq. 35</xref>). Under these assumptions, an individual’s lineage and the commons originating from its patch will be strongly and locally associated.</p><p id="P55">To see the effects of isolation by distance on social evolution, we compare in <xref ref-type="fig" rid="F6">Fig. 6A</xref> the singular strategy <italic>z</italic><sup>∗</sup> for a 2D lattice where the evolving species and the commons follow a binomial model for distance travelled (detailed in <xref ref-type="supplementary-material" rid="SD1">Appendix G.5</xref>), with the singular strategy <italic>z</italic><sup>∗</sup> under the island model (where dispersal and commons movement are uniform). This comparison illustrates how isolation by distance allows for a wider range of evolved social behaviours as both altruism (<italic>z</italic><sup>∗</sup> &gt; 0) and spite (<italic>z</italic><sup>∗</sup> &lt; 0) can be favoured by selection depending on the distance dispersed. In contrast, only altruism is favoured by selection under the island model in <xref ref-type="fig" rid="F6">Fig. 6A</xref> (compare black full and dashed lines). <xref ref-type="fig" rid="F6">Fig. 6A</xref> also shows how selection may favour the evolution of more exaggerated social behaviours under isolation by distance (i.e. larger |<italic>z</italic><sup>∗</sup>|). These differences are down to the fact that isolation by distance allows for a wider range in the covariance among genetic and commons movement (recall <xref ref-type="disp-formula" rid="FD33">eq. 33</xref>). We also compared the singular strategy <italic>z</italic><sup>∗</sup> found by substituting <xref ref-type="disp-formula" rid="FD34">eq. (34)</xref> into <xref ref-type="disp-formula" rid="FD32">eq. (32)</xref> with results from individual-based simulations. In these simulations, each offspring mutates with probability 10<sup>−4</sup>, in which case a normally distributed deviation with mean 0 and standard deviation 10<sup>−2</sup> is added to the parental trait value. The only difference between these simulations and our analytical scenario is thus that multiple alleles can segregate due to mutation (rather than just two alleles under a trait substitution sequence, see [<xref ref-type="bibr" rid="R7">7</xref>] for finite populations). Nevertheless, we find an excellent fit between the convergence stable <italic>z</italic><sup>∗</sup> and the mean population trait value in simulations (<xref ref-type="fig" rid="F6">Fig. 6B</xref>).</p><p id="P56">The case where payoff influences survival rather than fecundity (s<sup>′</sup> &gt; 0 and f<sup>′</sup> = 0 in <xref ref-type="disp-formula" rid="FD17">eq. 17</xref>) is illustrated in <xref ref-type="fig" rid="F7">Fig. 7</xref> (the expression of Ω for this case in terms of characteristic dispersal functions can be found in <xref ref-type="supplementary-material" rid="SD1">Appendix G.4</xref>). This analysis reveals that harming tends to be favoured when baseline survival s is low, especially when environmental decay is also low (<xref ref-type="fig" rid="F7">Fig 7C</xref>). This is because, otherwise, an individual may harm itself in the future. But apart from this, selection is not fundamentally different when payoff influences survival rather than fecundity in this model (i.e. under a birth-death <italic>vs</italic>. death-birth process).</p></sec></sec><sec id="S14" sec-type="discussion"><label>4</label><title>Discussion</title><p id="P57">Our analyses characterise in two main ways the selection gradient on a trait that impacts the deterministic dynamics of environmental state variables that can be abiotic or biotic, which in turn feed back on individual survival and reproduction under isolation by distance.</p><p id="P58">First, we showed how the selection on a trait due to its environmental effects can be understood in terms of how a focal actor influences the fitness of all future individuals via a modification to the environmental state variables that these individuals experience (<xref ref-type="disp-formula" rid="FD11">eq. 11</xref> and <xref ref-type="disp-formula" rid="FD46">eq. II.D</xref> for the case of multiple environmental variables). The relevant trait-driven environmental modifications are formalized as extended phenotypic effects that quantify how a trait change in an actor individual in the present affects the environmental state variables in all patches at all future times (the <italic>e</italic><sub><bold>k</bold>,<italic>t</italic></sub> effects, <xref ref-type="disp-formula" rid="FD14">eq. 14</xref>). While extended phenotypic effects are typically thought to benefit the actor or related contemporaries directly [<xref ref-type="bibr" rid="R58">58</xref>, <xref ref-type="bibr" rid="R59">59</xref>], these effects in our model are all indirect, carrying over in space and time, thus influencing the fitness of future carriers of the actor’s trait when dispersal is limited. The associations between environmental and genetic variation that are necessary for selection to target trait-driven environmental modifications are given by the product between the extended environmental effects <italic>e</italic><sub><bold>k</bold>,<italic>t</italic></sub> and the relatedness coefficients <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> (see <xref ref-type="disp-formula" rid="FD11">eq. 11</xref>), both of which can be efficiently computed using Fourier transforms (<xref ref-type="disp-formula" rid="FD14">eq. 14</xref> and <xref ref-type="disp-formula" rid="FD47">II.E</xref>-<xref ref-type="disp-formula" rid="FD48">II.F</xref> for a multivariate environment). These gene-environment associations indicate that selection favours traits or behaviours with environmental effects such that, when expressed by a focal individual, the environmental effects increase (resp. decrease) the fitness of future individuals that are more (resp. less) related to the focal than other individuals at that same future generation.</p><p id="P59">The second version of the selection gradient that we derived is based on the extra assumption that interactions between individuals are mediated through a payoff function (see <xref ref-type="disp-formula" rid="FD17">eq. 17</xref>), as in most of traditional evolutionary game theory (e.g. [<xref ref-type="bibr" rid="R60">60</xref>, <xref ref-type="bibr" rid="R61">61</xref>, <xref ref-type="bibr" rid="R8">8</xref>]). Selection on a trait due to its environmental effects can still be viewed from an actor-centered perspective, but this time at the payoff rather than at the fitness level. Specifically, selection can be quantified in terms of how a focal individual influences the payoff of all future individuals via modifications to the environment these individuals experience, weighted by the relatedness between these individuals and the focal, now scaled to take competition into account (the term proportional to <italic>s</italic><sub>e</sub>(<italic>z</italic>) in <xref ref-type="disp-formula" rid="FD18">eq. 18</xref>, with scaled relatedness given in <xref ref-type="disp-formula" rid="FD19">eqs. 19</xref>-<xref ref-type="disp-formula" rid="FD20">20</xref>). The concept of scaled relatedness is useful because it summarizes in a single quantity (here one for each spatial and temporal distance) all the consequences of interactions among related individuals for indirect selection [<xref ref-type="bibr" rid="R62">62</xref>, <xref ref-type="bibr" rid="R53">53</xref>, <xref ref-type="bibr" rid="R54">54</xref>, <xref ref-type="bibr" rid="R7">7</xref>]. That is, scaled relatedness balances, on the one hand, the positive effects of boosting the reproductive success of relatives in a particular spatial position, with, on the other hand, the negative effects of increasing competition for these relatives by affecting the reproduction and survival of others across the habitat. The increase of kin competition can be strong enough to offset the indirect benefits of social behaviour when social interactions occur among contemporaries (and generations do not overlap, e.g. [<xref ref-type="bibr" rid="R56">56</xref>, <xref ref-type="bibr" rid="R5">5</xref>]). Because the strength of kin competition depends on the specifics of the life cycle (such as whether generations overlap or not, or whether payoff influences fecundity or survival), the evolution of direct social interactions is sensitive to such assumptions (see [<xref ref-type="bibr" rid="R53">53</xref>] for a review). This is notably the case under isolation by distance, where the evolution of altruism crucially depends on whether reproduction is modelled as a “death-birth” or a “birth-death” process (e.g. [<xref ref-type="bibr" rid="R63">63</xref>, <xref ref-type="bibr" rid="R64">64</xref>, <xref ref-type="bibr" rid="R65">65</xref>]). The “death-birth” process is akin to iteroparous reproduction with fecundity effects, and the resulting life cycle can sustain altruism; the “birth-death” process is akin to iteroparous reproduction with survival effects, and the life cycle inhibits altruism via increased kin competition (e.g. [<xref ref-type="bibr" rid="R57">57</xref>, <xref ref-type="bibr" rid="R15">15</xref>, <xref ref-type="bibr" rid="R17">17</xref>, <xref ref-type="bibr" rid="R18">18</xref>]).</p><p id="P60">In contrast, we have found that in our model of environmentally mediated social interactions through a lasting commons, whether selection favours the evolution of helping or harming depends weakly on whether payoff influences survival or fecundity. There are two explanations for this. The first is that, because of environmental legacy, the effects on recipients are felt in the distant future, which decreases the competition among the focal’s own offspring [<xref ref-type="bibr" rid="R2">2</xref>, <xref ref-type="bibr" rid="R41">41</xref>]. The second explanation is that, in our model, individuals and their environmental effects can move in space independently, further dissociating the positive and negative effects of interactions among relatives. This decoupling between benefits and costs means that natural selection can readily favor either posthumous altruism or posthumous spite in our model with non-overlapping generations. Which of these behaviours evolves depends on whether the combination of dispersal pattern and commons movement cause environmental effects to fall predominantly on individuals that are more or less related than average in the future.</p><p id="P61">Our findings on environmentally mediated posthumous spite merit further discussion as existing models suggest that the conditions for the evolution of spite are more restrictive than those for altruism. By spite, we refer here to a trait or behaviour whose expression decreases the individual fitness of both its actor and recipients. This is a strong form of spite, reducing the actor’s fitness (chapter 7 in [<xref ref-type="bibr" rid="R5">5</xref>]), which contrasts with the more commonly explored scenarios of weak spite (where the behaviour directly increases the actor’s fitness, e.g. [<xref ref-type="bibr" rid="R66">66</xref>, <xref ref-type="bibr" rid="R67">67</xref>]). The evolution of strong spite typically relies on the existence of mechanisms by which individuals can evaluate their relatedness with social partners and thus behave according to some kin or type-recognition mechanism (e.g. [<xref ref-type="bibr" rid="R68">68</xref>, <xref ref-type="bibr" rid="R69">69</xref>, <xref ref-type="bibr" rid="R70">70</xref>, <xref ref-type="bibr" rid="R71">71</xref>, <xref ref-type="bibr" rid="R72">72</xref>]). By contrast, in our model spite is indiscriminate: an individual deteriorates the environment of others in the future without paying attention to recipients’ identities, even if this comes at a cost in the present. With this in mind, it is noteworthy that spite can evolve even when local populations are not small (e.g. of local size 50, <xref ref-type="fig" rid="F5">Fig. 5</xref>). More broadly, our results illustrate how environmentally mediated social interactions under isolation by distance can evolve to be as relevant for fitness as direct social interactions.</p><p id="P62">The two main assumptions of our model are that fitness and environmental effects are homogeneous in space and time, and that environmental dynamics are deterministic. These assumptions are common to previous models interested in environmental or ecological changes in space that are evolutionarily driven, and particularly to those where individuals produce an environmental commons that moves according to a diffusion process (e.g. [<xref ref-type="bibr" rid="R73">73</xref>, <xref ref-type="bibr" rid="R74">74</xref>, <xref ref-type="bibr" rid="R75">75</xref>, <xref ref-type="bibr" rid="R76">76</xref>, <xref ref-type="bibr" rid="R77">77</xref>]). These models further assume a separation of time scales between demography and the commons such that in between the reproduction, death, or dispersal of any individual in the entire population, the dynamics of the commons reaches a stable distribution across the landscape. By contrast, here we have assumed that the mutation process, rather than the demographic process, is slow compared to environmental dynamics. Reproduction, death, or dispersal can occur on a similar time scale than environmental dynamics in our model, as is usually the case in ecological models (e.g. [<xref ref-type="bibr" rid="R78">78</xref>, <xref ref-type="bibr" rid="R79">79</xref>]). As a result, even though environmental dynamics are described by a deterministic system (<xref ref-type="disp-formula" rid="FD9">eq. 9</xref>, also as in most ecological models, [<xref ref-type="bibr" rid="R78">78</xref>, <xref ref-type="bibr" rid="R79">79</xref>]), realised environmental dynamics fluctuate randomly on a similar time scale than unavoidable genetic fluctuations owing to finite patch size. The next challenge would be to consider a fully stochastic system for the environmental variables (i.e. to extend <xref ref-type="disp-formula" rid="FD9">eq. 9</xref> to the dynamics of a probability distribution). This would be especially useful to investigate the effects of demographic stochasticity in response to trait evolution [<xref ref-type="bibr" rid="R25">25</xref>], and to model, for instance, environmentally mediated evolutionary suicide or rescue. Our framework may nevertheless provide a suitable approximation to cases of demographic and environmental stochasticity (with <xref ref-type="disp-formula" rid="FD9">eq. 9</xref> giving the expectation in state variable at the next time step, conditional on the states of at the previous step). This approach has been shown to work well under the island model of dispersal provided that patches were not too small and dispersal not too limited [<xref ref-type="bibr" rid="R41">41</xref>]. It would be interesting to investigate how this holds up under isolation by distance.</p></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Appendix</label><media xlink:href="EMS188460-supplement-Appendix.pdf" mimetype="application" mime-subtype="vnd.openxmlformats-officedocument.wordprocessingml.document" id="d26aAdEbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S15"><title>Acknowledgements</title><p>CM thanks the Swiss National Science Foundation for funding (PCEFP3181243 to CM); JP acknowledges funding from the French National Research Agency (ANR) under the Investments for the Future (Investissements d’Avenir) program, grant ANR-17-EURE-0010, and from the Max Planck Institute for Evolutionary Anthropology.</p></ack><ref-list><ref id="R1"><label>[1]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Estrela</surname><given-names>S</given-names></name><name><surname>Libby</surname><given-names>E</given-names></name><name><surname>Van Cleve</surname><given-names>J</given-names></name><name><surname>Débarre</surname><given-names>F</given-names></name><name><surname>Deforet</surname><given-names>M</given-names></name><name><surname>Harcombe</surname><given-names>WR</given-names></name><etal/></person-group><article-title>Environmentally Mediated Social Dilemmas</article-title><source>Trends Ecol Evol</source><year>2019</year><volume>34</volume><issue>1</issue><fpage>6</fpage><lpage>18</lpage><pub-id pub-id-type="pmid">30415827</pub-id></element-citation></ref><ref id="R2"><label>[2]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lehmann</surname><given-names>L</given-names></name></person-group><article-title>The evolution of trans-generational altruism: kin selection meets niche construction</article-title><source>Journal of Evolutionary Biology</source><year>2007</year><volume>20</volume><fpage>181</fpage><lpage>189</lpage><pub-id pub-id-type="pmid">17210011</pub-id></element-citation></ref><ref id="R3"><label>[3]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kuijper</surname><given-names>B</given-names></name><name><surname>Johnstone</surname><given-names>RA</given-names></name></person-group><article-title>The evolution of early-life effects on social behaviour-why should social adversity carry over to the future?</article-title><source>Philos Trans R Soc Lond B Biol Sci</source><year>2019</year><volume>374</volume><issue>1770</issue><elocation-id>20180111</elocation-id><pub-id pub-id-type="pmcid">PMC6460086</pub-id><pub-id pub-id-type="pmid">30966877</pub-id><pub-id pub-id-type="doi">10.1098/rstb.2018.0111</pub-id></element-citation></ref><ref id="R4"><label>[4]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Frank</surname><given-names>SA</given-names></name></person-group><source>Foundations of Social Evolution</source><publisher-name>Princeton University Press</publisher-name><publisher-loc>Princeton, NJ</publisher-loc><year>1998</year></element-citation></ref><ref id="R5"><label>[5]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Rousset</surname><given-names>F</given-names></name></person-group><source>Genetic Structure and Selection in Subdivided Populations</source><publisher-name>Princeton University Press</publisher-name><publisher-loc>Princeton, NJ</publisher-loc><year>2004</year></element-citation></ref><ref id="R6"><label>[6]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lehmann</surname><given-names>L</given-names></name><name><surname>Rousset</surname><given-names>F</given-names></name></person-group><article-title>The genetical theory of social behaviour</article-title><source>Philosophical Transactions of the Royal Society B</source><year>2014</year><volume>369</volume><fpage>1</fpage><lpage>18</lpage><pub-id pub-id-type="pmcid">PMC3982659</pub-id><pub-id pub-id-type="pmid">24686929</pub-id><pub-id pub-id-type="doi">10.1098/rstb.2013.0357</pub-id></element-citation></ref><ref id="R7"><label>[7]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van Cleve</surname><given-names>J</given-names></name></person-group><article-title>Social evolution and genetic interactions in the short and long term</article-title><source>Theoretical Population Biology</source><year>2015</year><volume>103</volume><fpage>2</fpage><lpage>26</lpage><pub-id pub-id-type="pmid">26003630</pub-id></element-citation></ref><ref id="R8"><label>[8]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>McNamara</surname><given-names>JM</given-names></name><name><surname>Leimar</surname><given-names>O</given-names></name></person-group><source>Game theory in biology: concepts and frontiers</source><publisher-loc>Oxford University Press</publisher-loc><year>2020</year></element-citation></ref><ref id="R9"><label>[9]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Avila</surname><given-names>P</given-names></name><name><surname>Mullon</surname><given-names>C</given-names></name></person-group><article-title>Evolutionary game theory and the adaptive dynamics approach: adaptation where individuals interact</article-title><source>Philosophical Transactions of the Royal Society B</source><year>2023</year><volume>378</volume><elocation-id>615255</elocation-id><pub-id pub-id-type="pmcid">PMC10024992</pub-id><pub-id pub-id-type="pmid">36934752</pub-id><pub-id pub-id-type="doi">10.1098/rstb.2021.0502</pub-id></element-citation></ref><ref id="R10"><label>[10]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Eshel</surname><given-names>I</given-names></name></person-group><article-title>Evolutionary and continuous stability</article-title><source>Journal ot Theoretical Biology</source><year>1983</year><volume>103</volume><fpage>99</fpage><lpage>111</lpage><pub-id pub-id-type="pmid">9156083</pub-id></element-citation></ref><ref id="R11"><label>[11]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rousset</surname><given-names>F</given-names></name><name><surname>Billiard</surname><given-names>S</given-names></name></person-group><article-title>A theoretical basis for measures of kin selection in subdivided populations: finite populations and localized dispersal</article-title><source>Journal of Evolutionary Biology</source><year>2000</year><volume>13</volume><fpage>814</fpage><lpage>825</lpage></element-citation></ref><ref id="R12"><label>[12]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rousset</surname><given-names>F</given-names></name></person-group><article-title>A minimal derivation of convergence stability measures</article-title><source>Journal of Theoretical Biology</source><year>2003</year><volume>221</volume><fpage>665</fpage><lpage>668</lpage><pub-id pub-id-type="pmid">12713948</pub-id></element-citation></ref><ref id="R13"><label>[13]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rogers</surname><given-names>AR</given-names></name></person-group><article-title>Group selection by selective emigration: the effects of migration and kin structure</article-title><source>American Naturalist</source><year>1990</year><volume>135</volume><fpage>398</fpage><lpage>413</lpage></element-citation></ref><ref id="R14"><label>[14]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Taylor</surname><given-names>PD</given-names></name></person-group><article-title>Altruism in viscous populations - an inclusive fitness model</article-title><source>Evolutionary Ecology</source><year>1992</year><volume>6</volume><fpage>352</fpage><lpage>356</lpage></element-citation></ref><ref id="R15"><label>[15]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Irwin</surname><given-names>AJ</given-names></name><name><surname>Taylor</surname><given-names>PD</given-names></name></person-group><article-title>Evolution of altruism in stepping-stone populations with overlapping generations</article-title><source>Theoretical Population Biology</source><year>2001</year><volume>60</volume><fpage>315</fpage><lpage>325</lpage><pub-id pub-id-type="pmid">11878832</pub-id></element-citation></ref><ref id="R16"><label>[16]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Taylor</surname><given-names>PD</given-names></name><name><surname>Day</surname><given-names>T</given-names></name><name><surname>Wild</surname><given-names>G</given-names></name></person-group><article-title>Evolution of cooperation in a finite homogeneous graph</article-title><source>Nature</source><year>2007</year><volume>447</volume><fpage>469</fpage><lpage>472</lpage><pub-id pub-id-type="pmid">17522682</pub-id></element-citation></ref><ref id="R17"><label>[17]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lehmann</surname><given-names>L</given-names></name><name><surname>Keller</surname><given-names>L</given-names></name><name><surname>Sumpter</surname><given-names>D</given-names></name></person-group><article-title>The evolution of helping and harming on graphs: the return of the inclusive fitness effect</article-title><source>Journal of Evolutionary Biology</source><year>2007</year><volume>20</volume><fpage>2284</fpage><lpage>229</lpage><pub-id pub-id-type="pmid">17956391</pub-id></element-citation></ref><ref id="R18"><label>[18]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Grafen</surname><given-names>A</given-names></name><name><surname>Archetti</surname><given-names>M</given-names></name></person-group><article-title>Natural selection of altruism in inelastic viscous homogeneous populations</article-title><source>Journal of Theoretical Biology</source><year>2008</year><volume>252</volume><issue>4</issue><fpage>694</fpage><lpage>710</lpage><pub-id pub-id-type="pmid">18371985</pub-id></element-citation></ref><ref id="R19"><label>[19]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lion</surname><given-names>S</given-names></name><name><surname>Gandon</surname><given-names>S</given-names></name></person-group><article-title>Habitat saturation and the spatial evolutionary ecology of altruism</article-title><source>Journal of Evolutionary Biology</source><year>2009</year><volume>22</volume><issue>7</issue><fpage>1487</fpage><lpage>1502</lpage><pub-id pub-id-type="pmid">19519786</pub-id></element-citation></ref><ref id="R20"><label>[20]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lion</surname><given-names>S</given-names></name><name><surname>Gandon</surname><given-names>S</given-names></name></person-group><article-title>Life history, habitat saturation and the evolution of fecundity and survival altruism</article-title><source>Evolution</source><year>2010</year><volume>64</volume><issue>6</issue><fpage>1594</fpage><lpage>606</lpage><pub-id pub-id-type="pmid">20050913</pub-id></element-citation></ref><ref id="R21"><label>[21]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Taylor</surname><given-names>PD</given-names></name></person-group><article-title>Sex ratio in a stepping-stone population with sex-specific dispersal</article-title><source>Theoretical Population Biology</source><year>1994</year><volume>45</volume><issue>2</issue><fpage>203</fpage><lpage>218</lpage><pub-id pub-id-type="pmid">8016752</pub-id></element-citation></ref><ref id="R22"><label>[22]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Comins</surname><given-names>HN</given-names></name><name><surname>Hamilton</surname><given-names>WD</given-names></name><name><surname>May</surname><given-names>RM</given-names></name></person-group><article-title>Evolutionarily stable dispersal strategies</article-title><source>Journal ot Theoretical Biology</source><year>1980</year><volume>82</volume><fpage>205</fpage><lpage>230</lpage><pub-id pub-id-type="pmid">7374178</pub-id></element-citation></ref><ref id="R23"><label>[23]</label><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Gandon</surname><given-names>S</given-names></name><name><surname>Rousset</surname><given-names>F</given-names></name></person-group><article-title>Evolution of stepping-stone dispersal rates</article-title><source>Proceedings of the Royal Society of London Series B-Biological Sciences</source><year>1999</year><volume>221</volume><fpage>2507</fpage><lpage>2513</lpage></element-citation></ref><ref id="R24"><label>[24]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rousset</surname><given-names>F</given-names></name><name><surname>Gandon</surname><given-names>S</given-names></name></person-group><article-title>Evolution of the distribution of dispersal distance under distance-dependent cost of dispersal</article-title><source>Journal of Evolutionary Biology</source><year>2002</year><volume>15</volume><fpage>515</fpage><lpage>523</lpage></element-citation></ref><ref id="R25"><label>[25]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rousset</surname><given-names>F</given-names></name><name><surname>Ronce</surname><given-names>O</given-names></name></person-group><article-title>Inclusive fitness for traits affecting metapopulation demography</article-title><source>Theoretical Population Biology</source><year>2004</year><volume>65</volume><fpage>127</fpage><lpage>141</lpage><pub-id pub-id-type="pmid">14766187</pub-id></element-citation></ref><ref id="R26"><label>[26]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wright</surname><given-names>S</given-names></name></person-group><article-title>Evolution in Mendelian populations</article-title><source>Genetics</source><year>1931</year><volume>16</volume><fpage>97</fpage><lpage>159</lpage><pub-id pub-id-type="pmcid">PMC1201091</pub-id><pub-id pub-id-type="pmid">17246615</pub-id><pub-id pub-id-type="doi">10.1093/genetics/16.2.97</pub-id></element-citation></ref><ref id="R27"><label>[27]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cadet</surname><given-names>C</given-names></name><name><surname>Ferrière</surname><given-names>R</given-names></name><name><surname>Metz</surname><given-names>JAJ</given-names></name><name><surname>van Baalen</surname><given-names>M</given-names></name></person-group><article-title>The evolution of dispersal under demographic stochasticity</article-title><source>American Naturalist</source><year>2003</year><volume>162</volume><issue>4</issue><fpage>427</fpage><lpage>41</lpage><pub-id pub-id-type="pmid">14582006</pub-id></element-citation></ref><ref id="R28"><label>[28]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Parvinen</surname><given-names>K</given-names></name><name><surname>Dieckmann</surname><given-names>U</given-names></name><name><surname>Gyllenberg</surname><given-names>M</given-names></name><name><surname>Metz</surname><given-names>JAJ</given-names></name></person-group><article-title>Evolution of dispersal in metapopulations with local density dependence and demographic stochasticity</article-title><source>Journal of Evolutionary Biology</source><year>2003</year><volume>16</volume><issue>1</issue><fpage>143</fpage><lpage>53</lpage><pub-id pub-id-type="pmid">14635889</pub-id></element-citation></ref><ref id="R29"><label>[29]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lehmann</surname><given-names>L</given-names></name><name><surname>Perrin</surname><given-names>N</given-names></name><name><surname>Rousset</surname><given-names>F</given-names></name></person-group><article-title>Population demography and the evolution of helping behaviors</article-title><source>Evolution</source><year>2006</year><volume>60</volume><fpage>1137</fpage><lpage>1151</lpage><pub-id pub-id-type="pmid">16892965</pub-id></element-citation></ref><ref id="R30"><label>[30]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wild</surname><given-names>G</given-names></name><name><surname>Gardner</surname><given-names>A</given-names></name><name><surname>West</surname><given-names>SA</given-names></name></person-group><article-title>Adaptation and the evolution of parasite virulence in a connected world</article-title><source>Nature</source><year>2009</year><volume>459</volume><fpage>983</fpage><lpage>986</lpage><pub-id pub-id-type="pmid">19474791</pub-id></element-citation></ref><ref id="R31"><label>[31]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nakamaru</surname><given-names>M</given-names></name><name><surname>Matsuda</surname><given-names>H</given-names></name><name><surname>Iwasa</surname><given-names>Y</given-names></name></person-group><article-title>The evolution of cooperation in a lattice-structured population</article-title><source>Journal of Theoretical Biology</source><year>1997</year><volume>184</volume><fpage>65</fpage><lpage>81</lpage><pub-id pub-id-type="pmid">9039401</pub-id></element-citation></ref><ref id="R32"><label>[32]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>van Baalen</surname><given-names>M</given-names></name><name><surname>Rand</surname><given-names>AR</given-names></name></person-group><article-title>The unit of selection in viscous populations and the evolution of altruism</article-title><source>Journal of Theoretical Biology</source><year>1998</year><volume>193</volume><fpage>631</fpage><lpage>648</lpage><pub-id pub-id-type="pmid">9750181</pub-id></element-citation></ref><ref id="R33"><label>[33]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Le Galliard</surname><given-names>JF</given-names></name><name><surname>Ferrière</surname><given-names>R</given-names></name><name><surname>Dieckmann</surname><given-names>U</given-names></name></person-group><article-title>The adaptive dynamics of altruism in spatially heterogeneous populations</article-title><source>Evolution</source><year>2003</year><volume>57</volume><fpage>1</fpage><lpage>17</lpage><pub-id pub-id-type="pmid">12643563</pub-id></element-citation></ref><ref id="R34"><label>[34]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Le Galliard</surname><given-names>JF</given-names></name><name><surname>Ferrière</surname><given-names>R</given-names></name><name><surname>Dieckmann</surname><given-names>U</given-names></name></person-group><article-title>Adaptive Evolution of Social Traits: Origin, Trajectories</article-title><source>American Naturalist</source><year>2005</year><volume>165</volume><fpage>206</fpage><lpage>224</lpage><pub-id pub-id-type="pmid">15729651</pub-id></element-citation></ref><ref id="R35"><label>[35]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Nakamaru</surname><given-names>M</given-names></name><name><surname>Iwasa</surname><given-names>Y</given-names></name></person-group><article-title>The evolution of altruism by costly punishment in lattice-structured populations: score-dependent viability versus score-dependent fertility</article-title><source>Evolutionary Ecology Research</source><year>2005</year><volume>7</volume><fpage>853</fpage><lpage>870</lpage></element-citation></ref><ref id="R36"><label>[36]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ohtsuki</surname><given-names>H</given-names></name><name><surname>Hauert</surname><given-names>C</given-names></name><name><surname>Lieberman</surname><given-names>E</given-names></name><name><surname>Nowak</surname><given-names>MA</given-names></name></person-group><article-title>A simple rule for the evolution of cooperation on graphs and social networks</article-title><source>Nature</source><year>2006</year><volume>441</volume><fpage>502</fpage><lpage>505</lpage><pub-id pub-id-type="pmcid">PMC2430087</pub-id><pub-id pub-id-type="pmid">16724065</pub-id><pub-id pub-id-type="doi">10.1038/nature04605</pub-id></element-citation></ref><ref id="R37"><label>[37]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lion</surname><given-names>S</given-names></name><name><surname>van Baalen</surname><given-names>M</given-names></name></person-group><article-title>From infanticide to parental care: Why spatial structure can help adults be good parents</article-title><source>American Naturalist</source><year>2007</year><volume>170</volume><issue>2</issue><fpage>E26</fpage><lpage>E46</lpage><pub-id pub-id-type="pmid">17874366</pub-id></element-citation></ref><ref id="R38"><label>[38]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peña</surname><given-names>J</given-names></name><name><surname>Wu</surname><given-names>B</given-names></name><name><surname>Arranz</surname><given-names>J</given-names></name><name><surname>Traulsen</surname><given-names>A</given-names></name></person-group><article-title>Evolutionary Games of Multiplayer Cooperation on Graphs</article-title><source>PLOS Computational Biology</source><year>2016</year><volume>12</volume><issue>8</issue><fpage>1</fpage><lpage>15</lpage><pub-id pub-id-type="pmcid">PMC4981334</pub-id><pub-id pub-id-type="pmid">27513946</pub-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1005059</pub-id></element-citation></ref><ref id="R39"><label>[39]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lion</surname><given-names>S</given-names></name></person-group><article-title>Relatedness in spatially structured populations with empty sites: An approach based on spatial moment equations</article-title><source>Journal of Theoretical Biology</source><year>2009</year><volume>260</volume><fpage>121</fpage><lpage>131</lpage><pub-id pub-id-type="pmid">19505481</pub-id></element-citation></ref><ref id="R40"><label>[40]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ellner</surname><given-names>SP</given-names></name></person-group><article-title>Pair Approximation for Lattice Models with Multiple Interaction Scales</article-title><source>Journal of Theoretical Biology</source><year>2001</year><volume>210</volume><fpage>435</fpage><lpage>447</lpage><pub-id pub-id-type="pmid">11403564</pub-id></element-citation></ref><ref id="R41"><label>[41]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mullon</surname><given-names>C</given-names></name><name><surname>Lehmann</surname><given-names>L</given-names></name></person-group><article-title>Eco-evolutionary dynamics in metacommunities: ecological inheritance, helping within species, and harming between species</article-title><source>American Naturalist</source><year>2018</year><volume>192</volume><issue>6</issue><fpage>664</fpage><lpage>685</lpage><pub-id pub-id-type="pmid">30444662</pub-id></element-citation></ref><ref id="R42"><label>[42]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mullon</surname><given-names>C</given-names></name><name><surname>Wakano</surname><given-names>JY</given-names></name><name><surname>Ohtsuki</surname><given-names>H</given-names></name></person-group><article-title>Coevolutionary dynamics of genetic traits and their long-term extended effects under non-random interactions</article-title><source>Journal of Theoretical Biology</source><year>2021</year><volume>525</volume><elocation-id>110750</elocation-id><pub-id pub-id-type="pmid">33957155</pub-id></element-citation></ref><ref id="R43"><label>[43]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lehmann</surname><given-names>L</given-names></name></person-group><article-title>The adaptive dynamics of niche constructing traits in spatially subdivided populations: evolving posthumous extended phenotypes</article-title><source>Evolution</source><year>2008</year><volume>62</volume><fpage>549</fpage><lpage>566</lpage><pub-id pub-id-type="pmid">17983464</pub-id></element-citation></ref><ref id="R44"><label>[44]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lehmann</surname><given-names>L</given-names></name><name><surname>Rousset</surname><given-names>F</given-names></name></person-group><article-title>The evolution of social discounting in hierarchically clustered populations</article-title><source>Molecular Ecology</source><year>2012</year><volume>21</volume><fpage>447</fpage><lpage>471</lpage><pub-id pub-id-type="pmid">21880087</pub-id></element-citation></ref><ref id="R45"><label>[45]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Taylor</surname><given-names>PD</given-names></name><name><surname>Lilicrap</surname><given-names>TDC</given-names></name></person-group><article-title>Inclusive fitness analysis on mathematical groups</article-title><source>Evolution</source><year>2011</year><fpage>849</fpage><lpage>59</lpage><pub-id pub-id-type="pmid">21044061</pub-id></element-citation></ref><ref id="R46"><label>[46]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jansen</surname><given-names>VAA</given-names></name><name><surname>Lloyd</surname><given-names>AL</given-names></name></person-group><article-title>Local stability analysis of spatially homogeneous solutions of multi-patch systems</article-title><source>J Math Biol</source><year>2000</year><volume>41</volume><issue>3</issue><fpage>232</fpage><lpage>252</lpage><pub-id pub-id-type="pmid">11072757</pub-id></element-citation></ref><ref id="R47"><label>[47]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Malécot</surname><given-names>G</given-names></name></person-group><article-title>Heterozygosity and relationship in regularly subdivided populations</article-title><source>Theoretical Population Biology</source><year>1975</year><volume>8</volume><fpage>212</fpage><lpage>241</lpage><pub-id pub-id-type="pmid">1198353</pub-id></element-citation></ref><ref id="R48"><label>[48]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sawyer</surname><given-names>S</given-names></name></person-group><article-title>Results for the stepping stone model for migration in population genetics</article-title><source>Annals of Probability</source><year>1976</year><volume>4</volume><fpage>699</fpage><lpage>728</lpage></element-citation></ref><ref id="R49"><label>[49]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lehmann</surname><given-names>L</given-names></name></person-group><article-title>Space-time relatedness and Hamilton’s rule for long-lasting behaviors in viscous populations</article-title><source>American Naturalist</source><year>2010</year><volume>175</volume><issue>1</issue><fpage>136</fpage><lpage>143</lpage><pub-id pub-id-type="pmid">19911983</pub-id></element-citation></ref><ref id="R50"><label>[50]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hamilton</surname><given-names>WD</given-names></name></person-group><article-title>Selfish and spiteful behavior in an evolutionary model</article-title><source>Nature</source><year>1970</year><volume>228</volume><fpage>1218</fpage><lpage>1220</lpage><pub-id pub-id-type="pmid">4395095</pub-id></element-citation></ref><ref id="R51"><label>[51]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rousset</surname><given-names>F</given-names></name></person-group><article-title>Separation of time scales, fixation probabilities and convergence to evolutionarily stable states under isolation by distance</article-title><source>Theoretical Population Biology</source><year>2006</year><volume>69</volume><fpage>165</fpage><lpage>179</lpage><pub-id pub-id-type="pmid">16405936</pub-id></element-citation></ref><ref id="R52"><label>[52]</label><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Ohtsuki</surname><given-names>H</given-names></name><name><surname>Nowak</surname><given-names>MA</given-names></name></person-group><article-title>Evolutionary games on cycles</article-title><source>Proceedings of the Royal Society of London Series B-Biological Sciences</source><year>2006</year><volume>273</volume><fpage>2249</fpage><lpage>2256</lpage></element-citation></ref><ref id="R53"><label>[53]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lehmann</surname><given-names>L</given-names></name><name><surname>Rousset</surname><given-names>F</given-names></name></person-group><article-title>How life-history and demography promote or inhibit the evolution of helping behaviors</article-title><source>Philosophical Transactions of the Royal Society B</source><year>2010</year><volume>365</volume><fpage>2599</fpage><lpage>2617</lpage><pub-id pub-id-type="pmcid">PMC2936172</pub-id><pub-id pub-id-type="pmid">20679105</pub-id><pub-id pub-id-type="doi">10.1098/rstb.2010.0138</pub-id></element-citation></ref><ref id="R54"><label>[54]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Peña</surname><given-names>J</given-names></name><name><surname>Nöldeke</surname><given-names>G</given-names></name><name><surname>Lehmann</surname><given-names>L</given-names></name></person-group><article-title>Evolutionary dynamics of collective action in spatially structured populations</article-title><source>Journal of Theoretical Biology</source><year>2015</year><volume>382</volume><fpage>122</fpage><lpage>136</lpage><pub-id pub-id-type="pmid">26151588</pub-id></element-citation></ref><ref id="R55"><label>[55]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Alger</surname><given-names>I</given-names></name><name><surname>Weibull</surname><given-names>JW</given-names></name><name><surname>Lehmann</surname><given-names>L</given-names></name></person-group><article-title>Evolution of preferences in structured populations: Genes, guns, and culture</article-title><source>Journal of Economic Theory</source><year>2020</year><volume>185</volume><fpage>1</fpage><lpage>45</lpage></element-citation></ref><ref id="R56"><label>[56]</label><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Taylor</surname><given-names>PD</given-names></name></person-group><article-title>Inclusive fitness in a homogeneous environment</article-title><source>Proceedings of the Royal Society of London Series B-Biological Sciences</source><year>1992</year><volume>240</volume><fpage>299</fpage><lpage>302</lpage></element-citation></ref><ref id="R57"><label>[57]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Taylor</surname><given-names>PD</given-names></name><name><surname>Irwin</surname><given-names>AJ</given-names></name></person-group><article-title>Overlapping generations can promote altruistic behavior</article-title><source>Evolution</source><year>2000</year><volume>54</volume><fpage>1135</fpage><lpage>1141</lpage><pub-id pub-id-type="pmid">11005283</pub-id></element-citation></ref><ref id="R58"><label>[58]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Dawkins</surname><given-names>R</given-names></name></person-group><source>The Extended Phenotype</source><publisher-name>Oxford University Press</publisher-name><publisher-loc>Oxford</publisher-loc><year>1982</year></element-citation></ref><ref id="R59"><label>[59]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dawkins</surname><given-names>R</given-names></name></person-group><article-title>Extended Phenotype - But not too extended. A reply to Laland, Turner and Jablonka</article-title><source>Biology and Philosophy</source><year>2004</year><volume>19</volume><fpage>377</fpage><lpage>396</lpage></element-citation></ref><ref id="R60"><label>[60]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Smith</surname><given-names>Maynard J</given-names></name></person-group><source>Evolution and the Theory of Games</source><publisher-name>Cambridge University Press</publisher-name><publisher-loc>Cambridge</publisher-loc><year>1982</year></element-citation></ref><ref id="R61"><label>[61]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Weibull</surname><given-names>JW</given-names></name></person-group><source>Evolutionary Game Theory</source><publisher-name>MIT Press</publisher-name><publisher-loc>Cambridge, MA</publisher-loc><year>1997</year></element-citation></ref><ref id="R62"><label>[62]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Queller</surname><given-names>DC</given-names></name></person-group><article-title>Genetic relatedness in viscous populations</article-title><source>Evolutionary Ecology</source><year>1994</year><volume>8</volume><fpage>70</fpage><lpage>73</lpage></element-citation></ref><ref id="R63"><label>[63]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ohtsuki</surname><given-names>H</given-names></name><name><surname>Nowak</surname><given-names>MA</given-names></name></person-group><article-title>Evolutionary stability on graphs</article-title><source>Journal of Theoretical Biology</source><year>2008</year><volume>251</volume><fpage>698</fpage><lpage>707</lpage><pub-id pub-id-type="pmcid">PMC2430060</pub-id><pub-id pub-id-type="pmid">18295801</pub-id><pub-id pub-id-type="doi">10.1016/j.jtbi.2008.01.005</pub-id></element-citation></ref><ref id="R64"><label>[64]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kaveh</surname><given-names>K</given-names></name><name><surname>Komarova</surname><given-names>NL</given-names></name><name><surname>Kohandel</surname><given-names>M</given-names></name></person-group><article-title>The duality of spatial death–birth and birth–death processes and limitations of the isothermal theorem</article-title><source>Royal Society Open Science</source><year>2014</year><volume>2</volume><pub-id pub-id-type="pmcid">PMC4448870</pub-id><pub-id pub-id-type="pmid">26064637</pub-id><pub-id pub-id-type="doi">10.1098/rsos.140465</pub-id></element-citation></ref><ref id="R65"><label>[65]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Débarre</surname><given-names>F</given-names></name></person-group><article-title>Fidelity of parent-offspring transmission and the evolution of social behavior in structured populations</article-title><source>Journal of Theoretical Biology</source><year>2017</year><volume>420</volume><fpage>26</fpage><lpage>35</lpage><pub-id pub-id-type="pmid">28254478</pub-id></element-citation></ref><ref id="R66"><label>[66]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Hamilton</surname><given-names>WD</given-names></name></person-group><chapter-title>Selection of selfish and altruistic behaviour in some extreme models</chapter-title><person-group person-group-type="editor"><name><surname>Eisenberg</surname><given-names>JF</given-names></name><name><surname>Dillon</surname><given-names>WS</given-names></name></person-group><source>Man and Beast: Comparative Social Behavior</source><publisher-name>Smithsonian Institutions Press</publisher-name><publisher-loc>Washington, DC</publisher-loc><year>1971</year><fpage>59</fpage><lpage>91</lpage></element-citation></ref><ref id="R67"><label>[67]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schaffer</surname><given-names>ME</given-names></name></person-group><article-title>Evolutionarily stable strategies for a finite population and a variable contest size</article-title><source>Journal of Theoretical Biology</source><year>1988</year><volume>132</volume><issue>4</issue><fpage>469</fpage><lpage>478</lpage><pub-id pub-id-type="pmid">3226137</pub-id></element-citation></ref><ref id="R68"><label>[68]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gardner</surname><given-names>A</given-names></name><name><surname>West</surname><given-names>SA</given-names></name></person-group><article-title>Spite and the scale of competition</article-title><source>Journal of Evolutionary Biology</source><year>2004</year><volume>17</volume><fpage>1195</fpage><lpage>1203</lpage><pub-id pub-id-type="pmid">15525404</pub-id></element-citation></ref><ref id="R69"><label>[69]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lehmann</surname><given-names>L</given-names></name><name><surname>Feldman</surname><given-names>MW</given-names></name><name><surname>Rousset</surname><given-names>F</given-names></name></person-group><article-title>On the evolution of harming and recognition in finite panmictic and infinite structured populations</article-title><source>Evolution</source><year>2009</year><volume>63</volume><fpage>2896</fpage><lpage>2913</lpage><pub-id pub-id-type="pmcid">PMC2989735</pub-id><pub-id pub-id-type="pmid">19624725</pub-id><pub-id pub-id-type="doi">10.1111/j.1558-5646.2009.00778.x</pub-id></element-citation></ref><ref id="R70"><label>[70]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>West</surname><given-names>SA</given-names></name><name><surname>Gardner</surname><given-names>A</given-names></name></person-group><article-title>Altruism, spite, and greenbeards</article-title><source>Science</source><year>2010</year><volume>327</volume><fpage>1341</fpage><lpage>1344</lpage><pub-id pub-id-type="pmid">20223978</pub-id></element-citation></ref><ref id="R71"><label>[71]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Smead</surname><given-names>R</given-names></name><name><surname>Forber</surname><given-names>P</given-names></name></person-group><article-title>The coevolution of recognition and social behavior</article-title><source>Scientifc Reports</source><year>2016</year><volume>6</volume><elocation-id>25813</elocation-id><pub-id pub-id-type="pmcid">PMC4881042</pub-id><pub-id pub-id-type="pmid">27225673</pub-id><pub-id pub-id-type="doi">10.1038/srep25813</pub-id></element-citation></ref><ref id="R72"><label>[72]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bruner</surname><given-names>JP</given-names></name><name><surname>Smead</surname><given-names>R</given-names></name></person-group><article-title>Tag-based spite with correlated interactions</article-title><source>Journal of Theoretical Biology</source><year>2022</year><volume>540</volume><elocation-id>111052</elocation-id><pub-id pub-id-type="pmid">35247376</pub-id></element-citation></ref><ref id="R73"><label>[73]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Borenstein</surname><given-names>DB</given-names></name><name><surname>Meir</surname><given-names>Y</given-names></name><name><surname>Shaevitz</surname><given-names>JW</given-names></name><name><surname>Wingreen</surname><given-names>NS</given-names></name></person-group><article-title>Non-Local Interaction via Diffusible Resource Prevents Coexistence of Cooperators and Cheaters in a Lattice Model</article-title><source>PLOS ONE</source><year>2013</year><volume>8</volume><elocation-id>e63304</elocation-id><pub-id pub-id-type="pmcid">PMC3656920</pub-id><pub-id pub-id-type="pmid">23691017</pub-id><pub-id pub-id-type="doi">10.1371/journal.pone.0063304</pub-id></element-citation></ref><ref id="R74"><label>[74]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Allen</surname><given-names>B</given-names></name><name><surname>Gore</surname><given-names>J</given-names></name><name><surname>Nowak</surname><given-names>MA</given-names></name></person-group><article-title>Spatial dilemmas of diffusible public goods</article-title><source>eLife</source><year>2013</year><volume>2013</volume><pub-id pub-id-type="pmcid">PMC3865686</pub-id><pub-id pub-id-type="pmid">24347543</pub-id><pub-id pub-id-type="doi">10.7554/eLife.01169</pub-id></element-citation></ref><ref id="R75"><label>[75]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Scheuring</surname><given-names>I</given-names></name></person-group><article-title>Diffusive Public Goods and Coexistence of Cooperators and Cheaters on a 1D Lattice</article-title><source>PLOS ONE</source><year>2014</year><volume>9</volume><elocation-id>e100769</elocation-id><pub-id pub-id-type="pmcid">PMC4098918</pub-id><pub-id pub-id-type="pmid">25025985</pub-id><pub-id pub-id-type="doi">10.1371/journal.pone.0100769</pub-id></element-citation></ref><ref id="R76"><label>[76]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Menon</surname><given-names>R</given-names></name><name><surname>Korolev</surname><given-names>KS</given-names></name></person-group><article-title>Public good diffusion limits microbial mutualism</article-title><source>Physical Review Letters</source><year>2015</year><volume>114</volume><elocation-id>168102</elocation-id><pub-id pub-id-type="pmid">25955075</pub-id></element-citation></ref><ref id="R77"><label>[77]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gerlee</surname><given-names>P</given-names></name><name><surname>Altrock</surname><given-names>PM</given-names></name></person-group><article-title>Persistence of cooperation in diffusive public goods games</article-title><source>Physical Review E</source><year>2019</year><volume>99</volume><elocation-id>062412</elocation-id><pub-id pub-id-type="pmid">31330651</pub-id></element-citation></ref><ref id="R78"><label>[78]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Case</surname><given-names>TJ</given-names></name></person-group><source>An Illustrated Guide to Theoretical Ecology</source><publisher-name>Oxford University Press</publisher-name><publisher-loc>Oxford</publisher-loc><year>2000</year></element-citation></ref><ref id="R79"><label>[79]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Begon</surname><given-names>M</given-names></name><name><surname>Townsend</surname><given-names>CR</given-names></name></person-group><source>Ecology: from Individuals to Ecosystems</source><edition>5th ed</edition><publisher-name>Wiley</publisher-name><publisher-loc>West Sussex</publisher-loc><year>2021</year></element-citation></ref><ref id="R80"><label>[80]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Terras</surname><given-names>A</given-names></name></person-group><source>Fourier analysis on finite groups and applications</source><publisher-name>Cambridge University Press</publisher-name><year>1999</year><volume>43</volume></element-citation></ref><ref id="R81"><label>[81]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lehmann</surname><given-names>L</given-names></name></person-group><article-title>The stationary distribution of a continuously varying strategy in a class-structured population under mutation-selection-drift balance</article-title><source>Journal of Evolutionary Biology</source><year>2012</year><volume>25</volume><fpage>770</fpage><lpage>787</lpage><pub-id pub-id-type="pmid">22372617</pub-id></element-citation></ref><ref id="R82"><label>[82]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Grimmett</surname><given-names>G</given-names></name><name><surname>Stirzaker</surname><given-names>D</given-names></name></person-group><source>Probability and Random Processes</source><publisher-name>Oxford University Press</publisher-name><publisher-loc>Oxford</publisher-loc><year>2001</year></element-citation></ref><ref id="R83"><label>[83]</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Galor</surname><given-names>O</given-names></name></person-group><source>Discrete Dynamical Systems</source><publisher-name>Springer</publisher-name><publisher-loc>Berlin</publisher-loc><year>2007</year></element-citation></ref><ref id="R84"><label>[84]</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Diaconis</surname><given-names>P</given-names></name></person-group><article-title>Group representations in probability and statistics</article-title><source>Institute of Mathematical Statistics Lecture Notes</source><year>1988</year></element-citation></ref></ref-list></back><floats-group><boxed-text id="BX1" position="float" orientation="portrait"><label>Box I</label><caption><title>Fourier analysis on finite abelian groups</title></caption><p>We assume that the set of patches 𝔾 is endowed with an abelian group structure, which allows us to consider more general spatial structures than just lattice models (e.g. hierarchical structures). The group 𝔾 is defined as the direct product, <disp-formula id="FD37"><label>(I.A)</label><mml:math id="M69"><mml:mo>𝔾</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>ℤ</mml:mi><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:mo>…</mml:mo><mml:mo>×</mml:mo><mml:msub><mml:mi>ℤ</mml:mi><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:msub><mml:mi>d</mml:mi><mml:mo>'</mml:mo></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></disp-formula> where <inline-formula><mml:math id="M70"><mml:mrow><mml:msub><mml:mi>ℤ</mml:mi><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> is the additive group of integers modulo <italic>D</italic><sub><italic>j</italic></sub>. The group 𝔾 then consists of the set of all vectors <bold>i</bold> = (<italic>i</italic><sub>1</sub>, …, <italic>i</italic><sub><italic>d</italic></sub>) with <inline-formula><mml:math id="M71"><mml:mrow><mml:msub><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>∈</mml:mo><mml:msub><mml:mi>ℤ</mml:mi><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> together with addition (where addition between two vectors is component-wise). On such a group, the Fourier transform ℱ (<bold>h</bold>) of function <italic>f</italic> at <bold>h</bold> ∈ 𝔾 is given by <disp-formula id="FD38"><label>(I.B)</label><mml:math id="M72"><mml:mi>ℱ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>∑</mml:mi><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:msub><mml:mi>f</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:msub><mml:mi>χ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula> where the “character” function <disp-formula id="FD39"><label>(I.C)</label><mml:math id="M73"><mml:msub><mml:mi>χ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mstyle displaystyle="true"><mml:mo>∏</mml:mo></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>d</mml:mi></mml:munderover><mml:mi>exp</mml:mi><mml:mo>(</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>ι</mml:mi><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>exp</mml:mi><mml:mo>(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>ι</mml:mi><mml:munderover><mml:mrow><mml:mi>∑</mml:mi><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>d</mml:mi></mml:munderover><mml:mfrac><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:math></disp-formula> with <inline-formula><mml:math id="M74"><mml:mi>ι</mml:mi><mml:mo>=</mml:mo><mml:mspace width="0.2em"/><mml:msqrt><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msqrt></mml:math></inline-formula>, is defined for all <bold>h</bold> = (<italic>h</italic><sub>1</sub>,...,<italic>h<sub>d</sub></italic>) ∈ 𝔾 and <bold>k</bold> = (<italic>k</italic><sub>1</sub>,...,<italic>k<sub>d</sub></italic>) ∈ 𝔾. Here, we followed the convention of population genetics (e.g. [<xref ref-type="bibr" rid="R47">47</xref>, <xref ref-type="bibr" rid="R48">48</xref>, <xref ref-type="bibr" rid="R5">5</xref>]) and defined the Fourier transform in terms of the character <italic>χ</italic><sub><bold>k</bold></sub> (<bold>h</bold>) (instead of its conjugate, given in <xref ref-type="disp-formula" rid="FD41">eq. I.E</xref>, which is more standard in mathematics and engineering). As such, the Fourier transform of <italic>f</italic> gives the characteristic function of <italic>f</italic> when <italic>f</italic> is a probability distribution. For instance, the Fourier transform <inline-formula><mml:math id="M75"><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>m</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:msub><mml:mi>χ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:math></inline-formula> is the characteristic function of the dispersal distribution <italic>m</italic><sub><bold>k</bold></sub>. The original function is recovered by using <disp-formula id="FD40"><label>(I.D)</label><mml:math id="M76"><mml:msub><mml:mi>f</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>ℒ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>ℱ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>D</mml:mi></mml:mfrac><mml:munder><mml:mrow><mml:mi>∑</mml:mi><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:mi>ℱ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>χ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula> where ℒ<sub><bold>k</bold></sub> (ℱ) is the inverse transform of ℱ at <bold>k</bold> ∈ 𝔾, which is defined in terms of the conjugate of <italic>χ</italic><sub><bold>k</bold></sub> (<bold>h</bold>): <disp-formula id="FD41"><label>(I.E)</label><mml:math id="M77"><mml:msub><mml:mover accent="true"><mml:mi>χ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mstyle displaystyle="true"><mml:mo>∏</mml:mo></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>d</mml:mi></mml:munderover><mml:mi>exp</mml:mi><mml:mo>(</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>ι</mml:mi><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>exp</mml:mi><mml:mo>(</mml:mo><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:mi>ι</mml:mi><mml:munderover><mml:mrow><mml:mi>∑</mml:mi><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>d</mml:mi></mml:munderover><mml:mfrac><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>)</mml:mo></mml:math></disp-formula></p><p id="P63">(e.g. [<xref ref-type="bibr" rid="R80">80</xref>]). Another property that we use in our analysis is the orthogonality relation between characters, i.e., the identity <disp-formula id="FD42"><label>(I.F)</label><mml:math id="M78"><mml:munder><mml:mrow><mml:mi>∑</mml:mi><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:msub><mml:mover accent="true"><mml:mi>χ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">i</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>χ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi>∑</mml:mi><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:msub><mml:mover accent="true"><mml:mi>χ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">i</mml:mtext></mml:mstyle><mml:mo>+</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mo>|</mml:mo><mml:mo>𝔾</mml:mo><mml:mo>|</mml:mo><mml:mo>=</mml:mo><mml:mi>D</mml:mi><mml:mspace width="1.5em"/><mml:mtext>if</mml:mtext><mml:mspace width="0.2em"/><mml:mstyle><mml:mtext mathvariant="bold">i</mml:mtext></mml:mstyle><mml:mo>+</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>=</mml:mo><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn><mml:mspace width="4.5em"/><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:math></disp-formula></p><p id="P64">(see [<xref ref-type="bibr" rid="R80">80</xref>], p. 169).</p></boxed-text><boxed-text id="BX2" position="float" orientation="portrait"><label>Box II</label><caption><title>Multi-dimensional environment</title></caption><p>We generalize <italic>s</italic><sub>w</sub>(<italic>z</italic>) and <italic>s</italic><sub>e</sub>(<italic>z</italic>) to the case where there are <italic>n</italic><sub>e</sub> &gt; 1 environmental state variables. We denote by <inline-formula><mml:math id="M79"><mml:mrow><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> the vector of such variables in patch <bold>k</bold>, <italic>t</italic> (where <italic>n</italic><sub><italic>i</italic>,<bold>k</bold>,<italic>t</italic></sub> ∈ ℝ is the value of the <italic>i</italic>th environmental variable). The fitness of the focal individual is now given by <disp-formula id="FD43"><label>(II.A)</label><mml:math id="M80"><mml:mrow><mml:mi>w</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mspace width="2.5em"/><mml:mtext>with</mml:mtext><mml:mspace width="0.2em"/><mml:mi>w</mml:mi><mml:mo>:</mml:mo><mml:mi>ℝ</mml:mi><mml:mo>×</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mi>D</mml:mi></mml:msup><mml:mo>×</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mrow><mml:mi>D</mml:mi><mml:msub><mml:mi>n</mml:mi><mml:mtext>e</mml:mtext></mml:msub></mml:mrow></mml:msup><mml:mo>→</mml:mo><mml:msub><mml:mi>ℝ</mml:mi><mml:mo>+</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:mspace width="0.2em"/></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M81"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> is the value at <italic>t</italic> = 0 of <inline-formula><mml:math id="M82"><mml:mspace width="0.2em"/><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mn mathvariant="bold">1</mml:mn></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">n</mml:mtext></mml:mstyle><mml:mrow><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">D</mml:mtext></mml:mstyle><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:math></inline-formula>, whose elements are solutions of <disp-formula id="FD44"><label>(II.B)</label><mml:math id="M83"><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mspace width="2.5em"/><mml:mtext>for</mml:mtext><mml:mspace width="0.2em"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>..</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mspace width="0.2em"/><mml:mtext>and</mml:mtext><mml:mspace width="0.2em"/><mml:mtext>all</mml:mtext><mml:mspace width="0.2em"/><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo><mml:mo>,</mml:mo><mml:mspace width="0.2em"/></mml:math></disp-formula> where <italic>g</italic><sub><italic>i</italic></sub> is the transition map for environmental variable <italic>i</italic>. We assume that in a monomorphic population <italic>z</italic>, there is a hyperbolically stable fixed point to environmental dynamics, <disp-formula id="FD45"><label>(II.C)</label><mml:math id="M84"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>^</mml:mo></mml:mover></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mspace width="2.5em"/><mml:mtext>for</mml:mtext><mml:mspace width="0.2em"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mtext>e</mml:mtext></mml:msub></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M85"><mml:mrow><mml:mover accent="true"><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>→</mml:mo></mml:mover></mml:mstyle><mml:mo stretchy="true">^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mstyle><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> is a vector of dimension <italic>D</italic> whose entries are all given by <inline-formula><mml:math id="M86"><mml:mrow><mml:mstyle mathvariant="bold" mathsize="normal"><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mstyle><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. With fitness given by <xref ref-type="disp-formula" rid="FD43">eq. (II.A)</xref>, selection on intra-temporal effects <italic>s</italic><sub>w</sub>(<italic>z</italic>) remains unchanged, given by <xref ref-type="disp-formula" rid="FD6">eq. (6a)</xref> with <inline-formula><mml:math id="M87"><mml:mrow><mml:mi>w</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mtext>H</mml:mtext></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> substituted for <italic>w</italic>(<italic>z</italic><sub>•</sub>, <bold>z</bold><sub><bold>0</bold>,0</sub>, <bold>n</bold><sub><bold>0</bold>,0</sub>(<bold>z</bold><sub>H</sub>))). For selection on inter-temporal effects <italic>s</italic><sub>e</sub>(<italic>z</italic>), carrying out <italic>mutadis mutandis</italic> the same calculations as we have for the one-dimensional case, yields <disp-formula id="FD46"><label>(II.D)</label><mml:math id="M88"><mml:msub><mml:mi>s</mml:mi><mml:mi>e</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>z</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munderover><mml:mrow><mml:mi>∑</mml:mi><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>∞</mml:mi></mml:munderover><mml:munderover><mml:mrow><mml:mi>∑</mml:mi><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mi>e</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:munder><mml:mrow><mml:mi>∑</mml:mi><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:mspace width="0.2em"/><mml:munder><mml:mrow><mml:mi>∑</mml:mi><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:mi>w</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mo>•</mml:mo></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">j</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mi>N</mml:mi><mml:msub><mml:mi>R</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:msub></mml:math></disp-formula> where <italic>e</italic><sub><italic>i</italic>,<bold>k</bold>,<italic>t</italic></sub> is the extended phenotypic effect on environmental variable <italic>i</italic> in patch <bold>k</bold>, <italic>t</italic>. This is computed as the inverse transform <disp-formula id="FD47"><label>(II.E)</label><mml:math id="M89"><mml:msub><mml:mi>e</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>D</mml:mi></mml:mfrac><mml:munder><mml:mrow><mml:mi>∑</mml:mi><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:munder><mml:msub><mml:mi>ℰ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>χ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula> where ε<sub><italic>i</italic>,<italic>t</italic></sub> (<bold>h</bold>) is the <italic>i</italic>-th element of the vector <inline-formula><mml:math id="M90"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ℰ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>ℰ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>ℰ</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>ℰ</mml:mi><mml:mrow><mml:msub><mml:mi>n</mml:mi><mml:mtext>e</mml:mtext></mml:msub><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, which is obtained from <disp-formula id="FD48"><label>(II.F)</label><mml:math id="M91"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ℰ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>C</mml:mi><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mover accent="true"><mml:mo>Ψ</mml:mo><mml:mo>→</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Here, the community matrix <bold><italic>C</italic></bold>(<bold>h</bold>) has its <italic>ij</italic>-th element given by <inline-formula><mml:math id="M92"><mml:msub><mml:mo>𝒞</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>∈</mml:mo><mml:mo>𝔾</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>←</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:mrow></mml:msub><mml:msub><mml:mi>χ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:math></inline-formula>, where <disp-formula id="FD49"><label>(II.G)</label><mml:math id="M93"><mml:mrow><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo>←</mml:mo><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula> is the effect of environmental variable <italic>j</italic> in the focal patch on environmental variable <italic>i</italic> in patch <bold>k</bold>, <italic>t</italic>. The vector <inline-formula><mml:math id="M94"><mml:mrow><mml:mover accent="true"><mml:mo>Ψ</mml:mo><mml:mo>→</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:mtext>h</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula> has <italic>i</italic>-th element given by Ψ<sub><italic>i</italic></sub> (<bold>h</bold>), which is the Fourier transform of <disp-formula id="FD50"><label>(II.H)</label><mml:math id="M95"><mml:mrow><mml:msub><mml:mi>ψ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>,</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msubsup><mml:mi>z</mml:mi><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>for</mml:mtext><mml:mspace width="0.2em"/><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>=</mml:mo><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mn>1</mml:mn><mml:mi>N</mml:mi></mml:mfrac><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mstyle><mml:mtext mathvariant="bold">z</mml:mtext></mml:mstyle><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow><mml:mtext>R</mml:mtext></mml:msubsup><mml:mo>,</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>n</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>otherwise</mml:mtext><mml:mo>.</mml:mo><mml:mspace width="0.2em"/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula></p><p>Under the infinite island model of dispersal, where <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> = 0, <italic>e</italic><sub><italic>i</italic>,<bold>k</bold>,<italic>t</italic></sub> = 0, and <italic>c</italic><sub><italic>i</italic>,<bold>0</bold>←<italic>j</italic>,<bold>k</bold></sub> = 0 for all <bold>k</bold> ∈ 𝔾 except <bold>k</bold> = <bold>0</bold>, <xref ref-type="disp-formula" rid="FD46">eq. (II.D)</xref> reduces to <xref ref-type="disp-formula" rid="FD15">eqs. 15</xref>-<xref ref-type="disp-formula" rid="FD16">16</xref> of [<xref ref-type="bibr" rid="R41">41</xref>].</p></boxed-text><boxed-text id="BX3" position="float" orientation="portrait"><label>Box III</label><caption><title>Scaled-relatedness coefficients</title></caption><p>With fitness given by <xref ref-type="disp-formula" rid="FD17">eq. (17)</xref>, we show in <xref ref-type="supplementary-material" rid="SD1">Appendix E</xref> that <disp-formula id="FD51"><label>(III.A)</label><mml:math id="M96"><mml:mrow><mml:msub><mml:mi>κ</mml:mi><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle><mml:mo>,</mml:mo><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>ℒ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>F</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msup><mml:mtext>s</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mtext>f</mml:mtext><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:msup><mml:mtext>f</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mtext>s</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msup><mml:mtext>s</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mtext>f</mml:mtext><mml:mo>+</mml:mo><mml:msup><mml:mtext>f</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mtext>s</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>ℒ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>F</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mtext>s</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msup><mml:mtext>s</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mtext>f</mml:mtext><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:msup><mml:mtext>f</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mtext>s</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>if</mml:mtext><mml:mspace width="0.2em"/><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>ℒ</mml:mi><mml:mstyle><mml:mtext mathvariant="bold">k</mml:mtext></mml:mstyle></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>G</mml:mi><mml:mi>t</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mtext>s</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msup><mml:mtext>s</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mtext>f</mml:mtext><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:msup><mml:mtext>f</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mtext>s</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msup><mml:mtext>s</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mtext>f</mml:mtext><mml:mo>+</mml:mo><mml:msup><mml:mtext>f</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mtext>s</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>ℒ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>F</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mtext>s</mml:mtext><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msup><mml:mtext>s</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mtext>f</mml:mtext><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:msup><mml:mtext>f</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mtext>s</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>D</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mspace width="0.2em"/><mml:mtext>otherwise</mml:mtext><mml:mo>,</mml:mo><mml:mspace width="0.2em"/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mrow></mml:math></disp-formula> where as usual, all functions are evaluated at the resident trait value <italic>z</italic>, and ℒ<sub><bold>k</bold></sub> (<italic>X</italic>) is the inverse Fourier transform of a function <italic>X</italic>(<bold>h</bold>) at <bold>k</bold> ∈ 𝔾 (<xref ref-type="disp-formula" rid="FD40">eq. I.D</xref> of <xref ref-type="boxed-text" rid="BX1">Box I</xref>). The functions <italic>F</italic> and <italic>G</italic><sub><italic>t</italic></sub> are defined as <disp-formula id="FD52"><label>(III.B)</label><mml:math id="M97"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mi>F</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msup><mml:mi>s</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mi>f</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mi>f</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mn>2</mml:mn><mml:mi>s</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>s</mml:mi><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>s</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>G</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msup><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo>′</mml:mo></mml:msup><mml:mi>f</mml:mi><mml:mo>+</mml:mo><mml:msup><mml:mi>f</mml:mi><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:msup><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mi>t</mml:mi></mml:msup></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula></p><p>For fecundity effects under a Wright-Fisher process (s = s<sup>′</sup> = 0), the above reduces to <italic>F</italic>(<bold>h</bold>) = 0 and <italic>G</italic><sub><italic>t</italic></sub> (<bold>h</bold>) = f<sup>′</sup> ℳ (<bold>h</bold>)<sup><italic>t</italic></sup>, which yields <xref ref-type="disp-formula" rid="FD21">eq. (21)</xref> of the main text when f<sup>′</sup> = 1 (i.e. the payoff is directly fecundity). Using <xref ref-type="disp-formula" rid="FD51">eq. (III.A</xref>), we also show in <xref ref-type="supplementary-material" rid="SD1">Appendix F</xref> that the summary statistic <italic>K</italic>, for selection on environmentally mediated social interactions under local interactions (<xref ref-type="disp-formula" rid="FD24">eq. 24</xref>), is given by <disp-formula id="FD53"><label>(III.C)</label><mml:math id="M98"><mml:mrow><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mi>H</mml:mi></mml:mfrac><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>≠</mml:mo><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msup><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo>′</mml:mo></mml:msup><mml:mtext>f</mml:mtext><mml:mo>+</mml:mo><mml:msup><mml:mstyle><mml:mtext mathvariant="bold">f</mml:mtext></mml:mstyle><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mo>𝒞</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mtext>Ψ</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo>𝒞</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo>𝒞</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p>Where <disp-formula id="FD54"><label>(III.D)</label><mml:math id="M99"><mml:mrow><mml:mi>H</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>D</mml:mi><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msup><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo>′</mml:mo></mml:msup><mml:mstyle><mml:mtext mathvariant="bold">f</mml:mtext></mml:mstyle><mml:mo>+</mml:mo><mml:msup><mml:mstyle><mml:mtext mathvariant="bold">f</mml:mtext></mml:mstyle><mml:mo>′</mml:mo></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>≠</mml:mo><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msup><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo>′</mml:mo></mml:msup><mml:mstyle><mml:mtext mathvariant="bold">f</mml:mtext></mml:mstyle><mml:mo>−</mml:mo><mml:mn>2</mml:mn><mml:msup><mml:mtext>f</mml:mtext><mml:mo>′</mml:mo></mml:msup><mml:mi>s</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p><p>For fecundity effects under a Wright-Fisher process (s = s<sup>′</sup> = 0) the summary statistic <italic>K</italic> simplifies to <disp-formula id="FD55"><label>(III.E)</label><mml:math id="M100"><mml:mrow><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mi>D</mml:mi><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>≠</mml:mo><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mtext>Ψ</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo>𝒞</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula> while for survival effects (f<sup>′</sup> = 0), it simplifies to <disp-formula id="FD56"><label>(III.F)</label><mml:math id="M101"><mml:mrow><mml:mi>K</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>D</mml:mi><mml:mi>N</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>≠</mml:mo><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:mfrac><mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:mi>∑</mml:mi></mml:mstyle><mml:mspace width="0.2em"/></mml:mrow><mml:mrow><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo>≠</mml:mo><mml:mstyle><mml:mn mathvariant="bold">0</mml:mn></mml:mstyle></mml:mrow></mml:munder><mml:mfrac><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mo>𝒞</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mtext>Ψ</mml:mtext><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">s</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo>𝒞</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo stretchy="false">[</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo>𝒞</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mi>ℳ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle><mml:mtext mathvariant="bold">h</mml:mtext></mml:mstyle><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mrow></mml:math></disp-formula></p></boxed-text><fig id="F1" position="float"><label>Figure 1</label><caption><title>A model for environmentally mediated social interactions in space and time.</title><p>Schematic description of our model for a one-dimensional lattice habitat (see <xref ref-type="sec" rid="S3">sections 2.1</xref>-<xref ref-type="sec" rid="S4">2.2</xref> for details). Each patch <italic>k</italic> ∈.{…, <italic>D</italic> − 1, 0, 1, …}at time <italic>t</italic> ∈{0, 1, …}in the past is characterized by an environmental state variable <italic>n</italic><sub><italic>k</italic>,<italic>t</italic></sub> (represented here by a cloud, e.g. water level, concentration of a pollutant, density of a resource), and the average trait value <italic>z</italic><sub><italic>k</italic>,<italic>t</italic></sub> expressed by the individuals it carries (e.g. water absorption rate, detoxifying capacity, handling time; individuals represented here as palms). The environmental state <italic>n</italic><sub>0,0</sub> of the focal patch <italic>k</italic> = 0 at time <italic>t</italic> = 0 depends on all environmental states and traits of the previous generation according to the environmental map <italic>g</italic> (blue dashed arrows, <xref ref-type="disp-formula" rid="FD2">eq. 2</xref>). In turn, the fitness of a focal individual with trait <italic>z</italic><sub>•</sub> (in yellow) depends on all environmental states and traits expressed in its own generation according to the fitness function <italic>w</italic> (orange arrows, <xref ref-type="disp-formula" rid="FD1">eq. 1</xref>). The two functions <italic>g</italic> and <italic>w</italic> thus characterise how evolutionary and environmental dynamics interact with one another through dual inheritance of traits and environmental state variables.</p></caption><graphic xlink:href="EMS188460-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>Dispersal distribution, relatedness, and scaled relatedness in a 1D lattice model under short and long-range dispersal.</title><p>Panels <bold>A-B</bold>: Dispersal distribution <italic>m</italic><sub><bold>k</bold></sub> in a lattice-structured population in a one-dimensional habitat (with <italic>D</italic><sub>1</sub> = 51). An offspring leaves its natal patch with probability 1 − <italic>m</italic><sub><bold>0</bold></sub> = <italic>m</italic> = 0.8 and disperses to a patch at a Manhattan distance that follows a truncated binomial distribution (<xref ref-type="supplementary-material" rid="SD1">eq. A-6</xref> in <xref ref-type="supplementary-material" rid="SD1">Appendix B.1</xref>) with mean <inline-formula><mml:math id="M102"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>m</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>1.9</mml:mn></mml:mrow></mml:math></inline-formula> in panel A, leading to short-range dispersal, and <inline-formula><mml:math id="M103"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>m</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>15</mml:mn></mml:mrow></mml:math></inline-formula> in panel B, leading to long-range dispersal. The distance dispersed along each habitat dimension is uniformly distributed across all dimensions and directions (<xref ref-type="supplementary-material" rid="SD1">Appendix B.1</xref> for details). Panels <bold>C-D:</bold> Relatedness <italic>R</italic><sub><bold>k</bold>,<italic>t</italic></sub> for the dispersal distributions shown in panels A and B, respectively (using <xref ref-type="disp-formula" rid="FD8">eq. 8</xref> with patch size <italic>N</italic> = 20 and no adult survival s = 0). Panel C highlights how relatedness decays in time and space, becoming negative away from the focal deme when dispersal is short-range. In contrast, in panel D, where dispersal is long-range, relatedness is negative at intermediate and large distances, thus leading to a multimodal distribution of relatedness values. Panels <bold>E-F:</bold> Scaled relatedness <italic>κ</italic><sub><bold>k</bold>,<italic>t</italic></sub> for the dispersal distributions shown in panels A and B, respectively, under a Wright-Fisher model with fecundity effects (using <xref ref-type="disp-formula" rid="FD21">eq. 21</xref> with patch size <italic>N</italic> = 20). The trend of scaled relatedness is similar as that for relatedness. See Mathematica Notebook for how to generate these figures.</p></caption><graphic xlink:href="EMS188460-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>Dispersal distribution, relatedness, and scaled relatedness in a 2D lattice model under short-range and long-range dispersal.</title><p>Panels <bold>A-B:</bold> Dispersal distribution <italic>m</italic><sub><bold>k</bold></sub> in a two-dimensional habitat (with <italic>D</italic><sub>1</sub> = <italic>D</italic><sub>2</sub> = 13). An offspring leaves its natal patch with probability 1 − <italic>m</italic><sub><bold>0</bold></sub> = <italic>m</italic> = 0.8 and disperses to a patch at a Manhattan distance that follows a truncated binomial distribution with mean <inline-formula><mml:math id="M104"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>m</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>1.5</mml:mn></mml:mrow></mml:math></inline-formula> in panel A, leading to short-range dispersal, and <inline-formula><mml:math id="M105"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>m</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>11</mml:mn></mml:mrow></mml:math></inline-formula> in panel B, leading to long-range dispersal (see <xref ref-type="supplementary-material" rid="SD1">Appendix B.2</xref> for details). Panels <bold>C-D:</bold> Relatedness <italic>R</italic><sub><bold>k</bold>,0</sub> from the dispersal distributions shown in panels A and B, respectively (using <xref ref-type="disp-formula" rid="FD8">eq. 8</xref> with patch size <italic>N</italic> = 20 and no adult survival s = 0). Panels <bold>E-F:</bold> Scaled relatedness, <italic>κ</italic><sub><bold>k</bold>,10</sub> in panel E and <italic>κ</italic><sub><bold>k</bold>,1</sub> in panel F, from the dispersal distributions shown in panels A and B, respectively, for a Wright-Fisher model (using <xref ref-type="disp-formula" rid="FD21">eq. 21</xref> with patch size <italic>N</italic> = 20). See Mathematica Notebook for how to generate these figures.</p></caption><graphic xlink:href="EMS188460-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>Extended phenotypic effects in a 1D lattice model under short-range and long-range movement of the commons.</title><p>Panel <bold>A</bold>: When the commons moves locally, extended phenotypic effects <italic>e</italic><sub><bold>k</bold>,<italic>t</italic></sub> decay in time and space away from the focal deme (from <xref ref-type="disp-formula" rid="FD28">eq. 28</xref> with <italic>D</italic><sub>1</sub> = 31, movement probability <italic>d</italic> = 0.6 and expected movement distance <inline-formula><mml:math id="M106"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>d</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>1.55</mml:mn></mml:mrow></mml:math></inline-formula>, see <xref ref-type="supplementary-material" rid="SD1">Appendix G.5</xref> for details on how movement is modelled; production function <italic>P</italic>(<italic>z</italic>) = <italic>Nz</italic>, i.e. each unit of <italic>z</italic> contribute to one unit of resource; decay rate <italic>ϵ</italic> = 0.2; other parameters: <italic>N</italic> = 20, <italic>m</italic> = 0.3,<inline-formula><mml:math id="M107"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>m</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>1.55</mml:mn></mml:mrow></mml:math></inline-formula>). Panel <bold>B</bold>: In contrast, when the resource moves at greater distances, extended phenotypic effects <italic>e</italic><sub><bold>k</bold>,<italic>t</italic></sub> are greatest further away from the focal deme (from <xref ref-type="disp-formula" rid="FD28">eq. 28</xref> with movement parameters <italic>d</italic> = 0.98 and <inline-formula><mml:math id="M108"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>d</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula> production function <italic>P</italic>(<italic>z</italic>) = <italic>Nz</italic>; decay rate <italic>ϵ</italic> = 0.5; other parameters: same as <xref ref-type="fig" rid="F2">Fig. 2A</xref>). See Mathematica Notebook for how to generate these figures.</p></caption><graphic xlink:href="EMS188460-f004"/></fig><fig id="F5" position="float"><label>Figure 5</label><caption><title>Selection favours altruism or spite depending on dispersal of the evolving species and the commons in a 2D lattice model.</title><p>Panels <bold>A</bold>-<bold>B</bold>: Regions of dispersal parameters leading to the evolution of altruism, Ω &gt; 0 (in white), or of spite, Ω &lt; 0 (in gray) for an example in a 2D lattice model (with <italic>D</italic><sub>1</sub> = <italic>D</italic><sub>2</sub> = 13 and <italic>N</italic> = 50) under a Wright-Fisher life-cycle with fecundity effects (with Ω computed from <xref ref-type="disp-formula" rid="FD34">eq. 34</xref>). Panel <bold>A</bold>: Combination of dispersal probability of the evolving species <italic>m</italic> = 1 − <italic>m</italic><sub><bold>0</bold></sub> (<italic>x</italic>-axis) and of the commons <italic>d</italic> = 1 − <italic>d</italic><sub><bold>0</bold></sub> (<italic>y</italic>-axis) for different levels of environmental decay <italic>ϵ</italic> in different shades of gray (<italic>ϵ</italic> = 0.1, 0.5, 1) with expected dispersal distance fixed (<inline-formula><mml:math id="M109"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>m</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>1.54</mml:mn></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M110"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>d</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula>). This shows that spite is favoured by high levels of dispersal and environmental decay. Panel <bold>B</bold>: Combination of expected dispersal distance of the evolving species <inline-formula><mml:math id="M111"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>m</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> (<italic>x</italic>-axis) and of the commons <inline-formula><mml:math id="M112"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>d</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> (<italic>y</italic>-axis) for different levels of environmental decay <italic>ϵ</italic> in different shades of gray (see panel A for the legend) with dispersal probability fixed (<italic>m</italic> = 0.98 and <italic>d</italic> = 1). This shows that spite is favoured by dispersal asymmetry between the evolving species and the commons. Panels <bold>C</bold>-<bold>D</bold>: Evolution of spite in individual-based simulations under a Wright-Fisher life-cycle with fecundity effects (with <italic>D</italic><sub>1</sub> = <italic>D</italic><sub>2</sub> = 13, <italic>N</italic> = 50, <italic>m</italic> = 0.3, <inline-formula><mml:math id="M113"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>m</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>1.54</mml:mn></mml:mrow></mml:math></inline-formula>, <italic>d</italic> = 1, <inline-formula><mml:math id="M114"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mi>d</mml:mi></mml:msub><mml:mspace width="0.2em"/><mml:mo>=</mml:mo><mml:mspace width="0.2em"/><mml:mn>8</mml:mn></mml:mrow></mml:math></inline-formula>, <italic>B</italic> = 2, <italic>α</italic><sub>B</sub> = 1, <italic>C</italic> = 1, <italic>α</italic><sub>C</sub> = 4, <italic>P</italic>(<italic>z</italic>) = <italic>Nz</italic>; for mutation, the trait mutates during reproduction with probability 10<sup>−4</sup>, in which case a normally distributed deviation with mean 0 and standard deviation 10<sup>−2</sup> is added to the parental trait value). Panel C shows the average trait <italic>z</italic> in the population; panel D shows the average commons level or environmental variable <italic>n</italic> (with simulations in full lines and analytical prediction in dashed lines – from <xref ref-type="disp-formula" rid="FD32">eq. 32</xref> for <italic>z</italic> and 27 for <italic>n</italic>). See Mathematica Notebook for how to generate these figures.</p></caption><graphic xlink:href="EMS188460-f005"/></fig><fig id="F6" position="float"><label>Figure 6</label><caption><title>Isolation-by-distance allows for the evolution of a wider range of social behaviours than the island model under environmental feedback.</title><p>Panel <bold>A</bold>: Singular trait value <italic>z</italic><sup>∗</sup> from <xref ref-type="disp-formula" rid="FD32">eq. 32</xref> for <italic>m</italic> = 0.75 (in black) and <italic>m</italic> = 0.2 (in gray). Other parameters: <italic>D</italic><sub>1</sub> = <italic>D</italic><sub>2</sub> = 13, so that <italic>D</italic> = 169, <italic>N</italic> = 50, <inline-formula><mml:math id="M115"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>m</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:mn>1.54</mml:mn></mml:mrow></mml:math></inline-formula>, <italic>d</italic> = 0.99, <italic>B</italic> = 2, <italic>α</italic><sub>B</sub> = 1, <italic>C</italic> = 1, <italic>α</italic><sub>C</sub> = 4, <italic>P</italic>(<italic>z</italic>) = <italic>Nz</italic>. Dashed lines show the singular trait value with the same parameters but under the island model of dispersal for both the species and the commons (from <xref ref-type="disp-formula" rid="FD32">eq. 32</xref> with Ω given by <xref ref-type="supplementary-material" rid="SD1">eq. (A-125)</xref> derived in <xref ref-type="supplementary-material" rid="SD1">Appendix G.3</xref>). Panel <bold>B</bold>: Observed <italic>vs</italic>. predicted equilibrium trait value in individual-based simulations running for 20 000 generations under different expected dispersal distance of the commons <inline-formula><mml:math id="M116"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>λ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mtext>d</mml:mtext></mml:msub></mml:mrow></mml:math></inline-formula> leading to altruism (<italic>z</italic> &gt; 0) and spite (<italic>z</italic> &lt; 0). Other parameters: same as in <xref ref-type="fig" rid="F5">Fig. 5 C-D</xref>. The prediction is shown as a dashed line (from <xref ref-type="disp-formula" rid="FD32">eq. 32</xref>) with grey region around for twice the standard deviation obtained from the stationary phenotypic distribution (from <xref ref-type="supplementary-material" rid="SD1">eq. A-135</xref>). Observed values of the trait average in the population are shown as black dots for the average from generation 5 000 to 15 000, with error bars for standard deviation over the same 10 000 generations. Simulations were initialised at the predicted convergence stable trait value. See Mathematica Notebook for how to generate these figures.</p></caption><graphic xlink:href="EMS188460-f006"/></fig><fig id="F7" position="float"><label>Figure 7</label><caption><title>Scaled relatedness and selection under survival effects in a 1D lattice model.</title><p>Panels <bold>A-B:</bold> Scaled relatedness <italic>κ</italic><sub><bold>k</bold>,<italic>t</italic></sub> in a 1D lattice model under survival effects (from <xref ref-type="boxed-text" rid="BX3">Box III</xref> with s = 0 in panel A and s = 0.9 in panel B; other parameters: same as in <xref ref-type="fig" rid="F4">Fig. 4A</xref>). These panels show that genetic value decays away from the focal deme especially quickly when baseline survival is high (compare panels A and B). Otherwise, these profiles of scaled relatedness are similar to to those in <xref ref-type="fig" rid="F4">Fig. 4A</xref>, which suggests that selection acts similarly when the trait affects survival or fecundity. Panel <bold>C</bold>: Parameter region where selection favours the evolution of helping (Ω &gt; 0) or harming (Ω &lt; 0) under survival effects with adult survival probability s on the <italic>x</italic>-axis and environmental decay <italic>ϵ</italic> on the <italic>y</italic>-axis (Ω computed from <xref ref-type="disp-formula" rid="FD31">eq. 31</xref> using <xref ref-type="supplementary-material" rid="SD1">eq. A-128</xref>; other parameters: same as in <xref ref-type="fig" rid="F4">Fig. 4B</xref>, i.e. under long-range movement of the commons. See Mathematica Notebook for how to generate these figures.</p></caption><graphic xlink:href="EMS188460-f007"/></fig><table-wrap id="T1" orientation="portrait" position="float"><label>Table 1</label><caption><title>Key general symbols</title></caption><table frame="box" rules="none"><tbody><tr><td valign="top" align="left"><italic>D</italic></td><td valign="top" align="left">number of patches in the population (<xref ref-type="sec" rid="S3">section 2.1</xref>)</td></tr><tr><td valign="top" align="left"><italic>N</italic></td><td valign="top" align="left">number of adult individuals per patch (<xref ref-type="sec" rid="S3">section 2.1</xref>)</td></tr><tr><td valign="top" align="left">𝔾</td><td valign="top" align="left">set of patches in the population (<xref ref-type="sec" rid="S3">section 2.1</xref>)</td></tr><tr><td valign="top" align="left"><italic>z</italic><bold><sub>•</sub></bold></td><td valign="top" align="left">trait value of the focal individual, who lives in patch <bold>0</bold> and time <italic>t</italic> = 0 (<xref ref-type="sec" rid="S4">section 2.2</xref>)</td></tr><tr><td valign="top" align="left"><italic>z</italic><bold><sub>k</sub></bold><sub>,<italic>t</italic></sub></td><td valign="top" align="left">average trait of individuals <italic>other</italic> than the focal in patch <bold>k</bold> at time <italic>t</italic> (<xref ref-type="sec" rid="S4">section 2.2</xref>)</td></tr><tr><td valign="top" align="left"><italic>n</italic><bold><sub>k</sub></bold><sub>,<italic>t</italic></sub></td><td valign="top" align="left">environmental state variable in patch <bold>k</bold> at time <italic>t</italic> (<xref ref-type="sec" rid="S4">section 2.2</xref>)</td></tr><tr><td valign="top" align="left"><italic>g</italic></td><td valign="top" align="left">transition map determining the dynamics of the environmental state variables (<xref ref-type="disp-formula" rid="FD2">eq. 2</xref>)</td></tr><tr><td valign="top" align="left"><italic>w</italic></td><td valign="top" align="left">individual fitness function, i.e. expected number of successful offspring (including the surviving self) produced by an individual over one demographic time step (<xref ref-type="disp-formula" rid="FD1">eq. 1</xref>)</td></tr><tr><td valign="top" align="left"><italic>s</italic>(<italic>z</italic>)</td><td valign="top" align="left">selection gradient (<xref ref-type="sec" rid="S14">section 4</xref>)</td></tr><tr><td valign="top" align="left"><italic>s</italic><sub>w</sub>(<italic>z</italic>)</td><td valign="top" align="left">selection due to intra-temporal effects (<xref ref-type="sec" rid="S14">section 4</xref>)</td></tr><tr><td valign="top" align="left"><italic>s</italic><sub>e</sub>(<italic>z</italic>)</td><td valign="top" align="left">selection due to inter-temporal effects (<xref ref-type="sec" rid="S14">section 4</xref>)</td></tr><tr><td valign="top" align="left"><italic>R</italic><bold><sub>k</sub></bold><sub>,<italic>t</italic></sub></td><td valign="top" align="left">relatedness coefficient between the focal individual and another individual from patch <bold>k</bold>, <italic>t </italic>(<xref ref-type="disp-formula" rid="FD7">eq. 7</xref>)</td></tr><tr><td valign="top" align="left"><italic>m</italic><bold><sub>k</sub></bold></td><td valign="top" align="left">probability that an individual disperses to a patch at distance <bold>k</bold> from its natal patch (<xref ref-type="sec" rid="S3">section 2.1</xref>)</td></tr><tr><td valign="top" align="left">ℳ(<bold>h</bold>)</td><td valign="top" align="left">Fourier transform (<xref ref-type="disp-formula" rid="FD38">eq. I.B</xref> in <xref ref-type="boxed-text" rid="BX1">Box I</xref>) of <italic>m<bold><sub>k</sub></bold></italic></td></tr><tr><td valign="top" align="left"><inline-formula><mml:math id="M117"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>χ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mtext>h</mml:mtext><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></inline-formula></td><td valign="top" align="left">conjugate of character function (<xref ref-type="disp-formula" rid="FD41">eq. I.E</xref> in <xref ref-type="boxed-text" rid="BX1">Box I</xref>)</td></tr><tr><td valign="top" align="left">ℒ<bold><sub>k</sub></bold>(ℱ)</td><td valign="top" align="left">inverse transform of F at <bold>k</bold> (<xref ref-type="disp-formula" rid="FD40">eq. I.D</xref> in <xref ref-type="boxed-text" rid="BX1">Box I</xref>)</td></tr><tr><td valign="top" align="left"><italic>e</italic><bold><sub>k</sub></bold><sub>,<italic>t</italic></sub></td><td valign="top" align="left">extended phenotypic effect of the focal individual on the environmental state variable in patch <bold>k</bold> at time <italic>t</italic> in the future (<xref ref-type="disp-formula" rid="FD10">eqs. 10</xref> and <xref ref-type="disp-formula" rid="FD14">14</xref>)</td></tr><tr><td valign="top" align="left"><italic>ψ</italic><bold><sub>k</sub></bold></td><td valign="top" align="left">focal individual’s effect on the environmental state variable of patch <bold>k</bold> over one generation (<xref ref-type="disp-formula" rid="FD12">eq. 12</xref>)</td></tr><tr><td valign="top" align="left">Ψ(<bold>h</bold>)</td><td valign="top" align="left">Fourier transform (<xref ref-type="disp-formula" rid="FD38">eq. I.B</xref> in <xref ref-type="boxed-text" rid="BX1">Box I</xref>) of <italic>ψ</italic><bold><sub>k</sub></bold></td></tr><tr><td valign="top" align="left"><italic>c</italic><bold><sub>k</sub></bold></td><td valign="top" align="left">effect of the environmental state variable of one patch on the environmental state variable of another patch at distance <bold>k</bold> over one generation (<xref ref-type="disp-formula" rid="FD13">eq. 13</xref>)</td></tr><tr><td valign="top" align="left">C(<bold>h</bold>)</td><td valign="top" align="left">Fourier transform (<xref ref-type="disp-formula" rid="FD38">eq. I.B</xref> in <xref ref-type="boxed-text" rid="BX1">Box I</xref>) of <italic>C</italic><bold>k</bold></td></tr><tr><td valign="top" align="left"><italic>π</italic></td><td valign="top" align="left">individual payoff function (<xref ref-type="sec" rid="S10">section 3.3.1</xref>)</td></tr><tr><td valign="top" align="left"><italic>λ</italic><bold><sub>k</sub></bold></td><td valign="top" align="left">coefficient of fitness interdependence through payoffs (<xref ref-type="disp-formula" rid="FD20">eq. 20</xref>)</td></tr><tr><td valign="top" align="left"><italic>κ</italic><bold><sub>k</sub></bold><sub>,<italic>t</italic></sub></td><td valign="top" align="left">scaled relatedness coefficient between the focal individual and another individual from patch <bold>k</bold>, <italic>t</italic> (<xref ref-type="disp-formula" rid="FD19">eq. 19</xref>)</td></tr><tr><td valign="top" align="left"><italic>p</italic><bold><sub>k</sub></bold><sub>,<italic>t</italic></sub></td><td valign="top" align="left">probability that a gene descending from the focal individual is in patch <bold>k</bold> at <italic>t</italic> &lt; 0 steps in the future (<xref ref-type="disp-formula" rid="FD22">eq. 22</xref>)</td></tr><tr style="background-color:#E5E5E5"><td colspan="2" valign="top" align="center"><bold>Key symbols from example <xref ref-type="sec" rid="S13">section 3.4</xref></bold></td></tr><tr><td valign="top" align="left"><italic>B</italic>, <italic>α</italic><italic><sub>B</sub></italic></td><td valign="top" align="left">parameters tuning the effects of the environmental variable on the payoff of the focal individual (<xref ref-type="disp-formula" rid="FD25">eq. 25</xref>)</td></tr><tr><td valign="top" align="left"><italic>C</italic>, <italic>α</italic><italic><sub>C</sub></italic></td><td valign="top" align="left">parameters tuning the effects of the trait <italic>z</italic><sub>•</sub> of the focal individual on the payoff of the focal individual (<xref ref-type="disp-formula" rid="FD25">eq. 25</xref>)</td></tr><tr><td valign="top" align="left"><italic>P</italic></td><td valign="top" align="left">commons production function (<xref ref-type="disp-formula" rid="FD26">eq. 26</xref>)</td></tr><tr><td valign="top" align="left"><italic>ϵ</italic></td><td valign="top" align="left">commons decay rate (<xref ref-type="disp-formula" rid="FD26">eq. 26</xref>)</td></tr><tr><td valign="top" align="left"><italic>d</italic><bold><sub>k</sub></bold></td><td valign="top" align="left">probability that a unit of commons moves to a patch at a distance <bold>k</bold> from its source patch (<xref ref-type="disp-formula" rid="FD26">eq. 26</xref>)</td></tr><tr><td valign="top" align="left">𝒟(<bold>h</bold>)</td><td valign="top" align="left">Fourier transform (<xref ref-type="disp-formula" rid="FD38">eq. I.B</xref> in <xref ref-type="boxed-text" rid="BX1">Box I</xref>) of <italic>d</italic><bold><italic>k</italic></bold></td></tr><tr><td valign="top" align="left"><italic>q</italic><bold><sub>k</sub></bold><sub>,<italic>t</italic></sub></td><td valign="top" align="left">probability that a non-decaying unit of the commons modified in the focal patch is located in patch <bold>k</bold> <italic>t</italic> generations in the future (<xref ref-type="disp-formula" rid="FD29">eq. 29</xref>)</td></tr><tr><td valign="top" align="left">Ω</td><td valign="top" align="left">expected genetic value in units of payoffs of all the individuals in the future that are affected by a unit of the commons in the focal patch (<xref ref-type="disp-formula" rid="FD31">eq. 31</xref>)</td></tr></tbody></table></table-wrap></floats-group></article>