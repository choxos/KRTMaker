<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="epub">2692-8205</issn></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS190447</article-id><article-id pub-id-type="doi">10.1101/2023.10.27.564407</article-id><article-id pub-id-type="archive">PPR750485</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">2</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>Increasing spectral DCM flexibility and speed by leveraging Julia’s ModelingToolkit and automated differentiation</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Hofmann</surname><given-names>David</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Chesebro</surname><given-names>Anthony G.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Rackauckas</surname><given-names>Chris</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Mujica-Parodi</surname><given-names>Lilianne R.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref><xref ref-type="aff" rid="A5">5</xref></contrib><contrib contrib-type="author"><name><surname>Friston</surname><given-names>Karl J.</given-names></name><xref ref-type="aff" rid="A6">6</xref></contrib><contrib contrib-type="author"><name><surname>Edelman</surname><given-names>Alan</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Strey</surname><given-names>Helmut H.</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib></contrib-group><aff id="A1"><label>1</label>Laufer Center for Physical and Quantitative Biology, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/01q1z8k08</institution-id><institution>State University of New York</institution></institution-wrap> at <city>Stony Brook</city>, <state>NY</state><country country="US">USA</country></aff><aff id="A2"><label>2</label>Computer Science and Artificial Intelligence Lab, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/042nb2s44</institution-id><institution>Massachusetts Institute of Technology</institution></institution-wrap>, <city>MA</city><country country="US">USA</country></aff><aff id="A3"><label>3</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/032q5ym94</institution-id><institution>Athinoula A. Martinos Center for Biomedical Imaging</institution></institution-wrap>, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/002pd6e78</institution-id><institution>Massachusetts General Hospital</institution></institution-wrap> and Harvard Medical School, <state>MA</state><country country="US">USA</country></aff><aff id="A4"><label>4</label>Department of Biomedical Engineering, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/01q1z8k08</institution-id><institution>State University of New York</institution></institution-wrap> at <city>Stony Brook</city>, <state>NY</state></aff><aff id="A5"><label>5</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/01arysc35</institution-id><institution>Santa Fe Institute</institution></institution-wrap>, <city>NM</city><country country="US">USA</country></aff><aff id="A6"><label>6</label><institution-wrap><institution-id institution-id-type="ror">https://ror.org/02704qw51</institution-id><institution>Wellcome Trust Centre for Neuroimaging</institution></institution-wrap>, <institution-wrap><institution-id institution-id-type="ror">https://ror.org/02jx3x895</institution-id><institution>University College London</institution></institution-wrap>, <city>London</city><country country="GB">UK</country></aff><author-notes><corresp id="CR1">
<label>*</label>Correspondence: <email>helmut.strey@stonybrook.edu</email></corresp></author-notes><pub-date pub-type="nihms-submitted"><day>02</day><month>11</month><year>2023</year></pub-date><pub-date pub-type="preprint"><day>01</day><month>11</month><year>2023</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Using neuroimaging and electrophysiological data to infer neural parameter estimations from theoretical circuits requires solving the inverse problem. Here, we provide a new Julia language package designed to i) compose complex dynamical models in a simple and modular way with ModelingToolkit.jl, ii) implement parameter fitting based on spectral dynamic causal modeling (sDCM) using the Laplace approximation, analogous to MATLAB implementation in SPM12, and iii) leverage Julia’s unique strengths to increase accuracy and speed by employing Automatic Differentiation during the fitting procedure. To illustrate the utility of our flexible modular approach, we provide a method to improve correction for fMRI scanner field strengths (1.5T, 3T, 7T) when fitting models to real data.</p></abstract><kwd-group><kwd>neural</kwd><kwd>circuit</kwd><kwd>causal</kwd><kwd>model</kwd><kwd>DCM</kwd><kwd>SPM</kwd><kwd>neuroimaging</kwd><kwd>LFP</kwd><kwd>fMRI</kwd><kwd>Julia</kwd><kwd>Neuroblox</kwd></kwd-group></article-meta></front><body><p id="P2">Answering fundamental questions in neuroscience usually requires abstracting from neuronal populations to circuits (<xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>; <xref ref-type="bibr" rid="R22">Hahn et al., 2020</xref>; <xref ref-type="bibr" rid="R28">Lee et al., 2022</xref>; <xref ref-type="bibr" rid="R50">Stephan et al., 2008</xref>). Neuronal circuits form causal models of interactions between different regions of the brain. Estimating model parameters, such as effective connectivity between brain regions, further requires data fitting (<xref ref-type="bibr" rid="R16">K. J. Friston, 2011</xref>; <xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>; <xref ref-type="bibr" rid="R50">Stephan et al., 2008</xref>). One powerful approach is Dynamic Causal Modeling (DCM), introduced as part of the Statistical Parametric Mapping (SPM) toolbox (<xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>; <xref ref-type="bibr" rid="R50">Stephan et al., 2008</xref>). DCM provides methods and an associated pipeline for modeling interactions between neuronal populations at the cortical level, fitting models from local field potential (LFP) recordings (<xref ref-type="bibr" rid="R17">K. J. Friston et al., 2015</xref>; <xref ref-type="bibr" rid="R34">R. J. Moran, Jung, et al., 2011</xref>; <xref ref-type="bibr" rid="R35">R. J. Moran, Mallet, et al., 2011</xref>), electroencephalography (EEG) data (<xref ref-type="bibr" rid="R12">David et al., 2006</xref>), and functional MRI (fMRI) sequences (<xref ref-type="bibr" rid="R3">Bernal-Casas et al., 2017</xref>; <xref ref-type="bibr" rid="R9">Cha et al., 2016</xref>; <xref ref-type="bibr" rid="R45">Rupprechter et al., 2020</xref>; <xref ref-type="bibr" rid="R46">Seghier &amp; Friston, 2013</xref>; <xref ref-type="bibr" rid="R49">Sladky et al., 2015</xref>; <xref ref-type="bibr" rid="R53">Tik et al., 2018</xref>). Neuroscience applications of DCM have provided insights into both healthy (<xref ref-type="bibr" rid="R5">Bukhari et al., 2022</xref>; <xref ref-type="bibr" rid="R22">Hahn et al., 2020</xref>; <xref ref-type="bibr" rid="R28">Lee et al., 2022</xref>; <xref ref-type="bibr" rid="R48">Sladky et al., 2022</xref>) and impaired (<xref ref-type="bibr" rid="R55">Zarghami et al., 2023</xref>) neuronal functioning, in response to task-based (<xref ref-type="bibr" rid="R22">Hahn et al., 2020</xref>; <xref ref-type="bibr" rid="R28">Lee et al., 2022</xref>; <xref ref-type="bibr" rid="R48">Sladky et al., 2022</xref>) and resting-state (<xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>; <xref ref-type="bibr" rid="R55">Zarghami et al., 2023</xref>) stimuli. Furthermore, the underlying mathematical approach of DCM has been extended to applications outside of neuroscience that benefit from causal inference (<xref ref-type="bibr" rid="R39">Parr et al., 2021</xref>).</p><p id="P3">Broadly speaking, DCM is a procedure used to infer model parameters from data and perform model comparison and selection (<xref ref-type="bibr" rid="R37">Novelli et al., 2024</xref>; <xref ref-type="bibr" rid="R41">Penny et al., 2004</xref>; <xref ref-type="bibr" rid="R51">Stephan et al., 2007</xref>; <xref ref-type="bibr" rid="R56">Zeidman et al., 2022</xref>). Models are defined that should describe the underlying neuronal dynamics, typically at the mesoor macro-scale, as well as the measurement process (BOLD, EEG, LFP). A variational Bayes approach is used to estimate the posterior distribution of the parameters by optimizing the evidence lower bound (<xref ref-type="bibr" rid="R34">R. J. Moran, Jung, et al., 2011</xref>; <xref ref-type="bibr" rid="R37">Novelli et al., 2024</xref>; <xref ref-type="bibr" rid="R56">Zeidman et al., 2022</xref>). Finally, the evidence lower bound or negative free energy is used for model comparison (<xref ref-type="bibr" rid="R15">K. Friston et al., 2007</xref>; <xref ref-type="bibr" rid="R43">Razi et al., 2017</xref>). By changing the prior distribution, a user can include and exclude parameters, such as connection weights between regions. Additionally, through model comparison, the user can judge which regions are most likely connected and whether they are excitatory or inhibitory. Over time, this approach has evolved and become more powerful, including the adoption of a computationally more efficient DCM algorithm in the spectral domain (<xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>). Signals, assumed to be stationary, are transformed to the spectral domain by the computation of cross-spectral densities (CSD). This computation is performed by fitting an autoregressive (AR) model to the time series (in SPM12 the AR model is of fixed order 8). From the parameters of the AR model one can analytically calculate the CSD. In our package the fitting of the AR model is performed by standard maximum likelihood. Note that the standard procedure in SPM12 is a Bayesian fit defined in <italic>spm_mar.m.</italic></p><p id="P4">The most current implementation of DCM, as part of the Statistical Parametric Mapping toolbox (SPM12; available at fil.ion.ucl.ac.uk/spm/software/spm12/), has been widely and successfully applied to a variety of data modalities, cognitive functions, and disease processes (<xref ref-type="bibr" rid="R22">Hahn et al., 2020</xref>; <xref ref-type="bibr" rid="R28">Lee et al., 2022</xref>; <xref ref-type="bibr" rid="R48">Sladky et al., 2022</xref>; <xref ref-type="bibr" rid="R55">Zarghami et al., 2023</xref>). Here, we build on this achievement to extend its capabilities in two ways. First, one of the practical roadblocks to the wide adoption of multi-scale computational neuroscience has been limitations due to computation speed. DCM’s implementation in MATLAB introduces inherent computational barriers that become increasingly problematic as datasets scale to meet current reproducibility standards (<xref ref-type="bibr" rid="R32">Marek et al., 2022</xref>). For this reason, we chose to code our package in Julia, as part of the Neuroblox computational neuroscience platform (neuroblox.org), as Julia is a high-performance computing language that is known to show orders of magnitude speed improvements in ODE systems compared to both MATLAB and Python (<xref ref-type="bibr" rid="R42">Rackauckas, 2023</xref>). Second, we wanted to incorporate additional flexibility into the pipeline in terms of easy access to choices for neural mass models, model assembly, transfer functions within and between scales and modalities, as well as parameter fitting procedures.</p><p id="P5">In this work, we provide a new implementation of spectral DCM in the Julia programming language (julialang.org), building on the ModelingToolkit package (<xref ref-type="bibr" rid="R31">Ma, Gowda, et al., 2021</xref>). We demonstrate that this implementation can offer results identical to the original SPM12 implementation at a fraction of the computation speed in an open-source language. Additionally, we construct this implementation to allow for great user flexibility in model selection and specification, opening the door to new modeling techniques not achieved in prior implementations.</p><sec id="S1"><title>Spectral Dynamic Causal Modeling</title><p id="P6">The distinctive feature of spectral DCM as compared to other forms of DCM is that it models the cross-spectral density of a signal. This implies the assumption of stationarity of the covariance matrix of the signals during measurement <xref ref-type="bibr" rid="R37">Novelli et al., 2024</xref>. The usual continuous-time state-space formulation with a measurement function is assumed <disp-formula id="FD1"><label>(1)</label><mml:math id="M1"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mover accent="true"><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>˙</mml:mo></mml:mover><mml:mo>→</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>f</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mi>f</mml:mi></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>g</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>g</mml:mi></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula></p><p id="P7">For <xref ref-type="disp-formula" rid="FD1">Eqns. 1</xref>, <inline-formula><mml:math id="M2"><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>→</mml:mo></mml:mover></mml:math></inline-formula> denotes the measurement of the (hidden) dynamics <inline-formula><mml:math id="M3"><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover></mml:math></inline-formula>, which could, for example, be the neuronal dynamics and hemodynamic response. <inline-formula><mml:math id="M4"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M5"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> denote intrinsic or endogenous noise and measurement noise, respectively. In spectral DCM these are assumed to follow a power law distribution in frequency space. In fMRI measurements, the states <italic>x</italic> comprise not just the neuronal dynamics <inline-formula><mml:math id="M6"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>n</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> but also the hemodynamic response to the neuronal activity <inline-formula><mml:math id="M7"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>h</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. A further assumption made by spectral DCM is linearity of the hidden neuronal dynamics <inline-formula><mml:math id="M8"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>n</mml:mi></mml:msub><mml:mo>;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>n</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>n</mml:mi></mml:msub><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>. The dynamics for the hemodynamic response <inline-formula><mml:math id="M9"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>h</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>h</mml:mi></mml:msub><mml:mo>;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>h</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> are modeled by the balloon model, and the measured signal is the blood oxygen level depletion (BOLD) denoted by <inline-formula><mml:math id="M10"><mml:mrow><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>h</mml:mi></mml:msub><mml:mo>;</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>g</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>. Both models are detailed in (<xref ref-type="bibr" rid="R51">Stephan et al., 2007</xref>), which is based on (<xref ref-type="bibr" rid="R8">Buxton et al., 2004</xref>). Here, we describe the model used in the code in more detail. The balloon model describes the dynamics of blood vessels in response to the neuronal signals. The cerebral blood flow <italic>u</italic>(<italic>t</italic>) is driven by the neuronal activity <italic>x<sub>n</sub></italic> (for the sake of notational simplicity we omit an index that denotes a specific region of the multidimensional vector <inline-formula><mml:math id="M11"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> describing the neuronal activity of all regions. In what follows all dynamic variables relate to a single region.) through the induction of a vasodilatory signal <italic>s</italic>(<italic>t</italic>) governed by the following dynamics: <disp-formula id="FD2"><label>(2)</label><mml:math id="M12"><mml:mrow><mml:mover accent="true"><mml:mi>s</mml:mi><mml:mo>˙</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msub><mml:mi>x</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mi>κ</mml:mi><mml:mi>s</mml:mi><mml:mo>−</mml:mo><mml:mtext>γ</mml:mtext><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>u</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula> <disp-formula id="FD3"><label>(3)</label><mml:math id="M13"><mml:mrow><mml:mover accent="true"><mml:mi>u</mml:mi><mml:mo>˙</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:math></disp-formula></p><p id="P8">Moreover, the change in volume <italic>v</italic>(<italic>t</italic>) due to the blood flow as well as the related changes of the blood oxygenation level <italic>q</italic>(<italic>t</italic>) are given, according to (<xref ref-type="bibr" rid="R8">Buxton et al., 2004</xref>), by <disp-formula id="FD4"><label>(4)</label><mml:math id="M14"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mi>τ</mml:mi><mml:mover accent="true"><mml:mi>υ</mml:mi><mml:mo>˙</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>u</mml:mi><mml:mo>−</mml:mo><mml:msup><mml:mi>υ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>α</mml:mi></mml:mrow></mml:msup></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>τ</mml:mi><mml:mover accent="true"><mml:mi>q</mml:mi><mml:mo>˙</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mi>u</mml:mi><mml:mi>E</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>u</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>/</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>−</mml:mo><mml:msup><mml:mi>υ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi>α</mml:mi></mml:mrow></mml:msup><mml:mi>q</mml:mi><mml:mo>/</mml:mo><mml:mi>υ</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> with <italic>E</italic>(<italic>u</italic>, <italic>E</italic><sub>0</sub>) = 1−(1−<italic>E</italic><sub>0</sub>)<sup>1/<italic>u</italic></sup> as a reasonable approximation across a wide range of conditions (<xref ref-type="bibr" rid="R7">Buxton &amp; Frank, 1997</xref>; <xref ref-type="bibr" rid="R51">Stephan et al., 2007</xref>). Finally, based on blood oxygenation <italic>q</italic>(<italic>t</italic>) and blood volume <italic>v</italic>(<italic>t</italic>) we compute the BOLD signal according to the following equation <disp-formula id="FD5"><label>(5)</label><mml:math id="M15"><mml:mrow><mml:mi>λ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>q</mml:mi><mml:mo>,</mml:mo><mml:mi>υ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>q</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mfrac><mml:mi>q</mml:mi><mml:mi>υ</mml:mi></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>υ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>]</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula> with the following parameter definitions <disp-formula id="FD6"><mml:math id="M16"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msub><mml:mi>k</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>4.3</mml:mn><mml:msub><mml:mi>θ</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:msub><mml:mi>E</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:msub><mml:mi>T</mml:mi><mml:mi>E</mml:mi></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mi>ϵ</mml:mi><mml:msub><mml:mi>r</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:msub><mml:mi>E</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:msub><mml:mi>T</mml:mi><mml:mi>E</mml:mi></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>k</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>ϵ</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> where <italic>ϵ</italic> is ratio of intra- and extravascular BOLD signal at rest, <italic>E</italic><sub>0</sub> is the resting oxygen extraction fraction, and <italic>r</italic><sub>0</sub> is the slope of the relation between the intravascular relaxation rate <inline-formula><mml:math id="M17"><mml:mrow><mml:msubsup><mml:mi>R</mml:mi><mml:mrow><mml:mn>2</mml:mn><mml:mi>I</mml:mi></mml:mrow><mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:math></inline-formula> and oxygen saturation. The solution to the differential equations <xref ref-type="disp-formula" rid="FD1">Eqns. 1</xref> can be approximated by the first order of a Taylor expansion as <disp-formula id="FD7"><label>(6)</label><mml:math id="M18"><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi>κ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>∗</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>f</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mi>g</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>t</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mtext>with</mml:mtext></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mi>κ</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>τ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable><mml:mo>=</mml:mo><mml:mo>∇</mml:mo><mml:mi>g</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mi>exp</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi mathvariant="script">J</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub><mml:mi>τ</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M19"><mml:mrow><mml:msub><mml:mi mathvariant="script">J</mml:mi><mml:mrow><mml:mi>f</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the Jacobian of <italic>f</italic> w.r.t. <inline-formula><mml:math id="M20"><mml:mover accent="true"><mml:mi>x</mml:mi><mml:mo>→</mml:mo></mml:mover></mml:math></inline-formula> in <xref ref-type="disp-formula" rid="FD1">Eqn. 1</xref>. To find an expression for the cross-spectral density we Fourier transform <xref ref-type="disp-formula" rid="FD7">Eqn. 6</xref> <disp-formula id="FD8"><label>(7)</label><mml:math id="M21"><mml:mrow><mml:mover accent="true"><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>ω</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mi>κ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>ω</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mover accent="true"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>˜</mml:mo></mml:mover><mml:mi>f</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>ω</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mover accent="true"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>˜</mml:mo></mml:mover><mml:mi>g</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mi>ω</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula> where <inline-formula><mml:math id="M22"><mml:mover accent="true"><mml:mi>κ</mml:mi><mml:mo>˜</mml:mo></mml:mover></mml:math></inline-formula>, <inline-formula><mml:math id="M23"><mml:msub><mml:mover accent="true"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>˜</mml:mo></mml:mover><mml:mi>f</mml:mi></mml:msub></mml:math></inline-formula>, and <inline-formula><mml:math id="M24"><mml:msub><mml:mover accent="true"><mml:mover accent="true"><mml:mi>ϵ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>˜</mml:mo></mml:mover><mml:mi>g</mml:mi></mml:msub></mml:math></inline-formula> denote the Fourier transforms of the convolution kernel and noises respectively. The cross-spectral density is then <disp-formula id="FD9"><label>(8)</label><mml:math id="M25"><mml:mtable columnalign="left"><mml:mtr><mml:mtd/></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>S</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>〈</mml:mo><mml:mrow><mml:mover accent="true"><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>ω</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>⋅</mml:mo><mml:mover accent="true"><mml:mover accent="true"><mml:mi>y</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>ω</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo></mml:mrow><mml:mo>〉</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mi>κ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>ω</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:mi>ϵ</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:msub><mml:mover accent="true"><mml:mi>κ</mml:mi><mml:mo>˜</mml:mo></mml:mover><mml:mrow><mml:mo>(</mml:mo><mml:mi>ω</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>*</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> where ∗ denotes the complex conjugate and <inline-formula><mml:math id="M26"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>f</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="M27"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mrow><mml:msub><mml:mi>ϵ</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> are the cross-spectral densities of the state noise and measurement noise, respectively. Note that, due to our assumption of uncorrelated noise, these are diagonal matrices. While the cross-spectrum of the measurement noise will have identical values on the diagonal, the state noise is composed of a global and a region-specific component, and thus diagonal elements can vary. This deviates from the presentation in (<xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>) but is consistent with the implementation in SPM12. Note further that this derivation of the CSD implies that the underlying model is expanded at a fixed point solution in <xref ref-type="disp-formula" rid="FD7">Eqn. 6</xref>, i.e. the model cannot be in a limit cycle or another dynamical state <xref ref-type="bibr" rid="R1">Bastos et al., 2015</xref>; <xref ref-type="bibr" rid="R33">R. Moran et al., 2008</xref></p><p id="P9">We thus derived a linear approximation of the cross-spectral density <inline-formula><mml:math id="M28"><mml:mrow><mml:msub><mml:mi>S</mml:mi><mml:mi>y</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mover accent="true"><mml:mi>θ</mml:mi><mml:mo>→</mml:mo></mml:mover><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> that is based on the details of the time-continuous state space model given in <xref ref-type="disp-formula" rid="FD1">Eqns. 1</xref>. Next we would like to estimate the parameters of the model as well as the noise parameters and therefor need to define an optimization procedure. We follow the approach pursued by DCM, that is a Variational Bayes approach with Laplace approximation, termed Variational Laplace for brevity (<xref ref-type="bibr" rid="R56">Zeidman et al., 2022</xref>).</p></sec><sec id="S2"><title>Variational Laplace</title><p id="P10">An inverse problem consists of estimating parameters from data. In a Bayesian setting this implies computing the posterior distribution <disp-formula id="FD10"><label>(9)</label><mml:math id="M29"><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi><mml:mrow><mml:mo>|</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mrow><mml:mo>|</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi>Z</mml:mi></mml:mfrac></mml:mrow></mml:math></disp-formula></p><p id="P11">In the ideal setting, the true posterior distribution can analytically be computed from the likelihood <italic>p</italic>(<italic>y</italic>|<italic>θ</italic>), the prior distribution <italic>p</italic>(<italic>θ</italic>) and the normalization <italic>Z</italic>, also called the model evidence or marginalized likelihood <inline-formula><mml:math id="M30"><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>Z</mml:mi><mml:mo>=</mml:mo><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>y</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mstyle displaystyle="true"><mml:mrow><mml:mo>∫</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>y</mml:mi><mml:mrow><mml:mo>|</mml:mo><mml:mi>θ</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mtext>d</mml:mtext><mml:mi>θ</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> from the Bayes formula (<xref ref-type="disp-formula" rid="FD10">Eqn. 9</xref>). However, typically, there is no such closed-form solution, and instead, we have to resort to sampling techniques (e.g., Markov Chain Monte Carlo), which are unbiased estimators, or we compute an approximation to the posterior. Variational Bayes is such an approximation approach that borrows from variational calculus by introducing a parameterized function <italic>q</italic>(<italic>θ</italic>) that will be shaped, through an optimization procedure, to approximate the true posterior <italic>q</italic>(<italic>θ</italic>) ≈ <italic>p</italic>(<italic>θ</italic>|<italic>y</italic>). This optimization procedure requires the definition of an objective function which is typically the evidence lower bound (ELBO), sometimes also called the variational lower bound or free energy (particularly in the context of DCM) due to its resemblance of the functional form of the free energy in physics (<xref ref-type="bibr" rid="R56">Zeidman et al., 2022</xref>).</p><p id="P12">There are different ways to derive the ELBO; one approach is to start from the Kullback-Leibler (KL) divergence between the variational distribution and the posterior <inline-formula><mml:math id="M31"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>K</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi><mml:mrow><mml:mo>|</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula> (<xref ref-type="bibr" rid="R10">Cover &amp; Thomas, 2006</xref>). Minimizing <italic>D<sub>KL</sub></italic> is equivalent to maximizing the ELBO: <disp-formula id="FD11"><label>(10)</label><mml:math id="M32"><mml:mrow><mml:mi>E</mml:mi><mml:mi>L</mml:mi><mml:mi>B</mml:mi><mml:mi>O</mml:mi><mml:mo>=</mml:mo><mml:mi>log</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>y</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mrow><mml:mi>K</mml:mi><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:mi>p</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>θ</mml:mi><mml:mrow><mml:mo>|</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></disp-formula></p><p id="P13">Note that the KL divergence is only well defined if <italic>q</italic> has probability 0 at the same intervals as <italic>p</italic>; in other words, the support of the two distributions must be the same.</p><p id="P14">Applying the Laplace approximation to simplify this problem means assuming a Gaussian variational posterior <inline-formula><mml:math id="M33"><mml:mrow><mml:mi>q</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>θ</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mi mathvariant="script">N</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>μ</mml:mi><mml:mi>θ</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mo>Σ</mml:mo><mml:mi>θ</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>, hence the term variational Laplace. This is the approach taken by DCM (<xref ref-type="bibr" rid="R37">Novelli et al., 2024</xref>).</p><p id="P15">Here, we present several advances that expand the capabilities of spectral DCM as implemented in SPM12. We provide a toolbox with a user-friendly interface for adding new models and linking them in arbitrarily complex circuits. The toolbox also includes built-in corrections for different acquisition field strengths not previously considered in DCM analyses. This software leverages ModelingToolkit.jl, a symbolic computation framework written in the programming language Julia, to achieve a high degree of modularity and thereby easy model composability (<xref ref-type="fig" rid="F1">Fig. 1</xref>). While the implementation of DCM in Julia already provides a speed increase over the traditional MATLAB version, we also employ automatic differentiation to further improve computation speed.</p></sec><sec id="S3"><title>Modular design for user-friendly circuit model assembly and data fitting</title><p id="P16">Defining a model should be as simple as writing down its equations. For this purpose our toolbox design leverages ModelingToolkit.jl (<xref ref-type="bibr" rid="R31">Ma, Gowda, et al., 2021</xref>) and Symbolics.jl (<xref ref-type="bibr" rid="R20">Gowda et al., 2022</xref>) for symbolic computation which provide a simple and intuitive way to define a model that consists of differential equations (see <xref ref-type="fig" rid="F1">Fig. 1A</xref>).</p><p id="P17">For instance, the user can define arbitrary models describing the dynamics of a particular brain region and assemble them into an overall model through an adjacency matrix (see <xref ref-type="fig" rid="F1">Fig. 1B</xref>). In this paper we studied two different systems for the neuronal dynamics: a simple linear ODE system as is typically used in SPM12 for the spectral DCM analysis of fMRI signals (<xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>), and a more complex canonical micro-circuit model which is used to model LFP signals (<xref ref-type="bibr" rid="R2">Bastos et al., 2012</xref>; <xref ref-type="bibr" rid="R34">R. J. Moran, Jung, et al., 2011</xref>; <xref ref-type="bibr" rid="R36">R. J. Moran et al., 2013</xref>) (see <xref ref-type="fig" rid="F2">Fig. 2</xref>). Definition of an observation model that relates the (hidden) neuronal activity to the actual neurophysiological measurement completes the model assembly (see <xref ref-type="fig" rid="F1">Fig. 1C</xref>). By providing measurements corresponding to the observation modality (<xref ref-type="fig" rid="F1">Fig. 1D</xref>) the user can then pick a variational inference algorithm, besides Variational Laplace that is employed by SPM12 and studied in this manuscript, we also provide Automatic Differentiation Variational Inference (ADVI) as implemented in the library Turing.jl (see <xref ref-type="bibr" rid="R19">Ge et al., 2018</xref>; <xref ref-type="bibr" rid="R27">Kucukelbir et al., 2016</xref>) (<xref ref-type="fig" rid="F1">Fig. 1E</xref>) to estimate the posterior probability of the model parameters, for instance the effective connectivity between regions (<xref ref-type="fig" rid="F1">Fig. 1F</xref>).</p><p id="P18">The toolbox provides a Variational Laplace inference algorithm analogous to the SPM12 implementation, as well as a Variational Laplace implementation that leverages automatic differentiation for the computation of the model Jacobian, both with and without symbolic computation. The inference is performed on the cross-spectral densities of the measured time series. The initial conditions of the states need to be selected so as to be in a steady state solution.</p></sec><sec id="S4"><title>Symbolic Computation</title><p id="P19">Using symbolic computation provides two important advantages. First, it facilitates modular definitions of models, which makes them easily extendable, alterable, and composable. Second, it provides a means of automatic analytical computation of gradients and Jacobians, which avoids the potentially imprecise numerical computation of derivatives or the effort of hard-coding the analytical derivatives for each new model. In spectral DCM, three multidimensional derivatives need to be computed. The gradient of the measurement function <italic>g</italic> and the Jacobian of <italic>f</italic> need to be calculated for the computation of the cross-spectral densities, both with respect to the system states (see <xref ref-type="disp-formula" rid="FD7">Eqn. 6</xref>). Then, the Jacobian needs to be calculated with respect to the parameters for we wish to optimize, to compute the optimization update steps (<xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>; <xref ref-type="bibr" rid="R37">Novelli et al., 2024</xref>; <xref ref-type="bibr" rid="R56">Zeidman et al., 2022</xref>). Symbolic computation is based on the packages ModlingToolkit.jl and Symbolics.jl (<xref ref-type="bibr" rid="R20">Gowda et al., 2022</xref>; <xref ref-type="bibr" rid="R31">Ma, Gowda, et al., 2021</xref>)</p></sec><sec id="S5"><title>Automatic Differentiation</title><p id="P20">Julia provides different libraries for performing automatic differentiation. We chose ForwardDiff.jl because of its robustness and good performance for systems with up to 100 dimensions (<xref ref-type="bibr" rid="R30">Ma, Dixit, et al., 2021</xref>; <xref ref-type="bibr" rid="R44">Revels et al., 2016</xref>).</p><p id="P21">The SPM12 implementation of the matrix-exponential of the kernel <italic>κ</italic>(<italic>τ</italic>) given in <xref ref-type="disp-formula" rid="FD7">Eqn. 6</xref> requires an eigenvalue decomposition. This poses a particular challenge since the eigenvalue decomposition in the standard library LinearAlgebra.jl is not a native Julia implementation but based on the external, compiled BLAS library and thereby is not amenable to automatic differentiation. The package GeneralizedLinear-Algebra.jl provides linear algebra operations that are fully implemented in Julia; however, its eigenvalue decomposition only provides eigenvalues but not the corresponding eigenvectors at the point of writing this manuscript.</p><p id="P22">Thus, we created a dispatch of the eigenvalue decomposition performed by the function <italic>eigen</italic> defined in LinearAlgebra.jl. Dynamic dispatch is the process of selecting which implementation of a polymorphic operation to call at run time. Polymorphic operation refers to the possibility to define different operations, in our case functions, that carry the same name but perform different operations. A dispatch of a function is a specific implementation of a function with an interface that differs in terms of number or types of arguments. This allows the programmer to define a particular behavior for particular types, like for instance the eigenvalue decomposition of a matrix of type Dual as is our case. The dispatch implements the analytical derivative of eigenvalues and eigenvectors (<xref ref-type="bibr" rid="R29">Lin et al., 2020</xref>; <xref ref-type="bibr" rid="R54">Van der Aa et al., 2007</xref>). However, the analytic derivative of eigenvectors with degenerate eigenvalues has poles and is thus numerically unstable around degeneracies. Indeed, the standard SPM initial conditions for the linear model and balloon model, which are by default set to zero, are resulting in a Jacobian with degenerate eigenvalues. To avoid this we introduce small Gaussian perturbations (of the order 𝓞(10<sup>−2</sup>)) to the initial conditions as well as to the prior expectation value of the connection matrix. This suffices to avoid this issue and does not affect the parameter estimations detrimentally. We note further that this procedure to avoid degeneracies depends on the specific model. For instance it is not required for coupled canonical microcircuits. Under such circumstances we keep the SPM12 standard and set all states to be 0, that is to the trivial fixed point of the model.</p><p id="P23">Complex numbers pose an additional hurdle since the Dual type of ForwardDiff.jl is not defined for complex numbers. This was simply overcome by dealing with the real and imaginary parts separately and then assembling the Dual of the real part and the Dual of the imaginary part into the complex number type. We improved in speed performance over a previous implementation that addresses these problems (<xref ref-type="bibr" rid="R52">Thummerer &amp; Mikelsons, 2023</xref>).</p></sec><sec id="S6"><title>Julia implementation provides substantial speed improvements</title><p id="P24">Computational complexity can pose a bottleneck when analyzing high-dimensional datasets covering multiple brain regions. Julia provides a high-performance computing environment that reaches computational speeds comparable to C/C++ due to just-in-time compilation (<xref ref-type="bibr" rid="R4">Bezanson et al., 2018</xref>; <xref ref-type="bibr" rid="R40">Pelenitsyn et al., 2021</xref>). We implemented the variational inference method based on the Laplace approximation, also called Variational Laplace, for parameter estimation analogous to the implementation in SPM12. We compare our method based on simulated toy data with the SPM12 implementation to ensure consistency and correctness of our implementation in Julia.</p><p id="P25">We find that the Julia implementation provides a meaningful speed improvement (<xref ref-type="fig" rid="F3">Fig. 3</xref>) while yielding the exact same results in terms of posterior means as well as free energy for all the different implemented versions.</p><p id="P26">These results were achieved using simulated data from the SPM12 script <italic>DEM_demo_induced_FMRI.m.</italic> However, we note that when fitting coupled canonical microcircuits to simulated LFP data, we find that very small deviations (of order 𝓞(10<sup>−3</sup>) to 𝓞(10<sup>−4</sup>)) in parameter expectation value and free energy between the SPM12 implementation and the Julia version that makes use of AD and symbolic computation can occur (see <xref ref-type="table" rid="T1">Tab. 1</xref>). The simulation for this analysis is perfomed with the script <italic>spm_csd_demo.m.</italic></p><p id="P27">Note that in SPM12 we need to set the DCM option “maxnodes” to a value equal to or larger than the number of regions we are inferring to ensure a correct comparison. Maxnodes will otherwise reduce the dimensionality of the problem to the value provided, which leads to a lower computational load.</p><p id="P28">Finally, we made the code amenable to automatic differentiation and use Julia’s ForwardDiff.jl library to perform automatic differentiation on the Variational Laplace optimization. We find a further speed improvement as can be observed in <xref ref-type="fig" rid="F3">Fig. 3</xref>, yielding an almost order of magnitude speed improvement for 10 regions over the MATLAB SPM12 implementation.</p><p id="P29">In Dynamic Causal Modeling parameter fitting is the first step typically followed by model selection. This can be performed with our package in the same way as is performed in SPM12. By changing the prior expectation values for instance one can select effective connections to be present or absent and thereby changing model structure or complexity. Comparison of different models is performed by assessing their negative free energy values (see <xref ref-type="table" rid="T2">Tab. 2</xref>)</p></sec><sec id="S7"><title>fMRI pre-processing methods</title><p id="P30">As we are validating our pipeline against spectral DCM (<xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>), we use a sample subject from the FC1000 project (available at <ext-link ext-link-type="uri" xlink:href="http://www.fil.ion.ucl.ac.uk/spm/data/spDCM/">www.fil.ion.ucl.ac.uk/spm/data/spDCM/</ext-link>) - one of the group used by Friston et al. (<xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>) in their initial validation of spectral DCM - to demonstrate the coherence between SPM and Neuroblox implementations of DCM. Pre-processed data was available from this prior work, so this was the data used in the current study. Briefly, this scan was acquired at the University of Oxford Centre for Clinical Magnetic Resonance Research using a 3T Siemens scanner. Whole-brain fMRI was acquired using a gradient-echo EPI sequence (Repetition Time (<italic>T<sub>R</sub></italic>) = 2000ms, Echo Time (<italic>T<sub>E</sub></italic>) = 28ms, flip angle = 89,° field of view = 224mm, voxel size 3mm × 3mm × 3.5mm, 180 volumes acquired). This scan was accompanied by a T1-weigheted structural MRI (<italic>T<sub>R</sub></italic> = 2040ms, <italic>T<sub>E</sub></italic> = 4.7ms, flip angle = 8°, field of view = 192mm, voxel size = 1mm x 1mm x 1mm) to provide tissue segmentation. The fMRI scan was preprocessed by removing the first five volumes, realigning to the reference scan, normalizing to MNI space, correcting for slice-timing, and spatially smoothing the data with a Gaussian kernel (6mm FWHM). A GLM containing movement regressors was used to remove confounds, along with confound GLMs fit from the ventricle (CSF) and white matter signals (see SPM manual for details). Four ROIs were selected from the default mode network (DMN); all were chosen as 8mm radius spheres centered in each location. The four regions are the posterior cingulate cortex (PCC; center [0, -52, 26]), medial prefrontal cortex (mPFC; [3, 54, -2]), left intraparietal cortex (LIPC; [-50, -63, 32]) and right intraparietal cortex (RIPC; [48, -69, 35]).</p></sec><sec id="S8"><title>Comparison of SPM12 and Julia DCM fitting procedures on fMRI data</title><p id="P31">The DCM was fit in SPM12 using a standard pipeline. A fully connected DCM (i.e., all initial connection weights’ prior expectation value set to be non-zero, specifically they are set to one in SPM12) with no exogenous inputs was specified using the default parameter values (sequential data, <italic>T<sub>E</sub></italic> = 0.04, no modulatory effects, one state per region, no stochastic effects, no centering of input), then inverted using spectral DCM. Additionally, we probed the effects of field strength correction on the results by fitting at three different field strengths (1.5T, 3T, and 7T), presented in <xref ref-type="supplementary-material" rid="SD1">Tab. A2</xref>. Each field strength yielded significantly different results than the other, but all fits agreed in the directions of inter-regional connections, with the exception of LIPC intraregional connectivity (reversed at 1.5T).</p></sec><sec id="S9" sec-type="discussion"><title>Discussion</title><p id="P32">DCM is one of the most widely used and validated methods to extract underlying neural connectivity from fMRI data by fitting and selecting models (<xref ref-type="bibr" rid="R3">Bernal-Casas et al., 2017</xref>; <xref ref-type="bibr" rid="R9">Cha et al., 2016</xref>; <xref ref-type="bibr" rid="R35">R. J. Moran, Mallet, et al., 2011</xref>; <xref ref-type="bibr" rid="R37">Novelli et al., 2024</xref>; <xref ref-type="bibr" rid="R45">Rupprechter et al., 2020</xref>; <xref ref-type="bibr" rid="R46">Seghier &amp; Friston, 2013</xref>; <xref ref-type="bibr" rid="R53">Tik et al., 2018</xref>; <xref ref-type="bibr" rid="R55">Zarghami et al., 2023</xref>). The aim of the work presented here is two-fold: to improve the computational speed and accessibility of the well-established spectral DCM framework provided by SPM12 (<xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>), and to increase the application domain by providing a modular framework for model fitting, thus empowering researchers to tailor their models to specific experimental setups and research questions. Importantly, each brain region can be defined to be governed by a different system of differential equations, which provides more flexibility compared to SPM12 where all regions are governed by the same system of differential equations (with potentially different parameters). We demonstrate that our implementation offers up to an order of magnitude improvement in computational speed compared to the SPM12 DCM, an enhancement enables efficient analysis of large-scale datasets and complex models.</p><p id="P33">Our work builds upon spectral DCM by re-implementing it in Julia, a high-performance programming language (<xref ref-type="bibr" rid="R30">Ma, Dixit, et al., 2021</xref>; <xref ref-type="bibr" rid="R42">Rackauckas, 2023</xref>). By implementing the variational Laplace approach presented here in Julia, we provide a method that recovers identical connectivity values - in both simulated and human fMRI data - as the SPM12 DCM approach while reducing computation time significantly. While SPM12 is implemented as open-source and easily accessible code, it relies upon Matlab, which inherently limits accessibility (to those who have a Matlab license) and computational speed (a known issue of Matlab code - see (<xref ref-type="bibr" rid="R42">Rackauckas, 2023</xref>)). Julia, on the other hand, has been built as open-source from the ground up, with a specific focus on optimizing for scientific computation (<xref ref-type="bibr" rid="R4">Bezanson et al., 2018</xref>; <xref ref-type="bibr" rid="R11">Danford et al., 2017</xref>; <xref ref-type="bibr" rid="R13">Freeman, 2015</xref>; <xref ref-type="bibr" rid="R25">Huang et al., 2019</xref>; <xref ref-type="bibr" rid="R26">Kramer et al., 2018</xref>; <xref ref-type="bibr" rid="R30">Ma, Dixit, et al., 2021</xref>). Even when fully parallelized Julia code offers order-of-magnitude speed benefits over similar Matlab implementations (<xref ref-type="bibr" rid="R11">Danford et al., 2017</xref>; <xref ref-type="bibr" rid="R42">Rackauckas, 2023</xref>). Although the translation of code into Julia is already sufficient to see a significant speed increase, we further optimize the approach by employing automatic differentiation (<xref ref-type="bibr" rid="R44">Revels et al., 2016</xref>). The adoption of automatic differentiation is also set to improve accuracy results for more complex non-linear models as presented in this study (<xref ref-type="bibr" rid="R21">Griewank &amp; Walther, 2008</xref>).</p><p id="P34">A limitation of standard DCM implementation is that all but the most technically savvy users who feel comfortable editing the base code are constrained to the modeling choices imposed by the software. These prespecified models are a linear neural mass (attached to a balloon model for fMRI fitting (<xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>)) or a few varieties of neuronal mass and neural field models for fitting LFP and EEG recordings (<xref ref-type="bibr" rid="R34">R. J. Moran, Jung, et al., 2011</xref>; <xref ref-type="bibr" rid="R36">R. J. Moran et al., 2013</xref>). In our implementation, we provide these standard approaches, but allow the user freedom to choose a variety of other neural mass models during fitting, or to specify their own choices. This is again made possible by implementation in Julia, specifically through the symbolic expressions offered in ModelingToolkit (<xref ref-type="bibr" rid="R31">Ma, Gowda, et al., 2021</xref>). As ModelingToolkit allows for symbolic expressions of neural masses, the process can be as simple as the Jansen-Rit example in <xref ref-type="fig" rid="F1">Fig. 1A</xref>.</p><p id="P35">To illustrate the utility of a flexible modular approach, we provide a method to improve correction for MRI scanner field strengths when fitting a model to real data. Given the ubiquity and power of DCM approaches, it is necessary to consider advances in MRI scanner technology that have happened since the initial implementations of DCM, which used then state-of-the-art 1.5T and 3T scanners (<xref ref-type="bibr" rid="R18">K. J. Friston et al., 2014</xref>; <xref ref-type="bibr" rid="R50">Stephan et al., 2008</xref>). Here, we demonstrate how accounting for higher field strengths (e.g. 7T) that have become more common in human neuroimaging studies is an important consideration, as the results of fitting with the wrong field strength yield significantly different results. We note that the directionality of inter-regional connections is largely stable to this field strength correction (i.e., network topology does not change although the connection strengths do), giving us confidence that prior studies using this technique are still valid. However, given the noticeably different magnitudes of effective connectivity strengths, and the fact that this metric is used in many studies as the outcome of interest, it is important to apply the field strength of the original data when fitting a DCM, and we provide that capability in the package presented here.</p><p id="P36">The optimizations we provide here are only the beginning of future work in advanced neural modeling - indeed, this implementation is specifically built to encourage future development and open-sourced optimization. Some potential approaches to build on this include the substitution of alternatives to the variational Laplace optimization, such as ADVI (<xref ref-type="bibr" rid="R27">Kucukelbir et al., 2016</xref>) and NUTS sampler (<xref ref-type="bibr" rid="R24">Hoffman &amp; Gelman, 2014</xref>) offered through Turing.jl (<xref ref-type="bibr" rid="R19">Ge et al., 2018</xref>). By being built within the Julia ecosystem, the method we present here is therefore poised for extensibility to accelerate the next generation of neural modeling.</p></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Appendix</label><media xlink:href="EMS190447-supplement-Appendix.pdf" mimetype="application" mime-subtype="pdf" id="d23aAcNbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S10"><title>Acknowledgements</title><p>We thank Annabel Driussi for her valuable support with graphics. The research presented here was funded by the Baszucki Brain Research Fund, United States (LRMP). KJF is supported by funding for the Wellcome Centre for Human Neuroimaging (205103/Z/16/Z). AGC acknowledges the NIHGM MSTP Training Award, United States (T32-GM008444).</p></ack><sec id="S11" sec-type="data-availability"><title>Data and Code Availability</title><p id="P37">All methods shown here, which include an easy-to-use GUI as well as documentation and tutorials, are made freely available through the Neuroblox computational neuroscience platform (neuroblox.org). Neuroblox can be accessed through the JuliaHub repository (juliahub.com). The Julia code-base without GUI is available in this repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/Neuroblox/Spectral-Dynamic-Causal-Modeling.git">https://github.com/Neuroblox/Spectral-Dynamic-Causal-Modeling.git</ext-link></p></sec><fn-group><fn id="FN1" fn-type="con"><p id="P38"><bold>Author Contributions</bold></p><p id="P39">Conceptualization: D.H., L.M.P. and H.H.S.; Formal analysis: D.H. and A.C.; Funding acquisition: C.R., A.E., L.M.P., and H.H.S.; Investigation: D.H.; Methodology: D.H.; Project administration: L.M.P.; Software: D.H., C.R., and H.H.S.; Supervision: C.R., K.J.F., and H.H.S.; Visualization: D.H. and A.C.; Writing – original draft: D.H. and A.C.; Writing - review &amp; editing: D.H., A.C., L.M.P., K.J.F., and H.H.S.</p></fn><fn id="FN2" fn-type="conflict"><p id="P40"><bold>Declaration of Competing Interests</bold></p><p id="P41">The authors declare the following competing interests: authors C.R., L.M.P., A.E., and H.H.S. are co-founders of Neuroblox Inc., a company spun out of SUNYSB, MIT, and Dartmouth to develop a commercial-grade software platform for multi-scale computational neuroscience with applications to diagnosis and treatment of brain-based disorders.</p></fn></fn-group><ref-list><ref id="R1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bastos</surname><given-names>AM</given-names></name><name><surname>Litvak</surname><given-names>V</given-names></name><name><surname>Moran</surname><given-names>R</given-names></name><name><surname>Bosman</surname><given-names>CA</given-names></name><name><surname>Fries</surname><given-names>P</given-names></name><name><surname>Friston</surname><given-names>KJ</given-names></name></person-group><article-title>A DCM study of spectral asymmetries in feedforward and feedback connections between visual areas V1 and V4 in the monkey</article-title><source>Neuroimage</source><year>2015</year><volume>108</volume><fpage>460</fpage><lpage>475</lpage><pub-id pub-id-type="pmcid">PMC4334664</pub-id><pub-id pub-id-type="pmid">25585017</pub-id><pub-id pub-id-type="doi">10.1016/j.neuroimage.2014.12.081</pub-id></element-citation></ref><ref id="R2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bastos</surname><given-names>AM</given-names></name><name><surname>Usrey</surname><given-names>WM</given-names></name><name><surname>Adams</surname><given-names>RA</given-names></name><name><surname>Mangun</surname><given-names>GR</given-names></name><name><surname>Fries</surname><given-names>P</given-names></name><name><surname>Friston</surname><given-names>KJ</given-names></name></person-group><article-title>Canonical Microcircuits for Predictive Coding</article-title><source>Neuron</source><year>2012</year><volume>76</volume><issue>4</issue><fpage>695</fpage><lpage>711</lpage><pub-id pub-id-type="pmcid">PMC3777738</pub-id><pub-id pub-id-type="pmid">23177956</pub-id><pub-id pub-id-type="doi">10.1016/j.neuron.2012.10.038</pub-id></element-citation></ref><ref id="R3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bernal-Casas</surname><given-names>D</given-names></name><name><surname>Lee</surname><given-names>HJ</given-names></name><name><surname>Weitz</surname><given-names>AJ</given-names></name><name><surname>Lee</surname><given-names>JH</given-names></name></person-group><article-title>Studying brain circuit function with dynamic causal modeling for optogenetic fMRI</article-title><source>Neuron</source><year>2017</year><volume>93</volume><issue>3</issue><fpage>522</fpage><lpage>532</lpage><elocation-id>e5</elocation-id><pub-id pub-id-type="pmcid">PMC5472443</pub-id><pub-id pub-id-type="pmid">28132829</pub-id><pub-id pub-id-type="doi">10.1016/j.neuron.2016.12.035</pub-id></element-citation></ref><ref id="R4"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Bezanson</surname><given-names>J</given-names></name><name><surname>Chen</surname><given-names>J</given-names></name><name><surname>Chung</surname><given-names>B</given-names></name><name><surname>Karpinski</surname><given-names>S</given-names></name><name><surname>Shah</surname><given-names>VB</given-names></name><name><surname>Vitek</surname><given-names>J</given-names></name><name><surname>Zoubritzky</surname><given-names>L</given-names></name></person-group><source>Julia: Dynamism and performance reconciled by design</source><conf-name>Proceedings of the ACM on Programming Languages, 2(OOPSLA)</conf-name><year>2018</year><volume>120</volume><issue>1-120</issue><fpage>23</fpage><pub-id pub-id-type="doi">10.1145/3276490</pub-id></element-citation></ref><ref id="R5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bukhari</surname><given-names>Q</given-names></name><name><surname>Ruf</surname><given-names>SF</given-names></name><name><surname>Guell</surname><given-names>X</given-names></name><name><surname>Whitfield-Gabrieli</surname><given-names>S</given-names></name><name><surname>Anteraper</surname><given-names>S</given-names></name></person-group><article-title>Interaction Between Cerebellum and Cerebral Cortex, Evidence from Dynamic Causal Modeling</article-title><source>The Cerebellum</source><year>2022</year><volume>21</volume><issue>2</issue><fpage>225</fpage><lpage>233</lpage><pub-id pub-id-type="pmid">34146220</pub-id></element-citation></ref><ref id="R6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buxton</surname><given-names>RB</given-names></name></person-group><article-title>The physics of functional magnetic resonance imaging (fMRI)</article-title><source>Reports on progress in physics Physical Society (Great Britain)</source><year>2013</year><volume>76</volume><issue>9</issue><elocation-id>096601</elocation-id><pub-id pub-id-type="pmcid">PMC4376284</pub-id><pub-id pub-id-type="pmid">24006360</pub-id><pub-id pub-id-type="doi">10.1088/0034-4885/76/9/096601</pub-id></element-citation></ref><ref id="R7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buxton</surname><given-names>RB</given-names></name><name><surname>Frank</surname><given-names>LR</given-names></name></person-group><article-title>A Model for the Coupling between Cerebral Blood Flow and Oxygen Metabolism during Neural Stimulation</article-title><source>Journal of Cerebral Blood Flow &amp; Metabolism</source><year>1997</year><volume>17</volume><issue>1</issue><fpage>64</fpage><lpage>72</lpage><pub-id pub-id-type="pmid">8978388</pub-id></element-citation></ref><ref id="R8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Buxton</surname><given-names>RB</given-names></name><name><surname>Uludağ</surname><given-names>K</given-names></name><name><surname>Dubowitz</surname><given-names>DJ</given-names></name><name><surname>Liu</surname><given-names>TT</given-names></name></person-group><article-title>Modeling the hemodynamic response to brain activation</article-title><source>NeuroImage</source><year>2004</year><volume>23</volume><fpage>S220</fpage><lpage>S233</lpage><pub-id pub-id-type="pmid">15501093</pub-id></element-citation></ref><ref id="R9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Cha</surname><given-names>J</given-names></name><name><surname>Greenberg</surname><given-names>T</given-names></name><name><surname>Song</surname><given-names>I</given-names></name><name><surname>Blair Simpson</surname><given-names>H</given-names></name><name><surname>Posner</surname><given-names>J</given-names></name><name><surname>Mujica-Parodi</surname><given-names>LR</given-names></name></person-group><article-title>Abnormal hippocampal structure and function in clinical anxiety and comorbid depression</article-title><source>Hippocampus</source><year>2016</year><volume>26</volume><issue>5</issue><fpage>545</fpage><lpage>553</lpage><pub-id pub-id-type="pmcid">PMC4837065</pub-id><pub-id pub-id-type="pmid">26743454</pub-id><pub-id pub-id-type="doi">10.1002/hipo.22566</pub-id></element-citation></ref><ref id="R10"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Cover</surname><given-names>T</given-names></name><name><surname>Thomas</surname><given-names>J</given-names></name></person-group><source>Elements of information theory</source><edition>2nd ed</edition><publisher-name>Wiley</publisher-name><year>2006</year><comment><ext-link ext-link-type="uri" xlink:href="https://scholar.google.com/scholar?hl=en&amp;btnG=Search&amp;q=intitle:Elements+of+information+theory#0">http://scholar.google.com/scholar?hl=en&amp;btnG=Search&amp;q=intitle:Elements+of+information+theory#0</ext-link></comment></element-citation></ref><ref id="R11"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Danford</surname><given-names>F</given-names></name><name><surname>Welch</surname><given-names>E</given-names></name><name><surname>Cárdenas-Ródriguez</surname><given-names>J</given-names></name><name><surname>Strout</surname><given-names>MM</given-names></name></person-group><chapter-title>Analyzing Parallel Programming Models for Magnetic Resonance Imaging</chapter-title><person-group person-group-type="editor"><name><surname>Ding</surname><given-names>C</given-names></name><name><surname>Criswell</surname><given-names>J</given-names></name><name><surname>Wu</surname><given-names>P</given-names></name></person-group><source>Languages and Compilers for Parallel Computing</source><publisher-name>Springer International Publishing</publisher-name><year>2017</year><fpage>188</fpage><lpage>202</lpage><pub-id pub-id-type="doi">10.1007/978-3-319-52709-3_15</pub-id></element-citation></ref><ref id="R12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>David</surname><given-names>O</given-names></name><name><surname>Kiebel</surname><given-names>SJ</given-names></name><name><surname>Harrison</surname><given-names>LM</given-names></name><name><surname>Mattout</surname><given-names>J</given-names></name><name><surname>Kilner</surname><given-names>JM</given-names></name><name><surname>Friston</surname><given-names>KJ</given-names></name></person-group><article-title>Dynamic causal modeling of evoked responses in EEG and MEG</article-title><source>NeuroImage</source><year>2006</year><volume>30</volume><issue>4</issue><fpage>1255</fpage><lpage>1272</lpage><pub-id pub-id-type="pmid">16473023</pub-id></element-citation></ref><ref id="R13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Freeman</surname><given-names>J</given-names></name></person-group><article-title>Open source tools for large-scale neuroscience</article-title><source>Current Opinion in Neurobiology</source><year>2015</year><volume>32</volume><fpage>156</fpage><lpage>163</lpage><pub-id pub-id-type="pmid">25982977</pub-id></element-citation></ref><ref id="R14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Friston</surname><given-names>KJ</given-names></name><name><surname>Harrison</surname><given-names>L</given-names></name><name><surname>Penny</surname><given-names>W</given-names></name></person-group><article-title>Dynamic causal modelling</article-title><source>NeuroImage</source><year>2003</year><volume>19</volume><issue>4</issue><fpage>1273</fpage><lpage>1302</lpage><pub-id pub-id-type="pmid">12948688</pub-id></element-citation></ref><ref id="R15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Friston</surname><given-names>K</given-names></name><name><surname>Mattout</surname><given-names>J</given-names></name><name><surname>Trujillo-Barreto</surname><given-names>N</given-names></name><name><surname>Ashburner</surname><given-names>J</given-names></name><name><surname>Penny</surname><given-names>W</given-names></name></person-group><article-title>Variational free energy and the Laplace approximation</article-title><source>NeuroImage</source><year>2007</year><volume>34</volume><issue>1</issue><fpage>220</fpage><lpage>234</lpage><pub-id pub-id-type="pmid">17055746</pub-id></element-citation></ref><ref id="R16"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Friston</surname><given-names>KJ</given-names></name></person-group><article-title>Functional and Effective Connectivity: A Review</article-title><source>Brain Connectivity</source><publisher-name>Mary Ann Liebert, Inc</publisher-name><year>2011</year><volume>1</volume><issue>1</issue><fpage>13</fpage><lpage>36</lpage><pub-id pub-id-type="pmid">22432952</pub-id></element-citation></ref><ref id="R17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Friston</surname><given-names>KJ</given-names></name><name><surname>Bastos</surname><given-names>AM</given-names></name><name><surname>Pinotsis</surname><given-names>D</given-names></name><name><surname>Litvak</surname><given-names>V</given-names></name></person-group><article-title>LFP and oscillations—what do they tell us?</article-title><source>Current Opinion in Neurobiology</source><year>2015</year><volume>31</volume><fpage>1</fpage><lpage>6</lpage><pub-id pub-id-type="doi">10.1016/j.conb.2014.05.004</pub-id></element-citation></ref><ref id="R18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Friston</surname><given-names>KJ</given-names></name><name><surname>Kahan</surname><given-names>J</given-names></name><name><surname>Biswal</surname><given-names>B</given-names></name><name><surname>Razi</surname><given-names>A</given-names></name></person-group><article-title>A DCM for resting state fMRI</article-title><source>NeuroImage</source><year>2014</year><volume>94</volume><fpage>396</fpage><lpage>407</lpage><pub-id pub-id-type="pmcid">PMC4073651</pub-id><pub-id pub-id-type="pmid">24345387</pub-id><pub-id pub-id-type="doi">10.1016/j.neuroimage.2013.12.009</pub-id></element-citation></ref><ref id="R19"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Ge</surname><given-names>H</given-names></name><name><surname>Xu</surname><given-names>K</given-names></name><name><surname>Ghahramani</surname><given-names>Z</given-names></name></person-group><source>Turing: A Language for Flexible Probabilistic Inference</source><conf-name>Proceedings of the Twenty-First International Conference on Artificial Intelligence and Statistics</conf-name><year>2018</year><fpage>1682</fpage><lpage>1690</lpage><comment>[ISSN: 2640-3498] Retrieved September 29, 2023, from <ext-link ext-link-type="uri" xlink:href="https://proceedings.mlr.press/v84/ge18b.html">https://proceedings.mlr.press/v84/ge18b.html</ext-link></comment></element-citation></ref><ref id="R20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gowda</surname><given-names>S</given-names></name><name><surname>Ma</surname><given-names>Y</given-names></name><name><surname>Cheli</surname><given-names>A</given-names></name><name><surname>Gwozdz</surname><given-names>M</given-names></name><name><surname>Shah</surname><given-names>VB</given-names></name><name><surname>Edelman</surname><given-names>A</given-names></name><name><surname>Rackauckas</surname><given-names>C</given-names></name></person-group><article-title>High-performance symbolic-numerics via multiple dispatch</article-title><source>arXiv:2105 03949 [cs]</source><year>2022</year><month>February</month><pub-id pub-id-type="doi">10.48550/arXiv.2105.03949</pub-id></element-citation></ref><ref id="R21"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Griewank</surname><given-names>A</given-names></name><name><surname>Walther</surname><given-names>A</given-names></name></person-group><source>Evaluating Derivatives: Principles and Techniques of Algorithmic Differentiation</source><publisher-name>Society for Industrial; Applied Mathematics</publisher-name><edition>2nd edition</edition><year>2008</year><month>November</month></element-citation></ref><ref id="R22"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Hahn</surname><given-names>A</given-names></name><name><surname>Breakspear</surname><given-names>M</given-names></name><name><surname>Rischka</surname><given-names>L</given-names></name><name><surname>Wadsak</surname><given-names>W</given-names></name><name><surname>Godbersen</surname><given-names>GM</given-names></name><name><surname>Pichler</surname><given-names>V</given-names></name><name><surname>Michenthaler</surname><given-names>P</given-names></name><name><surname>Vanicek</surname><given-names>T</given-names></name><name><surname>Hacker</surname><given-names>M</given-names></name><name><surname>Kasper</surname><given-names>S</given-names></name><name><surname>Lanzenberger</surname><given-names>R</given-names></name><etal/></person-group><chapter-title>Reconfiguration of functional brain networks and metabolic cost converge during task performance</chapter-title><person-group person-group-type="editor"><name><surname>Yeo</surname><given-names>T</given-names></name><name><surname>Behrens</surname><given-names>TE</given-names></name><name><surname>Bijsterbosch</surname><given-names>JD</given-names></name></person-group><source>eLife</source><publisher-name>eLife Sciences Publications, Ltd</publisher-name><year>2020</year><volume>9</volume><elocation-id>e52443</elocation-id><pub-id pub-id-type="pmcid">PMC7176400</pub-id><pub-id pub-id-type="pmid">32314956</pub-id><pub-id pub-id-type="doi">10.7554/eLife.52443</pub-id></element-citation></ref><ref id="R23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Havlicek</surname><given-names>M</given-names></name><name><surname>Roebroeck</surname><given-names>A</given-names></name><name><surname>Friston</surname><given-names>K</given-names></name><name><surname>Gardumi</surname><given-names>A</given-names></name><name><surname>Ivanov</surname><given-names>D</given-names></name><name><surname>Uludag</surname><given-names>K</given-names></name></person-group><article-title>Physiologically informed dynamic causal modeling of fMRI data</article-title><source>NeuroImage</source><year>2015</year><volume>122</volume><fpage>355</fpage><lpage>372</lpage><pub-id pub-id-type="pmid">26254113</pub-id></element-citation></ref><ref id="R24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hoffman</surname><given-names>MD</given-names></name><name><surname>Gelman</surname><given-names>A</given-names></name></person-group><article-title>The No-U-Turn Sampler: Adaptively Setting Path Lengths in Hamiltonian Monte Carlo [tex.ids= homan2014]</article-title><source>Journal of Machine Learning Research</source><year>2014</year><volume>15</volume></element-citation></ref><ref id="R25"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Huang</surname><given-names>R</given-names></name><name><surname>Xu</surname><given-names>W</given-names></name><name><surname>Wang</surname><given-names>Y</given-names></name><name><surname>Liverani</surname><given-names>S</given-names></name><name><surname>Stapleton</surname><given-names>AE</given-names></name></person-group><source>Performance Comparison of Julia Distributed Implementations of Dirichlet Process Mixture Models</source><conf-name>2019 IEEE International Conference on Big Data (Big Data)</conf-name><year>2019</year><fpage>3350</fpage><lpage>3354</lpage><pub-id pub-id-type="doi">10.1109/BigData47090.2019.9005453</pub-id></element-citation></ref><ref id="R26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kramer</surname><given-names>S</given-names></name><name><surname>Plankensteiner</surname><given-names>D</given-names></name><name><surname>Ostermann</surname><given-names>L</given-names></name><name><surname>Ritsch</surname><given-names>H</given-names></name></person-group><article-title>QuantumOptics.jl: A Julia framework for simulating open quantum systems</article-title><source>Computer Physics Communications</source><year>2018</year><volume>227</volume><fpage>109</fpage><lpage>116</lpage><pub-id pub-id-type="doi">10.1016/j.cpc.2018.02.004</pub-id></element-citation></ref><ref id="R27"><element-citation publication-type="web"><person-group person-group-type="author"><name><surname>Kucukelbir</surname><given-names>A</given-names></name><name><surname>Tran</surname><given-names>D</given-names></name><name><surname>Ranganath</surname><given-names>R</given-names></name><name><surname>Gelman</surname><given-names>A</given-names></name><name><surname>Blei</surname><given-names>DM</given-names></name></person-group><source>Automatic Differentiation Variational Inference (tech rep)</source><year>2016</year><month>March</month><elocation-id>arXiv: 1603 00788</elocation-id><comment>Retrieved November 1, 2021, from <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1603.00788">http://arxiv.org/abs/1603.00788</ext-link></comment></element-citation></ref><ref id="R28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>S-M</given-names></name><name><surname>Tibon</surname><given-names>R</given-names></name><name><surname>Zeidman</surname><given-names>P</given-names></name><name><surname>Yadav</surname><given-names>PS</given-names></name><name><surname>Henson</surname><given-names>R</given-names></name></person-group><article-title>Effects of face repetition on ventral visual stream connectivity using dynamic causal modelling of fMRI data</article-title><source>NeuroImage</source><year>2022</year><volume>264</volume><elocation-id>119708</elocation-id><pub-id pub-id-type="pmid">36280098</pub-id></element-citation></ref><ref id="R29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lin</surname><given-names>RM</given-names></name><name><surname>Mottershead</surname><given-names>JE</given-names></name><name><surname>Ng</surname><given-names>TY</given-names></name></person-group><article-title>A state-of-the-art review on theory and engineering applications of eigenvalue and eigenvector derivatives</article-title><source>Mechanical Systems and Signal Processing</source><year>2020</year><volume>138</volume><elocation-id>106536</elocation-id><pub-id pub-id-type="doi">10.1016/j.ymssp.2019.106536</pub-id></element-citation></ref><ref id="R30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ma</surname><given-names>Y</given-names></name><name><surname>Dixit</surname><given-names>V</given-names></name><name><surname>Innes</surname><given-names>M</given-names></name><name><surname>Guo</surname><given-names>X</given-names></name><name><surname>Rackauckas</surname><given-names>C</given-names></name></person-group><article-title>A Comparison of Automatic Differentiation and Continuous Sensitivity Analysis for Derivatives of Differential Equation Solutions [arXiv: 1812.01892]</article-title><source>arXiv:1812 01892 [cs]</source><year>2021</year><comment>Retrieved October 13, 2021 from <ext-link ext-link-type="uri" xlink:href="http://arxiv.org/abs/1812.01892">http://arxiv.org/abs/1812.01892</ext-link></comment></element-citation></ref><ref id="R31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ma</surname><given-names>Y</given-names></name><name><surname>Gowda</surname><given-names>S</given-names></name><name><surname>Anantharaman</surname><given-names>R</given-names></name><name><surname>Laughman</surname><given-names>C</given-names></name><name><surname>Viral</surname><given-names>S</given-names></name><name><surname>Rackauckas</surname><given-names>C</given-names></name></person-group><article-title>ModelingToolkit: A Composable Graph Transformation System for Equation-Based Modeling</article-title><source>arXiv, 2103 05244</source><year>2021</year><pub-id pub-id-type="doi">10.48550/arXiv.2103.05244</pub-id></element-citation></ref><ref id="R32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marek</surname><given-names>S</given-names></name><name><surname>Tervo-Clemmens</surname><given-names>B</given-names></name><name><surname>Calabro</surname><given-names>FJ</given-names></name><name><surname>Montez</surname><given-names>DF</given-names></name><name><surname>Kay</surname><given-names>BP</given-names></name><name><surname>Hatoum</surname><given-names>AS</given-names></name><name><surname>Donohue</surname><given-names>MR</given-names></name><name><surname>Foran</surname><given-names>W</given-names></name><name><surname>Miller</surname><given-names>RL</given-names></name><name><surname>Hendrickson</surname><given-names>TJ</given-names></name><name><surname>Malone</surname><given-names>SM</given-names></name><etal/></person-group><article-title>Reproducible brain-wide association studies require thousands of individuals</article-title><source>Nature</source><year>2022</year><volume>603</volume><issue>7902</issue><fpage>654</fpage><lpage>660</lpage><pub-id pub-id-type="pmcid">PMC8991999</pub-id><pub-id pub-id-type="pmid">35296861</pub-id><pub-id pub-id-type="doi">10.1038/s41586-022-04492-9</pub-id></element-citation></ref><ref id="R33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moran</surname><given-names>R</given-names></name><name><surname>Stephan</surname><given-names>K</given-names></name><name><surname>Kiebel</surname><given-names>S</given-names></name><name><surname>Rombach</surname><given-names>N</given-names></name><name><surname>O’Connor</surname><given-names>W</given-names></name><name><surname>Murphy</surname><given-names>K</given-names></name><name><surname>Reilly</surname><given-names>R</given-names></name><name><surname>Friston</surname><given-names>K</given-names></name></person-group><article-title>Bayesian estimation of synaptic physiology from the spectral responses of neural masses</article-title><source>NeuroImage</source><year>2008</year><volume>42</volume><issue>1</issue><fpage>272</fpage><lpage>284</lpage><pub-id pub-id-type="pmcid">PMC2644419</pub-id><pub-id pub-id-type="pmid">18515149</pub-id><pub-id pub-id-type="doi">10.1016/j.neuroimage.2008.01.025</pub-id></element-citation></ref><ref id="R34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moran</surname><given-names>RJ</given-names></name><name><surname>Jung</surname><given-names>F</given-names></name><name><surname>Kumagai</surname><given-names>T</given-names></name><name><surname>Endepols</surname><given-names>H</given-names></name><name><surname>Graf</surname><given-names>R</given-names></name><name><surname>Dolan</surname><given-names>RJ</given-names></name><name><surname>Friston</surname><given-names>KJ</given-names></name><name><surname>Stephan</surname><given-names>KE</given-names></name><name><surname>Tittgemeyer</surname><given-names>M</given-names></name></person-group><article-title>Dynamic Causal Models and Physiological Inference: A Validation Study Using Isoflurane Anaesthesia in Rodents</article-title><source>PLoS ONE</source><year>2011</year><volume>6</volume><issue>8</issue><elocation-id>e22790</elocation-id><pub-id pub-id-type="pmcid">PMC3149050</pub-id><pub-id pub-id-type="pmid">21829652</pub-id><pub-id pub-id-type="doi">10.1371/journal.pone.0022790</pub-id></element-citation></ref><ref id="R35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moran</surname><given-names>RJ</given-names></name><name><surname>Mallet</surname><given-names>N</given-names></name><name><surname>Litvak</surname><given-names>V</given-names></name><name><surname>Dolan</surname><given-names>RJ</given-names></name><name><surname>Magill</surname><given-names>PJ</given-names></name><name><surname>Friston</surname><given-names>KJ</given-names></name><name><surname>Brown</surname><given-names>P</given-names></name></person-group><article-title>Alterations in Brain Connectivity Underlying Beta Oscillations in Parkinsonism</article-title><person-group person-group-type="editor"><name><surname>Kording</surname><given-names>KP</given-names></name></person-group><source>PLoS Computational Biology</source><year>2011</year><volume>7</volume><issue>8</issue><elocation-id>e1002124</elocation-id><pub-id pub-id-type="pmcid">PMC3154892</pub-id><pub-id pub-id-type="pmid">21852943</pub-id><pub-id pub-id-type="doi">10.1371/journal.pcbi.1002124</pub-id></element-citation></ref><ref id="R36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moran</surname><given-names>RJ</given-names></name><name><surname>Pinotsis</surname><given-names>D</given-names></name><name><surname>Friston</surname><given-names>K</given-names></name></person-group><article-title>Neural masses and fields in dynamic causal modeling</article-title><source>Frontiers in Computational Neuroscience</source><year>2013</year><volume>7</volume><fpage>57</fpage><pub-id pub-id-type="pmcid">PMC3664834</pub-id><pub-id pub-id-type="pmid">23755005</pub-id><pub-id pub-id-type="doi">10.3389/fncom.2013.00057</pub-id></element-citation></ref><ref id="R37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Novelli</surname><given-names>L</given-names></name><name><surname>Friston</surname><given-names>K</given-names></name><name><surname>Razi</surname><given-names>A</given-names></name></person-group><article-title>Spectral dynamic causal modeling: A didactic introduction and its relationship with functional connectivity</article-title><source>Network Neuroscience</source><year>2024</year><volume>8</volume><issue>1</issue><fpage>178</fpage><lpage>202</lpage><pub-id pub-id-type="pmcid">PMC10898785</pub-id><pub-id pub-id-type="pmid">38562289</pub-id><pub-id pub-id-type="doi">10.1162/netn_a_00348</pub-id></element-citation></ref><ref id="R38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Obata</surname><given-names>T</given-names></name><name><surname>Liu</surname><given-names>TT</given-names></name><name><surname>Miller</surname><given-names>KL</given-names></name><name><surname>Luh</surname><given-names>WM</given-names></name><name><surname>Wong</surname><given-names>EC</given-names></name><name><surname>Frank</surname><given-names>LR</given-names></name><name><surname>Buxton</surname><given-names>RB</given-names></name></person-group><article-title>Discrepancies between BOLD and flow dynamics in primary and supplementary motor areas: Application of the balloon model to the interpretation of BOLD transients</article-title><source>NeuroImage</source><year>2004</year><volume>21</volume><issue>1</issue><fpage>144</fpage><lpage>153</lpage><pub-id pub-id-type="pmid">14741651</pub-id></element-citation></ref><ref id="R39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Parr</surname><given-names>T</given-names></name><name><surname>Bhat</surname><given-names>A</given-names></name><name><surname>Zeidman</surname><given-names>P</given-names></name><name><surname>Goel</surname><given-names>A</given-names></name><name><surname>Billig</surname><given-names>AJ</given-names></name><name><surname>Moran</surname><given-names>R</given-names></name><name><surname>Friston</surname><given-names>KJ</given-names></name></person-group><article-title>Dynamic causal modelling of immune heterogeneity</article-title><source>Scientific Reports</source><year>2021</year><volume>11</volume><issue>1</issue><elocation-id>11400</elocation-id><pub-id pub-id-type="pmcid">PMC8167139</pub-id><pub-id pub-id-type="pmid">34059775</pub-id><pub-id pub-id-type="doi">10.1038/s41598-021-91011-x</pub-id></element-citation></ref><ref id="R40"><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Pelenitsyn</surname><given-names>A</given-names></name><name><surname>Belyakova</surname><given-names>J</given-names></name><name><surname>Chung</surname><given-names>B</given-names></name><name><surname>Tate</surname><given-names>R</given-names></name><name><surname>Vitek</surname><given-names>J</given-names></name></person-group><source>Type stability in Julia: Avoiding performance pathologies in JIT compilation</source><conf-name>Proceedings of the ACM on Programming Languages, 5(OOPSLA)</conf-name><year>2021</year><volume>150</volume><fpage>1</fpage><lpage>150</lpage><comment>26</comment><pub-id pub-id-type="doi">10.1145/3485527</pub-id></element-citation></ref><ref id="R41"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Penny</surname><given-names>WD</given-names></name><name><surname>Stephan</surname><given-names>KE</given-names></name><name><surname>Mechelli</surname><given-names>A</given-names></name><name><surname>Friston</surname><given-names>KJ</given-names></name></person-group><article-title>Modelling functional integration: A comparison of structural equation and dynamic causal models</article-title><source>NeuroImage</source><year>2004</year><volume>23</volume><issue>Suppl 1</issue><fpage>S264</fpage><lpage>274</lpage><pub-id pub-id-type="pmid">15501096</pub-id></element-citation></ref><ref id="R42"><element-citation publication-type="web"><person-group person-group-type="author"><name><surname>Rackauckas</surname><given-names>C</given-names></name></person-group><source>ODE Solver Multi-Language Wrapper Package Work-Precision Benchmarks (MATLAB, SciPy, Julia, deSolve (R))</source><year>2023</year><comment>Retrieved September 10, 2023 from <ext-link ext-link-type="uri" xlink:href="https://docs.sciml.ai/SciMLBenchmarksOutput/stable/MultiLanguage/ode_wrapper_packages/">https://docs.sciml.ai/SciMLBenchmarksOutput/stable/MultiLanguage/ode_wrapper_packages/</ext-link></comment></element-citation></ref><ref id="R43"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Razi</surname><given-names>A</given-names></name><name><surname>Seghier</surname><given-names>ML</given-names></name><name><surname>Zhou</surname><given-names>Y</given-names></name><name><surname>McColgan</surname><given-names>P</given-names></name><name><surname>Zeidman</surname><given-names>P</given-names></name><name><surname>Park</surname><given-names>H-J</given-names></name><name><surname>Sporns</surname><given-names>O</given-names></name><name><surname>Rees</surname><given-names>G</given-names></name><name><surname>Friston</surname><given-names>KJ</given-names></name></person-group><article-title>Large-scale DCMs for resting-state fMRI</article-title><source>Network Neuroscience</source><year>2017</year><volume>1</volume><issue>3</issue><fpage>222</fpage><lpage>241</lpage><pub-id pub-id-type="pmcid">PMC5796644</pub-id><pub-id pub-id-type="pmid">29400357</pub-id><pub-id pub-id-type="doi">10.1162/NETN_a_00015</pub-id></element-citation></ref><ref id="R44"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Revels</surname><given-names>J</given-names></name><name><surname>Lubin</surname><given-names>M</given-names></name><name><surname>Papamarkou</surname><given-names>T</given-names></name></person-group><article-title>Forward-Mode Automatic Differentiation in Julia</article-title><source>arXiv:1607 07892 [cs]</source><year>2016</year><month>July</month><pub-id pub-id-type="doi">10.48550/arXiv.1607.07892</pub-id></element-citation></ref><ref id="R45"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rupprechter</surname><given-names>S</given-names></name><name><surname>Romaniuk</surname><given-names>L</given-names></name><name><surname>Series</surname><given-names>P</given-names></name><name><surname>Hirose</surname><given-names>Y</given-names></name><name><surname>Hawkins</surname><given-names>E</given-names></name><name><surname>Sandu</surname><given-names>A-L</given-names></name><name><surname>Waiter</surname><given-names>GD</given-names></name><name><surname>McNeil</surname><given-names>CJ</given-names></name><name><surname>Shen</surname><given-names>X</given-names></name><name><surname>Harris</surname><given-names>MA</given-names></name><name><surname>Campbell</surname><given-names>A</given-names></name><etal/></person-group><article-title>Blunted medial prefrontal cortico-limbic reward-related effective connectivity and depression</article-title><source>Brain</source><year>2020</year><volume>143</volume><issue>6</issue><fpage>1946</fpage><lpage>1956</lpage><pub-id pub-id-type="pmcid">PMC7296844</pub-id><pub-id pub-id-type="pmid">32385498</pub-id><pub-id pub-id-type="doi">10.1093/brain/awaa106</pub-id></element-citation></ref><ref id="R46"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Seghier</surname><given-names>ML</given-names></name><name><surname>Friston</surname><given-names>KJ</given-names></name></person-group><article-title>Network discovery with large DCMs</article-title><source>NeuroImage</source><year>2013</year><volume>68</volume><fpage>181</fpage><lpage>191</lpage><pub-id pub-id-type="pmcid">PMC3566585</pub-id><pub-id pub-id-type="pmid">23246991</pub-id><pub-id pub-id-type="doi">10.1016/j.neuroimage.2012.12.005</pub-id></element-citation></ref><ref id="R47"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sidén</surname><given-names>P</given-names></name></person-group><article-title>Scalable Bayesian spatial analysis with Gaussian Markov random fields</article-title><year>2020</year><month>September</month><pub-id pub-id-type="doi">10.3384/diss.diva-165872</pub-id></element-citation></ref><ref id="R48"><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Sladky</surname><given-names>R</given-names></name><name><surname>Hahn</surname><given-names>A</given-names></name><name><surname>Karl</surname><given-names>I-L</given-names></name><name><surname>Geissberger</surname><given-names>N</given-names></name><name><surname>Kranz</surname><given-names>GS</given-names></name><name><surname>Tik</surname><given-names>M</given-names></name><name><surname>Kraus</surname><given-names>C</given-names></name><name><surname>Pfabigan</surname><given-names>DM</given-names></name><name><surname>Gartus</surname><given-names>A</given-names></name><name><surname>Lanzenberger</surname><given-names>R</given-names></name><name><surname>Lamm</surname><given-names>C</given-names></name><etal/></person-group><article-title>Dynamic Causal Modeling of the Prefrontal/Amygdala Network During Processing of Emotional Faces</article-title><source>Brain Connectivity</source><publisher-name>Mary Ann Liebert, Inc., publishers</publisher-name><year>2022</year><volume>12</volume><issue>7</issue><fpage>670</fpage><lpage>682</lpage><pub-id pub-id-type="pmid">34605671</pub-id></element-citation></ref><ref id="R49"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sladky</surname><given-names>R</given-names></name><name><surname>Höflich</surname><given-names>A</given-names></name><name><surname>Küblböck</surname><given-names>M</given-names></name><name><surname>Kraus</surname><given-names>C</given-names></name><name><surname>Baldinger</surname><given-names>P</given-names></name><name><surname>Moser</surname><given-names>E</given-names></name><name><surname>Lanzenberger</surname><given-names>R</given-names></name><name><surname>Windischberger</surname><given-names>C</given-names></name></person-group><article-title>Disrupted Effective Connectivity Between the Amygdala and Orbitofrontal Cortex in Social Anxiety Disorder During Emotion Discrimination Revealed by Dynamic Causal Modeling for fMRI</article-title><source>Cerebral Cortex</source><year>2015</year><volume>25</volume><issue>4</issue><fpage>895</fpage><lpage>903</lpage><pub-id pub-id-type="pmcid">PMC4379995</pub-id><pub-id pub-id-type="pmid">24108802</pub-id><pub-id pub-id-type="doi">10.1093/cercor/bht279</pub-id></element-citation></ref><ref id="R50"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stephan</surname><given-names>KE</given-names></name><name><surname>Kasper</surname><given-names>L</given-names></name><name><surname>Harrison</surname><given-names>LM</given-names></name><name><surname>Daunizeau</surname><given-names>J</given-names></name><name><surname>den Ouden</surname><given-names>HE</given-names></name><name><surname>Breakspear</surname><given-names>M</given-names></name><name><surname>Friston</surname><given-names>KJ</given-names></name></person-group><article-title>Nonlinear Dynamic Causal Models for fMRI</article-title><source>NeuroImage</source><year>2008</year><volume>42</volume><issue>2</issue><fpage>649</fpage><lpage>662</lpage><pub-id pub-id-type="pmcid">PMC2636907</pub-id><pub-id pub-id-type="pmid">18565765</pub-id><pub-id pub-id-type="doi">10.1016/j.neuroimage.2008.04.262</pub-id></element-citation></ref><ref id="R51"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Stephan</surname><given-names>KE</given-names></name><name><surname>Weiskopf</surname><given-names>N</given-names></name><name><surname>Drysdale</surname><given-names>PM</given-names></name><name><surname>Robinson</surname><given-names>PA</given-names></name><name><surname>Friston</surname><given-names>KJ</given-names></name></person-group><article-title>Comparing hemodynamic models with DCM</article-title><source>NeuroImage</source><year>2007</year><volume>38</volume><issue>3</issue><fpage>387</fpage><lpage>401</lpage><pub-id pub-id-type="pmcid">PMC2636182</pub-id><pub-id pub-id-type="pmid">17884583</pub-id><pub-id pub-id-type="doi">10.1016/j.neuroimage.2007.07.040</pub-id></element-citation></ref><ref id="R52"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Thummerer</surname><given-names>T</given-names></name><name><surname>Mikelsons</surname><given-names>L</given-names></name></person-group><article-title>Eigen-informed NeuralODEs: Dealing with stability and convergence issues of NeuralODEs</article-title><source>arXiv:2302 10892 [cs]</source><year>2023</year><month>February</month><pub-id pub-id-type="doi">10.48550/arXiv.2302.10892</pub-id></element-citation></ref><ref id="R53"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tik</surname><given-names>M</given-names></name><name><surname>Sladky</surname><given-names>R</given-names></name><name><surname>Luft</surname><given-names>CDB</given-names></name><name><surname>Willinger</surname><given-names>D</given-names></name><name><surname>Hoffmann</surname><given-names>A</given-names></name><name><surname>Banissy</surname><given-names>MJ</given-names></name><name><surname>Bhattacharya</surname><given-names>J</given-names></name><name><surname>Windischberger</surname><given-names>C</given-names></name></person-group><article-title>Ultra-high-field fMRI insights on insight: Neural correlates of the Aha!-moment</article-title><source>Human Brain Mapping</source><year>2018</year><volume>39</volume><issue>8</issue><fpage>3241</fpage><lpage>3252</lpage><pub-id pub-id-type="pmcid">PMC6055807</pub-id><pub-id pub-id-type="pmid">29665228</pub-id><pub-id pub-id-type="doi">10.1002/hbm.24073</pub-id></element-citation></ref><ref id="R54"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Van der Aa</surname><given-names>N</given-names></name><name><surname>Ter Morsche</surname><given-names>H</given-names></name><name><surname>Mattheij</surname><given-names>R</given-names></name></person-group><article-title>Computation of eigenvalue and eigenvector derivatives for a general complex-valued eigensystem</article-title><source>The Electronic Journal of Linear Algebra</source><year>2007</year><volume>16</volume><pub-id pub-id-type="doi">10.13001/1081-3810.1203</pub-id></element-citation></ref><ref id="R55"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zarghami</surname><given-names>TS</given-names></name><name><surname>Zeidman</surname><given-names>P</given-names></name><name><surname>Razi</surname><given-names>A</given-names></name><name><surname>Bahrami</surname><given-names>F</given-names></name><name><surname>Hossein-Zadeh</surname><given-names>G-A</given-names></name></person-group><article-title>Dysconnection and cognition in schizophrenia: A spectral dynamic causal modeling study</article-title><source>Human Brain Mapping</source><year>2023</year><volume>44</volume><issue>7</issue><fpage>2873</fpage><lpage>2896</lpage><comment>[_eprint: <ext-link ext-link-type="uri" xlink:href="https://onlinelibrary.wiley.com/">https://onlinelibrary.wiley.com/</ext-link></comment><pub-id pub-id-type="pmcid">PMC10089110</pub-id><pub-id pub-id-type="pmid">36852654</pub-id><pub-id pub-id-type="doi">10.1002/hbm.26251</pub-id></element-citation></ref><ref id="R56"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zeidman</surname><given-names>P</given-names></name><name><surname>Friston</surname><given-names>K</given-names></name><name><surname>Parr</surname><given-names>T</given-names></name></person-group><article-title>A primer on Variational Laplace</article-title><year>2022</year><month>April</month><pub-id pub-id-type="pmcid">PMC10951963</pub-id><pub-id pub-id-type="pmid">37544417</pub-id><pub-id pub-id-type="doi">10.1016/j.neuroimage.2023.120310</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>Modular design for user-friendly circuit model assembly and data fitting.</title><p>Blue boxes on the right side in panels <bold>A</bold> to <bold>C</bold> show code snippets of the model assembly illustrated on the left. Note that the blue icon color just illustrates selection in the respective panel and carries no additional meaning. In <bold>A</bold> the definition of a model (also called block) is shown, in this case a Jansen-Rit model. Coding it is almost as simple as writing its differential equations. A user can pick and choose from a library of available models (panel <bold>B</bold> on the very left illustrates a few choices disambiguated by the small black icon on the top-right corner of the large icon. From top to bottom: Jensen-Rit model, linear neural mass model, and next generation neural mass model. These blocks don’t exhaust available models for neuronal dynamics in our software Neuroblox. A linear neural mass and two Jansen-Rit blocks are selected and connected to form a circuit. In addition to a model for the neuronal activity, we select (or define a new) measurement modality in <bold>C</bold>; in this particular case, we assume fMRI measurements and thus add a BOLD signal model. For LFP modeling lead-field equations are available in the package. Every region can in principle be described by a different neural mass model which substantially expands modeling power over the SPM12 toolbox, where regions are constrained to have dynamics of the same functional form. Lastly, a fitting procedure can be selected (<bold>E</bold>) and parameter values estimated (<bold>F</bold>) from acquired data (<bold>D</bold>). (Graphic in (<bold>D</bold>) adopted from CC-licensed graphic in <xref ref-type="bibr" rid="R47">Sidén, 2020</xref>)</p></caption><graphic xlink:href="EMS190447-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>Estimation of cross-spectral densities of simulated data.</title><p>Top row are examples of simulated signals, left are LFP measurements of two channels, and right are fMRI measurements of three regions. Plots in the bottom row are examples of simulated (lines) and estimated (dots) cross-spectral densities. We find a nearly perfect match for LFP signals, while fMRI signals show only a very rough agreement. The key difference is the nonlinear transformation of the neuronal signals through the hemodynamic response function; the LFP signals are only affected by a constant gain term that may vary for each channel. These simulations are based on the SPM12 scripts <italic>DEM_demo_induced_FMRI.m</italic> for fMRI signals and <italic>spm_csd_demo.m</italic> for LFP signals. For details about the LFP model see <xref ref-type="bibr" rid="R34">R. J. Moran, Jung, et al., 2011</xref></p></caption><graphic xlink:href="EMS190447-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>Julia implementation provides substantial speed improvements.</title><p>Graphs show the speed increase with respect to the MATLAB SPM12 (black) implementation in dependence on the number of regions. Notable speed improvement is already achieved by a plain Julia re-implementation of the SPM12 DCM (blue). Employing Automatic Differentiation (AD) results in an additional speed improvement of up to 10-fold for 10 regions (orange). When additionally employing symbolic computation with ModelingToolkit.jl (MTK) to ensure compositionality of model building, computation speed suffers by a negligible factor as can be appreciated by observing the green line. This stems from an overhead introduced by symbolic computation that is specific to the current setup of the used libraries. However, the gain in flexibility by computing symbolic derivatives of arbitrary models over hard-coding them each time a new model is employed outweighs the subtle speed decrease. The alternative of numerically computing the gradient, which is done with SPM12, increases computational load and can suffer from inaccuracies.</p></caption><graphic xlink:href="EMS190447-f003"/></fig><table-wrap id="T1" position="float" orientation="portrait"><label>Table 1</label><caption><p>Comparison of estimated parameter expectations between SPM12 and Julia for simulations of the canonical microcircuit, based on the SPM12 script <italic>spm_csd_demo.m</italic>. We compare with the implementation that makes use of symbolic computation and automatic differentiation.</p></caption><table frame="void" rules="groups"><thead><tr><th valign="top" align="left" style="border-right: 1px solid"/><th valign="top" align="left">SPM12</th><th valign="top" align="left">Julia</th><th valign="top" align="left">ground truth</th></tr></thead><tbody><tr><td valign="top" align="left" style="border-right: 1px solid"><italic>a</italic><sub><italic>dp</italic>→<italic>sp</italic></sub></td><td valign="top" align="left">0.4181</td><td valign="top" align="left">0.4181</td><td valign="top" align="left">1.0645</td></tr><tr><td valign="top" align="left" style="border-right: 1px solid"><italic>a</italic><sub><italic>dp</italic>→<italic>ii</italic></sub></td><td valign="top" align="left">10.7195</td><td valign="top" align="left">10.7195</td><td valign="top" align="left">20.0855</td></tr><tr><td valign="top" align="left" style="border-right: 1px solid"><italic>a</italic><sub><italic>sp</italic>→<italic>ss</italic></sub></td><td valign="top" align="left">0.9237</td><td valign="top" align="left">0.9237</td><td valign="top" align="left">1.6487</td></tr><tr><td valign="top" align="left" style="border-right: 1px solid"><italic>a</italic><sub><italic>sp</italic>→<italic>dp</italic></sub></td><td valign="top" align="left">1.1089</td><td valign="top" align="left">1.1089</td><td valign="top" align="left">4.4817</td></tr><tr><td valign="top" align="left" style="border-right: 1px solid"><italic>L</italic><sub>1</sub></td><td valign="top" align="left">0.9797</td><td valign="top" align="left">0.9799</td><td valign="top" align="left">1</td></tr><tr><td valign="top" align="left" style="border-right: 1px solid"><italic>L</italic><sub>2</sub></td><td valign="top" align="left">0.8718</td><td valign="top" align="left">0.8719</td><td valign="top" align="left">1</td></tr><tr><td valign="top" align="left" style="border-right: 1px solid"><italic>r</italic></td><td valign="top" align="left">1.0567</td><td valign="top" align="left">1.0567</td><td valign="top" align="left">1</td></tr><tr><td valign="top" align="left" style="border-right: 1px solid"><italic>F</italic></td><td valign="top" align="left">1817.1634</td><td valign="top" align="left">1817.1660</td><td valign="top" align="left">-</td></tr></tbody></table></table-wrap><table-wrap id="T2" position="float" orientation="portrait"><label>Table 2</label><caption><p>By changing the prior mean to either 0 or 1 for the respective effective connection parameters, we perform a demonstration of DCM model selection. <italic>F</italic><sub>0</sub> is the free energy of the prior density and <italic>F</italic> is the free energy after the optimization procedure, as is typically output by DCM. A higher value indicates a better model fit to the date. As above, we perform the simulation of the canonical microcircuit with the SPM12 script <italic>spm_csd_demo.m</italic>. The true underlying connection is given in the bottom row and corresponds to the highest free energy value.</p></caption><table frame="void" rules="groups"><thead><tr><th valign="top" align="left"><italic>a</italic><sub><italic>dp</italic>→<italic>sp</italic></sub></th><th valign="top" align="left"><italic>a</italic><sub><italic>dp</italic>→<italic>ii</italic></sub></th><th valign="top" align="left"><italic>a</italic><sub><italic>sp</italic>→<italic>ss</italic></sub></th><th valign="top" align="left" style="border-right: 1px solid"><italic>a</italic><sub><italic>sp</italic>→<italic>dp</italic></sub></th><th valign="top" align="left"><italic>F</italic> − <italic>F</italic><sub>0</sub></th></tr></thead><tbody><tr><td valign="top" align="left">0</td><td valign="top" align="left">1</td><td valign="top" align="left">1</td><td valign="top" align="left" style="border-right: 1px solid">1</td><td valign="top" align="left">67</td></tr><tr><td valign="top" align="left">1</td><td valign="top" align="left">0</td><td valign="top" align="left">1</td><td valign="top" align="left" style="border-right: 1px solid">1</td><td valign="top" align="left">137</td></tr><tr><td valign="top" align="left">1</td><td valign="top" align="left">1</td><td valign="top" align="left">0</td><td valign="top" align="left" style="border-right: 1px solid">1</td><td valign="top" align="left">203</td></tr><tr><td valign="top" align="left">1</td><td valign="top" align="left">1</td><td valign="top" align="left">1</td><td valign="top" align="left" style="border-right: 1px solid">0</td><td valign="top" align="left">206</td></tr><tr><td valign="top" align="left">1</td><td valign="top" align="left">1</td><td valign="top" align="left">1</td><td valign="top" align="left" style="border-right: 1px solid">1</td><td valign="top" align="left">211</td></tr></tbody></table></table-wrap></floats-group></article>