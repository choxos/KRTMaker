<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS189017</article-id><article-id pub-id-type="doi">10.1101/2023.09.29.560213</article-id><article-id pub-id-type="archive">PPR734977</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title><italic>CellPie</italic>: a fast spatial transcriptomics topic discovery method via joint factorization of gene expression and imaging data</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes"><name><surname>Georgaka</surname><given-names>Sokratia</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Morgans</surname><given-names>William Geraint</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Zhao</surname><given-names>Qian</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Martinez</surname><given-names>Diego Sanchez</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Ali</surname><given-names>Amin</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Ghafoor</surname><given-names>Mohamed</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Baker</surname><given-names>Syed-Murtuza</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Bristow</surname><given-names>Robert</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Iqbal</surname><given-names>Mudassar</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><contrib contrib-type="author"><name><surname>Rattray</surname><given-names>Magnus</given-names></name><xref ref-type="aff" rid="A1">1</xref></contrib><aff id="A1"><label>1</label>Division of Informatics, Imaging and Data Sciences, Faculty of Biology, Medicine and Health, University of Manchester, Manchester M13 9PL, UK</aff><aff id="A2"><label>2</label>Cancer Research UK Manchester Institute, Manchester</aff><aff id="A3"><label>3</label>The Christie NHS Foundation Trust, Manchester</aff></contrib-group><author-notes><corresp id="CR1"><bold>Contact</bold> <email>sokratia.georgaka@manchester.ac.uk</email></corresp></author-notes><pub-date pub-type="nihms-submitted"><day>04</day><month>10</month><year>2023</year></pub-date><pub-date pub-type="preprint"><day>02</day><month>10</month><year>2023</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 International license</ext-link>.</license-p></license></permissions><abstract><sec id="S1"><title>Motivation</title><p id="P1">Spatially resolved transcriptomics has enabled the study of expression of genes within tissues while retaining their spatial identity. The lack of single-cell resolution for most of the current high-throughput spatial transcriptomics technologies led to the development of <italic>in-silico</italic> methods, to disentangle the spatial profiles of individual cell-types. However, most current approaches ignore useful information from associated imaging data that can help to better resolve cell-types or spatial domains.</p></sec><sec id="S2"><title>Results</title><p id="P2">We present <italic>CellPie</italic>, a fast, reference-free topic modelling method, based on joint non-negative matrix factorisation between spatial RNA transcripts and histological or molecular imaging features. This synergy of the two modalities can lead to improved single-cell deconvolution and spatial clustering. We assessed <italic>CellPie</italic> in two different tissues and imaging settings, showing an improved accuracy against published deconvolution and clustering methods. In addition, in terms of computational efficiency, <italic>CellPie</italic> outperforms all tested deconvolution methods by at least two orders of magnitude, without the use of GPUs.</p></sec><sec id="S3"><title>Availability</title><p id="P3"><ext-link ext-link-type="uri" xlink:href="https://github.com/ManchesterBioinference/CellPie">https://github.com/ManchesterBioinference/CellPie</ext-link></p></sec></abstract><kwd-group><kwd>Spatial transcriptomics</kwd><kwd>Joint non-negative matrix factorisation</kwd><kwd>data integration</kwd><kwd>deconvolution</kwd></kwd-group></article-meta></front><body><sec id="S4" sec-type="intro"><title>Introduction</title><p id="P4">In multi-cellular organisms, tissues are complex systems composed of millions of cells, which constitute the building blocks of whole organs. Within tissues, cells vary in type and activity, and their development and function are influenced by interactions with their surroundings. Therefore, dissecting spatial cellular organisation and heterogeneity within the tissue is important for understanding normal tissue function, as well as disease, which often have spatial origins (<xref ref-type="bibr" rid="R1">1</xref>).</p><p id="P5">Cutting-edge technologies, such as single-cell RNA sequencing (scRNA-seq), achieve high-throughput and high-resolution gene expression profiles, which provide us with a powerful insight into the characterisation of the heterogeneity at the transcriptomic level (<xref ref-type="bibr" rid="R2">2</xref>, <xref ref-type="bibr" rid="R3">3</xref>). However, due to tissue dissociation, these methods are unable to retain the spatial context of the molecules within the tissue. Array-based spatially resolved transcriptomics methods, such as spatial transcriptomics (ST) (<xref ref-type="bibr" rid="R4">4</xref>), which is commercially available as Visium by 10x Genomics, and Slide-seq (<xref ref-type="bibr" rid="R5">5</xref>) (Slide-seq V2), allow for molecular profiling while retaining the spatial information of the tissue, at different resolution (<xref ref-type="bibr" rid="R6">6</xref>, <xref ref-type="bibr" rid="R7">7</xref>). The barcoded Slide-seq beads (‘pucks’) provide near single-cell spatial resolution of 10<italic>µm</italic> while Visium barcoded spots come with a coarser resolution of 55<italic>µm</italic>. This means that, depending on the tissue density, each bead/spot is capturing 2 − 3 cells for Slide-seq or around 10 cells for Visium.</p><p id="P6">Disentangling the spatial cell-type composition of each barcoded spot is a key computational challenge in spatial tran-scriptomics data analysis. Current deconvolution methods are divided between reference-based and reference-free methods. Reference-based deconvolution methods, such as cell2location (<xref ref-type="bibr" rid="R8">8</xref>), stereoscope (<xref ref-type="bibr" rid="R9">9</xref>), SPOTlight (<xref ref-type="bibr" rid="R10">10</xref>) and DestVI (<xref ref-type="bibr" rid="R11">11</xref>) require single-cell data, ideally from the same tissue, which is not always available. Alternatively there are reference-free deconvolution methods such as stDecon-volve (<xref ref-type="bibr" rid="R12">12</xref>).</p><p id="P7">Another important limitation of both reference-based and reference-free deconvolution methods is that they solely rely on spot-level gene expression count data, failing to take into account any morphological image features already available through paired histology images. These image-derived features could lead to more accurate deconvolution estimates. A recent Bayesian deconvolution method, GIST (<xref ref-type="bibr" rid="R13">13</xref>), attempts to incorporate a cell-type specific informative image-derived prior of specific cell-type abundance estimates. However, GIST does not explicitly use morphological image features extracted from paired histopathology hematoxylin and eosin (H&amp;E) images. Moreover, the computational burden of the aforementioned methods is typically high and in some instances GPUs are essential.</p><p id="P8">To address these limitations, we present <italic>CellPie</italic>, a flexible and fast reference-free deconvolution tool based on un-supervised multi-modal Non-negative Matrix Factorisation (NMF). NMF-based methods have become popular in the single-cell genomics field because they can be used to discover interpretable sparse features from high-dimensional data. NMF has previously been applied to ST data via a spatially aware model with a Gaussian process prior over the factors in (<xref ref-type="bibr" rid="R14">14</xref>, <xref ref-type="bibr" rid="R15">15</xref>).</p><p id="P9"><italic>CellPie</italic> jointly models spatial molecular data and paired his-tological or molecular imaging features, in a simple and computationally efficient way. The output of <italic>CellPie</italic> is a spatial map of spot-wise cell-type abundances (topics) and topic-specific feature (gene) scores which can be used for topic annotation and downstream analysis (see <xref ref-type="fig" rid="F1">Fig. 1</xref>).</p><p id="P10">We evaluated the ability of <italic>CellPie</italic> to provide a spatial map of cell-types in a coronal section of an adult mouse brain as well as in a human invasive prostate carcinoma sample from Visium platform. Moreover, in the second validation, we demonstrate that by clustering the inferred topic vectors (cell-type proportions) from <italic>CellPie</italic>, we achieve more precise spatial clusters compared to other established clustering methods.</p></sec><sec id="S5" sec-type="materials | methods"><title>Materials and methods</title><sec id="S6"><title>Joint Non-negative Matrix Factorisation</title><p id="P11"><italic>CellPie</italic> employs a scalable NMF-based topic modelling approach, which offers an unsupervised joint, low-dimensional representation of multiple modalities. Our approach builds on efficient single matrix factorisation scheme proposed in (<xref ref-type="bibr" rid="R16">16</xref>) which has been recently developed for joint factorisation of multi-omics data (intNMF (<xref ref-type="bibr" rid="R17">17</xref>)). Here, we adapt the method to jointly factorise spatial gene expression and histology/molecular imaging data. Compared to other decomposition methods, such as Principal Component Analysis (PCA) (<xref ref-type="bibr" rid="R18">18</xref>), the element-wise non-negativity constraint of NMF allows for an easier and more intuitive interpretation of the resulting lower rank factors.</p><p id="P12">The joint factorisation problem for spatial gene expression and image features data is formulated (as in intNMF) as follows:</p><p id="P13">Given two non-negative input matrices <italic>Y</italic><sub>rna</sub> ∈ ℝ<sub>+</sub><sup><italic>m×n</italic></sup> and <italic>Y</italic><sub>img</sub> ∈ ℝ<sub>+</sub><sup><italic>m×f</italic></sup> where <italic>m</italic> is the number of spatial locations (spots), <italic>n</italic> is the number of genes and <italic>f</italic> the number of image features, building on the intNMF formulation, <italic>CellPie</italic> seeks for a common non-negative matrix <italic>W</italic> ∈ ℝ<sub>+</sub><sup><italic>m×k</italic></sup> and two individual non-negative <italic>H</italic><sub>rna</sub> ∈ R<sub>+</sub><sup><italic>k×n</italic></sup> and <italic>H</italic><sub>img</sub> ∈ ℝ<sub>+</sub><sup><italic>k×f</italic></sup> matrices, such that: <disp-formula id="FD1"><mml:math id="M1"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mtext>rna</mml:mtext></mml:mrow></mml:msub><mml:mo>≈</mml:mo><mml:mi>W</mml:mi><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mtext>rna</mml:mtext><mml:mo>,</mml:mo></mml:mrow></mml:msub></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mtext>img</mml:mtext></mml:mrow></mml:msub><mml:mo>≈</mml:mo><mml:mi>W</mml:mi><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mtext>img</mml:mtext></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable><mml:mo>,</mml:mo></mml:math></disp-formula></p><p id="P14">for gene expression counts and image feature data respectively. <italic>k &lt; m, n, f</italic> is an integer number, which represents the number of topics and must be specified <italic>a priori</italic>.</p><p id="P15">In <italic>CellPie</italic>, each spot in the gene expression matrix is normalised by the total counts over all genes.</p><p id="P16">The factors <italic>W</italic>, <italic>H</italic><sub>rna</sub> and <italic>H</italic><sub>img</sub> are calculated by solving the following optimisation problem: <disp-formula id="FD2"><mml:math id="M2"><mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msub><mml:mi>min</mml:mi><mml:mrow><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mtext>rna</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mtext>img</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mi>α</mml:mi><mml:msubsup><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mtext>rna</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>W</mml:mi><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mtext>rna</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mo>‖</mml:mo></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo>−</mml:mo><mml:mi>α</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mtext>img</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>W</mml:mi><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mtext>img</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mo>‖</mml:mo></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mtext>s.t</mml:mtext><mml:mspace width="0.2em"/><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mtext>rna</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mtext>img</mml:mtext></mml:mrow></mml:msub><mml:mo>≥</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="0.2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> where the parameter <italic>α</italic> assigns a weight to the cost function of each modality (default is set to 1.0 so that each modality is equally weighted) and ∥·∥<sub><italic>F</italic></sub> is the Frobenius norm. The above non-convex optimisation problem is reduced to an alternating pair of convex optimisations through iterative updates. The accelerated hierarchical least squares (acc-HALS) algorithm (<xref ref-type="bibr" rid="R16">16</xref>) is adapted to jointly factorise two matrices, see (<xref ref-type="bibr" rid="R17">17</xref>) for details.</p><p id="P17">The image-based features (<italic>Y</italic><sub>img</sub>) are extracted from H&amp;E or molecule-based (e.g. immunofluorescence) images using <italic>Squidpy</italic> (<xref ref-type="bibr" rid="R19">19</xref>). <italic>Squidpy</italic> offers a variety of functions for image feature extraction, including <italic>summary, histogram</italic> and <italic>texture</italic>. Specifically, image features are calculated for each spatial location (Visium spot) resulting in a <italic>m</italic> × <italic>f</italic> feature matrix. <italic>CellPie</italic> by default uses <italic>histogram</italic> features for the joint factorisation, however there is an option for a user-defined matrix of image features. Spot-level pixel intensity features (bin-counts) are calculated for each image channel, over the whole image range, reflecting both the tissue architecture as well as cell abundances (see overview of <italic>CellPie</italic> approach in <xref ref-type="fig" rid="F1">Fig. 1</xref>).</p></sec><sec id="S7"><title>Model Selection</title><p id="P18">To help the user selecting a representative number of topics, <italic>k, CellPie</italic> implements model selection based on the elbow/knee point of the loss as function of topic number (using the “Kneedle” algorithm) (<xref ref-type="bibr" rid="R20">20</xref>). However, it is worth pointing out that prior biological knowledge of the tissue is always advantageous and, for optimal results, the rank, <italic>k</italic>, should be selected in conjunction with this prior knowledge (if available).</p></sec><sec id="S8"><title>Initialisation</title><p id="P19">Due to the iterative nature of the intNMF algorithm, initialisation of the <italic>W</italic>, <italic>H</italic><sub>rna</sub> and <italic>H</italic><sub>img</sub> factors is required. Good initial values are essential to guarantee a successful NMF decomposition. Various initialisation methods have been proposed for NMF, including random and non-random strategies. Using random initialisation can lead to convergence at local minima, making it essential to perform multiple restarts to find the best initialisation. An effective, non-random strategy, proposed in (<xref ref-type="bibr" rid="R21">21</xref>), is the Non-negative Double Singular Value Decomposition (NNDSVD). This algorithm uses two Singular Value Decomposition (SVD) processes and has been demonstrated to rapidly reduce the approximation error. <italic>CellPie</italic> uses NNDSVD as the default initialisation method. Initialisation methods based on clustering (k-means, Fuzzy C-means or Hierarchical) are also implemented in <italic>CellPie</italic> although, similar to random initialisation methods, clustering methods usually require multiple restarts.</p></sec><sec id="S9"><title>Datasets</title><p id="P20">Most deconvolution methods use synthetic ST data for validation, as the ground-truth is known for this data. However, it is not obvious how to generate realistic synthetic ST data with paired with synthetic image features, as required in this context. Therefore, to assess the performance of <italic>CellPie</italic>, two benchmarking cases are considered. In the first instance, we use a publicly available 10x Visium adult mouse brain dataset with immunofluorescence (IF) staining. This dataset was chosen because the IF staining of neuronal and glial cells, can serve as ground-truth, facilitating quantitative comparison among various published deconvolution methods. The second validation uses another publicly available 10x Genomics Visium dataset of human invasive prostate carcinoma. In this case, the ground-truth is established through annotations by a pathologist. We evaluate the capability of <italic>CellPie</italic> to find topics that resemble the areas annotated by the pathologist and to pinpoint topic specific marker genes.</p></sec><sec id="S10"><title>Parameter settings for competing methods</title><p id="P21"><bold>stDeconvolve</bold> is a reference-free deconvolution method based on latent Dirichlet allocation (LDA). We execute <italic>stDeconvolve</italic> with the default parameters: ‘cleancounts’ with min.lib.size 100 and min.reads 10, ‘restrictCorpus’ with removeAbove 1, removeBelow 0.05 and nTopOD 1000. Then we ran the fitLDA and optLDA function with 17 topics. Finally, we filtered out cell-types using the ‘getBetaTheta’ with perc.filt 0.01 and betaScale 1000. Since <italic>stDeconvolve</italic> is a reference-free deconvolution method, similarly to <italic>CellPie</italic>, we seek the inferred topics that best correlate with the available ground-truth.</p><p id="P22"><bold>Stereoscope</bold> is a reference-based deconvolution method which uses probabilistic inference based on negative binomial distribution to infer cell-type proportions. We ran <italic>Stereoscope</italic> on GPUs with the default settings:’max_epochs’ 100 for ‘RNAStereoscope’ and ‘max_epochs’ 2000 for ‘Spatial-Stereoscope’ functions.</p><p id="P23"><bold>Cell2Location</bold> is another reference-based spatial method based on a Bayesian model where absolute and relative abundances of cell-types are estimated by linearly decomposing the spatial gene expression matrix into a set of pre-estimated single-cell signatures. We first computed the average gene expression in the single-cell reference dataset (signature) using ‘compute_cluster_averages’ function. Then we ran Cell2Location using GPUs with the following settings: ‘N_cells_per_location’ 10, detection_alpha 20, max_epochs 2000, ‘train_size’ 1. We extracted the ‘q05_cell_abundance_w_sf’ abundances.</p><p id="P24">To estimate the Spearman correlation between the ground-truth and the inferred proportions, for both <bold>Stereoscope</bold> and <bold>Cell2Location</bold> we aggregated all the neuronal and glial sub-type proportions/abundances into one neuronal and one glial proportion/abundance data-frame.</p><p id="P25"><bold>SpaGCN</bold> (<xref ref-type="bibr" rid="R22">22</xref>) is a spatial transcriptomics downstream analysis tool which uses a graph convolutional network to integrate gene expression, spatial information and histology. We used <bold>SpaGCN</bold> for clustering in theinvasive prostate carcinoma dataset. We executed <bold>SpaGCN</bold> with the default settings: For the adjacent matrix, <italic>s</italic> = 1 and <italic>b</italic> = 49. Hyperparameter <italic>p</italic> = 0.5, ‘search_l’ function with start 0.01, end 1000, top 0.01 and max_run 100. For clustering, we used n_clusters 5 based on which the recommended res is 0.3. <bold>stLearn</bold> (<xref ref-type="bibr" rid="R23">23</xref>) is another tool for spatial transcriptomics downstream analysis which integrates spatial location, image and gene expression information using graph-based clustering. We used <bold>stLearn</bold> for clustering of the invasive prostate carcinoma dataset. We ran <bold>stLearn</bold>’s preprocessing, tilling and clustering analysis with all the arguments following the ‘stSME clustering’ tutorial provided in stlearn.readthedocs.io.</p></sec></sec><sec id="S11" sec-type="results"><title>Results</title><sec id="S12"><title>Coronal section of mouse brain with IF staining</title><p id="P26">To benchmark the performance of <italic>CellPie</italic> against other published deconvolution methods (reference-free and reference-based), a publicly available 10x Genomics Visium dataset of a coronal section of an adult mouse brain was used (<xref ref-type="bibr" rid="R24">24</xref>). Immunofluorescence staining was performed on the tissue section, against anti-NeuN and GFAP antibodies (and DAPI), which represent neuronal and glial specific protein markers, respectively (<xref ref-type="fig" rid="F2">Fig. 2A</xref>). To derive an independent ground-truth, spot-wise average pixel intensity values were extracted for each of the three channels in the immunofluorescence image (<xref ref-type="fig" rid="F2">Fig. 2B</xref>, <xref ref-type="fig" rid="F2">Fig. 2C</xref>), using <italic>squidpy</italic>.</p><p id="P27">To emphasize the significance of integrating imaging fea-tures, we executed <italic>CellPie</italic> with <italic>k</italic> = 13 topics over a range of weights (<italic>α</italic> = 0, 0.4, 1.0, 1.6, 2.0), with <italic>α</italic> = 0 corresponding to image only and <italic>α</italic> = 2 RNA only. These topics aim at discerning various glial and neuronal sub-types, such as astrocytes, oligodendocytes, microglial, excitatory and inhibitory neurons and more (<xref ref-type="supplementary-material" rid="SD1">supp Fig. 1</xref>). For a comprehensive analysis, we aggregated all topics corresponding to glial and neuronal cell-types. This was achieved by combining those topics that demonstrated the highest Spearman correlation in relation to the ground-truth (<xref ref-type="fig" rid="F2">Fig. 2B</xref>,<xref ref-type="fig" rid="F2">Fig. 2C</xref>).</p><p id="P28"><xref ref-type="fig" rid="F2">Fig. 2D</xref> shows a comparison between <italic>CellPie</italic> and other published deconvolution methods, for a range of <italic>CellPie</italic> image/gene expression weights. When equal modality weight is used (<italic>α</italic> = 1), <italic>CellPie</italic> achieves the best performance amongst the deconvolution methods benchmarked in this study for both neuronal (Spearman correlation 0.82) and glial (Spearman correlation 0.78) cell-types. In the standard single modality NMF limit (<italic>α</italic> = 2) where only spatial transcriptomics data are considered, the Spearman correlation is reduced to 0.68 and 0.55 for neurons and glia, respectively.</p><p id="P29"><xref ref-type="fig" rid="F3">Figure 3A</xref> illustrates the topics that are most correlated with glial (topics deconv_2 and deconv_4) and neuronal cell-types (topics deconv_3, deconv_7). Among <italic>CellPie</italic>’s outputs is a gene loading matrix, of dimension topics by genes, with a score representing importance of the genes within each topic. This matrix, in conjunction with a single-cell mouse brain cell signature dataset (<xref ref-type="bibr" rid="R8">8</xref>) are input into the scanpy.tl.score_genes function from the Scanpy package (<xref ref-type="bibr" rid="R25">25</xref>, <xref ref-type="bibr" rid="R26">26</xref>) (with default parameters). This function requires the input of marker genes. To find marker genes for the cell-types present in the mouse brain single-cell dataset, we perform differential gene expression using the ‘Wilcoxon’ method. The output is a ranking of cell-types with an associated score (the difference of the mean expression of a set of genes and the mean expression of the signature genes) that could be utilised for topic interpretation and downstream analysis. A heatmap of the ranked cell-types for all the topics that are correlated to glia and neurons is shown in <xref ref-type="fig" rid="F2">Fig. 2B</xref>. The expressed cell-types are in keeping with their corresponding topics.</p><p id="P30">In order to verify whether the topics obtained in the mouse brain have biological significance, we used the top 100 marker genes of each topic (<italic>CellPie</italic>’s gene loading matrix) to perform GO enrichment analysis. The results were consistent with our expectations for cell-type distribution. For example, in Topic 5 and Topic 7, the enriched terms predominantly focus on biological processes related to aerobic respiration and energy metabolism (<xref ref-type="fig" rid="F2">Fig. 2C</xref>). This aligns with the stronger dependency of neurons on aerobic respiration, as previous studies have shown that about eighty per-cent of energy is consumed by neurons to maintain action potentials (<xref ref-type="bibr" rid="R27">27</xref>). This may suggest that the regions associated with these topics contain many active neurons. The formation and maintenance of synapses depend on interactions between neurons and glial cells (<xref ref-type="bibr" rid="R28">28</xref>). Topic 8 includes terms such as “Signal Release From Synapse” and “Neurotransmitter Secretion” implying the presence of a substantial number of synaptic structures in the corresponding locations. Topic 2 is enriched in terms related to “Myelination” and “Neuron Projection Development”, Topic 3 is associated with Calcium signaling, and Topic 4 contains terms related to synaptic plasticity, aerobic respiration, and biosynthetic processes, which is consistent with the role of the glia cells in the formation and establishment of neuronal axons (<xref ref-type="bibr" rid="R28">28</xref>).</p><p id="P31"><italic>CellPie</italic>’s computational efficiency is an important feature. On a Macbook Pro with 2.3GHz Quad-Core Intel Core i7 and 16GB memory, the joint NMF executed in only 23<italic>s</italic> for this dataset. This performance facilitates rapid, GPU-free deconvolution, while it provides flexibility for repeated model assessments.</p></sec><sec id="S13"><title>Human prostate cancer data: CellPie topics separate Gleason 3 and Gleason 4 score regions</title><p id="P32">For our second validation, we use another publicly available 10x Visium data, this time derived from a human prostate sample with adenocarcinoma (<xref ref-type="bibr" rid="R29">29</xref>). 10x Genomics supplies a paired H&amp;E image (<xref ref-type="fig" rid="F4">Fig. 4A</xref>) that has been annotated by a pathologist. However, to achieve finer granularity of the invasive carcinoma region, we re-annotated the image (<xref ref-type="fig" rid="F4">Fig. 4B</xref>). Consequently, the entire tumour region was annotated using the Gleason scoring system, labelled as Gleason 3 and Gleason 4. This enables us to evaluate if <italic>CellPie</italic> can identify topics that correspond to these specific Gleason areas.</p><p id="P33">While image evaluation using IF is relatively straightforward as the extraction of information is done by considering fluorescence intensities, H&amp;E images require the interpretation of colour and tissue morphology. In prostate, two main lineages that are biologically and architecturally different can be seen: the stromal compartment and the epithelial compartment. The stroma is composed of fibroblasts, smooth muscle, nerves, and blood vessels in diverse proportions (<xref ref-type="bibr" rid="R30">30</xref>, <xref ref-type="bibr" rid="R31">31</xref>). Prostate carcinoma arises from the glandular epithelial compartment and, unlike other organs, is not graded by individual cells differentiation but mainly by its architectural features using the Gleason grading, from 1 to 5. Due to poor re-producibility and lack of biological support, Gleason 1 and 2 are not reported anymore. Gleason 3 cancers comprise the most differentiated adenocarcinoma, consisting of discrete glandular units with varying sizes and shapes (<xref ref-type="bibr" rid="R32">32</xref>). Individual tumor acini have smooth, typically circular edges and intact basement membranes. In contrast, Gleason 4 cancers are composed of poorly formed glandular units with indistinct borders, fused glands, and irregularly infiltrating stroma (<xref ref-type="bibr" rid="R32">32</xref>, <xref ref-type="bibr" rid="R33">33</xref>). Intuitively, Gleason 4 tumors exhibit higher degrees of differentiation, increased cancer progression, and therefore stronger prognostic correlations.</p><p id="P34">The optimal number of topics, based on model selection, was found to be <italic>k</italic> = 11 (<xref ref-type="fig" rid="F4">Fig. 4C</xref>, <xref ref-type="supplementary-material" rid="SD1">supp. Fig. 3</xref>). In addition, <italic>CellPie</italic> was executed across a range of modality weights <italic>α</italic> spanning from 0 (image only) to 2 (RNA only). For each specific modality weight, we compared the resulting topics against the pathologist’s annotated regions (ground-truth).</p><p id="P35">This comparison was achieved by performing k-means clustering on the topic proportions, setting the number of clusters to 5. To assess the performance, we employed three performance metrics: Fowlkes-Mallows, Adjusted Rand Index and Mutual Information scores, as illustrated in <xref ref-type="fig" rid="F4">Fig. 4D</xref>. According to this figure, peak performance is observed at a modality weight of <italic>α</italic> = 1.7. However, a decline in accuracy is seen at <italic>α</italic> = 2.0. This latter weight is equivalent to the standard single NMF considering only the spatial tramscriptomics data. This highlights the significance of the joint modelling of both image features and transcriptomics data.</p><p id="P36"><xref ref-type="fig" rid="F4">Fig. 4C</xref> shows the relationship between the ground-truth and the <italic>k-means</italic> clustering of <italic>CellPie</italic>’s topics (<xref ref-type="fig" rid="F4">Fig. 4B</xref>), using a normalised crosstab heatmap. According to the heatmap, cluster 0 is mostly associated with the Gleason 3 region, while the Gleason 4 region is linked to cluster 3. Cluster 1 is a combination of the Connective tissue, Vascular and Neural regions. Cluster 2 is mainly connected to the Normal glands and Neural areas, while cluster 4 depicts Immune cells, PIN and vascular regions.</p><p id="P37">We compared the clustering results of <italic>CellPie</italic> using both the optimal weight (<italic>α</italic> = 1.7 - kmeans_CellPie_int) and the equivalent to single NMF weight (<italic>α</italic> = 2.0 - kmeans_CellPie_0). There results were then benchmarked against the <italic>k-means</italic> clustering on gene expression data (within the PCA space, with 50 components) and against two published spatial transcriptomics-specific clustering methods, namely, <italic>SpaGCN</italic> and <italic>stLearn</italic>. A qualitative comparison is shown in <xref ref-type="fig" rid="F4">Fig. 4D</xref> and <xref ref-type="fig" rid="F5">Fig. 5A</xref>, where <italic>CellPie, stlearn</italic> and <italic>k-means</italic> capture both the connective tissue and normal glands areas, while in <italic>SpaGCN</italic>, these areas are shown as a mixture. <italic>stlearn</italic> is the only one which captures the nerve area as an individual cluster. However, when it comes to distinguishing between the Gleason 3 and Gleason 4 areas, none of the established methods are effective. In constrast, <italic>CellPie</italic> depicts these tumour regions as two separate, distinct clusters.</p><p id="P38"><xref ref-type="fig" rid="F5">Figure 5B</xref> presents the Adjusted Rand Index (ARI) for the methods previously mentioned, offering a comparison of their overall clustering accuracy. <italic>stlearn</italic> exhibits better performance compared to <italic>CellPie</italic> in terms of ARI. However, when narrowing the focus to just the Gleason 3 and Gleason 4 areas, <italic>CellPie</italic> outperforms all the other methods (<xref ref-type="fig" rid="F5">Fig. 5C</xref>), based on the precision metric. This is defined as the number of spots correctly predicted as Gleason 3 or Gleason 4 by the method over the total number of spots predicted as being in the union of Gleason 3 and Gleason 4.</p><p id="P39">To further annotate the topics with cell-types, we interrogate the <italic>CellPie</italic>’s gene loading matrix in conjunction with a modified cell signature obtained from (<xref ref-type="bibr" rid="R34">34</xref>), with the addition of markers for B-cells (<xref ref-type="bibr" rid="R35">35</xref>) and neurons (using scanpy.tl.score_genes function). In <xref ref-type="fig" rid="F6">Fig. 6B</xref> and <xref ref-type="fig" rid="F6">Fig. 6C</xref>, the topic interpretation of the 10x visium invasive prostate cancer is shown. For example, topics deconv_0, deconv_2 and deconv_6 were in keeping with the epithelia compartment based on their score. Deconv_0 represents the glandular area of the prostate covering both benign (luminal epithelial - LE) and malignant (tumour) area, with high expression of <italic>KLK2, KLK3</italic> and <italic>ACPP</italic>, genes associated with prostate glandular epithelium marker. The top 3 genes in deconv_2 (<italic>MSMB, ACPP</italic> and <italic>AZGP1</italic> usually expressed in benign glandular tissue) and deconv_6 (<italic>PLA2G2A, SPON2, KLK2</italic> and <italic>KLK3</italic> usually expressed in prostate cancer) showed that the separation between benign and malignant tissue respectively were indeed in keeping with the pathologist’s annotation. Within the stromal compartment, we showed that smooth muscle cells corresponded with deconv_1. This is in keeping with the high gene expression of <italic>MYL9, ACTG2, ACTA2</italic> and <italic>TAGLN</italic>, all involved in muscle contraction.</p><p id="P40">To further validate the biological significance of the regions identified by our method at the molecular level, we utilized Gene Ontology (GO) analysis for gene identification within the 11 topics (<xref ref-type="fig" rid="F6">Fig. 6D</xref>).</p><p id="P41">Topic 6 (deconv_6) specifically exhibits high expression in Gleason 3 rather than Gleason 4. Apart from genes related to the androgen receptor (AR) pathway which is enriched in the prostatic epithelial cells, it encompasses various biological processes associated with differentiation features, such as protein translation as well as lipidic metabolism signal to prostate epithelium. Interestingly, the term “Low-Density Lipoprotein Particle Remodeling” is consistent with the recent study which found the interaction of PRSS2 with a receptor (low-density lipoprotein-related receptor protein 1) stimulated prostate tumour growth and progression (<xref ref-type="bibr" rid="R36">36</xref>). Conversely, Topic 0 (deconv_0), while widely distributed in cancerous tissues, shows higher expression in Gleason 4. The enriched genes in this topic, aside from the AR pathway, are predominantly involved in RNA and protein processing, including alternative splicing and protein folding. These two regulatory processes are widely considered to play crucial roles in the development of prostate cancer, such as alternative splicing of AR gene (<xref ref-type="bibr" rid="R37">37</xref>) and protein folding facilitated by HSPs (heatshock proteins) (<xref ref-type="bibr" rid="R38">38</xref>), while lacking differentiation characteristics.</p><p id="P42">Furthermore, in Topic 1 (deconv_1), which exhibits high expression in connective tissue, the enriched GO terms include “Homotypic cell-cell adhesion”, “Supramolecular Fiber Organization”, and “Actin Filament Organization”. These terms highlight smooth muscle and collagen fibre intra and extracellular organization, which are key components of the connective tissue found in the prostate. Topic 2 (deconv_2), which shows high expression in adjacent glandular tissue, lacks enrichment in the AR signaling pathway. Instead, it is enriched in genes related to steroid hormone response and stress signals regulating cell apoptosis, implying a potential balance between differentiation and microenvironmental changes induced by cell-cell communication.</p></sec></sec><sec id="S14" sec-type="conclusions"><title>Conclusion</title><p id="P43">In this paper, we presented <italic>CellPie</italic>, a method based on a rapid joint NMF framework. <italic>CellPie</italic> integrates spatial gene expression counts data and molecular or histological imaging features. This integration helps disentangling multi-cellular spatial transcriptomics data and aids in the identification of distinct spatial compartments. We evaluated <italic>CellPie</italic> using two distinct datasets derived from different species (mouse and human). These datasets are paired with different imaging settings (IF and H&amp;E), and encompass both healthy and diseased tissues. We demonstrated that, when benchmarked for deconvolution, <italic>CellPie</italic>’s accuracy surpassed that of other published spatial deconvolution methods. In the application to human prostate cancer data, <italic>CellPie</italic> emerged as the sole method capable of distinguishing between Gleason 3 and Gleason 4 tumour regions. Moreover, analysis of gene loading matrices for both our benchmark examples were in good agreement with the available literature. By adjusting the relative weight of transcriptomics and image data, we showed how jointly analysing both modalities provides enhanced performance over considering each one in isolation.</p><p id="P44"><italic>CellPie</italic> includes image features derived from the high resolution (‘hires’) Visium images, which have a resolution approximately at 2000 × 2000 pixels. There are also images available with even higher resolutions, e.g. 27000 × 25000 pixels. Leveraging these ultra-high resolution images might potentially lead to a better performance. However, feature extraction from such images using <italic>Squidpy</italic> proves to be com-putationally intense, requiring many hours and memory resources, thus limits <italic>CellPie</italic>’s performance.</p><p id="P45">One limitation to note is that <italic>CellPie</italic> does not explicitly model the spatial nature of the data, e.g. the neighbourhood relationships between spots. Hence, a spatially aware version of the joint NMF algorithm would be an interesting future direction. Furthermore, <italic>CellPie</italic> amd the intNMF algorithm (<xref ref-type="bibr" rid="R17">17</xref>), which <italic>CellPie</italic> is based on, could be extended to jointly factorise more than two matrices simultaneously. This enhancement would allow for integration of several omics datasets possesing a shared dimension (e.g. spatial proteomics).</p></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary material</label><media xlink:href="EMS189017-supplement-Supplementary_material.pdf" mimetype="application" mime-subtype="pdf" id="d20aAdEbB" position="anchor"/></supplementary-material></sec></body><back><ack id="S15"><title>Acknowledgments</title><p>We thank Alkmini Damkou, a PhD student in Simons lab (TUM-NCB) for our fruitful discussions on Mouse Brain results.</p><sec id="S16"><title>Funding</title><p>MR and SG are supported by a Wellcome Trust award (204832/B/16/Z). SG and MI acknowledges funding from the University of Manchester’s Wellcome Institutional Strategic Support Fund (Wellcome ISSF) grant (204796/Z/16/Z).</p></sec></ack><sec id="S17" sec-type="data-availability"><title>Data availability</title><p id="P46">The <italic>CellPie</italic> code and the notebooks to reproduce the analysis are available as an open-source python package in <ext-link ext-link-type="uri" xlink:href="https://github.com/ManchesterBioinference/CellPie">https://github.com/ManchesterBioinference/CellPie</ext-link>. The prostate invasive carcinoma pathologist’s annotations are also available on that repo. All the data used in this paper is publicly available to download from 10x Genomics website (<xref ref-type="bibr" rid="R24">24</xref>, <xref ref-type="bibr" rid="R29">29</xref>).</p></sec><ref-list><ref id="R1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhuang</surname><given-names>Xiaowei</given-names></name></person-group><article-title>Spatially resolved single-cell genomics and transcriptomics by imaging</article-title><source>Nature methods</source><year>2021</year><volume>18</volume><issue>1</issue><fpage>18</fpage><lpage>22</lpage><pub-id pub-id-type="pmcid">PMC9805800</pub-id><pub-id pub-id-type="pmid">33408406</pub-id><pub-id pub-id-type="doi">10.1038/s41592-020-01037-8</pub-id></element-citation></ref><ref id="R2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>Xinmin</given-names></name><name><surname>Wang</surname><given-names>Cun-Yu</given-names></name></person-group><article-title>From bulk, single-cell to spatial rna sequencing</article-title><source>International Journal of Oral Science</source><year>2021</year><volume>13</volume><issue>1</issue><fpage>1</fpage><lpage>6</lpage><pub-id pub-id-type="pmcid">PMC8593179</pub-id><pub-id pub-id-type="pmid">34782601</pub-id><pub-id pub-id-type="doi">10.1038/s41368-021-00146-0</pub-id></element-citation></ref><ref id="R3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schier</surname><given-names>Alexander F</given-names></name></person-group><article-title>Single-cell biology: beyond the sum of its parts</article-title><source>Nature Methods</source><year>2020</year><volume>17</volume><issue>1</issue><fpage>17</fpage><lpage>20</lpage><pub-id pub-id-type="pmid">31907464</pub-id></element-citation></ref><ref id="R4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ståhl</surname><given-names>Patrik L</given-names></name><name><surname>Fredrik</surname><given-names>Salmén</given-names></name><name><surname>Vickovic</surname><given-names>Sanja</given-names></name><name><surname>Lundmark</surname><given-names>José</given-names></name><name><surname>Navarro</surname><given-names>Fernández</given-names></name><name><surname>Magnusson</surname><given-names>Jens</given-names></name><name><surname>Giacomello</surname><given-names>Stefania</given-names></name><name><surname>Michaela</surname><given-names>Asp</given-names></name><name><surname>Westholm</surname><given-names>Jakub O</given-names></name><name><surname>Huss</surname><given-names>Mikael</given-names></name><etal/></person-group><article-title>Visualization and analysis of gene expression in tissue sections by spatial transcriptomics</article-title><source>Science</source><year>2016</year><volume>353</volume><issue>6294</issue><fpage>78</fpage><lpage>82</lpage><pub-id pub-id-type="pmid">27365449</pub-id></element-citation></ref><ref id="R5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rodriques</surname><given-names>Samuel G</given-names></name><name><surname>Stickels</surname><given-names>Robert R</given-names></name><name><surname>Goeva</surname><given-names>Aleksandrina</given-names></name><name><surname>Martin</surname><given-names>Carly A</given-names></name><name><surname>Murray</surname><given-names>Evan</given-names></name><name><surname>Vanderburg</surname><given-names>Charles R</given-names></name><name><surname>Welch</surname><given-names>Joshua</given-names></name><name><surname>Chen</surname><given-names>Linlin M</given-names></name><name><surname>Chen</surname><given-names>Fei</given-names></name><name><surname>Macosko</surname><given-names>Evan Z</given-names></name></person-group><article-title>Slide-seq: A scalable technology for measuring genome-wide expression at high spatial resolution</article-title><source>Science</source><year>2019</year><volume>363</volume><issue>6434</issue><fpage>1463</fpage><lpage>1467</lpage><pub-id pub-id-type="pmcid">PMC6927209</pub-id><pub-id pub-id-type="pmid">30923225</pub-id><pub-id pub-id-type="doi">10.1126/science.aaw1219</pub-id></element-citation></ref><ref id="R6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Moses</surname><given-names>Lambda</given-names></name><name><surname>Pachter</surname><given-names>Lior</given-names></name></person-group><article-title>Museum of spatial transcriptomics</article-title><source>Nature Methods</source><year>2022</year><volume>19</volume><issue>5</issue><fpage>534</fpage><lpage>546</lpage><pub-id pub-id-type="pmid">35273392</pub-id></element-citation></ref><ref id="R7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Marx</surname><given-names>Vivien</given-names></name></person-group><article-title>Method of the year: spatially resolved transcriptomics</article-title><source>Nature methods</source><year>2021</year><volume>18</volume><issue>1</issue><fpage>9</fpage><lpage>14</lpage><pub-id pub-id-type="pmid">33408395</pub-id></element-citation></ref><ref id="R8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kleshchevnikov</surname><given-names>Vitalii</given-names></name><name><surname>Shmatko</surname><given-names>Artem</given-names></name><name><surname>Dann</surname><given-names>Emma</given-names></name><name><surname>Aivazidis</surname><given-names>Alexander</given-names></name><name><surname>King</surname><given-names>Hamish W</given-names></name><name><surname>Li</surname><given-names>Tong</given-names></name><name><surname>Elmentaite</surname><given-names>Rasa</given-names></name><name><surname>Lomakin</surname><given-names>Artem</given-names></name><name><surname>Kedlian</surname><given-names>Veronika</given-names></name><name><surname>Gayoso</surname><given-names>Adam</given-names></name><etal/></person-group><article-title>Cell2location maps fine-grained cell types in spatial transcriptomics</article-title><source>Nature biotechnology</source><year>2022</year><volume>40</volume><issue>5</issue><fpage>661</fpage><lpage>671</lpage><pub-id pub-id-type="pmid">35027729</pub-id></element-citation></ref><ref id="R9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Andersson</surname><given-names>Alma</given-names></name><name><surname>Joseph</surname><given-names>Bergenstråhle</given-names></name><name><surname>Asp</surname><given-names>Michaela</given-names></name><name><surname>Ludvig</surname><given-names>Bergenstråhle</given-names></name><name><surname>Jurek</surname><given-names>José</given-names></name><name><surname>Navarro</surname><given-names>Fernández</given-names></name><name><surname>Lundeberg</surname><given-names>Joakim</given-names></name></person-group><article-title>Single-cell and spatial transcriptomics enables probabilistic inference of cell type topography</article-title><source>Communications biology</source><year>2020</year><volume>3</volume><issue>1</issue><fpage>1</fpage><lpage>8</lpage><pub-id pub-id-type="pmcid">PMC7547664</pub-id><pub-id pub-id-type="pmid">33037292</pub-id><pub-id pub-id-type="doi">10.1038/s42003-020-01247-y</pub-id></element-citation></ref><ref id="R10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Elosua-Bayes</surname><given-names>Marc</given-names></name><name><surname>Nieto</surname><given-names>Paula</given-names></name><name><surname>Mereu</surname><given-names>Elisabetta</given-names></name><name><surname>Gut</surname><given-names>Ivo</given-names></name><name><surname>Heyn</surname><given-names>Holger</given-names></name></person-group><article-title>Spotlight: seeded nmf regression to deconvolute spatial transcriptomics spots with single-cell transcriptomes</article-title><source>Nucleic acids research</source><year>2021</year><volume>49</volume><issue>9</issue><fpage>e50</fpage><pub-id pub-id-type="pmcid">PMC8136778</pub-id><pub-id pub-id-type="pmid">33544846</pub-id><pub-id pub-id-type="doi">10.1093/nar/gkab043</pub-id></element-citation></ref><ref id="R11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lopez</surname><given-names>Romain</given-names></name><name><surname>Li</surname><given-names>Baoguo</given-names></name><name><surname>Keren-Shaul</surname><given-names>Hadas</given-names></name><name><surname>Boyeau</surname><given-names>Pierre</given-names></name><name><surname>Kedmi</surname><given-names>Merav</given-names></name><name><surname>Pilzer</surname><given-names>David</given-names></name><name><surname>Jelinski</surname><given-names>Adam</given-names></name><name><surname>Yofe</surname><given-names>Ido</given-names></name><name><surname>David</surname><given-names>Eyal</given-names></name><name><surname>Wagner</surname><given-names>Allon</given-names></name><etal/></person-group><article-title>Destvi identifies continuums of cell types in spatial transcriptomics data</article-title><source>Nature biotechnology</source><year>2022</year><fpage>1</fpage><lpage>10</lpage><pub-id pub-id-type="pmcid">PMC9756396</pub-id><pub-id pub-id-type="pmid">35449415</pub-id><pub-id pub-id-type="doi">10.1038/s41587-022-01272-8</pub-id></element-citation></ref><ref id="R12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Miller</surname><given-names>Brendan F</given-names></name><name><surname>Huang</surname><given-names>Feiyang</given-names></name><name><surname>Atta</surname><given-names>Lyla</given-names></name><name><surname>Sahoo</surname><given-names>Arpan</given-names></name><name><surname>Fan</surname><given-names>Jean</given-names></name></person-group><article-title>Reference-free cell type de-convolution of multi-cellular pixel-resolution spatially resolved transcriptomics data</article-title><source>Nature communications</source><year>2022</year><volume>13</volume><issue>1</issue><fpage>1</fpage><lpage>13</lpage><pub-id pub-id-type="pmcid">PMC9055051</pub-id><pub-id pub-id-type="pmid">35487922</pub-id><pub-id pub-id-type="doi">10.1038/s41467-022-30033-z</pub-id></element-citation></ref><ref id="R13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zubair</surname><given-names>Asif</given-names></name><name><surname>Chapple</surname><given-names>Richard H</given-names></name><name><surname>Natarajan</surname><given-names>Sivaraman</given-names></name><name><surname>Wright</surname><given-names>William C</given-names></name><name><surname>Pan</surname><given-names>Min</given-names></name><name><surname>Lee</surname><given-names>Hyeong-Min</given-names></name><name><surname>Tillman</surname><given-names>Heather</given-names></name><name><surname>Easton</surname><given-names>John</given-names></name><name><surname>Geeleher</surname><given-names>Paul</given-names></name></person-group><article-title>Cell type identification in spatial transcriptomics data can be improved by leveraging cell-type-informative paired tissue images using a bayesian probabilistic model</article-title><source>Nucleic Acids Research</source><year>2022</year><pub-id pub-id-type="pmcid">PMC9371936</pub-id><pub-id pub-id-type="pmid">35536287</pub-id><pub-id pub-id-type="doi">10.1093/nar/gkac320</pub-id></element-citation></ref><ref id="R14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>William Townes</surname><given-names>F</given-names></name><name><surname>Engelhardt</surname><given-names>Barbara E</given-names></name></person-group><article-title>Nonnegative spatial factorization</article-title><source>arXiv preprint</source><year>2021</year><comment>arXiv:2110.06122</comment></element-citation></ref><ref id="R15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Joseph</surname><given-names>Bergenstråhle</given-names></name><name><surname>Larsson</surname><given-names>Ludvig</given-names></name><name><surname>Lundeberg</surname><given-names>Joakim</given-names></name></person-group><article-title>Seamless integration of image and molecular analysis for spatial transcriptomics work-flows</article-title><source>BMC genomics</source><year>2020</year><volume>21</volume><issue>1</issue><fpage>1</fpage><lpage>7</lpage><pub-id pub-id-type="pmcid">PMC7386244</pub-id><pub-id pub-id-type="pmid">32664861</pub-id><pub-id pub-id-type="doi">10.1186/s12864-020-06832-3</pub-id></element-citation></ref><ref id="R16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gillis</surname><given-names>Nicolas</given-names></name><name><surname>Glineur</surname><given-names>François</given-names></name></person-group><article-title>Accelerated multiplicative updates and hierarchical als algorithms for nonnegative matrix factorization</article-title><source>Neural computation</source><year>2012</year><volume>24</volume><issue>4</issue><fpage>1085</fpage><lpage>1105</lpage><pub-id pub-id-type="pmid">22168561</pub-id></element-citation></ref><ref id="R17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Morgans</surname><given-names>William Geraint</given-names></name><name><surname>Sharrocks</surname><given-names>Andrew</given-names></name><name><surname>Iqbal</surname><given-names>Mudassar</given-names></name></person-group><article-title>Scalable joint non-negative matrix factorisation for paired single cell gene expression and chromatin accessibility data</article-title><source>bioRxiv</source><year>2023</year><pub-id pub-id-type="doi">10.1101/2023.09.25.559293</pub-id></element-citation></ref><ref id="R18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jolliffe</surname><given-names>Ian T</given-names></name><name><surname>Cadima</surname><given-names>Jorge</given-names></name></person-group><article-title>Principal component analysis: a review and recent developments</article-title><source>Philosophical Transactions of the Royal Society A: Mathematical, Physical and Engineering Sciences</source><year>2016</year><volume>374</volume><issue>2065</issue><elocation-id>20150202</elocation-id><pub-id pub-id-type="pmcid">PMC4792409</pub-id><pub-id pub-id-type="pmid">26953178</pub-id><pub-id pub-id-type="doi">10.1098/rsta.2015.0202</pub-id></element-citation></ref><ref id="R19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Palla</surname><given-names>Giovanni</given-names></name><name><surname>Spitzer</surname><given-names>Hannah</given-names></name><name><surname>Klein</surname><given-names>Michal</given-names></name><name><surname>Fischer</surname><given-names>David</given-names></name><name><surname>Schaar</surname><given-names>Anna Christina</given-names></name><name><surname>Kuemmerle</surname><given-names>Louis Benedikt</given-names></name><name><surname>Rybakov</surname><given-names>Sergei</given-names></name><name><surname>Ibarra</surname><given-names>Ignacio L</given-names></name><name><surname>Holmberg</surname><given-names>Olle</given-names></name><name><surname>Virshup</surname><given-names>Isaac</given-names></name><etal/></person-group><article-title>Squidpy: a scalable framework for spatial omics analysis</article-title><source>Nature methods</source><year>2022</year><volume>19</volume><issue>2</issue><fpage>171</fpage><lpage>178</lpage><pub-id pub-id-type="pmcid">PMC8828470</pub-id><pub-id pub-id-type="pmid">35102346</pub-id><pub-id pub-id-type="doi">10.1038/s41592-021-01358-2</pub-id></element-citation></ref><ref id="R20"><label>20</label><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Satopaa</surname><given-names>Ville</given-names></name><name><surname>Albrecht</surname><given-names>Jeannie</given-names></name><name><surname>Irwin</surname><given-names>David</given-names></name><name><surname>Raghavan</surname><given-names>Barath</given-names></name></person-group><article-title>Finding a kneedle in a haystack: Detecting knee points in system behavior</article-title><source>2011 31st international conference on distributed computing systems workshops</source><year>2011</year><fpage>166</fpage><lpage>171</lpage><comment>IEEE</comment></element-citation></ref><ref id="R21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Boutsidis</surname><given-names>Christos</given-names></name><name><surname>Gallopoulos</surname><given-names>Efstratios</given-names></name></person-group><article-title>Svd based initialization: A head start for nonnegative matrix factorization</article-title><source>Pattern recognition</source><year>2008</year><volume>41</volume><issue>4</issue><fpage>1350</fpage><lpage>1362</lpage></element-citation></ref><ref id="R22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hu</surname><given-names>Jian</given-names></name><name><surname>Li</surname><given-names>Xiangjie</given-names></name><name><surname>Coleman</surname><given-names>Kyle</given-names></name><name><surname>Schroeder</surname><given-names>Amelia</given-names></name><name><surname>Ma</surname><given-names>Nan</given-names></name><name><surname>Irwin</surname><given-names>David J</given-names></name><name><surname>Lee</surname><given-names>Edward B</given-names></name><name><surname>Shinohara</surname><given-names>Russell T</given-names></name><name><surname>Li</surname><given-names>Mingyao</given-names></name></person-group><article-title>Spagcn: Integrating gene expression, spatial location and histology to identify spatial domains and spatially variable genes by graph convolutional network</article-title><source>Nature methods</source><year>2021</year><volume>18</volume><issue>11</issue><fpage>1342</fpage><lpage>1351</lpage><pub-id pub-id-type="pmid">34711970</pub-id></element-citation></ref><ref id="R23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pham</surname><given-names>Duy</given-names></name><name><surname>Tan</surname><given-names>Xiao</given-names></name><name><surname>Xu</surname><given-names>Jun</given-names></name><name><surname>Grice</surname><given-names>Laura F</given-names></name><name><surname>Lam</surname><given-names>Pui Yeng</given-names></name><name><surname>Raghubar</surname><given-names>Arti</given-names></name><name><surname>Vukovic</surname><given-names>Jana</given-names></name><name><surname>Ruitenberg</surname><given-names>Marc J</given-names></name><name><surname>Nguyen</surname><given-names>Quan</given-names></name></person-group><article-title>stlearn: integrating spatial location, tissue morphology and gene expression to find cell types, cell-cell interactions and spatial trajectories within undissociated tissues</article-title><source>BioRxiv</source><year>2020</year></element-citation></ref><ref id="R24"><label>24</label><element-citation publication-type="web"><collab>10X Genomics</collab><comment><ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/resources/datasets/adult-mouse-brain-section-2-coronal-stains-dapi-anti-gfap-anti-neu-n-1-standard-1-1-0">https://www.10xgenomics.com/resources/datasets/adult-mouse-brain-section-2-coronal-stains-dapi-anti-gfap-anti-neu-n-1-standard-1-1-0</ext-link></comment></element-citation></ref><ref id="R25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Alexander Wolf</surname><given-names>F</given-names></name><name><surname>Angerer</surname><given-names>Philipp</given-names></name><name><surname>Theis</surname><given-names>Fabian J</given-names></name></person-group><article-title>Scanpy: large-scale single-cell gene expression data analysis</article-title><source>Genome biology</source><year>2018</year><volume>19</volume><issue>1</issue><fpage>1</fpage><lpage>5</lpage><pub-id pub-id-type="pmcid">PMC5802054</pub-id><pub-id pub-id-type="pmid">29409532</pub-id><pub-id pub-id-type="doi">10.1186/s13059-017-1382-0</pub-id></element-citation></ref><ref id="R26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Satija</surname><given-names>Rahul</given-names></name><name><surname>Farrell</surname><given-names>Jeffrey A</given-names></name><name><surname>Gennert</surname><given-names>David</given-names></name><name><surname>Schier</surname><given-names>Alexander F</given-names></name><name><surname>Regev</surname><given-names>Aviv</given-names></name></person-group><article-title>Spatial reconstruction of single-cell gene expression data</article-title><source>Nature biotechnology</source><year>2015</year><volume>33</volume><issue>5</issue><fpage>495</fpage><lpage>502</lpage><pub-id pub-id-type="pmcid">PMC4430369</pub-id><pub-id pub-id-type="pmid">25867923</pub-id><pub-id pub-id-type="doi">10.1038/nbt.3192</pub-id></element-citation></ref><ref id="R27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jolivet</surname><given-names>Renaud</given-names></name><name><surname>Magistretti</surname><given-names>Pierre J</given-names></name><name><surname>Weber</surname><given-names>Bruno</given-names></name></person-group><source>Deciphering neuronglia compartmentalization in cortical energy metabolism</source><volume>1</volume><fpage>4</fpage><comment>ISSN 1662-6427</comment><pub-id pub-id-type="pmcid">PMC2715922</pub-id><pub-id pub-id-type="pmid">19636395</pub-id><pub-id pub-id-type="doi">10.3389/neuro.14.004.2009</pub-id></element-citation></ref><ref id="R28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Allen</surname><given-names>Nicola J</given-names></name><name><surname>Lyons</surname><given-names>David A</given-names></name></person-group><source>Glia as architects of central nervous system formation and function</source><volume>362</volume><issue>6411</issue><fpage>181</fpage><lpage>185</lpage><comment>ISSN 0036-8075</comment><pub-id pub-id-type="pmcid">PMC6292669</pub-id><pub-id pub-id-type="pmid">30309945</pub-id><pub-id pub-id-type="doi">10.1126/science.aat0473</pub-id></element-citation></ref><ref id="R29"><label>29</label><element-citation publication-type="web"><collab>10X Genomics</collab><comment><ext-link ext-link-type="uri" xlink:href="https://www.10xgenomics.com/resources/datasets/human-prostate-cancer-adenocarcinoma-with-invasive-carcinoma-ffpe-1-standard-1-3-0">https://www.10xgenomics.com/resources/datasets/human-prostate-cancer-adenocarcinoma-with-invasive-carcinoma-ffpe-1-standard-1-3-0</ext-link></comment></element-citation></ref><ref id="R30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>McNeal</surname><given-names>John E</given-names></name></person-group><article-title>The zonal anatomy of the prostate</article-title><source>The prostate</source><year>1981</year><volume>2</volume><issue>1</issue><fpage>35</fpage><lpage>49</lpage><pub-id pub-id-type="pmid">7279811</pub-id></element-citation></ref><ref id="R31"><label>31</label><element-citation publication-type="report"><person-group person-group-type="author"><name><surname>Henry</surname><given-names>Gervaise H</given-names></name><name><surname>Malewska</surname><given-names>Alicia</given-names></name><name><surname>Joseph</surname><given-names>Diya B</given-names></name><name><surname>Malladi</surname><given-names>Venkat S</given-names></name><name><surname>Lee</surname><given-names>Jeon</given-names></name><name><surname>Torrealba</surname><given-names>Jose</given-names></name><name><surname>Mauck</surname><given-names>Ryan J</given-names></name><name><surname>Gahan</surname><given-names>Jeffrey C</given-names></name><name><surname>Raj</surname><given-names>Ganesh V</given-names></name><name><surname>Roehrborn</surname><given-names>Claus G</given-names></name><etal/></person-group><article-title>A cellular anatomy of the normal adult human prostate and prostatic urethra</article-title><source>Cell reports</source><year>2018</year><volume>25</volume><issue>12</issue><fpage>3530</fpage><lpage>3542</lpage></element-citation></ref><ref id="R32"><label>32</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Lavery</surname><given-names>Hugh J</given-names></name><name><surname>Droller</surname><given-names>Michael J</given-names></name></person-group><source>Do gleason patterns 3 and 4 prostate cancer represent separate disease states?</source><volume>188</volume><issue>5</issue><fpage>1667</fpage><lpage>1675</lpage><comment>ISSN 1527-3792</comment><pub-id pub-id-type="pmid">22998919</pub-id></element-citation></ref><ref id="R33"><label>33</label><element-citation publication-type="confproc"><person-group person-group-type="author"><name><surname>Epstein</surname><given-names>Jonathan I</given-names></name><name><surname>Egevad</surname><given-names>Lars</given-names></name><name><surname>Amin</surname><given-names>Mahul B</given-names></name><name><surname>Delahunt</surname><given-names>Brett</given-names></name><name><surname>Srigley</surname><given-names>John R</given-names></name><name><surname>Humphrey</surname><given-names>Peter A</given-names></name></person-group><article-title>The 2014 international society of urological pathology (isup) consensus conference on gleason grading of prostatic carcinoma</article-title><source>The American journal of surgical pathology</source><year>2016</year><volume>40</volume><issue>2</issue><fpage>244</fpage><lpage>252</lpage></element-citation></ref><ref id="R34"><label>34</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Song</surname><given-names>Hanbing</given-names></name><name><surname>Weinstein</surname><given-names>Hannah NW</given-names></name><name><surname>Allegakoen</surname><given-names>Paul</given-names></name><name><surname>Wadsworth</surname><given-names>Marc H</given-names></name><name><surname>Xie</surname><given-names>Jamie</given-names></name><name><surname>Yang</surname><given-names>Heiko</given-names></name><name><surname>Castro</surname><given-names>Ethan A</given-names></name><name><surname>Lu</surname><given-names>Kevin L</given-names></name><name><surname>Stohr</surname><given-names>Bradley A</given-names></name><name><surname>Feng</surname><given-names>Felix Y</given-names></name><etal/></person-group><article-title>Single-cell analysis of human primary prostate cancer reveals the heterogeneity of tumor-associated epithelial cell states</article-title><source>Nature communications</source><year>2022</year><volume>13</volume><issue>1</issue><fpage>1</fpage><lpage>20</lpage><pub-id pub-id-type="pmcid">PMC8748675</pub-id><pub-id pub-id-type="pmid">35013146</pub-id><pub-id pub-id-type="doi">10.1038/s41467-021-27322-4</pub-id></element-citation></ref><ref id="R35"><label>35</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Heidegger</surname><given-names>Isabel</given-names></name><name><surname>Fotakis</surname><given-names>Georgios</given-names></name><name><surname>Offermann</surname><given-names>Anne</given-names></name><name><surname>Goveia</surname><given-names>Jermaine</given-names></name><name><surname>Daum</surname><given-names>Sophia</given-names></name><name><surname>Salcher</surname><given-names>Stefan</given-names></name><name><surname>Noureen</surname><given-names>Asma</given-names></name><name><surname>Timmer-Bosscha</surname><given-names>Hetty</given-names></name><name><surname>Georg</surname><given-names>Schäfer</given-names></name><name><surname>Walenkamp</surname><given-names>Annemiek</given-names></name><etal/></person-group><article-title>Comprehensive characterization of the prostate tumor microenvironment identifies cxcr4/cxcl12 crosstalk as a novel antiangiogenic therapeutic target in prostate cancer</article-title><source>Molecular Cancer</source><year>2022</year><volume>21</volume><issue>1</issue><fpage>1</fpage><lpage>20</lpage><pub-id pub-id-type="pmcid">PMC9206324</pub-id><pub-id pub-id-type="pmid">35717322</pub-id><pub-id pub-id-type="doi">10.1186/s12943-022-01597-7</pub-id></element-citation></ref><ref id="R36"><label>36</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Sui</surname><given-names>Lufei</given-names></name><name><surname>Wang</surname><given-names>Suming</given-names></name><name><surname>Ganguly</surname><given-names>Debolina</given-names></name><name><surname>El Rayes</surname><given-names>Tyler P</given-names></name><name><surname>Askeland</surname><given-names>Cecilie</given-names></name><name><surname>Astrid</surname><given-names>Børretzen</given-names></name><name><surname>Sim</surname><given-names>Danielle</given-names></name><name><surname>Halvorsen</surname><given-names>Ole Johan</given-names></name><name><surname>Knutsvik</surname><given-names>Gøril</given-names></name><name><surname>Arnes</surname><given-names>Jarle</given-names></name><name><surname>Aziz</surname><given-names>Sura</given-names></name><etal/></person-group><chapter-title>PRSS2 remodels the tumor microenvironment via repression of tsp1 to stimulate tumor growth and progression</chapter-title><publisher-name>Nature Publishing Group</publisher-name><volume>13</volume><issue>1</issue><fpage>7959</fpage><comment>Number: 1 ISSN 2041-1723</comment><pub-id pub-id-type="pmcid">PMC9794699</pub-id><pub-id pub-id-type="pmid">36575174</pub-id><pub-id pub-id-type="doi">10.1038/s41467-022-35649-9</pub-id></element-citation></ref><ref id="R37"><label>37</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Takayama</surname><given-names>Ken-Ichi</given-names></name><name><surname>Suzuki</surname><given-names>Takashi</given-names></name><name><surname>Fujimura</surname><given-names>Tetsuya</given-names></name><name><surname>Yamada</surname><given-names>Yuta</given-names></name><name><surname>Takahashi</surname><given-names>Satoru</given-names></name><name><surname>Homma</surname><given-names>Yukio</given-names></name><name><surname>Suzuki</surname><given-names>Yutaka</given-names></name><name><surname>Inoue</surname><given-names>Satoshi</given-names></name></person-group><source>Dysregulation of spliceosome gene expression in advanced prostate cancer by RNA-binding protein PSF</source><volume>114</volume><issue>39</issue><fpage>10461</fpage><lpage>10466</lpage><comment>ISSN 1091-6490</comment><pub-id pub-id-type="pmcid">PMC5625911</pub-id><pub-id pub-id-type="pmid">28893982</pub-id><pub-id pub-id-type="doi">10.1073/pnas.1706076114</pub-id></element-citation></ref><ref id="R38"><label>38</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dahiya</surname><given-names>Versha</given-names></name><name><surname>Bagchi</surname><given-names>Gargi</given-names></name></person-group><source>Non-canonical androgen signaling pathways and implications in prostate cancer</source><volume>1869</volume><issue>12</issue><elocation-id>119357</elocation-id><comment>ISSN 1879-2596</comment><pub-id pub-id-type="pmid">36100060</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Fig. 1</label><caption><p>Graphical overview of <italic>CellPie</italic> method. <italic>CellPie</italic> takes as input spatial gene expression counts (spots by genes) and paired histological or immunofluorescence image features (spots by features) matrices. These two modalities are jointly factorised using joint non-negative matrix factorisation, resulting to three matrices: a shared spots by topics matrix, containing topic (cell-type associated) proportions and two individual matrices, a gene loading and an image loading matrix.</p></caption><graphic xlink:href="EMS189017-f001"/></fig><fig id="F2" position="float"><label>Fig. 2</label><caption><title>Validation of <italic>CellPie</italic> using Mouse brain ST data and IF staining</title><p>(A) Immunofluorescence image of adult mouse brain coronal section (<xref ref-type="bibr" rid="R24">24</xref>), stained with NeuN, GFAP and DAPI. (B) Model selection based on the elbow point of the loss function, where the optimal number of topic found to be <italic>k</italic> = 13. (C) Spearman correlation between <italic>CellPie</italic> and ground-truth for glial and neuronal cell-types, for a range of modality weights (<italic>α</italic> = 0.0, 0.4, 1.0, 1.6, 2.0). (D)Left: Spearman correlation between the ground-truth and the deconvolved proportions of <italic>stDeconvolve, Cell2Location, CellPie</italic>, and <italic>Stereoscope</italic>, for glia. Right: The same but for neurons. The results reported for <italic>CellPie</italic> correspond to weight <italic>α</italic> = 0.4, based on the correlations values in (C). (E) Left: Intensity values extracted using the GFAP channel of the immunofluorescence image to serve as a ground-truth of glial cell-types and proportions of glial cell-types as estimated using <italic>CellPie</italic>. Right: Similar but for neuronal cell-types, using the NeuN channel as ground-truth.</p></caption><graphic xlink:href="EMS189017-f002"/></fig><fig id="F3" position="float"><label>Fig. 3</label><caption><title>Analysis of <italic>CellPie</italic>’s gene loading factors.</title><p>(A) Top scored cell types of the topics used to synthesize the neuronal topic. The scoring has been estimated using a single-cell reference dataset from a coronal mouse brain section in conjunction with the gene list in <italic>CellPie</italic>’s gene loading. (B) Similar as in (A) but for glia topics.</p></caption><graphic xlink:href="EMS189017-f003"/></fig><fig id="F4" position="float"><label>Fig. 4</label><caption><title>Validation of <italic>CellPie</italic> on human prostate cancer data</title><p>(A) H&amp;E image of human prostate tissue with adenocarcinoma (FFPE) obtained from 10x Genomics (<xref ref-type="bibr" rid="R29">29</xref>). (B) H&amp;E image overlaid with pathologist annotations. (C) Model selection, where the optimal number of topics found to be <italic>k</italic> = 11. (D) Evaluation of <italic>CellPie</italic>’s topic discovery accuracy against pathologist’s ground-truth across a range of different modality weights, using Fowlkes Mallows, Adjusted Rand Index and Adjusted Mutual Info scores. (D) <italic>CellPie</italic>’s topics, clustered using k-means algorithm with <italic>n</italic> = 5 clusters. (F) Crosstab heatmap showing similarity between pathologist’s annotated regions and the clusters in (E).</p></caption><graphic xlink:href="EMS189017-f004"/></fig><fig id="F5" position="float"><label>Fig. 5</label><caption><title>Validation of <italic>CellPie</italic> on human prostate cancer data</title><p>(A) Comparison of <italic>CellPie</italic>’s topics, clustered using k-means algorithm, against other published clustering methods. The images correspond to: first row: pathologist’s ground truth, <italic>CellPie</italic> with <italic>α</italic> = 1.7, <italic>CellPie</italic> with only gene expression data (<italic>α</italic> = 2), second row: kmeans clustering of row spatial transcriptomics counts data, <italic>SpaGCN</italic> clusters and <italic>stLearn</italic> clusters. (B) Adjusted Rand Index (ARI) for the methods in (A). (C) Precision metric for the Gleason 3 and Gleason 4 regions, defined as the number of spots correctly identified as Gleason 3 or Gleason 4 by <italic>CellPie</italic> and other methods, over the total number of spots identified as Gleason 3/Gleason 4 by the method.</p></caption><graphic xlink:href="EMS189017-f005"/></fig><fig id="F6" position="float"><label>Fig. 6</label><caption><title>Biological interpretation of the prostate cancer results</title><p>(A) Four of the eleven <italic>CellPie</italic> topics associated with tumour region (deconv_0, deconv_6), connective tissue (deconv_1) and normal glands (deconv_2). (B) Top ten marker genes for each of the topics present in (A). (C) Annotation of cell-types present in topics (A) using a single-cell reference dataset. (D) Gene ontology performed using the top 100 topic related markers for the topics shown in (A).</p></caption><graphic xlink:href="EMS189017-f006"/></fig></floats-group></article>