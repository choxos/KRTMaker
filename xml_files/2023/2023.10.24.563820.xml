<!DOCTYPE article
 PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd">
<article xmlns:ali="http://www.niso.org/schemas/ali/1.0/" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" article-type="preprint"><?all-math-mml yes?><?use-mml?><?origin ukpmcpa?><front><journal-meta><journal-id journal-id-type="nlm-ta">bioRxiv</journal-id><journal-title-group><journal-title>bioRxiv : the preprint server for biology</journal-title></journal-title-group><issn pub-type="ppub"/></journal-meta><article-meta><article-id pub-id-type="manuscript">EMS190323</article-id><article-id pub-id-type="doi">10.1101/2023.10.24.563820</article-id><article-id pub-id-type="archive">PPR749090</article-id><article-version-alternatives><article-version article-version-type="status">preprint</article-version><article-version article-version-type="number">1</article-version></article-version-alternatives><article-categories><subj-group subj-group-type="heading"><subject>Article</subject></subj-group></article-categories><title-group><article-title>A novel Bayesian model for assessing intratumor heterogeneity of tumor infiltrating leukocytes with multi-region gene expression sequencing</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Yang</surname><given-names>Peng</given-names></name><xref ref-type="aff" rid="A1">1</xref><xref ref-type="aff" rid="A2">2</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib><contrib contrib-type="author"><name><surname>Hubert</surname><given-names>Shawna M.</given-names></name><xref ref-type="aff" rid="A3">3</xref></contrib><contrib contrib-type="author"><name><surname>Andrew Futreal</surname><given-names>P.</given-names></name><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Song</surname><given-names>Xingzhi</given-names></name><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Zhang</surname><given-names>Jianhua</given-names></name><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Jack Lee</surname><given-names>J.</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Wistuba</surname><given-names>Ignacio</given-names></name><xref ref-type="aff" rid="A5">5</xref></contrib><contrib contrib-type="author"><name><surname>Yuan</surname><given-names>Ying</given-names></name><xref ref-type="aff" rid="A2">2</xref></contrib><contrib contrib-type="author"><name><surname>Zhang</surname><given-names>Jianjun</given-names></name><xref ref-type="aff" rid="A3">3</xref><xref ref-type="aff" rid="A4">4</xref></contrib><contrib contrib-type="author"><name><surname>Li</surname><given-names>Ziyi</given-names></name><xref ref-type="aff" rid="A2">2</xref><xref ref-type="corresp" rid="CR1">*</xref></contrib></contrib-group><aff id="A1"><label>1</label>Department of Statistics, Rice University, Houston, Texas 77005, U.S.A</aff><aff id="A2"><label>2</label>Department of Biostatistics, The University of Texas MD Anderson Cancer Center Houston, Texas 77030, U.S.A</aff><aff id="A3"><label>3</label>Department of Thoracic Head Neck Medical Oncology, The University of Texas MD Anderson Cancer Center, Houston, TX, USA</aff><aff id="A4"><label>4</label>Department of Genomic Medicine, The University of Texas MD Anderson Cancer Center, Houston, TX, USA</aff><aff id="A5"><label>5</label>Department of Translational Molecular Pathology, The University of Texas MD Anderson Cancer Center, Houston, TX, USA</aff><author-notes><corresp id="CR1"><label>*</label><email>py11@rice.edu</email>; <email>zli16@mdanderson.org</email></corresp></author-notes><pub-date pub-type="nihms-submitted"><day>31</day><month>10</month><year>2023</year></pub-date><pub-date pub-type="preprint"><day>29</day><month>10</month><year>2023</year></pub-date><permissions><ali:free_to_read/><license><ali:license_ref>https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref><license-p>This work is licensed under a <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0 International license</ext-link>.</license-p></license></permissions><abstract><p id="P1">Intratumor heterogeneity (ITH) of tumor-infiltrated leukocytes (TILs) is an important phenomenon of cancer biology with potentially profound clinical impacts. Multi-region gene expression sequencing data provide a promising opportunity that allows for explorations of TILs and their intratumor heterogeneity for each subject. Although several existing methods are available to infer the proportions of TILs, considerable methodological gaps exist for evaluating intratumor heterogeneity of TILs with multi-region gene expression data. Here, we develop ICeITH, <underline>i</underline>mmune <underline>c</underline>ell <underline>e</underline>stimation reveals <underline>i</underline>ntratumor <underline>h</underline>eterogeneity, a Bayesian hierarchical model that borrows cell type profiles as prior knowledge to decompose mixed bulk data while accounting for the within-subject correlations among tumor samples. ICeITH quantifies intratumor heterogeneity by the variability of targeted cellular compositions. Through extensive simulation studies, we demonstrate that ICeITH is more accurate in measuring relative cellular abundance and evaluating intratumor heterogeneity compared with existing methods. We also assess the ability of ICeITH to stratify patients by their intratumor heterogeneity score and associate the estimations with the survival outcomes. Finally, we apply ICeITH to two multi-region gene expression datasets from lung cancer studies to classify patients into different risk groups according to the ITH estimations of targeted TILs that shape either pro- or anti-tumor processes. In conclusion, ICeITH is a useful tool to evaluate intratumor heterogeneity of TILs from multi-region gene expression data.</p></abstract><kwd-group><kwd>Bayesian hierarchical model</kwd><kwd>Deconvolution</kwd><kwd>RNA-seq data</kwd><kwd>TRACERx</kwd></kwd-group></article-meta></front><body><sec id="S1" sec-type="intro"><label>1</label><title>Introduction</title><p id="P2">Cancers are composed of cells with distinct molecular and phenotypic features within the same tumors, a phenomenon termed intratumor heterogeneity (<xref ref-type="bibr" rid="R39">Zhang et al., 2014</xref>). Intratumor heterogeneity (ITH) is a fundamental phenomenon that presents at different molecular levels, between different cancer types, as well as in the constitution of the tumor microen-vironment (<xref ref-type="bibr" rid="R33">Sousa et al., 2018</xref>). Previous studies have demonstrated that intratumor heterogeneities are associated with an increased risk of post-surgical recurrence in localized non-small cell lung cancers (NSCLS) (<xref ref-type="bibr" rid="R26">Reuben et al., 2017</xref>; <xref ref-type="bibr" rid="R12">Gaudreau et al., 2021</xref>). Tumor-infiltrated leukocytes (TILs), as a key component of the tumor microenvironment, is a dynamic process that drives intratumor heterogeneity (<xref ref-type="bibr" rid="R17">Jia et al., 2018</xref>) and is closely associated with patient prognosis (<xref ref-type="bibr" rid="R31">Sato et al., 2005</xref>; <xref ref-type="bibr" rid="R4">Bindea et al., 2013</xref>). Tremendous efforts have been put into the research of local mutation diversity (<xref ref-type="bibr" rid="R17">Jia et al., 2018</xref>), gene expression variation (<xref ref-type="bibr" rid="R21">Meister et al., 2014</xref>) and the evolution of the tumor-microenvironment (<xref ref-type="bibr" rid="R16">Janiszewska et al., 2020</xref>). However, none of these studies have systematically studied the intratumor heterogeneities of TILs, which may provide valuable insights into cancer biology and personalized cancer treatment.</p><p id="P3">Both experimental and computational approaches are available for studying the compositions of TILs. Experimental methods sort the cell to purified samples or rely on single cell technology (<xref ref-type="bibr" rid="R14">Hwang et al., 2018</xref>; <xref ref-type="bibr" rid="R23">Potter et al., 2018</xref>; <xref ref-type="bibr" rid="R29">Saliba et al., 2014</xref>; <xref ref-type="bibr" rid="R3">Bacher et al., 2016</xref>; <xref ref-type="bibr" rid="R6">Chen et al., 2019</xref>). But these tools are often too expensive and time-consuming in population-scale studies. TIL compositions can also be inferred using computational approaches from the bulk transcriptomic sequencing data (<xref ref-type="bibr" rid="R22">Newman et al., 2015</xref>; <xref ref-type="bibr" rid="R28">Rooney et al., 2015</xref>; <xref ref-type="bibr" rid="R24">Racle et al., 2017</xref>; <xref ref-type="bibr" rid="R19">Li et al., 2016</xref>). Most of these methods use a regression-based framework to measure the relative immune cell type abundance with a purified cell-type-specific gene expression as reference. For example, CIBERSORT applies linear support vector regression (SVR) (<xref ref-type="bibr" rid="R32">Schölkopf et al., 2000</xref>) using a matrix of reference gene signatures as covariates and estimates the cellular compositions (<xref ref-type="bibr" rid="R22">Newman et al., 2015</xref>); EPIC is based on weighted least squares and imposes higher weights on informative genes to improve estimation accuracy (<xref ref-type="bibr" rid="R25">Racle et al., 2020</xref>); and TIMER employs a constrained least squares fitting on immune-specific informative genes to remove the potential noises from the tumor cells (<xref ref-type="bibr" rid="R19">Li et al., 2016</xref>). However, none of these methods are designed for the problem of estimating intratumor heterogeneity.</p><p id="P4">Our work is motivated by the problem of estimating intratumor heterogeneity of TILs for lung cancer patients with multi-region RNA sequencing (RNA-seq) data. The two motivating studies are the TRAcking Non-small Cell Lung Cancer Evolution Through Therapy (TRACERx) study (<xref ref-type="bibr" rid="R15">Jamal-Hanjani et al., 2017</xref>) and the MD Anderson intratumor heterogeneity (ITH) study for lung cancer (<xref ref-type="bibr" rid="R39">Zhang et al., 2014</xref>). Both studies obtained multi-region RNA-seq data from lung cancer patients with each patient providing multiple tumor sample slices. Moreover, TRACERx study provides multi-region matched RNA-seq and WES data in bulk level from 100 patient cohorts diagnosed as early stage non-small cell lung cancers. Current studies focus on investigating the ITH on DNA data only, and they discovered a strong relation in the percentage of subclonal copy number alterations (SCNA) to patient survival, indicating the ITH within each patient plays an important role in cancer progression. However, it is important to note that the methods mentioned earlier were primarily designed to uncover the proportions of TILs by analyzing independent transcriptomic samples. When multiple RNA-seq samples exist per patient, the within-subject correlations are important factors to be accounted for in the estimation of intratumor heterogeneity. Consequently, the existing methods cannot accurately capture the intratumor heterogeneity of TILs in such scenarios. Notably, the ITH of TILs plays an important role in the tumor microenvironment and may be associated with patients’ outcomes. Compared with regular RNA-seq data using one tumor sample per patient, our data have a few unique attributes that the existing methods cannot address. First, the TIL compositions from multiple samples of the same subject tend to be more correlated than those from samples of several different individuals. Such within-subject correlations provide additional information about the estimation of TIL compositions and should be considered in the modeling. Second, the standard regression-based approaches do not consider gene-specific variability and may not be robust. It is likely that such pure cell type profiles have variations across different subjects. Some existing work has recognized this, e.g., BLADE (<xref ref-type="bibr" rid="R2">Andrade et al., 2021</xref>) takes a hierarchical Bayesian approach and models gene expression by log-normal distribution to account for the gene-specific variability for each cell type. Still, the method could not address the within-subject correlation in the multi-region data for intratumor heterogeneity evaluation.</p><p id="P5">In this paper, we develop a novel Bayesian hierarchical model, ICeITH, to infer relative cell type abundance and its variability across bulk tumor samples obtained from a multi-region sequencing design. ICeITH is a reference-based deconvolution method and it overcomes the limitations of current methods by modeling a patient-specific mean expression to account for the heterogeneity of gene expressions introduced from multi-region sequencing design. In addition, ICeITH measures the intratumor heterogeneity by quantifying the variability of targeted cellular composition and it potentially reveals the relation with the risk of patients’ survival. We present the notation, model, and estimations in <xref ref-type="sec" rid="S2">Section 2</xref>. The simulation setups and results for evaluating the empirical performance are described in <xref ref-type="sec" rid="S13">Section 3</xref>. The results of analyzing the two lung cancer multi-region datasets are presented in <xref ref-type="sec" rid="S19">Section 4</xref>. We provide conclusion remarks and discussions in <xref ref-type="sec" rid="S25">Section 5</xref>. The detailed derivations for the Bayesian model are relegated to the <xref ref-type="supplementary-material" rid="SD1">Supplementary Material</xref>. The proposed methods are available through a user-friendly R package (<ext-link ext-link-type="uri" xlink:href="https://github.come/pengyang0411/ICeITH">https://github.come/pengyang0411/ICeITH</ext-link>).</p></sec><sec id="S2" sec-type="methods"><label>2</label><title>Method</title><sec id="S3"><label>2.1</label><title>Input data</title><p id="P6">ICeITH model is designed to address the challenges of assessing intratumor heterogeneity using multi-region RNA-seq data. Multi-region gene expression data are obtained by sequencing multiple sample slices from the same subject and provide a promising opportunity to explore intratumor heterogeneity, as they can reveal differences in gene expression and immune cell infiltration between different regions of the same tumor. Compared to traditional single-region RNA-seq, multi-region RNA-seq data are generally more affordable. Mean-while, it allows for a more comprehensive analysis of intratumor heterogeneity than using single-region RNA-seq data. Our motivating studies, TRACERx and MDA-ITH, contain multi-region RNA-seq data from lung cancer patients, which we use to develop and validate ICeITH. Real data evidence from these studies demonstrates a higher correlation for the tumor slices from the same patient by visualizing the similarities of samples within and between different subjects in TRACERx (<xref ref-type="fig" rid="F1">Figure 1</xref>). Compared with other existing methods, ICeITH can borrow information through these higher within-subject correlations and achieve higher accuracy in estimating the patient-specific cell type profiles.</p><p id="P7">In addition to the multi-region gene expression data, ICeITH utilizes purified reference samples to estimate the proportion of immune cell types present in the tumor samples. These reference samples can be obtained from publicly available gene expression data. Several studies have provided immune-specific marker gene sets and their expression profiles (<xref ref-type="bibr" rid="R22">Newman et al., 2015</xref>; <xref ref-type="bibr" rid="R25">Racle et al., 2020</xref>). Detailed information on constructing major immune cell references using these marker gene sets is provided in <xref ref-type="sec" rid="S20">Section 4.1</xref>. The use of these reference samples and marker gene sets allows ICeITH to accurately estimate the proportions of immune cell types present in the tumor samples and to quantify the intratumor heterogeneity based on these cell types.</p></sec><sec id="S4"><label>2.2</label><title>Notation</title><p id="P8">Consider a study with <italic>N</italic> patients. Let <italic>I</italic><sub><italic>i</italic></sub> denote the sample index for subject <italic>i, i</italic> = 1, 2, …, <italic>N</italic>, and thus subject <italic>i</italic> has ∣<italic>I</italic><sub><italic>i</italic></sub>∣(∣<italic>I</italic><sub><italic>i</italic></sub>∣ &gt; 1) tumor slices sequenced by RNA-seq. As tumor samples consist of many cell types including malignant cells, stromal cells, and various immune cells, the gene expression data for each sample can be considered as mixed signals. With additional information, such as genes with immune-specific expressions, we aim to estimate immune cell-type-specific abundance and quantify the intratumor heterogeneity for each patient subject. Several informative immune-specific gene sets are available from previous work, for example, CIBERSORT and EPIC (<xref ref-type="bibr" rid="R22">Newman et al., 2015</xref>; <xref ref-type="bibr" rid="R25">Racle et al., 2020</xref>). We obtain these gene sets and specifically focus our ICeITH model on the immune-specific genes only. We use <bold><italic>Y</italic></bold> and <bold><italic>X</italic></bold> to denote the observed gene expressions for mixed bulk tumor samples and purified reference samples for the immune-specific genes, respectively. <italic>Y</italic> is a <inline-formula><mml:math id="M1"><mml:mi>G</mml:mi><mml:mo>×</mml:mo><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:math></inline-formula> matrix, where <italic>Y</italic><sub><italic>sg</italic></sub> is the expression of gene <italic>g</italic> in sample <italic>s</italic>. If this sample <italic>s</italic> falls into index <italic>I</italic><sub><italic>i</italic></sub> (i.e., <italic>s</italic> ∈ <italic>I</italic><sub><italic>i</italic></sub>), it indicates the sample is collected from patient <italic>i</italic>. <bold><italic>X</italic></bold> is a three-dimensional tensor of size <italic>V</italic> × <italic>G</italic> × <italic>K</italic>, where <italic>X</italic><sub><italic>vgk</italic></sub> is the expression of gene <italic>g</italic> in the <italic>v</italic>-th purified reference sample from cell type <italic>k</italic>. The number of genes is denoted by <italic>G</italic>, the number of purified reference samples by <italic>V</italic>, and the number of immune cell types by <italic>K</italic>. An overview of our notations and their association in our model is presented in <xref ref-type="fig" rid="F2">Figure 2</xref>.</p></sec><sec id="S5"><label>2.3</label><title>Model</title><p id="P9">We begin by modeling the observed cell-type-specific reference <italic>X</italic><sub><italic>vgk</italic></sub> using a log-normal distribution with mean and precision parameters <inline-formula><mml:math id="M2"><mml:msubsup><mml:mi>μ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup><mml:mtext>and</mml:mtext><mml:msubsup><mml:mi>λ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup></mml:math></inline-formula>, respectively. We obtain these parameters directly from the mean and variance of the log(<italic>X</italic><sub><italic>vgk</italic></sub>) values (<xref ref-type="bibr" rid="R38">Wilson et al., 2020</xref>). We then use the estimated <inline-formula><mml:math id="M3"><mml:msubsup><mml:mrow><mml:mover><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup><mml:mtext>and</mml:mtext><mml:msubsup><mml:mrow><mml:mover><mml:mi>λ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup></mml:math></inline-formula> as prior knowledge to guide the deconvolution process.</p><p id="P10">Considering a total of <italic>K</italic> immune cell types are of interest here, the observed gene expression <italic>Y</italic><sub><italic>sg</italic></sub> can be decomposed as: <disp-formula id="FD1"><label>(2.1)</label><mml:math id="M4"><mml:mstyle displaystyle="true"><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mi>k</mml:mi></mml:munder><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>ϵ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mtext>for</mml:mtext><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mstyle></mml:math></disp-formula> where <italic>h</italic><sub><italic>sk</italic></sub> is the unobserved cellular abundance from cell type <italic>k</italic> in sample <italic>s</italic>, and <italic>W</italic><sub><italic>sgk</italic></sub> is a three-dimensional tensor that stands for the hidden expression profiles of gene <italic>g</italic> in sample <italic>s</italic> from cell type <italic>k</italic>. <italic>ϵ</italic><sub><italic>sg</italic></sub> is the error term that follows a normal distribution with a mean value of 0 and variance of 1<italic>/ω</italic><sub><italic>g</italic></sub>, where <italic>ω</italic><sub><italic>g</italic></sub> is estimated empirically by taking the reciprocal of the standard deviation of log(<italic>Y</italic><sub>·<italic>g</italic></sub>). The ICeITH model utilizes this weighting scheme to flatten the likelihood of genes, particularly those with larger variance and suffering from over-dispersion, which is a common characteristic of RNA-seq data (<xref ref-type="bibr" rid="R38">Wilson et al., 2020</xref>). This approach down-weights the contributions of such genes during the estimation of cell type abundance. This linear assumption frames the ICeITH model as a mixture model problem, where the goal is to estimate the cellular compositions <italic>h</italic><sub><italic>sk</italic></sub> for each immune cell type <italic>k</italic>.</p><p id="P11">To characterize intratumor heterogeneity within the same patient subject, a hierarchical Bayesian approach is taken in two steps. First, each patient is allowed to have their own pure cell type profile parameters <italic>μ</italic><sub><italic>igk</italic></sub> per gene and per cell type. This is expressed as: <disp-formula id="FD2"><mml:math id="M5"><mml:mstyle displaystyle="true"><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mover><mml:mrow><mml:mo>∼</mml:mo></mml:mrow><mml:mrow><mml:mtext>i.i.d</mml:mtext></mml:mrow></mml:mover></mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mfrac><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mtext>for</mml:mtext><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula></p><p id="P12">Here, the unobserved gene expression of sample <italic>s</italic> ∈ <italic>I</italic><sub><italic>i</italic></sub> is assumed to follow a log-normal distribution with its mean centered to its patient-specific mean level, and the discrepancy can be accounted for by λ<sub><italic>gk</italic></sub>, which is the cell-type-specific variability for each gene. The choice of λ<sub><italic>gk</italic></sub> is guided by the reference profiles since the reference samples are collected independently across patients and capture an overall discrepancy in the cell-type-specific genes. Second, we use Dirichlet distribution to model cell type proportion parameters, <italic>h</italic><sub><italic>sk</italic></sub>. For sample <italic>s</italic> ∈ <italic>I</italic><sub><italic>i</italic></sub>, we have <disp-formula id="FD3"><label>(2.2)</label><mml:math id="M6"><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>K</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mi>Dir</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mi>π</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:math></disp-formula> where <bold><italic>π</italic></bold> is a <italic>K</italic> by 1 vector pooled across all samples with Σ<sub><italic>k</italic></sub> <italic>π</italic><sub><italic>k</italic></sub> = 1 to represent the global cellular composition, and <italic>C</italic><sub><italic>i</italic></sub> is a patient-specific parameter that controls the variability of the cellular composition across samples within each patient, thereby revealing intratumor heterogeneity. When <italic>C</italic><sub><italic>i</italic></sub> tends to be small, it indicates that patient <italic>i</italic> has greater variability in cellular composition, whereas when <italic>C</italic><sub><italic>i</italic></sub> increases, it reveals a more homogeneous cellular composition.</p><p id="P13">The Fenton-Wilkinson (FW) approximation is used to approximate <xref ref-type="disp-formula" rid="FD1">equation (2.1)</xref> by another log-normal distribution since there is no closed-form solution for the summation of independent log-normal variables. Specifically, the observed gene expression <italic>Y</italic><sub><italic>sg</italic></sub> is approximated as follows: <disp-formula id="FD4"><mml:math id="M7"><mml:mstyle displaystyle="true"><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mi>k</mml:mi></mml:munder><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:msub><mml:mi>ω</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mfrac><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mtext>for</mml:mtext><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>n</mml:mi><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula></p><p id="P14">Similar modeling strategies have also been adopted in previous work for deconvolution (<xref ref-type="bibr" rid="R38">Wilson et al., 2020</xref>; <xref ref-type="bibr" rid="R2">Andrade et al., 2021</xref>).</p></sec><sec id="S6"><label>2.4</label><title>Prior specifications</title><p id="P15">To incorporate prior knowledge from existing reference profiles, we use conjugate prior distributions for the patient-specific mean expression parameter <italic>μ</italic><sub><italic>igk</italic></sub>’s and variability λ<sub><italic>gk</italic></sub> of each gene <italic>g</italic> and cell type <italic>k</italic>: <disp-formula id="FD5"><mml:math id="M8"><mml:mtable><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mover><mml:mrow><mml:mo>∼</mml:mo></mml:mrow><mml:mrow><mml:mtext>i.i.d</mml:mtext></mml:mrow></mml:mover></mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mtext>for</mml:mtext><mml:mi>i</mml:mi><mml:mo>∈</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo>,</mml:mo></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mspace width="0.2em"/><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mi>Gamma</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> where <italic>ρ</italic><sub><italic>gk</italic></sub> controls the amount of prior information we borrow from the reference profiles. Larger values of <italic>ρ</italic><sub><italic>gk</italic></sub> indicate more confidence in prior knowledge and greater borrowing. We estimate the cell-type-specific mean expression parameter <italic>μ</italic><sub><italic>gk</italic></sub> as the sample mean of the cell-type-specific expression levels in the reference data, denoted by <inline-formula><mml:math id="M9"><mml:msubsup><mml:mrow><mml:mover><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup><mml:mo>.</mml:mo></mml:math></inline-formula> To borrow the cell-type-specific variability from the reference data, we set <italic>α</italic><sub><italic>gk</italic></sub> = 1 and <inline-formula><mml:math id="M10"><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mover><mml:mi>λ</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup></mml:mfrac><mml:mo>,</mml:mo><mml:mtext>where</mml:mtext><mml:msubsup><mml:mrow><mml:mover><mml:mi>λ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup></mml:math></inline-formula> is the sample variance of the cell-type-specific expression levels in the reference data. This choice of hyperparameters ensures that the expected value of λ<sub><italic>gk</italic></sub> is equal to <inline-formula><mml:math id="M11"><mml:msubsup><mml:mrow><mml:mover><mml:mi>λ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mi>r</mml:mi></mml:msubsup></mml:math></inline-formula>.</p></sec><sec id="S7"><label>2.5</label><title>Optimization</title><p id="P16">We use the Collapsed Variational Bayesian (CVB) method to optimize the ICeITH model. The CVB method is particularly suitable for models with conjugate priors, as we can collapse the hidden variables and then apply a variational Bayesian inference algorithm. This approach is more computationally efficient than Markov chain Monte Carlo (MCMC). The collapsed space of unobserved variables allows for better satisfaction of mean-field assumptions and results in a more accurate approximation of the true posterior distribution. This method has been shown to be effective in a variety of applications (<xref ref-type="bibr" rid="R34">Teh et al., 2006</xref>, <xref ref-type="bibr" rid="R35">2007</xref>; <xref ref-type="bibr" rid="R36">Wang et al., 2013</xref>; <xref ref-type="bibr" rid="R5">Blei et al., 2017</xref>).</p><sec id="S8"><label>2.5.1</label><title>Collapse over hidden variables</title><p id="P17">To perform a CVB method, we first marginalize over the hidden random variables <italic>μ</italic><sub><italic>igk</italic></sub>’s and λ<sub><italic>gk</italic></sub>’s. This step also allows us to account for all the variables in a fully Bayesian approach rather than seeking the optimization from the posterior density. By collapsing the joint posterior distribution into a simpler form, we can more efficiently compute the evidence of lower bound and estimate the posterior distribution of the model parameters. <disp-formula id="FD6"><mml:math id="M12"><mml:mtable><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:mspace width="1em"/><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:munder><mml:mo>∏</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>∣</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:mo>=</mml:mo><mml:msub><mml:mo>∫</mml:mo><mml:mi>λ</mml:mi></mml:msub><mml:msub><mml:mo>∫</mml:mo><mml:mi>μ</mml:mi></mml:msub><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:munder><mml:mo>∏</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>∣</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>×</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>×</mml:mo><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mn>1</mml:mn><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>⋯</mml:mo><mml:mi>d</mml:mi><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>N</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mi>d</mml:mi><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mo>Γ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>Γ</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mfrac><mml:msubsup><mml:mi>β</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:msubsup><mml:mi>β</mml:mi><mml:mi>n</mml:mi><mml:mrow><mml:msub><mml:mi>α</mml:mi><mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:msubsup></mml:mfrac><mml:mfrac><mml:msubsup><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>N</mml:mi><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:munderover><mml:mo>∏</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:munderover><mml:msqrt><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:msqrt></mml:mrow></mml:mfrac><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mi>π</mml:mi><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:munder><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:mfrac></mml:mrow></mml:msup><mml:mo>,</mml:mo></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> where <inline-formula><mml:math id="M13"><mml:msub><mml:mi>α</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:munder><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:munder><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:mfrac><mml:mo>+</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>W</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mrow></mml:mfrac><mml:msub><mml:mi>∑</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:math></inline-formula> and <disp-formula id="FD7"><mml:math id="M14"><mml:mstyle displaystyle="true"><mml:msub><mml:mi>β</mml:mi><mml:mi>n</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>β</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:munder><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:munder><mml:mo fence="false" stretchy="false">{</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mo stretchy="false">(</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>W</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>W</mml:mi><mml:mo stretchy="false">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo fence="false" stretchy="false">}</mml:mo><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula></p></sec><sec id="S9"><label>2.5.2</label><title>Variational parameters</title><p id="P18">After we integrate out the latent variables, we introduce the following variational distributions on the remaining unobserved variables, that is <italic>W</italic><sub><italic>sgk</italic></sub> and <italic>h</italic><sub><italic>sk</italic></sub>, <disp-formula id="FD8"><mml:math id="M15"><mml:mtable><mml:mtr><mml:mtd><mml:mspace width="2em"/><mml:mspace width="0.2em"/><mml:mspace width="0.2em"/><mml:mspace width="0.2em"/><mml:mspace width="0.2em"/><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>∣</mml:mo><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>γ</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mi>τ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mtext>for</mml:mtext><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo>;</mml:mo><mml:mi>g</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>G</mml:mi><mml:mo>;</mml:mo><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>K</mml:mi><mml:mo>;</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>K</mml:mi></mml:mrow></mml:msub><mml:mo>∣</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>K</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>∼</mml:mo><mml:mi>Dir</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>K</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mtext>for</mml:mtext><mml:mi>s</mml:mi><mml:mo>∈</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>;</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>N</mml:mi><mml:mo>;</mml:mo><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:mi>K</mml:mi><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> where <italic>Q</italic>(·) denotes the variational distribution that we use to approximate the true posterior density and {<italic>γ</italic><sub><italic>igk</italic></sub>}<sub><italic>i,g,k</italic></sub>, {<italic>τ</italic><sub><italic>gk</italic></sub>}<sub><italic>g,k</italic></sub>, and {<italic>ξ</italic><sub><italic>sk</italic></sub>}<sub><italic>s,k</italic></sub> are variational parameters that seek to be optimized. In total, there are <inline-formula><mml:math id="M16"><mml:mo stretchy="false">(</mml:mo><mml:mi>N</mml:mi><mml:mo>×</mml:mo><mml:mi>G</mml:mi><mml:mo>×</mml:mo><mml:mi>K</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>G</mml:mi><mml:mo>×</mml:mo><mml:mi>K</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>×</mml:mo><mml:mi>K</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:math></inline-formula> parameters to estimate.</p></sec><sec id="S10"><label>2.5.3</label><title>Derivation of the evidence lower bound</title><p id="P19">Let <italic>Z</italic> = (<italic>W, H</italic>) denote the unobserved variables of interests and <bold><italic>θ</italic></bold> = (<bold><italic>α, β, ρ, μ, λ</italic></bold>) denote the hyperparameters. One can approximate the posterior distribution <italic>P</italic> (<italic>Z</italic>∣<italic>Y</italic>, <bold><italic>θ</italic></bold>) by the given variational distributions <italic>Q</italic>(<italic>Z</italic>) by minimizing the Kullback-Leibler (KL) divergence. This is equivalent to maximizing the evidence lower bound (ELBO) in <xref ref-type="disp-formula" rid="FD9">equation 2.3</xref>, and the ELBO can be represented by the following five components: <disp-formula id="FD9"><label>(2.3)</label><mml:math id="M17"><mml:mtable><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo>≥</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>,</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>H</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>E</mml:mo><mml:mo>L</mml:mo><mml:mo>B</mml:mo><mml:mo>O</mml:mo></mml:mrow></mml:mrow></mml:munder></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:mspace width="2em"/><mml:mspace width="2em"/><mml:mspace width="1em"/><mml:mspace width="0.2em"/><mml:mspace width="0.2em"/><mml:mspace width="0.2em"/><mml:mo>≥</mml:mo><mml:mo>∫</mml:mo><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>W</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mfrac><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>∣</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>H</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>W</mml:mi><mml:mo>∣</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>W</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>Q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi>Z</mml:mi></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:mspace width="2em"/><mml:mspace width="2em"/><mml:mspace width="1em"/><mml:mspace width="0.2em"/><mml:mspace width="0.2em"/><mml:mspace width="0.2em"/><mml:mo>≥</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>∣</mml:mo><mml:mi>W</mml:mi><mml:mo>,</mml:mo><mml:mi>H</mml:mi><mml:mo>,</mml:mo><mml:mi>λ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>a</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo>+</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>W</mml:mi><mml:mo>∣</mml:mo><mml:mi>μ</mml:mi><mml:mo>,</mml:mo><mml:mi>ρ</mml:mi><mml:mo>,</mml:mo><mml:mi>α</mml:mi><mml:mo>,</mml:mo><mml:mi>β</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>b</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo>+</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo>∣</mml:mo><mml:mi>C</mml:mi><mml:mo>,</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>d</mml:mo></mml:mrow></mml:mrow></mml:munder></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:mspace width="2em"/><mml:mspace width="2em"/><mml:mspace width="1em"/><mml:mspace width="0.2em"/><mml:mspace width="0.2em"/><mml:mspace width="0.2em"/><mml:mo>−</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>W</mml:mi><mml:mo>∣</mml:mo><mml:mi>γ</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>d</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo>−</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo>∣</mml:mo><mml:mi>ξ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mo>e</mml:mo></mml:mrow></mml:munder><mml:mo>.</mml:mo></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula></p><p id="P20">We apply Limited-memory BFGS (Broyden–Fletcher–Goldfarb–Shanno) to iteratively maximize the objective function defined in <xref ref-type="disp-formula" rid="FD3">equation 2.3</xref> and its gradient with respect to variational parameters has been derived to speed the optimization. The stopping criterion is determined if the change in the variational parameters of ELBO between two consecutive iterations is less than some threshold <italic>δ</italic><sub><italic>ϵ</italic></sub> (default value is 1 × 10<sup>−4</sup>). The analytical calculations of the objective functions and their gradients are presented in the <xref ref-type="supplementary-material" rid="SD1">Supplementary Material</xref>. An overview of the optimization algorithm of the CVB method is presented in <xref ref-type="other" rid="BX1">Algorithm 1</xref>.</p></sec><sec id="S11"><label>2.5.4</label><title>Empirical solution through moments</title><p id="P21">The relative cell type abundance across all samples can be estimated using the variational parameters obtained through the optimization process. Specifically, for cell type <italic>k</italic> and sample <italic>s</italic> within patient <italic>i</italic>, the estimated proportion of cell type <italic>k</italic> can be calculated as <inline-formula><mml:math id="M18"><mml:msub><mml:mrow><mml:mover><mml:mi>h</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> = <inline-formula><mml:math id="M19"><mml:msub><mml:mrow><mml:mover><mml:mi>ξ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>∑</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mover><mml:mi>ξ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math></inline-formula> and correspondingly, the overall cell type mean proportions can be obtained as <inline-formula><mml:math id="M20"><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>∑</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mover><mml:mi>h</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:math></inline-formula> To obtain the intratumor heterogeneity parameter <italic>C</italic><sub><italic>i</italic></sub> in <xref ref-type="disp-formula" rid="FD3">equation 2.2</xref> for a specific subject <italic>i</italic>, we compute the first and second central moment for <italic>s</italic> ∈ <italic>I</italic><sub><italic>i</italic></sub> as follows, <disp-formula id="FD10"><label>(2.4)</label><mml:math id="M21"><mml:mtable><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:mspace width="1em"/><mml:mi>E</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:munder><mml:mi>∑</mml:mi><mml:mi>c</mml:mi></mml:munder><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mstyle></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mstyle displaystyle="true"><mml:mrow><mml:mi>V</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mstyle></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula></p><boxed-text id="BX1" position="anchor"><label>Algorithm 1</label><caption><title>Collapsed Variational inference algorithm to optimize ICeITH model.</title></caption><p id="P22"><bold>Input: Y</bold> (observed mixed data matrix), <bold>X</bold> (observed reference data matrix);</p><list list-type="order" id="L1"><list-item><p id="P23">Initialize cell-type-specific mean expression and precision <inline-formula><mml:math id="M22"><mml:mo fence="false" stretchy="false">{</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>λ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mo fence="false" stretchy="false">}</mml:mo><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi><mml:mo>,</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> from reference matrix <bold>X</bold>;</p></list-item><list-item><p id="P24">Initialize cell-type-specific proportions <inline-formula><mml:math id="M23"><mml:msubsup><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mi>SVR</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mo fence="false" stretchy="false">{</mml:mo><mml:msub><mml:mi>Y</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mo fence="false" stretchy="false">}</mml:mo><mml:mi>g</mml:mi><mml:mi>G</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:mo fence="false" stretchy="false">{</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>μ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mo fence="false" stretchy="false">}</mml:mo><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>G</mml:mi><mml:mo>,</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:math></inline-formula> for <italic>s</italic> ∈ <italic>I<sub>i</sub></italic>, <italic>i</italic> = 1, …, <italic>N</italic>, <italic>k</italic> ∈ 1, …, <italic>K</italic>;</p></list-item><list-item><p id="P25">Initialize cell-type-specific mean proportions <inline-formula><mml:math id="M24"><mml:msubsup><mml:mi>π</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>∑</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:msubsup><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math></inline-formula> for <italic>k</italic> = 1, …, <italic>K</italic>;</p></list-item><list-item><p id="P26">Initialize patient-specific ITH score <inline-formula><mml:math id="M25"><mml:msubsup><mml:mi>C</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>C</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mo fence="false" stretchy="false">{</mml:mo><mml:msubsup><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msub><mml:mo fence="false" stretchy="false">}</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo fence="false" stretchy="false">{</mml:mo><mml:msubsup><mml:mi>π</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:msub><mml:mo fence="false" stretchy="false">}</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:math></inline-formula> for <italic>i</italic> = 1, …, <italic>N</italic>;</p><p id="P27"><bold>while</bold> Stopping criterion is not met <bold>do</bold></p></list-item><list-item><p id="P28">Update <inline-formula><mml:math id="M26"><mml:msup><mml:mi>γ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">←</mml:mo><mml:mi>argmax</mml:mi><mml:mo>⁡</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>∣</mml:mo><mml:msup><mml:mi>τ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>ξ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>a</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo>+</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>W</mml:mi><mml:mo>∣</mml:mo><mml:msup><mml:mi>τ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>b</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo>;</mml:mo></mml:math></inline-formula></p></list-item><list-item><p id="P29">Update <inline-formula><mml:math id="M27"><mml:msup><mml:mi>τ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">←</mml:mo><mml:mi>argmax</mml:mi><mml:mo>⁡</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>∣</mml:mo><mml:msup><mml:mi>γ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>ξ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>a</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo>+</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>W</mml:mi><mml:mo>∣</mml:mo><mml:msup><mml:mi>γ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>b</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo>−</mml:mo><mml:munder><mml:munder><mml:mrow><mml:mo>.</mml:mo><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>W</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>d</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo>;</mml:mo></mml:math></inline-formula></p></list-item><list-item><p id="P30">Update <inline-formula><mml:math id="M28"><mml:msup><mml:mi>ξ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo stretchy="false">←</mml:mo><mml:mi>argmax</mml:mi><mml:mo>⁡</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>Y</mml:mi><mml:mo>∣</mml:mo><mml:msup><mml:mi>γ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mi>τ</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">θ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>a</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo>+</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo>∣</mml:mo><mml:mi>C</mml:mi><mml:mo>,</mml:mo><mml:mi>π</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>c</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo>−</mml:mo><mml:munder><mml:munder><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>Q</mml:mi></mml:msub><mml:mo fence="false" stretchy="false">{</mml:mo><mml:mi>log</mml:mi><mml:mo>⁡</mml:mo><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>H</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo fence="false" stretchy="false">}</mml:mo></mml:mrow><mml:mo>⏟</mml:mo></mml:munder><mml:mrow><mml:mrow><mml:mo>e</mml:mo></mml:mrow></mml:mrow></mml:munder><mml:mo>;</mml:mo></mml:math></inline-formula></p></list-item><list-item><p id="P31">Update <italic>t</italic> ← <italic>t</italic> + 1;</p></list-item><list-item><p id="P32">Re-normalize the estimated cell-type-specific proportions <inline-formula><mml:math id="M29"><mml:msub><mml:mrow><mml:mover><mml:mi>ξ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>∑</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:msubsup><mml:mi>ξ</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>T</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>,</mml:mo></mml:math></inline-formula> for <italic>s</italic> ∈ <italic>I<sub>i</sub></italic>, <italic>i</italic> = 1, …, <italic>N</italic>, and <italic>k</italic> = 1, …, <italic>K</italic></p></list-item><list-item><p id="P33">Finalized the estimated cell-type-specific mean proportions <inline-formula><mml:math id="M30"><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>∑</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mover><mml:mi>ξ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>/</mml:mo></mml:mrow><mml:msub><mml:mi>∑</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>I</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:math></inline-formula> for <italic>k</italic> = 1, …, <italic>K</italic>;</p></list-item><list-item><p id="P34">Finalized the estimated patient-specific ITH score <inline-formula><mml:math id="M31"><mml:msub><mml:mrow><mml:mover><mml:mi>C</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>C</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mo fence="false" stretchy="false">{</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>ξ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mo fence="false" stretchy="false">}</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo fence="false" stretchy="false">{</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mo fence="false" stretchy="false">}</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:math></inline-formula> for <italic>i</italic> = 1, …, <italic>N</italic>;</p></list-item></list><p id="P35"><bold>Output</bold>: <inline-formula><mml:math id="M32"><mml:mo fence="false" stretchy="false">{</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>ξ</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mo fence="false" stretchy="false">}</mml:mo><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo fence="false" stretchy="false">{</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mo fence="false" stretchy="false">}</mml:mo><mml:mi>k</mml:mi></mml:msub><mml:mtext>and</mml:mtext><mml:mo fence="false" stretchy="false">{</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>C</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mo fence="false" stretchy="false">}</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:math></inline-formula> for <italic>s</italic> ∈ <italic>I<sub>i</sub></italic>, <italic>i</italic> = 1, …, <italic>N</italic>, <italic>k</italic> ∈ 1, …, <italic>K</italic>.</p></boxed-text><p id="P36">Then, the total variance across samples within subject <italic>i</italic> is <inline-formula><mml:math id="M33"><mml:msub><mml:mi>∑</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mrow><mml:mi>V</mml:mi><mml:mi>a</mml:mi><mml:mi>r</mml:mi></mml:mrow><mml:mo stretchy="false">[</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">]</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>∑</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math></inline-formula> which the ITH score can be calculated as follow: <disp-formula id="FD11"><label>(2.5)</label><mml:math id="M34"><mml:mstyle displaystyle="true"><mml:msub><mml:mrow><mml:mover><mml:mi>C</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>C</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>h</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>≜</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>∑</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>π</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>∑</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mi>var</mml:mi><mml:mo>⁡</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>s</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula></p><p id="P37">This equation estimates the degree of ITH within each patient based on the variability of the cellular compositions across samples. In particular, the numerator in <xref ref-type="disp-formula" rid="FD11">equation 2.5</xref> represents the expected variance of the cell type proportions across all samples, while the denominator represents the actual variance within each subject. In cases of small sample sizes, it’s possible for the empirically estimated value <inline-formula><mml:math id="M35"><mml:msub><mml:mrow><mml:mover><mml:mi>C</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:mrow><mml:mi>i</mml:mi></mml:msub></mml:math></inline-formula> to become negative, even though <italic>C</italic><sub><italic>i</italic></sub> should always be non-negative theoretically. Nevertheless, the primary interest typically lies in the relative ranking of <italic>C</italic><sub><italic>i</italic></sub> values, as it provides valuable insights into the association between intratumor heterogeneity and clinical phenotypes.</p><p id="P38">It should be noted that the estimation of <italic>C</italic><sub><italic>i</italic></sub> involves summation over all cell types, allowing us to investigate the variability of cellular composition within a targeted subset of cell types, denoted by <italic>T</italic>, where <italic>T</italic> = {<italic>t</italic><sub>1</sub>, …, <italic>t</italic><sub><italic>J</italic></sub>} ⊆ {1, …, <italic>K</italic>} is a subset list of all cell types. This allows for the investigation of the degree of ITH within specific subpopulations of cells, which may be of particular interest in certain contexts. Overall, the estimation of cell type proportions and the ITH parameter provides important insights into the composition of the tumor microenvironment and may aid in the development of personalized cancer therapies.</p></sec></sec><sec id="S12"><label>2.6</label><title>Deconvolution methods for benchmarking</title><p id="P39">CIBERSORT (<xref ref-type="bibr" rid="R22">Newman et al., 2015</xref>) is a deconvolution method that aims to estimate the cell-type-specific composition using <italic>v</italic>-support vector regression, a machine learning method trying to find a hyperplane to dichotomize binary groups by maximizing the margin derived from support vectors (<xref ref-type="bibr" rid="R32">Schölkopf et al., 2000</xref>). SVR tolerates data points falsely falling into a constant margin <italic>ϵ</italic> that further decides a <italic>ϵ</italic>-sensitive loss function as below: <disp-formula id="FD12"><mml:math id="M36"><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mi>L</mml:mi><mml:mi>ϵ</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:mn>0</mml:mn><mml:mo>,</mml:mo></mml:mtd><mml:mtd><mml:mtext>if</mml:mtext><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>y</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mi>g</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mo>≤</mml:mo><mml:mi>ϵ</mml:mi><mml:mo>,</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mover><mml:mi>y</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mi>g</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mi>ϵ</mml:mi></mml:mtd><mml:mtd><mml:mtext>otherwise</mml:mtext></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></disp-formula> where <italic>y</italic><sub><italic>g</italic></sub> is the vector of the observed gene expressions for gene <italic>g</italic> and <inline-formula><mml:math id="M37"><mml:msub><mml:mrow><mml:mover><mml:mi>y</mml:mi><mml:mo stretchy="false">^</mml:mo></mml:mover></mml:mrow><mml:mi>g</mml:mi></mml:msub></mml:math></inline-formula> is its expected value. <italic>y</italic><sub><italic>g</italic></sub> can be decomposed as linear combination of cell-type-specific expressions, which is Σ<sub><italic>k</italic></sub> <italic>w</italic><sub><italic>gk</italic></sub><italic>h</italic><sub><italic>k</italic></sub>. The loss function can be further defined as: <disp-formula id="FD13"><mml:math id="M38"><mml:mstyle displaystyle="true"><mml:mi>J</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">h</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mi>g</mml:mi></mml:munder><mml:msub><mml:mi>L</mml:mi><mml:mi>ϵ</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mi>k</mml:mi></mml:munder><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>λ</mml:mi><mml:munder><mml:mi>∑</mml:mi><mml:mi>k</mml:mi></mml:munder><mml:msubsup><mml:mi>h</mml:mi><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula> where λ is a tuning parameter for the penalty of the regression coefficient, which is cell type abundance in this case. However, choosing a proper <italic>ϵ</italic> tube is difficult in practice. As an alternative solution, CIBERSORT applies <italic>v</italic>-SVR, which asymptotically selects <italic>v</italic> proportions of genes as support vector, with a linear kernel to solve the loss function and select the best results from three tuning values of <italic>v</italic> = {0.25, 0.5, 0.75}. We implement CIBERSORT using the function provided by the website (<ext-link ext-link-type="uri" xlink:href="https://cibersortx.stanford.edu/">https://cibersortx.stanford.edu/</ext-link>).</p><p id="P40">EPIC (<xref ref-type="bibr" rid="R25">Racle et al., 2020</xref>) applies a weighted regression-based method to perform deconvolution, the loss function can be defined with the same notation above as follows: <disp-formula id="FD14"><mml:math id="M39"><mml:mstyle displaystyle="true"><mml:mi>J</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold">h</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mi>g</mml:mi></mml:munder><mml:msub><mml:mi>w</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>y</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mi>k</mml:mi></mml:munder><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>h</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:msup><mml:mo stretchy="false">)</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mspace width="0.2em"/><mml:mspace width="0.2em"/><mml:mspace width="0.2em"/><mml:mrow><mml:mi>s</mml:mi><mml:mo>.</mml:mo><mml:mi>t</mml:mi><mml:mo>.</mml:mo></mml:mrow><mml:mspace width="1em"/><mml:msub><mml:mi>h</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>≥</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:munder><mml:mi>∑</mml:mi><mml:mi>k</mml:mi></mml:munder><mml:msub><mml:mi>h</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>≤</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo></mml:mstyle></mml:math></disp-formula> where <italic>w</italic><sub><italic>g</italic></sub> is the weight for gene <italic>g</italic>. In EPIC, these weights are given by <italic>w</italic><sub><italic>g</italic></sub> = min(<italic>u</italic><sub><italic>g</italic></sub>, 100 × median(<italic>u</italic>)), where <inline-formula><mml:math id="M40"><mml:msub><mml:mi>u</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>∑</mml:mi><mml:mi>k</mml:mi><mml:mrow><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mfrac><mml:msub><mml:mi>w</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mi>λ</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi>ϵ</mml:mi></mml:mrow></mml:mfrac></mml:math></inline-formula> and λ<sub><italic>gk</italic></sub> represents the cell-type-specific variance. Therefore, it increases the contribution of signature genes with lower variability to the model fit. Finally, it quantifies unknown cell types by <inline-formula><mml:math id="M41"><mml:msub><mml:mi>h</mml:mi><mml:mi>K</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msubsup><mml:mi>∑</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:msub><mml:mi>h</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>.</mml:mo></mml:math></inline-formula> In this paper, we implement the EPIC model by R package EPIC downloaded from GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/GfellerLab/EPIC">https://github.com/GfellerLab/EPIC</ext-link>).</p></sec></sec><sec id="S13"><label>3</label><title>Simulation Study</title><p id="P41">We conduct extensive simulation studies to evaluate the performance and robustness of our proposed method, ICeITH, as well as benchmark it against CIBERSORT and EPIC. We evaluate the accuracy of estimated cell-type-specific proportions by comparing them to the true proportions using Spearman’s correlation coefficients and root mean squared error (RMSE). Additionally, we assess the ability of each method to discriminate patient stratification by their intratumor heterogeneity score using the F1-score, which combines precision and recall in a harmonic mean (<xref ref-type="bibr" rid="R30">Sasaki et al., 2007</xref>) <disp-formula id="FD15"><mml:math id="M42"><mml:mstyle displaystyle="true"><mml:mtext>F1-score</mml:mtext><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>2</mml:mn><mml:mo>×</mml:mo><mml:mtext>Precision</mml:mtext><mml:mo>×</mml:mo><mml:mtext>Recall</mml:mtext></mml:mrow><mml:mrow><mml:mtext>Precision</mml:mtext><mml:mo>+</mml:mo><mml:mtext>Recall</mml:mtext></mml:mrow></mml:mfrac><mml:mo>.</mml:mo></mml:mstyle></mml:math></disp-formula></p><p id="P42">The precision is defined as the ratio of true positives to the total number of patients classified as high intratumor heterogeneity (true positive + false positive). It measures the accuracy of each method in correctly classifying patients into the high intratumor heterogeneity subgroup. The recall is the ratio of true positives to the total number of patients who actually have high intratumor heterogeneity (true positive + false negative). It measures the method’s ability to capture all patients with high intratumor heterogeneity. A higher F1-score indicates better performance in discriminating patients based on their intratumor heterogeneity score. We used this metric to compare and evaluate the effectiveness of each method in patient stratification.</p><sec id="S14"><label>3.1</label><title>Simulation set-ups</title><p id="P43">To generate cell-type-specific reference profiles, we first randomly assign 500 genes to four immune cell types. Each gene is assumed to be highly expressed in one of the immune cell types and has lower expression in other cell types. To mimic the heterogeneity seen in real data, we divide the genes into three levels of expression: low, medium, and high. The average expression profiles for each level are simulated from a uniform distribution with distinct ranges. For example, lowly expressed genes have means (under log-scale) ranging from 2 to 4, and the means of cell-specific genes are up-regulated to the range of 3.5 to 5. Similarly, genes with means drawn from the support between 4 to 6 and 6 to 8 represent median and high-level expressed genes, respectively, and the means of cell-specific genes are up-regulated to the ranges of 5.5 to 7 and 7.5 to 9. To capture the mean-variance relationship seen in real data, we calculate the mean-variance relationship from FPKM-UQ normalized data across cell-type-specific genes, assuming genes that share the same average expression profile have the same variability within each cell type. We then generate fifty purified reference samples for each cell type by log-normal distribution with gene-specific average expression profiles and variability, following the strategy from <xref ref-type="bibr" rid="R38">Wilson et al. (2020)</xref>.</p><p id="P44">In the second step of the simulation study, we aim to simulate mixed tumor samples for 100 patients with multiple tumor samples assigned to each patient. To better mimic the data characteristics of the real scenarios, we consider including within-subject correlation in multiregion gene expression data generation (<xref ref-type="fig" rid="F1">Figure 1</xref>). Patient-specific average expressions for each cell type and gene are generated by a normal distribution with cell-type-specific mean expression and variance determined at the population level, as per the previous step in the process. We then simulate cell-type-specific expression from a log-normal distribution across samples for each patient. To simulate the remaining immune cell proportions, we first draw the intratumor heterogeneity score from a uniform distribution ranging from 0.1 to 3.0. Next, we simulate cell proportions from a Dirichlet distribution, with the average abundance across patient samples ranging from 0.1 to 0.4. The ultimate expression profile for each sample is obtained as a weighted summation of cell-type-specific expressions.</p><p id="P45">All the results presented are summarized over 100 Monte Carlo datasets. Overall, this simulation design allowed us to investigate the performance and robustness of our method, ICeITH, under realistic and diverse scenarios of intratumor heterogeneity and cell-type-specific gene expression variability.</p></sec><sec id="S15"><label>3.2</label><title>Simulation results</title><sec id="S16"><label>3.2.1</label><title>Results with four cell types</title><p id="P46">Based on the simulation settings in the previous section, where the independence assumption between mixed samples within each patient no longer holds, the ICeITH model provides the most accurate estimation of cell type proportions in terms of the Spearman correlation, based on the sampling distribution obtained from 100 Monte Carlo datasets (<xref ref-type="fig" rid="F3">Figure 3 (a)</xref>). The medium value of Spearman correlation equals 0.97, compared with the medium value of 0.92 and 0.88 for CIBERSORT and EPIC, respectively. This indicates that the estimates from ICeITH model not only show a linear relationship with the true values but are also consistent with the rank, reducing the risk of falsely recognizing the dominant cell type. Additionally, the ICeITH model demonstrates its estimation accuracy by investigating the root-mean-square error (RMSE) in <xref ref-type="fig" rid="F3">Figure 3 (b)</xref>. Although the sampling distributions of RMSE, obtained from ICeITH and CIBERSORT, seem to be comparable, the medium value (0.045) of RMSE from ICeITH is still better than the medium value (0.049) from CIBERSORT. However, EPIC suffers from the inflation of the estimation variance and false detection or deletion of certain cell types. We further pick an example from simulated datasets to visualize the performance of these three methods (<xref ref-type="fig" rid="F3">Figure 3 (d-f)</xref>). Given the estimated cell type proportions, we empirically estimate ITH scores for these three methods based on <xref ref-type="disp-formula" rid="FD11">equation 2.5</xref> and further dichotomize patients into high ITH and low ITH groups by the medium value of estimated ITH scores. To quantify the classification performance in terms of precision and recall, we further compare the F1-score of all methods (<xref ref-type="fig" rid="F3">Figure 3 (c)</xref>). All three methods provide reasonable F1-score, though our method performs better (medium = 0.78). Additionally, we assess the classification accuracy in terms of Area under the receiver operating characteristics curve (AUC) and ICeITH achieves the best performance (medium = 0.85) (<xref ref-type="supplementary-material" rid="SD1">Figure S1 (a)</xref>). Cumulatively, we conclude the proposed empirical solution is sufficient to detect patients with different variability of cell type compositions.</p></sec><sec id="S17"><label>3.2.2</label><title>Results with 22 cell types</title><p id="P47">To understand the performance of all methods with substantially more cell types, we also extend our simulation design to 22 cell types with 1000 genes from 50 patients. The rest of the simulation setting follows exactly as discussed in <xref ref-type="sec" rid="S14">Section 3.1</xref>. <xref ref-type="supplementary-material" rid="SD1">Figure S2(a)</xref> shows that ICeITH provides the highest Spearman correlation (medium 0.63) with the true proportions, while CIBERSORT (medium = 0.37) and EPIC (medium = 0.27) perform poorly due to their failure to identify the correct rank for cell type proportion estimation with the increased number of cells. ICeITH also achieves the lowest RMSE values (medium = 0.04) compared to CIBERSORT (medium = 0.06) and EPIC (medium = 0.08) in <xref ref-type="supplementary-material" rid="SD1">Figure S2(b)</xref>. The inflation of the standard error of the sampling distribution of RMSE in EPIC leads to the false detection and ignorance of certain cell types, as confirmed by examining a specific example (<xref ref-type="supplementary-material" rid="SD1">Figure S2(e-g)</xref>). We also evaluate the classification performance of all three methods based on the estimated cell type proportions, with ITH scores calculated using <xref ref-type="disp-formula" rid="FD11">equation 2.5</xref>. The patients are further classified into high and low ITH groups based on the medium value, and the classification performance is evaluated using the F1-score and AUC. All three methods achieve reasonable F1-score and AUC, with our method performing better (mean F1-score = 0.74, mean AUC = 0.81) (<xref ref-type="supplementary-material" rid="SD1">Figure S2 (c,d)</xref>). Therefore, our proposed empirical solution can handle large-scale datasets with multiple cell types and is robust to discover the variability of cell type compositions within each patient.</p></sec><sec id="S18"><label>3.2.3</label><title>Sensitivity analysis</title><p id="P48">To evaluate the robustness of the ICeITH model, we conduct a sensitivity analysis by simulating four different scenarios. For each scenario, the same number of samples, from three to six, are assigned to each patient since sequencing above six samples per patient is usually not practical, while other simulation settings remain unchanged. Comparing the sampling distribution of the Spearman correlation from the estimated cell type proportions across three methods (<xref ref-type="fig" rid="F4">Figure 4 (a)</xref>), the ICeITH model outperforms other methods and achieves better accuracy in terms of both mean and standard error with an increased number of samples per patient, while the medium values of the Spearman correlation from replicated experiments remain stable under both CIBERSORT and EPIC. This is because both CIBERSORT and EPIC perform deconvolution independently across samples, while our proposed method takes the inner correlation of samples within each patient into consideration. Although the sampling distribution of RMSE from the ICeITH model suffers from inflation of standard error in the first scenario where patients shared a limited sample size, it rapidly decreased as more samples are available for each patient (<xref ref-type="fig" rid="F4">Figure 4 (b, d)</xref>). For the F1-score derived from the estimates of ITH scores, our method remains comparable with the other two methods when patients suffer from a limited sample size, but it starts outperforming as the sample size for each patient increases (<xref ref-type="fig" rid="F4">Figure 4 (c)</xref>). We observe a similar trend for the AUC across various scenarios (<xref ref-type="supplementary-material" rid="SD1">Figures S1 (b)</xref>). More importantly, under the least favorable case, where each patient only has limited samples, all three methods still provide a reasonable F1-score. This indicates that our method is robust for calculating the relative cell type abundance and detecting patients with different variability of cell type compositions</p><p id="P49">In addition, we evaluate the robustness of our proposed model in scenarios (1) where genes from the reference panel exhibit different expression patterns compared to the observed samples and (2) under varying degrees of within-subject correlations. ICeITH maintains a superior performance compared to CIBERSORT under these conditions (<xref ref-type="supplementary-material" rid="SD1">Figure S3,4</xref>). Details are provided in the <xref ref-type="supplementary-material" rid="SD1">Supplementary Material Section S3.3</xref>.</p></sec></sec></sec><sec id="S19"><label>4</label><title>Real data application</title><sec id="S20"><label>4.1</label><title>Reference profile</title><p id="P50">To construct the reference profile, we download a gene expression dataset from the NCBI Gene Expression Omnibus with accession number (GSE60424, <xref ref-type="bibr" rid="R20">Linsley et al. (2014)</xref>). This study investigates the whole transcriptome signatures of six immune cells and whole blood from patients. While the whole blood is collected into a Tempus tube, the rest of the primary fresh blood sample is processed into highly purified populations of neutrophils, monocytes, B cells, CD4 T cells, CD8 T cells, and natural killer cells. RNA extraction is performed on each cell subset, and progressed into RNA sequencing libraries (Illumina TruSeq), with a targeted read depth of around 20M reads. The reads were then demultiplexed and mapped to human genome hg19. The reads were summarized into HTSeq counts by the RSEM package and annotated using the Ensembl database GRCh37 (<xref ref-type="bibr" rid="R13">Hubbard et al., 2002</xref>).</p></sec><sec id="S21"><label>4.2</label><title>Application to TRACERx data</title><sec id="S22"><label>4.2.1</label><title>Preprocessing TRACERx data</title><p id="P51">Multi-region WES and RNA sequencing data of the TRACERx cohort are obtained from <xref ref-type="bibr" rid="R15">Jamal-Hanjani et al. (2017)</xref>. Whole-exome sequencing is performed on extracted DNA samples and described in <xref ref-type="bibr" rid="R15">Jamal-Hanjani et al. (2017)</xref>. Tumor purity for each sample is estimated by Sequenza (<xref ref-type="bibr" rid="R10">Favero et al., 2015</xref>). Some matched samples also proceed to RNA sequencing. Specifically, alignment and reads mapping (human hg19 reference genome) is performed by the STAR package (<xref ref-type="bibr" rid="R8">Dobin et al., 2013</xref>) and tabulated to HTSeq counts by the RSEM package (Li et al., 2011). Clinical information for the TRACERx cohort is downloaded from <ext-link ext-link-type="uri" xlink:href="https://www.nejm.org/doi/full/10.1056/NEJMoa1616288">https://www.nejm.org/doi/full/10.1056/NEJMoa1616288</ext-link>.</p><p id="P52">The mixed tumor counts are then normalized together with reference counts by the TMM procedure using R package edgeR (<xref ref-type="bibr" rid="R27">Robinson et al., 2010</xref>), and the batch effect is adjusted using R package combat-seq (<xref ref-type="bibr" rid="R40">Zhang et al., 2020</xref>). To ensure comparability across samples, we perform scale normalization with total UMI across samples. We apply signature genes, obtained from RNA-seq reference (LM6) available on the CIBERSORT website (<ext-link ext-link-type="uri" xlink:href="https://cibersort.stanford.edu/download.php">https://cibersort.stanford.edu/download.php</ext-link>), to perform deconvolution. In addition, we filter out signature genes with cell-type-specific variance greater than 1.5, and this results in 523 genes after matching genes with tumor samples. Note: the reference matrix is sparse due to the blood sample type. We add a small number (e.g. 0.01) to the cell-type-specific variance that equals 0 so that it guarantees a feasible optimization when evaluating the gradient of variational parameter <italic>τ</italic> in <xref ref-type="supplementary-material" rid="SD1">equation S.9</xref>.</p></sec><sec id="S23"><label>4.2.2</label><title>Results on TRACERx data</title><p id="P53">We apply the ICeITH model and CIBERSORT to analyze RNA-seq data in patients with non-small cell lung cancer collected from the TRACERx cohort (<xref ref-type="bibr" rid="R15">Jamal-Hanjani et al., 2017</xref>). The multi-region DNA-seq and RNA-seq data are available in 45 patients (patients with a number of regions available greater than one), and it results in 140 tumors in total (<xref ref-type="supplementary-material" rid="SD1">Table S1</xref>). We seek to associate the survival outcome with intratumor heterogeneity scores estimated from our proposed method.</p><p id="P54">Specifically, we fit both the ICeITH model and CIBERSORT on the normalized dataset to estimate the relative abundance for six immune cell types. Given the tumor cell fractions obtained by Sequenza (<xref ref-type="bibr" rid="R10">Favero et al., 2015</xref>) whole-exome sequencing data for all samples, we obtain the adjusted immune cell type proportions by renormalizing them to one minus tumor cell fraction for each sample.</p><p id="P55">The estimated proportions from six immune cell types and tumor cells are displayed in <xref ref-type="fig" rid="F5">Figure 5</xref> (a). We observe a low concentration of most immune cell types, with the exception of a high variation in monocyte infiltration. This result is consistent with CIBSERSORT estimates (<xref ref-type="fig" rid="F5">Figure 5 (b)</xref>, Spearman correlation = 0.82). Previous studies (<xref ref-type="bibr" rid="R15">Jamal-Hanjani et al., 2017</xref>; <xref ref-type="bibr" rid="R39">Zhang et al., 2014</xref>) shed light on the spatial divergence in genomic instability and provide the impact of this intratumor heterogeneity on the increased risk of patient survival. The tumor microenvironment is also dominated by tumor-surrounded interactions (<xref ref-type="bibr" rid="R37">Whiteside et al., 1998</xref>), i.e., various immune effector cells with pro- and anti-tumor functions. Therefore, we are interested in investigating the influence of intratumor heterogeneity, defined as the spatial variability of immune cells that provide either pro- or anti-tumor activities within a patient, on disease-free survival probability. For immune cells (e.g., neutrophils and monocytes) act pro-tumor functions, we estimate the pro-tumor ITH scores using adjusted Neutrophils and Monocytes proportions by <xref ref-type="disp-formula" rid="FD11">equation 2.5</xref>, and then we classify patients as high and low pro-tumor ITH groups, respectively, based on the medium value. The results show that patients with a higher pro-tumor ITH are at significantly increased risk compared with a lower pro-tumor ITH (<xref ref-type="fig" rid="F5">Figure 5 (c)</xref>, <italic>P</italic> value = 0.05), which indicates a greater spatial divergence of immune cells functioning as a pro-tumor process will suppress the immune response to tumors and negatively affect patient survival. However, it appears that this finding is confounded by the overall immune context of each patient. This is motivated by the findings of <xref ref-type="bibr" rid="R1">AbdulJabbar et al. (2020)</xref> that differentiate highly immune-infiltrated tumor regions by the number of immune hot and cold tumors at a population level reveal patient survival. We further stratify a subset of patients (<italic>n</italic> = 44) with available immune identification into immune context low vs. high groups based on the median number of immune cold and hot regions. Interestingly, the most at-risk group is patients with a freeze immune context (i.e., low immune context and low pro-tumor ITH), and the other groups stayed at a comparably decreased risk (<xref ref-type="fig" rid="F5">Figure 5 (e)</xref>, <italic>P</italic> value = 0.003). Meanwhile, tumors with increased ITH obtained from immune cells (i.e., B cells, CD4T, CD8T, and natural killer cells) shaped as anti-tumor activities seem to be associated with decreased risk (<xref ref-type="fig" rid="F5">Figure 5 (d)</xref>, <italic>P</italic> value = 0.12), which indicates immune cells with anti-tumor process play an important role on eliminating tumor cells. This is further proven when we stratify patients by both immune context and anti-tumor ITH. We observe patient with a increased anti-tumor ITH is always associated with a decreased risk of survival within each immune context (<xref ref-type="fig" rid="F5">Figure 5</xref>, <italic>P</italic> value = 0.003). Cumulatively, we conclude that patients stratified by both immune context and ITH further provide us further evidence that the variability of immune cell type compositions with different activity processes is capable of predicting the prognosis in early-stage lung cancer (<xref ref-type="fig" rid="F5">Figure 5 (e,f)</xref>, <italic>P</italic> value = 0.003).</p><p id="P56">Motivated by the simulation results that the performance of the ICeITH model increases as more samples are sequenced from each patient, we further keep patients (<italic>n</italic> = 28) with more than two regions available and explore the association of intratumor heterogeneity of targeted immune cell types to disease-free survival outcomes. We observe a similar trend as shown in <xref ref-type="fig" rid="F5">Figure 5</xref>. Specifically, for immune cells (i.e., neutrophils and monocytes) that have pro-tumor functions, patients with a higher ITH are at a significantly increased risk compared with a lower ITH (<xref ref-type="supplementary-material" rid="SD1">Figure S5 (a)</xref>, <italic>P</italic> value = 0.03). Data from patients stratified by both immune context and ITH further confirms that a higher ITH are associated with a worse outcome (<xref ref-type="supplementary-material" rid="SD1">Figure S5 (c)</xref>). However, possibly due to the limited sample size, such an effect is not statistically significant (<italic>P</italic> value = 0.1). Meanwhile, patients with high ITH in anti-tumor immune cells (i.e., B cells, CD4T, CD8T and natural killer cells) are at a reduced risk of survival outcome (<xref ref-type="supplementary-material" rid="SD1">Figure S5 (b)</xref>, <italic>P</italic> value = 0.04). When we further stratify patients with overall immune context, patients with high ITH still consistently have better survival outcomes (<xref ref-type="supplementary-material" rid="SD1">Figure S5 (d)</xref>). Subsetting patients with a larger sample size provides additional evidence that our proposed method is able to capture the targeted immune cell variability and thus may predict prognosis in early-stage lung cancer.</p><p id="P57">Additionally, we use summary statistics of immune cell prevalence at the patient level, such as quartiles, median, mean, and maximum, to categorize patients into different risk levels as an alternative approach to our proposed ITH score. The results indicate that while neutrophil cell prevalence did not strongly impact survival, increased heterogeneity in monocyte cells was associated with poorer survival outcomes (<xref ref-type="supplementary-material" rid="SD1">Figure S6</xref>).</p></sec></sec><sec id="S24"><label>4.3</label><title>Application to MDA-ITH data</title><p id="P58">We further extend our analysis to investigate the impact of ITH on the prognosis of lung cancer patients from the MD Anderson-ITH (MDA-ITH) project, where multi-region RNA sequencing technology is performed on 25 patients, and it results in 116 samples in total (<xref ref-type="supplementary-material" rid="SD1">Table S2</xref>). We normalize the mixed bulk counts together with reference counts and follow the same steps as described in the <xref ref-type="sec" rid="S22">Section 4.2.1.</xref> After we filter out signature genes with cell-type-specific variance greater than 1.5 and match genes with mixed bulk samples, the data results in 605 genes to perform deconvolution. Previous MDA-ITH studies mostly focused on the ITH of mutations and copy number variations, but the heterogeneity of immune cell infiltration has not been carefully studied before. Again, we apply the GSE60424 dataset (<xref ref-type="bibr" rid="R20">Linsley et al., 2014</xref>) as a reference profile and fit both the ICeITH model and CIBERSORT on the normalized dataset followed by the same step from the previous section. Due to the lack of matched DNA-seq data, we are not able to adjust estimated immune cell type proportions by tumor fraction for each sample. And thus, mixed samples sequenced from each patient consist of both tumors and healthy tissue. This may give us less power to detect the association between ITH and overall survival outcomes.</p><p id="P59">The estimated proportions from six immune cell types are presented in <xref ref-type="fig" rid="F6">Figure 6 (a)</xref>. Despite the great variation in the prevalence of neutrophils and monocytes cells, we observe the majority of immune cell types (i.e.g, B cells, CD4T, CD8T, NK) with relatively low abundance across samples. The correlation between the ICeITH and CIBERSORT estimates is lower than TRACRx but still reasonable (<xref ref-type="fig" rid="F6">Figure 6 (b)</xref>, Spearman correlation = 0.58). This may partially be due to the fact that mixed bulk samples are sequenced from either tumor or healthy tissues so it adds an extra confounding factor for both deconvolution methods. To further investigate the impact of intratumor heterogeneity shaped by immune cells with different underlying activity processes on overall survival, we first estimate the pro-tumor ITH score from neutrophils and monocyte abundance for all MDA-ITH patients. Patient stratification by pro-tumor ITH level did not show a significant association with survival outcome (<xref ref-type="fig" rid="F6">Figure 6 (c)</xref>, <italic>P</italic> value = 0.42). The true signal may be eliminated by the limited number of patients enrolled in the study or a mix of tumoral and healthy tissues sequenced for deconvolution. On the other hand, we observe patients with increased anti-tumor ITH, obtained by immune cells functioning as an anti-tumor process, remain associated with a lower risk of overall survival (<xref ref-type="fig" rid="F6">Figure 6 (d)</xref>, <italic>P</italic> value = 0.012). This finding is consistent with results that appear in TRACERx data, and together we draw the conclusion that the variability of immune cell-type compositions can serve to predict the prognosis in early-stage lung cancer.</p></sec></sec><sec id="S25" sec-type="discussion"><label>5</label><title>Discussion</title><p id="P60">In this paper, we propose a novel statistical method, ICeITH, to estimate the immune cell-type abundance from tumor samples using multi-region transcriptomic sequencing data. ICeITH is built on a hierarchical Bayesian approach and has several novelties to current state-of-the-art methods. First, ICeITH models pure cell-type-specific expression profiles as a log-normal distribution to account for the over-dispersion in data with patient-specific mean expression parameters. Our method allows the modeling of patient-specific mean expression across tumor samples from the same patient to capture the within-subject correlations. Second, our proposal adopts a Bayesian approach that is able to leverage the prior information from the reference profile. Compared with previous works that fix the cell-type-specific profiles as a given constant, a Bayesian approach has more flexibility when the cell-type-specific profiles have variations among patients. Lastly, ICeITH assumes the TIL compositions follow Dirichlet distributions with a patient-specific parameter. Such modeling can naturally quantify the variability of targeted cellular composition (e.g. immune cells shape pro- and anti-tumor process) across samples from a single patient for intratumor heterogeneity estimations. We demonstrate that patient stratification based on ITH score is closely associated with patient survival outcomes.</p><p id="P61">The current real data analysis is limited to the six immune cell types. This is because as the number of cell types increases, the difficulty of accurately estimating the proportions while accounting for the variation within each subject also greatly increases. This is especially true when the number of samples collected from each subject is limited in real-world scenarios. As technology advances and collecting bulk RNA samples becomes cheaper, it will be more feasible to collect larger numbers of samples from each patient. In such cases, we believe our ICeITH model is still capable of handling a higher number of cell types when the sample size is large enough.</p><p id="P62">The proposed method uses a reference panel to provide prior knowledge on the pure tissue profile and guide the deconvolution process. However, it should be acknowledged that the reference panel and the data of interest are often obtained from different studies. Integrating data across studies can involve complicated platform/sample/technology heterogeneity, introducing substantial analytical bias into the results. Such issues have also been recognized and investigated in recent publications, e.g., <xref ref-type="bibr" rid="R7">Chen et al. (2022)</xref> proposed methodologies for integrating multiple reference panels for deconvolution, while <xref ref-type="bibr" rid="R9">Dong et al. (2021)</xref> developed an ensemble method that aggregates deconvolution results estimated with different reference panels. These methods specifically tackled the challenge of mitigating cross-study heterogeneity when integrating data from diverse sources.</p><p id="P63">Our proposed method solves the model efficiently by applying the collapsed variational inference method in the optimization step. We update the variational parameters including patient-specific mean expression and variability and cell type proportions at each iteration. To speed up the optimization, we initialize cell type proportions with SVR and ICeITH converges well under both simulation and real data analyses. We derive closed-form gradients from the objective function to further shorten the computational time. The total running time of the ICeITH model in a dataset containing 140 samples and 523 genes is usually within 30 minutes (using R on a MacBook Pro, 2.4 GHz Intel Core i5).</p><p id="P64">Currently, our method needs additional information for tumor purity adjustment as our reference panel only consists of immune cell types. Although it is possible for researchers to obtain such information based on existing tools, similar to our analytical procedure with the TRACERx data, it actually provides great convenience if such a step can be automatically incorporated into the analysis pipeline. We acknowledge this limitation and suggest that a comprehensive evaluation of existing tools is beyond the scope of this work. We consider this an important extension for future works. On another thread, our current method applies to multi-region RNA-seq data as motivated by the TRACERx and MDA-ITH studies. In reality, a more common scenario is the multi-omics sequencing of multiple tumor slices for the same patients. The same principle of the proposed method should apply to the multiomics application, but the data distributions will be different. This is another promising direction for future research, and could potentially have a greater impact on ITH research.</p></sec><sec sec-type="supplementary-material" id="SM"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="SD1"><label>Supplementary Material</label><caption><p id="P65">The Supplementary Material contains additional model derivation and simulation results.</p></caption><media xlink:href="EMS190323-supplement-Supplementary_Material.pdf" mimetype="application" mime-subtype="pdf" id="d11aAdFbC" position="anchor"/></supplementary-material></sec></body><back><ack id="S26"><title>Acknowledgments</title><p>This study makes use of data generated by the TRAcking Non-small Cell Lung Cancer Evolution Through Therapy (Rx) (TRACERx) Consortium and provided by the UCL Cancer Institute and The Francis Crick Institute. The TRACERx study is sponsored by University College London, funded by Cancer Research UK and coordinated through the Cancer Research UK and UCL Cancer Trials Centre (<xref ref-type="bibr" rid="R15">Jamal-Hanjani et al., 2017</xref>).</p><p>This study is supported by the MD Anderson Lung Cancer Moon Shot Program, the Cancer Prevention and Research Institute of Texas Multi-Investigator Research Award grant (RP160668), the National Cancer Institute of the National Institute of Health Research Project Grant (R01CA234629-01), and the UT Lung Specialized Programs of Research Excellence Grant (P50CA70907).</p><sec id="S27"><title>Funding</title><p>Dr. Wistuba reports personal fees from Genentech/Roche, Bristol-Myers Squibb, Medscape, Astra Zeneca/Medimmune, Pfizer, Ariad, HTG Molecular, Asuragen, Merck, GlaxoSmithK-line, MSD and grants from Genentech, Oncoplex, HTG Molecular, DepArray, Merck, Bristol-Myers Squibb, Medimmune, Adaptive, Adaptimmune, EMD Serono, Pfizer, Takeda, Amgen, Karus, Johnson &amp; Johnson, Bayer, 4D, Novartis and Perkin-Elmer (Akoya), outside the submitted work; Dr. Zhang reports personal fees from BMS, AstraZeneca, Geneplus, OrigMed, Innovent, grant from Merck, outside the submitted work.</p></sec></ack><ref-list><ref id="R1"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>AbdulJabbar</surname><given-names>K</given-names></name><name><surname>Raza</surname><given-names>S</given-names></name><name><surname>Rosenthal</surname><given-names>R</given-names></name><name><surname>Jamal-Hanjani</surname><given-names>M</given-names></name><name><surname>Veeriah</surname><given-names>S</given-names></name><name><surname>Akarca</surname><given-names>A</given-names></name><name><surname>Lund</surname><given-names>T</given-names></name><name><surname>Moore</surname><given-names>D</given-names></name><name><surname>Salgado</surname><given-names>R</given-names></name><name><surname>Al Bakir</surname><given-names>M</given-names></name><collab>Others</collab></person-group><article-title>Geospatial immune variability illuminates differential evolution of lung adenocarcinoma</article-title><source>Nature Medicine</source><year>2020</year><volume>26</volume><fpage>1054</fpage><lpage>1062</lpage><pub-id pub-id-type="pmcid">PMC7610840</pub-id><pub-id pub-id-type="pmid">32461698</pub-id><pub-id pub-id-type="doi">10.1038/s41591-020-0900-x</pub-id></element-citation></ref><ref id="R2"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Andrade Barbosa</surname><given-names>B</given-names></name><name><surname>Asten</surname><given-names>S</given-names></name><name><surname>Oh</surname><given-names>J</given-names></name><name><surname>Farina-Sarasqueta</surname><given-names>A</given-names></name><name><surname>Verheij</surname><given-names>J</given-names></name><name><surname>Dijk</surname><given-names>F</given-names></name><name><surname>Laarhoven</surname><given-names>H</given-names></name><name><surname>Ylstra</surname><given-names>B</given-names></name><name><surname>Garcia Vallejo</surname><given-names>J</given-names></name><name><surname>Wiel</surname><given-names>M</given-names></name><collab>Others</collab></person-group><article-title>Bayesian log-normal deconvolution for enhanced in silico microdissection of bulk gene expression data</article-title><source>Nature Communications</source><year>2021</year><volume>12</volume><fpage>1</fpage><lpage>13</lpage><pub-id pub-id-type="pmcid">PMC8528834</pub-id><pub-id pub-id-type="pmid">34671028</pub-id><pub-id pub-id-type="doi">10.1038/s41467-021-26328-2</pub-id></element-citation></ref><ref id="R3"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bacher</surname><given-names>R</given-names></name><name><surname>Kendziorski</surname><given-names>C</given-names></name></person-group><article-title>Design and computational analysis of single-cell RNA-sequencing experiments</article-title><source>Genome Biology</source><year>2016</year><volume>17</volume><fpage>1</fpage><lpage>14</lpage><pub-id pub-id-type="pmcid">PMC4823857</pub-id><pub-id pub-id-type="pmid">27052890</pub-id><pub-id pub-id-type="doi">10.1186/s13059-016-0927-y</pub-id></element-citation></ref><ref id="R4"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Bindea</surname><given-names>G</given-names></name><name><surname>Mlecnik</surname><given-names>B</given-names></name><name><surname>Tosolini</surname><given-names>M</given-names></name><name><surname>Kirilovsky</surname><given-names>A</given-names></name><name><surname>Waldner</surname><given-names>M</given-names></name><name><surname>Obenauf</surname><given-names>A</given-names></name><name><surname>Angell</surname><given-names>H</given-names></name><name><surname>Fredriksen</surname><given-names>T</given-names></name><name><surname>Lafontaine</surname><given-names>L</given-names></name><name><surname>Berger</surname><given-names>A</given-names></name><collab>Others</collab></person-group><article-title>Spatiotemporal dynamics of intratumoral immune cells reveal the immune landscape in human cancer</article-title><source>Immunity</source><year>2013</year><volume>39</volume><fpage>782</fpage><lpage>795</lpage><pub-id pub-id-type="pmid">24138885</pub-id></element-citation></ref><ref id="R5"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Blei</surname><given-names>D</given-names></name><name><surname>Kucukelbir</surname><given-names>A</given-names></name><name><surname>McAuliffe</surname><given-names>J</given-names></name></person-group><article-title>Variational inference: A review for statisticians</article-title><source>Journal Of The American Statistical Association</source><year>2017</year><volume>112</volume><fpage>859</fpage><lpage>877</lpage></element-citation></ref><ref id="R6"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>G</given-names></name><name><surname>Ning</surname><given-names>B</given-names></name><name><surname>Shi</surname><given-names>T</given-names></name></person-group><article-title>Single-cell RNA-seq technologies and related computational data analysis</article-title><source>Frontiers In Genetics</source><year>2019</year><fpage>317</fpage><pub-id pub-id-type="pmcid">PMC6460256</pub-id><pub-id pub-id-type="pmid">31024627</pub-id><pub-id pub-id-type="doi">10.3389/fgene.2019.00317</pub-id></element-citation></ref><ref id="R7"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Chen</surname><given-names>C</given-names></name><name><surname>Leung</surname><given-names>Y</given-names></name><name><surname>Ionita</surname><given-names>M</given-names></name><name><surname>Wang</surname><given-names>L</given-names></name><name><surname>Li</surname><given-names>M</given-names></name></person-group><article-title>Omnibus and robust deconvolution scheme for bulk RNA sequencing data integrating multiple single-cell reference sets and prior biological knowledge</article-title><source>Bioinformatics</source><year>2022</year><volume>38</volume><fpage>4530</fpage><lpage>4536</lpage><pub-id pub-id-type="pmcid">PMC9525013</pub-id><pub-id pub-id-type="pmid">35980155</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/btac563</pub-id></element-citation></ref><ref id="R8"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dobin</surname><given-names>A</given-names></name><name><surname>Davis</surname><given-names>C</given-names></name><name><surname>Schlesinger</surname><given-names>F</given-names></name><name><surname>Drenkow</surname><given-names>J</given-names></name><name><surname>Zaleski</surname><given-names>C</given-names></name><name><surname>Jha</surname><given-names>S</given-names></name><name><surname>Batut</surname><given-names>P</given-names></name><name><surname>Chaisson</surname><given-names>M</given-names></name><name><surname>Gingeras</surname><given-names>T</given-names></name></person-group><article-title>STAR: ultrafast universal RNA-seq aligner</article-title><source>Bioinformatics</source><year>2013</year><volume>29</volume><fpage>15</fpage><lpage>21</lpage><pub-id pub-id-type="pmcid">PMC3530905</pub-id><pub-id pub-id-type="pmid">23104886</pub-id><pub-id pub-id-type="doi">10.1093/bioinformatics/bts635</pub-id></element-citation></ref><ref id="R9"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Dong</surname><given-names>M</given-names></name><name><surname>Thennavan</surname><given-names>A</given-names></name><name><surname>Urrutia</surname><given-names>E</given-names></name><name><surname>Li</surname><given-names>Y</given-names></name><name><surname>Perou</surname><given-names>C</given-names></name><name><surname>Zou</surname><given-names>F</given-names></name><name><surname>Jiang</surname><given-names>Y</given-names></name></person-group><article-title>SCDC: bulk gene expression deconvolution by multiple single-cell RNA sequencing references</article-title><source>Briefings In Bioinformatics</source><year>2021</year><volume>22</volume><fpage>416</fpage><lpage>427</lpage><pub-id pub-id-type="pmcid">PMC7820884</pub-id><pub-id pub-id-type="pmid">31925417</pub-id><pub-id pub-id-type="doi">10.1093/bib/bbz166</pub-id></element-citation></ref><ref id="R10"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Favero</surname><given-names>F</given-names></name><name><surname>Joshi</surname><given-names>T</given-names></name><name><surname>Marquard</surname><given-names>A</given-names></name><name><surname>Birkbak</surname><given-names>N</given-names></name><name><surname>Krzystanek</surname><given-names>M</given-names></name><name><surname>Li</surname><given-names>Q</given-names></name><name><surname>Szallasi</surname><given-names>Z</given-names></name><name><surname>Eklund</surname><given-names>A</given-names></name></person-group><article-title>Sequenza: allele-specific copy number and mutation profiles from tumor sequencing data</article-title><source>Annals Of Oncology</source><year>2015</year><volume>26</volume><fpage>64</fpage><lpage>70</lpage><pub-id pub-id-type="pmcid">PMC4269342</pub-id><pub-id pub-id-type="pmid">25319062</pub-id><pub-id pub-id-type="doi">10.1093/annonc/mdu479</pub-id></element-citation></ref><ref id="R11"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Fenton</surname><given-names>L</given-names></name></person-group><article-title>The sum of log-normal probability distributions in scatter transmission systems</article-title><source>IRE Transactions On Communications Systems</source><year>1960</year><volume>8</volume><fpage>57</fpage><lpage>67</lpage></element-citation></ref><ref id="R12"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Gaudreau</surname><given-names>P</given-names></name><name><surname>Negrao</surname><given-names>M</given-names></name><name><surname>Mitchell</surname><given-names>K</given-names></name><name><surname>Reuben</surname><given-names>A</given-names></name><name><surname>Corsini</surname><given-names>E</given-names></name><name><surname>Li</surname><given-names>J</given-names></name><name><surname>Karpinets</surname><given-names>T</given-names></name><name><surname>Wang</surname><given-names>Q</given-names></name><name><surname>Diao</surname><given-names>L</given-names></name><name><surname>Wang</surname><given-names>J</given-names></name><collab>Others</collab></person-group><article-title>Neoadjuvant Chemotherapy Increases Cytotoxic T Cell, Tissue Resident Memory T Cell, and B Cell Infiltration in Resectable NSCLC</article-title><source>Journal Of Thoracic Oncology</source><year>2021</year><volume>16</volume><fpage>127</fpage><lpage>139</lpage><pub-id pub-id-type="pmcid">PMC7775914</pub-id><pub-id pub-id-type="pmid">33096269</pub-id><pub-id pub-id-type="doi">10.1016/j.jtho.2020.09.027</pub-id></element-citation></ref><ref id="R13"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hubbard</surname><given-names>T</given-names></name><name><surname>Barker</surname><given-names>D</given-names></name><name><surname>Birney</surname><given-names>E</given-names></name><name><surname>Cameron</surname><given-names>G</given-names></name><name><surname>Chen</surname><given-names>Y</given-names></name><name><surname>Clark</surname><given-names>L</given-names></name><name><surname>Cox</surname><given-names>T</given-names></name><name><surname>Cuff</surname><given-names>J</given-names></name><name><surname>Curwen</surname><given-names>V</given-names></name><name><surname>Down</surname><given-names>T</given-names></name><collab>Others</collab></person-group><article-title>The Ensembl genome database project</article-title><source>Nucleic Acids Research</source><year>2002</year><volume>30</volume><fpage>38</fpage><lpage>41</lpage><pub-id pub-id-type="pmcid">PMC99161</pub-id><pub-id pub-id-type="pmid">11752248</pub-id><pub-id pub-id-type="doi">10.1093/nar/30.1.38</pub-id></element-citation></ref><ref id="R14"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hwang</surname><given-names>B</given-names></name><name><surname>Lee</surname><given-names>J</given-names></name><name><surname>Bang</surname><given-names>D</given-names></name></person-group><article-title>Single-cell RNA sequencing technologies and bioinformatics pipelines</article-title><source>Experimental &amp; Molecular Medicine</source><year>2018</year><volume>50</volume><fpage>1</fpage><lpage>14</lpage><pub-id pub-id-type="pmcid">PMC6082860</pub-id><pub-id pub-id-type="pmid">30089861</pub-id><pub-id pub-id-type="doi">10.1038/s12276-018-0071-8</pub-id></element-citation></ref><ref id="R15"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jamal-Hanjani</surname><given-names>M</given-names></name><name><surname>Wilson</surname><given-names>G</given-names></name><name><surname>McGranahan</surname><given-names>N</given-names></name><name><surname>Birkbak</surname><given-names>N</given-names></name><name><surname>Watkins</surname><given-names>T</given-names></name><name><surname>Veeriah</surname><given-names>S</given-names></name><name><surname>Shafi</surname><given-names>S</given-names></name><name><surname>Johnson</surname><given-names>D</given-names></name><name><surname>Mitter</surname><given-names>R</given-names></name><name><surname>Rosenthal</surname><given-names>R</given-names></name><collab>Others</collab></person-group><article-title>Tracking the evolution of non–small-cell lung cancer</article-title><source>New England Journal Of Medicine</source><year>2017</year><volume>376</volume><fpage>2109</fpage><lpage>2121</lpage><pub-id pub-id-type="pmid">28445112</pub-id></element-citation></ref><ref id="R16"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Janiszewska</surname><given-names>M</given-names></name></person-group><article-title>The microcosmos of intratumor heterogeneity: the space-time of cancer evolution</article-title><source>Oncogene</source><year>2020</year><volume>39</volume><fpage>2031</fpage><lpage>2039</lpage><pub-id pub-id-type="pmcid">PMC7374939</pub-id><pub-id pub-id-type="pmid">31784650</pub-id><pub-id pub-id-type="doi">10.1038/s41388-019-1127-5</pub-id></element-citation></ref><ref id="R17"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jia</surname><given-names>Q</given-names></name><name><surname>Wu</surname><given-names>W</given-names></name><name><surname>Wang</surname><given-names>Y</given-names></name><name><surname>Alexander</surname><given-names>P</given-names></name><name><surname>Sun</surname><given-names>C</given-names></name><name><surname>Gong</surname><given-names>Z</given-names></name><name><surname>Cheng</surname><given-names>J</given-names></name><name><surname>Sun</surname><given-names>H</given-names></name><name><surname>Guan</surname><given-names>Y</given-names></name><name><surname>Xia</surname><given-names>X</given-names></name><collab>Others</collab></person-group><article-title>Local mutational diversity drives intratumoral immune heterogeneity in non-small cell lung cancer</article-title><source>Nature Communications</source><year>2018</year><volume>9</volume><fpage>1</fpage><lpage>10</lpage><pub-id pub-id-type="pmcid">PMC6299138</pub-id><pub-id pub-id-type="pmid">30560866</pub-id><pub-id pub-id-type="doi">10.1038/s41467-018-07767-w</pub-id></element-citation></ref><ref id="R18"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>B</given-names></name><name><surname>Dewey</surname><given-names>C</given-names></name></person-group><article-title>RSEM: accurate transcript quantification from RNA-Seq data with or without a reference genome</article-title><source>BMC Bioinformatics</source><year>2011</year><volume>12</volume><fpage>1</fpage><lpage>16</lpage><pub-id pub-id-type="pmcid">PMC3163565</pub-id><pub-id pub-id-type="pmid">21816040</pub-id><pub-id pub-id-type="doi">10.1186/1471-2105-12-323</pub-id></element-citation></ref><ref id="R19"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Li</surname><given-names>B</given-names></name><name><surname>Severson</surname><given-names>E</given-names></name><name><surname>Pignon</surname><given-names>J</given-names></name><name><surname>Zhao</surname><given-names>H</given-names></name><name><surname>Li</surname><given-names>T</given-names></name><name><surname>Novak</surname><given-names>J</given-names></name><name><surname>Jiang</surname><given-names>P</given-names></name><name><surname>Shen</surname><given-names>H</given-names></name><name><surname>Aster</surname><given-names>J</given-names></name><name><surname>Rodig</surname><given-names>S</given-names></name><collab>Others</collab></person-group><article-title>Comprehensive analyses of tumor immunity: implications for cancer immunotherapy</article-title><source>Genome Biology</source><year>2016</year><volume>17</volume><fpage>1</fpage><lpage>16</lpage><pub-id pub-id-type="pmcid">PMC4993001</pub-id><pub-id pub-id-type="pmid">27549193</pub-id><pub-id pub-id-type="doi">10.1186/s13059-016-1028-7</pub-id></element-citation></ref><ref id="R20"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Linsley</surname><given-names>P</given-names></name><name><surname>Speake</surname><given-names>C</given-names></name><name><surname>Whalen</surname><given-names>E</given-names></name><name><surname>Chaussabel</surname><given-names>D</given-names></name></person-group><article-title>Copy number loss of the interferon gene cluster in melanomas is linked to reduced T cell infiltrate and poor patient prognosis</article-title><source>PloS One</source><year>2014</year><volume>9</volume><elocation-id>e109760</elocation-id><pub-id pub-id-type="pmcid">PMC4196925</pub-id><pub-id pub-id-type="pmid">25314013</pub-id><pub-id pub-id-type="doi">10.1371/journal.pone.0109760</pub-id></element-citation></ref><ref id="R21"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Meister</surname><given-names>M</given-names></name><name><surname>Belousov</surname><given-names>A</given-names></name><name><surname>Xu</surname><given-names>E</given-names></name><name><surname>Schnabel</surname><given-names>P</given-names></name><name><surname>Warth</surname><given-names>A</given-names></name><name><surname>Hoofmann</surname><given-names>H</given-names></name><collab>Others</collab></person-group><article-title>Intra-tumor heterogeneity of gene expression profiles in early stage non-small cell lung cancer</article-title><source>J Bioinf Res Stud</source><year>2014</year><volume>1</volume><fpage>1</fpage></element-citation></ref><ref id="R22"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Newman</surname><given-names>A</given-names></name><name><surname>Liu</surname><given-names>C</given-names></name><name><surname>Green</surname><given-names>M</given-names></name><name><surname>Gentles</surname><given-names>A</given-names></name><name><surname>Feng</surname><given-names>W</given-names></name><name><surname>Xu</surname><given-names>Y</given-names></name><name><surname>Hoang</surname><given-names>C</given-names></name><name><surname>Diehn</surname><given-names>M</given-names></name><name><surname>Alizadeh</surname><given-names>A</given-names></name></person-group><article-title>Robust enumeration of cell subsets from tissue expression profiles</article-title><source>Nature Methods</source><year>2015</year><volume>12</volume><fpage>453</fpage><lpage>457</lpage><pub-id pub-id-type="pmcid">PMC4739640</pub-id><pub-id pub-id-type="pmid">25822800</pub-id><pub-id pub-id-type="doi">10.1038/nmeth.3337</pub-id></element-citation></ref><ref id="R23"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Potter</surname><given-names>S</given-names></name></person-group><article-title>Single-cell RNA sequencing for the study of development, physiology and disease</article-title><source>Nature Reviews Nephrology</source><year>2018</year><volume>14</volume><fpage>479</fpage><lpage>492</lpage><pub-id pub-id-type="pmcid">PMC6070143</pub-id><pub-id pub-id-type="pmid">29789704</pub-id><pub-id pub-id-type="doi">10.1038/s41581-018-0021-7</pub-id></element-citation></ref><ref id="R24"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Racle</surname><given-names>J</given-names></name><name><surname>Jonge</surname><given-names>K</given-names></name><name><surname>Baumgaertner</surname><given-names>P</given-names></name><name><surname>Speiser</surname><given-names>D</given-names></name><name><surname>Gfeller</surname><given-names>D</given-names></name></person-group><article-title>Simultaneous enu-meration of cancer and immune cell types from bulk tumor gene expression data</article-title><source>Elife</source><year>2017</year><volume>6</volume><elocation-id>e26476</elocation-id><pub-id pub-id-type="pmcid">PMC5718706</pub-id><pub-id pub-id-type="pmid">29130882</pub-id><pub-id pub-id-type="doi">10.7554/eLife.26476</pub-id></element-citation></ref><ref id="R25"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Racle</surname><given-names>J</given-names></name><name><surname>Gfeller</surname><given-names>D</given-names></name></person-group><article-title>EPIC: a tool to estimate the proportions of different cell types from bulk gene expression data</article-title><source>Bioinformatics For Cancer Immunotherapy</source><year>2020</year><fpage>233</fpage><lpage>248</lpage><pub-id pub-id-type="pmid">32124324</pub-id></element-citation></ref><ref id="R26"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Reuben</surname><given-names>A</given-names></name><name><surname>Gittelman</surname><given-names>R</given-names></name><name><surname>Gao</surname><given-names>J</given-names></name><name><surname>Zhang</surname><given-names>J</given-names></name><name><surname>Yusko</surname><given-names>E</given-names></name><name><surname>Wu</surname><given-names>C</given-names></name><name><surname>Emerson</surname><given-names>R</given-names></name><name><surname>Zhang</surname><given-names>J</given-names></name><name><surname>Tipton</surname><given-names>C</given-names></name><name><surname>Li</surname><given-names>J</given-names></name><collab>Others</collab></person-group><article-title>TCR Repertoire Intratumor Heterogeneity in Localized Lung Adenocarcinomas: An Association with Predicted Neoantigen Heterogeneity and Postsurgical RecurrenceTCR Intratumor Heterogeneity and Relapse in Lung Cancer</article-title><source>Cancer Discovery</source><year>2017</year><volume>7</volume><fpage>1088</fpage><lpage>1097</lpage><pub-id pub-id-type="pmcid">PMC5628137</pub-id><pub-id pub-id-type="pmid">28733428</pub-id><pub-id pub-id-type="doi">10.1158/2159-8290.CD-17-0256</pub-id></element-citation></ref><ref id="R27"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Robinson</surname><given-names>M</given-names></name><name><surname>Oshlack</surname><given-names>A</given-names></name></person-group><article-title>A scaling normalization method for differential expression analysis of RNA-seq data</article-title><source>Genome Biology</source><year>2010</year><volume>11</volume><fpage>1</fpage><lpage>9</lpage><pub-id pub-id-type="pmcid">PMC2864565</pub-id><pub-id pub-id-type="pmid">20196867</pub-id><pub-id pub-id-type="doi">10.1186/gb-2010-11-3-r25</pub-id></element-citation></ref><ref id="R28"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Rooney</surname><given-names>M</given-names></name><name><surname>Shukla</surname><given-names>S</given-names></name><name><surname>Wu</surname><given-names>C</given-names></name><name><surname>Getz</surname><given-names>G</given-names></name><name><surname>Hacohen</surname><given-names>N</given-names></name></person-group><article-title>Molecular and genetic properties of tumors associated with local immune cytolytic activity</article-title><source>Cell</source><year>2015</year><volume>160</volume><fpage>48</fpage><lpage>61</lpage><pub-id pub-id-type="pmcid">PMC4856474</pub-id><pub-id pub-id-type="pmid">25594174</pub-id><pub-id pub-id-type="doi">10.1016/j.cell.2014.12.033</pub-id></element-citation></ref><ref id="R29"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Saliba</surname><given-names>A</given-names></name><name><surname>Westermann</surname><given-names>A</given-names></name><name><surname>Gorski</surname><given-names>S</given-names></name><name><surname>Vogel</surname><given-names>J</given-names></name></person-group><article-title>Single-cell RNA-seq: advances and future challenges</article-title><source>Nucleic Acids Research</source><year>2014</year><volume>42</volume><fpage>8845</fpage><lpage>8860</lpage><pub-id pub-id-type="pmcid">PMC4132710</pub-id><pub-id pub-id-type="pmid">25053837</pub-id><pub-id pub-id-type="doi">10.1093/nar/gku555</pub-id></element-citation></ref><ref id="R30"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sasaki</surname><given-names>Y</given-names></name><collab>Others</collab></person-group><article-title>The truth of the F-measure</article-title><source>Teach Tutor Mater</source><year>2007</year><volume>1</volume><fpage>1</fpage><lpage>5</lpage></element-citation></ref><ref id="R31"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sato</surname><given-names>S</given-names></name><name><surname>Sanjo</surname><given-names>H</given-names></name><name><surname>Takeda</surname><given-names>K</given-names></name><name><surname>Ninomiya-Tsuji</surname><given-names>J</given-names></name><name><surname>Yamamoto</surname><given-names>M</given-names></name><name><surname>Kawai</surname><given-names>T</given-names></name><name><surname>Matsumoto</surname><given-names>K</given-names></name><name><surname>Takeuchi</surname><given-names>O</given-names></name><name><surname>Akira</surname><given-names>S</given-names></name></person-group><article-title>Essential function for the kinase TAK1 in innate and adaptive immune responses</article-title><source>Nature Immunology</source><year>2005</year><volume>6</volume><fpage>1087</fpage><lpage>1095</lpage><pub-id pub-id-type="pmid">16186825</pub-id></element-citation></ref><ref id="R32"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Schölkopf</surname><given-names>B</given-names></name><name><surname>Smola</surname><given-names>A</given-names></name><name><surname>Williamson</surname><given-names>R</given-names></name><name><surname>Bartlett</surname><given-names>P</given-names></name></person-group><article-title>New support vector algorithms</article-title><source>Neural Computation</source><year>2000</year><volume>12</volume><fpage>1207</fpage><lpage>1245</lpage><pub-id pub-id-type="pmid">10905814</pub-id></element-citation></ref><ref id="R33"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Sousa</surname><given-names>V</given-names></name><name><surname>Carvalho</surname><given-names>L</given-names></name></person-group><article-title>Heterogeneity in lung cancer</article-title><source>Pathobiology</source><year>2018</year><volume>85</volume><fpage>96</fpage><lpage>107</lpage><pub-id pub-id-type="pmid">29635240</pub-id></element-citation></ref><ref id="R34"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Teh</surname><given-names>Y</given-names></name><name><surname>Newman</surname><given-names>D</given-names></name><name><surname>Welling</surname><given-names>M</given-names></name></person-group><article-title>A collapsed variational Bayesian inference algorithm for latent Dirichlet allocation</article-title><source>Advances In Neural Information Processing Systems</source><year>2006</year><volume>19</volume></element-citation></ref><ref id="R35"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Teh</surname><given-names>Y</given-names></name><name><surname>Kurihara</surname><given-names>K</given-names></name><name><surname>Welling</surname><given-names>M</given-names></name></person-group><article-title>Collapsed variational inference for HDP</article-title><source>Advances In Neural Information Processing Systems</source><year>2007</year><volume>20</volume></element-citation></ref><ref id="R36"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>P</given-names></name><name><surname>Blunsom</surname><given-names>P</given-names></name></person-group><article-title>Collapsed variational Bayesian inference for hidden Markov models</article-title><source>Artificial Intelligence And Statistics</source><year>2013</year><fpage>599</fpage><lpage>607</lpage></element-citation></ref><ref id="R37"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Whiteside</surname><given-names>T</given-names></name><name><surname>Vujanovic</surname><given-names>N</given-names></name><name><surname>Herberman</surname><given-names>R</given-names></name></person-group><article-title>Natural killer cells and tumor therapy</article-title><source>Specificity, Function, And Development Of Nk Cells</source><year>1998</year><fpage>221</fpage><lpage>244</lpage></element-citation></ref><ref id="R38"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wilson</surname><given-names>D</given-names></name><name><surname>Jin</surname><given-names>C</given-names></name><name><surname>Ibrahim</surname><given-names>J</given-names></name><name><surname>Sun</surname><given-names>W</given-names></name></person-group><article-title>ICeD-T Provides Accurate Estimates of Immune Cell Abundance in Tumor Samples by Allowing for Aberrant Gene Expression Patterns</article-title><source>Journal Of The American Statistical Association</source><year>2020</year><volume>115</volume><fpage>1055</fpage><lpage>1065</lpage><pub-id pub-id-type="pmcid">PMC7529339</pub-id><pub-id pub-id-type="pmid">33012900</pub-id><pub-id pub-id-type="doi">10.1080/01621459.2019.1654874</pub-id></element-citation></ref><ref id="R39"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>J</given-names></name><name><surname>Fujimoto</surname><given-names>J</given-names></name><name><surname>Zhang</surname><given-names>J</given-names></name><name><surname>Wedge</surname><given-names>D</given-names></name><name><surname>Song</surname><given-names>X</given-names></name><name><surname>Zhang</surname><given-names>J</given-names></name><name><surname>Seth</surname><given-names>S</given-names></name><name><surname>Chow</surname><given-names>C</given-names></name><name><surname>Cao</surname><given-names>Y</given-names></name><name><surname>Gumbs</surname><given-names>C</given-names></name><collab>Others</collab></person-group><article-title>Intratumor heterogeneity in localized lung adenocarcinomas delineated by multiregion sequencing</article-title><source>Science</source><year>2014</year><volume>346</volume><fpage>256</fpage><lpage>259</lpage><pub-id pub-id-type="pmcid">PMC4354858</pub-id><pub-id pub-id-type="pmid">25301631</pub-id><pub-id pub-id-type="doi">10.1126/science.1256930</pub-id></element-citation></ref><ref id="R40"><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>Y</given-names></name><name><surname>Parmigiani</surname><given-names>G</given-names></name><name><surname>Johnson</surname><given-names>W</given-names></name></person-group><article-title>ComBat-seq: batch effect adjustment for RNA-seq count data</article-title><source>NAR Genomics And Bioinformatics</source><year>2020</year><volume>2</volume><elocation-id>qaa078</elocation-id><pub-id pub-id-type="pmcid">PMC7518324</pub-id><pub-id pub-id-type="pmid">33015620</pub-id><pub-id pub-id-type="doi">10.1093/nargab/lqaa078</pub-id></element-citation></ref></ref-list></back><floats-group><fig id="F1" position="float"><label>Figure 1</label><caption><title>Multi-region sequencing study design.</title><p>TRACERx data are used to exemplify the data collection procedure and sample relationships. The clustering results by phylogenetic tree show strong within-subject correlations. The proposed deconvolution model borrows information across samples and assesses the intratumor heterogeneity of cellular compositions, which are found to be associated with patients’ prognoses.</p></caption><graphic xlink:href="EMS190323-f001"/></fig><fig id="F2" position="float"><label>Figure 2</label><caption><title>Graphical model structure of ICeITH model.</title></caption><graphic xlink:href="EMS190323-f002"/></fig><fig id="F3" position="float"><label>Figure 3</label><caption><title>Results of analyzing the simulation data in the setting with four cell types and randomly generated sample numbers.</title><p>Simulation results of Spearman correlation (a) and Root-mean-square error (RMSE, b) between four true cell type (CT) proportions and estimated CT proportions from three different methods: ICeITH, CIBERSORT, and EPIC. (c) Sampling distribution of F1-score on low vs. high ITH (intratumor heterogeneity) group, dichotomized by the median value of ITH, from three different methods. Each sampling distribution contains 100 replicates. (d-f) The comparison of four true CT proportions and estimated proportions by three methods with Spearman’s rank correlation test.</p></caption><graphic xlink:href="EMS190323-f003"/></fig><fig id="F4" position="float"><label>Figure 4</label><caption><title>Results of analyzing the simulation data in the setting with four cell types and fixed sample numbers.</title><p>Sampling distribution of Spearman Correlation (a) and RMSE (b) between true and estimated CT proportions from three different methods: ICeITH, CIBERSORT, and EPIC based on the scenarios where every patient shares the same number of samples. (c) Sampling distribution of F1-score generated from the estimated ITH scores by each method on each scenario. (d) Standard errors of sampling distribution from (a) and (b) across different methods and scenarios.</p></caption><graphic xlink:href="EMS190323-f004"/></fig><fig id="F5" position="float"><label>Figure 5</label><caption><title>Results of analyzing the TRACERx data.</title><p>(a) Distribution of relative abundance for six immune cell types and tumor cells estimated by ICeITH and Sequenza, respectively. (b) Dot plot to compare the estimates between the ICeITH model and CIBERSORT. Kaplan-Meier (KM) curves for disease-free probability with high vs. low ITH estimated under (c) pro-tumor and (d) anti-tumor process immune cells for 45 patients from the TRACERx study. KM plots for disease-free probability with high vs. low ITH estimated under (e) pro-tumor and (f) anti-tumor process immune cell, stratified by different immune levels, for 44 patients in the TRACERx study. The sample size for each stratification is marked on the KM curve.</p></caption><graphic xlink:href="EMS190323-f005"/></fig><fig id="F6" position="float"><label>Figure 6</label><caption><title>Results of analyzing the MDA-ITH data.</title><p>(a) Distribution of estimated proportions for six immune cell types by the ICeITH model. (b) Dot plot to compare the estimates between ICeITH model and CIBERSORT. KM curves for disease-free probability with high vs. low ITH estimated by immune cells under (c) pro-tumor and (d) anti-tumor process for 25 patients from the MDA-ITH study. The sample size for each stratification is marked on the KM curve.</p></caption><graphic xlink:href="EMS190323-f006"/></fig></floats-group></article>